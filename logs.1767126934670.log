2025-12-30T20:17:22.000000000Z [inf]  Starting Container
2025-12-30T20:17:23.736558269Z [err]  [2025-12-30 20:17:23 +0000] [6] [INFO] Booting worker with pid: 6
2025-12-30T20:17:23.736558877Z [inf]  =========================================
2025-12-30T20:17:23.736561540Z [err]  [2025-12-30 20:17:23 +0000] [1] [INFO] Starting gunicorn 22.0.0
2025-12-30T20:17:23.736571704Z [err]  [2025-12-30 20:17:23 +0000] [1] [INFO] Listening at: http://0.0.0.0:8080 (1)
2025-12-30T20:17:23.736583544Z [err]  [2025-12-30 20:17:23 +0000] [3] [INFO] Booting worker with pid: 3
2025-12-30T20:17:23.736584155Z [err]  [2025-12-30 20:17:23 +0000] [1] [INFO] Using worker: uvicorn.workers.UvicornWorker
2025-12-30T20:17:23.736589412Z [err]  [2025-12-30 20:17:23 +0000] [4] [INFO] Booting worker with pid: 4
2025-12-30T20:17:23.736594606Z [err]  [2025-12-30 20:17:23 +0000] [5] [INFO] Booting worker with pid: 5
2025-12-30T20:17:23.737199278Z [inf]  =========================================
2025-12-30T20:17:23.737207449Z [inf]  üöÄ START.SH SCRIPT IS EXECUTING
2025-12-30T20:17:23.737214762Z [inf]  =========================================
2025-12-30T20:17:23.737220520Z [inf]  üìç Working directory: /app/backend
2025-12-30T20:17:23.737226101Z [inf]  üîç Python path: /app/backend
2025-12-30T20:17:23.737230799Z [inf]  üåê Starting Gunicorn on 0.0.0.0:8080...
2025-12-30T20:17:42.819795112Z [err]  2025-12-30 20:17:41,029 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-30T20:17:42.819803302Z [err]  2025-12-30 20:17:41,029 - server - INFO - üî• Pre-warming connection libraries...
2025-12-30T20:17:42.819813457Z [err]  2025-12-30 20:17:41,029 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-30T20:17:42.819825757Z [err]  2025-12-30 20:17:41,029 - server - INFO - üî• Pre-warming connection libraries...
2025-12-30T20:17:42.819836895Z [err]  2025-12-30 20:17:41,030 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-30T20:17:42.819918888Z [err]  2025-12-30 20:17:41,030 - server - INFO - üî• Pre-warming connection libraries...
2025-12-30T20:17:42.819927909Z [err]  2025-12-30 20:17:41,070 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-30T20:17:42.819938470Z [err]  2025-12-30 20:17:41,073 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-30T20:17:42.819948725Z [err]  2025-12-30 20:17:41,079 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-30T20:17:42.819958556Z [err]  2025-12-30 20:17:41,257 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-30T20:17:42.819969859Z [err]  2025-12-30 20:17:41,257 - server - INFO - üî• Pre-warming connection libraries...
2025-12-30T20:17:42.820024729Z [err]  2025-12-30 20:17:41,278 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-30T20:17:42.820042011Z [err]  2025-12-30 20:17:41,280 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-30T20:17:42.820053119Z [err]  2025-12-30 20:17:41,282 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-30T20:17:42.824707079Z [err]  2025-12-30 20:17:41,625 - server - INFO - ‚úÖ QC learning router loaded
2025-12-30T20:17:42.824725342Z [err]  2025-12-30 20:17:41,627 - server - INFO - ‚úÖ QC learning router loaded
2025-12-30T20:17:42.824738350Z [err]  2025-12-30 20:17:41,631 - server - INFO - ‚úÖ QC learning router loaded
2025-12-30T20:17:42.824749336Z [err]  2025-12-30 20:17:41,643 - server - INFO - ‚úÖ QC learning router loaded
2025-12-30T20:17:42.824762409Z [err]  2025-12-30 20:17:41,803 - server - INFO - ‚úÖ CRM router loaded
2025-12-30T20:17:42.824765934Z [err]  2025-12-30 20:17:41,292 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-30T20:17:42.824776288Z [err]  2025-12-30 20:17:41,450 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-30T20:17:42.824781710Z [err]  2025-12-30 20:17:41,485 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-30T20:17:42.824786930Z [err]  2025-12-30 20:17:41,487 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-30T20:17:42.824792581Z [err]  2025-12-30 20:17:41,507 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-30T20:17:42.824797406Z [err]  2025-12-30 20:17:41,538 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-30T20:17:42.824804510Z [err]  2025-12-30 20:17:41,554 - server - INFO - ‚úÖ QC agent router loaded
2025-12-30T20:17:42.824809830Z [err]  2025-12-30 20:17:41,564 - server - INFO - ‚úÖ QC agent router loaded
2025-12-30T20:17:42.824815192Z [err]  2025-12-30 20:17:41,577 - server - INFO - ‚úÖ QC agent router loaded
2025-12-30T20:17:42.824828823Z [err]  2025-12-30 20:17:41,607 - server - INFO - ‚úÖ QC agent router loaded
2025-12-30T20:17:42.826079268Z [err]  2025-12-30 20:17:41,809 - server - INFO - ‚úÖ CRM router loaded
2025-12-30T20:17:42.826089795Z [err]  2025-12-30 20:17:41,821 - server - INFO - ‚úÖ CRM router loaded
2025-12-30T20:17:42.826096942Z [err]  2025-12-30 20:17:41,836 - server - INFO - ‚úÖ CRM router loaded
2025-12-30T20:17:42.827287051Z [err]  2025-12-30 20:17:41,965 - server - INFO - ‚úÖ QC test router loaded
2025-12-30T20:17:42.827294268Z [err]  2025-12-30 20:17:41,966 - server - INFO - ‚úÖ QC test router loaded
2025-12-30T20:17:42.827301249Z [err]  2025-12-30 20:17:41,974 - server - INFO - ‚úÖ QC test router loaded
2025-12-30T20:17:42.827309907Z [err]  2025-12-30 20:17:41,976 - server - INFO - ‚úÖ QC test router loaded
2025-12-30T20:17:42.827316811Z [err]  2025-12-30 20:17:41,998 - server - INFO - ‚úÖ Agent test router loaded
2025-12-30T20:17:42.827324385Z [err]  2025-12-30 20:17:42,002 - server - INFO - ‚úÖ Agent test router loaded
2025-12-30T20:17:42.827332487Z [err]  2025-12-30 20:17:42,014 - server - INFO - ‚úÖ Agent test router loaded
2025-12-30T20:17:42.827338864Z [err]  2025-12-30 20:17:42,015 - server - INFO - ‚úÖ Agent test router loaded
2025-12-30T20:17:42.827344600Z [err]  2025-12-30 20:17:42,020 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-30T20:17:42.827350395Z [err]  2025-12-30 20:17:42,020 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-30T20:17:42.827356271Z [err]  2025-12-30 20:17:42,024 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-30T20:17:42.827362490Z [err]  2025-12-30 20:17:42,024 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-30T20:17:42.827371230Z [err]  2025-12-30 20:17:42,024 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-30T20:17:42.827376971Z [err]  2025-12-30 20:17:42,024 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-30T20:17:42.827383495Z [err]  2025-12-30 20:17:42,031 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-30T20:17:42.827390422Z [err]  2025-12-30 20:17:42,031 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-30T20:17:42.827398117Z [err]  [2025-12-30 20:17:42 +0000] [5] [INFO] Started server process [5]
2025-12-30T20:17:42.827407571Z [err]  [2025-12-30 20:17:42 +0000] [5] [INFO] Waiting for application startup.
2025-12-30T20:17:42.833924495Z [err]  2025-12-30 20:17:42,078 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-30T20:17:42.833934630Z [err]  2025-12-30 20:17:42,084 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-30T20:17:42.833965430Z [err]  [2025-12-30 20:17:42 +0000] [6] [INFO] Started server process [6]
2025-12-30T20:17:42.833972212Z [err]  [2025-12-30 20:17:42 +0000] [6] [INFO] Waiting for application startup.
2025-12-30T20:17:42.833981569Z [err]  [2025-12-30 20:17:42 +0000] [4] [INFO] Started server process [4]
2025-12-30T20:17:42.833988142Z [err]  [2025-12-30 20:17:42 +0000] [4] [INFO] Waiting for application startup.
2025-12-30T20:17:42.833994463Z [err]  2025-12-30 20:17:42,062 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-30T20:17:42.834003564Z [err]  2025-12-30 20:17:42,064 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-30T20:17:42.834010669Z [err]  [2025-12-30 20:17:42 +0000] [3] [INFO] Started server process [3]
2025-12-30T20:17:42.834016973Z [err]  [2025-12-30 20:17:42 +0000] [3] [INFO] Waiting for application startup.
2025-12-30T20:17:52.115616704Z [err]  2025-12-30 20:17:51,581 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-30T20:17:52.115633171Z [err]  2025-12-30 20:17:51,581 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-30T20:17:52.115654793Z [err]  2025-12-30 20:17:51,570 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-30T20:17:52.115665071Z [err]  2025-12-30 20:17:51,581 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-30T20:17:53.099957922Z [err]  2025-12-30 20:17:52,324 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-30T20:17:53.099966051Z [err]  2025-12-30 20:17:52,563 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-30T20:17:53.099969274Z [err]  2025-12-30 20:17:52,314 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-30T20:17:53.099969962Z [err]  2025-12-30 20:17:52,379 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-30T20:17:53.099991820Z [err]  2025-12-30 20:17:52,324 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-30T20:17:53.100000815Z [err]  2025-12-30 20:17:52,324 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-30T20:17:53.100103588Z [err]  [2025-12-30 20:17:52 +0000] [6] [INFO] Application startup complete.
2025-12-30T20:17:53.100113834Z [err]  2025-12-30 20:17:53,078 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-30T20:17:53.100122999Z [err]  2025-12-30 20:17:53,089 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-30T20:17:53.100127427Z [err]  2025-12-30 20:17:52,390 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-30T20:17:53.100136307Z [err]  2025-12-30 20:17:52,390 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-30T20:17:53.100143352Z [err]  2025-12-30 20:17:52,390 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-30T20:17:53.100160166Z [err]  2025-12-30 20:17:52,452 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-30T20:17:53.100169938Z [err]  2025-12-30 20:17:52,562 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-30T20:17:53.107566002Z [err]  2025-12-30 20:17:53,089 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-30T20:17:53.107573522Z [err]  2025-12-30 20:17:53,089 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-30T20:17:54.051609672Z [err]  2025-12-30 20:17:53,366 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-30T20:17:54.051696289Z [err]  2025-12-30 20:17:53,408 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-30T20:17:54.051705212Z [err]  2025-12-30 20:17:53,481 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-30T20:17:54.051712241Z [err]  2025-12-30 20:17:53,482 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-30T20:17:54.051718947Z [err]  [2025-12-30 20:17:53 +0000] [4] [INFO] Application startup complete.
2025-12-30T20:17:54.051732014Z [err]  2025-12-30 20:17:53,520 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-30T20:17:54.051739526Z [err]  2025-12-30 20:17:53,520 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-30T20:17:54.051746472Z [err]  [2025-12-30 20:17:53 +0000] [5] [INFO] Application startup complete.
2025-12-30T20:17:54.051754068Z [err]  2025-12-30 20:17:53,953 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-30T20:17:54.093842997Z [err]  2025-12-30 20:17:54,090 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-30T20:17:54.093854856Z [err]  2025-12-30 20:17:54,091 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-30T20:17:54.093862892Z [err]  [2025-12-30 20:17:54 +0000] [3] [INFO] Application startup complete.
2025-12-30T20:23:30.440715245Z [inf]  100.64.0.2:59654 - "GET /api/auth/me HTTP/1.1" 401
2025-12-30T20:23:30.440729126Z [inf]  100.64.0.3:56702 - "OPTIONS /api/auth/login HTTP/1.1" 200
2025-12-30T20:23:30.440739060Z [inf]  100.64.0.2:59654 - "POST /api/auth/login HTTP/1.1" 200
2025-12-30T20:23:30.495707538Z [inf]  100.64.0.2:59654 - "GET /api/agents HTTP/1.1" 200
2025-12-30T20:23:34.457320203Z [inf]  100.64.0.2:59654 - "GET /api/agents HTTP/1.1" 200
2025-12-30T20:23:53.662048920Z [inf]  100.64.0.4:32858 - "OPTIONS /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-30T20:23:53.662059078Z [err]  2025-12-30 20:23:51,787 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-30T20:23:53.662064879Z [err]  2025-12-30 20:23:51,891 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T20:23:53.662071739Z [err]  2025-12-30 20:23:51,985 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T20:23:53.662078223Z [err]  2025-12-30 20:23:52,015 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T20:23:53.662084053Z [err]  2025-12-30 20:23:52,015 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-30T20:23:53.662089934Z [err]  2025-12-30 20:23:52,015 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-30T20:23:53.662095054Z [err]  2025-12-30 20:23:52,015 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-30T20:23:53.662100982Z [err]  2025-12-30 20:23:52,665 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-30T20:23:53.662106186Z [err]  2025-12-30 20:23:52,669 - telnyx_service - INFO - ‚úÖ Call initiated: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:23:53.662110702Z [err]  2025-12-30 20:23:52,780 - server - INFO - üìù Created call log: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:23:53.662115579Z [err]  2025-12-30 20:23:52,780 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T20:23:53.662120896Z [err]  2025-12-30 20:23:52,780 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-30T20:23:53.664185828Z [err]  2025-12-30 20:23:52,780 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T20:23:53.664198286Z [err]  2025-12-30 20:23:52,780 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T20:23:53.664206046Z [err]  2025-12-30 20:23:52,787 - redis_service - INFO - üì¶ Stored call data in Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA (TTL: 3600s)
2025-12-30T20:23:53.664213569Z [err]  2025-12-30 20:23:52,787 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-30T20:23:53.664220672Z [err]  2025-12-30 20:23:52,787 - server - INFO - üìû Outbound call initiated: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:23:53.664238684Z [inf]  100.64.0.5:15640 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-30T20:23:53.664246630Z [err]  2025-12-30 20:23:53,013 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-30T20:23:53.664253335Z [err]  2025-12-30 20:23:53,013 - server - INFO -    Client: Address(host='100.64.0.6', port=27338)
2025-12-30T20:23:53.664259645Z [err]  2025-12-30 20:23:53,013 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'M0fJ6QxgUI6+wIL1E5+SIA==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'Q7bdXhlxQriY-YcM9I3ezw', 'x-real-ip': '192.76.120.151', 'x-request-start': '1767126232791', 'accept-encoding': 'gzip'}
2025-12-30T20:23:53.664267184Z [err]  2025-12-30 20:23:53,013 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-30T20:23:53.664274762Z [err]  2025-12-30 20:23:53,013 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-30T20:23:53.667946338Z [err]  [2025-12-30 20:23:53 +0000] [3] [INFO] ('100.64.0.6', 27338) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-30T20:23:53.667955328Z [err]  2025-12-30 20:23:53,014 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-30T20:23:53.667962387Z [err]  [2025-12-30 20:23:53 +0000] [3] [INFO] connection open
2025-12-30T20:23:53.667969722Z [err]  2025-12-30 20:23:53,110 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T20:23:53.667991579Z [err]  2025-12-30 20:23:53,111 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': '8b85ec3b-58ed-4c77-a96d-46902beb7fbb', 'occurred_at': '2025-12-30T20:23:52.563274Z', 'payload': {'call_control_id': 'v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA', 'call_leg_id': '7505eb5e-e5bd-11f0-a989-02420aef991f', 'call_session_id': '7503c9be-e5bd-11f0-abec-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T20:23:53.667999663Z [err]  2025-12-30 20:23:53,111 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:23:53.668006190Z [err]  2025-12-30 20:23:53,111 - server - INFO - üì® ================================================
2025-12-30T20:23:53.668013219Z [err]  2025-12-30 20:23:53,111 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-30T20:23:53.668024002Z [inf]  100.64.0.7:14786 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T20:23:53.668031784Z [err]  2025-12-30 20:23:53,165 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-30T20:23:53.668039181Z [err]  2025-12-30 20:23:53,165 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-30T20:23:53.669961375Z [err]  2025-12-30 20:23:53,550 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T20:23:53.669971679Z [err]  2025-12-30 20:23:53,552 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-30T20:23:58.833044975Z [err]  2025-12-30 20:23:58,827 - server - INFO - üì¨ Received Telnyx event: start
2025-12-30T20:23:58.833070258Z [err]  2025-12-30 20:23:58,828 - server - INFO - üé¨ Stream started for call: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:23:58.836580413Z [err]  2025-12-30 20:23:58,834 - redis_service - INFO - üì• Retrieved call data from Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:23:58.840277338Z [err]  2025-12-30 20:23:58,835 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-30T20:23:58.840288914Z [err]  2025-12-30 20:23:58,835 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-30T20:23:59.672540972Z [err]  2025-12-30 20:23:59,340 - redis_service - INFO - üì• Retrieved call data from Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:23:59.672547679Z [err]  2025-12-30 20:23:59,342 - server - INFO - üìù Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T20:23:59.672554931Z [err]  2025-12-30 20:23:59,342 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-30T20:23:59.672561035Z [err]  2025-12-30 20:23:59,400 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T20:23:59.672567552Z [err]  2025-12-30 20:23:59,400 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': 'de5cafcc-a9fa-4139-aeb0-825fd6839236', 'occurred_at': '2025-12-30T20:23:58.983284Z', 'payload': {'call_control_id': 'v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA', 'call_leg_id': '7505eb5e-e5bd-11f0-a989-02420aef991f', 'call_session_id': '7503c9be-e5bd-11f0-abec-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '7b624a0a-8b35-4f62-a764-7ec4e7180b2f', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T20:23:59.672574958Z [err]  2025-12-30 20:23:59,401 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:23:59.672582417Z [err]  2025-12-30 20:23:59,401 - server - INFO - üì® ================================================
2025-12-30T20:23:59.672588759Z [inf]  100.64.0.8:16118 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T20:23:59.672685451Z [err]  2025-12-30 20:23:59,168 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T20:23:59.672694357Z [err]  2025-12-30 20:23:59,169 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': '082b2639-a246-4794-ac70-ac1ad5ace759', 'occurred_at': '2025-12-30T20:23:58.663273Z', 'payload': {'call_control_id': 'v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA', 'call_leg_id': '7505eb5e-e5bd-11f0-a989-02420aef991f', 'call_session_id': '7503c9be-e5bd-11f0-abec-02420aef991f', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-30T20:23:52.563274Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T20:23:59.672706482Z [err]  2025-12-30 20:23:59,169 - server - INFO - üéØ Event type: call.answered, Call ID: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:23:59.672713409Z [err]  2025-12-30 20:23:59,169 - server - INFO - üì® ================================================
2025-12-30T20:23:59.672720646Z [err]  2025-12-30 20:23:59,169 - server - INFO - ‚úÖ Call answered: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:23:59.672727785Z [err]  2025-12-30 20:23:59,175 - redis_service - INFO - üì• Retrieved call data from Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:23:59.672735079Z [err]  2025-12-30 20:23:59,176 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-30T20:23:59.672742496Z [err]  2025-12-30 20:23:59,176 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-30T20:23:59.672749020Z [err]  2025-12-30 20:23:59,335 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-30T20:23:59.672758476Z [err]  2025-12-30 20:23:59,336 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-30T20:24:00.931470702Z [err]  2025-12-30 20:24:00,269 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T20:24:00.931493328Z [err]  2025-12-30 20:24:00,146 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T20:24:00.931500461Z [err]  2025-12-30 20:24:00,232 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T20:24:00.931506942Z [err]  2025-12-30 20:24:00,232 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-30T20:24:00.931512991Z [err]  2025-12-30 20:24:00,241 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-30T20:24:00.931514428Z [err]  2025-12-30 20:24:00,241 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-30T20:24:00.931522090Z [err]  2025-12-30 20:24:00,263 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-30T20:24:00.931528802Z [err]  2025-12-30 20:24:00,264 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-30T20:24:00.931537354Z [err]  2025-12-30 20:24:00,267 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-30T20:24:00.931570949Z [err]  2025-12-30 20:24:00,057 - server - INFO - ‚úÖ Call log updated
2025-12-30T20:24:00.931578095Z [err]  2025-12-30 20:24:00,057 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T20:24:00.931585882Z [err]  2025-12-30 20:24:00,057 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T20:24:00.931592632Z [err]  2025-12-30 20:24:00,057 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T20:24:01.706526706Z [err]  2025-12-30 20:24:00,358 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T20:24:01.706533117Z [err]  2025-12-30 20:24:00,371 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 104ms
2025-12-30T20:24:01.706539702Z [err]  2025-12-30 20:24:00,371 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-30T20:24:01.706580865Z [err]  2025-12-30 20:24:00,371 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-30T20:24:01.706587899Z [err]  2025-12-30 20:24:00,371 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-30T20:24:01.706593589Z [err]  2025-12-30 20:24:00,371 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-30T20:24:01.706600574Z [err]  2025-12-30 20:24:00,375 - server - INFO - ‚úÖ Initialized call_states for v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA with session reference
2025-12-30T20:24:01.706606548Z [err]  2025-12-30 20:24:00,384 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-30T20:24:01.706613103Z [err]  2025-12-30 20:24:00,471 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-30T20:24:01.706620248Z [err]  2025-12-30 20:24:00,534 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T20:24:01.706626574Z [err]  2025-12-30 20:24:00,535 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-30T20:24:01.706633063Z [err]  2025-12-30 20:24:00,553 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-30T20:24:01.706641511Z [err]  2025-12-30 20:24:00,554 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: cq1fjcX36w (loop=True, overlay=True)
2025-12-30T20:24:01.714055381Z [err]  2025-12-30 20:24:00,554 - server - WARNING - ‚ö†Ô∏è Failed to start comfort noise: 'v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA'
2025-12-30T20:24:01.714060941Z [err]  2025-12-30 20:24:00,554 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:01.714066754Z [err]  2025-12-30 20:24:00,835 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA/actions/record_start "HTTP/1.1 200 OK"
2025-12-30T20:24:01.714072642Z [err]  2025-12-30 20:24:00,838 - server - INFO - üéôÔ∏è Call recording started for v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:01.714080380Z [err]  2025-12-30 20:24:00,838 - server - INFO - üîß Creating call session for v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA...
2025-12-30T20:24:01.714087608Z [err]  2025-12-30 20:24:00,838 - server - INFO - üîç Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T20:24:01.714095538Z [err]  2025-12-30 20:24:00,838 - server - INFO - üîß Calling create_call_session() - START
2025-12-30T20:24:01.714101279Z [err]  2025-12-30 20:24:00,838 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-30T20:24:01.714106655Z [inf]  100.64.0.7:30636 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-30T20:24:01.714112480Z [err]  2025-12-30 20:24:00,925 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-30T20:24:01.714118260Z [err]  2025-12-30 20:24:00,925 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-30T20:24:01.714124826Z [err]  2025-12-30 20:24:00,940 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-30T20:24:01.716299778Z [err]  2025-12-30 20:24:00,940 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-30T20:24:01.716306232Z [err]  2025-12-30 20:24:00,940 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-30T20:24:01.716313624Z [err]  2025-12-30 20:24:00,971 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-30T20:24:01.716321574Z [err]  2025-12-30 20:24:00,972 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-30T20:24:01.716331240Z [err]  2025-12-30 20:24:00,972 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-30T20:24:01.716338167Z [err]  2025-12-30 20:24:01,008 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T20:24:01.716344859Z [err]  2025-12-30 20:24:01,008 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:01.716351737Z [err]  2025-12-30 20:24:01,018 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:01.716358945Z [err]  2025-12-30 20:24:01,019 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-30T20:24:01.716367352Z [err]  2025-12-30 20:24:01,026 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T20:24:01.716375883Z [err]  2025-12-30 20:24:01,036 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 95ms
2025-12-30T20:24:01.716381957Z [err]  2025-12-30 20:24:01,036 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-30T20:24:01.716388432Z [err]  2025-12-30 20:24:01,036 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-30T20:24:01.716394506Z [err]  2025-12-30 20:24:01,043 - redis_service - INFO - üì¶ Stored call data in Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA (TTL: 3600s)
2025-12-30T20:24:01.716766583Z [err]  2025-12-30 20:24:01,043 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-30T20:24:01.716774153Z [err]  2025-12-30 20:24:01,043 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-30T20:24:01.716781234Z [err]  2025-12-30 20:24:01,044 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:01.716788905Z [err]  2025-12-30 20:24:01,044 - server - INFO - ü§ñ AI session created for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:01.716797721Z [err]  2025-12-30 20:24:01,044 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-30T20:24:01.716805833Z [err]  2025-12-30 20:24:01,044 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-30T20:24:01.716813166Z [err]  2025-12-30 20:24:01,044 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-30T20:24:01.716936583Z [err]  2025-12-30 20:24:01,044 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-30T20:24:01.716947659Z [err]  2025-12-30 20:24:01,044 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-30T20:24:01.716955498Z [err]  2025-12-30 20:24:01,045 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-30T20:24:01.716962736Z [err]  2025-12-30 20:24:01,045 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-30T20:24:01.716975874Z [err]  2025-12-30 20:24:01,050 - redis_service - INFO - üì• Retrieved call data from Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:01.719887245Z [err]  2025-12-30 20:24:01,056 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-30T20:24:01.719902633Z [err]  2025-12-30 20:24:01,056 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-30T20:24:01.719916335Z [inf]  100.64.0.8:16108 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T20:24:01.719929052Z [err]  2025-12-30 20:24:01,519 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:02.819833809Z [err]  2025-12-30 20:24:02,022 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:02.819839476Z [err]  2025-12-30 20:24:02,391 - redis_service - INFO - üì• Retrieved call data from Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:02.819843883Z [err]  2025-12-30 20:24:02,396 - redis_service - INFO - üì• Retrieved call data from Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:02.819849881Z [err]  2025-12-30 20:24:02,405 - redis_service - INFO - üì¶ Stored call data in Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA (TTL: 3600s)
2025-12-30T20:24:02.819854725Z [err]  2025-12-30 20:24:02,406 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-30T20:24:02.819859644Z [err]  2025-12-30 20:24:02,406 - core_calling_service - INFO - ‚è±Ô∏è [20:24:02.406] üì• process_user_input() ENTRY - text: '...'
2025-12-30T20:24:02.819863888Z [err]  2025-12-30 20:24:02,410 - redis_service - INFO - üì• Retrieved call data from Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:02.819868295Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - ‚è±Ô∏è [20:24:02.412] ‚è© About to call _process_call_flow_streaming()
2025-12-30T20:24:02.819873584Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - ‚è±Ô∏è [20:24:02.412] üîÄ Agent type: call_flow, calling flow processor...
2025-12-30T20:24:02.819877970Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - ‚è±Ô∏è [20:24:02.412] üîÄ _process_call_flow_streaming() ENTRY
2025-12-30T20:24:02.819884170Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-30T20:24:02.819888605Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - ‚è±Ô∏è [20:24:02.412] ‚úÖ Node selected, about to process content...
2025-12-30T20:24:02.822454747Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - üîß Replaced {{now}} with Tuesday, December 30, 2025 at 3:24 PM EST in content
2025-12-30T20:24:02.822464684Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-30T20:24:02.822473948Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-30T20:24:02.822482954Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-30T20:24:02.822491037Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-30T20:24:02.822500646Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-30T20:24:02.822507959Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-30T20:24:02.822516740Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-30T20:24:02.822524564Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-30T20:24:02.822531556Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-30T20:24:02.822539291Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-30T20:24:02.822602776Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-30T20:24:02.822610544Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-30T20:24:02.824534525Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - ‚è±Ô∏è [20:24:02.412] üìÑ About to process content (mode=script, length=9)
2025-12-30T20:24:02.824543589Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - üîä Silence tracking reset for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA (user responded)
2025-12-30T20:24:02.824553507Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-30T20:24:02.824562907Z [err]  2025-12-30 20:24:02,412 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-30T20:24:02.824576706Z [err]  2025-12-30 20:24:02,413 - core_calling_service - INFO - LLM response (0.01s): Kendrick?
2025-12-30T20:24:02.824586631Z [err]  2025-12-30 20:24:02,413 - core_calling_service - INFO - Total latency: 0.01s
2025-12-30T20:24:02.824595917Z [err]  2025-12-30 20:24:02,413 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-30T20:24:02.824605222Z [err]  2025-12-30 20:24:02,495 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T20:24:02.824614302Z [err]  2025-12-30 20:24:02,496 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '5c7b7d83-b86d-475a-8625-67fec6bcc96c', 'occurred_at': '2025-12-30T20:24:01.923274Z', 'payload': {'call_control_id': 'v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA', 'call_leg_id': '7505eb5e-e5bd-11f0-a989-02420aef991f', 'call_session_id': '7503c9be-e5bd-11f0-abec-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'cq1fjcX36w', 'start_time': '2025-12-30T20:24:01.923274Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T20:24:02.824621195Z [err]  2025-12-30 20:24:02,496 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:02.826169086Z [err]  2025-12-30 20:24:02,496 - server - INFO - üì® ================================================
2025-12-30T20:24:02.826190498Z [inf]  100.64.0.9:36866 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T20:24:02.826197123Z [err]  2025-12-30 20:24:02,515 - redis_service - INFO - üì• Retrieved call data from Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:02.826203429Z [err]  2025-12-30 20:24:02,518 - telnyx_service - INFO - üîä Speaking text on call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA: Kendrick?...
2025-12-30T20:24:02.826209105Z [err]  2025-12-30 20:24:02,518 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T20:24:02.826215433Z [err]  2025-12-30 20:24:02,518 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T20:24:02.826222417Z [err]  2025-12-30 20:24:02,518 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T20:24:02.826229895Z [err]  2025-12-30 20:24:02,518 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T20:24:02.826236105Z [err]  2025-12-30 20:24:02,518 - server - INFO - ‚è±Ô∏è [20:24:02.518] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-30T20:24:02.826241486Z [err]  2025-12-30 20:24:02,518 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-30T20:24:02.826247346Z [err]  2025-12-30 20:24:02,518 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-30T20:24:02.826254176Z [err]  2025-12-30 20:24:02,528 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:02.826260617Z [err]  2025-12-30 20:24:02,611 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T20:24:02.826267896Z [err]  2025-12-30 20:24:02,611 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-30T20:24:02.827457388Z [err]  2025-12-30 20:24:02,611 - server - INFO -    Text length: 9 chars
2025-12-30T20:24:02.827464602Z [err]  2025-12-30 20:24:02,611 - server - INFO -    Text content: 'Kendrick?'
2025-12-30T20:24:02.827471652Z [err]  2025-12-30 20:24:02,611 - server - INFO -    Text bytes: b'Kendrick?'
2025-12-30T20:24:02.827477908Z [err]  2025-12-30 20:24:02,611 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-30T20:24:02.827483241Z [err]  2025-12-30 20:24:02,611 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-30T20:24:02.827489293Z [err]  2025-12-30 20:24:02,611 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-30T20:24:02.827495460Z [err]  2025-12-30 20:24:02,611 - server - INFO -    Full data: {'text': 'Kendrick?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-30T20:24:02.827502772Z [err]  2025-12-30 20:24:02,612 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-30T20:24:02.827509772Z [err]  2025-12-30 20:24:02,612 - server - INFO -    Timeout: 10.0s
2025-12-30T20:24:02.827516526Z [err]  2025-12-30 20:24:02,623 - server - INFO -    ‚úì HTTP client created (0.011s)
2025-12-30T20:24:02.827523277Z [err]  2025-12-30 20:24:02,623 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-30T20:24:02.827529653Z [err]  2025-12-30 20:24:02,769 - server - INFO - üî§ RAW TOKENS: ["Hell"?]
2025-12-30T20:24:02.827538176Z [err]  2025-12-30 20:24:02,772 - core_calling_service - INFO - üîä Silence timer reset for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA (user started speaking)
2025-12-30T20:24:02.827545087Z [err]  2025-12-30 20:24:02,772 - core_calling_service - INFO - üë§ User started speaking for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:02.829452550Z [err]  2025-12-30 20:24:02,772 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-30T20:24:02.829460222Z [err]  2025-12-30 20:24:02,772 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Hell' | Generating: False
2025-12-30T20:24:02.908132247Z [err]  2025-12-30 20:24:02,900 - server - INFO - üî§ RAW TOKENS: ["Hell"‚úì, "o."‚úì, "<end>"‚úì]
2025-12-30T20:24:02.908151279Z [err]  2025-12-30 20:24:02,900 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-30T20:24:02.908173699Z [err]  2025-12-30 20:24:02,900 - server - INFO - üì• FINAL TOKENS: 'Hell o.' (2 tokens)
2025-12-30T20:24:02.908187970Z [err]  2025-12-30 20:24:02,900 - server - INFO - üé§ Soniox final transcript: 'Hell o.'
2025-12-30T20:24:02.908204449Z [err]  2025-12-30 20:24:02,901 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:02.908218299Z [err]  2025-12-30 20:24:02,901 - server - INFO - üîç FILTER CHECK: words=2, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-30T20:24:02.908226348Z [err]  2025-12-30 20:24:02,901 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:02.908236851Z [err]  2025-12-30 20:24:02,901 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-30T20:24:02.908253703Z [err]  2025-12-30 20:24:02,902 - server - INFO - ‚è±Ô∏è [20:24:02.901] üìù FINAL TRANSCRIPT RECEIVED: 'Hell o.'
2025-12-30T20:24:02.908262652Z [err]  2025-12-30 20:24:02,902 - server - INFO - ‚è±Ô∏è [20:24:02.901] STT endpoint detection latency: 14ms
2025-12-30T20:24:02.908275998Z [err]  2025-12-30 20:24:02,902 - server - INFO - ‚è±Ô∏è [20:24:02.901] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-30T20:24:02.908288472Z [err]  2025-12-30 20:24:02,902 - server - INFO - ‚è±Ô∏è User spoke at 1767126242.9021313
2025-12-30T20:24:02.912376509Z [err]  2025-12-30 20:24:02,903 - redis_service - INFO - üì¶ Stored call data in Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA (TTL: 3600s)
2025-12-30T20:24:02.912406966Z [err]  2025-12-30 20:24:02,903 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-30T20:24:02.912426366Z [err]  2025-12-30 20:24:02,903 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:02.912438738Z [err]  2025-12-30 20:24:02,903 - server - INFO - ‚úÖ Agent SILENT - User said 2 word(s): 'Hell o.' - Processing...
2025-12-30T20:24:02.923899835Z [err]  2025-12-30 20:24:02,917 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Hell o.
2025-12-30T20:24:02.923906624Z [err]  2025-12-30 20:24:02,917 - core_calling_service - INFO - üë§ User stopped speaking for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:02.923915977Z [err]  2025-12-30 20:24:02,917 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-30T20:24:02.923923134Z [err]  2025-12-30 20:24:02,917 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+10ms
2025-12-30T20:24:02.923936479Z [err]  2025-12-30 20:24:02,917 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 10ms (Soniox model: stt-rt-v3)
2025-12-30T20:24:02.923945594Z [err]  2025-12-30 20:24:02,917 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-30T20:24:02.923951617Z [err]  2025-12-30 20:24:02,917 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-30T20:24:02.923958351Z [err]  2025-12-30 20:24:02,917 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:03.704027199Z [err]  2025-12-30 20:24:02,980 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-30T20:24:03.704038751Z [err]  2025-12-30 20:24:02,987 - server - INFO -    ‚úì FIRST CHUNK received (0.373s, 992 bytes) [TARGET: <300ms]
2025-12-30T20:24:03.704047432Z [err]  2025-12-30 20:24:02,990 - server - INFO -    ‚úì ALL CHUNKS received: 54 chunks (0.378s)
2025-12-30T20:24:03.704054960Z [err]  2025-12-30 20:24:02,990 - server - INFO -    ‚úì Total audio size: 13419 bytes
2025-12-30T20:24:03.704123371Z [err]  2025-12-30 20:24:02,980 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-30T20:24:03.704130394Z [err]  2025-12-30 20:24:02,980 - server - INFO -    ‚úì Connection established (0.368s) [TARGET: <200ms]
2025-12-30T20:24:03.704137672Z [err]  2025-12-30 20:24:02,980 - server - INFO -    ‚úì Response status: 200
2025-12-30T20:24:03.704329279Z [err]  2025-12-30 20:24:02,990 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-30T20:24:03.704351084Z [err]  2025-12-30 20:24:02,990 - server - INFO -       - Connection: 368ms
2025-12-30T20:24:03.704359902Z [err]  2025-12-30 20:24:02,990 - server - INFO -       - First chunk: 373ms
2025-12-30T20:24:03.704368952Z [err]  2025-12-30 20:24:02,990 - server - INFO -       - All chunks: 378ms
2025-12-30T20:24:03.704379502Z [err]  2025-12-30 20:24:02,990 - server - INFO -       - Audio generation only: 5ms
2025-12-30T20:24:03.704388228Z [err]  2025-12-30 20:24:02,990 - server - INFO - ‚è±Ô∏è [20:24:02.990] üîä TTS COMPLETE: 472ms, audio_size=13419 bytes
2025-12-30T20:24:03.704395248Z [err]  2025-12-30 20:24:02,990 - server - INFO - üíæ TTS CACHED: elevenlabs:Kendrick?... (13419 bytes)
2025-12-30T20:24:03.704403128Z [err]  2025-12-30 20:24:02,990 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.47s
2025-12-30T20:24:03.708838280Z [err]  2025-12-30 20:24:02,990 - telnyx_service - INFO - ‚úÖ Generated 13419 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-30T20:24:03.710162031Z [err]  2025-12-30 20:24:02,990 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-30T20:24:03.710170334Z [err]  2025-12-30 20:24:03,013 - server - INFO - üìù Saved user transcript to database
2025-12-30T20:24:03.710181892Z [err]  2025-12-30 20:24:03,013 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:03.710191887Z [err]  2025-12-30 20:24:03,013 - core_calling_service - INFO - ‚è±Ô∏è [20:24:03.013] üì• process_user_input() ENTRY - text: 'Hell o....'
2025-12-30T20:24:03.710200631Z [err]  2025-12-30 20:24:03,014 - redis_service - INFO - üì• Retrieved call data from Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:03.710209352Z [err]  2025-12-30 20:24:03,014 - core_calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA: User spoke while Silence Greeting was triggering
2025-12-30T20:24:03.710217951Z [err]  2025-12-30 20:24:03,054 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T20:24:03.710226206Z [err]  2025-12-30 20:24:03,054 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:03.710297702Z [err]  2025-12-30 20:24:03,072 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:03.710306450Z [err]  2025-12-30 20:24:03,072 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:03.710328654Z [err]  2025-12-30 20:24:03,317 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA/actions/playback_stop "HTTP/1.1 200 OK"
2025-12-30T20:24:03.711874766Z [err]  2025-12-30 20:24:03,318 - telnyx_service - INFO - ‚úÖ Successfully stopped audio playback
2025-12-30T20:24:03.711881991Z [err]  2025-12-30 20:24:03,318 - core_calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-30T20:24:03.711889684Z [err]  2025-12-30 20:24:03,318 - core_calling_service - INFO - ‚úÖ BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-30T20:24:03.711895234Z [err]  2025-12-30 20:24:03,320 - redis_service - INFO - üì• Retrieved call data from Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:03.711901588Z [err]  2025-12-30 20:24:03,322 - redis_service - INFO - üì¶ Stored call data in Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA (TTL: 3600s)
2025-12-30T20:24:03.711907297Z [err]  2025-12-30 20:24:03,322 - core_calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-30T20:24:03.711913492Z [err]  2025-12-30 20:24:03,322 - core_calling_service - INFO - ‚è±Ô∏è [20:24:03.322] ‚è© About to call _process_call_flow_streaming()
2025-12-30T20:24:03.711918318Z [err]  2025-12-30 20:24:03,322 - core_calling_service - INFO - ‚è±Ô∏è [20:24:03.322] üîÄ Agent type: call_flow, calling flow processor...
2025-12-30T20:24:03.711923256Z [err]  2025-12-30 20:24:03,322 - core_calling_service - INFO - ‚è±Ô∏è [20:24:03.322] üîÄ _process_call_flow_streaming() ENTRY
2025-12-30T20:24:03.711928669Z [err]  2025-12-30 20:24:03,322 - core_calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-30T20:24:03.711933561Z [err]  2025-12-30 20:24:03,322 - core_calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-30T20:24:03.711937957Z [err]  2025-12-30 20:24:03,322 - core_calling_service - INFO - ‚è±Ô∏è [20:24:03.322] üîÄ About to call _follow_transition() for: Hell o....
2025-12-30T20:24:03.711943612Z [err]  2025-12-30 20:24:03,322 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Hell o.
2025-12-30T20:24:03.715663567Z [err]  2025-12-30 20:24:03,322 - core_calling_service - INFO - üîç Checking 'Hello=Yes' override [DEPLOYMENT VERIFIED] for msg='hell o' on node='Greeting'
2025-12-30T20:24:03.715673641Z [err]  2025-12-30 20:24:03,322 - core_calling_service - WARNING - ‚ö†Ô∏è Auto-transition after response target not found: None, falling back to normal evaluation
2025-12-30T20:24:03.715681105Z [err]  2025-12-30 20:24:03,334 - core_calling_service - INFO - ‚è±Ô∏è [20:24:03.334] üîÄ TRANSITION EVALUATION START - Calling LLM for 2 options
2025-12-30T20:24:03.715688313Z [err]  2025-12-30 20:24:03,564 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-30T20:24:03.715694209Z [err]  2025-12-30 20:24:03,565 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.57s
2025-12-30T20:24:03.715702094Z [err]  2025-12-30 20:24:03,565 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 1.05s
2025-12-30T20:24:03.715708887Z [err]  2025-12-30 20:24:03,565 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-30T20:24:03.715723647Z [err]  2025-12-30 20:24:03,566 - telnyx_service - INFO - üé¨ Playback ID: Jx8GoEqb6A
2025-12-30T20:24:03.715730825Z [err]  2025-12-30 20:24:03,566 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-30T20:24:03.715736800Z [err]  2025-12-30 20:24:03,566 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Greeting playback started at 1767126243.5662403
2025-12-30T20:24:03.715741785Z [err]  2025-12-30 20:24:03,566 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-30T20:24:03.715747801Z [err]  2025-12-30 20:24:03,574 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:03.715752989Z [err]  2025-12-30 20:24:03,574 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:03.716387921Z [inf]  100.64.0.10:35732 - "GET /api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3 HTTP/1.1" 200
2025-12-30T20:24:03.716393165Z [err]  2025-12-30 20:24:03,704 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T20:24:03.716403102Z [err]  2025-12-30 20:24:03,704 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': 'd80a74da-6577-4060-8a74-2cc4b9831547', 'occurred_at': '2025-12-30T20:24:03.583270Z', 'payload': {'call_control_id': 'v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA', 'call_leg_id': '7505eb5e-e5bd-11f0-a989-02420aef991f', 'call_session_id': '7503c9be-e5bd-11f0-abec-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T20:24:03.716408999Z [err]  2025-12-30 20:24:03,704 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:03.716414742Z [err]  2025-12-30 20:24:03,704 - server - INFO - üì® ================================================
2025-12-30T20:24:03.716420385Z [inf]  100.64.0.8:16108 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T20:24:04.780160962Z [err]  2025-12-30 20:24:04,254 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T20:24:04.780177518Z [err]  2025-12-30 20:24:04,255 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': 'b5970f4b-9025-4b48-a99f-42c02b300cc3', 'occurred_at': '2025-12-30T20:24:03.983288Z', 'payload': {'call_control_id': 'v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA', 'call_leg_id': '7505eb5e-e5bd-11f0-a989-02420aef991f', 'call_session_id': '7503c9be-e5bd-11f0-abec-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'Jx8GoEqb6A'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T20:24:04.780191110Z [err]  2025-12-30 20:24:04,077 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:04.780191157Z [err]  2025-12-30 20:24:04,255 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:04.780203409Z [err]  2025-12-30 20:24:04,255 - server - INFO - üì® ================================================
2025-12-30T20:24:04.780204679Z [err]  2025-12-30 20:24:04,077 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:04.780213019Z [inf]  100.64.0.8:16108 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T20:24:04.780221671Z [err]  2025-12-30 20:24:04,257 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-30T20:24:04.780230017Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - ‚è±Ô∏è [20:24:04.268] üîÄ TRANSITION EVALUATION COMPLETE - took 933ms
2025-12-30T20:24:04.793457067Z [err]  2025-12-30 20:24:04,269 - core_calling_service - INFO - üîÑ Dynamic rephrase enabled - generating natural variation of script
2025-12-30T20:24:04.793471444Z [err]  2025-12-30 20:24:04,579 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:04.793479635Z [err]  2025-12-30 20:24:04,579 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:04.793569464Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - ü§ñ AI transition decision: '-1'
2025-12-30T20:24:04.793577812Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - üìä Available transitions: ['Confirms name (Yes|Speaking|This is he/she) OR Ask...', 'Wrong number (No John here|Wrong number|etc) - don...']
2025-12-30T20:24:04.793584922Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - Selected transition index: -1
2025-12-30T20:24:04.793593694Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - No specific condition matched, looking for default transition...
2025-12-30T20:24:04.793601712Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - ‚ö†Ô∏è No transition matched, but node has GOAL. Staying on current node to continue with goal-based guidance.
2025-12-30T20:24:04.793631341Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - üéØ Goal: Find out if your speaking to the right person....
2025-12-30T20:24:04.793641605Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 945ms
2025-12-30T20:24:04.793649752Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - ‚è±Ô∏è [20:24:04.268] ‚úÖ Node selected, about to process content...
2025-12-30T20:24:04.793657534Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - üîß Replaced {{now}} with Tuesday, December 30, 2025 at 3:24 PM EST in content
2025-12-30T20:24:04.793664790Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-30T20:24:04.793672958Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-30T20:24:04.793680195Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-30T20:24:04.793690112Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-30T20:24:04.794987556Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-30T20:24:04.794995462Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-30T20:24:04.795004618Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-30T20:24:04.795012627Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-30T20:24:04.795020666Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-30T20:24:04.795028442Z [err]  2025-12-30 20:24:04,268 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-30T20:24:04.795036877Z [err]  2025-12-30 20:24:04,269 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-30T20:24:04.795045652Z [err]  2025-12-30 20:24:04,269 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-30T20:24:04.795053298Z [err]  2025-12-30 20:24:04,269 - core_calling_service - INFO - ‚è±Ô∏è [20:24:04.269] üìÑ About to process content (mode=script, length=9)
2025-12-30T20:24:04.811595635Z [err]  2025-12-30 20:24:04,809 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-30T20:24:04.814956709Z [err]  2025-12-30 20:24:04,810 - server - INFO - üì§ Sentence arrived from LLM: Yeah, {{customer_name}}?...
2025-12-30T20:24:04.814974595Z [err]  2025-12-30 20:24:04,811 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 1893ms
2025-12-30T20:24:04.814983716Z [err]  2025-12-30 20:24:04,811 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-30T20:24:04.814994565Z [err]  2025-12-30 20:24:04,811 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:04.815002182Z [err]  2025-12-30 20:24:04,811 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-30T20:24:04.903372117Z [err]  2025-12-30 20:24:04,899 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T20:24:05.735431844Z [err]  2025-12-30 20:24:04,987 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T20:24:05.735438010Z [err]  2025-12-30 20:24:05,075 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T20:24:05.735443852Z [err]  2025-12-30 20:24:05,103 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T20:24:05.735451387Z [err]  2025-12-30 20:24:05,103 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-30T20:24:05.735458046Z [err]  2025-12-30 20:24:05,103 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-30T20:24:05.735464433Z [err]  2025-12-30 20:24:05,103 - persistent_tts_service - INFO - üîå [Call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA] Establishing persistent TTS WebSocket...
2025-12-30T20:24:05.735484331Z [err]  2025-12-30 20:24:05,103 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-30T20:24:05.735493386Z [err]  2025-12-30 20:24:05,103 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-30T20:24:05.735499462Z [err]  2025-12-30 20:24:05,103 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-30T20:24:05.735508565Z [err]  2025-12-30 20:24:05,114 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:05.735519789Z [err]  2025-12-30 20:24:05,114 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:t-F_cvM6swvzpdQ6y... (active sessions: [])
2025-12-30T20:24:05.737431393Z [err]  2025-12-30 20:24:05,239 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-30T20:24:05.737451821Z [err]  2025-12-30 20:24:05,239 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-30T20:24:05.737463240Z [err]  2025-12-30 20:24:05,239 - core_calling_service - INFO - LLM response (2.23s): Yeah, {{customer_name}}?
2025-12-30T20:24:05.737470966Z [err]  2025-12-30 20:24:05,239 - core_calling_service - INFO - Total latency: 2.23s
2025-12-30T20:24:05.737480518Z [err]  2025-12-30 20:24:05,242 - server - INFO - ‚úÖ LLM finished in 2324ms, TTS tasks already running in background
2025-12-30T20:24:05.737490520Z [err]  2025-12-30 20:24:05,242 - server - INFO - üéµ Streaming 1 TTS chunks as they complete...
2025-12-30T20:24:05.737502264Z [err]  2025-12-30 20:24:05,242 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-30T20:24:05.737502334Z [err]  2025-12-30 20:24:05,238 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-30T20:24:05.737508262Z [err]  2025-12-30 20:24:05,239 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-30T20:24:05.737516653Z [err]  2025-12-30 20:24:05,239 - persistent_tts_service - INFO - ‚úÖ [Call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA] Persistent TTS WebSocket established
2025-12-30T20:24:05.737518703Z [err]  2025-12-30 20:24:05,242 - server - INFO -    1 sentences queued and playing seamlessly
2025-12-30T20:24:05.737523742Z [err]  2025-12-30 20:24:05,239 - persistent_tts_service - INFO - üéß [Call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA] Audio receiver loop started
2025-12-30T20:24:05.737529692Z [err]  2025-12-30 20:24:05,239 - persistent_tts_service - INFO - üîä [Call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA] Comfort noise loop started
2025-12-30T20:24:05.737534911Z [err]  2025-12-30 20:24:05,239 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:05.737540070Z [err]  2025-12-30 20:24:05,242 - persistent_tts_service - INFO - üéµ [Call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA] Playback consumer started
2025-12-30T20:24:05.737545451Z [err]  2025-12-30 20:24:05,239 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-30T20:24:05.737554396Z [err]  2025-12-30 20:24:05,239 - server - INFO - üîç Persistent TTS lookup: call_id=v3:t-F_cvM6swvzpdQ6y..., session=FOUND
2025-12-30T20:24:05.737557303Z [err]  2025-12-30 20:24:05,242 - persistent_tts_service - INFO - üéß [Call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA] Audio Receiver Loop STARTED
2025-12-30T20:24:05.737562099Z [err]  2025-12-30 20:24:05,239 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-30T20:24:05.737570697Z [err]  2025-12-30 20:24:05,239 - server - INFO - üéµ TTS task #1 started at +428ms
2025-12-30T20:24:05.737572534Z [err]  2025-12-30 20:24:05,242 - persistent_tts_service - INFO - üíì [Call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA] Starting TTS keep-alive loop (every 15s)
2025-12-30T20:24:05.737579801Z [err]  2025-12-30 20:24:05,239 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 2321ms
2025-12-30T20:24:05.737586340Z [err]  2025-12-30 20:24:05,243 - persistent_tts_service - INFO - üîä [Call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA] Starting comfort noise loop
2025-12-30T20:24:05.737589985Z [err]  2025-12-30 20:24:05,239 - core_calling_service - INFO - üîÑ Rephrased script: Yeah, {{customer_name}}?...
2025-12-30T20:24:05.737600991Z [err]  2025-12-30 20:24:05,243 - persistent_tts_service - INFO - üé§ [Call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA] Streaming sentence #1: Yeah, {{customer_name}}?...
2025-12-30T20:24:05.737603244Z [err]  2025-12-30 20:24:05,239 - core_calling_service - INFO - üîä Silence tracking reset for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA (user responded)
2025-12-30T20:24:05.739156686Z [err]  2025-12-30 20:24:05,243 - persistent_tts_service - INFO - üöÄ [Call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-30T20:24:05.739166539Z [err]  2025-12-30 20:24:05,243 - persistent_tts_service - INFO - üìä [Call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-30T20:24:05.739172879Z [err]  2025-12-30 20:24:05,243 - persistent_tts_service - INFO - üéß [Call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA] Receiver processing sentence #1: 'Yeah, {{customer_name}}?...'
2025-12-30T20:24:05.739177880Z [err]  2025-12-30 20:24:05,243 - persistent_tts_service - INFO - üìä [Call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA] DIAGNOSTIC: queue_latency=0ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-30T20:24:05.739182068Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚úÖ All 1 persistent TTS streams completed
2025-12-30T20:24:05.739187188Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-30T20:24:05.739191469Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 2325ms from user stop üöÄ
2025-12-30T20:24:05.739196366Z [err]  2025-12-30 20:24:05,243 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:05.739200765Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-30T20:24:05.739204982Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T20:24:05.739209560Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-30T20:24:05.743085358Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 10ms (provider: soniox, model: stt-rt-v3)
2025-12-30T20:24:05.743091154Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 2324ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-30T20:24:05.743096611Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 432ms (provider: elevenlabs, websocket: False)
2025-12-30T20:24:05.743101907Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 2326ms (user stopped ‚Üí play_audio_url called)
2025-12-30T20:24:05.743107254Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-30T20:24:05.743112436Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-30T20:24:05.743118648Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-30T20:24:05.743124070Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-30T20:24:05.743130774Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-30T20:24:05.743135726Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 2626ms estimated
2025-12-30T20:24:05.743141353Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 24 chars, 1 sentences
2025-12-30T20:24:05.743147207Z [err]  2025-12-30 20:24:05,243 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Hell o....'
2025-12-30T20:24:05.743153322Z [err]  2025-12-30 20:24:05,244 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: 'Yeah, {{customer_name}}?...'
2025-12-30T20:24:05.743158238Z [err]  2025-12-30 20:24:05,244 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-30T20:24:05.746872801Z [err]  2025-12-30 20:24:05,244 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T20:24:05.746884446Z [err]  2025-12-30 20:24:05,258 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T20:24:05.746891604Z [err]  2025-12-30 20:24:05,259 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'f6ae8e46-9453-4a9a-bd36-1bea88e3195c', 'occurred_at': '2025-12-30T20:24:04.823270Z', 'payload': {'call_control_id': 'v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA', 'call_leg_id': '7505eb5e-e5bd-11f0-a989-02420aef991f', 'call_session_id': '7503c9be-e5bd-11f0-abec-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'Jx8GoEqb6A', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T20:24:05.746897811Z [err]  2025-12-30 20:24:05,259 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:05.746906492Z [err]  2025-12-30 20:24:05,259 - server - INFO - üì® ================================================
2025-12-30T20:24:05.746917789Z [err]  2025-12-30 20:24:05,260 - redis_service - INFO - ‚ûñ Removed playback Jx8GoEqb6A, 0 remaining for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:05.746923442Z [err]  2025-12-30 20:24:05,260 - server - INFO - üîä Redis: Removed playback Jx8GoEqb6A, 0 remaining
2025-12-30T20:24:05.746933100Z [err]  2025-12-30 20:24:05,260 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-30T20:24:05.746939583Z [err]  2025-12-30 20:24:05,260 - server - INFO - ‚è±Ô∏è CLEARED playback_expected_end_time - agent is definitely done speaking
2025-12-30T20:24:05.749799215Z [err]  2025-12-30 20:24:05,516 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-30T20:24:05.749803005Z [err]  2025-12-30 20:24:05,261 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-30T20:24:05.749811884Z [err]  2025-12-30 20:24:05,261 - server - INFO - ‚úÖ Found session locally: agent_speaking=True, user_speaking=False
2025-12-30T20:24:05.749819912Z [err]  2025-12-30 20:24:05,261 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767126245.26143 for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:05.749827613Z [err]  2025-12-30 20:24:05,261 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:05.749835117Z [err]  2025-12-30 20:24:05,261 - server - INFO - ‚è±Ô∏è Agent done speaking, silence timer STARTED (local)
2025-12-30T20:24:05.749846898Z [inf]  100.64.0.11:38130 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T20:24:05.749855892Z [err]  2025-12-30 20:24:05,433 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 2766ms)
2025-12-30T20:24:05.749863272Z [err]  2025-12-30 20:24:05,433 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-30T20:24:05.749868998Z [err]  2025-12-30 20:24:05,433 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-30T20:24:05.749876665Z [err]  2025-12-30 20:24:05,516 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 273ms
2025-12-30T20:24:05.749883064Z [err]  2025-12-30 20:24:05,516 - persistent_tts_service - INFO - üì§ Sending 12244 bytes of audio (77 chunks, 1.5s duration) via WebSocket
2025-12-30T20:24:05.752356038Z [err]  2025-12-30 20:24:05,516 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.5s (total: 1.5s from now)
2025-12-30T20:24:05.752367031Z [err]  2025-12-30 20:24:05,517 - persistent_tts_service - INFO - ‚úÖ Sent 77 audio chunks via WebSocket
2025-12-30T20:24:05.752372305Z [err]  2025-12-30 20:24:05,615 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (1.4s left)
2025-12-30T20:24:06.734240667Z [err]  2025-12-30 20:24:06,027 - server - INFO - üì§ Audio flowing: 338 packets sent to Soniox (5s update)
2025-12-30T20:24:07.762374412Z [err]  2025-12-30 20:24:07,347 - persistent_tts_service - INFO - üîá [Call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA] FLOOR RELEASED (is_holding_floor=False)
2025-12-30T20:24:07.765628975Z [err]  2025-12-30 20:24:07,516 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-30T20:24:07.765638991Z [err]  2025-12-30 20:24:07,517 - persistent_tts_service - INFO - ‚úÖ [Call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA] Receiver finished sentence #1: 1 chunks in 2273ms
2025-12-30T20:24:10.578240316Z [err]  2025-12-30 20:24:10,127 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=4.9s, checkin_count=0/2
2025-12-30T20:24:10.632566588Z [err]  2025-12-30 20:24:10,628 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=5.4s, checkin_count=0/2
2025-12-30T20:24:10.756406318Z [err]  2025-12-30 20:24:10,728 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 567 total packets
2025-12-30T20:24:10.756422773Z [err]  [2025-12-30 20:24:10 +0000] [3] [INFO] connection closed
2025-12-30T20:24:11.599813345Z [err]  2025-12-30 20:24:11,055 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': 'fd618ccf-0908-4df6-a294-b2d1895c0e26', 'occurred_at': '2025-12-30T20:24:10.652080Z', 'payload': {'call_control_id': 'v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA', 'call_leg_id': '7505eb5e-e5bd-11f0-a989-02420aef991f', 'call_session_id': '7503c9be-e5bd-11f0-abec-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '7b624a0a-8b35-4f62-a764-7ec4e7180b2f', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T20:24:11.599824406Z [err]  2025-12-30 20:24:11,055 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:11.600126324Z [err]  2025-12-30 20:24:11,055 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T20:24:11.605857931Z [err]  2025-12-30 20:24:11,055 - server - INFO - üì® ================================================
2025-12-30T20:24:11.605874436Z [inf]  100.64.0.12:54144 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T20:24:11.605885624Z [err]  2025-12-30 20:24:11,099 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T20:24:11.605895949Z [err]  2025-12-30 20:24:11,099 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '51fa9f75-8fd6-4563-8a0f-15977b1e89d6', 'occurred_at': '2025-12-30T20:24:10.603280Z', 'payload': {'call_control_id': 'v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA', 'call_leg_id': '7505eb5e-e5bd-11f0-a989-02420aef991f', 'call_session_id': '7503c9be-e5bd-11f0-abec-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T20:24:10.603280Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'cq1fjcX36w', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T20:24:11.605917031Z [err]  2025-12-30 20:24:11,099 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:11.605925905Z [err]  2025-12-30 20:24:11,099 - server - INFO - üì® ================================================
2025-12-30T20:24:11.605935053Z [err]  2025-12-30 20:24:11,102 - redis_service - INFO - ‚ûñ Removed playback cq1fjcX36w, 0 remaining for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:11.605942929Z [err]  2025-12-30 20:24:11,102 - server - INFO - üîä Redis: Removed playback cq1fjcX36w, 0 remaining
2025-12-30T20:24:11.606057215Z [err]  2025-12-30 20:24:11,102 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-30T20:24:11.606070271Z [err]  2025-12-30 20:24:11,103 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-30T20:24:11.606079325Z [err]  2025-12-30 20:24:11,103 - server - INFO - ‚úÖ Found session in active_telnyx_calls (local worker)
2025-12-30T20:24:11.606091245Z [err]  2025-12-30 20:24:11,103 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767126251.10327 for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:11.606148910Z [err]  2025-12-30 20:24:11,103 - server - INFO - ‚è±Ô∏è Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-30T20:24:11.606158246Z [inf]  100.64.0.10:51692 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T20:24:11.606165607Z [err]  2025-12-30 20:24:11,133 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T20:24:11.606173898Z [err]  2025-12-30 20:24:11,133 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': 'aae35855-7fbb-49dc-919e-7480c7ca8444', 'occurred_at': '2025-12-30T20:24:10.523274Z', 'payload': {'call_control_id': 'v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA', 'call_leg_id': '7505eb5e-e5bd-11f0-a989-02420aef991f', 'call_quality_stats': {'inbound': {'jitter_max_variance': '0.00', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '591', 'skip_packet_count': '17'}, 'outbound': {'packet_count': '567', 'skip_packet_count': '0'}}, 'call_session_id': '7503c9be-e5bd-11f0-abec-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T20:24:10.523274Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-30T20:23:52.563274Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T20:24:11.606386137Z [err]  2025-12-30 20:24:11,133 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:11.606395944Z [err]  2025-12-30 20:24:11,133 - server - INFO - üì® ================================================
2025-12-30T20:24:11.606505327Z [err]  2025-12-30 20:24:11,134 - server - INFO - üìû Call ended: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:11.606513842Z [err]  2025-12-30 20:24:11,134 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-30T20:24:11.606526919Z [err]  2025-12-30 20:24:11,315 - server - INFO - üìù Updated call log: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:11.606535462Z [err]  2025-12-30 20:24:11,407 - server - INFO - ‚úÖ Finalized call log: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA (duration=12s, status=completed)
2025-12-30T20:24:11.606586785Z [err]  2025-12-30 20:24:11,499 - server - INFO - üì¶ Saved 11 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-30T20:24:12.781303353Z [err]  2025-12-30 20:24:12,151 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T20:24:12.781310264Z [err]  2025-12-30 20:24:12,151 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': 'ab4801b6-a899-4ca7-8f01-3e8ad25b6cbf', 'occurred_at': '2025-12-30T20:24:11.792719Z', 'payload': {'call_control_id': 'v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA', 'call_leg_id': '7505eb5e-e5bd-11f0-a989-02420aef991f', 'call_session_id': '7503c9be-e5bd-11f0-abec-02420aef991f', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T20:24:10.607741Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-30T20:24:10.607741Z', 'recording_id': '78d19f15-c2a1-41e9-bb48-7903944b31d6', 'recording_started_at': '2025-12-30T20:24:00.732349Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-30/7505eb5e-e5bd-11f0-a989-02420aef991f-1767126240707286.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251230%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251230T202411Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=ae7ecba3f14d696334e31ce36a747d5780f0a21f71515435765bcf659f03e813'}, 'start_time': '2025-12-30T20:24:00.732349Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T20:24:12.781316293Z [err]  2025-12-30 20:24:12,151 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:12.781322750Z [err]  2025-12-30 20:24:12,151 - server - INFO - üì® ================================================
2025-12-30T20:24:12.781330939Z [err]  2025-12-30 20:24:12,151 - server - INFO - üéôÔ∏è Recording saved for call: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:12.781337547Z [err]  2025-12-30 20:24:12,152 - redis_service - INFO - üì• Retrieved call data from Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:12.781436882Z [err]  2025-12-30 20:24:12,152 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=78d19f15-c2a1-41e9-bb48-7903944b31d6, call_data=True
2025-12-30T20:24:12.781444410Z [err]  2025-12-30 20:24:12,188 - server - INFO - üìä Auto-added call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-30T20:24:12.781495340Z [err]  2025-12-30 20:24:12,369 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-30T20:24:12.781496824Z [err]  2025-12-30 20:24:12,367 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T20:24:12.781504549Z [err]  2025-12-30 20:24:12,368 - redis_service - INFO - üì• Retrieved call data from Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:12.781506317Z [err]  2025-12-30 20:24:12,459 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-30T20:24:12.781509821Z [err]  2025-12-30 20:24:12,545 - server - INFO - üöÄ Triggered QC analysis for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:12.781513689Z [err]  2025-12-30 20:24:12,369 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-30T20:24:12.781516751Z [err]  2025-12-30 20:24:12,545 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-30T20:24:12.781523746Z [err]  2025-12-30 20:24:12,545 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-30T20:24:12.781532864Z [err]  2025-12-30 20:24:12,545 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-30T20:24:12.782618016Z [err]  2025-12-30 20:24:12,547 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-30T20:24:12.782628733Z [err]  2025-12-30 20:24:12,549 - server - INFO - üìá CRM update starting for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T20:24:12.782678521Z [err]  2025-12-30 20:24:12,545 - server - INFO - üìä Triggered Campaign QC for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:12.782685099Z [err]  2025-12-30 20:24:12,549 - server - INFO - üìá Normalized phone: +17708336397
2025-12-30T20:24:12.782686512Z [err]  2025-12-30 20:24:12,545 - server - INFO - üìá Triggered CRM update for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:12.782693530Z [err]  2025-12-30 20:24:12,549 - server - INFO - üìá CRM: Got 11 variables from active session
2025-12-30T20:24:12.782694405Z [err]  2025-12-30 20:24:12,545 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:12.782701404Z [err]  2025-12-30 20:24:12,546 - redis_service - INFO - üßπ Deleted call data from Redis: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:12.782702374Z [err]  2025-12-30 20:24:12,562 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T20:24:12.782708109Z [err]  2025-12-30 20:24:12,547 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:12.782715899Z [inf]  100.64.0.10:51708 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T20:24:12.782723152Z [err]  2025-12-30 20:24:12,547 - server - INFO - üîç Starting QC analysis for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:12.787708876Z [err]  2025-12-30 20:24:12,563 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-30T20:24:12.787719034Z [err]  2025-12-30 20:24:12,634 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.4s silence (threshold: 7s)
2025-12-30T20:24:12.787725822Z [err]  2025-12-30 20:24:12,635 - core_calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-30T20:24:12.787731875Z [err]  2025-12-30 20:24:12,635 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.4s silence: Are you still there?
2025-12-30T20:24:12.787738180Z [err]  2025-12-30 20:24:12,635 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:12.787744952Z [err]  2025-12-30 20:24:12,635 - telnyx_service - INFO - üîä Speaking text on call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA: Are you still there?...
2025-12-30T20:24:12.787756476Z [err]  2025-12-30 20:24:12,635 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T20:24:12.787763249Z [err]  2025-12-30 20:24:12,635 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T20:24:12.787771181Z [err]  2025-12-30 20:24:12,635 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T20:24:12.787777748Z [err]  2025-12-30 20:24:12,635 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T20:24:12.787783554Z [err]  2025-12-30 20:24:12,635 - server - INFO - ‚è±Ô∏è [20:24:12.635] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-30T20:24:12.787789539Z [err]  2025-12-30 20:24:12,635 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-30T20:24:12.787796401Z [err]  2025-12-30 20:24:12,635 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-30T20:24:12.787803805Z [err]  2025-12-30 20:24:12,637 - server - INFO - üìù Converted transcript from 3 messages to 70 characters
2025-12-30T20:24:12.788208876Z [err]  2025-12-30 20:24:12,709 - server - INFO - üíæ Saved recording URL and ID to database: 78d19f15-c2a1-41e9-bb48-7903944b31d6
2025-12-30T20:24:12.788216371Z [err]  2025-12-30 20:24:12,709 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-30T20:24:12.788224080Z [err]  2025-12-30 20:24:12,709 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-30T20:24:12.788230970Z [err]  2025-12-30 20:24:12,734 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T20:24:12.788238304Z [err]  2025-12-30 20:24:12,735 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T20:24:12.788260539Z [err]  2025-12-30 20:24:12,735 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-30T20:24:12.788268232Z [err]  2025-12-30 20:24:12,735 - server - INFO -    Text length: 20 chars
2025-12-30T20:24:12.788275888Z [err]  2025-12-30 20:24:12,735 - server - INFO -    Text content: 'Are you still there?'
2025-12-30T20:24:12.788282918Z [err]  2025-12-30 20:24:12,735 - server - INFO -    Text bytes: b'Are you still there?'
2025-12-30T20:24:12.788290561Z [err]  2025-12-30 20:24:12,735 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-30T20:24:12.788298031Z [err]  2025-12-30 20:24:12,735 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-30T20:24:12.788305593Z [err]  2025-12-30 20:24:12,735 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-30T20:24:12.788312243Z [err]  2025-12-30 20:24:12,735 - server - INFO -    Full data: {'text': 'Are you still there?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-30T20:24:12.788319539Z [err]  2025-12-30 20:24:12,735 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-30T20:24:12.793535811Z [err]  2025-12-30 20:24:12,735 - server - INFO -    Timeout: 10.0s
2025-12-30T20:24:12.793548715Z [err]  2025-12-30 20:24:12,746 - server - INFO -    ‚úì HTTP client created (0.011s)
2025-12-30T20:24:12.793559829Z [err]  2025-12-30 20:24:12,746 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-30T20:24:12.826896290Z [err]  2025-12-30 20:24:12,820 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-30T20:24:12.913518008Z [err]  2025-12-30 20:24:12,907 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-30T20:24:12.913540333Z [err]  2025-12-30 20:24:12,908 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T20:24:12.913554386Z [err]  2025-12-30 20:24:12,908 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:13.744812656Z [err]  2025-12-30 20:24:13,013 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-30/7505eb5e-e5bd-11f0-a989-02420aef991f-1767126240707286.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251230%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251230T202411Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=ae7ecba3f14d696334e31ce36a747d5780f0a21f71515435765bcf659f03e813 "HTTP/1.1 200 OK"
2025-12-30T20:24:13.744818877Z [err]  2025-12-30 20:24:13,092 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-30T20:24:13.744825712Z [err]  2025-12-30 20:24:13,092 - server - INFO -    ‚úì Connection established (0.357s) [TARGET: <200ms]
2025-12-30T20:24:13.744832011Z [err]  2025-12-30 20:24:13,092 - server - INFO -    ‚úì Response status: 200
2025-12-30T20:24:13.744838770Z [err]  2025-12-30 20:24:13,092 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-30T20:24:13.744845470Z [err]  2025-12-30 20:24:13,097 - server - INFO - ‚úÖ Downloaded 39958 bytes
2025-12-30T20:24:13.744851535Z [err]  2025-12-30 20:24:13,113 - server - INFO -    ‚úì FIRST CHUNK received (0.378s, 1153 bytes) [TARGET: <300ms]
2025-12-30T20:24:13.744859820Z [err]  2025-12-30 20:24:13,115 - server - INFO -    ‚úì ALL CHUNKS received: 51 chunks (0.380s)
2025-12-30T20:24:13.744867240Z [err]  2025-12-30 20:24:13,115 - server - INFO -    ‚úì Total audio size: 17181 bytes
2025-12-30T20:24:13.744874480Z [err]  2025-12-30 20:24:13,115 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-30T20:24:13.744882280Z [err]  2025-12-30 20:24:13,115 - server - INFO -       - Connection: 357ms
2025-12-30T20:24:13.744888262Z [err]  2025-12-30 20:24:13,115 - server - INFO -       - First chunk: 378ms
2025-12-30T20:24:13.744895425Z [err]  2025-12-30 20:24:13,115 - server - INFO -       - All chunks: 380ms
2025-12-30T20:24:13.746679393Z [err]  2025-12-30 20:24:13,115 - server - INFO -       - Audio generation only: 21ms
2025-12-30T20:24:13.746687443Z [err]  2025-12-30 20:24:13,115 - server - INFO - ‚è±Ô∏è [20:24:13.115] üîä TTS COMPLETE: 480ms, audio_size=17181 bytes
2025-12-30T20:24:13.746693788Z [err]  2025-12-30 20:24:13,115 - server - INFO - üíæ TTS CACHED: elevenlabs:Are you still there?... (17181 bytes)
2025-12-30T20:24:13.746701195Z [err]  2025-12-30 20:24:13,115 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.48s
2025-12-30T20:24:13.746708548Z [err]  2025-12-30 20:24:13,116 - telnyx_service - INFO - ‚úÖ Generated 17181 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T20:24:13.746715842Z [err]  2025-12-30 20:24:13,116 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T20:24:13.746723576Z [err]  2025-12-30 20:24:13,395 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T20:24:13.746730640Z [err]  2025-12-30 20:24:13,396 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.28s
2025-12-30T20:24:13.746740072Z [err]  2025-12-30 20:24:13,396 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-30T20:24:13.746747668Z [err]    "errors": [
2025-12-30T20:24:13.746754178Z [err]      {
2025-12-30T20:24:13.749851828Z [err]        "code": "90018",
2025-12-30T20:24:13.749873671Z [err]        "title": "Call has already ended",
2025-12-30T20:24:13.749882934Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-30T20:24:13.749893715Z [err]      }
2025-12-30T20:24:13.749900821Z [err]    ]
2025-12-30T20:24:13.749908892Z [err]  }
2025-12-30T20:24:13.749916027Z [err]  2025-12-30 20:24:13,396 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-30T20:24:13.750580182Z [err]  2025-12-30 20:24:13,444 - server - INFO - ‚úÖ Split into 2 channels
2025-12-30T20:24:13.750585257Z [err]  2025-12-30 20:24:13,444 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-30T20:24:13.750590289Z [err]  2025-12-30 20:24:13,444 - server - INFO - üìä Channel 0: 215644 bytes
2025-12-30T20:24:13.750595629Z [err]  2025-12-30 20:24:13,444 - server - ERROR - ‚ùå No Soniox API key available
2025-12-30T20:24:13.750601092Z [err]  2025-12-30 20:24:13,444 - server - INFO - ‚ùå Channel 0: No speech
2025-12-30T20:24:13.750607347Z [err]  2025-12-30 20:24:13,444 - server - INFO - üìä Channel 1: 215644 bytes
2025-12-30T20:24:13.750612885Z [err]  2025-12-30 20:24:13,444 - server - ERROR - ‚ùå No Soniox API key available
2025-12-30T20:24:13.750617813Z [err]  2025-12-30 20:24:13,444 - server - INFO - ‚ùå Channel 1: No speech
2025-12-30T20:24:13.750624695Z [err]  2025-12-30 20:24:13,444 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-30T20:24:13.750630636Z [inf]  100.64.0.10:51692 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T20:24:13.750636160Z [err]  2025-12-30 20:24:13,445 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=3, logs_count=4, status=completed
2025-12-30T20:24:13.750642737Z [err]  2025-12-30 20:24:13,445 - server - INFO - üìá CRM: Got 11 extracted variables
2025-12-30T20:24:13.750648393Z [err]  2025-12-30 20:24:13,445 - server - INFO - üìá CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-30T20:24:13.750654625Z [err]  2025-12-30 20:24:13,623 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-30T20:24:13.750660665Z [err]  2025-12-30 20:24:13,673 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T20:24:13.754426077Z [err]  2025-12-30 20:24:13,674 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-30T20:24:13.754432913Z [err]  2025-12-30 20:24:13,674 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-30T20:24:13.754443315Z [err]  2025-12-30 20:24:13,697 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T20:24:13.754450875Z [err]  2025-12-30 20:24:13,698 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T20:24:13.754458851Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T20:24:13.754466963Z [err]  2025-12-30 20:24:13,698 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T20:24:13.754474363Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-30T20:24:13.754481997Z [err]  2025-12-30 20:24:13,700 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:13.876215402Z [err]  2025-12-30 20:24:13,873 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-30T20:24:14.781546253Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-30T20:24:14.781551936Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T20:24:14.781569212Z [err]  2025-12-30 20:24:13,959 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-30T20:24:14.781569308Z [err]  2025-12-30 20:24:14,707 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T20:24:14.781576938Z [err]  2025-12-30 20:24:13,960 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-30T20:24:14.781582099Z [err]  2025-12-30 20:24:13,960 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-30T20:24:14.781587894Z [err]  2025-12-30 20:24:14,708 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:14.781588897Z [err]  2025-12-30 20:24:13,960 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-30T20:24:14.781593743Z [err]    File "/app/backend/server.py", line 9773, in trigger_campaign_qc_for_call
2025-12-30T20:24:14.781598928Z [err]      await run_full_qc_analysis(
2025-12-30T20:24:14.781604536Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-30T20:24:14.781612458Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-30T20:24:14.781620257Z [err]  
2025-12-30T20:24:14.781625646Z [err]  2025-12-30 20:24:14,175 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-30T20:24:14.781631773Z [err]  2025-12-30 20:24:14,175 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767126254.1754804 for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:14.781637211Z [err]  2025-12-30 20:24:14,175 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:14.781642730Z [err]  2025-12-30 20:24:14,706 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T20:24:14.781648080Z [err]  2025-12-30 20:24:14,707 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T20:24:14.872831800Z [err]  2025-12-30 20:24:14,870 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T20:24:14.876365213Z [err]  2025-12-30 20:24:14,870 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T20:24:14.876373226Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T20:24:14.876383056Z [err]  2025-12-30 20:24:14,870 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T20:24:14.876390698Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T20:24:15.897576824Z [err]  2025-12-30 20:24:14,966 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:15.897582461Z [err]  2025-12-30 20:24:14,966 - server - INFO - ‚úÖ QC analysis completed for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:15.897587845Z [err]  2025-12-30 20:24:14,966 - server - INFO - üìä Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-30T20:24:15.897593952Z [err]  2025-12-30 20:24:15,152 - server - INFO - üìä Updated campaign_calls with QC scores for v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:15.897598573Z [err]  2025-12-30 20:24:15,328 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-30T20:24:15.897603252Z [err]  2025-12-30 20:24:15,415 - server - INFO - üè∑Ô∏è Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-30T20:24:15.897607399Z [err]  2025-12-30 20:24:15,415 - server - ERROR - ‚ùå Error in auto appointment detection for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA: 'str' object has no attribute 'get'
2025-12-30T20:24:20.826929723Z [err]  2025-12-30 20:24:20,195 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=6.0s, checkin_count=1/2
2025-12-30T20:24:20.826936876Z [err]  2025-12-30 20:24:20,696 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=6.5s, checkin_count=1/2
2025-12-30T20:24:21.832265015Z [err]  2025-12-30 20:24:21,199 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T20:24:21.832304344Z [err]  2025-12-30 20:24:21,199 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T20:24:21.832320381Z [err]  2025-12-30 20:24:21,199 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T20:24:21.832334463Z [err]  2025-12-30 20:24:21,199 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T20:24:21.832344464Z [err]  2025-12-30 20:24:21,199 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T20:24:21.832354290Z [err]  2025-12-30 20:24:21,199 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17181 bytes)
2025-12-30T20:24:21.832362791Z [err]  2025-12-30 20:24:21,199 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-30T20:24:21.832371504Z [err]  2025-12-30 20:24:21,199 - telnyx_service - INFO - ‚úÖ Generated 17181 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T20:24:21.832429072Z [err]  2025-12-30 20:24:21,198 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-30T20:24:21.832434304Z [err]  2025-12-30 20:24:21,198 - core_calling_service - INFO - üí¨ Sending FINAL check-in #2/2: Are you still there?
2025-12-30T20:24:21.832439623Z [err]  2025-12-30 20:24:21,198 - core_calling_service - INFO - ‚ö†Ô∏è Will end call if no response after next silence timeout
2025-12-30T20:24:21.832444236Z [err]  2025-12-30 20:24:21,198 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-30T20:24:21.832448194Z [err]  2025-12-30 20:24:21,198 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:21.832453216Z [err]  2025-12-30 20:24:21,199 - telnyx_service - INFO - üîä Speaking text on call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA: Are you still there?...
2025-12-30T20:24:21.835131943Z [err]  2025-12-30 20:24:21,771 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T20:24:21.835160827Z [err]  2025-12-30 20:24:21,771 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-30T20:24:21.835167755Z [err]  2025-12-30 20:24:21,771 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-30T20:24:21.835684243Z [err]  2025-12-30 20:24:21,485 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T20:24:21.835691904Z [err]  2025-12-30 20:24:21,486 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.29s
2025-12-30T20:24:21.835699182Z [err]  2025-12-30 20:24:21,486 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-30T20:24:21.835709783Z [err]    "errors": [
2025-12-30T20:24:21.835717871Z [err]      {
2025-12-30T20:24:21.835725159Z [err]        "code": "90018",
2025-12-30T20:24:21.835731673Z [err]        "title": "Call has already ended",
2025-12-30T20:24:21.835738797Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-30T20:24:21.835745362Z [err]      }
2025-12-30T20:24:21.835754459Z [err]    ]
2025-12-30T20:24:21.835761455Z [err]  }
2025-12-30T20:24:21.835767661Z [err]  2025-12-30 20:24:21,487 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-30T20:24:22.823621820Z [err]  2025-12-30 20:24:22,273 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767126262.273814 for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:22.823633909Z [err]  2025-12-30 20:24:22,273 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:22.823838296Z [err]  2025-12-30 20:24:22,273 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (15.2s ago), marking agent as done speaking
2025-12-30T20:24:29.874230852Z [err]  2025-12-30 20:24:29,293 - core_calling_service - WARNING - üö´ Call ending - max check-ins reached AND additional 7s timeout expired
2025-12-30T20:24:29.874238892Z [err]  2025-12-30 20:24:29,293 - dead_air_monitor - WARNING - üö´ Max check-ins + timeout reached - hanging up call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:30.806806428Z [err]  2025-12-30 20:24:30,293 - telnyx_service - INFO - üìû Hanging up call: v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:30.806810586Z [err]  2025-12-30 20:24:30,500 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA/actions/hangup "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T20:24:30.806815146Z [err]  2025-12-30 20:24:30,500 - telnyx_service - ERROR - ‚ùå Error hanging up call: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-30T20:24:30.806820394Z [err]  2025-12-30 20:24:30,500 - dead_air_monitor - INFO - üìû Call hung up - result: {'success': False, 'error': 'Error code: 422 - {\'errors\': [{\'code\': \'90018\', \'title\': \'Call has already ended\', \'detail\': "This call is no longer active and can\'t receive commands."}]}'}
2025-12-30T20:24:30.806825696Z [err]  2025-12-30 20:24:30,500 - dead_air_monitor - INFO - üîá Dead air monitoring stopped for call v3:t-F_cvM6swvzpdQ6yUS0T8t_xKGSdPIgHTvvSbqOS3_0cOnYA66CwA
2025-12-30T20:24:30.835853478Z [err]  2025-12-30 20:24:30,830 - server - INFO - üé§ Soniox receiver alive - 12 messages received in last 10s
2025-12-30T20:24:30.835858606Z [err]  2025-12-30 20:24:30,830 - server - ERROR - ‚ùå Soniox error: {'tokens': [], 'final_audio_proc_ms': 5520, 'total_audio_proc_ms': 10800, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-30T20:24:30.835863880Z [err]  2025-12-30 20:24:30,830 - server - INFO - ‚úÖ Soniox receive loop ended normally
2025-12-30T20:24:30.835879692Z [err]  2025-12-30 20:24:30,830 - server - INFO - üîá Dead air monitoring task cancelled
2025-12-30T20:24:32.836948787Z [err]  2025-12-30 20:24:32,831 - soniox_service - ERROR - ‚ùå Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-30T20:24:32.836963232Z [err]  2025-12-30 20:24:32,831 - server - INFO - üîå Telnyx WebSocket disconnected
2025-12-30T20:35:28.477188298Z [inf]  100.64.0.13:44656 - "GET /api/agents HTTP/1.1" 200