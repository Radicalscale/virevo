2025-12-29T22:14:27.000000000Z [inf]  Starting Container
2025-12-29T22:14:27.716718826Z [inf]  =========================================
2025-12-29T22:14:27.716719816Z [inf]  =========================================
2025-12-29T22:14:27.716723571Z [inf]  üìç Working directory: /app/backend
2025-12-29T22:14:27.716729087Z [inf]  üöÄ START.SH SCRIPT IS EXECUTING
2025-12-29T22:14:27.716733789Z [inf]  üîç Python path: /app/backend
2025-12-29T22:14:27.716735348Z [inf]  =========================================
2025-12-29T22:14:27.716741763Z [inf]  üåê Starting Gunicorn on 0.0.0.0:8080...
2025-12-29T22:14:27.925946026Z [err]  [2025-12-29 22:14:27 +0000] [1] [INFO] Starting gunicorn 22.0.0
2025-12-29T22:14:27.925951799Z [err]  [2025-12-29 22:14:27 +0000] [1] [INFO] Listening at: http://0.0.0.0:8080 (1)
2025-12-29T22:14:27.925957768Z [err]  [2025-12-29 22:14:27 +0000] [1] [INFO] Using worker: uvicorn.workers.UvicornWorker
2025-12-29T22:14:27.933425741Z [err]  [2025-12-29 22:14:27 +0000] [3] [INFO] Booting worker with pid: 3
2025-12-29T22:14:28.019483700Z [err]  [2025-12-29 22:14:28 +0000] [4] [INFO] Booting worker with pid: 4
2025-12-29T22:14:28.057598891Z [err]  [2025-12-29 22:14:28 +0000] [5] [INFO] Booting worker with pid: 5
2025-12-29T22:14:28.114539927Z [err]  [2025-12-29 22:14:28 +0000] [6] [INFO] Booting worker with pid: 6
2025-12-29T22:14:48.114594045Z [err]  2025-12-29 22:14:42,484 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-29T22:14:48.114603832Z [err]  2025-12-29 22:14:42,484 - server - INFO - üî• Pre-warming connection libraries...
2025-12-29T22:14:48.114610393Z [err]  2025-12-29 22:14:42,484 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-29T22:14:48.114616578Z [err]  2025-12-29 22:14:42,485 - server - INFO - üî• Pre-warming connection libraries...
2025-12-29T22:14:48.114623160Z [err]  2025-12-29 22:14:42,487 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-29T22:14:48.114629930Z [err]  2025-12-29 22:14:42,487 - server - INFO - üî• Pre-warming connection libraries...
2025-12-29T22:14:48.114637031Z [err]  2025-12-29 22:14:42,520 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-29T22:14:48.114642779Z [err]  2025-12-29 22:14:42,541 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-29T22:14:48.114648388Z [err]  2025-12-29 22:14:42,667 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-29T22:14:48.114654163Z [err]  2025-12-29 22:14:42,754 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-29T22:14:48.114659998Z [err]  2025-12-29 22:14:42,760 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-29T22:14:48.114666841Z [err]  2025-12-29 22:14:42,760 - server - INFO - üî• Pre-warming connection libraries...
2025-12-29T22:14:48.114673038Z [err]  2025-12-29 22:14:42,787 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-29T22:14:48.114679036Z [err]  2025-12-29 22:14:42,802 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-29T22:14:48.117574034Z [err]  2025-12-29 22:14:43,149 - server - INFO - ‚úÖ QC agent router loaded
2025-12-29T22:14:48.117577171Z [err]  2025-12-29 22:14:42,802 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-29T22:14:48.117583708Z [err]  2025-12-29 22:14:43,153 - server - INFO - ‚úÖ QC learning router loaded
2025-12-29T22:14:48.117586370Z [err]  2025-12-29 22:14:42,876 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-29T22:14:48.117592368Z [err]  2025-12-29 22:14:43,155 - server - INFO - ‚úÖ QC agent router loaded
2025-12-29T22:14:48.117593050Z [err]  2025-12-29 22:14:42,904 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-29T22:14:48.117599444Z [err]  2025-12-29 22:14:42,963 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-29T22:14:48.117599522Z [err]  2025-12-29 22:14:43,163 - server - INFO - ‚úÖ QC learning router loaded
2025-12-29T22:14:48.117605365Z [err]  2025-12-29 22:14:42,982 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-29T22:14:48.117610541Z [err]  2025-12-29 22:14:43,176 - server - INFO - ‚úÖ QC learning router loaded
2025-12-29T22:14:48.117610666Z [err]  2025-12-29 22:14:43,012 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-29T22:14:48.117616422Z [err]  2025-12-29 22:14:43,125 - server - INFO - ‚úÖ QC agent router loaded
2025-12-29T22:14:48.117617962Z [err]  2025-12-29 22:14:43,185 - server - INFO - ‚úÖ QC learning router loaded
2025-12-29T22:14:48.117623208Z [err]  2025-12-29 22:14:43,135 - server - INFO - ‚úÖ QC agent router loaded
2025-12-29T22:14:48.117623857Z [err]  2025-12-29 22:14:43,285 - server - INFO - ‚úÖ CRM router loaded
2025-12-29T22:14:48.117628853Z [err]  2025-12-29 22:14:43,309 - server - INFO - ‚úÖ CRM router loaded
2025-12-29T22:14:48.117633775Z [err]  2025-12-29 22:14:43,331 - server - INFO - ‚úÖ CRM router loaded
2025-12-29T22:14:48.117638437Z [err]  2025-12-29 22:14:43,335 - server - INFO - ‚úÖ CRM router loaded
2025-12-29T22:14:48.120497825Z [err]  2025-12-29 22:14:44,002 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-29T22:14:48.120506075Z [err]  2025-12-29 22:14:44,003 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-29T22:14:48.120514763Z [err]  2025-12-29 22:14:43,888 - server - INFO - ‚úÖ QC test router loaded
2025-12-29T22:14:48.120524927Z [err]  2025-12-29 22:14:43,889 - server - INFO - ‚úÖ QC test router loaded
2025-12-29T22:14:48.120531903Z [err]  2025-12-29 22:14:43,915 - server - INFO - ‚úÖ Agent test router loaded
2025-12-29T22:14:48.120538174Z [err]  2025-12-29 22:14:43,959 - server - INFO - ‚úÖ QC test router loaded
2025-12-29T22:14:48.120544448Z [err]  2025-12-29 22:14:43,972 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-29T22:14:48.120550509Z [err]  2025-12-29 22:14:43,972 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-29T22:14:48.120557055Z [err]  2025-12-29 22:14:43,973 - server - INFO - ‚úÖ Agent test router loaded
2025-12-29T22:14:48.120563039Z [err]  2025-12-29 22:14:43,976 - server - INFO - ‚úÖ Agent test router loaded
2025-12-29T22:14:48.120568382Z [err]  2025-12-29 22:14:43,979 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-29T22:14:48.120574288Z [err]  2025-12-29 22:14:43,979 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-29T22:14:48.120579618Z [err]  2025-12-29 22:14:43,983 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-29T22:14:48.120586255Z [err]  2025-12-29 22:14:43,983 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-29T22:14:48.120592586Z [err]  [2025-12-29 22:14:43 +0000] [5] [INFO] Started server process [5]
2025-12-29T22:14:48.120598496Z [err]  [2025-12-29 22:14:43 +0000] [5] [INFO] Waiting for application startup.
2025-12-29T22:14:48.120605296Z [err]  [2025-12-29 22:14:43 +0000] [4] [INFO] Started server process [4]
2025-12-29T22:14:48.120611548Z [err]  [2025-12-29 22:14:43 +0000] [4] [INFO] Waiting for application startup.
2025-12-29T22:14:48.122122253Z [err]  [2025-12-29 22:14:44 +0000] [3] [INFO] Started server process [3]
2025-12-29T22:14:48.122134112Z [err]  [2025-12-29 22:14:44 +0000] [3] [INFO] Waiting for application startup.
2025-12-29T22:14:48.122146245Z [err]  2025-12-29 22:14:44,011 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-29T22:14:48.122152357Z [err]  2025-12-29 22:14:44,174 - server - INFO - ‚úÖ QC test router loaded
2025-12-29T22:14:48.122158090Z [err]  2025-12-29 22:14:44,190 - server - INFO - ‚úÖ Agent test router loaded
2025-12-29T22:14:48.122165480Z [err]  2025-12-29 22:14:44,199 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-29T22:14:48.122171461Z [err]  2025-12-29 22:14:44,199 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-29T22:14:48.122179966Z [err]  [2025-12-29 22:14:44 +0000] [6] [INFO] Started server process [6]
2025-12-29T22:14:48.122185654Z [err]  [2025-12-29 22:14:44 +0000] [6] [INFO] Waiting for application startup.
2025-12-29T22:14:48.122191575Z [err]  2025-12-29 22:14:44,225 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-29T22:14:51.880028793Z [err]  2025-12-29 22:14:51,828 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-29T22:14:51.880034882Z [err]  2025-12-29 22:14:51,828 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-29T22:14:51.880068840Z [err]  2025-12-29 22:14:51,833 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-29T22:14:51.880075510Z [err]  2025-12-29 22:14:51,833 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-29T22:14:51.880080960Z [err]  2025-12-29 22:14:51,836 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-29T22:14:51.880088027Z [err]  2025-12-29 22:14:51,832 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-29T22:14:51.880092790Z [err]  2025-12-29 22:14:51,832 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-29T22:14:51.880096911Z [err]  2025-12-29 22:14:51,833 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-29T22:14:51.880100768Z [err]  2025-12-29 22:14:51,833 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-29T22:14:51.880108523Z [err]  2025-12-29 22:14:51,841 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-29T22:14:51.880216810Z [err]  2025-12-29 22:14:51,841 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-29T22:14:51.880223290Z [err]  2025-12-29 22:14:51,841 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-29T22:14:51.946272135Z [err]  2025-12-29 22:14:51,945 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-29T22:14:51.953087432Z [err]  2025-12-29 22:14:51,951 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-29T22:14:51.953093556Z [err]  2025-12-29 22:14:51,951 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-29T22:14:51.953099513Z [err]  2025-12-29 22:14:51,951 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-29T22:14:52.872588714Z [err]  2025-12-29 22:14:52,549 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-29T22:14:52.872596245Z [err]  2025-12-29 22:14:52,565 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-29T22:14:52.872601138Z [err]  2025-12-29 22:14:52,646 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-29T22:14:52.872608693Z [err]  2025-12-29 22:14:52,647 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-29T22:14:52.872960570Z [err]  [2025-12-29 22:14:52 +0000] [3] [INFO] Application startup complete.
2025-12-29T22:14:52.872966004Z [err]  2025-12-29 22:14:52,648 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-29T22:14:52.872970613Z [err]  2025-12-29 22:14:52,664 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-29T22:14:52.874029649Z [err]  2025-12-29 22:14:52,664 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-29T22:14:52.874035611Z [err]  [2025-12-29 22:14:52 +0000] [4] [INFO] Application startup complete.
2025-12-29T22:14:52.874039738Z [err]  2025-12-29 22:14:52,672 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-29T22:14:52.874043608Z [err]  2025-12-29 22:14:52,762 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-29T22:14:52.874047472Z [err]  2025-12-29 22:14:52,763 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-29T22:14:52.874051471Z [err]  [2025-12-29 22:14:52 +0000] [5] [INFO] Application startup complete.
2025-12-29T22:14:52.874055554Z [err]  2025-12-29 22:14:52,765 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-29T22:14:52.874060462Z [err]  2025-12-29 22:14:52,766 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-29T22:14:52.874231132Z [err]  [2025-12-29 22:14:52 +0000] [6] [INFO] Application startup complete.
2025-12-29T22:48:30.661906578Z [inf]  100.64.0.2:58674 - "GET /robots.txt HTTP/1.1" 404
2025-12-29T22:48:30.661915171Z [inf]  100.64.0.3:25068 - "GET /api/auth/me HTTP/1.1" 401
2025-12-30T02:30:44.703731538Z [inf]  100.64.0.4:22564 - "GET /sendgrid.env HTTP/1.1" 404
2025-12-30T03:23:59.224591305Z [inf]  100.64.0.5:29950 - "GET /api/auth/me HTTP/1.1" 401
2025-12-30T03:24:00.263807217Z [inf]  100.64.0.6:11226 - "OPTIONS /api/auth/login HTTP/1.1" 200
2025-12-30T03:24:02.271751936Z [inf]  100.64.0.7:26792 - "POST /api/auth/login HTTP/1.1" 200
2025-12-30T03:24:02.858662464Z [inf]  100.64.0.7:26792 - "GET /api/agents HTTP/1.1" 200
2025-12-30T03:24:04.822186753Z [inf]  100.64.0.7:26792 - "GET /api/agents HTTP/1.1" 200
2025-12-30T03:24:34.841956849Z [inf]  100.64.0.8:27342 - "OPTIONS /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-30T03:24:34.841965090Z [err]  2025-12-30 03:24:31,201 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-30T03:24:34.841970857Z [err]  2025-12-30 03:24:31,295 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:34.841975915Z [err]  2025-12-30 03:24:31,384 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:34.841982553Z [err]  2025-12-30 03:24:31,413 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T03:24:34.841987946Z [err]  2025-12-30 03:24:31,413 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-30T03:24:34.841991929Z [err]  2025-12-30 03:24:31,413 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-30T03:24:34.841996298Z [err]  2025-12-30 03:24:31,413 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-30T03:24:34.842000722Z [err]  2025-12-30 03:24:32,551 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-30T03:24:34.842004774Z [err]  2025-12-30 03:24:32,554 - telnyx_service - INFO - ‚úÖ Call initiated: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:34.842008476Z [err]  2025-12-30 03:24:32,658 - server - INFO - üìù Created call log: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:34.842012102Z [err]  2025-12-30 03:24:32,658 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T03:24:34.842015849Z [err]  2025-12-30 03:24:32,658 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-30T03:24:34.843032970Z [err]  2025-12-30 03:24:32,658 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T03:24:34.843043453Z [err]  2025-12-30 03:24:32,658 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T03:24:34.843046919Z [inf]  100.64.0.9:18136 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-30T03:24:34.843049950Z [err]  2025-12-30 03:24:32,667 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg (TTL: 3600s)
2025-12-30T03:24:34.843056808Z [err]  2025-12-30 03:24:32,667 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-30T03:24:34.843056925Z [err]  2025-12-30 03:24:32,870 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-30T03:24:34.843064625Z [err]  2025-12-30 03:24:32,667 - server - INFO - üìû Outbound call initiated: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:34.843067471Z [err]  2025-12-30 03:24:32,870 - server - INFO -    Client: Address(host='100.64.0.10', port=23768)
2025-12-30T03:24:34.843073596Z [err]  2025-12-30 03:24:32,870 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'zDwwpX2J8ZCgLzXkmpWsNA==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'oTp0ftO6SISNmpINxtoGcA', 'x-real-ip': '192.76.120.151', 'x-request-start': '1767065072644', 'accept-encoding': 'gzip'}
2025-12-30T03:24:34.843078324Z [err]  2025-12-30 03:24:32,870 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-30T03:24:34.843083304Z [err]  2025-12-30 03:24:32,870 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-30T03:24:34.844327436Z [err]  [2025-12-30 03:24:32 +0000] [6] [INFO] ('100.64.0.10', 23768) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-30T03:24:34.844333952Z [err]  2025-12-30 03:24:32,871 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-30T03:24:34.844337122Z [err]  2025-12-30 03:24:33,025 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-30T03:24:34.844339267Z [err]  [2025-12-30 03:24:32 +0000] [6] [INFO] connection open
2025-12-30T03:24:34.844344342Z [err]  2025-12-30 03:24:32,959 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:34.844348683Z [err]  2025-12-30 03:24:32,959 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': 'bfd504c1-e897-4d30-bdbd-98fb12893134', 'occurred_at': '2025-12-30T03:24:32.363253Z', 'payload': {'call_control_id': 'v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg', 'call_leg_id': '0e98908a-e52f-11f0-8b5e-02420aef991f', 'call_session_id': '0e95fcb2-e52f-11f0-9a07-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:34.844351614Z [err]  2025-12-30 03:24:33,025 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-30T03:24:34.844354512Z [err]  2025-12-30 03:24:32,959 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:34.844359858Z [err]  2025-12-30 03:24:32,959 - server - INFO - üì® ================================================
2025-12-30T03:24:34.844363888Z [err]  2025-12-30 03:24:32,959 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-30T03:24:34.844371791Z [inf]  100.64.0.2:59914 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:34.845524313Z [err]  2025-12-30 03:24:33,138 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T03:24:34.845529474Z [err]  2025-12-30 03:24:33,139 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-30T03:24:36.409260904Z [err]  2025-12-30 03:24:36,082 - server - INFO - üì¨ Received Telnyx event: start
2025-12-30T03:24:36.409273976Z [err]  2025-12-30 03:24:36,082 - server - INFO - üé¨ Stream started for call: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:36.409280023Z [err]  2025-12-30 03:24:36,090 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:36.409284490Z [err]  2025-12-30 03:24:36,091 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-30T03:24:36.409289014Z [err]  2025-12-30 03:24:36,091 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-30T03:24:36.418595101Z [err]  2025-12-30 03:24:36,415 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:36.418600051Z [err]  2025-12-30 03:24:36,415 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': '91493863-5fe4-4623-a3b6-4b7a570bb0e5', 'occurred_at': '2025-12-30T03:24:35.863236Z', 'payload': {'call_control_id': 'v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg', 'call_leg_id': '0e98908a-e52f-11f0-8b5e-02420aef991f', 'call_session_id': '0e95fcb2-e52f-11f0-9a07-02420aef991f', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-30T03:24:32.363253Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:36.418603915Z [err]  2025-12-30 03:24:36,415 - server - INFO - üéØ Event type: call.answered, Call ID: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:36.418608031Z [err]  2025-12-30 03:24:36,415 - server - INFO - üì® ================================================
2025-12-30T03:24:36.418612168Z [err]  2025-12-30 03:24:36,415 - server - INFO - ‚úÖ Call answered: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:36.425127037Z [err]  2025-12-30 03:24:36,423 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:36.427465614Z [err]  2025-12-30 03:24:36,424 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-30T03:24:36.427473854Z [err]  2025-12-30 03:24:36,424 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-30T03:24:36.512405765Z [err]  2025-12-30 03:24:36,510 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:36.512414009Z [err]  2025-12-30 03:24:36,510 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': '89db88c3-d8e5-498f-939f-3ce9db58db41', 'occurred_at': '2025-12-30T03:24:36.303236Z', 'payload': {'call_control_id': 'v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg', 'call_leg_id': '0e98908a-e52f-11f0-8b5e-02420aef991f', 'call_session_id': '0e95fcb2-e52f-11f0-9a07-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '17b99585-c6eb-4e37-aa57-34943ae8fb6f', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:36.512419202Z [err]  2025-12-30 03:24:36,510 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:36.512423972Z [err]  2025-12-30 03:24:36,510 - server - INFO - üì® ================================================
2025-12-30T03:24:36.512428482Z [inf]  100.64.0.2:59914 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:36.597133184Z [err]  2025-12-30 03:24:36,591 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-30T03:24:36.597144466Z [err]  2025-12-30 03:24:36,591 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-30T03:24:36.599543308Z [err]  2025-12-30 03:24:36,597 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:36.601252860Z [err]  2025-12-30 03:24:36,598 - server - INFO - üìù Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T03:24:36.601259774Z [err]  2025-12-30 03:24:36,599 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-30T03:24:36.712962645Z [err]  2025-12-30 03:24:36,707 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-30T03:24:36.712971268Z [err]  2025-12-30 03:24:36,707 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-30T03:24:36.729744826Z [err]  2025-12-30 03:24:36,724 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-30T03:24:36.729753446Z [err]  2025-12-30 03:24:36,724 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-30T03:24:36.729758469Z [err]  2025-12-30 03:24:36,725 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-30T03:24:36.825633897Z [err]  2025-12-30 03:24:36,821 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:36.853481529Z [err]  2025-12-30 03:24:36,830 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 104ms
2025-12-30T03:24:36.853486614Z [err]  2025-12-30 03:24:36,830 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-30T03:24:36.853491499Z [err]  2025-12-30 03:24:36,830 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-30T03:24:36.853498701Z [err]  2025-12-30 03:24:36,830 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-30T03:24:36.853503670Z [err]  2025-12-30 03:24:36,830 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-30T03:24:36.853509209Z [err]  2025-12-30 03:24:36,832 - server - INFO - ‚úÖ Initialized call_states for v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg with session reference
2025-12-30T03:24:36.853513997Z [err]  2025-12-30 03:24:36,838 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-30T03:24:36.936390195Z [err]  2025-12-30 03:24:36,934 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-30T03:24:37.386597777Z [err]  2025-12-30 03:24:37,296 - server - INFO - ‚úÖ Call log updated
2025-12-30T03:24:37.386603084Z [err]  2025-12-30 03:24:37,296 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T03:24:37.386608934Z [err]  2025-12-30 03:24:37,296 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T03:24:37.386615673Z [err]  2025-12-30 03:24:37,296 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T03:24:37.396901420Z [err]  2025-12-30 03:24:37,385 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:37.463563019Z [err]  2025-12-30 03:24:37,456 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-30T03:24:37.463572835Z [err]  2025-12-30 03:24:37,456 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-30T03:24:37.463580158Z [err]  2025-12-30 03:24:37,456 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-30T03:24:37.474282348Z [err]  2025-12-30 03:24:37,472 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:37.474289507Z [err]  2025-12-30 03:24:37,473 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-30T03:24:37.480755969Z [err]  2025-12-30 03:24:37,477 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T03:24:37.480763721Z [err]  2025-12-30 03:24:37,477 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:37.480770385Z [err]  2025-12-30 03:24:37,479 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:37.480776971Z [err]  2025-12-30 03:24:37,479 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-30T03:24:37.513675478Z [err]  2025-12-30 03:24:37,501 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T03:24:37.677451026Z [err]  2025-12-30 03:24:37,676 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T03:24:37.679010250Z [err]  2025-12-30 03:24:37,677 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-30T03:24:37.765304120Z [err]  2025-12-30 03:24:37,762 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg/actions/playback_start "HTTP/1.1 200 OK"
2025-12-30T03:24:37.765317565Z [err]  2025-12-30 03:24:37,763 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: wWD2lXVWKA (loop=True, overlay=True)
2025-12-30T03:24:37.765326359Z [err]  2025-12-30 03:24:37,763 - server - WARNING - ‚ö†Ô∏è Failed to start comfort noise: 'v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg'
2025-12-30T03:24:37.765333043Z [err]  2025-12-30 03:24:37,763 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:38.012563241Z [err]  2025-12-30 03:24:37,981 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:38.540574941Z [err]  2025-12-30 03:24:38,482 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:38.852954447Z [err]  2025-12-30 03:24:38,843 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:38.852960109Z [err]  2025-12-30 03:24:38,847 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:38.861665262Z [err]  2025-12-30 03:24:38,855 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg (TTL: 3600s)
2025-12-30T03:24:38.861675340Z [err]  2025-12-30 03:24:38,855 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-30T03:24:38.861682399Z [err]  2025-12-30 03:24:38,855 - core_calling_service - INFO - ‚è±Ô∏è [03:24:38.855] üì• process_user_input() ENTRY - text: '...'
2025-12-30T03:24:38.861688215Z [err]  2025-12-30 03:24:38,858 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:38.861694376Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - ‚è±Ô∏è [03:24:38.859] ‚è© About to call _process_call_flow_streaming()
2025-12-30T03:24:38.861700208Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - ‚è±Ô∏è [03:24:38.859] üîÄ Agent type: call_flow, calling flow processor...
2025-12-30T03:24:38.861705910Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - ‚è±Ô∏è [03:24:38.859] üîÄ _process_call_flow_streaming() ENTRY
2025-12-30T03:24:38.861711705Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-30T03:24:38.861717599Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - ‚è±Ô∏è [03:24:38.859] ‚úÖ Node selected, about to process content...
2025-12-30T03:24:38.861725142Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - üîß Replaced {{now}} with Monday, December 29, 2025 at 10:24 PM EST in content
2025-12-30T03:24:38.861730513Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-30T03:24:38.861736018Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-30T03:24:38.861741363Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-30T03:24:38.863303405Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-30T03:24:38.863310116Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-30T03:24:38.863313116Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-30T03:24:38.863320694Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-30T03:24:38.863322560Z [err]  2025-12-30 03:24:38,860 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-30T03:24:38.863328384Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-30T03:24:38.863334842Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-30T03:24:38.863341177Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-30T03:24:38.863349535Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-30T03:24:38.863355555Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-30T03:24:38.863361640Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-30T03:24:38.863367928Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - ‚è±Ô∏è [03:24:38.859] üìÑ About to process content (mode=script, length=9)
2025-12-30T03:24:38.863374200Z [err]  2025-12-30 03:24:38,859 - core_calling_service - INFO - üîä Silence tracking reset for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg (user responded)
2025-12-30T03:24:38.864628583Z [err]  2025-12-30 03:24:38,860 - core_calling_service - INFO - LLM response (0.00s): Kendrick?
2025-12-30T03:24:38.864635382Z [err]  2025-12-30 03:24:38,860 - core_calling_service - INFO - Total latency: 0.00s
2025-12-30T03:24:38.864641079Z [err]  2025-12-30 03:24:38,860 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-30T03:24:38.973040194Z [err]  2025-12-30 03:24:38,965 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:38.973050163Z [err]  2025-12-30 03:24:38,966 - telnyx_service - INFO - üîä Speaking text on call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg: Kendrick?...
2025-12-30T03:24:38.973105733Z [err]  2025-12-30 03:24:38,966 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T03:24:38.973113883Z [err]  2025-12-30 03:24:38,966 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T03:24:38.973119458Z [err]  2025-12-30 03:24:38,966 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T03:24:38.973124649Z [err]  2025-12-30 03:24:38,966 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T03:24:38.973129775Z [err]  2025-12-30 03:24:38,966 - server - INFO - ‚è±Ô∏è [03:24:38.966] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-30T03:24:38.973134991Z [err]  2025-12-30 03:24:38,966 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-30T03:24:38.973139883Z [err]  2025-12-30 03:24:38,966 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-30T03:24:38.988121077Z [err]  2025-12-30 03:24:38,984 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:39.534584722Z [err]  2025-12-30 03:24:39,073 - server - INFO -    Text content: 'Kendrick?'
2025-12-30T03:24:39.534602700Z [err]  2025-12-30 03:24:39,073 - server - INFO -    Text bytes: b'Kendrick?'
2025-12-30T03:24:39.534608841Z [err]  2025-12-30 03:24:39,073 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-30T03:24:39.534614446Z [err]  2025-12-30 03:24:39,073 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-30T03:24:39.534620999Z [err]  2025-12-30 03:24:39,073 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-30T03:24:39.534626585Z [err]  2025-12-30 03:24:39,073 - server - INFO -    Full data: {'text': 'Kendrick?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-30T03:24:39.534631287Z [err]  2025-12-30 03:24:39,073 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-30T03:24:39.534636456Z [err]  2025-12-30 03:24:39,073 - server - INFO -    Timeout: 10.0s
2025-12-30T03:24:39.534641254Z [err]  2025-12-30 03:24:39,081 - server - INFO -    ‚úì HTTP client created (0.007s)
2025-12-30T03:24:39.534646499Z [err]  2025-12-30 03:24:39,081 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-30T03:24:39.534648747Z [err]  2025-12-30 03:24:39,073 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:39.534651773Z [inf]  100.64.0.12:12182 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-30T03:24:39.534657571Z [err]  2025-12-30 03:24:39,217 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg/actions/record_start "HTTP/1.1 200 OK"
2025-12-30T03:24:39.534657598Z [err]  2025-12-30 03:24:39,073 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-30T03:24:39.534663308Z [err]  2025-12-30 03:24:39,073 - server - INFO -    Text length: 9 chars
2025-12-30T03:24:39.536231988Z [err]  2025-12-30 03:24:39,219 - server - INFO - üéôÔ∏è Call recording started for v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:39.536235833Z [err]  2025-12-30 03:24:39,219 - server - INFO - üîß Creating call session for v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg...
2025-12-30T03:24:39.536239978Z [err]  2025-12-30 03:24:39,220 - server - INFO - üîç Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T03:24:39.536244240Z [err]  2025-12-30 03:24:39,220 - server - INFO - üîß Calling create_call_session() - START
2025-12-30T03:24:39.536251593Z [err]  2025-12-30 03:24:39,220 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-30T03:24:39.536257136Z [err]  2025-12-30 03:24:39,307 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-30T03:24:39.536263636Z [err]  2025-12-30 03:24:39,307 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-30T03:24:39.536269095Z [err]  2025-12-30 03:24:39,317 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-30T03:24:39.536274714Z [err]  2025-12-30 03:24:39,317 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-30T03:24:39.536280284Z [err]  2025-12-30 03:24:39,317 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-30T03:24:39.536285857Z [err]  2025-12-30 03:24:39,404 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:39.536291906Z [err]  2025-12-30 03:24:39,415 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 97ms
2025-12-30T03:24:39.536297284Z [err]  2025-12-30 03:24:39,415 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-30T03:24:39.537966555Z [err]  2025-12-30 03:24:39,415 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-30T03:24:39.537970563Z [err]  2025-12-30 03:24:39,421 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg (TTL: 3600s)
2025-12-30T03:24:39.537975225Z [err]  2025-12-30 03:24:39,421 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-30T03:24:39.537979057Z [err]  2025-12-30 03:24:39,421 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-30T03:24:39.537992086Z [err]  2025-12-30 03:24:39,422 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:39.538004578Z [err]  2025-12-30 03:24:39,422 - server - INFO - ü§ñ AI session created for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:39.538008305Z [err]  2025-12-30 03:24:39,422 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-30T03:24:39.538012127Z [err]  2025-12-30 03:24:39,422 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-30T03:24:39.538016096Z [err]  2025-12-30 03:24:39,422 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-30T03:24:39.538020249Z [err]  2025-12-30 03:24:39,422 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-30T03:24:39.538024160Z [err]  2025-12-30 03:24:39,422 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-30T03:24:39.538027756Z [err]  2025-12-30 03:24:39,422 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-30T03:24:39.540008590Z [err]  2025-12-30 03:24:39,423 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-30T03:24:39.540013782Z [err]  2025-12-30 03:24:39,429 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:39.540019928Z [err]  2025-12-30 03:24:39,430 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-30T03:24:39.540025445Z [err]  2025-12-30 03:24:39,430 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-30T03:24:39.540031383Z [inf]  100.64.0.11:20262 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:39.540037352Z [err]  2025-12-30 03:24:39,485 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:39.540042909Z [err]  2025-12-30 03:24:39,501 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-30T03:24:39.540048286Z [err]  2025-12-30 03:24:39,501 - server - INFO -    ‚úì Connection established (0.428s) [TARGET: <200ms]
2025-12-30T03:24:39.540053636Z [err]  2025-12-30 03:24:39,501 - server - INFO -    ‚úì Response status: 200
2025-12-30T03:24:39.540059189Z [err]  2025-12-30 03:24:39,501 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-30T03:24:39.540064725Z [err]  2025-12-30 03:24:39,510 - server - INFO -    ‚úì FIRST CHUNK received (0.436s, 1133 bytes) [TARGET: <300ms]
2025-12-30T03:24:39.540071292Z [err]  2025-12-30 03:24:39,512 - server - INFO -    ‚úì ALL CHUNKS received: 75 chunks (0.439s)
2025-12-30T03:24:39.540076101Z [err]  2025-12-30 03:24:39,512 - server - INFO -    ‚úì Total audio size: 13837 bytes
2025-12-30T03:24:39.540080085Z [err]  2025-12-30 03:24:39,512 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-30T03:24:39.540083911Z [err]  2025-12-30 03:24:39,512 - server - INFO -       - Connection: 428ms
2025-12-30T03:24:39.542007099Z [err]  2025-12-30 03:24:39,512 - server - INFO -       - First chunk: 436ms
2025-12-30T03:24:39.542011317Z [err]  2025-12-30 03:24:39,512 - server - INFO -       - All chunks: 439ms
2025-12-30T03:24:39.542015734Z [err]  2025-12-30 03:24:39,512 - server - INFO -       - Audio generation only: 9ms
2025-12-30T03:24:39.542020270Z [err]  2025-12-30 03:24:39,513 - server - INFO - ‚è±Ô∏è [03:24:39.513] üîä TTS COMPLETE: 546ms, audio_size=13837 bytes
2025-12-30T03:24:39.542026523Z [err]  2025-12-30 03:24:39,513 - server - INFO - üíæ TTS CACHED: elevenlabs:Kendrick?... (13837 bytes)
2025-12-30T03:24:39.542031738Z [err]  2025-12-30 03:24:39,513 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.55s
2025-12-30T03:24:39.542035907Z [err]  2025-12-30 03:24:39,513 - telnyx_service - INFO - ‚úÖ Generated 13837 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-30T03:24:39.542039815Z [err]  2025-12-30 03:24:39,513 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-30T03:24:39.795357683Z [err]  2025-12-30 03:24:39,791 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg/actions/playback_start "HTTP/1.1 200 OK"
2025-12-30T03:24:39.795369739Z [err]  2025-12-30 03:24:39,791 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.28s
2025-12-30T03:24:39.795377147Z [err]  2025-12-30 03:24:39,792 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 0.83s
2025-12-30T03:24:39.795383660Z [err]  2025-12-30 03:24:39,792 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-30T03:24:39.795389729Z [err]  2025-12-30 03:24:39,792 - telnyx_service - INFO - üé¨ Playback ID: ni-WfjeAKg
2025-12-30T03:24:39.795396927Z [err]  2025-12-30 03:24:39,792 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-30T03:24:39.795403533Z [err]  2025-12-30 03:24:39,792 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Greeting playback started at 1767065079.7923162
2025-12-30T03:24:39.795409773Z [err]  2025-12-30 03:24:39,792 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767065079.7923431 for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:39.795416253Z [err]  2025-12-30 03:24:39,792 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-30T03:24:39.989926867Z [err]  2025-12-30 03:24:39,986 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:40.480533481Z [inf]  100.64.0.13:41164 - "GET /api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3 HTTP/1.1" 200
2025-12-30T03:24:40.480537785Z [err]  2025-12-30 03:24:40,409 - server - INFO - üî§ RAW TOKENS: ["Hell"‚úì, "o."‚úì, "<end>"‚úì]
2025-12-30T03:24:40.480541938Z [err]  2025-12-30 03:24:40,409 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-30T03:24:40.480545843Z [err]  2025-12-30 03:24:40,413 - server - INFO - üì• FINAL TOKENS: 'Hell o.' (2 tokens)
2025-12-30T03:24:40.480549766Z [err]  2025-12-30 03:24:40,413 - server - INFO - üé§ Soniox final transcript: 'Hell o.'
2025-12-30T03:24:40.480553819Z [err]  2025-12-30 03:24:40,414 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:40.480557502Z [err]  2025-12-30 03:24:40,414 - server - INFO - üîç FILTER CHECK: words=2, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-30T03:24:40.480562850Z [err]  2025-12-30 03:24:40,414 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:40.480568075Z [err]  2025-12-30 03:24:40,414 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-30T03:24:40.480573454Z [err]  2025-12-30 03:24:40,414 - server - INFO - ‚è±Ô∏è [03:24:40.414] üìù FINAL TRANSCRIPT RECEIVED: 'Hell o.'
2025-12-30T03:24:40.480578765Z [err]  2025-12-30 03:24:40,414 - server - INFO - ‚è±Ô∏è [03:24:40.414] STT endpoint detection latency: 8ms
2025-12-30T03:24:40.480586026Z [err]  2025-12-30 03:24:40,414 - server - INFO - ‚è±Ô∏è [03:24:40.414] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-30T03:24:40.480591787Z [err]  2025-12-30 03:24:40,414 - server - INFO - ‚è±Ô∏è User spoke at 1767065080.4148653
2025-12-30T03:24:40.480598125Z [err]  2025-12-30 03:24:40,415 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg (TTL: 3600s)
2025-12-30T03:24:40.482720609Z [err]  2025-12-30 03:24:40,415 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-30T03:24:40.482726456Z [err]  2025-12-30 03:24:40,415 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:40.482877979Z [err]  2025-12-30 03:24:40,416 - server - INFO - ‚úÖ Agent SILENT - User said 2 word(s): 'Hell o.' - Processing...
2025-12-30T03:24:40.482887799Z [err]  2025-12-30 03:24:40,426 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Hell o.
2025-12-30T03:24:40.482894215Z [err]  2025-12-30 03:24:40,426 - core_calling_service - INFO - üë§ User stopped speaking for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:40.482899437Z [err]  2025-12-30 03:24:40,427 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-30T03:24:40.482905361Z [err]  2025-12-30 03:24:40,427 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+20ms
2025-12-30T03:24:40.482910655Z [err]  2025-12-30 03:24:40,427 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 20ms (Soniox model: stt-rt-v3)
2025-12-30T03:24:40.482916026Z [err]  2025-12-30 03:24:40,427 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-30T03:24:40.482921424Z [err]  2025-12-30 03:24:40,427 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-30T03:24:40.482927104Z [err]  2025-12-30 03:24:40,427 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:40.482935967Z [err]  2025-12-30 03:24:40,468 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:40.482941750Z [err]  2025-12-30 03:24:40,468 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '07a62833-8717-4000-abd4-54f8f1a22b5b', 'occurred_at': '2025-12-30T03:24:40.263239Z', 'payload': {'call_control_id': 'v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg', 'call_leg_id': '0e98908a-e52f-11f0-8b5e-02420aef991f', 'call_session_id': '0e95fcb2-e52f-11f0-9a07-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'wWD2lXVWKA', 'start_time': '2025-12-30T03:24:40.263239Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:40.483339678Z [err]  2025-12-30 03:24:40,468 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:40.483345889Z [err]  2025-12-30 03:24:40,468 - server - INFO - üì® ================================================
2025-12-30T03:24:40.483351282Z [inf]  100.64.0.2:59914 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:40.489212956Z [err]  2025-12-30 03:24:40,487 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:40.489218645Z [err]  2025-12-30 03:24:40,487 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:40.489222705Z [err]  2025-12-30 03:24:40,487 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-30T03:24:40.532653364Z [err]  2025-12-30 03:24:40,527 - server - INFO - üìù Saved user transcript to database
2025-12-30T03:24:40.532661708Z [err]  2025-12-30 03:24:40,527 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:40.532667480Z [err]  2025-12-30 03:24:40,528 - core_calling_service - INFO - ‚è±Ô∏è [03:24:40.527] üì• process_user_input() ENTRY - text: 'Hell o....'
2025-12-30T03:24:40.532673131Z [err]  2025-12-30 03:24:40,528 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:40.532679261Z [err]  2025-12-30 03:24:40,528 - core_calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg: User spoke while Silence Greeting was triggering
2025-12-30T03:24:40.555331512Z [err]  2025-12-30 03:24:40,552 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T03:24:40.555336510Z [err]  2025-12-30 03:24:40,552 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:40.992455006Z [err]  2025-12-30 03:24:40,989 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:40.992460146Z [err]  2025-12-30 03:24:40,989 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:40.992466821Z [err]  2025-12-30 03:24:40,989 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-30T03:24:41.031642217Z [err]  2025-12-30 03:24:41,030 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg/actions/playback_stop "HTTP/1.1 200 OK"
2025-12-30T03:24:41.033638318Z [err]  2025-12-30 03:24:41,031 - telnyx_service - INFO - ‚úÖ Successfully stopped audio playback
2025-12-30T03:24:41.033645670Z [err]  2025-12-30 03:24:41,031 - core_calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-30T03:24:41.033654099Z [err]  2025-12-30 03:24:41,031 - core_calling_service - INFO - ‚úÖ BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-30T03:24:41.033660307Z [err]  2025-12-30 03:24:41,032 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:41.036286077Z [err]  2025-12-30 03:24:41,033 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Hell o.
2025-12-30T03:24:41.036293980Z [err]  2025-12-30 03:24:41,033 - core_calling_service - INFO - ‚è∏Ô∏è User spoke (1767065080.4148653) BEFORE greeting could be heard (1767065081.7923162)
2025-12-30T03:24:41.036299221Z [err]  2025-12-30 03:24:41,033 - core_calling_service - INFO - ‚è∏Ô∏è Playback API called at 1767065079.7923162, buffer window: 2.0s
2025-12-30T03:24:41.036304038Z [err]  2025-12-30 03:24:41,033 - core_calling_service - INFO - ‚è∏Ô∏è Skipping transition eval - user hasn't heard greeting yet, will deliver it as response
2025-12-30T03:24:41.036308718Z [err]  2025-12-30 03:24:41,033 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 0ms
2025-12-30T03:24:41.036331975Z [err]  2025-12-30 03:24:41,033 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg (TTL: 3600s)
2025-12-30T03:24:41.036337820Z [err]  2025-12-30 03:24:41,033 - core_calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-30T03:24:41.036342990Z [err]  2025-12-30 03:24:41,033 - core_calling_service - INFO - ‚è±Ô∏è [03:24:41.033] ‚è© About to call _process_call_flow_streaming()
2025-12-30T03:24:41.036347664Z [err]  2025-12-30 03:24:41,033 - core_calling_service - INFO - ‚è±Ô∏è [03:24:41.033] üîÄ Agent type: call_flow, calling flow processor...
2025-12-30T03:24:41.036352792Z [err]  2025-12-30 03:24:41,033 - core_calling_service - INFO - ‚è±Ô∏è [03:24:41.033] üîÄ _process_call_flow_streaming() ENTRY
2025-12-30T03:24:41.036357478Z [err]  2025-12-30 03:24:41,033 - core_calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-30T03:24:41.036362174Z [err]  2025-12-30 03:24:41,033 - core_calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-30T03:24:41.036366686Z [err]  2025-12-30 03:24:41,033 - core_calling_service - INFO - ‚è±Ô∏è [03:24:41.033] üîÄ About to call _follow_transition() for: Hell o....
2025-12-30T03:24:41.038903237Z [err]  2025-12-30 03:24:41,033 - core_calling_service - INFO - ‚è±Ô∏è [03:24:41.033] ‚úÖ Node selected, about to process content...
2025-12-30T03:24:41.038913383Z [err]  2025-12-30 03:24:41,033 - core_calling_service - INFO - üîß Replaced {{now}} with Monday, December 29, 2025 at 10:24 PM EST in content
2025-12-30T03:24:41.038919880Z [err]  2025-12-30 03:24:41,033 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-30T03:24:41.038925081Z [err]  2025-12-30 03:24:41,033 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-30T03:24:41.038929431Z [err]  2025-12-30 03:24:41,034 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-30T03:24:41.038934388Z [err]  2025-12-30 03:24:41,034 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-30T03:24:41.038938091Z [err]  2025-12-30 03:24:41,034 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-30T03:24:41.038941560Z [err]  2025-12-30 03:24:41,034 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-30T03:24:41.038949770Z [err]  2025-12-30 03:24:41,034 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-30T03:24:41.038953929Z [err]  2025-12-30 03:24:41,034 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-30T03:24:41.038958342Z [err]  2025-12-30 03:24:41,034 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-30T03:24:41.038962146Z [err]  2025-12-30 03:24:41,034 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-30T03:24:41.038968082Z [err]  2025-12-30 03:24:41,034 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-30T03:24:41.040037675Z [err]  2025-12-30 03:24:41,034 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-30T03:24:41.040061667Z [err]  2025-12-30 03:24:41,034 - core_calling_service - INFO - ‚è±Ô∏è [03:24:41.034] üìÑ About to process content (mode=script, length=9)
2025-12-30T03:24:41.040070944Z [err]  2025-12-30 03:24:41,034 - core_calling_service - INFO - ‚è∏Ô∏è Skip sticky-prevention - delivering script as response to user's opener
2025-12-30T03:24:41.040077031Z [err]  2025-12-30 03:24:41,034 - server - INFO - üì§ Sentence arrived from LLM: Kendrick?...
2025-12-30T03:24:41.040083074Z [err]  2025-12-30 03:24:41,034 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 607ms
2025-12-30T03:24:41.040089215Z [err]  2025-12-30 03:24:41,034 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-30T03:24:41.040095412Z [err]  2025-12-30 03:24:41,034 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:41.040100968Z [err]  2025-12-30 03:24:41,034 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-30T03:24:41.067261522Z [err]  2025-12-30 03:24:41,056 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:41.067271008Z [err]  2025-12-30 03:24:41,056 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'fac08cb6-dcc1-4ad1-b1ec-f4b42ce086d7', 'occurred_at': '2025-12-30T03:24:40.843248Z', 'payload': {'call_control_id': 'v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg', 'call_leg_id': '0e98908a-e52f-11f0-8b5e-02420aef991f', 'call_session_id': '0e95fcb2-e52f-11f0-9a07-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'ni-WfjeAKg', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:41.067278109Z [err]  2025-12-30 03:24:41,056 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:41.067283324Z [err]  2025-12-30 03:24:41,056 - server - INFO - üì® ================================================
2025-12-30T03:24:41.067288374Z [err]  2025-12-30 03:24:41,062 - redis_service - INFO - ‚ûñ Removed playback ni-WfjeAKg, 0 remaining for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:41.067293343Z [err]  2025-12-30 03:24:41,062 - server - INFO - üîä Redis: Removed playback ni-WfjeAKg, 0 remaining
2025-12-30T03:24:41.067298358Z [err]  2025-12-30 03:24:41,062 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-30T03:24:41.067303232Z [err]  2025-12-30 03:24:41,064 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-30T03:24:41.067308471Z [inf]  100.64.0.2:59914 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:41.493034009Z [err]  2025-12-30 03:24:41,286 - server - INFO - üì® ================================================
2025-12-30T03:24:41.493042983Z [inf]  100.64.0.14:55134 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:41.493048885Z [err]  2025-12-30 03:24:41,313 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:41.493053787Z [err]  2025-12-30 03:24:41,313 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': 'c5bed18a-9552-4c73-90f0-4f4c8dea24d9', 'occurred_at': '2025-12-30T03:24:40.743236Z', 'payload': {'call_control_id': 'v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg', 'call_leg_id': '0e98908a-e52f-11f0-8b5e-02420aef991f', 'call_session_id': '0e95fcb2-e52f-11f0-9a07-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:41.493084475Z [err]  2025-12-30 03:24:41,128 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:41.493091477Z [err]  2025-12-30 03:24:41,222 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:41.493098698Z [err]  2025-12-30 03:24:41,286 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:41.493105185Z [err]  2025-12-30 03:24:41,286 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '56ea9551-a0ab-462c-8ddc-659d52d68d9f', 'occurred_at': '2025-12-30T03:24:40.683239Z', 'payload': {'call_control_id': 'v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg', 'call_leg_id': '0e98908a-e52f-11f0-8b5e-02420aef991f', 'call_session_id': '0e95fcb2-e52f-11f0-9a07-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'ni-WfjeAKg'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:41.493111854Z [err]  2025-12-30 03:24:41,286 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:41.495172579Z [err]  2025-12-30 03:24:41,314 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:41.495177962Z [err]  2025-12-30 03:24:41,314 - server - INFO - üì® ================================================
2025-12-30T03:24:41.495183486Z [inf]  100.64.0.10:57860 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:41.495188371Z [err]  2025-12-30 03:24:41,316 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:41.495193917Z [err]  2025-12-30 03:24:41,336 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T03:24:41.495199387Z [err]  2025-12-30 03:24:41,336 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-30T03:24:41.495205105Z [err]  2025-12-30 03:24:41,336 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-30T03:24:41.495211072Z [err]  2025-12-30 03:24:41,336 - persistent_tts_service - INFO - üîå [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Establishing persistent TTS WebSocket...
2025-12-30T03:24:41.495217120Z [err]  2025-12-30 03:24:41,336 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-30T03:24:41.495222855Z [err]  2025-12-30 03:24:41,336 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-30T03:24:41.495228762Z [err]  2025-12-30 03:24:41,336 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-30T03:24:41.495234444Z [err]  2025-12-30 03:24:41,467 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-30T03:24:41.496143475Z [err]  2025-12-30 03:24:41,467 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-30T03:24:41.496147621Z [err]  2025-12-30 03:24:41,467 - persistent_tts_service - INFO - ‚úÖ [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Persistent TTS WebSocket established
2025-12-30T03:24:41.496151733Z [err]  2025-12-30 03:24:41,467 - persistent_tts_service - INFO - üéß [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Audio receiver loop started
2025-12-30T03:24:41.496155219Z [err]  2025-12-30 03:24:41,467 - persistent_tts_service - INFO - üîä [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Comfort noise loop started
2025-12-30T03:24:41.496160537Z [err]  2025-12-30 03:24:41,467 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:41.496164517Z [err]  2025-12-30 03:24:41,468 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-30T03:24:41.496168533Z [err]  2025-12-30 03:24:41,468 - server - INFO - üîç Persistent TTS lookup: call_id=v3:Ghu_pt9zbBMcEw8ka..., session=FOUND
2025-12-30T03:24:41.496172256Z [err]  2025-12-30 03:24:41,468 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-30T03:24:41.496176049Z [err]  2025-12-30 03:24:41,468 - server - INFO - üéµ TTS task #1 started at +433ms
2025-12-30T03:24:41.496179896Z [err]  2025-12-30 03:24:41,468 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 1040ms
2025-12-30T03:24:41.496183552Z [err]  2025-12-30 03:24:41,468 - core_calling_service - INFO - üîä Silence tracking reset for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg (user responded)
2025-12-30T03:24:41.496187228Z [err]  2025-12-30 03:24:41,468 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-30T03:24:41.496191055Z [err]  2025-12-30 03:24:41,468 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-30T03:24:41.497199547Z [err]  2025-12-30 03:24:41,468 - core_calling_service - INFO - LLM response (0.94s): Kendrick?
2025-12-30T03:24:41.497207628Z [err]  2025-12-30 03:24:41,468 - core_calling_service - INFO - Total latency: 0.94s
2025-12-30T03:24:41.497213633Z [err]  2025-12-30 03:24:41,468 - server - INFO - ‚úÖ LLM finished in 1041ms, TTS tasks already running in background
2025-12-30T03:24:41.497214341Z [err]  2025-12-30 03:24:41,469 - persistent_tts_service - INFO - üöÄ [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-30T03:24:41.497218967Z [err]  2025-12-30 03:24:41,469 - server - INFO - üéµ Streaming 1 TTS chunks as they complete...
2025-12-30T03:24:41.497223154Z [err]  2025-12-30 03:24:41,469 - persistent_tts_service - INFO - üìä [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-30T03:24:41.497225176Z [err]  2025-12-30 03:24:41,469 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-30T03:24:41.497231021Z [err]  2025-12-30 03:24:41,469 - server - INFO -    1 sentences queued and playing seamlessly
2025-12-30T03:24:41.497236335Z [err]  2025-12-30 03:24:41,469 - persistent_tts_service - INFO - üéµ [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Playback consumer started
2025-12-30T03:24:41.497240835Z [err]  2025-12-30 03:24:41,469 - persistent_tts_service - INFO - üéß [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Audio Receiver Loop STARTED
2025-12-30T03:24:41.497245164Z [err]  2025-12-30 03:24:41,469 - persistent_tts_service - INFO - üíì [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Starting TTS keep-alive loop (every 15s)
2025-12-30T03:24:41.497249699Z [err]  2025-12-30 03:24:41,469 - persistent_tts_service - INFO - üîä [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Starting comfort noise loop
2025-12-30T03:24:41.497255097Z [err]  2025-12-30 03:24:41,469 - persistent_tts_service - INFO - üé§ [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Streaming sentence #1: Kendrick?...
2025-12-30T03:24:41.498793912Z [err]  2025-12-30 03:24:41,469 - persistent_tts_service - INFO - üéß [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Receiver processing sentence #1: 'Kendrick?...'
2025-12-30T03:24:41.498802905Z [err]  2025-12-30 03:24:41,469 - persistent_tts_service - INFO - üìä [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] DIAGNOSTIC: queue_latency=0ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-30T03:24:41.498813470Z [err]  2025-12-30 03:24:41,469 - server - INFO - ‚úÖ All 1 persistent TTS streams completed
2025-12-30T03:24:41.498818994Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-30T03:24:41.498825395Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 1042ms from user stop üöÄ
2025-12-30T03:24:41.498830967Z [err]  2025-12-30 03:24:41,470 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:41.498835717Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-30T03:24:41.498840740Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T03:24:41.498845282Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-30T03:24:41.498849975Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 20ms (provider: soniox, model: stt-rt-v3)
2025-12-30T03:24:41.498854301Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 1041ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-30T03:24:41.498858527Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 435ms (provider: elevenlabs, websocket: False)
2025-12-30T03:24:41.500340058Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 1043ms (user stopped ‚Üí play_audio_url called)
2025-12-30T03:24:41.500348088Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-30T03:24:41.500355490Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-30T03:24:41.500360780Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-30T03:24:41.500365281Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-30T03:24:41.500370123Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-30T03:24:41.500375000Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 1343ms estimated
2025-12-30T03:24:41.500380839Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 9 chars, 1 sentences
2025-12-30T03:24:41.500385319Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Hell o....'
2025-12-30T03:24:41.500390408Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: 'Kendrick?...'
2025-12-30T03:24:41.500394631Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-30T03:24:41.500398645Z [err]  2025-12-30 03:24:41,470 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T03:24:41.500403250Z [err]  2025-12-30 03:24:41,490 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-30T03:24:41.500408067Z [err]  2025-12-30 03:24:41,490 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767065081.490774 for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:41.501752419Z [err]  2025-12-30 03:24:41,490 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:41.674043012Z [err]  2025-12-30 03:24:41,670 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 1496ms)
2025-12-30T03:24:41.674051535Z [err]  2025-12-30 03:24:41,671 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-30T03:24:41.674056682Z [err]  2025-12-30 03:24:41,671 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-30T03:24:41.709738277Z [err]  2025-12-30 03:24:41,707 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 237ms
2025-12-30T03:24:41.709743013Z [err]  2025-12-30 03:24:41,707 - persistent_tts_service - INFO - üì§ Sending 7043 bytes of audio (45 chunks, 0.9s duration) via WebSocket
2025-12-30T03:24:41.709747493Z [err]  2025-12-30 03:24:41,707 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-30T03:24:41.709751968Z [err]  2025-12-30 03:24:41,707 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +0.9s (total: 0.9s from now)
2025-12-30T03:24:41.709756226Z [err]  2025-12-30 03:24:41,708 - persistent_tts_service - INFO - ‚úÖ Sent 45 audio chunks via WebSocket
2025-12-30T03:24:42.489321134Z [err]  2025-12-30 03:24:42,486 - server - INFO - üì§ Audio flowing: 295 packets sent to Soniox (5s update)
2025-12-30T03:24:42.710493328Z [err]  2025-12-30 03:24:42,708 - persistent_tts_service - INFO - üîá [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] FLOOR RELEASED (is_holding_floor=False)
2025-12-30T03:24:43.712723379Z [err]  2025-12-30 03:24:43,707 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-30T03:24:43.712730482Z [err]  2025-12-30 03:24:43,707 - persistent_tts_service - INFO - ‚úÖ [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Receiver finished sentence #1: 1 chunks in 2238ms
2025-12-30T03:24:45.936816633Z [err]  2025-12-30 03:24:45,929 - server - INFO - üî§ RAW TOKENS: [" Ye"?]
2025-12-30T03:24:45.936821325Z [err]  2025-12-30 03:24:45,929 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user started speaking) for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:45.936825309Z [err]  2025-12-30 03:24:45,929 - core_calling_service - INFO - üîä Silence timer reset for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg (user started speaking)
2025-12-30T03:24:45.936829357Z [err]  2025-12-30 03:24:45,930 - core_calling_service - INFO - üë§ User started speaking for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:45.936833245Z [err]  2025-12-30 03:24:45,930 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-30T03:24:45.936864233Z [err]  2025-12-30 03:24:45,930 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Ye' | Generating: False
2025-12-30T03:24:46.056143147Z [err]  2025-12-30 03:24:46,050 - server - INFO - üî§ RAW TOKENS: [" Ye"‚úì, "ah."‚úì, "<end>"‚úì]
2025-12-30T03:24:46.056147776Z [err]  2025-12-30 03:24:46,050 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-30T03:24:46.056151617Z [err]  2025-12-30 03:24:46,050 - server - INFO - üßπ Cleaned transcript: ' Ye ah.' -> 'Yeah.'
2025-12-30T03:24:46.056155660Z [err]  2025-12-30 03:24:46,050 - server - INFO - üì• FINAL TOKENS: 'Yeah.' (2 tokens)
2025-12-30T03:24:46.056159517Z [err]  2025-12-30 03:24:46,050 - server - INFO - üé§ Soniox final transcript: 'Yeah.'
2025-12-30T03:24:46.056163439Z [err]  2025-12-30 03:24:46,050 - server - INFO - üîç FILTER CHECK: words=1, is_filler=True, is_garbled=False, tts_speaking=False, time_until_done=-3.5s, generating=False, playbacks=0, is_active=False
2025-12-30T03:24:46.056167544Z [err]  2025-12-30 03:24:46,050 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-30T03:24:46.056171479Z [err]  2025-12-30 03:24:46,050 - server - INFO - ‚è±Ô∏è [03:24:46.050] üìù FINAL TRANSCRIPT RECEIVED: 'Yeah.'
2025-12-30T03:24:46.056176036Z [err]  2025-12-30 03:24:46,050 - server - INFO - ‚è±Ô∏è [03:24:46.050] STT endpoint detection latency: 1ms
2025-12-30T03:24:46.056179953Z [err]  2025-12-30 03:24:46,050 - server - INFO - ‚è±Ô∏è [03:24:46.050] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-30T03:24:46.056185180Z [err]  2025-12-30 03:24:46,050 - server - INFO - ‚è±Ô∏è User spoke at 1767065086.0506153
2025-12-30T03:24:46.056189444Z [err]  2025-12-30 03:24:46,051 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg (TTL: 3600s)
2025-12-30T03:24:46.056193354Z [err]  2025-12-30 03:24:46,051 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-30T03:24:46.056197369Z [err]  2025-12-30 03:24:46,051 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Yeah.' - Processing...
2025-12-30T03:24:46.063302717Z [err]  2025-12-30 03:24:46,061 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Yeah.
2025-12-30T03:24:46.063308584Z [err]  2025-12-30 03:24:46,061 - core_calling_service - INFO - üë§ User stopped speaking for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:46.069943128Z [err]  2025-12-30 03:24:46,064 - server - INFO - ‚úÖ User starting new turn - resetting agent speaking flag
2025-12-30T03:24:46.069949356Z [err]  2025-12-30 03:24:46,064 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-30T03:24:46.069953442Z [err]  2025-12-30 03:24:46,064 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+15ms
2025-12-30T03:24:46.069958061Z [err]  2025-12-30 03:24:46,064 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 15ms (Soniox model: stt-rt-v3)
2025-12-30T03:24:46.069962138Z [err]  2025-12-30 03:24:46,064 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-30T03:24:46.069965943Z [err]  2025-12-30 03:24:46,064 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-30T03:24:46.069970057Z [err]  2025-12-30 03:24:46,064 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:46.455739680Z [err]  2025-12-30 03:24:46,165 - server - INFO - üìù Saved user transcript to database
2025-12-30T03:24:46.455744971Z [err]  2025-12-30 03:24:46,165 - core_calling_service - INFO - ‚è±Ô∏è [03:24:46.165] üì• process_user_input() ENTRY - text: 'Yeah....'
2025-12-30T03:24:46.455751018Z [err]  2025-12-30 03:24:46,166 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:46.455757739Z [err]  2025-12-30 03:24:46,166 - core_calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg: User spoke while Silence Greeting was triggering
2025-12-30T03:24:46.455806537Z [err]  2025-12-30 03:24:46,184 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T03:24:46.455816627Z [err]  2025-12-30 03:24:46,184 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:46.623654541Z [err]  2025-12-30 03:24:46,616 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg/actions/playback_stop "HTTP/1.1 200 OK"
2025-12-30T03:24:46.623664857Z [err]  2025-12-30 03:24:46,616 - telnyx_service - INFO - ‚úÖ Successfully stopped audio playback
2025-12-30T03:24:46.623670921Z [err]  2025-12-30 03:24:46,617 - core_calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-30T03:24:46.623675895Z [err]  2025-12-30 03:24:46,617 - core_calling_service - INFO - ‚úÖ BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-30T03:24:46.623683438Z [err]  2025-12-30 03:24:46,617 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:46.623689160Z [err]  2025-12-30 03:24:46,619 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg (TTL: 3600s)
2025-12-30T03:24:46.623694919Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-30T03:24:46.623699889Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - ‚è±Ô∏è [03:24:46.619] ‚è© About to call _process_call_flow_streaming()
2025-12-30T03:24:46.623704382Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - ‚è±Ô∏è [03:24:46.619] üîÄ Agent type: call_flow, calling flow processor...
2025-12-30T03:24:46.623708702Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - ‚è±Ô∏è [03:24:46.619] üîÄ _process_call_flow_streaming() ENTRY
2025-12-30T03:24:46.623713613Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - Flow processing - History length: 5, Is first: False
2025-12-30T03:24:46.623718014Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-30T03:24:46.623722815Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - ‚è±Ô∏è [03:24:46.619] üîÄ About to call _follow_transition() for: Yeah....
2025-12-30T03:24:46.625630002Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Yeah.
2025-12-30T03:24:46.625638389Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - üîç Checking 'Hello=Yes' override [DEPLOYMENT VERIFIED] for msg='yeah' on node='Greeting'
2025-12-30T03:24:46.625643205Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - ‚ö° OVERRIDE TRIGGERED: 'Yeah.' on Greeting node -> Forcing Transition 0 (Index 0)
2025-12-30T03:24:46.625648249Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 0ms
2025-12-30T03:24:46.625652588Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - ‚è±Ô∏è [03:24:46.619] ‚úÖ Node selected, about to process content...
2025-12-30T03:24:46.625656747Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - üîß Replaced {{now}} with Monday, December 29, 2025 at 10:24 PM EST in content
2025-12-30T03:24:46.625660707Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-30T03:24:46.625664982Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-30T03:24:46.625669127Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-30T03:24:46.625676671Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-30T03:24:46.625680916Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-30T03:24:46.625685106Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-30T03:24:46.625690571Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-30T03:24:46.627141807Z [err]  2025-12-30 03:24:46,620 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-30T03:24:46.627150033Z [err]  2025-12-30 03:24:46,620 - server - INFO - üîç Persistent TTS lookup: call_id=v3:Ghu_pt9zbBMcEw8ka..., session=FOUND
2025-12-30T03:24:46.627156409Z [err]  2025-12-30 03:24:46,620 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-30T03:24:46.627162412Z [err]  2025-12-30 03:24:46,620 - server - INFO - üéµ TTS task #1 started at +0ms
2025-12-30T03:24:46.627169048Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-30T03:24:46.627169886Z [err]  2025-12-30 03:24:46,620 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 555ms
2025-12-30T03:24:46.627177761Z [err]  2025-12-30 03:24:46,620 - core_calling_service - INFO - üì§ Streamed script sentence 1/2: This is Jake......
2025-12-30T03:24:46.627178675Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-30T03:24:46.627185927Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 89 chars) - will return text instantly
2025-12-30T03:24:46.627190388Z [err]  2025-12-30 03:24:46,619 - core_calling_service - INFO - Using flow node: Node Prompt: N001B_IntroAndHelpRequest_Only (V3 - Follows Name Confirmation) (type: conversation, mode: script)
2025-12-30T03:24:46.627194802Z [err]  2025-12-30 03:24:46,620 - core_calling_service - INFO - ‚è±Ô∏è [03:24:46.620] üìÑ About to process content (mode=script, length=89)
2025-12-30T03:24:46.627199489Z [err]  2025-12-30 03:24:46,620 - core_calling_service - INFO - üì§ Streaming script as 2 sentence(s)
2025-12-30T03:24:46.627203664Z [err]  2025-12-30 03:24:46,620 - server - INFO - üì§ Sentence arrived from LLM: This is Jake......
2025-12-30T03:24:46.627207697Z [err]  2025-12-30 03:24:46,620 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 555ms
2025-12-30T03:24:46.628698846Z [err]  2025-12-30 03:24:46,620 - server - INFO - üì§ Sentence arrived from LLM: I was just, um, wondering if you could possibly he...
2025-12-30T03:24:46.628709525Z [err]  2025-12-30 03:24:46,620 - server - INFO - üîç Persistent TTS lookup: call_id=v3:Ghu_pt9zbBMcEw8ka..., session=FOUND
2025-12-30T03:24:46.628715503Z [err]  2025-12-30 03:24:46,620 - server - INFO - üöÄ Streaming sentence #2 via persistent WebSocket
2025-12-30T03:24:46.628720300Z [err]  2025-12-30 03:24:46,620 - server - INFO - üéµ TTS task #2 started at +0ms
2025-12-30T03:24:46.628725227Z [err]  2025-12-30 03:24:46,620 - core_calling_service - INFO - üì§ Streamed script sentence 2/2: I was just, um, wondering if you could possibly he...
2025-12-30T03:24:46.628730423Z [err]  2025-12-30 03:24:46,620 - core_calling_service - INFO - üîä Silence tracking reset for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg (user responded)
2025-12-30T03:24:46.628737817Z [err]  2025-12-30 03:24:46,620 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-30T03:24:46.628742470Z [err]  2025-12-30 03:24:46,620 - core_calling_service - INFO - üíæ Storing node ID 1763159750250 in conversation history
2025-12-30T03:24:46.628747524Z [err]  2025-12-30 03:24:46,620 - core_calling_service - INFO - LLM response (0.46s): This is Jake... I was just, um, wondering if you could possibly help me out for a moment?
2025-12-30T03:24:46.628752044Z [err]  2025-12-30 03:24:46,620 - core_calling_service - INFO - Total latency: 0.46s
2025-12-30T03:24:46.628756701Z [err]  2025-12-30 03:24:46,621 - server - INFO - ‚úÖ LLM finished in 557ms, TTS tasks already running in background
2025-12-30T03:24:46.628761020Z [err]  2025-12-30 03:24:46,622 - server - INFO - üéµ Streaming 2 TTS chunks as they complete...
2025-12-30T03:24:46.628765565Z [err]  2025-12-30 03:24:46,622 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-30T03:24:46.630107676Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚úÖ All 2 persistent TTS streams completed
2025-12-30T03:24:46.630129376Z [err]  2025-12-30 03:24:46,622 - server - INFO -    2 sentences queued and playing seamlessly
2025-12-30T03:24:46.630133532Z [err]  2025-12-30 03:24:46,622 - persistent_tts_service - INFO - üé§ [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Streaming sentence #2: This is Jake......
2025-12-30T03:24:46.630137185Z [err]  2025-12-30 03:24:46,622 - persistent_tts_service - INFO - üöÄ [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Sent sentence #2 (NON-BLOCKING) in 0ms
2025-12-30T03:24:46.630141386Z [err]  2025-12-30 03:24:46,622 - persistent_tts_service - INFO - üìä [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-30T03:24:46.630145321Z [err]  2025-12-30 03:24:46,622 - persistent_tts_service - INFO - üé§ [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Streaming sentence #3: I was just, um, wondering if you could possibly he...
2025-12-30T03:24:46.630149075Z [err]  2025-12-30 03:24:46,622 - persistent_tts_service - INFO - üöÄ [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Sent sentence #3 (NON-BLOCKING) in 0ms
2025-12-30T03:24:46.630152696Z [err]  2025-12-30 03:24:46,622 - persistent_tts_service - INFO - üìä [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] DIAGNOSTIC: pending_sentences=2, audio_queue=0, is_first=False, is_last=False
2025-12-30T03:24:46.630156384Z [err]  2025-12-30 03:24:46,623 - persistent_tts_service - INFO - üéß [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Receiver processing sentence #2: 'This is Jake......'
2025-12-30T03:24:46.630160027Z [err]  2025-12-30 03:24:46,623 - persistent_tts_service - INFO - üìä [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] DIAGNOSTIC: queue_latency=0ms, pending_sentences=1, audio_queue=0, interrupted=False
2025-12-30T03:24:46.631406091Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-30T03:24:46.631410637Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 558ms (user stopped ‚Üí play_audio_url called)
2025-12-30T03:24:46.631412462Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 558ms from user stop üöÄ
2025-12-30T03:24:46.631417132Z [err]  2025-12-30 03:24:46,623 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:46.631419182Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-30T03:24:46.631421942Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-30T03:24:46.631426376Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-30T03:24:46.631427301Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T03:24:46.631432815Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-30T03:24:46.631433013Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-30T03:24:46.631437774Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 15ms (provider: soniox, model: stt-rt-v3)
2025-12-30T03:24:46.631441775Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 557ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-30T03:24:46.631446341Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 3ms (provider: elevenlabs, websocket: False)
2025-12-30T03:24:46.632716000Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-30T03:24:46.632724389Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-30T03:24:46.632730931Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 858ms estimated
2025-12-30T03:24:46.632736909Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 89 chars, 2 sentences
2025-12-30T03:24:46.632742672Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Yeah....'
2025-12-30T03:24:46.632748165Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: 'This is Jake... I was just, um, wondering if you could possi...'
2025-12-30T03:24:46.632755650Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-30T03:24:46.632761169Z [err]  2025-12-30 03:24:46,623 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T03:24:46.827251390Z [err]  2025-12-30 03:24:46,824 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Node Prompt: N001B_IntroAndHelpRequest_Only (V3 - Follows Name Confirmation), Dead Air: 575ms)
2025-12-30T03:24:46.827259314Z [err]  2025-12-30 03:24:46,824 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-30T03:24:46.827266716Z [err]  2025-12-30 03:24:46,824 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-30T03:24:46.891409901Z [err]  2025-12-30 03:24:46,889 - persistent_tts_service - INFO - üì§ Sending 8916 bytes of audio (56 chunks, 1.1s duration) via WebSocket
2025-12-30T03:24:46.891416513Z [err]  2025-12-30 03:24:46,889 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-30T03:24:46.891423058Z [err]  2025-12-30 03:24:46,889 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.1s (total: 1.1s from now)
2025-12-30T03:24:46.891429419Z [err]  2025-12-30 03:24:46,889 - persistent_tts_service - INFO - ‚úÖ Sent 56 audio chunks via WebSocket
2025-12-30T03:24:47.125378640Z [err]  2025-12-30 03:24:47,104 - persistent_tts_service - INFO - üì§ Sending 13793 bytes of audio (87 chunks, 1.7s duration) via WebSocket
2025-12-30T03:24:47.125385035Z [err]  2025-12-30 03:24:47,104 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-30T03:24:47.125392197Z [err]  2025-12-30 03:24:47,104 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.7s (total: 2.6s from now)
2025-12-30T03:24:47.125398622Z [err]  2025-12-30 03:24:47,105 - persistent_tts_service - INFO - ‚úÖ Sent 87 audio chunks via WebSocket
2025-12-30T03:24:47.125408980Z [err]  2025-12-30 03:24:47,105 - persistent_tts_service - INFO - üì§ Sending 697 bytes of audio (5 chunks, 0.1s duration) via WebSocket
2025-12-30T03:24:47.125414565Z [err]  2025-12-30 03:24:47,105 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-30T03:24:47.125420569Z [err]  2025-12-30 03:24:47,105 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +0.1s (total: 2.7s from now)
2025-12-30T03:24:47.125427767Z [err]  2025-12-30 03:24:47,106 - persistent_tts_service - INFO - ‚úÖ Sent 5 audio chunks via WebSocket
2025-12-30T03:24:47.481785579Z [err]  2025-12-30 03:24:47,291 - persistent_tts_service - INFO - üì§ Sending 20062 bytes of audio (126 chunks, 2.5s duration) via WebSocket
2025-12-30T03:24:47.481789431Z [err]  2025-12-30 03:24:47,291 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-30T03:24:47.481792972Z [err]  2025-12-30 03:24:47,291 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +2.5s (total: 5.0s from now)
2025-12-30T03:24:47.481796818Z [err]  2025-12-30 03:24:47,293 - persistent_tts_service - INFO - ‚úÖ Sent 126 audio chunks via WebSocket
2025-12-30T03:24:47.508626942Z [err]  2025-12-30 03:24:47,506 - server - INFO - üì§ Audio flowing: 546 packets sent to Soniox (5s update)
2025-12-30T03:24:48.554128421Z [err]  2025-12-30 03:24:48,231 - server - INFO - üé§ Soniox receiver alive - 13 messages received in last 10s
2025-12-30T03:24:49.446981000Z [err]  2025-12-30 03:24:49,273 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 626 total packets
2025-12-30T03:24:49.446985522Z [err]  [2025-12-30 03:24:49 +0000] [6] [INFO] connection closed
2025-12-30T03:24:49.446989515Z [err]  2025-12-30 03:24:49,291 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-30T03:24:49.446993939Z [err]  2025-12-30 03:24:49,291 - persistent_tts_service - INFO - ‚úÖ [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Receiver finished sentence #2: 4 chunks in 2668ms
2025-12-30T03:24:49.446998991Z [err]  2025-12-30 03:24:49,291 - persistent_tts_service - INFO - üéß [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Receiver processing sentence #3: 'I was just, um, wondering if y...'
2025-12-30T03:24:49.447003008Z [err]  2025-12-30 03:24:49,291 - persistent_tts_service - INFO - üìä [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] DIAGNOSTIC: queue_latency=2668ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-30T03:24:49.447007717Z [err]  2025-12-30 03:24:49,425 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:49.447011968Z [err]  2025-12-30 03:24:49,425 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'eb8df4fe-59a8-4cdf-8978-69856ade14b4', 'occurred_at': '2025-12-30T03:24:49.063241Z', 'payload': {'call_control_id': 'v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg', 'call_leg_id': '0e98908a-e52f-11f0-8b5e-02420aef991f', 'call_session_id': '0e95fcb2-e52f-11f0-9a07-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T03:24:49.063241Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'wWD2lXVWKA', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:49.448697510Z [err]  2025-12-30 03:24:49,425 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:49.448705686Z [err]  2025-12-30 03:24:49,425 - server - INFO - üì® ================================================
2025-12-30T03:24:49.448711627Z [err]  2025-12-30 03:24:49,427 - redis_service - INFO - ‚ûñ Removed playback wWD2lXVWKA, 0 remaining for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:49.448717185Z [err]  2025-12-30 03:24:49,427 - server - INFO - üîä Redis: Removed playback wWD2lXVWKA, 0 remaining
2025-12-30T03:24:49.448722840Z [err]  2025-12-30 03:24:49,427 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-30T03:24:49.448738865Z [err]  2025-12-30 03:24:49,428 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:49.448744180Z [err]  2025-12-30 03:24:49,428 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': '4cb8ac76-b2b1-43ac-bfe2-879ccdc438f7', 'occurred_at': '2025-12-30T03:24:49.023249Z', 'payload': {'call_control_id': 'v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg', 'call_leg_id': '0e98908a-e52f-11f0-8b5e-02420aef991f', 'call_quality_stats': {'inbound': {'jitter_max_variance': '56.07', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '651', 'skip_packet_count': '18'}, 'outbound': {'packet_count': '629', 'skip_packet_count': '0'}}, 'call_session_id': '0e95fcb2-e52f-11f0-9a07-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T03:24:49.023249Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-30T03:24:32.363253Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:49.448749272Z [err]  2025-12-30 03:24:49,428 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:49.450545642Z [err]  2025-12-30 03:24:49,428 - server - INFO - üì® ================================================
2025-12-30T03:24:49.450553671Z [err]  2025-12-30 03:24:49,428 - server - INFO - üìû Call ended: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:49.450559131Z [err]  2025-12-30 03:24:49,428 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-30T03:24:49.450564714Z [err]  2025-12-30 03:24:49,428 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-30T03:24:49.450572232Z [err]  2025-12-30 03:24:49,428 - server - INFO - ‚úÖ Found session in active_telnyx_calls (local worker)
2025-12-30T03:24:49.450577969Z [err]  2025-12-30 03:24:49,428 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767065089.428762 for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:49.450583107Z [err]  2025-12-30 03:24:49,428 - server - INFO - ‚è±Ô∏è Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-30T03:24:49.450591075Z [inf]  100.64.0.14:55140 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:49.472809835Z [err]  2025-12-30 03:24:49,464 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:49.472817797Z [err]  2025-12-30 03:24:49,464 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': 'ff1dd42a-0db5-45fb-9da5-c79f5ea4a9fa', 'occurred_at': '2025-12-30T03:24:49.231835Z', 'payload': {'call_control_id': 'v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg', 'call_leg_id': '0e98908a-e52f-11f0-8b5e-02420aef991f', 'call_session_id': '0e95fcb2-e52f-11f0-9a07-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '17b99585-c6eb-4e37-aa57-34943ae8fb6f', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:49.472822699Z [err]  2025-12-30 03:24:49,464 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:49.472828259Z [err]  2025-12-30 03:24:49,464 - server - INFO - üì® ================================================
2025-12-30T03:24:49.472833801Z [inf]  100.64.0.2:57514 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:49.485977386Z [err]  2025-12-30 03:24:49,479 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:49.485985278Z [err]  2025-12-30 03:24:49,479 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': '14a3b5a1-93d9-4f50-8604-891149a98139', 'occurred_at': '2025-12-30T03:24:49.204496Z', 'payload': {'call_control_id': 'v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg', 'call_leg_id': '0e98908a-e52f-11f0-8b5e-02420aef991f', 'call_session_id': '0e95fcb2-e52f-11f0-9a07-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '17b99585-c6eb-4e37-aa57-34943ae8fb6f', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:49.485990869Z [err]  2025-12-30 03:24:49,479 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:49.485996540Z [err]  2025-12-30 03:24:49,479 - server - INFO - üì® ================================================
2025-12-30T03:24:49.486002249Z [inf]  100.64.0.15:54888 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:49.523017121Z [err]  2025-12-30 03:24:49,520 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-30T03:24:49.523024002Z [err]  2025-12-30 03:24:49,520 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767065089.5205038 for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:49.523028977Z [err]  2025-12-30 03:24:49,520 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:49.628695723Z [err]  2025-12-30 03:24:49,626 - server - INFO - üìù Updated call log: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:49.731185045Z [err]  2025-12-30 03:24:49,727 - server - INFO - ‚úÖ Finalized call log: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg (duration=13s, status=completed)
2025-12-30T03:24:49.831034958Z [err]  2025-12-30 03:24:49,827 - server - INFO - üì¶ Saved 10 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email']
2025-12-30T03:24:50.025789657Z [err]  2025-12-30 03:24:50,022 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (2.3s left)
2025-12-30T03:24:50.603956152Z [err]  2025-12-30 03:24:50,560 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:50.603994533Z [err]  2025-12-30 03:24:50,560 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '6f75498e-3abb-41ee-a80b-83be6bf6be1c', 'occurred_at': '2025-12-30T03:24:50.356116Z', 'payload': {'call_control_id': 'v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg', 'call_leg_id': '0e98908a-e52f-11f0-8b5e-02420aef991f', 'call_session_id': '0e95fcb2-e52f-11f0-9a07-02420aef991f', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T03:24:49.119110Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-30T03:24:49.119110Z', 'recording_id': '7c1d4d25-95a7-44a1-842a-309e3ca6b3b2', 'recording_started_at': '2025-12-30T03:24:38.980937Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-30/0e98908a-e52f-11f0-8b5e-02420aef991f-1767065078091840.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251230%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251230T032450Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=3d9b479a46fe5a93070d21e2a846a234789d724d9e2a56ebf35e1855dba377d1'}, 'start_time': '2025-12-30T03:24:38.980937Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:50.604000283Z [err]  2025-12-30 03:24:50,560 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:50.604005950Z [err]  2025-12-30 03:24:50,560 - server - INFO - üì® ================================================
2025-12-30T03:24:50.604014807Z [err]  2025-12-30 03:24:50,560 - server - INFO - üéôÔ∏è Recording saved for call: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:50.604036487Z [err]  2025-12-30 03:24:50,524 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (1.8s left)
2025-12-30T03:24:50.605599673Z [err]  2025-12-30 03:24:50,561 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:50.605606539Z [err]  2025-12-30 03:24:50,561 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=7c1d4d25-95a7-44a1-842a-309e3ca6b3b2, call_data=True
2025-12-30T03:24:50.605612324Z [err]  2025-12-30 03:24:50,589 - server - INFO - üìä Auto-added call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-30T03:24:50.658004625Z [err]  2025-12-30 03:24:50,655 - server - INFO - üíæ Saved recording URL and ID to database: 7c1d4d25-95a7-44a1-842a-309e3ca6b3b2
2025-12-30T03:24:50.658010832Z [err]  2025-12-30 03:24:50,655 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-30T03:24:50.658015393Z [err]  2025-12-30 03:24:50,655 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-30T03:24:50.787508981Z [err]  2025-12-30 03:24:50,784 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T03:24:50.787516186Z [err]  2025-12-30 03:24:50,785 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:50.787521849Z [err]  2025-12-30 03:24:50,785 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=No
2025-12-30T03:24:50.787526894Z [err]  2025-12-30 03:24:50,786 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-30T03:24:50.890692805Z [err]  2025-12-30 03:24:50,885 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-30T03:24:50.975552152Z [err]  2025-12-30 03:24:50,971 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-30/0e98908a-e52f-11f0-8b5e-02420aef991f-1767065078091840.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251230%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251230T032450Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=3d9b479a46fe5a93070d21e2a846a234789d724d9e2a56ebf35e1855dba377d1 "HTTP/1.1 200 OK"
2025-12-30T03:24:50.983782895Z [err]  2025-12-30 03:24:50,979 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-30T03:24:50.983796268Z [err]  2025-12-30 03:24:50,979 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-30T03:24:50.983803218Z [err]  2025-12-30 03:24:50,979 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-30T03:24:50.983809299Z [err]  2025-12-30 03:24:50,979 - server - INFO - üöÄ Triggered QC analysis for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:50.983816906Z [err]  2025-12-30 03:24:50,979 - server - INFO - üìä Triggered Campaign QC for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:50.983822879Z [err]  2025-12-30 03:24:50,979 - server - INFO - üìá Triggered CRM update for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:50.983829657Z [err]  2025-12-30 03:24:50,979 - persistent_tts_service - INFO - üîå [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Closing persistent TTS WebSocket...
2025-12-30T03:24:50.983835600Z [err]  2025-12-30 03:24:50,979 - server - INFO - üîç Starting QC analysis for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:50.983841567Z [err]  2025-12-30 03:24:50,980 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-30T03:24:50.983865606Z [err]  2025-12-30 03:24:50,981 - server - INFO - üìá CRM update starting for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T03:24:50.985795812Z [err]  2025-12-30 03:24:50,981 - server - INFO - üìá Normalized phone: +17708336397
2025-12-30T03:24:50.985804337Z [err]  2025-12-30 03:24:50,981 - server - INFO - üìá CRM: Got 10 variables from active session
2025-12-30T03:24:50.985810717Z [err]  2025-12-30 03:24:50,982 - persistent_tts_service - INFO - üõë [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Audio Receiver Loop CANCELLED
2025-12-30T03:24:50.985817927Z [err]  2025-12-30 03:24:50,982 - persistent_tts_service - INFO - üëã [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Audio Receiver Loop STOPPED
2025-12-30T03:24:50.985823468Z [err]  2025-12-30 03:24:50,982 - persistent_tts_service - INFO - üõë [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Playback consumer shutting down
2025-12-30T03:24:51.066858973Z [err]  2025-12-30 03:24:51,063 - server - INFO - ‚úÖ Downloaded 40794 bytes
2025-12-30T03:24:51.081847256Z [err]  2025-12-30 03:24:51,078 - server - INFO - üìù Converted transcript from 5 messages to 168 characters
2025-12-30T03:24:51.502489072Z [err]  2025-12-30 03:24:51,172 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:51.502496998Z [err]  2025-12-30 03:24:51,190 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T03:24:51.502504855Z [err]  2025-12-30 03:24:51,191 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-30T03:24:51.502514235Z [err]  2025-12-30 03:24:51,267 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-30T03:24:51.502522379Z [err]  2025-12-30 03:24:51,307 - server - INFO - ‚úÖ Split into 2 channels
2025-12-30T03:24:51.502530219Z [err]  2025-12-30 03:24:51,307 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-30T03:24:51.502537297Z [err]  2025-12-30 03:24:51,308 - server - INFO - üìä Channel 0: 220924 bytes
2025-12-30T03:24:51.502543876Z [err]  2025-12-30 03:24:51,308 - server - ERROR - ‚ùå No Soniox API key available
2025-12-30T03:24:51.502551067Z [err]  2025-12-30 03:24:51,308 - server - INFO - ‚ùå Channel 0: No speech
2025-12-30T03:24:51.502559131Z [err]  2025-12-30 03:24:51,308 - server - INFO - üìä Channel 1: 220924 bytes
2025-12-30T03:24:51.502565735Z [err]  2025-12-30 03:24:51,308 - server - ERROR - ‚ùå No Soniox API key available
2025-12-30T03:24:51.502573430Z [err]  2025-12-30 03:24:51,308 - server - INFO - ‚ùå Channel 1: No speech
2025-12-30T03:24:51.502583519Z [err]  2025-12-30 03:24:51,308 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-30T03:24:51.502590518Z [inf]  100.64.0.14:55140 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:51.502596863Z [err]  2025-12-30 03:24:51,362 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-30T03:24:51.502605857Z [err]  2025-12-30 03:24:51,456 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:51.534891134Z [err]  2025-12-30 03:24:51,529 - server - INFO - üìá CRM: Got 10 extracted variables
2025-12-30T03:24:51.534899442Z [err]  2025-12-30 03:24:51,529 - server - INFO - üìá CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email']
2025-12-30T03:24:51.555688921Z [err]  2025-12-30 03:24:51,550 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:51.581734668Z [err]  2025-12-30 03:24:51,575 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T03:24:51.581743869Z [err]  2025-12-30 03:24:51,575 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-30T03:24:51.581749869Z [err]  2025-12-30 03:24:51,575 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-30T03:24:51.581755282Z [err]  2025-12-30 03:24:51,575 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-30T03:24:52.520763724Z [err]  2025-12-30 03:24:52,432 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-30T03:24:52.520769498Z [err]  2025-12-30 03:24:52,434 - telnyx_service - INFO - ‚úÖ Call initiated: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:52.520774211Z [err]  2025-12-30 03:24:52,435 - persistent_tts_service - INFO - üîá [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] FLOOR RELEASED (is_holding_floor=False)
2025-12-30T03:24:52.520778782Z [err]  2025-12-30 03:24:52,437 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=5, logs_count=6, status=completed
2025-12-30T03:24:52.520783443Z [err]  2025-12-30 03:24:52,437 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-30T03:24:52.520791194Z [err]  2025-12-30 03:24:52,437 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T03:24:52.520795943Z [err]  2025-12-30 03:24:52,437 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:52.520800293Z [err]  2025-12-30 03:24:52,446 - elevenlabs_ws_service - INFO - üîå Closed ElevenLabs WebSocket connection
2025-12-30T03:24:52.520806799Z [err]  2025-12-30 03:24:52,446 - persistent_tts_service - INFO - ‚úÖ [Call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg] Persistent TTS WebSocket closed
2025-12-30T03:24:52.520811354Z [err]  2025-12-30 03:24:52,446 - persistent_tts_service - INFO - ‚úÖ Closed persistent TTS session for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:52.520815622Z [err]  2025-12-30 03:24:52,446 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:52.520820657Z [err]  2025-12-30 03:24:52,447 - redis_service - INFO - üßπ Deleted call data from Redis: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:52.521920256Z [err]  2025-12-30 03:24:52,447 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:52.521924794Z [inf]  100.64.0.11:34466 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:52.528500004Z [err]  2025-12-30 03:24:52,527 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:52.528511195Z [err]  2025-12-30 03:24:52,527 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': '57b1c104-0abf-4856-b549-ba2acdaa613a', 'occurred_at': '2025-12-30T03:24:52.240572Z', 'payload': {'call_control_id': 'v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ', 'call_leg_id': '1a7cc236-e52f-11f0-82ac-02420aef941f', 'call_session_id': '1a7a69c8-e52f-11f0-acd8-02420aef941f', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:52.528516557Z [err]  2025-12-30 03:24:52,527 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:52.528521418Z [err]  2025-12-30 03:24:52,527 - server - INFO - üì® ================================================
2025-12-30T03:24:52.528527333Z [err]  2025-12-30 03:24:52,527 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-30T03:24:52.528533882Z [inf]  100.64.0.10:43772 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:52.541735513Z [err]  2025-12-30 03:24:52,538 - server - INFO - üìù Created call log: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:52.541745760Z [err]  2025-12-30 03:24:52,538 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T03:24:52.541752940Z [err]  2025-12-30 03:24:52,538 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-30T03:24:52.543324143Z [err]  2025-12-30 03:24:52,538 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T03:24:52.543328377Z [err]  2025-12-30 03:24:52,538 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T03:24:52.550046473Z [err]  2025-12-30 03:24:52,545 - redis_service - INFO - üì¶ Stored call data in Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ (TTL: 3600s)
2025-12-30T03:24:52.550054939Z [err]  2025-12-30 03:24:52,545 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-30T03:24:52.550060975Z [err]  2025-12-30 03:24:52,545 - server - INFO - üìû Outbound call initiated: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:52.550067329Z [inf]  100.64.0.16:50054 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-30T03:24:52.557595977Z [err]  2025-12-30 03:24:52,555 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-30T03:24:52.647158380Z [err]  2025-12-30 03:24:52,642 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-30T03:24:52.647169417Z [err]  2025-12-30 03:24:52,642 - server - INFO -    Client: Address(host='100.64.0.14', port=14836)
2025-12-30T03:24:52.647176313Z [err]  2025-12-30 03:24:52,642 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'Pc8ms3WhAUBLAKrvOGWQyQ==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'j-dYgk5pRg-MWBLw9I3ezw', 'x-real-ip': '192.76.120.151', 'x-request-start': '1767065092419', 'accept-encoding': 'gzip'}
2025-12-30T03:24:52.647182132Z [err]  2025-12-30 03:24:52,642 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-30T03:24:52.647191407Z [err]  2025-12-30 03:24:52,642 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-30T03:24:52.647196365Z [err]  [2025-12-30 03:24:52 +0000] [6] [INFO] ('100.64.0.14', 14836) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-30T03:24:52.647201627Z [err]  2025-12-30 03:24:52,642 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-30T03:24:52.647206440Z [err]  [2025-12-30 03:24:52 +0000] [6] [INFO] connection open
2025-12-30T03:24:52.809246885Z [err]  2025-12-30 03:24:52,794 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-30T03:24:52.809254225Z [err]  2025-12-30 03:24:52,794 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-30T03:24:52.876626127Z [err]  2025-12-30 03:24:52,871 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-30T03:24:52.939165913Z [err]  2025-12-30 03:24:52,934 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T03:24:52.939172481Z [err]  2025-12-30 03:24:52,935 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-30T03:24:52.939177662Z [err]  2025-12-30 03:24:52,937 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:52.964704292Z [err]  2025-12-30 03:24:52,957 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-30T03:24:52.964715516Z [err]  2025-12-30 03:24:52,957 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-30T03:24:52.964722423Z [err]  2025-12-30 03:24:52,957 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-30T03:24:52.964728732Z [err]  2025-12-30 03:24:52,958 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-30T03:24:52.964735305Z [err]    File "/app/backend/server.py", line 9773, in trigger_campaign_qc_for_call
2025-12-30T03:24:52.964748723Z [err]      await run_full_qc_analysis(
2025-12-30T03:24:52.964758272Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-30T03:24:52.964762738Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-30T03:24:52.964767299Z [err]  
2025-12-30T03:24:53.557257943Z [err]  2025-12-30 03:24:53,323 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T03:24:53.557262600Z [err]  2025-12-30 03:24:53,324 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T03:24:53.557267030Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T03:24:53.557271516Z [err]  2025-12-30 03:24:53,324 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T03:24:53.557275697Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-30T03:24:53.557280635Z [err]  2025-12-30 03:24:53,325 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:53.557287128Z [err]  2025-12-30 03:24:53,438 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:53.557293291Z [err]  2025-12-30 03:24:53,507 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T03:24:53.557300217Z [err]  2025-12-30 03:24:53,508 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T03:24:53.557306222Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T03:24:53.557312297Z [err]  2025-12-30 03:24:53,508 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T03:24:53.557615391Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-30T03:24:53.557619576Z [err]  2025-12-30 03:24:53,508 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:53.946147115Z [err]  2025-12-30 03:24:53,940 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:54.495493735Z [err]  2025-12-30 03:24:54,197 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T03:24:54.495497762Z [err]  2025-12-30 03:24:54,198 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T03:24:54.495501874Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T03:24:54.495506027Z [err]  2025-12-30 03:24:54,198 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T03:24:54.495510131Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T03:24:54.495514371Z [err]  2025-12-30 03:24:54,291 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:54.495519334Z [err]  2025-12-30 03:24:54,291 - server - INFO - ‚úÖ QC analysis completed for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:54.495523010Z [err]  2025-12-30 03:24:54,291 - server - INFO - üìä Scores: Commitment=50, Conversion=20, Excellence=50
2025-12-30T03:24:54.495526935Z [err]  2025-12-30 03:24:54,441 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:54.495530913Z [err]  2025-12-30 03:24:54,474 - server - INFO - üìä Updated campaign_calls with QC scores for v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:54.658881353Z [err]  2025-12-30 03:24:54,647 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-30T03:24:54.749649222Z [err]  2025-12-30 03:24:54,733 - server - INFO - üè∑Ô∏è Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-30T03:24:54.749663714Z [err]  2025-12-30 03:24:54,733 - server - ERROR - ‚ùå Error in auto appointment detection for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg: 'str' object has no attribute 'get'
2025-12-30T03:24:54.897007516Z [err]  2025-12-30 03:24:54,887 - server - INFO - üì¨ Received Telnyx event: start
2025-12-30T03:24:54.897012430Z [err]  2025-12-30 03:24:54,887 - server - INFO - üé¨ Stream started for call: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:54.897019135Z [err]  2025-12-30 03:24:54,892 - redis_service - INFO - üì• Retrieved call data from Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:54.897024144Z [err]  2025-12-30 03:24:54,893 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-30T03:24:54.897029326Z [err]  2025-12-30 03:24:54,893 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-30T03:24:54.960981157Z [err]  2025-12-30 03:24:54,942 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:55.459111683Z [err]  2025-12-30 03:24:55,210 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:55.459116076Z [err]  2025-12-30 03:24:55,210 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': 'faf56651-dbee-4e4a-8463-205dd5ed372d', 'occurred_at': '2025-12-30T03:24:54.680565Z', 'payload': {'call_control_id': 'v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ', 'call_leg_id': '1a7cc236-e52f-11f0-82ac-02420aef941f', 'call_session_id': '1a7a69c8-e52f-11f0-acd8-02420aef941f', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-30T03:24:52.240572Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:55.459121703Z [err]  2025-12-30 03:24:55,210 - server - INFO - üéØ Event type: call.answered, Call ID: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:55.459128410Z [err]  2025-12-30 03:24:55,210 - server - INFO - üì® ================================================
2025-12-30T03:24:55.459133259Z [err]  2025-12-30 03:24:55,211 - server - INFO - ‚úÖ Call answered: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:55.459139603Z [err]  2025-12-30 03:24:55,313 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T03:24:55.459139882Z [err]  2025-12-30 03:24:55,215 - redis_service - INFO - üì• Retrieved call data from Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:55.459145301Z [err]  2025-12-30 03:24:55,221 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-30T03:24:55.459150025Z [err]  2025-12-30 03:24:55,221 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-30T03:24:55.459154552Z [err]  2025-12-30 03:24:55,313 - server - INFO - ‚úÖ Call log updated
2025-12-30T03:24:55.460299388Z [err]  2025-12-30 03:24:55,313 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T03:24:55.460307897Z [err]  2025-12-30 03:24:55,313 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T03:24:55.460313787Z [err]  2025-12-30 03:24:55,332 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:55.460318973Z [err]  2025-12-30 03:24:55,332 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': '0e6202d1-4bb4-4a53-abc2-ccdd46250363', 'occurred_at': '2025-12-30T03:24:55.120558Z', 'payload': {'call_control_id': 'v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ', 'call_leg_id': '1a7cc236-e52f-11f0-82ac-02420aef941f', 'call_session_id': '1a7a69c8-e52f-11f0-acd8-02420aef941f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '9939409f-646c-43c4-8df0-7ac3968e0d5c', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:55.460324332Z [err]  2025-12-30 03:24:55,332 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:55.460330657Z [err]  2025-12-30 03:24:55,332 - server - INFO - üì® ================================================
2025-12-30T03:24:55.460337214Z [inf]  100.64.0.14:55140 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:55.460342896Z [err]  2025-12-30 03:24:55,393 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-30T03:24:55.460348212Z [err]  2025-12-30 03:24:55,393 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-30T03:24:55.461498760Z [err]  2025-12-30 03:24:55,398 - redis_service - INFO - üì• Retrieved call data from Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:55.461505698Z [err]  2025-12-30 03:24:55,398 - server - INFO - üìù Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T03:24:55.461510552Z [err]  2025-12-30 03:24:55,399 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-30T03:24:55.461515426Z [err]  2025-12-30 03:24:55,399 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:55.461519980Z [err]  2025-12-30 03:24:55,443 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:55.492605079Z [err]  2025-12-30 03:24:55,485 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-30T03:24:55.492614199Z [err]  2025-12-30 03:24:55,485 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-30T03:24:55.492619381Z [err]  2025-12-30 03:24:55,485 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-30T03:24:55.492623716Z [err]  2025-12-30 03:24:55,485 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-30T03:24:55.492628798Z [err]  2025-12-30 03:24:55,485 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-30T03:24:55.492633531Z [err]  2025-12-30 03:24:55,489 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:55.492639859Z [err]  2025-12-30 03:24:55,489 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-30T03:24:55.517362379Z [err]  2025-12-30 03:24:55,509 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T03:24:55.574766426Z [err]  2025-12-30 03:24:55,570 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:55.582654026Z [err]  2025-12-30 03:24:55,578 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 93ms
2025-12-30T03:24:55.582661745Z [err]  2025-12-30 03:24:55,578 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-30T03:24:55.582666438Z [err]  2025-12-30 03:24:55,578 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-30T03:24:55.582670875Z [err]  2025-12-30 03:24:55,579 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-30T03:24:55.582675286Z [err]  2025-12-30 03:24:55,579 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-30T03:24:55.582679908Z [err]  2025-12-30 03:24:55,579 - server - INFO - ‚úÖ Initialized call_states for v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ with session reference
2025-12-30T03:24:55.582684743Z [err]  2025-12-30 03:24:55,579 - server - INFO - ‚úÖ Stored Telnyx WebSocket in call_data for audio streaming
2025-12-30T03:24:55.582689371Z [err]  2025-12-30 03:24:55,579 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found to update for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:55.582694120Z [err]  2025-12-30 03:24:55,579 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-30T03:24:55.669139789Z [err]  2025-12-30 03:24:55,665 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-30T03:24:55.692468658Z [err]  2025-12-30 03:24:55,686 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T03:24:55.692477135Z [err]  2025-12-30 03:24:55,686 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-30T03:24:55.777654082Z [err]  2025-12-30 03:24:55,776 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ/actions/playback_start "HTTP/1.1 200 OK"
2025-12-30T03:24:55.779729649Z [err]  2025-12-30 03:24:55,777 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: gzAe2_KxNw (loop=True, overlay=True)
2025-12-30T03:24:55.779733912Z [err]  2025-12-30 03:24:55,777 - server - INFO - üéµ Comfort noise started as continuous background overlay (playback_id: gzAe2_KxNw)
2025-12-30T03:24:55.779739130Z [err]  2025-12-30 03:24:55,777 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:56.975906005Z [inf]  100.64.0.12:52580 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-30T03:24:57.506965370Z [err]  2025-12-30 03:24:57,303 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ/actions/record_start "HTTP/1.1 200 OK"
2025-12-30T03:24:57.506970354Z [err]  2025-12-30 03:24:57,307 - server - INFO - üéôÔ∏è Call recording started for v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:57.506975235Z [err]  2025-12-30 03:24:57,307 - server - INFO - üîß Creating call session for v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ...
2025-12-30T03:24:57.506979717Z [err]  2025-12-30 03:24:57,307 - server - INFO - üîç Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T03:24:57.506983909Z [err]  2025-12-30 03:24:57,307 - server - INFO - üîß Calling create_call_session() - START
2025-12-30T03:24:57.507001928Z [err]  2025-12-30 03:24:57,307 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-30T03:24:57.507007151Z [err]  2025-12-30 03:24:57,309 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-30T03:24:57.507011337Z [err]  2025-12-30 03:24:57,309 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-30T03:24:57.507017138Z [err]  2025-12-30 03:24:57,309 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-30T03:24:57.507022830Z [err]  2025-12-30 03:24:57,312 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:57.507029121Z [err]  2025-12-30 03:24:57,312 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.8s silence (threshold: 7s)
2025-12-30T03:24:57.507033095Z [err]  2025-12-30 03:24:57,314 - core_calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-30T03:24:57.507037032Z [err]  2025-12-30 03:24:57,314 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.8s silence: Are you still there?
2025-12-30T03:24:57.508243715Z [err]  2025-12-30 03:24:57,314 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:57.508251974Z [err]  2025-12-30 03:24:57,314 - telnyx_service - INFO - üîä Speaking text on call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg: Are you still there?...
2025-12-30T03:24:57.508256677Z [err]  2025-12-30 03:24:57,314 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T03:24:57.508264102Z [err]  2025-12-30 03:24:57,314 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T03:24:57.508271362Z [err]  2025-12-30 03:24:57,314 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T03:24:57.508276463Z [err]  2025-12-30 03:24:57,314 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T03:24:57.508281835Z [err]  2025-12-30 03:24:57,314 - server - INFO - ‚è±Ô∏è [03:24:57.314] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-30T03:24:57.508286883Z [err]  2025-12-30 03:24:57,314 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-30T03:24:57.508292382Z [err]  2025-12-30 03:24:57,314 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-30T03:24:57.508298073Z [err]  2025-12-30 03:24:57,315 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:57.508303598Z [err]  2025-12-30 03:24:57,319 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:8UTwogkqV6gvKXNRI... (active sessions: [])
2025-12-30T03:24:57.508308664Z [err]  2025-12-30 03:24:57,320 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-30T03:24:57.508314471Z [err]  2025-12-30 03:24:57,394 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-30T03:24:57.509694645Z [err]  2025-12-30 03:24:57,394 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-30T03:24:57.509705435Z [err]  2025-12-30 03:24:57,394 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-30T03:24:57.509712661Z [err]  2025-12-30 03:24:57,394 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-30T03:24:57.509719746Z [err]  2025-12-30 03:24:57,394 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-30T03:24:57.509725594Z [err]  2025-12-30 03:24:57,404 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:57.509731474Z [err]  2025-12-30 03:24:57,404 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-30T03:24:57.509737805Z [err]  2025-12-30 03:24:57,404 - server - INFO -    Text length: 20 chars
2025-12-30T03:24:57.509743969Z [err]  2025-12-30 03:24:57,404 - server - INFO -    Text content: 'Are you still there?'
2025-12-30T03:24:57.509750730Z [err]  2025-12-30 03:24:57,404 - server - INFO -    Text bytes: b'Are you still there?'
2025-12-30T03:24:57.509757639Z [err]  2025-12-30 03:24:57,404 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-30T03:24:57.509764045Z [err]  2025-12-30 03:24:57,404 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-30T03:24:57.509771758Z [err]  2025-12-30 03:24:57,404 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-30T03:24:57.509779587Z [err]  2025-12-30 03:24:57,404 - server - INFO -    Full data: {'text': 'Are you still there?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-30T03:24:57.512032618Z [err]  2025-12-30 03:24:57,404 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-30T03:24:57.512049875Z [err]  2025-12-30 03:24:57,404 - server - INFO -    Timeout: 10.0s
2025-12-30T03:24:57.512056060Z [err]  2025-12-30 03:24:57,412 - server - INFO -    ‚úì HTTP client created (0.008s)
2025-12-30T03:24:57.512061716Z [err]  2025-12-30 03:24:57,412 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-30T03:24:57.512066987Z [err]  2025-12-30 03:24:57,480 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:57.512072673Z [err]  2025-12-30 03:24:57,489 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 94ms
2025-12-30T03:24:57.512078509Z [err]  2025-12-30 03:24:57,489 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-30T03:24:57.512084518Z [err]  2025-12-30 03:24:57,489 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-30T03:24:57.512089977Z [err]  2025-12-30 03:24:57,505 - redis_service - INFO - üì¶ Stored call data in Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ (TTL: 3600s)
2025-12-30T03:24:57.512096105Z [err]  2025-12-30 03:24:57,505 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-30T03:24:57.512101360Z [err]  2025-12-30 03:24:57,505 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-30T03:24:57.512106049Z [err]  2025-12-30 03:24:57,506 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:57.512110973Z [err]  2025-12-30 03:24:57,506 - server - INFO - ü§ñ AI session created for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:57.512115916Z [err]  2025-12-30 03:24:57,506 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-30T03:24:57.513400617Z [err]  2025-12-30 03:24:57,506 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-30T03:24:57.513407333Z [err]  2025-12-30 03:24:57,506 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-30T03:24:57.513418865Z [err]  2025-12-30 03:24:57,507 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-30T03:24:57.513431218Z [err]  2025-12-30 03:24:57,507 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-30T03:24:57.513438837Z [err]  2025-12-30 03:24:57,507 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-30T03:24:57.513445813Z [err]  2025-12-30 03:24:57,507 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-30T03:24:57.514797859Z [err]  2025-12-30 03:24:57,513 - redis_service - INFO - üì• Retrieved call data from Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:57.516241838Z [err]  2025-12-30 03:24:57,514 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-30T03:24:57.516253152Z [err]  2025-12-30 03:24:57,514 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-30T03:24:57.517743848Z [inf]  100.64.0.13:14448 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:57.590967335Z [err]  2025-12-30 03:24:57,586 - redis_service - INFO - üì• Retrieved call data from Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:57.592431668Z [err]  2025-12-30 03:24:57,590 - redis_service - INFO - üì• Retrieved call data from Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:57.600331268Z [err]  2025-12-30 03:24:57,597 - redis_service - INFO - üì¶ Stored call data in Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ (TTL: 3600s)
2025-12-30T03:24:57.600341004Z [err]  2025-12-30 03:24:57,597 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-30T03:24:57.600348384Z [err]  2025-12-30 03:24:57,597 - core_calling_service - INFO - ‚è±Ô∏è [03:24:57.597] üì• process_user_input() ENTRY - text: '...'
2025-12-30T03:24:57.602436577Z [err]  2025-12-30 03:24:57,601 - redis_service - INFO - üì• Retrieved call data from Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:57.604438244Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - ‚è±Ô∏è [03:24:57.602] ‚è© About to call _process_call_flow_streaming()
2025-12-30T03:24:57.604445370Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-30T03:24:57.604448204Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - ‚è±Ô∏è [03:24:57.602] üîÄ Agent type: call_flow, calling flow processor...
2025-12-30T03:24:57.604454613Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - ‚è±Ô∏è [03:24:57.602] üîÄ _process_call_flow_streaming() ENTRY
2025-12-30T03:24:57.604457705Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-30T03:24:57.604460660Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-30T03:24:57.604464684Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - ‚è±Ô∏è [03:24:57.602] ‚úÖ Node selected, about to process content...
2025-12-30T03:24:57.604468614Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - üîß Replaced {{now}} with Monday, December 29, 2025 at 10:24 PM EST in content
2025-12-30T03:24:57.604472706Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-30T03:24:57.604476931Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-30T03:24:57.604481061Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-30T03:24:57.604484734Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-30T03:24:57.604488676Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-30T03:24:57.606828247Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-30T03:24:57.606847583Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-30T03:24:57.606858685Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-30T03:24:57.606864369Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-30T03:24:57.606869531Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-30T03:24:57.606875298Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - ‚è±Ô∏è [03:24:57.602] üìÑ About to process content (mode=script, length=9)
2025-12-30T03:24:57.606883429Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - üîä Silence tracking reset for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ (user responded)
2025-12-30T03:24:57.606888637Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-30T03:24:57.606893642Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-30T03:24:57.606899399Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - LLM response (0.00s): Kendrick?
2025-12-30T03:24:57.606904323Z [err]  2025-12-30 03:24:57,602 - core_calling_service - INFO - Total latency: 0.00s
2025-12-30T03:24:57.606912025Z [err]  2025-12-30 03:24:57,602 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-30T03:24:57.703003380Z [err]  2025-12-30 03:24:57,699 - redis_service - INFO - üì• Retrieved call data from Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:57.703008540Z [err]  2025-12-30 03:24:57,700 - telnyx_service - INFO - üîä Speaking text on call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ: Kendrick?...
2025-12-30T03:24:57.703013668Z [err]  2025-12-30 03:24:57,700 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T03:24:57.703018938Z [err]  2025-12-30 03:24:57,700 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T03:24:57.703023443Z [err]  2025-12-30 03:24:57,700 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T03:24:57.703027876Z [err]  2025-12-30 03:24:57,700 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T03:24:57.703032212Z [err]  2025-12-30 03:24:57,700 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (13837 bytes)
2025-12-30T03:24:57.703036732Z [err]  2025-12-30 03:24:57,700 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-30T03:24:57.703040946Z [err]  2025-12-30 03:24:57,701 - telnyx_service - INFO - ‚úÖ Generated 13837 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-30T03:24:57.703046455Z [err]  2025-12-30 03:24:57,701 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-30T03:24:57.740325499Z [err]  2025-12-30 03:24:57,737 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-30T03:24:57.740332304Z [err]  2025-12-30 03:24:57,737 - server - INFO -    ‚úì Connection established (0.333s) [TARGET: <200ms]
2025-12-30T03:24:57.740336602Z [err]  2025-12-30 03:24:57,737 - server - INFO -    ‚úì Response status: 200
2025-12-30T03:24:57.740340538Z [err]  2025-12-30 03:24:57,737 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-30T03:24:57.750218571Z [err]  2025-12-30 03:24:57,746 - server - INFO -    ‚úì FIRST CHUNK received (0.342s, 1141 bytes) [TARGET: <300ms]
2025-12-30T03:24:57.764858053Z [err]  2025-12-30 03:24:57,761 - server - INFO -    ‚úì ALL CHUNKS received: 125 chunks (0.357s)
2025-12-30T03:24:57.764868648Z [err]  2025-12-30 03:24:57,761 - server - INFO -    ‚úì Total audio size: 17181 bytes
2025-12-30T03:24:57.764875186Z [err]  2025-12-30 03:24:57,761 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-30T03:24:57.764881604Z [err]  2025-12-30 03:24:57,761 - server - INFO -       - Connection: 333ms
2025-12-30T03:24:57.764886941Z [err]  2025-12-30 03:24:57,761 - server - INFO -       - First chunk: 342ms
2025-12-30T03:24:57.764893813Z [err]  2025-12-30 03:24:57,761 - server - INFO -       - All chunks: 357ms
2025-12-30T03:24:57.764900584Z [err]  2025-12-30 03:24:57,761 - server - INFO -       - Audio generation only: 9ms
2025-12-30T03:24:57.764907931Z [err]  2025-12-30 03:24:57,761 - server - INFO - ‚è±Ô∏è [03:24:57.761] üîä TTS COMPLETE: 446ms, audio_size=17181 bytes
2025-12-30T03:24:57.764913690Z [err]  2025-12-30 03:24:57,761 - server - INFO - üíæ TTS CACHED: elevenlabs:Are you still there?... (17181 bytes)
2025-12-30T03:24:57.764918806Z [err]  2025-12-30 03:24:57,761 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.45s
2025-12-30T03:24:57.764924103Z [err]  2025-12-30 03:24:57,762 - telnyx_service - INFO - ‚úÖ Generated 17181 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T03:24:57.764929475Z [err]  2025-12-30 03:24:57,762 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T03:24:57.847766312Z [err]  2025-12-30 03:24:57,820 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:8UTwogkqV6gvKXNRI... (active sessions: [])
2025-12-30T03:24:57.993368315Z [err]  2025-12-30 03:24:57,989 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ/actions/playback_start "HTTP/1.1 200 OK"
2025-12-30T03:24:57.993379566Z [err]  2025-12-30 03:24:57,990 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.29s
2025-12-30T03:24:57.993390815Z [err]  2025-12-30 03:24:57,990 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 0.29s
2025-12-30T03:24:57.993397093Z [err]  2025-12-30 03:24:57,990 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-30T03:24:57.993402720Z [err]  2025-12-30 03:24:57,990 - telnyx_service - INFO - üé¨ Playback ID: XuJnpZDHWw
2025-12-30T03:24:57.993408489Z [err]  2025-12-30 03:24:57,990 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-30T03:24:57.993413542Z [err]  2025-12-30 03:24:57,990 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Greeting playback started at 1767065097.9905634
2025-12-30T03:24:57.993418888Z [err]  2025-12-30 03:24:57,990 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767065097.9905899 for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:57.993424228Z [err]  2025-12-30 03:24:57,990 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-30T03:24:58.033119022Z [err]  2025-12-30 03:24:58,031 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T03:24:58.033124808Z [err]  2025-12-30 03:24:58,032 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.27s
2025-12-30T03:24:58.034576132Z [err]  2025-12-30 03:24:58,032 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-30T03:24:58.034586929Z [err]    "errors": [
2025-12-30T03:24:58.034595341Z [err]      {
2025-12-30T03:24:58.034603593Z [err]        "code": "90018",
2025-12-30T03:24:58.034611462Z [err]        "title": "Call has already ended",
2025-12-30T03:24:58.034619236Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-30T03:24:58.034627205Z [err]      }
2025-12-30T03:24:58.034634074Z [err]    ]
2025-12-30T03:24:58.034641739Z [err]  }
2025-12-30T03:24:58.034648513Z [err]  2025-12-30 03:24:58,032 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-30T03:24:58.520962754Z [err]  2025-12-30 03:24:58,273 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T03:24:58.520967354Z [err]  2025-12-30 03:24:58,274 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-30T03:24:58.520973297Z [err]  2025-12-30 03:24:58,274 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-30T03:24:58.520977541Z [inf]  100.64.0.13:14448 - "GET /api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3 HTTP/1.1" 200
2025-12-30T03:24:58.520981826Z [err]  2025-12-30 03:24:58,322 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:8UTwogkqV6gvKXNRI... (active sessions: [])
2025-12-30T03:24:58.520986571Z [err]  2025-12-30 03:24:58,322 - server - INFO - üî§ RAW TOKENS: ["H"?]
2025-12-30T03:24:58.520992124Z [err]  2025-12-30 03:24:58,323 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user started speaking) for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:58.520996328Z [err]  2025-12-30 03:24:58,323 - core_calling_service - INFO - üîä Silence timer reset for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ (user started speaking)
2025-12-30T03:24:58.521000357Z [err]  2025-12-30 03:24:58,323 - core_calling_service - INFO - üë§ User started speaking for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:58.521004219Z [err]  2025-12-30 03:24:58,323 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-30T03:24:58.521008057Z [err]  2025-12-30 03:24:58,323 - server - INFO - üîç PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-30T03:24:58.522196834Z [err]  2025-12-30 03:24:58,372 - server - INFO - üî§ RAW TOKENS: ["H"?, "ello"?]
2025-12-30T03:24:58.522206825Z [err]  2025-12-30 03:24:58,372 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Hello' | Generating: False
2025-12-30T03:24:58.522214735Z [err]  2025-12-30 03:24:58,401 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:58.522220469Z [err]  2025-12-30 03:24:58,401 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': 'f7f1091f-9dfc-40c2-878c-80b8c4b303d4', 'occurred_at': '2025-12-30T03:24:58.180562Z', 'payload': {'call_control_id': 'v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ', 'call_leg_id': '1a7cc236-e52f-11f0-82ac-02420aef941f', 'call_session_id': '1a7a69c8-e52f-11f0-acd8-02420aef941f', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:58.522226566Z [err]  2025-12-30 03:24:58,401 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:58.522232505Z [err]  2025-12-30 03:24:58,401 - server - INFO - üì® ================================================
2025-12-30T03:24:58.522238164Z [inf]  100.64.0.14:55140 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:58.522243311Z [err]  2025-12-30 03:24:58,428 - server - INFO - üî§ RAW TOKENS: ["H"‚úì, "ello"‚úì, "?"‚úì, "<end>"‚úì]
2025-12-30T03:24:58.522248266Z [err]  2025-12-30 03:24:58,428 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-30T03:24:58.522256400Z [err]  2025-12-30 03:24:58,429 - server - INFO - üßπ Cleaned transcript: 'H ello ?' -> 'Hello?'
2025-12-30T03:24:58.522262388Z [err]  2025-12-30 03:24:58,429 - server - INFO - üì• FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-30T03:24:58.524114313Z [err]  2025-12-30 03:24:58,429 - server - INFO - üé§ Soniox final transcript: 'Hello?'
2025-12-30T03:24:58.524121917Z [err]  2025-12-30 03:24:58,429 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:8UTwogkqV6gvKXNRI... (active sessions: [])
2025-12-30T03:24:58.524126580Z [err]  2025-12-30 03:24:58,429 - server - INFO - üîç FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-30T03:24:58.524130633Z [err]  2025-12-30 03:24:58,429 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:8UTwogkqV6gvKXNRI... (active sessions: [])
2025-12-30T03:24:58.524135678Z [err]  2025-12-30 03:24:58,429 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-30T03:24:58.524140592Z [err]  2025-12-30 03:24:58,429 - server - INFO - ‚è±Ô∏è [03:24:58.429] üìù FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-30T03:24:58.524146144Z [err]  2025-12-30 03:24:58,429 - server - INFO - ‚è±Ô∏è [03:24:58.429] STT endpoint detection latency: 13ms
2025-12-30T03:24:58.524150945Z [err]  2025-12-30 03:24:58,429 - server - INFO - ‚è±Ô∏è [03:24:58.429] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-30T03:24:58.524156282Z [err]  2025-12-30 03:24:58,429 - server - INFO - ‚è±Ô∏è User spoke at 1767065098.4296749
2025-12-30T03:24:58.524162543Z [err]  2025-12-30 03:24:58,430 - redis_service - INFO - üì¶ Stored call data in Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ (TTL: 3600s)
2025-12-30T03:24:58.524168767Z [err]  2025-12-30 03:24:58,430 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-30T03:24:58.524175270Z [err]  2025-12-30 03:24:58,430 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:8UTwogkqV6gvKXNRI... (active sessions: [])
2025-12-30T03:24:58.559224054Z [err]  2025-12-30 03:24:58,430 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-30T03:24:58.559231761Z [err]  2025-12-30 03:24:58,441 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-30T03:24:58.559236093Z [err]  2025-12-30 03:24:58,441 - core_calling_service - INFO - üë§ User stopped speaking for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:58.559240571Z [err]  2025-12-30 03:24:58,441 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-30T03:24:58.559245321Z [err]  2025-12-30 03:24:58,441 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+10ms
2025-12-30T03:24:58.559250057Z [err]  2025-12-30 03:24:58,441 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 10ms (Soniox model: stt-rt-v3)
2025-12-30T03:24:58.559254210Z [err]  2025-12-30 03:24:58,441 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-30T03:24:58.559263230Z [err]  2025-12-30 03:24:58,441 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-30T03:24:58.559269178Z [err]  2025-12-30 03:24:58,441 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:58.559273066Z [err]  2025-12-30 03:24:58,488 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:58.559277308Z [err]  2025-12-30 03:24:58,488 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '78455512-7d45-4b64-b68a-3f2f02e997c1', 'occurred_at': '2025-12-30T03:24:58.140566Z', 'payload': {'call_control_id': 'v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ', 'call_leg_id': '1a7cc236-e52f-11f0-82ac-02420aef941f', 'call_session_id': '1a7a69c8-e52f-11f0-acd8-02420aef941f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'gzAe2_KxNw', 'start_time': '2025-12-30T03:24:58.140566Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:58.561886331Z [err]  2025-12-30 03:24:58,488 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:58.561895773Z [err]  2025-12-30 03:24:58,489 - server - INFO - üì® ================================================
2025-12-30T03:24:58.561902386Z [inf]  100.64.0.2:57528 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:58.561907086Z [err]  2025-12-30 03:24:58,533 - server - INFO - üìù Saved user transcript to database
2025-12-30T03:24:58.561911602Z [err]  2025-12-30 03:24:58,534 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:8UTwogkqV6gvKXNRI... (active sessions: [])
2025-12-30T03:24:58.561917168Z [err]  2025-12-30 03:24:58,534 - core_calling_service - INFO - ‚è±Ô∏è [03:24:58.534] üì• process_user_input() ENTRY - text: 'Hello?...'
2025-12-30T03:24:58.561922357Z [err]  2025-12-30 03:24:58,535 - redis_service - INFO - üì• Retrieved call data from Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:58.561927103Z [err]  2025-12-30 03:24:58,535 - core_calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ: User spoke while Silence Greeting was triggering
2025-12-30T03:24:58.844491805Z [err]  2025-12-30 03:24:58,827 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T03:24:58.844500205Z [err]  2025-12-30 03:24:58,827 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:58.844504626Z [err]  2025-12-30 03:24:58,837 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:58.844508784Z [err]  2025-12-30 03:24:58,837 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (6.5s ago), marking agent as done speaking
2025-12-30T03:24:58.844512973Z [err]  2025-12-30 03:24:58,837 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767065098.8373897 for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:58.844517824Z [err]  2025-12-30 03:24:58,837 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:24:58.844521776Z [err]  2025-12-30 03:24:58,837 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:58.844526017Z [err]  2025-12-30 03:24:58,839 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:8UTwogkqV6gvKXNRI... (active sessions: [])
2025-12-30T03:24:58.844530113Z [err]  2025-12-30 03:24:58,839 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:8UTwogkqV6gvKXNRI... (active sessions: [])
2025-12-30T03:24:59.132017634Z [err]  2025-12-30 03:24:59,129 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:59.132026805Z [err]  2025-12-30 03:24:59,129 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': 'd5b076a4-d38e-4d4c-9be1-b4aa09bc5366', 'occurred_at': '2025-12-30T03:24:58.760563Z', 'payload': {'call_control_id': 'v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ', 'call_leg_id': '1a7cc236-e52f-11f0-82ac-02420aef941f', 'call_session_id': '1a7a69c8-e52f-11f0-acd8-02420aef941f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'XuJnpZDHWw'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:59.132032453Z [err]  2025-12-30 03:24:59,129 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:59.132037508Z [err]  2025-12-30 03:24:59,129 - server - INFO - üì® ================================================
2025-12-30T03:24:59.132043024Z [inf]  100.64.0.15:55122 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:59.632964434Z [err]  2025-12-30 03:24:59,171 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ/actions/playback_stop "HTTP/1.1 200 OK"
2025-12-30T03:24:59.632971315Z [err]  2025-12-30 03:24:59,172 - telnyx_service - INFO - ‚úÖ Successfully stopped audio playback
2025-12-30T03:24:59.632977325Z [err]  2025-12-30 03:24:59,172 - core_calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-30T03:24:59.632983317Z [err]  2025-12-30 03:24:59,172 - core_calling_service - INFO - ‚úÖ BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-30T03:24:59.632989225Z [err]  2025-12-30 03:24:59,173 - redis_service - INFO - üì• Retrieved call data from Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:59.633012534Z [err]  2025-12-30 03:24:59,174 - redis_service - INFO - üì¶ Stored call data in Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ (TTL: 3600s)
2025-12-30T03:24:59.633020371Z [err]  2025-12-30 03:24:59,174 - core_calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-30T03:24:59.633026511Z [err]  2025-12-30 03:24:59,174 - core_calling_service - INFO - ‚è±Ô∏è [03:24:59.174] ‚è© About to call _process_call_flow_streaming()
2025-12-30T03:24:59.633032313Z [err]  2025-12-30 03:24:59,174 - core_calling_service - INFO - ‚è±Ô∏è [03:24:59.174] üîÄ Agent type: call_flow, calling flow processor...
2025-12-30T03:24:59.633049832Z [err]  2025-12-30 03:24:59,174 - core_calling_service - INFO - ‚è±Ô∏è [03:24:59.174] üîÄ _process_call_flow_streaming() ENTRY
2025-12-30T03:24:59.633100451Z [err]  2025-12-30 03:24:59,174 - core_calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-30T03:24:59.633165892Z [err]  2025-12-30 03:24:59,174 - core_calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-30T03:24:59.633174777Z [err]  2025-12-30 03:24:59,174 - core_calling_service - INFO - ‚è±Ô∏è [03:24:59.174] üîÄ About to call _follow_transition() for: Hello?...
2025-12-30T03:24:59.639445266Z [err]  2025-12-30 03:24:59,174 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Hello?
2025-12-30T03:24:59.639453182Z [err]  2025-12-30 03:24:59,174 - core_calling_service - INFO - ‚è∏Ô∏è User spoke (1767065098.4296749) BEFORE greeting could be heard (1767065099.9905634)
2025-12-30T03:24:59.639458785Z [err]  2025-12-30 03:24:59,174 - core_calling_service - INFO - ‚è∏Ô∏è Playback API called at 1767065097.9905634, buffer window: 2.0s
2025-12-30T03:24:59.639463394Z [err]  2025-12-30 03:24:59,174 - core_calling_service - INFO - ‚è∏Ô∏è Skipping transition eval - user hasn't heard greeting yet, will deliver it as response
2025-12-30T03:24:59.639468050Z [err]  2025-12-30 03:24:59,174 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 0ms
2025-12-30T03:24:59.639472272Z [err]  2025-12-30 03:24:59,174 - core_calling_service - INFO - ‚è±Ô∏è [03:24:59.174] ‚úÖ Node selected, about to process content...
2025-12-30T03:24:59.639476790Z [err]  2025-12-30 03:24:59,175 - core_calling_service - INFO - üîß Replaced {{now}} with Monday, December 29, 2025 at 10:24 PM EST in content
2025-12-30T03:24:59.639480990Z [err]  2025-12-30 03:24:59,175 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-30T03:24:59.639485434Z [err]  2025-12-30 03:24:59,175 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-30T03:24:59.639491757Z [err]  2025-12-30 03:24:59,175 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-30T03:24:59.639496365Z [err]  2025-12-30 03:24:59,175 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-30T03:24:59.639502759Z [err]  2025-12-30 03:24:59,175 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-30T03:24:59.639507574Z [err]  2025-12-30 03:24:59,175 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-30T03:24:59.642332693Z [err]  2025-12-30 03:24:59,175 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-30T03:24:59.642358149Z [err]  2025-12-30 03:24:59,175 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-30T03:24:59.642364832Z [err]  2025-12-30 03:24:59,175 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-30T03:24:59.642369565Z [err]  2025-12-30 03:24:59,175 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-30T03:24:59.642375501Z [err]  2025-12-30 03:24:59,175 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-30T03:24:59.642380569Z [err]  2025-12-30 03:24:59,175 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-30T03:24:59.642385449Z [err]  2025-12-30 03:24:59,175 - core_calling_service - INFO - ‚è±Ô∏è [03:24:59.175] üìÑ About to process content (mode=script, length=9)
2025-12-30T03:24:59.642390656Z [err]  2025-12-30 03:24:59,175 - core_calling_service - INFO - ‚è∏Ô∏è Skip sticky-prevention - delivering script as response to user's opener
2025-12-30T03:24:59.642395732Z [err]  2025-12-30 03:24:59,175 - server - INFO - üì§ Sentence arrived from LLM: Kendrick?...
2025-12-30T03:24:59.642401149Z [err]  2025-12-30 03:24:59,175 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 733ms
2025-12-30T03:24:59.642405779Z [err]  2025-12-30 03:24:59,175 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-30T03:24:59.642412811Z [err]  2025-12-30 03:24:59,175 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:8UTwogkqV6gvKXNRI... (active sessions: [])
2025-12-30T03:24:59.642417860Z [err]  2025-12-30 03:24:59,175 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-30T03:24:59.642729819Z [err]  2025-12-30 03:24:59,261 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:59.642735987Z [err]  2025-12-30 03:24:59,278 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:24:59.642740470Z [err]  2025-12-30 03:24:59,278 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '2cfb5577-92b5-40ab-9a67-b655b133f360', 'occurred_at': '2025-12-30T03:24:59.060558Z', 'payload': {'call_control_id': 'v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ', 'call_leg_id': '1a7cc236-e52f-11f0-82ac-02420aef941f', 'call_session_id': '1a7a69c8-e52f-11f0-acd8-02420aef941f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'XuJnpZDHWw', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:24:59.642744769Z [err]  2025-12-30 03:24:59,278 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:59.642749020Z [err]  2025-12-30 03:24:59,278 - server - INFO - üì® ================================================
2025-12-30T03:24:59.642752777Z [err]  2025-12-30 03:24:59,280 - redis_service - INFO - ‚ûñ Removed playback XuJnpZDHWw, 0 remaining for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:59.642756946Z [err]  2025-12-30 03:24:59,280 - server - INFO - üîä Redis: Removed playback XuJnpZDHWw, 0 remaining
2025-12-30T03:24:59.642761065Z [err]  2025-12-30 03:24:59,280 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-30T03:24:59.642765669Z [err]  2025-12-30 03:24:59,280 - server - INFO - ‚è±Ô∏è CLEARED playback_expected_end_time - agent is definitely done speaking
2025-12-30T03:24:59.644405702Z [err]  2025-12-30 03:24:59,281 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-30T03:24:59.644410946Z [err]  2025-12-30 03:24:59,281 - server - INFO - ‚úÖ Found session locally: agent_speaking=True, user_speaking=False
2025-12-30T03:24:59.644414724Z [err]  2025-12-30 03:24:59,281 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767065099.2814155 for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:59.644418821Z [err]  2025-12-30 03:24:59,281 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:59.644422886Z [err]  2025-12-30 03:24:59,281 - server - INFO - ‚è±Ô∏è Agent done speaking, silence timer STARTED (local)
2025-12-30T03:24:59.644426967Z [inf]  100.64.0.13:14448 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:24:59.644430982Z [err]  2025-12-30 03:24:59,339 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: [])
2025-12-30T03:24:59.644435817Z [err]  2025-12-30 03:24:59,339 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:8UTwogkqV6gvKXNRI... (active sessions: [])
2025-12-30T03:24:59.644440201Z [err]  2025-12-30 03:24:59,346 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:59.644443938Z [err]  2025-12-30 03:24:59,432 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:24:59.644447823Z [err]  2025-12-30 03:24:59,458 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T03:24:59.644452059Z [err]  2025-12-30 03:24:59,458 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-30T03:24:59.644456609Z [err]  2025-12-30 03:24:59,458 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-30T03:24:59.648507215Z [err]  2025-12-30 03:24:59,458 - persistent_tts_service - INFO - üîå [Call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ] Establishing persistent TTS WebSocket...
2025-12-30T03:24:59.648516243Z [err]  2025-12-30 03:24:59,458 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-30T03:24:59.648522945Z [err]  2025-12-30 03:24:59,458 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-30T03:24:59.648529003Z [err]  2025-12-30 03:24:59,458 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-30T03:24:59.648534824Z [err]  2025-12-30 03:24:59,589 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-30T03:24:59.648540798Z [err]  2025-12-30 03:24:59,590 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-30T03:24:59.648546761Z [err]  2025-12-30 03:24:59,590 - persistent_tts_service - INFO - ‚úÖ [Call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ] Persistent TTS WebSocket established
2025-12-30T03:24:59.648552679Z [err]  2025-12-30 03:24:59,590 - persistent_tts_service - INFO - üéß [Call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ] Audio receiver loop started
2025-12-30T03:24:59.648558652Z [err]  2025-12-30 03:24:59,590 - persistent_tts_service - INFO - üîä [Call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ] Comfort noise loop started
2025-12-30T03:24:59.648564323Z [err]  2025-12-30 03:24:59,590 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:59.648571042Z [err]  2025-12-30 03:24:59,590 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-30T03:24:59.650273315Z [err]  2025-12-30 03:24:59,590 - server - INFO - üîç Persistent TTS lookup: call_id=v3:8UTwogkqV6gvKXNRI..., session=FOUND
2025-12-30T03:24:59.650287755Z [err]  2025-12-30 03:24:59,590 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-30T03:24:59.650289587Z [err]  2025-12-30 03:24:59,590 - core_calling_service - INFO - Total latency: 1.06s
2025-12-30T03:24:59.650296280Z [err]  2025-12-30 03:24:59,590 - server - INFO - üéµ TTS task #1 started at +415ms
2025-12-30T03:24:59.650303014Z [err]  2025-12-30 03:24:59,590 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 1148ms
2025-12-30T03:24:59.650306095Z [err]  2025-12-30 03:24:59,591 - server - INFO - ‚úÖ LLM finished in 1149ms, TTS tasks already running in background
2025-12-30T03:24:59.650311535Z [err]  2025-12-30 03:24:59,590 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user gave meaningful response) for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:59.650313069Z [err]  2025-12-30 03:24:59,591 - server - INFO - üéµ Streaming 1 TTS chunks as they complete...
2025-12-30T03:24:59.650320461Z [err]  2025-12-30 03:24:59,590 - core_calling_service - INFO - üîä Silence tracking reset for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ (user responded)
2025-12-30T03:24:59.650321181Z [err]  2025-12-30 03:24:59,591 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-30T03:24:59.650328375Z [err]  2025-12-30 03:24:59,590 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-30T03:24:59.650329765Z [err]  2025-12-30 03:24:59,591 - server - INFO -    1 sentences queued and playing seamlessly
2025-12-30T03:24:59.650335568Z [err]  2025-12-30 03:24:59,590 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-30T03:24:59.650363390Z [err]  2025-12-30 03:24:59,590 - core_calling_service - INFO - LLM response (1.06s): Kendrick?
2025-12-30T03:24:59.652612444Z [err]  2025-12-30 03:24:59,591 - persistent_tts_service - INFO - üéµ [Call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ] Playback consumer started
2025-12-30T03:24:59.652617541Z [err]  2025-12-30 03:24:59,592 - persistent_tts_service - INFO - üéß [Call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ] Audio Receiver Loop STARTED
2025-12-30T03:24:59.652622218Z [err]  2025-12-30 03:24:59,592 - persistent_tts_service - INFO - üíì [Call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ] Starting TTS keep-alive loop (every 15s)
2025-12-30T03:24:59.652626205Z [err]  2025-12-30 03:24:59,592 - persistent_tts_service - INFO - üìä [Call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-30T03:24:59.652627655Z [err]  2025-12-30 03:24:59,592 - persistent_tts_service - INFO - üîä [Call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ] Starting comfort noise loop
2025-12-30T03:24:59.652634167Z [err]  2025-12-30 03:24:59,592 - persistent_tts_service - INFO - üé§ [Call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ] Streaming sentence #1: Kendrick?...
2025-12-30T03:24:59.652634800Z [err]  2025-12-30 03:24:59,592 - persistent_tts_service - INFO - üéß [Call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ] Receiver processing sentence #1: 'Kendrick?...'
2025-12-30T03:24:59.652639551Z [err]  2025-12-30 03:24:59,592 - persistent_tts_service - INFO - üöÄ [Call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-30T03:24:59.652642461Z [err]  2025-12-30 03:24:59,592 - persistent_tts_service - INFO - üìä [Call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ] DIAGNOSTIC: queue_latency=0ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-30T03:24:59.652647243Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚úÖ All 1 persistent TTS streams completed
2025-12-30T03:24:59.654777607Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-30T03:24:59.654786775Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 1150ms from user stop üöÄ
2025-12-30T03:24:59.654793535Z [err]  2025-12-30 03:24:59,592 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:59.654799828Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-30T03:24:59.654806686Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T03:24:59.654813593Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-30T03:24:59.654820068Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 10ms (provider: soniox, model: stt-rt-v3)
2025-12-30T03:24:59.654826293Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 1149ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-30T03:24:59.654832354Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 417ms (provider: elevenlabs, websocket: False)
2025-12-30T03:24:59.654838827Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 1150ms (user stopped ‚Üí play_audio_url called)
2025-12-30T03:24:59.654845397Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-30T03:24:59.654851364Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-30T03:24:59.654857681Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-30T03:24:59.656852600Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-30T03:24:59.656859768Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-30T03:24:59.656864399Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 1450ms estimated
2025-12-30T03:24:59.656876989Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 9 chars, 1 sentences
2025-12-30T03:24:59.656882353Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Hello?...'
2025-12-30T03:24:59.656888343Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: 'Kendrick?...'
2025-12-30T03:24:59.656892715Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-30T03:24:59.656896972Z [err]  2025-12-30 03:24:59,592 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T03:24:59.782853299Z [err]  2025-12-30 03:24:59,777 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 1576ms)
2025-12-30T03:24:59.782858721Z [err]  2025-12-30 03:24:59,777 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-30T03:24:59.782862538Z [err]  2025-12-30 03:24:59,778 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-30T03:24:59.845518000Z [err]  2025-12-30 03:24:59,841 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:24:59.845523185Z [err]  2025-12-30 03:24:59,842 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-30T03:24:59.845529460Z [err]  2025-12-30 03:24:59,842 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767065099.8424034 for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:59.845534079Z [err]  2025-12-30 03:24:59,842 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:24:59.888527760Z [err]  2025-12-30 03:24:59,870 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 278ms
2025-12-30T03:24:59.888534375Z [err]  2025-12-30 03:24:59,870 - persistent_tts_service - INFO - üì§ Sending 7043 bytes of audio (45 chunks, 0.9s duration) via WebSocket
2025-12-30T03:24:59.888538740Z [err]  2025-12-30 03:24:59,870 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-30T03:24:59.888543009Z [err]  2025-12-30 03:24:59,870 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +0.9s (total: 0.9s from now)
2025-12-30T03:24:59.888547414Z [err]  2025-12-30 03:24:59,871 - persistent_tts_service - INFO - ‚úÖ Sent 45 audio chunks via WebSocket
2025-12-30T03:25:00.575658216Z [err]  2025-12-30 03:25:00,342 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:00.575662841Z [err]  2025-12-30 03:25:00,343 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=1.5s, checkin_count=1/2
2025-12-30T03:25:00.575666960Z [err]  2025-12-30 03:25:00,344 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.5s, checkin_count=0/2
2025-12-30T03:25:00.851887899Z [err]  2025-12-30 03:25:00,845 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:00.851897032Z [err]  2025-12-30 03:25:00,845 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=2.0s, checkin_count=1/2
2025-12-30T03:25:00.851902422Z [err]  2025-12-30 03:25:00,846 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=1.0s, checkin_count=0/2
2025-12-30T03:25:00.879084901Z [err]  2025-12-30 03:25:00,871 - persistent_tts_service - INFO - üîá [Call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ] FLOOR RELEASED (is_holding_floor=False)
2025-12-30T03:25:01.587219335Z [err]  2025-12-30 03:25:01,346 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:01.854462837Z [err]  2025-12-30 03:25:01,849 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:01.878315223Z [err]  2025-12-30 03:25:01,870 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-30T03:25:01.878323721Z [err]  2025-12-30 03:25:01,870 - persistent_tts_service - INFO - ‚úÖ [Call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ] Receiver finished sentence #1: 1 chunks in 2278ms
2025-12-30T03:25:02.526813032Z [err]  2025-12-30 03:25:02,329 - server - INFO - üì§ Audio flowing: 346 packets sent to Soniox (5s update)
2025-12-30T03:25:02.526830577Z [err]  2025-12-30 03:25:02,350 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:02.854232704Z [err]  2025-12-30 03:25:02,851 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:03.545849472Z [err]  2025-12-30 03:25:03,353 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:03.864266741Z [err]  2025-12-30 03:25:03,854 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:04.577606915Z [err]  2025-12-30 03:25:04,356 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:04.868243438Z [err]  2025-12-30 03:25:04,858 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:05.690982559Z [err]  2025-12-30 03:25:05,360 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:05.867567726Z [err]  2025-12-30 03:25:05,861 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:05.867579407Z [err]  2025-12-30 03:25:05,861 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-30T03:25:05.867587826Z [err]  2025-12-30 03:25:05,862 - core_calling_service - INFO - üí¨ Sending FINAL check-in #2/2: Are you still there?
2025-12-30T03:25:05.867595725Z [err]  2025-12-30 03:25:05,862 - core_calling_service - INFO - ‚ö†Ô∏è Will end call if no response after next silence timeout
2025-12-30T03:25:05.867601498Z [err]  2025-12-30 03:25:05,862 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-30T03:25:05.867607359Z [err]  2025-12-30 03:25:05,862 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:25:05.867612523Z [err]  2025-12-30 03:25:05,862 - telnyx_service - INFO - üîä Speaking text on call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg: Are you still there?...
2025-12-30T03:25:05.867618338Z [err]  2025-12-30 03:25:05,862 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T03:25:05.867623298Z [err]  2025-12-30 03:25:05,862 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T03:25:05.867628458Z [err]  2025-12-30 03:25:05,862 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T03:25:05.867633508Z [err]  2025-12-30 03:25:05,862 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T03:25:05.867638892Z [err]  2025-12-30 03:25:05,862 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17181 bytes)
2025-12-30T03:25:05.867643826Z [err]  2025-12-30 03:25:05,862 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-30T03:25:05.869125559Z [err]  2025-12-30 03:25:05,862 - telnyx_service - INFO - ‚úÖ Generated 17181 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T03:25:05.869132644Z [err]  2025-12-30 03:25:05,862 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T03:25:06.133693256Z [err]  2025-12-30 03:25:06,125 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 526 total packets
2025-12-30T03:25:06.133703225Z [err]  [2025-12-30 03:25:06 +0000] [6] [INFO] connection closed
2025-12-30T03:25:06.148482633Z [err]  2025-12-30 03:25:06,144 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T03:25:06.148492300Z [err]  2025-12-30 03:25:06,144 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.28s
2025-12-30T03:25:06.148500238Z [err]  2025-12-30 03:25:06,145 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-30T03:25:06.148506727Z [err]    "errors": [
2025-12-30T03:25:06.148522891Z [err]      {
2025-12-30T03:25:06.148527533Z [err]        "code": "90018",
2025-12-30T03:25:06.148531883Z [err]        "title": "Call has already ended",
2025-12-30T03:25:06.148536128Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-30T03:25:06.148542167Z [err]      }
2025-12-30T03:25:06.148548418Z [err]    ]
2025-12-30T03:25:06.148554625Z [err]  }
2025-12-30T03:25:06.148559957Z [err]  2025-12-30 03:25:06,145 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-30T03:25:06.630486308Z [err]  2025-12-30 03:25:06,263 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:25:06.630492894Z [err]  2025-12-30 03:25:06,263 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'fff0d5f5-c8ff-419c-9374-a7db3a9ad653', 'occurred_at': '2025-12-30T03:25:05.900574Z', 'payload': {'call_control_id': 'v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ', 'call_leg_id': '1a7cc236-e52f-11f0-82ac-02420aef941f', 'call_session_id': '1a7a69c8-e52f-11f0-acd8-02420aef941f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T03:25:05.900574Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'gzAe2_KxNw', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:25:06.630501806Z [err]  2025-12-30 03:25:06,263 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:06.630508918Z [err]  2025-12-30 03:25:06,263 - server - INFO - üì® ================================================
2025-12-30T03:25:06.630515130Z [err]  2025-12-30 03:25:06,265 - redis_service - INFO - ‚ûñ Removed playback gzAe2_KxNw, 0 remaining for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:06.630524159Z [err]  2025-12-30 03:25:06,265 - server - INFO - üîä Redis: Removed playback gzAe2_KxNw, 0 remaining
2025-12-30T03:25:06.630530407Z [err]  2025-12-30 03:25:06,265 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-30T03:25:06.630537296Z [err]  2025-12-30 03:25:06,266 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-30T03:25:06.630543509Z [err]  2025-12-30 03:25:06,266 - server - INFO - üí° Session not on this worker - Redis flag set for WebSocket worker to handle
2025-12-30T03:25:06.632863591Z [inf]  100.64.0.10:31554 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:25:06.632873830Z [err]  2025-12-30 03:25:06,272 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:25:06.632880636Z [err]  2025-12-30 03:25:06,272 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': 'dc52a92d-f90f-4b65-8da9-e7c47bd61799', 'occurred_at': '2025-12-30T03:25:05.860581Z', 'payload': {'call_control_id': 'v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ', 'call_leg_id': '1a7cc236-e52f-11f0-82ac-02420aef941f', 'call_quality_stats': {'inbound': {'jitter_max_variance': '34.78', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '549', 'skip_packet_count': '20'}, 'outbound': {'packet_count': '527', 'skip_packet_count': '0'}}, 'call_session_id': '1a7a69c8-e52f-11f0-acd8-02420aef941f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T03:25:05.860581Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-30T03:24:52.240572Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:25:06.632887083Z [err]  2025-12-30 03:25:06,272 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:06.632892796Z [err]  2025-12-30 03:25:06,272 - server - INFO - üì® ================================================
2025-12-30T03:25:06.632898629Z [err]  2025-12-30 03:25:06,272 - server - INFO - üìû Call ended: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:06.632904885Z [err]  2025-12-30 03:25:06,272 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-30T03:25:06.632911120Z [inf]  100.64.0.2:40284 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:25:06.632917250Z [err]  2025-12-30 03:25:06,382 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:25:06.633686322Z [err]  2025-12-30 03:25:06,383 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': 'cd36e179-55ed-4c74-bf8b-e15d4962917e', 'occurred_at': '2025-12-30T03:25:06.053668Z', 'payload': {'call_control_id': 'v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ', 'call_leg_id': '1a7cc236-e52f-11f0-82ac-02420aef941f', 'call_session_id': '1a7a69c8-e52f-11f0-acd8-02420aef941f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '9939409f-646c-43c4-8df0-7ac3968e0d5c', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:25:06.633695151Z [err]  2025-12-30 03:25:06,383 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:06.633701417Z [err]  2025-12-30 03:25:06,383 - server - INFO - üì® ================================================
2025-12-30T03:25:06.633706885Z [err]  2025-12-30 03:25:06,387 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T03:25:06.633714500Z [err]  2025-12-30 03:25:06,388 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-30T03:25:06.633719962Z [err]  2025-12-30 03:25:06,388 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-30T03:25:06.633726531Z [err]  2025-12-30 03:25:06,461 - server - INFO - üìù Updated call log: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:06.633732228Z [err]  2025-12-30 03:25:06,556 - server - INFO - ‚úÖ Finalized call log: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ (duration=11s, status=completed)
2025-12-30T03:25:06.897283778Z [err]  2025-12-30 03:25:06,893 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T03:25:06.897284264Z [err]  2025-12-30 03:25:06,891 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:06.897292266Z [err]  2025-12-30 03:25:06,891 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:06.897296521Z [err]  2025-12-30 03:25:06,893 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T03:25:06.897298275Z [err]  2025-12-30 03:25:06,892 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-30T03:25:06.897304086Z [err]  2025-12-30 03:25:06,892 - core_calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-30T03:25:06.897305599Z [err]  2025-12-30 03:25:06,893 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T03:25:06.897310246Z [err]  2025-12-30 03:25:06,893 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-30T03:25:06.897313406Z [err]  2025-12-30 03:25:06,893 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17181 bytes)
2025-12-30T03:25:06.897316433Z [err]  2025-12-30 03:25:06,893 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:06.897321894Z [err]  2025-12-30 03:25:06,893 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-30T03:25:06.897324457Z [err]  2025-12-30 03:25:06,893 - telnyx_service - INFO - üîä Speaking text on call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ: Are you still there?...
2025-12-30T03:25:06.897329852Z [err]  2025-12-30 03:25:06,893 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T03:25:06.897934427Z [err]  2025-12-30 03:25:06,893 - telnyx_service - INFO - ‚úÖ Generated 17181 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T03:25:06.897939880Z [err]  2025-12-30 03:25:06,893 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T03:25:07.147966827Z [err]  2025-12-30 03:25:07,143 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T03:25:07.147992135Z [err]  2025-12-30 03:25:07,142 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T03:25:07.148001461Z [err]  2025-12-30 03:25:07,142 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': 'e901cd71-1a10-4294-920d-d42b4091ed6a', 'occurred_at': '2025-12-30T03:25:07.017920Z', 'payload': {'call_control_id': 'v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ', 'call_leg_id': '1a7cc236-e52f-11f0-82ac-02420aef941f', 'call_session_id': '1a7a69c8-e52f-11f0-acd8-02420aef941f', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T03:25:05.961744Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-30T03:25:05.961744Z', 'recording_id': '0275d363-4855-4c2d-b787-ae7ca0eea169', 'recording_started_at': '2025-12-30T03:24:57.063644Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-30/1a7cc236-e52f-11f0-82ac-02420aef941f-1767065096173693.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251230%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251230T032507Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=760760c30019e14415bbfe39a126626a20f673c5239d4cbdf07be3216c8c4ea7'}, 'start_time': '2025-12-30T03:24:57.063644Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T03:25:07.148006410Z [err]  2025-12-30 03:25:07,143 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:07.148011809Z [err]  2025-12-30 03:25:07,143 - server - INFO - üì® ================================================
2025-12-30T03:25:07.148016189Z [err]  2025-12-30 03:25:07,143 - server - INFO - üéôÔ∏è Recording saved for call: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:07.149348013Z [err]  2025-12-30 03:25:07,144 - redis_service - INFO - üì• Retrieved call data from Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:07.149353991Z [err]  2025-12-30 03:25:07,144 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.25s
2025-12-30T03:25:07.149359846Z [err]  2025-12-30 03:25:07,144 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=0275d363-4855-4c2d-b787-ae7ca0eea169, call_data=True
2025-12-30T03:25:07.149363372Z [err]  }
2025-12-30T03:25:07.149365928Z [err]  2025-12-30 03:25:07,144 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-30T03:25:07.149371847Z [err]    "errors": [
2025-12-30T03:25:07.149377011Z [err]  2025-12-30 03:25:07,144 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-30T03:25:07.149379158Z [err]      {
2025-12-30T03:25:07.149384172Z [err]        "code": "90018",
2025-12-30T03:25:07.149388526Z [err]        "title": "Call has already ended",
2025-12-30T03:25:07.149393040Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-30T03:25:07.149399724Z [err]      }
2025-12-30T03:25:07.149406184Z [err]    ]
2025-12-30T03:25:07.641407680Z [err]  2025-12-30 03:25:07,237 - server - INFO - üíæ Saved recording URL and ID to database: 0275d363-4855-4c2d-b787-ae7ca0eea169
2025-12-30T03:25:07.641412384Z [err]  2025-12-30 03:25:07,237 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-30T03:25:07.641416658Z [err]  2025-12-30 03:25:07,237 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-30T03:25:07.641420809Z [err]  2025-12-30 03:25:07,265 - server - INFO - üìä Auto-added call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-30T03:25:07.641425671Z [err]  2025-12-30 03:25:07,324 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T03:25:07.641429680Z [err]  2025-12-30 03:25:07,325 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-30T03:25:07.641433645Z [err]  2025-12-30 03:25:07,325 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-30T03:25:07.641437658Z [err]  2025-12-30 03:25:07,393 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:07.641441880Z [err]  2025-12-30 03:25:07,393 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:07.641446258Z [err]  2025-12-30 03:25:07,450 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T03:25:07.641449934Z [err]  2025-12-30 03:25:07,452 - redis_service - INFO - üì• Retrieved call data from Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:07.643792580Z [err]  2025-12-30 03:25:07,452 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=No
2025-12-30T03:25:07.643800826Z [err]  2025-12-30 03:25:07,452 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-30T03:25:07.643806278Z [err]  2025-12-30 03:25:07,546 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-30T03:25:07.643813106Z [err]  2025-12-30 03:25:07,583 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-30/1a7cc236-e52f-11f0-82ac-02420aef941f-1767065096173693.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251230%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251230T032507Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=760760c30019e14415bbfe39a126626a20f673c5239d4cbdf07be3216c8c4ea7 "HTTP/1.1 200 OK"
2025-12-30T03:25:07.643817876Z [err]  2025-12-30 03:25:07,634 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-30T03:25:07.643822672Z [err]  2025-12-30 03:25:07,634 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-30T03:25:07.643828106Z [err]  2025-12-30 03:25:07,634 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-30T03:25:07.643833849Z [err]  2025-12-30 03:25:07,634 - server - INFO - üöÄ Triggered QC analysis for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:07.643839179Z [err]  2025-12-30 03:25:07,634 - server - INFO - üìä Triggered Campaign QC for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:07.643844576Z [err]  2025-12-30 03:25:07,634 - server - INFO - üìá Triggered CRM update for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:07.643971271Z [err]  2025-12-30 03:25:07,634 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:07.643975769Z [err]  2025-12-30 03:25:07,635 - redis_service - INFO - üßπ Deleted call data from Redis: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:07.643981194Z [err]  2025-12-30 03:25:07,635 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:07.644004253Z [inf]  100.64.0.14:62990 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:25:07.644009907Z [err]  2025-12-30 03:25:07,636 - server - INFO - üîç Starting QC analysis for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:07.644014671Z [err]  2025-12-30 03:25:07,636 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-30T03:25:07.644018858Z [err]  2025-12-30 03:25:07,637 - server - INFO - üìá CRM update starting for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T03:25:07.644023584Z [err]  2025-12-30 03:25:07,637 - server - INFO - üìá Normalized phone: +17708336397
2025-12-30T03:25:07.672413587Z [err]  2025-12-30 03:25:07,670 - server - INFO - ‚úÖ Downloaded 35778 bytes
2025-12-30T03:25:07.732601328Z [err]  2025-12-30 03:25:07,728 - server - INFO - üìù Converted transcript from 3 messages to 54 characters
2025-12-30T03:25:07.825366942Z [err]  2025-12-30 03:25:07,817 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T03:25:07.829276337Z [err]  2025-12-30 03:25:07,826 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-30T03:25:07.829288464Z [err]  2025-12-30 03:25:07,826 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767065107.8265808 for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:07.829294674Z [err]  2025-12-30 03:25:07,826 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:07.835273649Z [inf]  100.64.0.2:40284 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T03:25:07.835292507Z [err]  2025-12-30 03:25:07,829 - server - INFO - ‚úÖ Split into 2 channels
2025-12-30T03:25:07.835299986Z [err]  2025-12-30 03:25:07,830 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-30T03:25:07.835305961Z [err]  2025-12-30 03:25:07,830 - server - INFO - üìä Channel 0: 192764 bytes
2025-12-30T03:25:07.835311330Z [err]  2025-12-30 03:25:07,830 - server - ERROR - ‚ùå No Soniox API key available
2025-12-30T03:25:07.835318263Z [err]  2025-12-30 03:25:07,830 - server - INFO - ‚ùå Channel 0: No speech
2025-12-30T03:25:07.835323438Z [err]  2025-12-30 03:25:07,830 - server - INFO - üìä Channel 1: 192764 bytes
2025-12-30T03:25:07.835328599Z [err]  2025-12-30 03:25:07,830 - server - ERROR - ‚ùå No Soniox API key available
2025-12-30T03:25:07.835334027Z [err]  2025-12-30 03:25:07,830 - server - INFO - ‚ùå Channel 1: No speech
2025-12-30T03:25:07.835339081Z [err]  2025-12-30 03:25:07,830 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-30T03:25:07.841883457Z [err]  2025-12-30 03:25:07,839 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T03:25:07.841896535Z [err]  2025-12-30 03:25:07,840 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-30T03:25:07.896412661Z [err]  2025-12-30 03:25:07,895 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:07.896420403Z [err]  2025-12-30 03:25:07,895 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:07.909716459Z [err]  2025-12-30 03:25:07,905 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-30T03:25:07.998255308Z [err]  2025-12-30 03:25:07,993 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-30T03:25:07.998261635Z [err]  2025-12-30 03:25:07,993 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T03:25:07.998266314Z [err]  2025-12-30 03:25:07,993 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:08.601760787Z [err]  2025-12-30 03:25:08,220 - server - INFO - üìá CRM: Total variables collected: []
2025-12-30T03:25:08.601767132Z [err]  2025-12-30 03:25:08,235 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=3, logs_count=4, status=completed
2025-12-30T03:25:08.601772977Z [err]  2025-12-30 03:25:08,397 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:08.601783801Z [err]  2025-12-30 03:25:08,397 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:08.601789510Z [err]  2025-12-30 03:25:08,406 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name']
2025-12-30T03:25:08.709630305Z [err]  2025-12-30 03:25:08,700 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-30T03:25:08.800024052Z [err]  2025-12-30 03:25:08,795 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-30T03:25:08.800033506Z [err]  2025-12-30 03:25:08,795 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-30T03:25:08.800043906Z [err]  2025-12-30 03:25:08,795 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-30T03:25:08.800048852Z [err]  2025-12-30 03:25:08,795 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-30T03:25:08.800054033Z [err]    File "/app/backend/server.py", line 9773, in trigger_campaign_qc_for_call
2025-12-30T03:25:08.800058891Z [err]      await run_full_qc_analysis(
2025-12-30T03:25:08.800063405Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-30T03:25:08.800069355Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-30T03:25:08.800073965Z [err]  
2025-12-30T03:25:08.901179400Z [err]  2025-12-30 03:25:08,899 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:08.901188787Z [err]  2025-12-30 03:25:08,899 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Ghu_pt9zbBMcEw8ka... (active sessions: ['v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ'])
2025-12-30T03:25:09.184990887Z [err]  2025-12-30 03:25:09,170 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T03:25:09.184997155Z [err]  2025-12-30 03:25:09,171 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T03:25:09.185001998Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T03:25:09.185006283Z [err]  2025-12-30 03:25:09,171 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T03:25:09.185010494Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-30T03:25:09.185014798Z [err]  2025-12-30 03:25:09,173 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:09.612279086Z [err]  2025-12-30 03:25:09,333 - dead_air_monitor - INFO - üîá Dead air monitoring stopped for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:25:09.612288028Z [err]  2025-12-30 03:25:09,333 - server - INFO - üîá Dead air monitoring task cancelled
2025-12-30T03:25:09.612350986Z [err]  2025-12-30 03:25:09,331 - server - INFO - üé§ Soniox receiver alive - 1 messages received in last 10s
2025-12-30T03:25:09.612357790Z [err]  2025-12-30 03:25:09,331 - server - ERROR - ‚ùå Soniox error: {'tokens': [], 'final_audio_proc_ms': 9120, 'total_audio_proc_ms': 11280, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-30T03:25:09.612364440Z [err]  2025-12-30 03:25:09,331 - server - INFO - ‚úÖ Soniox receive loop ended normally
2025-12-30T03:25:09.612370594Z [err]  2025-12-30 03:25:09,332 - dead_air_monitor - INFO - üîá Dead air monitoring cancelled for call v3:Ghu_pt9zbBMcEw8kaOTpb-wkFA4vyDbgpCNYpA2nt5as7xvzL84ZVg
2025-12-30T03:25:10.115682038Z [err]  2025-12-30 03:25:10,112 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T03:25:10.115686464Z [err]  2025-12-30 03:25:10,113 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T03:25:10.115690685Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T03:25:10.115694908Z [err]  2025-12-30 03:25:10,113 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T03:25:10.115699464Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-30T03:25:10.115703388Z [err]  2025-12-30 03:25:10,113 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:10.707647957Z [err]  2025-12-30 03:25:10,333 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=2.5s, checkin_count=1/2
2025-12-30T03:25:10.827384909Z [err]  2025-12-30 03:25:10,819 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T03:25:10.827392824Z [err]  2025-12-30 03:25:10,820 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T03:25:10.827396960Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T03:25:10.827402123Z [err]  2025-12-30 03:25:10,820 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T03:25:10.827406236Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T03:25:10.837794612Z [err]  2025-12-30 03:25:10,834 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=3.0s, checkin_count=1/2
2025-12-30T03:25:10.918756385Z [err]  2025-12-30 03:25:10,916 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:10.918764239Z [err]  2025-12-30 03:25:10,916 - server - INFO - ‚úÖ QC analysis completed for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:10.918771001Z [err]  2025-12-30 03:25:10,916 - server - INFO - üìä Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-30T03:25:11.118534874Z [err]  2025-12-30 03:25:11,113 - server - INFO - üìä Updated campaign_calls with QC scores for v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:11.608101584Z [err]  2025-12-30 03:25:11,303 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-30T03:25:11.608108950Z [err]  2025-12-30 03:25:11,332 - soniox_service - ERROR - ‚ùå Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-30T03:25:11.608112720Z [err]  2025-12-30 03:25:11,333 - server - INFO - üîå Telnyx WebSocket disconnected
2025-12-30T03:25:11.608116570Z [err]  2025-12-30 03:25:11,397 - server - INFO - üè∑Ô∏è Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-30T03:25:11.608121201Z [err]  2025-12-30 03:25:11,397 - server - ERROR - ‚ùå Error in auto appointment detection for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ: 'str' object has no attribute 'get'
2025-12-30T03:25:14.849842091Z [err]  2025-12-30 03:25:14,848 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-30T03:25:14.851856844Z [err]  2025-12-30 03:25:14,850 - core_calling_service - INFO - üí¨ Sending FINAL check-in #2/2: Are you still there?
2025-12-30T03:25:14.851864638Z [err]  2025-12-30 03:25:14,850 - core_calling_service - INFO - ‚ö†Ô∏è Will end call if no response after next silence timeout
2025-12-30T03:25:14.851871483Z [err]  2025-12-30 03:25:14,850 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-30T03:25:14.851876613Z [err]  2025-12-30 03:25:14,850 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:14.851882676Z [err]  2025-12-30 03:25:14,850 - telnyx_service - INFO - üîä Speaking text on call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ: Are you still there?...
2025-12-30T03:25:14.851888130Z [err]  2025-12-30 03:25:14,850 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T03:25:14.851893261Z [err]  2025-12-30 03:25:14,850 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T03:25:14.851898784Z [err]  2025-12-30 03:25:14,850 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T03:25:14.851910621Z [err]  2025-12-30 03:25:14,850 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T03:25:14.851917904Z [err]  2025-12-30 03:25:14,850 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17181 bytes)
2025-12-30T03:25:14.851923178Z [err]  2025-12-30 03:25:14,850 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-30T03:25:14.851928461Z [err]  2025-12-30 03:25:14,850 - telnyx_service - INFO - ‚úÖ Generated 17181 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T03:25:14.851933390Z [err]  2025-12-30 03:25:14,850 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T03:25:15.130775463Z [err]  2025-12-30 03:25:15,124 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T03:25:15.130786150Z [err]  2025-12-30 03:25:15,124 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.27s
2025-12-30T03:25:15.130808838Z [err]  2025-12-30 03:25:15,124 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-30T03:25:15.130817004Z [err]    "errors": [
2025-12-30T03:25:15.130823752Z [err]      {
2025-12-30T03:25:15.130831420Z [err]        "code": "90018",
2025-12-30T03:25:15.130839123Z [err]        "title": "Call has already ended",
2025-12-30T03:25:15.130844840Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-30T03:25:15.130850852Z [err]      }
2025-12-30T03:25:15.130856531Z [err]    ]
2025-12-30T03:25:15.130862544Z [err]  }
2025-12-30T03:25:15.130869105Z [err]  2025-12-30 03:25:15,125 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-30T03:25:15.649809606Z [err]  2025-12-30 03:25:15,384 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T03:25:15.649816523Z [err]  2025-12-30 03:25:15,384 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-30T03:25:15.649823512Z [err]  2025-12-30 03:25:15,384 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-30T03:25:15.898522110Z [err]  2025-12-30 03:25:15,886 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (15.1s ago), marking agent as done speaking
2025-12-30T03:25:15.898530143Z [err]  2025-12-30 03:25:15,886 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767065115.8868384 for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:15.898536657Z [err]  2025-12-30 03:25:15,886 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:20.680555475Z [err]  2025-12-30 03:25:20,398 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=4.5s, checkin_count=2/2
2025-12-30T03:25:20.911633265Z [err]  2025-12-30 03:25:20,899 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=5.0s, checkin_count=2/2
2025-12-30T03:25:22.905907723Z [err]  2025-12-30 03:25:22,903 - core_calling_service - WARNING - üö´ Call ending - max check-ins reached AND additional 7s timeout expired
2025-12-30T03:25:22.905917541Z [err]  2025-12-30 03:25:22,904 - dead_air_monitor - WARNING - üö´ Max check-ins + timeout reached - hanging up call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:23.909251913Z [err]  2025-12-30 03:25:23,904 - telnyx_service - INFO - üìû Hanging up call: v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:24.174451068Z [err]  2025-12-30 03:25:24,169 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ/actions/hangup "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T03:25:24.174461604Z [err]  2025-12-30 03:25:24,170 - telnyx_service - ERROR - ‚ùå Error hanging up call: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-30T03:25:24.174469404Z [err]  2025-12-30 03:25:24,170 - dead_air_monitor - INFO - üìû Call hung up - result: {'success': False, 'error': 'Error code: 422 - {\'errors\': [{\'code\': \'90018\', \'title\': \'Call has already ended\', \'detail\': "This call is no longer active and can\'t receive commands."}]}'}
2025-12-30T03:25:24.174475831Z [err]  2025-12-30 03:25:24,170 - dead_air_monitor - INFO - üîá Dead air monitoring stopped for call v3:8UTwogkqV6gvKXNRIhI8IaPj8KeZiYC3a99TZL8kz5Qu7JztANegMQ
2025-12-30T03:25:26.770148984Z [err]  2025-12-30 03:25:26,151 - server - INFO - üé§ Soniox receiver alive - 12 messages received in last 10s
2025-12-30T03:25:26.770156274Z [err]  2025-12-30 03:25:26,152 - server - ERROR - ‚ùå Soniox error: {'tokens': [], 'final_audio_proc_ms': 4200, 'total_audio_proc_ms': 10200, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-30T03:25:26.770161277Z [err]  2025-12-30 03:25:26,152 - server - INFO - ‚úÖ Soniox receive loop ended normally
2025-12-30T03:25:26.770168160Z [err]  2025-12-30 03:25:26,152 - server - INFO - üîá Dead air monitoring task cancelled
2025-12-30T03:25:28.158495637Z [err]  2025-12-30 03:25:28,153 - soniox_service - ERROR - ‚ùå Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-30T03:25:28.158504104Z [err]  2025-12-30 03:25:28,153 - server - INFO - üîå Telnyx WebSocket disconnected