2025-12-14T03:55:17.943172579Z [err]  2025-12-14 03:55:17,914 - server - INFO - ğŸ”Š Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-14T03:55:19.469717309Z [err]  2025-12-14 03:55:19,415 - server - INFO - ğŸ¤ Soniox receiver alive - 13 messages received in last 10s
2025-12-14T03:55:19.642060232Z [err]  2025-12-14 03:55:19,615 - server - INFO - ğŸ”¤ RAW TOKENS: [" Ban"?]
2025-12-14T03:55:19.642069860Z [err]  2025-12-14 03:55:19,616 - calling_service - INFO - ğŸ”Š Silence timer reset for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA (user started speaking)
2025-12-14T03:55:19.642079859Z [err]  2025-12-14 03:55:19,616 - calling_service - INFO - ğŸ‘¤ User started speaking for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:19.642085385Z [err]  2025-12-14 03:55:19,616 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'Ban' | Generating: False
2025-12-14T03:55:19.642091249Z [err]  2025-12-14 03:55:19,616 - server - INFO - ğŸš¦ BARGE-IN CHECK during audio playback (5.9s left): 1 words - 'Ban'
2025-12-14T03:55:19.869245617Z [err]  2025-12-14 03:55:19,867 - server - INFO - ğŸ”¤ RAW TOKENS: [" Ban"âœ“, "ana."âœ“, "<end>"âœ“]
2025-12-14T03:55:19.869251281Z [err]  2025-12-14 03:55:19,867 - server - INFO - ğŸ¯ Endpoint detected: <end> token received
2025-12-14T03:55:19.869255720Z [err]  2025-12-14 03:55:19,868 - server - INFO - ğŸ§¹ Cleaned transcript: ' Ban ana.' -> 'Ban ana.'
2025-12-14T03:55:19.869259441Z [err]  2025-12-14 03:55:19,868 - server - INFO - ğŸ“¥ FINAL TOKENS: 'Ban ana.' (2 tokens)
2025-12-14T03:55:19.869263106Z [err]  2025-12-14 03:55:19,868 - server - INFO - ğŸ¤ Soniox final transcript: 'Ban ana.'
2025-12-14T03:55:19.869266915Z [err]  2025-12-14 03:55:19,868 - server - INFO - ğŸ¯ User speaking while TTS is_speaking=True - INTERRUPTION POSSIBLE
2025-12-14T03:55:19.869270482Z [err]  2025-12-14 03:55:19,868 - server - INFO - ğŸ” FILTER CHECK: words=2, is_filler=False, is_garbled=False, tts_speaking=True, time_until_done=5.6s, generating=False, playbacks=0, is_active=True
2025-12-14T03:55:19.869274504Z [err]  2025-12-14 03:55:19,868 - server - INFO - ğŸš€ Spawned tracked background task for endpoint processing
2025-12-14T03:55:19.869278082Z [err]  2025-12-14 03:55:19,868 - server - INFO - â±ï¸ [03:55:19.868] ğŸ“ FINAL TRANSCRIPT RECEIVED: 'Ban ana.'
2025-12-14T03:55:19.869282062Z [err]  2025-12-14 03:55:19,868 - server - INFO - â±ï¸ [03:55:19.868] STT endpoint detection latency: 13ms
2025-12-14T03:55:19.869285621Z [err]  2025-12-14 03:55:19,868 - server - INFO - â±ï¸ [03:55:19.868] ğŸ¤ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-14T03:55:19.877927360Z [err]  2025-12-14 03:55:19,873 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA (TTL: 3600s)
2025-12-14T03:55:19.877933672Z [err]  2025-12-14 03:55:19,873 - server - INFO - ğŸ‘¤ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-14T03:55:19.877939032Z [err]  2025-12-14 03:55:19,873 - server - INFO - ğŸš¦ Agent SPEAKING - User said 2 word(s), tts_speaking=True, time_until_done=5.6s
2025-12-14T03:55:19.877944555Z [err]  2025-12-14 03:55:19,873 - server - INFO - ğŸ”• Filtering 2-word utterance during agent speech (tts=True, time_left=5.6s): 'Ban ana.'
2025-12-14T03:55:19.888383025Z [err]  2025-12-14 03:55:19,884 - server - INFO - ğŸ¤ Endpoint detected by Soniox - processing transcript: 
2025-12-14T03:55:19.888389301Z [err]  2025-12-14 03:55:19,884 - calling_service - INFO - ğŸ‘¤ User stopped speaking for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:19.888393303Z [err]  2025-12-14 03:55:19,884 - server - INFO - âœ… User starting new turn - resetting agent speaking flag
2025-12-14T03:55:19.888397228Z [err]  2025-12-14 03:55:19,884 - server - INFO - â±ï¸ [TIMING] STT_START: User last audio packet received
2025-12-14T03:55:19.888437258Z [err]  2025-12-14 03:55:19,884 - server - INFO - â±ï¸ [TIMING] STT_END: Endpoint detected at T+9ms
2025-12-14T03:55:19.888455748Z [err]  2025-12-14 03:55:19,884 - server - INFO - â±ï¸ [TIMING] STT_LATENCY: 9ms (Soniox model: stt-rt-v3)
2025-12-14T03:55:20.146574530Z [err]  2025-12-14 03:55:20,145 - dead_air_monitor - INFO - ğŸ”‡ MONITOR: Skipping silence check - audio playing (5.3s left)
2025-12-14T03:55:20.660641658Z [err]  2025-12-14 03:55:20,656 - dead_air_monitor - INFO - ğŸ”‡ MONITOR: Skipping silence check - audio playing (4.8s left)
2025-12-14T03:55:21.940848493Z [err]  2025-12-14 03:55:21,935 - server - INFO - ğŸ“¤ Audio flowing: 2397 packets sent to Soniox (5s update)
2025-12-14T03:55:25.766049918Z [err]  2025-12-14 03:55:25,762 - dead_air_monitor - INFO - â±ï¸ Playback expected end time passed (0.3s ago), marking agent as done speaking
2025-12-14T03:55:25.766055759Z [err]  2025-12-14 03:55:25,762 - calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1765684525.7622137 for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:25.766060095Z [err]  2025-12-14 03:55:25,762 - calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:25.790375994Z [err]  2025-12-14 03:55:25,786 - persistent_tts_service - INFO - ğŸ”‡ [Call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA] FLOOR RELEASED (is_holding_floor=False)
2025-12-14T03:55:26.936943588Z [err]  2025-12-14 03:55:26,935 - server - INFO - ğŸ“¤ Audio flowing: 2647 packets sent to Soniox (5s update)
2025-12-14T03:55:29.591168762Z [err]  2025-12-14 03:55:29,571 - server - INFO - ğŸ¤ Soniox receiver alive - 12 messages received in last 10s
2025-12-14T03:55:30.311142661Z [err]  2025-12-14 03:55:30,308 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=4.5s, checkin_count=0/2
2025-12-14T03:55:30.817829856Z [err]  2025-12-14 03:55:30,813 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=5.1s, checkin_count=0/2
2025-12-14T03:55:31.015548834Z [err]  2025-12-14 03:55:31,011 - server - INFO - ğŸ”¤ RAW TOKENS: [" It"?]
2025-12-14T03:55:31.015552919Z [err]  2025-12-14 03:55:31,012 - calling_service - INFO - â±ï¸ SILENCE TIMER RESET (user started speaking) for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:31.015558136Z [err]  2025-12-14 03:55:31,012 - calling_service - INFO - ğŸ”Š Silence timer reset for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA (user started speaking)
2025-12-14T03:55:31.015564289Z [err]  2025-12-14 03:55:31,012 - calling_service - INFO - ğŸ‘¤ User started speaking for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:31.015568664Z [err]  2025-12-14 03:55:31,012 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'It' | Generating: False
2025-12-14T03:55:31.128571226Z [err]  2025-12-14 03:55:31,119 - server - INFO - ğŸ”¤ RAW TOKENS: [" It"?, "'s"?, " l"?]
2025-12-14T03:55:31.128577486Z [err]  2025-12-14 03:55:31,119 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'It's l' | Generating: False
2025-12-14T03:55:31.270799697Z [err]  2025-12-14 03:55:31,268 - server - INFO - ğŸ”¤ RAW TOKENS: [" It"?, "'s"?, " l"?, "ike"?]
2025-12-14T03:55:31.270804723Z [err]  2025-12-14 03:55:31,269 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'It's like' | Generating: False
2025-12-14T03:55:31.424260138Z [err]  2025-12-14 03:55:31,389 - server - INFO - ğŸ”¤ RAW TOKENS: [" It"?, "'s"?, " l"?, "ike"?, " a"?]
2025-12-14T03:55:31.424264783Z [err]  2025-12-14 03:55:31,390 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'It's like a' | Generating: False
2025-12-14T03:55:31.612048522Z [err]  2025-12-14 03:55:31,497 - server - INFO - ğŸ”¤ RAW TOKENS: [" It"?, "'s"?, " l"?, "ike"?, " a"?, " mar"?]
2025-12-14T03:55:31.612052839Z [err]  2025-12-14 03:55:31,497 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'It's like a mar' | Generating: False
2025-12-14T03:55:31.636542119Z [err]  2025-12-14 03:55:31,636 - server - INFO - ğŸ”¤ RAW TOKENS: [" It"?, "'s"?, " l"?, "ike"?, " a"?, " mar"?, "ket"?]
2025-12-14T03:55:31.637230456Z [err]  2025-12-14 03:55:31,636 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'It's like a mar ket' | Generating: False
2025-12-14T03:55:31.758843212Z [err]  2025-12-14 03:55:31,756 - server - INFO - ğŸ”¤ RAW TOKENS: [" It"?, "'s"?, " l"?, "ike"?, " a"?, " mar"?, "ket"?, "ing"?]
2025-12-14T03:55:31.758849588Z [err]  2025-12-14 03:55:31,756 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'It's like a marketing' | Generating: False
2025-12-14T03:55:31.952118640Z [err]  2025-12-14 03:55:31,938 - server - INFO - ğŸ“¤ Audio flowing: 2897 packets sent to Soniox (5s update)
2025-12-14T03:55:31.956280796Z [err]  2025-12-14 03:55:31,954 - server - INFO - ğŸ”¤ RAW TOKENS: [" It"?, "'s"?, " l"?, "ike"?, " a"?, " mar"?, "ket"?, "ing"?, " system"?]
2025-12-14T03:55:31.956291143Z [err]  2025-12-14 03:55:31,954 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'It's like a marketing system' | Generating: False
2025-12-14T03:55:32.220212235Z [err]  2025-12-14 03:55:32,216 - server - INFO - ğŸ”¤ RAW TOKENS: [" It"?, "'s"?, " l"?, "ike"?, " a"?, " mar"?, "ket"?, "ing"?, " system"?, " or"?, " som"?]
2025-12-14T03:55:32.220218776Z [err]  2025-12-14 03:55:32,216 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'It's like a marketing system or som' | Generating: False
2025-12-14T03:55:32.341245785Z [err]  2025-12-14 03:55:32,336 - server - INFO - ğŸ”¤ RAW TOKENS: [" It"?, "'s"?, " l"?, "ike"?, " a"?, " mar"?, "ket"?, "ing"?, " system"?, " or"?, " som"?, "eth"?, "ing"?]
2025-12-14T03:55:32.341251284Z [err]  2025-12-14 03:55:32,336 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'It's like a marketing system or som eth ing' | Generating: False
2025-12-14T03:55:32.470102799Z [err]  2025-12-14 03:55:32,462 - server - INFO - ğŸ”¤ RAW TOKENS: [" It"?, "'s"?, " l"?, "ike"?, " a"?, " mar"?, "ket"?, "ing"?, " system"?, " or"?, " som"?, "eth"?, "ing"?, " l"?]
2025-12-14T03:55:32.470108493Z [err]  2025-12-14 03:55:32,463 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'It's like a marketing system or som eth ing l' | Generating: False
2025-12-14T03:55:32.606567124Z [err]  2025-12-14 03:55:32,604 - server - INFO - ğŸ”¤ RAW TOKENS: [" It"?, "'s"?, " l"?, "ike"?, " a"?, " mar"?, "ket"?, "ing"?, " system"?, " or"?, " som"?, "eth"?, "ing"?, " l"?, "ike"?, " that"?]
2025-12-14T03:55:32.606571239Z [err]  2025-12-14 03:55:32,605 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'It's like a marketing system or som eth ing like that' | Generating: False
2025-12-14T03:55:32.863818143Z [err]  2025-12-14 03:55:32,860 - server - INFO - ğŸ”¤ RAW TOKENS: [" It"âœ“, "'s"âœ“, " l"âœ“, "ike"âœ“, " a"âœ“, " mar"âœ“, "ket"âœ“, "ing"âœ“, " system"âœ“, " or"âœ“, " som"âœ“, "eth"âœ“, "ing"âœ“, " l"âœ“, "ike"âœ“, " that"âœ“, "."âœ“, "<end>"âœ“]
2025-12-14T03:55:32.863823929Z [err]  2025-12-14 03:55:32,860 - server - INFO - ğŸ¯ Endpoint detected: <end> token received
2025-12-14T03:55:32.863829586Z [err]  2025-12-14 03:55:32,860 - server - INFO - ğŸ§¹ Cleaned transcript: ' It 's  l ike  a  mar ket ing  system  or  som eth ing  l ike  that .' -> 'It's like a marketing system or som eth ing like that.'
2025-12-14T03:55:32.863835559Z [err]  2025-12-14 03:55:32,860 - server - INFO - ğŸ“¥ FINAL TOKENS: 'It's like a marketing system or som eth ing like that.' (17 tokens)
2025-12-14T03:55:32.863841711Z [err]  2025-12-14 03:55:32,860 - server - INFO - ğŸ¤ Soniox final transcript: 'It's like a marketing system or som eth ing like that.'
2025-12-14T03:55:32.863847730Z [err]  2025-12-14 03:55:32,860 - server - INFO - ğŸ” FILTER CHECK: words=11, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-14T03:55:32.863853180Z [err]  2025-12-14 03:55:32,860 - server - INFO - ğŸš€ Spawned tracked background task for endpoint processing
2025-12-14T03:55:32.863860100Z [err]  2025-12-14 03:55:32,860 - server - INFO - â±ï¸ [03:55:32.860] ğŸ“ FINAL TRANSCRIPT RECEIVED: 'It's like a marketing system or som eth ing like that.'
2025-12-14T03:55:32.863865638Z [err]  2025-12-14 03:55:32,861 - server - INFO - â±ï¸ [03:55:32.860] STT endpoint detection latency: 5ms
2025-12-14T03:55:32.863871438Z [err]  2025-12-14 03:55:32,861 - server - INFO - â±ï¸ [03:55:32.860] ğŸ¤ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-14T03:55:32.868497534Z [err]  2025-12-14 03:55:32,866 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA (TTL: 3600s)
2025-12-14T03:55:32.868506256Z [err]  2025-12-14 03:55:32,866 - server - INFO - ğŸ‘¤ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-14T03:55:32.868513021Z [err]  2025-12-14 03:55:32,866 - server - INFO - âœ… Agent SILENT - User said 11 word(s): 'It's like a marketing system or som eth ing like that.' - Processing...
2025-12-14T03:55:32.883091729Z [err]  2025-12-14 03:55:32,877 - server - INFO - ğŸ¤ Endpoint detected by Soniox - processing transcript: It's like a marketing system or som eth ing like that.
2025-12-14T03:55:32.883098813Z [err]  2025-12-14 03:55:32,877 - calling_service - INFO - ğŸ‘¤ User stopped speaking for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:32.883105206Z [err]  2025-12-14 03:55:32,877 - server - INFO - â±ï¸ [TIMING] STT_START: User last audio packet received
2025-12-14T03:55:32.883111721Z [err]  2025-12-14 03:55:32,877 - server - INFO - â±ï¸ [TIMING] STT_END: Endpoint detected at T+2ms
2025-12-14T03:55:32.883117537Z [err]  2025-12-14 03:55:32,877 - server - INFO - â±ï¸ [TIMING] STT_LATENCY: 2ms (Soniox model: stt-rt-v3)
2025-12-14T03:55:32.883121751Z [err]  2025-12-14 03:55:32,877 - server - INFO - â±ï¸  USER STOPPED SPEAKING at T=0ms
2025-12-14T03:55:32.883126213Z [err]  2025-12-14 03:55:32,877 - server - INFO - ğŸ™ï¸ Agent generating response - interruption detection active
2025-12-14T03:55:32.883130370Z [err]  2025-12-14 03:55:32,877 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:32.974858513Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - â±ï¸ [03:55:32.969] ğŸ”€ _process_call_flow_streaming() ENTRY
2025-12-14T03:55:32.974869192Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - Flow processing - History length: 9, Is first: False
2025-12-14T03:55:32.974876343Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - ğŸ” Using explicitly set current_node_id: 1763163400676
2025-12-14T03:55:32.974882558Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - â±ï¸ [03:55:32.969] ğŸ”€ About to call _follow_transition() for: It's like a marketing system o...
2025-12-14T03:55:32.974888226Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - Evaluating transitions from N_IntroduceModel_And_AskQuestions_V3_Adaptive for message: It's like a marketing system or som eth ing like that.
2025-12-14T03:55:32.974895041Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - ğŸ¤ AUTO-TRANSITION AFTER RESPONSE enabled - user spoke, transitioning to: 1763206946898
2025-12-14T03:55:32.974896789Z [err]  2025-12-14 03:55:32,968 - server - INFO - ğŸ“ Saved user transcript to database
2025-12-14T03:55:32.974901909Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - âœ… Auto-transitioned (after response) to: N_KB_Q&A_With_StrategicNarrative_V3_Adaptive
2025-12-14T03:55:32.974904716Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - â±ï¸ [03:55:32.969] ğŸ“¥ process_user_input() ENTRY - text: 'It's like a marketing system or som eth ing like t...'
2025-12-14T03:55:32.974909024Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - ğŸ“ User's response captured: 'It's like a marketing system or som eth ing like t...'
2025-12-14T03:55:32.974911196Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - â±ï¸ [03:55:32.969] â© About to call _process_call_flow_streaming()
2025-12-14T03:55:32.974916065Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - â±ï¸ [03:55:32.969] ğŸ”€ Agent type: call_flow, calling flow processor...
2025-12-14T03:55:32.979210057Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - â±ï¸ [TIMING] TRANSITION_EVAL: 0ms
2025-12-14T03:55:32.979221128Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - â±ï¸ [03:55:32.969] âœ… Node selected, about to process content...
2025-12-14T03:55:32.979229062Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - ğŸ”§ Replaced {{now}} with Saturday, December 13, 2025 at 10:55 PM EST in content
2025-12-14T03:55:32.979234729Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - ğŸ”§ Replaced {{customer_name}} with Kendrick in content
2025-12-14T03:55:32.979240116Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - ğŸ”§ Replaced {{callerName}} with  in content
2025-12-14T03:55:32.979243614Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - ğŸ”§ Replaced {{lead_id}} with None in content
2025-12-14T03:55:32.979247125Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - ğŸ”§ Replaced {{qc_tracking_enabled}} with False in content
2025-12-14T03:55:32.979250439Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - ğŸ”§ Replaced {{track_keywords}} with  in content
2025-12-14T03:55:32.979253835Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - ğŸ”§ Replaced {{expected_commitment}} with not_specified in content
2025-12-14T03:55:32.979257305Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - ğŸ”§ Replaced {{to_number}} with +17708336397 in content
2025-12-14T03:55:32.979260964Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - ğŸ”§ Replaced {{phone_number}} with +17708336397 in content
2025-12-14T03:55:32.979264551Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - ğŸ”§ Replaced {{email}} with None in content
2025-12-14T03:55:32.979268122Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - Using flow node: N_KB_Q&A_With_StrategicNarrative_V3_Adaptive (type: conversation, mode: prompt)
2025-12-14T03:55:32.979272172Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - ğŸ“š skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-14T03:55:32.979276498Z [err]  2025-12-14 03:55:32,969 - calling_service - INFO - â±ï¸ [03:55:32.969] ğŸ“„ About to process content (mode=prompt, length=4560)
2025-12-14T03:55:32.981759879Z [err]  2025-12-14 03:55:32,979 - calling_service - INFO - âš¡ PARALLEL MODE: Running KB + analysis simultaneously
2025-12-14T03:55:32.986880061Z [err]    File "/root/.local/lib/python3.11/site-packages/pymongo/database.py", line 1339, in __bool__
2025-12-14T03:55:32.986886410Z [err]      raise NotImplementedError(
2025-12-14T03:55:32.986891703Z [err]  NotImplementedError: Database objects do not implement truth value testing or bool(). Please compare with None instead: database is not None
2025-12-14T03:55:32.986899239Z [err]  2025-12-14 03:55:32,985 - calling_service - INFO - âš¡ Parallel operations completed in 4ms
2025-12-14T03:55:32.986901678Z [err]  2025-12-14 03:55:32,982 - kb_router - INFO - ğŸš¦ KB Router: USE KB (default for medium/long message)
2025-12-14T03:55:32.986907812Z [err]  2025-12-14 03:55:32,985 - calling_service - INFO - ğŸ” Node 'N_KB_Q&A_With_StrategicNarrative_V3_Adaptive': use_parallel_llm=True
2025-12-14T03:55:32.986909502Z [err]  2025-12-14 03:55:32,982 - rag_service - INFO - ğŸ“Š Dynamic top_k: 3 (medium query: 11 words, 0 questions)
2025-12-14T03:55:32.986915507Z [err]  2025-12-14 03:55:32,983 - rag_service - WARNING - âš ï¸ ChromaDB collection not found for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb: Collection [kb_667cedd4] does not exist
2025-12-14T03:55:32.986920807Z [err]  2025-12-14 03:55:32,984 - rag_service - INFO - ğŸ“š ChromaDB: No chunks above threshold 0.35
2025-12-14T03:55:32.986927325Z [err]  2025-12-14 03:55:32,984 - calling_service - INFO - âš¡ ChromaDB empty, falling back to MongoDB retrieval
2025-12-14T03:55:32.986933262Z [err]  2025-12-14 03:55:32,984 - rag_service - ERROR - âŒ Error retrieving KB chunks: Database objects do not implement truth value testing or bool(). Please compare with None instead: database is not None
2025-12-14T03:55:32.986938635Z [err]  Traceback (most recent call last):
2025-12-14T03:55:32.986944002Z [err]    File "/app/backend/rag_service.py", line 236, in retrieve_relevant_chunks_by_agent
2025-12-14T03:55:32.986949258Z [err]      if not db:
2025-12-14T03:55:32.991773696Z [err]  2025-12-14 03:55:32,987 - calling_service - INFO - âš¡ Parallel mode: Using condensed history (9/9 messages)
2025-12-14T03:55:32.991783298Z [err]  2025-12-14 03:55:32,987 - calling_service - INFO - â±ï¸ [03:55:32.987] ğŸ’¬ LLM REQUEST START: 9 conversation turns, 10614 system chars (KB cached)
2025-12-14T03:55:32.991791624Z [err]  2025-12-14 03:55:32,987 - calling_service - INFO - ğŸ“ â•â•â•â•â•â•â•â•â•â•â• LLM PROMPT BREAKDOWN â•â•â•â•â•â•â•â•â•â•â•
2025-12-14T03:55:32.991800338Z [err]  2025-12-14 03:55:32,987 - calling_service - INFO - ğŸ“ [SYSTEM MSG 1 - GLOBAL PROMPT] (5025 chars):
2025-12-14T03:55:32.991809021Z [err]  2025-12-14 03:55:32,987 - calling_service - INFO - ğŸ“   Preview: # Global Prompt: Direct Drive Engine (V4.2 - Acknowledging & Fluid)
2025-12-14T03:55:32.991817900Z [err]  
2025-12-14T03:55:32.991826358Z [err]  When user states income, convert/update as [yearly_income] variable for logic splits.
2025-12-14T03:55:32.991833210Z [err]  
2025-12-14T03:55:32.991838802Z [err]  If user says a name, don't assume it's theirsâ€”wait for explicit correction.
2025-12-14T03:55:32.991844409Z [err]  
2025-12-14T03:55:32.991850147Z [err]  If user asks to repeat info, rephrase naturallyâ€”never exact repeat.
2025-12-14T03:55:32.991855733Z [err]  
2025-12-14T03:55:32.991861184Z [err]  If asked your state: "Atlanta, GA. Been in Midtown 10 years."
2025-12-14T03:55:32.991866493Z [err]  
2025-12-14T03:55:32.991871876Z [err]  If asked about call number: "Company number."
2025-12-14T03:55:32.991877278Z [err]  
2025-12-14T03:55:32.991882427Z [err]  User email: {customer_email} (for them: {{customer_email}}).
2025-12-14T03:55:32.991887693Z [err]  
2025-12-14T03:55:32.991894180Z [err]  If explaining ends in peri...
2025-12-14T03:55:32.991900075Z [err]  2025-12-14 03:55:32,987 - calling_service - INFO - ğŸ“ [SYSTEM MSG 2 - DYNAMIC CONTEXT] (5589 chars):
2025-12-14T03:55:32.992619948Z [err]  
2025-12-14T03:55:32.992622894Z [err]  2025-12-14 03:55:32,987 - calling_service - INFO - ğŸ“   Preview: 
2025-12-14T03:55:32.992628184Z [err]  USER COMMUNICATION STYLE: S type - adjust your response accordingly
2025-12-14T03:55:32.992632591Z [err]  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-14T03:55:32.992632653Z [err]  
2025-12-14T03:55:32.992636720Z [err]  CONVERSATION STATUS: Turn 5, objection handling phase
2025-12-14T03:55:32.992639719Z [err]  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-14T03:55:32.992643971Z [err]  
2025-12-14T03:55:32.992646328Z [err]  PREPROCESSED CONTEXT (to help you prioritize and focus):
2025-12-14T03:55:32.992647191Z [err]  
2025-12-14T03:55:32.992653972Z [err]  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-14T03:55:32.992656132Z [err]  # CURRENT CONTEXT
2025-12-14T03:55:32.992656833Z [err]  This context is provided to help you focus. You still need to:
2025-12-14T03:55:32.992660616Z [err]  
2025-12-14T03:55:32.992665943Z [err]  1. Generate a natural, contextual response
2025-12-14T03:55:32.992667208Z [err]  Customer: Kendrick
2025-12-14T03:55:32.992671578Z [err]  2. Evaluate transitions per your node instructions
2025-12-14T03:55:32.992676134Z [err]  Variables: {"now": "Saturday, December 13, 2025 at 10:55 PM EST", "customer_name": "Kendrick", "callerName": "", "lead_id": null, "qc_tracking_enabled": false, "track_keywords": "", "expected_commitment...
2025-12-14T03:55:32.992950447Z [err]  2025-12-14 03:55:32,987 - calling_service - INFO - ğŸ“ [CONVERSATION HISTORY] (9 messages)
2025-12-14T03:55:32.992956024Z [err]  2025-12-14 03:55:32,987 - calling_service - INFO - ğŸ“   assistant: Okay, in a nutshell, we set up passive income websites, and we let them produce income for you. What...
2025-12-14T03:55:32.992960050Z [err]  2025-12-14 03:55:32,987 - calling_service - INFO - ğŸ“   user: It's like a marketing system or som eth ing like that....
2025-12-14T03:55:32.992964833Z [err]  2025-12-14 03:55:32,987 - calling_service - INFO - ğŸ“ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-14T03:55:33.320770417Z [err]  2025-12-14 03:55:33,316 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-14T03:55:33.614058772Z [err]  2025-12-14 03:55:33,565 - server - INFO - â±ï¸ [TIMING] TTFS (Time To First Sentence): 687ms
2025-12-14T03:55:33.614060241Z [err]  2025-12-14 03:55:33,565 - server - INFO - ğŸš€ Streaming sentence #1 via persistent WebSocket
2025-12-14T03:55:33.614064903Z [err]  2025-12-14 03:55:33,559 - calling_service - INFO - â±ï¸ [03:55:33.559] ğŸ’¬ LLM FIRST TOKEN: 571ms (grok grok-4-fast-non-reasoning)
2025-12-14T03:55:33.614068385Z [err]  2025-12-14 03:55:33,565 - server - INFO - âš¡ Starting REAL-TIME TTS for first sentence
2025-12-14T03:55:33.614071322Z [err]  2025-12-14 03:55:33,565 - server - INFO - ğŸµ TTS task #1 started at +0ms
2025-12-14T03:55:33.614071945Z [err]  2025-12-14 03:55:33,565 - server - INFO - ğŸ“¤ Sentence arrived from LLM: Yeah,...
2025-12-14T03:55:33.614079892Z [err]  2025-12-14 03:55:33,565 - calling_service - INFO - ğŸ“¤ Streamed sentence: Yeah,...
2025-12-14T03:55:33.614081804Z [err]  2025-12-14 03:55:33,565 - server - INFO - â±ï¸ [TIMING] TTFT_TTS (First TTS Task Started): 687ms
2025-12-14T03:55:33.614083764Z [err]  2025-12-14 03:55:33,565 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:9-aI5uotEAyA2Cmnd..., session=FOUND
2025-12-14T03:55:33.614086508Z [err]  2025-12-14 03:55:33,566 - server - INFO - ğŸ“¤ Sentence arrived from LLM: exactly....
2025-12-14T03:55:33.614090855Z [err]  2025-12-14 03:55:33,566 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:9-aI5uotEAyA2Cmnd..., session=FOUND
2025-12-14T03:55:33.614094821Z [err]  2025-12-14 03:55:33,566 - server - INFO - ğŸš€ Streaming sentence #2 via persistent WebSocket
2025-12-14T03:55:33.614170695Z [err]  2025-12-14 03:55:33,566 - server - INFO - ğŸµ TTS task #2 started at +0ms
2025-12-14T03:55:33.614176131Z [err]  2025-12-14 03:55:33,566 - calling_service - INFO - ğŸ“¤ Streamed sentence: exactly....
2025-12-14T03:55:33.614180336Z [err]  2025-12-14 03:55:33,566 - persistent_tts_service - INFO - ğŸ¤ [Call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA] Streaming sentence #8: Yeah,...
2025-12-14T03:55:33.651761407Z [err]  2025-12-14 03:55:33,645 - server - INFO - ğŸ“¤ Sentence arrived from LLM: It's a lead generation system where you build a si...
2025-12-14T03:55:33.651771653Z [err]  2025-12-14 03:55:33,646 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:9-aI5uotEAyA2Cmnd..., session=FOUND
2025-12-14T03:55:33.651778976Z [err]  2025-12-14 03:55:33,646 - server - INFO - ğŸš€ Streaming sentence #3 via persistent WebSocket
2025-12-14T03:55:33.651785510Z [err]  2025-12-14 03:55:33,646 - server - INFO - ğŸµ TTS task #3 started at +80ms
2025-12-14T03:55:33.651792232Z [err]  2025-12-14 03:55:33,646 - calling_service - INFO - ğŸ“¤ Streamed sentence: It's a lead generation system where you build a si...
2025-12-14T03:55:33.671602800Z [err]  2025-12-14 03:55:33,667 - server - INFO - ğŸ“¤ Sentence arrived from LLM: pulls in leads for local businesses,...
2025-12-14T03:55:33.671608530Z [err]  2025-12-14 03:55:33,667 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:9-aI5uotEAyA2Cmnd..., session=FOUND
2025-12-14T03:55:33.671612588Z [err]  2025-12-14 03:55:33,667 - server - INFO - ğŸš€ Streaming sentence #4 via persistent WebSocket
2025-12-14T03:55:33.671617011Z [err]  2025-12-14 03:55:33,667 - server - INFO - ğŸµ TTS task #4 started at +101ms
2025-12-14T03:55:33.671620880Z [err]  2025-12-14 03:55:33,667 - calling_service - INFO - ğŸ“¤ Streamed sentence: pulls in leads for local businesses,...
2025-12-14T03:55:33.720320690Z [err]  2025-12-14 03:55:33,719 - server - INFO - ğŸ“¤ Sentence arrived from LLM: and you get paid monthly to manage it for them....
2025-12-14T03:55:33.720325784Z [err]  2025-12-14 03:55:33,719 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:9-aI5uotEAyA2Cmnd..., session=FOUND
2025-12-14T03:55:33.720330488Z [err]  2025-12-14 03:55:33,719 - server - INFO - ğŸš€ Streaming sentence #5 via persistent WebSocket
2025-12-14T03:55:33.720334283Z [err]  2025-12-14 03:55:33,719 - server - INFO - ğŸµ TTS task #5 started at +153ms
2025-12-14T03:55:33.720338380Z [err]  2025-12-14 03:55:33,719 - calling_service - INFO - ğŸ“¤ Streamed sentence: and you get paid monthly to manage it for them....
2025-12-14T03:55:33.804864158Z [err]  2025-12-14 03:55:33,800 - server - INFO - ğŸ“¤ Sentence arrived from LLM: Does that sound like something that could fit into...
2025-12-14T03:55:33.804869884Z [err]  2025-12-14 03:55:33,800 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:9-aI5uotEAyA2Cmnd..., session=FOUND
2025-12-14T03:55:33.804875546Z [err]  2025-12-14 03:55:33,800 - server - INFO - ğŸš€ Streaming sentence #6 via persistent WebSocket
2025-12-14T03:55:33.804880856Z [err]  2025-12-14 03:55:33,800 - server - INFO - ğŸµ TTS task #6 started at +235ms
2025-12-14T03:55:33.804886729Z [err]  2025-12-14 03:55:33,800 - calling_service - INFO - ğŸ“¤ Streamed final fragment: Does that sound like something that could fit into...
2025-12-14T03:55:33.804892151Z [err]  2025-12-14 03:55:33,800 - calling_service - INFO - â±ï¸ [TIMING] LLM_TOTAL: 812ms for 250 chars (grok grok-4-fast-non-reasoning)
2025-12-14T03:55:33.804899278Z [err]  2025-12-14 03:55:33,800 - calling_service - INFO - ğŸ”Š Silence tracking reset for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA (user responded)
2025-12-14T03:55:33.804909063Z [err]  2025-12-14 03:55:33,800 - calling_service - INFO - âœ… User responded to regular message, resetting counter
2025-12-14T03:55:33.804917120Z [err]  2025-12-14 03:55:33,800 - calling_service - INFO - ğŸ’¾ Storing node ID 1763206946898 in conversation history
2025-12-14T03:55:33.804925162Z [err]  2025-12-14 03:55:33,800 - calling_service - INFO - LLM response (0.83s): Yeah, exactly. It's a lead generation system where you build a simple website that ranks on Google, pulls in leads for local businesses, and you get paid monthly to manage it for them. Does that sound like something that could fit into your schedule?
2025-12-14T03:55:33.804932318Z [err]  2025-12-14 03:55:33,800 - calling_service - INFO - Total latency: 0.83s
2025-12-14T03:55:33.804938175Z [err]  2025-12-14 03:55:33,800 - server - INFO - âœ… LLM finished in 923ms, TTS tasks already running in background
2025-12-14T03:55:33.805265613Z [err]  2025-12-14 03:55:33,801 - server - INFO - ğŸµ Streaming 6 TTS chunks as they complete...
2025-12-14T03:55:33.805271316Z [err]  2025-12-14 03:55:33,801 - server - INFO - ğŸš€ Persistent TTS: Audio already streaming in background!
2025-12-14T03:55:33.805276525Z [err]  2025-12-14 03:55:33,801 - server - INFO -    6 sentences queued and playing seamlessly
2025-12-14T03:55:33.823315283Z [err]  2025-12-14 03:55:33,819 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTS_START: Sent to ElevenLabs at T+0ms
2025-12-14T03:55:33.823323878Z [err]  2025-12-14 03:55:33,819 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTS_TTFB: First audio chunk at T+253ms
2025-12-14T03:55:33.823330522Z [err]  2025-12-14 03:55:33,819 - persistent_tts_service - INFO - ğŸ“¤ Sending 3715 bytes of audio (24 chunks, 0.5s duration) via WebSocket
2025-12-14T03:55:33.823336979Z [err]  2025-12-14 03:55:33,819 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-14T03:55:33.823343868Z [err]  2025-12-14 03:55:33,819 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +0.5s (total: 0.5s from now)
2025-12-14T03:55:33.823349512Z [err]  2025-12-14 03:55:33,819 - persistent_tts_service - INFO - âœ… Sent 24 audio chunks via WebSocket
2025-12-14T03:55:34.320674254Z [err]  2025-12-14 03:55:34,319 - persistent_tts_service - INFO - ğŸ”‡ [Call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA] FLOOR RELEASED (is_holding_floor=False)
2025-12-14T03:55:34.320679666Z [err]  2025-12-14 03:55:34,320 - persistent_tts_service - INFO - ğŸ¤ [Call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA] Streaming sentence #9: exactly....
2025-12-14T03:55:34.368459695Z [err]  2025-12-14 03:55:34,367 - dead_air_monitor - INFO - â±ï¸ Playback expected end time passed (0.1s ago), marking agent as done speaking
2025-12-14T03:55:34.368465745Z [err]  2025-12-14 03:55:34,368 - calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1765684534.3680494 for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:34.368471427Z [err]  2025-12-14 03:55:34,368 - calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:34.610916659Z [err]  2025-12-14 03:55:34,539 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTS_START: Sent to ElevenLabs at T+0ms
2025-12-14T03:55:34.610920331Z [err]  2025-12-14 03:55:34,539 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTS_TTFB: First audio chunk at T+220ms
2025-12-14T03:55:34.610924213Z [err]  2025-12-14 03:55:34,539 - persistent_tts_service - INFO - ğŸ“¤ Sending 5573 bytes of audio (35 chunks, 0.7s duration) via WebSocket
2025-12-14T03:55:34.610928126Z [err]  2025-12-14 03:55:34,540 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-14T03:55:34.610932419Z [err]  2025-12-14 03:55:34,540 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +0.7s (total: 0.7s from now)
2025-12-14T03:55:34.610936046Z [err]  2025-12-14 03:55:34,540 - persistent_tts_service - INFO - âœ… Sent 35 audio chunks via WebSocket
2025-12-14T03:55:35.040060492Z [err]  2025-12-14 03:55:35,039 - persistent_tts_service - INFO - ğŸ¤ [Call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA] Streaming sentence #10: It's a lead generation system where you build a si...
2025-12-14T03:55:35.340762408Z [err]  2025-12-14 03:55:35,330 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTS_START: Sent to ElevenLabs at T+0ms
2025-12-14T03:55:35.340770981Z [err]  2025-12-14 03:55:35,330 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTS_TTFB: First audio chunk at T+291ms
2025-12-14T03:55:35.340778352Z [err]  2025-12-14 03:55:35,331 - persistent_tts_service - INFO - ğŸ“¤ Sending 12632 bytes of audio (79 chunks, 1.6s duration) via WebSocket
2025-12-14T03:55:35.340785282Z [err]  2025-12-14 03:55:35,331 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-14T03:55:35.340792381Z [err]  2025-12-14 03:55:35,331 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +1.6s (total: 1.6s from now)
2025-12-14T03:55:35.340797447Z [err]  2025-12-14 03:55:35,332 - persistent_tts_service - INFO - âœ… Sent 79 audio chunks via WebSocket
2025-12-14T03:55:35.383755715Z [err]  2025-12-14 03:55:35,379 - dead_air_monitor - INFO - ğŸ”‡ MONITOR: Skipping silence check - audio playing (1.5s left)
2025-12-14T03:55:35.612206548Z [err]  2025-12-14 03:55:35,526 - persistent_tts_service - INFO - âœ… Sent 163 audio chunks via WebSocket
2025-12-14T03:55:35.612213983Z [err]  2025-12-14 03:55:35,524 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-14T03:55:35.612223574Z [err]  2025-12-14 03:55:35,525 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +3.3s (total: 4.6s from now)
2025-12-14T03:55:35.612237415Z [err]  2025-12-14 03:55:35,524 - persistent_tts_service - INFO - ğŸ“¤ Sending 26006 bytes of audio (163 chunks, 3.3s duration) via WebSocket
2025-12-14T03:55:35.890813443Z [err]  2025-12-14 03:55:35,885 - dead_air_monitor - INFO - ğŸ”‡ MONITOR: Skipping silence check - audio playing (4.3s left)
2025-12-14T03:55:36.034858282Z [err]  2025-12-14 03:55:36,024 - persistent_tts_service - INFO - ğŸ¤ [Call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA] Streaming sentence #11: pulls in leads for local businesses,...
2025-12-14T03:55:36.329559615Z [err]  2025-12-14 03:55:36,321 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTS_START: Sent to ElevenLabs at T+0ms
2025-12-14T03:55:36.329566345Z [err]  2025-12-14 03:55:36,321 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTS_TTFB: First audio chunk at T+297ms
2025-12-14T03:55:36.329570858Z [err]  2025-12-14 03:55:36,321 - persistent_tts_service - INFO - ğŸ“¤ Sending 17461 bytes of audio (110 chunks, 2.2s duration) via WebSocket
2025-12-14T03:55:36.329575095Z [err]  2025-12-14 03:55:36,321 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-14T03:55:36.329579067Z [err]  2025-12-14 03:55:36,321 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +2.2s (total: 6.0s from now)
2025-12-14T03:55:36.329583924Z [err]  2025-12-14 03:55:36,323 - persistent_tts_service - INFO - âœ… Sent 110 audio chunks via WebSocket
2025-12-14T03:55:36.828171335Z [err]  2025-12-14 03:55:36,822 - persistent_tts_service - INFO - ğŸ¤ [Call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA] Streaming sentence #12: and you get paid monthly to manage it for them....
2025-12-14T03:55:36.956136789Z [err]  2025-12-14 03:55:36,955 - server - INFO - ğŸ“¤ Audio flowing: 3148 packets sent to Soniox (5s update)
2025-12-14T03:55:37.132341250Z [err]  2025-12-14 03:55:37,116 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTS_START: Sent to ElevenLabs at T+0ms
2025-12-14T03:55:37.132345388Z [err]  2025-12-14 03:55:37,116 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTS_TTFB: First audio chunk at T+293ms
2025-12-14T03:55:37.132350993Z [err]  2025-12-14 03:55:37,116 - persistent_tts_service - INFO - ğŸ“¤ Sending 18576 bytes of audio (117 chunks, 2.3s duration) via WebSocket
2025-12-14T03:55:37.132357414Z [err]  2025-12-14 03:55:37,116 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-14T03:55:37.132363582Z [err]  2025-12-14 03:55:37,116 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +2.3s (total: 7.5s from now)
2025-12-14T03:55:37.132370199Z [err]  2025-12-14 03:55:37,117 - persistent_tts_service - INFO - âœ… Sent 117 audio chunks via WebSocket
2025-12-14T03:55:37.619418412Z [err]  2025-12-14 03:55:37,616 - persistent_tts_service - INFO - ğŸ¤ [Call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA] Streaming sentence #13: Does that sound like something that could fit into...
2025-12-14T03:55:37.896790817Z [err]  2025-12-14 03:55:37,894 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTS_START: Sent to ElevenLabs at T+0ms
2025-12-14T03:55:37.896794418Z [err]  2025-12-14 03:55:37,894 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTS_TTFB: First audio chunk at T+278ms
2025-12-14T03:55:37.896798689Z [err]  2025-12-14 03:55:37,894 - persistent_tts_service - INFO - ğŸ“¤ Sending 6688 bytes of audio (42 chunks, 0.8s duration) via WebSocket
2025-12-14T03:55:37.896803380Z [err]  2025-12-14 03:55:37,894 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-14T03:55:37.896807158Z [err]  2025-12-14 03:55:37,894 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +0.8s (total: 7.6s from now)
2025-12-14T03:55:37.896811217Z [err]  2025-12-14 03:55:37,895 - persistent_tts_service - INFO - âœ… Sent 42 audio chunks via WebSocket
2025-12-14T03:55:38.059685194Z [err]  2025-12-14 03:55:38,058 - persistent_tts_service - INFO - ğŸ“¤ Sending 15232 bytes of audio (96 chunks, 1.9s duration) via WebSocket
2025-12-14T03:55:38.059691193Z [err]  2025-12-14 03:55:38,058 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-14T03:55:38.059697203Z [err]  2025-12-14 03:55:38,058 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +1.9s (total: 9.3s from now)
2025-12-14T03:55:38.064100059Z [err]  2025-12-14 03:55:38,060 - persistent_tts_service - INFO - âœ… Sent 96 audio chunks via WebSocket
2025-12-14T03:55:38.640213878Z [err]  2025-12-14 03:55:38,558 - server - INFO - â±ï¸  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-14T03:55:38.640221630Z [err]  2025-12-14 03:55:38,559 - server - INFO - â±ï¸  [TIMING]   - REAL USER LATENCY: 5980ms estimated
2025-12-14T03:55:38.640230790Z [err]  2025-12-14 03:55:38,559 - server - INFO - â±ï¸  [TIMING] RESPONSE_TEXT: 250 chars, 6 sentences
2025-12-14T03:55:38.640235532Z [err]  2025-12-14 03:55:38,559 - server - INFO - â±ï¸  [TIMING] USER_INPUT: 'It's like a marketing system or som eth ing like that....'
2025-12-14T03:55:38.640239634Z [err]  2025-12-14 03:55:38,559 - server - INFO - â±ï¸  [TIMING] AI_RESPONSE: 'Yeah, exactly. It's a lead generation system where you build...'
2025-12-14T03:55:38.640243525Z [err]  2025-12-14 03:55:38,559 - server - INFO - â±ï¸  [TIMING] ==========================
2025-12-14T03:55:38.640247417Z [err]  2025-12-14 03:55:38,559 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-14T03:55:38.640369152Z [err]  2025-12-14 03:55:38,558 - server - INFO - âœ… All 6 persistent TTS streams completed
2025-12-14T03:55:38.640373302Z [err]  2025-12-14 03:55:38,558 - server - INFO - âœ… Agent generation complete (persistent TTS) - response window closed
2025-12-14T03:55:38.640376997Z [err]  2025-12-14 03:55:38,558 - server - INFO - â±ï¸  FIRST AUDIO STARTED: 5680ms from user stop ğŸš€
2025-12-14T03:55:38.640380632Z [err]  2025-12-14 03:55:38,558 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:38.640384271Z [err]  2025-12-14 03:55:38,558 - server - INFO - âœ… Agent generation complete - response window closed
2025-12-14T03:55:38.640388104Z [err]  2025-12-14 03:55:38,558 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-14T03:55:38.640391800Z [err]  2025-12-14 03:55:38,558 - server - INFO - â±ï¸  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-14T03:55:38.640395954Z [err]  2025-12-14 03:55:38,558 - server - INFO - â±ï¸  [TIMING] STT: 2ms (provider: soniox, model: stt-rt-v3)
2025-12-14T03:55:38.640399594Z [err]  2025-12-14 03:55:38,558 - server - INFO - â±ï¸  [TIMING] LLM_TOTAL: 923ms (provider: grok, model: grok-4-fast-non-reasoning)
2025-12-14T03:55:38.640405248Z [err]  2025-12-14 03:55:38,558 - server - INFO - â±ï¸  [TIMING] TTS_TOTAL: 4993ms (provider: elevenlabs, websocket: False)
2025-12-14T03:55:38.640408921Z [err]  2025-12-14 03:55:38,558 - server - INFO - â±ï¸  [TIMING] E2E_TOTAL: 5680ms (user stopped â†’ play_audio_url called)
2025-12-14T03:55:38.640412630Z [err]  2025-12-14 03:55:38,558 - server - INFO - â±ï¸  [TIMING] âš ï¸ NOTE: E2E_TOTAL does not include:
2025-12-14T03:55:38.640416176Z [err]  2025-12-14 03:55:38,558 - server - INFO - â±ï¸  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-14T03:55:38.640431096Z [err]  2025-12-14 03:55:38,558 - server - INFO - â±ï¸  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-14T03:55:38.640434764Z [err]  2025-12-14 03:55:38,558 - server - INFO - â±ï¸  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-14T03:55:38.747957206Z [err]  2025-12-14 03:55:38,741 - server - INFO - ğŸ“ Saved assistant transcript and latency to database (Node: N_KB_Q&A_With_StrategicNarrative_V3_Adaptive, Dead Air: 1425ms)
2025-12-14T03:55:38.747962664Z [err]  2025-12-14 03:55:38,741 - server - INFO - ğŸ”Š Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-14T03:55:39.792382683Z [err]  2025-12-14 03:55:39,787 - server - INFO - ğŸ“ Telnyx WebSocket disconnected. Sent 3278 total packets
2025-12-14T03:55:39.792388069Z [err]  [2025-12-14 03:55:39 +0000] [6] [INFO] connection closed
2025-12-14T03:55:39.982540020Z [err]  2025-12-14 03:55:39,979 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T03:55:39.982545563Z [err]  2025-12-14 03:55:39,979 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.hangup', 'id': '8ff5c7ae-a14c-4d37-88fe-d5688a0fee92', 'occurred_at': '2025-12-14T03:55:39.489295Z', 'payload': {'call_control_id': 'v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA', 'call_leg_id': '978aab6c-d8a0-11f0-bab2-02420aef9420', 'call_quality_stats': {'inbound': {'jitter_max_variance': '40.05', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '3304', 'skip_packet_count': '13'}, 'outbound': {'packet_count': '3279', 'skip_packet_count': '0'}}, 'call_session_id': '978751c4-d8a0-11f0-9c22-02420aef9420', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-14T03:55:39.489295Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-14T03:54:29.889302Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T03:55:39.982549610Z [err]  2025-12-14 03:55:39,979 - server - INFO - ğŸ¯ Event type: call.hangup, Call ID: v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:39.982553565Z [err]  2025-12-14 03:55:39,979 - server - INFO - ğŸ“¨ ================================================
2025-12-14T03:55:39.982557302Z [err]  2025-12-14 03:55:39,979 - server - INFO - ğŸ“ Call ended: v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:39.982561371Z [err]  2025-12-14 03:55:39,979 - server - INFO - ğŸ“ Hangup cause: normal_clearing
2025-12-14T03:55:40.042195771Z [err]  2025-12-14 03:55:40,040 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T03:55:40.042205304Z [err]  2025-12-14 03:55:40,040 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '57195d08-70dd-4ecc-9cf0-0b2998538197', 'occurred_at': '2025-12-14T03:55:39.529296Z', 'payload': {'call_control_id': 'v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA', 'call_leg_id': '978aab6c-d8a0-11f0-bab2-02420aef9420', 'call_session_id': '978751c4-d8a0-11f0-9c22-02420aef9420', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-14T03:55:39.529296Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'XT4kBGVx8g', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T03:55:40.042212906Z [err]  2025-12-14 03:55:40,040 - server - INFO - ğŸ¯ Event type: call.playback.ended, Call ID: v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:40.042217009Z [err]  2025-12-14 03:55:40,040 - server - INFO - ğŸ“¨ ================================================
2025-12-14T03:55:40.052509300Z [err]  2025-12-14 03:55:40,050 - redis_service - INFO - â– Removed playback XT4kBGVx8g, 0 remaining for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:40.052513965Z [err]  2025-12-14 03:55:40,050 - server - INFO - ğŸ”Š Redis: Removed playback XT4kBGVx8g, 0 remaining
2025-12-14T03:55:40.052518109Z [err]  2025-12-14 03:55:40,050 - server - INFO - ğŸ”Š ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-14T03:55:40.052522090Z [err]  2025-12-14 03:55:40,050 - server - INFO - â±ï¸ CLEARED playback_expected_end_time - agent is definitely done speaking
2025-12-14T03:55:40.057617962Z [err]  2025-12-14 03:55:40,053 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T03:55:40.057623289Z [err]  2025-12-14 03:55:40,053 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'streaming.stopped', 'id': '506aa6df-440e-4d85-a60f-e5725b4dfc05', 'occurred_at': '2025-12-14T03:55:39.716382Z', 'payload': {'call_control_id': 'v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA', 'call_leg_id': '978aab6c-d8a0-11f0-bab2-02420aef9420', 'call_session_id': '978751c4-d8a0-11f0-9c22-02420aef9420', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '1c9f2f80-ab2f-439a-903c-37d8ad6aa288', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T03:55:40.057627408Z [err]  2025-12-14 03:55:40,053 - server - INFO - ğŸ¯ Event type: streaming.stopped, Call ID: v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:40.057632681Z [err]  2025-12-14 03:55:40,053 - server - INFO - ğŸ“¨ ================================================
2025-12-14T03:55:40.057636199Z [inf]  100.64.0.9:52294 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T03:55:40.057639809Z [err]  2025-12-14 03:55:40,055 - server - INFO - âœ… Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-14T03:55:40.057644021Z [err]  2025-12-14 03:55:40,055 - server - INFO - âœ… Found session locally: agent_speaking=True, user_speaking=False
2025-12-14T03:55:40.057647897Z [err]  2025-12-14 03:55:40,055 - calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1765684540.0558 for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:40.057651870Z [err]  2025-12-14 03:55:40,055 - calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:40.058073263Z [err]  2025-12-14 03:55:40,055 - server - INFO - â±ï¸ Agent done speaking, silence timer STARTED (local)
2025-12-14T03:55:40.058080327Z [inf]  100.64.0.8:20016 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T03:55:40.450095104Z [err]  2025-12-14 03:55:40,449 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=0.4s, checkin_count=0/2
2025-12-14T03:55:40.663091591Z [err]  2025-12-14 03:55:40,538 - persistent_tts_service - INFO - ğŸ”‡ [Call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA] FLOOR RELEASED (is_holding_floor=False)
2025-12-14T03:55:40.951557546Z [err]  2025-12-14 03:55:40,946 - server - INFO - ğŸ“ Updated call log: v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:40.962029437Z [err]  2025-12-14 03:55:40,956 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=0.9s, checkin_count=0/2
2025-12-14T03:55:41.039257962Z [err]  2025-12-14 03:55:41,037 - server - INFO - âœ… Finalized call log: v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA (duration=67s, status=completed)
2025-12-14T03:55:41.435317948Z [err]  2025-12-14 03:55:41,416 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T03:55:41.435325729Z [err]  2025-12-14 03:55:41,416 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '53363789-fb84-4fd6-a260-03f20294fb60', 'occurred_at': '2025-12-14T03:55:41.166418Z', 'payload': {'call_control_id': 'v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA', 'call_leg_id': '978aab6c-d8a0-11f0-bab2-02420aef9420', 'call_session_id': '978751c4-d8a0-11f0-9c22-02420aef9420', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-14T03:55:39.590112Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-14T03:55:39.590112Z', 'recording_id': '1c259b94-f68f-4b4a-a09e-b63a384934d1', 'recording_started_at': '2025-12-14T03:54:35.397974Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-14/978aab6c-d8a0-11f0-bab2-02420aef9420-1765684474485070.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251214%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251214T035541Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=6374c2433603b9dbfb82902ce12b37ce39632b45188cd1921dbd80b228fb3618'}, 'start_time': '2025-12-14T03:54:35.397974Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T03:55:41.435331810Z [err]  2025-12-14 03:55:41,416 - server - INFO - ğŸ¯ Event type: call.recording.saved, Call ID: v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:41.435337207Z [err]  2025-12-14 03:55:41,416 - server - INFO - ğŸ“¨ ================================================
2025-12-14T03:55:41.435367163Z [err]  2025-12-14 03:55:41,427 - server - INFO - ğŸ” Recording check: download_url=True, channels=dual, recording_id=1c259b94-f68f-4b4a-a09e-b63a384934d1, call_data=True
2025-12-14T03:55:41.435440296Z [err]  2025-12-14 03:55:41,416 - server - INFO - ğŸ™ï¸ Recording saved for call: v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:41.435444194Z [err]  2025-12-14 03:55:41,427 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:41.697691472Z [err]  2025-12-14 03:55:41,657 - server - INFO - ğŸ“Š Auto-added call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-14T03:55:41.859647162Z [err]  2025-12-14 03:55:41,843 - server - INFO - ğŸ“‡ [HANGUP] Data source: redis=Yes, memory=No
2025-12-14T03:55:41.859653449Z [err]  2025-12-14 03:55:41,843 - server - INFO - ğŸ“‡ [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-14T03:55:41.859717516Z [err]  2025-12-14 03:55:41,843 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:41.935706803Z [err]  2025-12-14 03:55:41,932 - server - INFO - ğŸ“‡ [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-14T03:55:41.984400133Z [err]  2025-12-14 03:55:41,981 - server - INFO - ğŸ’¾ Saved recording URL and ID to database: 1c259b94-f68f-4b4a-a09e-b63a384934d1
2025-12-14T03:55:41.984407346Z [err]  2025-12-14 03:55:41,982 - server - INFO - âœ… Entering dual-channel processing
2025-12-14T03:55:41.984414107Z [err]  2025-12-14 03:55:41,982 - server - INFO - ğŸ“¥ Downloading DUAL-CHANNEL recording...
2025-12-14T03:55:42.023463280Z [err]  2025-12-14 03:55:42,020 - server - INFO - ğŸ“Š Triggered Campaign QC for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:42.023475483Z [err]  2025-12-14 03:55:42,020 - server - INFO - ğŸ“‡ Triggered CRM update for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:42.023482809Z [err]  2025-12-14 03:55:42,020 - server - INFO - âœ… Closed persistent TTS session for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:42.023523681Z [err]  2025-12-14 03:55:42,020 - server - INFO - ğŸ“‡ [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-14T03:55:42.023529734Z [err]  2025-12-14 03:55:42,020 - server - INFO - ğŸ“‡ [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-14T03:55:42.023535535Z [err]  2025-12-14 03:55:42,020 - server - INFO - ğŸ“‡ [HANGUP] Agent info keys: None
2025-12-14T03:55:42.023540946Z [err]  2025-12-14 03:55:42,020 - server - INFO - ğŸš€ Triggered QC analysis for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:42.027260040Z [err]  2025-12-14 03:55:42,026 - redis_service - INFO - ğŸ§¹ Deleted call data from Redis: v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:42.027266647Z [err]  2025-12-14 03:55:42,026 - server - INFO - ğŸ§¹ Cleaned up call session from Redis and memory: v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:42.027272210Z [inf]  100.64.0.7:18338 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T03:55:42.027276422Z [err]  2025-12-14 03:55:42,026 - server - INFO - ğŸ” Starting QC analysis for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:42.027280484Z [err]  2025-12-14 03:55:42,026 - server - INFO - ğŸ” [AUTO-QC] Starting campaign QC check for call=v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-14T03:55:42.027285128Z [err]  2025-12-14 03:55:42,026 - server - INFO - ğŸ“‡ CRM update starting for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T03:55:42.027288973Z [err]  2025-12-14 03:55:42,026 - server - INFO - ğŸ“‡ Normalized phone: +17708336397
2025-12-14T03:55:42.165807559Z [err]  2025-12-14 03:55:42,114 - server - INFO - ğŸ” [AUTO-QC] Call log found: transcript_turns=10, logs_count=12, status=completed
2025-12-14T03:55:42.165811420Z [err]  2025-12-14 03:55:42,115 - server - INFO - ğŸ“ Converted transcript from 10 messages to 951 characters
2025-12-14T03:55:42.238984115Z [err]  2025-12-14 03:55:42,214 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T03:55:42.238991944Z [err]  2025-12-14 03:55:42,217 - server - INFO - ğŸ” [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-14T03:55:42.310920793Z [err]  2025-12-14 03:55:42,286 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-14/978aab6c-d8a0-11f0-bab2-02420aef9420-1765684474485070.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251214%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251214T035541Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=6374c2433603b9dbfb82902ce12b37ce39632b45188cd1921dbd80b228fb3618 "HTTP/1.1 200 OK"
2025-12-14T03:55:42.310930007Z [err]  2025-12-14 03:55:42,302 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-14T03:55:42.310936627Z [err]  2025-12-14 03:55:42,305 - server - INFO - ğŸ“Š [AUTO-QC] Running full QC analysis: call=v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA â†’ campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-14T03:55:42.310948005Z [err]  2025-12-14 03:55:42,305 - server - INFO - ğŸ“Š [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-14T03:55:42.310953805Z [err]  2025-12-14 03:55:42,305 - server - ERROR - âŒ [AUTO-QC] Error in campaign QC for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-14T03:55:42.310959784Z [err]  2025-12-14 03:55:42,306 - server - ERROR - âŒ [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-14T03:55:42.310965875Z [err]    File "/app/backend/server.py", line 9475, in trigger_campaign_qc_for_call
2025-12-14T03:55:42.310974197Z [err]      await run_full_qc_analysis(
2025-12-14T03:55:42.310978533Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-14T03:55:42.310982990Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-14T03:55:42.310987312Z [err]  
2025-12-14T03:55:42.391615762Z [err]  2025-12-14 03:55:42,389 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-14T03:55:42.391625093Z [err]  2025-12-14 03:55:42,389 - qc_agents.orchestrator - INFO - âœ… Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T03:55:42.391632229Z [err]  2025-12-14 03:55:42,389 - qc_agents.orchestrator - INFO - ğŸ” Running Commitment Detector on call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:42.546602366Z [err]  2025-12-14 03:55:42,544 - server - INFO - âœ… Downloaded 257087 bytes
2025-12-14T03:55:42.725155877Z [err]  2025-12-14 03:55:42,720 - server - INFO - âœ… Split into 2 channels
2025-12-14T03:55:42.725167264Z [err]  2025-12-14 03:55:42,721 - server - INFO - ğŸ¤ Using STT provider: soniox for interruption detection
2025-12-14T03:55:42.725175607Z [err]  2025-12-14 03:55:42,721 - server - INFO - ğŸ“Š Channel 0: 1412490 bytes
2025-12-14T03:55:42.725182107Z [err]  2025-12-14 03:55:42,721 - server - ERROR - âŒ No Soniox API key available
2025-12-14T03:55:42.725188338Z [err]  2025-12-14 03:55:42,721 - server - INFO - âŒ Channel 0: No speech
2025-12-14T03:55:42.725195090Z [err]  2025-12-14 03:55:42,721 - server - INFO - ğŸ“Š Channel 1: 1412490 bytes
2025-12-14T03:55:42.725201376Z [err]  2025-12-14 03:55:42,721 - server - ERROR - âŒ No Soniox API key available
2025-12-14T03:55:42.725208044Z [err]  2025-12-14 03:55:42,721 - server - INFO - âŒ Channel 1: No speech
2025-12-14T03:55:42.725214837Z [err]  2025-12-14 03:55:42,721 - server - WARNING - âš ï¸ No speech in any channel
2025-12-14T03:55:42.725224357Z [inf]  100.64.0.9:52294 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T03:55:42.725232082Z [err]  2025-12-14 03:55:42,722 - server - INFO - ğŸ“‡ CRM: Total variables collected: []
2025-12-14T03:55:42.906947672Z [err]  2025-12-14 03:55:42,899 - server - INFO - ğŸ“‡ CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name']
2025-12-14T03:55:47.294108458Z [err]  2025-12-14 03:55:47,292 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-14T03:55:47.298826302Z [err]  2025-12-14 03:55:47,295 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-14T03:55:47.298835462Z [err]  2025-12-14 03:55:47,297 - qc_agents.orchestrator - INFO - ğŸ—ºï¸  Running Conversion Pathfinder on call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:47.574162584Z [err]  2025-12-14 03:55:47,532 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:47.574173866Z [err]  2025-12-14 03:55:47,532 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA: Are you still there?...
2025-12-14T03:55:47.574180419Z [err]  2025-12-14 03:55:47,532 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-14T03:55:47.574185440Z [err]  2025-12-14 03:55:47,532 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-14T03:55:47.574189910Z [err]  2025-12-14 03:55:47,532 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-14T03:55:47.574194309Z [err]  2025-12-14 03:55:47,532 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-14T03:55:47.574198757Z [err]  2025-12-14 03:55:47,532 - server - INFO - â±ï¸ [03:55:47.532] ğŸ”Š TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-14T03:55:47.574203029Z [err]  2025-12-14 03:55:47,532 - server - INFO - âš¡ Using Flash v2.5 (fastest - 75ms)
2025-12-14T03:55:47.574207286Z [err]  2025-12-14 03:55:47,532 - server - INFO - ğŸ™ï¸ ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_flash_v2_5, speed=1.1, normalization=on, ssml=False
2025-12-14T03:55:47.574254573Z [err]  2025-12-14 03:55:47,527 - calling_service - INFO - â° Check-in triggered after 7.5s silence (threshold: 7s)
2025-12-14T03:55:47.574262288Z [err]  2025-12-14 03:55:47,532 - calling_service - INFO - ğŸ’¬ Sending check-in #1/2: Are you still there?
2025-12-14T03:55:47.574270854Z [err]  2025-12-14 03:55:47,532 - dead_air_monitor - INFO - ğŸ’¬ Sending check-in after 7.5s silence: Are you still there?
2025-12-14T03:55:47.623970443Z [err]  2025-12-14 03:55:47,620 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-14T03:55:47.623978349Z [err]  2025-12-14 03:55:47,620 - server - INFO -    Full data: {'text': 'Are you still there?', 'model_id': 'eleven_flash_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': False, 'optimize_streaming_latency': 4}
2025-12-14T03:55:47.623982565Z [err]  2025-12-14 03:55:47,620 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T03:55:47.623985172Z [err]  2025-12-14 03:55:47,620 - server - INFO - ğŸ”Œ Attempting ElevenLabs connection (attempt 1/2)
2025-12-14T03:55:47.623991894Z [err]  2025-12-14 03:55:47,620 - server - INFO -    Timeout: 10.0s
2025-12-14T03:55:47.623991935Z [err]  2025-12-14 03:55:47,620 - server - INFO - ğŸ“¦ ElevenLabs Request Payload:
2025-12-14T03:55:47.623999241Z [err]  2025-12-14 03:55:47,620 - server - INFO -    Text length: 20 chars
2025-12-14T03:55:47.624005484Z [err]  2025-12-14 03:55:47,620 - server - INFO -    Text content: 'Are you still there?'
2025-12-14T03:55:47.624012444Z [err]  2025-12-14 03:55:47,620 - server - INFO -    Text bytes: b'Are you still there?'
2025-12-14T03:55:47.624019627Z [err]  2025-12-14 03:55:47,620 - server - INFO -    Model: eleven_flash_v2_5
2025-12-14T03:55:47.624026489Z [err]  2025-12-14 03:55:47,620 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-14T03:55:47.744217791Z [err]  2025-12-14 03:55:47,628 - server - INFO -    âœ“ HTTP client created (0.008s)
2025-12-14T03:55:47.744224500Z [err]  2025-12-14 03:55:47,628 - server - INFO -    â†’ Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-14T03:55:47.945956935Z [err]  2025-12-14 03:55:47,918 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-14T03:55:47.945961329Z [err]  2025-12-14 03:55:47,918 - server - INFO -    âœ“ Connection established (0.298s) [TARGET: <200ms]
2025-12-14T03:55:47.945965844Z [err]  2025-12-14 03:55:47,918 - server - INFO -    âœ“ Response status: 200
2025-12-14T03:55:47.945972684Z [err]  2025-12-14 03:55:47,918 - server - INFO -    â†’ Streaming audio chunks...
2025-12-14T03:55:47.945977368Z [err]  2025-12-14 03:55:47,932 - server - INFO -    âœ“ FIRST CHUNK received (0.312s, 1121 bytes) [TARGET: <300ms]
2025-12-14T03:55:47.950270115Z [err]  2025-12-14 03:55:47,946 - server - INFO -    âœ“ ALL CHUNKS received: 59 chunks (0.326s)
2025-12-14T03:55:47.950281362Z [err]  2025-12-14 03:55:47,946 - server - INFO -    âœ“ Total audio size: 15509 bytes
2025-12-14T03:55:47.950289058Z [err]  2025-12-14 03:55:47,946 - server - INFO -    ğŸ“Š TTS API TIMING BREAKDOWN:
2025-12-14T03:55:47.950295929Z [err]  2025-12-14 03:55:47,946 - server - INFO -       - Connection: 298ms
2025-12-14T03:55:47.950303107Z [err]  2025-12-14 03:55:47,946 - server - INFO -       - First chunk: 312ms
2025-12-14T03:55:47.950310146Z [err]  2025-12-14 03:55:47,946 - server - INFO -       - All chunks: 326ms
2025-12-14T03:55:47.950317696Z [err]  2025-12-14 03:55:47,946 - server - INFO -       - Audio generation only: 14ms
2025-12-14T03:55:47.950324930Z [err]  2025-12-14 03:55:47,946 - server - INFO - â±ï¸ [03:55:47.946] ğŸ”Š TTS COMPLETE: 414ms, audio_size=15509 bytes
2025-12-14T03:55:47.950331896Z [err]  2025-12-14 03:55:47,946 - server - INFO - ğŸ’¾ TTS CACHED: elevenlabs:Are you still there?... (15509 bytes)
2025-12-14T03:55:47.950339696Z [err]  2025-12-14 03:55:47,947 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.41s
2025-12-14T03:55:47.950346723Z [err]  2025-12-14 03:55:47,947 - telnyx_service - INFO - âœ… Generated 15509 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-14T03:55:47.950353241Z [err]  2025-12-14 03:55:47,947 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-14T03:55:48.176356945Z [err]  2025-12-14 03:55:48,173 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-14T03:55:48.176364828Z [err]  2025-12-14 03:55:48,174 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.23s
2025-12-14T03:55:48.176371470Z [err]  2025-12-14 03:55:48,174 - telnyx_service - ERROR - âŒ Telnyx playback failed: 422 - {
2025-12-14T03:55:48.176378700Z [err]    "errors": [
2025-12-14T03:55:48.176385715Z [err]      {
2025-12-14T03:55:48.176392749Z [err]        "code": "90018",
2025-12-14T03:55:48.176399321Z [err]        "title": "Call has already ended",
2025-12-14T03:55:48.176406395Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-14T03:55:48.176413862Z [err]      }
2025-12-14T03:55:48.176421055Z [err]    ]
2025-12-14T03:55:48.176427725Z [err]  }
2025-12-14T03:55:48.176434557Z [err]  2025-12-14 03:55:48,174 - telnyx_service - INFO - ğŸ“¢ Using Telnyx built-in TTS
2025-12-14T03:55:48.433180973Z [err]  2025-12-14 03:55:48,430 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-14T03:55:48.433187403Z [err]  2025-12-14 03:55:48,431 - telnyx_service - ERROR - âŒ Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-14T03:55:48.433194534Z [err]  2025-12-14 03:55:48,431 - dead_air_monitor - INFO - âœ… Check-in message sent
2025-12-14T03:55:48.939409991Z [err]  2025-12-14 03:55:48,936 - dead_air_monitor - INFO - ğŸš© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-14T03:55:48.939415711Z [err]  2025-12-14 03:55:48,936 - calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1765684548.9369152 for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:48.939420379Z [err]  2025-12-14 03:55:48,936 - calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:50.425858101Z [err]  2025-12-14 03:55:50,420 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-14T03:55:50.425867213Z [err]  2025-12-14 03:55:50,423 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-14T03:55:50.425874573Z [err]  2025-12-14 03:55:50,424 - qc_agents.orchestrator - INFO - â­ Running Excellence Replicator on call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:50.464767695Z [err]  2025-12-14 03:55:50,459 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=1.5s, checkin_count=1/2
2025-12-14T03:55:50.966113984Z [err]  2025-12-14 03:55:50,965 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=2.0s, checkin_count=1/2
2025-12-14T03:55:53.838537204Z [err]  2025-12-14 03:55:53,822 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-14T03:55:53.838542754Z [err]  2025-12-14 03:55:53,826 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Expecting value: line 1 column 1 (char 0)
2025-12-14T03:55:53.980178923Z [err]  2025-12-14 03:55:53,917 - qc_agents.orchestrator - INFO - âœ… QC analysis stored for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:53.980185076Z [err]  2025-12-14 03:55:53,917 - server - INFO - âœ… QC analysis completed for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:53.980193902Z [err]  2025-12-14 03:55:53,917 - server - INFO - ğŸ“Š Scores: Commitment=50, Conversion=60, Excellence=50
2025-12-14T03:55:54.124713635Z [err]  2025-12-14 03:55:54,093 - server - INFO - ğŸ“Š Updated campaign_calls with QC scores for v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:54.278761160Z [err]  2025-12-14 03:55:54,270 - server - INFO - ğŸ“ˆ Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-14T03:55:54.361162667Z [err]  2025-12-14 03:55:54,360 - server - INFO - ğŸ·ï¸ Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-14T03:55:54.361170694Z [err]  2025-12-14 03:55:54,360 - server - ERROR - âŒ Error in auto appointment detection for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA: 'str' object has no attribute 'get'
2025-12-14T03:55:56.027701361Z [err]  2025-12-14 03:55:56,024 - calling_service - INFO - â° Check-in triggered after 7.1s silence (threshold: 7s)
2025-12-14T03:55:56.032200577Z [err]  2025-12-14 03:55:56,029 - calling_service - INFO - ğŸ’¬ Sending FINAL check-in #2/2: Are you still there?
2025-12-14T03:55:56.032206811Z [err]  2025-12-14 03:55:56,029 - calling_service - INFO - âš ï¸ Will end call if no response after next silence timeout
2025-12-14T03:55:56.032211054Z [err]  2025-12-14 03:55:56,029 - dead_air_monitor - INFO - ğŸ’¬ Sending check-in after 7.1s silence: Are you still there?
2025-12-14T03:55:56.032215721Z [err]  2025-12-14 03:55:56,029 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:56.032220259Z [err]  2025-12-14 03:55:56,029 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA: Are you still there?...
2025-12-14T03:55:56.032224388Z [err]  2025-12-14 03:55:56,029 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-14T03:55:56.032228761Z [err]  2025-12-14 03:55:56,029 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-14T03:55:56.032232792Z [err]  2025-12-14 03:55:56,029 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-14T03:55:56.032236796Z [err]  2025-12-14 03:55:56,029 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-14T03:55:56.032240665Z [err]  2025-12-14 03:55:56,029 - server - INFO - ğŸ’¾ TTS CACHE HIT: Returning cached audio (15509 bytes)
2025-12-14T03:55:56.032244844Z [err]  2025-12-14 03:55:56,029 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.00s
2025-12-14T03:55:56.032248597Z [err]  2025-12-14 03:55:56,030 - telnyx_service - INFO - âœ… Generated 15509 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-14T03:55:56.032252838Z [err]  2025-12-14 03:55:56,030 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-14T03:55:56.383189630Z [err]        "title": "Call has already ended",
2025-12-14T03:55:56.383201500Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-14T03:55:56.383210875Z [err]      }
2025-12-14T03:55:56.383217858Z [err]    ]
2025-12-14T03:55:56.383225386Z [err]  }
2025-12-14T03:55:56.383232546Z [err]  2025-12-14 03:55:56,323 - telnyx_service - INFO - ğŸ“¢ Using Telnyx built-in TTS
2025-12-14T03:55:56.383254725Z [err]  2025-12-14 03:55:56,322 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-14T03:55:56.383260718Z [err]  2025-12-14 03:55:56,323 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.29s
2025-12-14T03:55:56.383267890Z [err]  2025-12-14 03:55:56,323 - telnyx_service - ERROR - âŒ Telnyx playback failed: 422 - {
2025-12-14T03:55:56.383275860Z [err]    "errors": [
2025-12-14T03:55:56.383282786Z [err]      {
2025-12-14T03:55:56.383288346Z [err]        "code": "90018",
2025-12-14T03:55:56.582364377Z [err]  2025-12-14 03:55:56,579 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-14T03:55:56.582370185Z [err]  2025-12-14 03:55:56,579 - telnyx_service - ERROR - âŒ Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-14T03:55:56.582374351Z [err]  2025-12-14 03:55:56,579 - dead_air_monitor - INFO - âœ… Check-in message sent
2025-12-14T03:55:59.775374936Z [err]  2025-12-14 03:55:59,774 - server - INFO - ğŸ¤ Soniox receiver alive - 21 messages received in last 10s
2025-12-14T03:55:59.775382307Z [err]  2025-12-14 03:55:59,774 - server - ERROR - âŒ Soniox error: {'tokens': [], 'final_audio_proc_ms': 60600, 'total_audio_proc_ms': 65040, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-14T03:55:59.775388267Z [err]  2025-12-14 03:55:59,774 - server - INFO - âœ… Soniox receive loop ended normally
2025-12-14T03:55:59.775875305Z [err]  2025-12-14 03:55:59,775 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring cancelled for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:59.775882940Z [err]  2025-12-14 03:55:59,775 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring stopped for call v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA
2025-12-14T03:55:59.775889072Z [err]  2025-12-14 03:55:59,775 - server - INFO - ğŸ”‡ Dead air monitoring task cancelled
2025-12-14T03:56:00.809528517Z [err]  2025-12-14 03:56:00,776 - soniox_service - ERROR - âŒ Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-14T03:56:00.809532111Z [err]  2025-12-14 03:56:00,776 - server - INFO - ğŸ”Œ Telnyx WebSocket disconnected
2025-12-14T04:39:20.764729795Z [inf]  100.64.0.10:30394 - "GET /.git/config HTTP/1.1" 404
2025-12-14T04:55:02.914279409Z [err]  2025-12-14 04:54:53,564 - elevenlabs_ws_service - ERROR - âŒ Error sending text to ElevenLabs: no close frame received or sent
2025-12-14T07:26:17.207186630Z [inf]  100.64.0.11:51628 - "GET /api/agents HTTP/1.1" 401
2025-12-14T07:26:17.207193801Z [inf]  100.64.0.11:51628 - "GET /api/auth/me HTTP/1.1" 401
2025-12-14T07:26:17.207198671Z [inf]  100.64.0.12:50394 - "OPTIONS /api/auth/login HTTP/1.1" 200
2025-12-14T07:26:17.207203243Z [inf]  100.64.0.11:51628 - "POST /api/auth/login HTTP/1.1" 200
2025-12-14T07:26:17.207207029Z [inf]  100.64.0.11:51628 - "GET /api/agents HTTP/1.1" 200
2025-12-14T07:28:57.874802034Z [inf]  100.64.0.2:59880 - "GET /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/kb HTTP/1.1" 200
2025-12-14T07:28:57.874807336Z [inf]  100.64.0.2:59870 - "GET /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb HTTP/1.1" 200
2025-12-14T07:28:57.874811099Z [err]  2025-12-14 07:28:52,977 - qc_enhanced_router - INFO - Listed 1 campaigns for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:28:57.874815248Z [inf]  100.64.0.2:59880 - "GET /api/qc/enhanced/campaigns HTTP/1.1" 200
2025-12-14T07:28:57.874819232Z [inf]  100.64.0.2:59870 - "GET /api/qc/enhanced/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/auto-qc-settings HTTP/1.1" 200
2025-12-14T07:28:57.874823058Z [inf]  100.64.0.2:59870 - "GET /api/auth/me HTTP/1.1" 200
2025-12-14T07:28:57.874827359Z [inf]  100.64.0.2:59870 - "GET /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb HTTP/1.1" 200
2025-12-14T07:28:57.874830969Z [inf]  100.64.0.2:59880 - "GET /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/kb HTTP/1.1" 200
2025-12-14T07:28:57.874835266Z [inf]  100.64.0.2:59880 - "GET /api/qc/enhanced/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/auto-qc-settings HTTP/1.1" 200
2025-12-14T07:28:57.874839066Z [err]  2025-12-14 07:28:56,060 - qc_enhanced_router - INFO - Listed 1 campaigns for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:28:57.874842902Z [inf]  100.64.0.2:59870 - "GET /api/qc/enhanced/campaigns HTTP/1.1" 200
2025-12-14T07:29:17.837190786Z [inf]  100.64.0.12:11394 - "OPTIONS /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb HTTP/1.1" 200
2025-12-14T07:29:17.837201212Z [inf]  100.64.0.3:18952 - "PUT /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb HTTP/1.1" 200
2025-12-14T07:29:17.837207842Z [err]  2025-12-14 07:29:16,771 - qc_enhanced_router - INFO - Listed 1 campaigns for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:29:17.837214600Z [inf]  100.64.0.3:51588 - "GET /api/qc/enhanced/campaigns HTTP/1.1" 200
2025-12-14T07:29:17.837220961Z [inf]  100.64.0.3:18952 - "GET /api/agents HTTP/1.1" 200
2025-12-14T07:29:17.837227393Z [inf]  100.64.0.3:51594 - "GET /api/qc/enhanced/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/auto-qc-settings HTTP/1.1" 200
2025-12-14T07:29:24.258009704Z [inf]  100.64.0.4:61778 - "GET /api/agents HTTP/1.1" 200
2025-12-14T07:29:44.270059483Z [inf]  100.64.0.11:30398 - "OPTIONS /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-14T07:29:44.270067699Z [err]  2025-12-14 07:29:43,422 - server - INFO - ğŸŒ Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-14T07:29:44.270075214Z [err]  2025-12-14 07:29:43,510 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:29:44.270082347Z [err]  2025-12-14 07:29:43,598 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:29:44.270087860Z [err]  2025-12-14 07:29:43,628 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-14T07:29:44.270092020Z [err]  2025-12-14 07:29:43,628 - telnyx_service - INFO - ğŸ“ Initiating outbound call from +14048000152 to +17708336397
2025-12-14T07:29:44.270096421Z [err]  2025-12-14 07:29:43,628 - telnyx_service - INFO - ğŸ¤– Enabling AMD (premium mode)
2025-12-14T07:29:44.270100609Z [err]  2025-12-14 07:29:43,628 - telnyx_service - INFO - ğŸŒ Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-14T07:29:44.270106043Z [err]  2025-12-14 07:29:44,216 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-14T07:29:44.284911003Z [err]  2025-12-14 07:29:44,281 - telnyx_service - INFO - âœ… Call initiated: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:44.377503450Z [err]  2025-12-14 07:29:44,373 - server - INFO - ğŸ“ Created call log: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:44.420473236Z [err]  2025-12-14 07:29:44,406 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g (TTL: 3600s)
2025-12-14T07:29:44.420482829Z [err]  2025-12-14 07:29:44,406 - server - INFO - ğŸ“¦ Call data stored in Redis and memory
2025-12-14T07:29:44.420490027Z [err]  2025-12-14 07:29:44,406 - server - INFO - ğŸ“ Outbound call initiated: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:44.420495607Z [inf]  100.64.0.13:39282 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-14T07:29:44.635603045Z [err]  2025-12-14 07:29:44,608 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:29:44.635608410Z [err]  2025-12-14 07:29:44,608 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.initiated', 'id': '6cf5a809-0b60-41c1-8da3-500b1c37dd2a', 'occurred_at': '2025-12-14T07:29:44.103936Z', 'payload': {'call_control_id': 'v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g', 'call_leg_id': 'a90889b8-d8be-11f0-9670-02420aef93a1', 'call_session_id': 'a904f3e8-d8be-11f0-8e3d-02420aef93a1', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:29:44.635614003Z [err]  2025-12-14 07:29:44,608 - server - INFO - ğŸ¯ Event type: call.initiated, Call ID: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:44.635620206Z [err]  2025-12-14 07:29:44,608 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:29:44.635626304Z [err]  2025-12-14 07:29:44,608 - server - INFO - ğŸ“ Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-14T07:29:44.635632005Z [inf]  100.64.0.6:43380 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:29:44.639775995Z [err]  2025-12-14 07:29:44,638 - server - INFO - ğŸ”ŒğŸ”ŒğŸ”Œ WEBSOCKET CONNECTION ATTEMPT
2025-12-14T07:29:44.639782987Z [err]  2025-12-14 07:29:44,638 - server - INFO -    Client: Address(host='100.64.0.7', port=15102)
2025-12-14T07:29:44.639788736Z [err]  2025-12-14 07:29:44,638 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'b3rNfH7VUwac1mXz4VwFRg==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'K6zw7IQHQAqZ6fH49I3ezw', 'x-real-ip': '192.76.120.151', 'x-request-start': '1765697384402', 'accept-encoding': 'gzip'}
2025-12-14T07:29:44.639794220Z [err]  2025-12-14 07:29:44,638 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-14T07:29:44.639799748Z [err]  2025-12-14 07:29:44,638 - server - INFO - ğŸ”Œ Incoming Telnyx WebSocket connection
2025-12-14T07:29:44.639805624Z [err]  [2025-12-14 07:29:44 +0000] [6] [INFO] ('100.64.0.7', 15102) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-14T07:29:44.639811150Z [err]  2025-12-14 07:29:44,638 - server - INFO - âœ… WebSocket accepted, waiting for Telnyx events
2025-12-14T07:29:44.639816390Z [err]  [2025-12-14 07:29:44 +0000] [6] [INFO] connection open
2025-12-14T07:29:44.801783554Z [err]  2025-12-14 07:29:44,796 - server - INFO - ğŸ“¬ Received Telnyx event: connected
2025-12-14T07:29:44.801789951Z [err]  2025-12-14 07:29:44,796 - server - INFO - ğŸ“ Telnyx connected event received, waiting for 'start'...
2025-12-14T07:29:49.397833092Z [err]  2025-12-14 07:29:49,394 - server - INFO - ğŸ“¬ Received Telnyx event: start
2025-12-14T07:29:49.397839130Z [err]  2025-12-14 07:29:49,395 - server - INFO - ğŸ¬ Stream started for call: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:49.422364076Z [err]  2025-12-14 07:29:49,420 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:49.422370434Z [err]  2025-12-14 07:29:49,421 - server - INFO - âœ… Call data found after 0s wait
2025-12-14T07:29:49.422374855Z [err]  2025-12-14 07:29:49,421 - server - INFO - â³ Session not found locally, waiting briefly for webhook...
2025-12-14T07:29:49.808748409Z [err]  2025-12-14 07:29:49,802 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:29:49.808754032Z [err]  2025-12-14 07:29:49,802 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.answered', 'id': 'c043798e-a9d3-442f-bbb7-184d37bc678d', 'occurred_at': '2025-12-14T07:29:49.183934Z', 'payload': {'call_control_id': 'v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g', 'call_leg_id': 'a90889b8-d8be-11f0-9670-02420aef93a1', 'call_session_id': 'a904f3e8-d8be-11f0-8e3d-02420aef93a1', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-14T07:29:44.103936Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:29:49.808759228Z [err]  2025-12-14 07:29:49,802 - server - INFO - ğŸ¯ Event type: call.answered, Call ID: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:49.808763247Z [err]  2025-12-14 07:29:49,802 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:29:49.808767452Z [err]  2025-12-14 07:29:49,802 - server - INFO - âœ… Call answered: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:49.845973822Z [err]  2025-12-14 07:29:49,836 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:49.845980381Z [err]  2025-12-14 07:29:49,836 - server - INFO - âœ… Found call in Redis (multi-worker state sharing working)
2025-12-14T07:29:49.845986097Z [err]  2025-12-14 07:29:49,837 - server - INFO - ğŸ“ Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-14T07:29:49.922652233Z [err]  2025-12-14 07:29:49,920 - server - INFO - âš ï¸ Session still not found after wait, will create in worker
2025-12-14T07:29:49.922659159Z [err]  2025-12-14 07:29:49,920 - server - WARNING - âš ï¸ Session not found after waiting, creating in WebSocket worker...
2025-12-14T07:29:49.933057600Z [err]  2025-12-14 07:29:49,928 - server - INFO - âœ… Call log updated
2025-12-14T07:29:49.933064600Z [err]  2025-12-14 07:29:49,928 - server - INFO - ğŸ”§ Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:29:49.937750952Z [err]  2025-12-14 07:29:49,936 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:49.937757769Z [err]  2025-12-14 07:29:49,937 - server - INFO - ğŸ“ Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:29:49.937761883Z [err]  2025-12-14 07:29:49,937 - calling_service - INFO - ğŸ” Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-14T07:29:50.009672621Z [err]  2025-12-14 07:29:49,976 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:29:50.009678913Z [err]  2025-12-14 07:29:49,976 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'streaming.started', 'id': '94dd9a97-beb2-456b-a307-d2234ceacd53', 'occurred_at': '2025-12-14T07:29:49.543918Z', 'payload': {'call_control_id': 'v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g', 'call_leg_id': 'a90889b8-d8be-11f0-9670-02420aef93a1', 'call_session_id': 'a904f3e8-d8be-11f0-8e3d-02420aef93a1', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '5b717ac7-493f-4298-87bb-591bca32a9fb', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:29:50.009682933Z [err]  2025-12-14 07:29:49,976 - server - INFO - ğŸ¯ Event type: streaming.started, Call ID: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:50.009686744Z [err]  2025-12-14 07:29:49,976 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:29:50.009690572Z [inf]  100.64.0.7:15118 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:29:50.020277128Z [err]  2025-12-14 07:29:50,015 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:29:50.030965561Z [err]  2025-12-14 07:29:50,025 - calling_service - INFO - ğŸ” KB count query completed: 4 items
2025-12-14T07:29:50.030970975Z [err]  2025-12-14 07:29:50,025 - calling_service - INFO - ğŸ“š Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-14T07:29:50.030975650Z [err]  2025-12-14 07:29:50,026 - calling_service - INFO - ğŸ“‹ Built cached system prompt: 4159 chars (global) + 866 chars (technical)
2025-12-14T07:29:50.030979298Z [err]  2025-12-14 07:29:50,026 - calling_service - INFO - ğŸ“š KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-14T07:29:50.030983094Z [err]  2025-12-14 07:29:50,026 - calling_service - INFO - ğŸ”¥ Pre-warming LLM client (grok)...
2025-12-14T07:29:50.106690241Z [err]  2025-12-14 07:29:50,103 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:29:50.106696253Z [err]  2025-12-14 07:29:50,103 - server - INFO - ğŸ”§ Creating Telnyx service with user's keys...
2025-12-14T07:29:50.117343806Z [err]  2025-12-14 07:29:50,114 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:29:50.127957989Z [err]  2025-12-14 07:29:50,121 - calling_service - INFO - âœ… LLM client pre-warmed in 95ms
2025-12-14T07:29:50.127966686Z [err]  2025-12-14 07:29:50,121 - server - INFO - âœ… Session created in WebSocket worker
2025-12-14T07:29:50.127973330Z [err]  2025-12-14 07:29:50,121 - server - INFO - ğŸ“ Call data loaded, starting SONIOX connection...
2025-12-14T07:29:50.127980509Z [err]  2025-12-14 07:29:50,121 - server - INFO - âœ… Initialized call_states for v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g with session reference
2025-12-14T07:29:50.127984485Z [err]  2025-12-14 07:29:50,121 - server - INFO - âœ… Stored Telnyx WebSocket in call_data for audio streaming
2025-12-14T07:29:50.127989282Z [err]  2025-12-14 07:29:50,122 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found to update for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:50.138218741Z [err]  2025-12-14 07:29:50,135 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-14T07:29:50.216221642Z [err]  2025-12-14 07:29:50,210 - server - INFO - ğŸ”‘ Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-14T07:29:50.431075901Z [err]  2025-12-14 07:29:50,420 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g/actions/playback_start "HTTP/1.1 200 OK"
2025-12-14T07:29:50.431085410Z [err]  2025-12-14 07:29:50,420 - telnyx_service - INFO - âœ… Playing audio from URL, playback_id: 17fhe-zlag (loop=True, overlay=True)
2025-12-14T07:29:50.431093966Z [err]  2025-12-14 07:29:50,421 - server - WARNING - âš ï¸ Failed to start comfort noise: 'v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g'
2025-12-14T07:29:50.431100626Z [err]  2025-12-14 07:29:50,421 - telnyx_service - INFO - ğŸ™ï¸ Starting recording: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:50.752102870Z [err]  2025-12-14 07:29:50,748 - soniox_service - INFO - âœ… Connected to Soniox Real-Time STT
2025-12-14T07:29:50.752113841Z [err]  2025-12-14 07:29:50,749 - soniox_service - INFO - âš™ï¸  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-14T07:29:50.752121520Z [err]  2025-12-14 07:29:50,749 - soniox_service - INFO - âš™ï¸  Endpoint detection: True, Speaker diarization: False
2025-12-14T07:29:50.752128854Z [err]  2025-12-14 07:29:50,749 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring started for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:50.756436477Z [err]  2025-12-14 07:29:50,755 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-14T07:29:50.756443983Z [err]  2025-12-14 07:29:50,755 - server - INFO - âœ… Started forwarding audio (8kHz mulaw â†’ Soniox, NO BUFFERING)
2025-12-14T07:29:50.933729409Z [inf]  100.64.0.14:47292 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-14T07:29:50.933735107Z [err]  2025-12-14 07:29:50,872 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g/actions/record_start "HTTP/1.1 200 OK"
2025-12-14T07:29:50.933739407Z [err]  2025-12-14 07:29:50,873 - server - INFO - ğŸ™ï¸ Call recording started for v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:50.933743216Z [err]  2025-12-14 07:29:50,874 - server - INFO - ğŸ”§ Creating call session for v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g...
2025-12-14T07:29:50.933747418Z [err]  2025-12-14 07:29:50,874 - server - INFO - ğŸ” Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:29:50.933751938Z [err]  2025-12-14 07:29:50,874 - server - INFO - ğŸ”§ Calling create_call_session() - START
2025-12-14T07:29:50.933756302Z [err]  2025-12-14 07:29:50,874 - calling_service - INFO - ğŸ” Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-14T07:29:50.963668448Z [err]  2025-12-14 07:29:50,961 - calling_service - INFO - ğŸ” KB count query completed: 4 items
2025-12-14T07:29:50.963675857Z [err]  2025-12-14 07:29:50,961 - calling_service - INFO - ğŸ“š Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-14T07:29:50.973993414Z [err]  2025-12-14 07:29:50,972 - calling_service - INFO - ğŸ“‹ Built cached system prompt: 4159 chars (global) + 866 chars (technical)
2025-12-14T07:29:50.974001629Z [err]  2025-12-14 07:29:50,972 - calling_service - INFO - ğŸ“š KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-14T07:29:50.974008284Z [err]  2025-12-14 07:29:50,972 - calling_service - INFO - ğŸ”¥ Pre-warming LLM client (grok)...
2025-12-14T07:29:51.065662876Z [err]  2025-12-14 07:29:51,059 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:29:51.070183165Z [err]  2025-12-14 07:29:51,067 - calling_service - INFO - âœ… LLM client pre-warmed in 94ms
2025-12-14T07:29:51.070190559Z [err]  2025-12-14 07:29:51,067 - server - INFO - ğŸ”§ Calling create_call_session() - COMPLETE
2025-12-14T07:29:51.070198649Z [err]  2025-12-14 07:29:51,067 - server - INFO - âœ… Session object created: CallSession
2025-12-14T07:29:51.095244732Z [err]  2025-12-14 07:29:51,092 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g (TTL: 3600s)
2025-12-14T07:29:51.095251587Z [err]  2025-12-14 07:29:51,093 - server - INFO - âœ… Serializable call_data synced to Redis (agent_id, user_id)
2025-12-14T07:29:51.095258253Z [err]  2025-12-14 07:29:51,093 - server - INFO - âœ… Session stored in worker memory (not Redis)
2025-12-14T07:29:51.099651699Z [err]  2025-12-14 07:29:51,098 - redis_service - INFO - âœ… Marked session ready in Redis: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:51.099660253Z [err]  2025-12-14 07:29:51,098 - server - INFO - ğŸ¤– AI session created for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:51.099664845Z [err]  2025-12-14 07:29:51,098 - server - INFO - ğŸ“¦ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-14T07:29:51.099669017Z [err]  2025-12-14 07:29:51,098 - server - INFO - â­ï¸ Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-14T07:29:51.099672941Z [err]  2025-12-14 07:29:51,098 - server - INFO - ğŸ‘¤ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-14T07:29:51.099677029Z [err]  2025-12-14 07:29:51,098 - server - INFO - ğŸ‘‚ User speaks first - waiting for user input...
2025-12-14T07:29:51.099682489Z [err]  2025-12-14 07:29:51,098 - server - ERROR - Error processing webhook: cannot access local variable 'asyncio' where it is not associated with a value
2025-12-14T07:29:51.100043636Z [inf]  100.64.0.7:15104 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:29:52.125805116Z [err]  2025-12-14 07:29:52,095 - server - INFO - ğŸ”¤ RAW TOKENS: ["Hell"?]
2025-12-14T07:29:52.125811962Z [err]  2025-12-14 07:29:52,095 - calling_service - INFO - ğŸ”Š Silence timer reset for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g (user started speaking)
2025-12-14T07:29:52.125816604Z [err]  2025-12-14 07:29:52,095 - calling_service - INFO - ğŸ‘¤ User started speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:52.125821260Z [err]  2025-12-14 07:29:52,095 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'Hell' | Generating: False
2025-12-14T07:29:52.361758476Z [err]  2025-12-14 07:29:52,350 - server - INFO - ğŸ”¤ RAW TOKENS: ["Hell"âœ“, "o."âœ“, "<end>"âœ“]
2025-12-14T07:29:52.361768352Z [err]  2025-12-14 07:29:52,350 - server - INFO - ğŸ¯ Endpoint detected: <end> token received
2025-12-14T07:29:52.361775221Z [err]  2025-12-14 07:29:52,350 - server - INFO - ğŸ“¥ FINAL TOKENS: 'Hell o.' (2 tokens)
2025-12-14T07:29:52.361781721Z [err]  2025-12-14 07:29:52,350 - server - INFO - ğŸ¤ Soniox final transcript: 'Hell o.'
2025-12-14T07:29:52.361788059Z [err]  2025-12-14 07:29:52,350 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:mF2I2rgHD5TphLrvn... (active sessions: ['v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA'])
2025-12-14T07:29:52.361794144Z [err]  2025-12-14 07:29:52,350 - server - INFO - ğŸ” FILTER CHECK: words=2, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-14T07:29:52.361799568Z [err]  2025-12-14 07:29:52,350 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:mF2I2rgHD5TphLrvn... (active sessions: ['v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA'])
2025-12-14T07:29:52.361805236Z [err]  2025-12-14 07:29:52,350 - server - INFO - ğŸš€ Spawned tracked background task for endpoint processing
2025-12-14T07:29:52.361810936Z [err]  2025-12-14 07:29:52,350 - server - INFO - â±ï¸ [07:29:52.350] ğŸ“ FINAL TRANSCRIPT RECEIVED: 'Hell o.'
2025-12-14T07:29:52.361817146Z [err]  2025-12-14 07:29:52,350 - server - INFO - â±ï¸ [07:29:52.350] STT endpoint detection latency: 15ms
2025-12-14T07:29:52.361822971Z [err]  2025-12-14 07:29:52,350 - server - INFO - â±ï¸ [07:29:52.350] ğŸ¤ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-14T07:29:52.361828487Z [err]  2025-12-14 07:29:52,355 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g (TTL: 3600s)
2025-12-14T07:29:52.365555608Z [err]  2025-12-14 07:29:52,355 - server - INFO - ğŸ‘¤ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-14T07:29:52.365564500Z [err]  2025-12-14 07:29:52,355 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:mF2I2rgHD5TphLrvn... (active sessions: ['v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA'])
2025-12-14T07:29:52.365570555Z [err]  2025-12-14 07:29:52,356 - server - INFO - âœ… Agent SILENT - User said 2 word(s): 'Hell o.' - Processing...
2025-12-14T07:29:52.372524817Z [err]  2025-12-14 07:29:52,366 - server - INFO - ğŸ¤ Endpoint detected by Soniox - processing transcript: Hell o.
2025-12-14T07:29:52.372531540Z [err]  2025-12-14 07:29:52,366 - calling_service - INFO - ğŸ‘¤ User stopped speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:52.372535816Z [err]  2025-12-14 07:29:52,366 - server - INFO - â±ï¸ [TIMING] STT_START: User last audio packet received
2025-12-14T07:29:52.372539925Z [err]  2025-12-14 07:29:52,366 - server - INFO - â±ï¸ [TIMING] STT_END: Endpoint detected at T+10ms
2025-12-14T07:29:52.372543730Z [err]  2025-12-14 07:29:52,366 - server - INFO - â±ï¸ [TIMING] STT_LATENCY: 10ms (Soniox model: stt-rt-v3)
2025-12-14T07:29:52.372547582Z [err]  2025-12-14 07:29:52,366 - server - INFO - â±ï¸  USER STOPPED SPEAKING at T=0ms
2025-12-14T07:29:52.372551105Z [err]  2025-12-14 07:29:52,366 - server - INFO - ğŸ™ï¸ Agent generating response - interruption detection active
2025-12-14T07:29:52.372554775Z [err]  2025-12-14 07:29:52,366 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:52.473318370Z [err]  2025-12-14 07:29:52,457 - server - INFO - ğŸ“ Saved user transcript to database
2025-12-14T07:29:52.473328615Z [err]  2025-12-14 07:29:52,457 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:mF2I2rgHD5TphLrvn... (active sessions: ['v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA'])
2025-12-14T07:29:52.473336373Z [err]  2025-12-14 07:29:52,457 - calling_service - INFO - â±ï¸ [07:29:52.457] ğŸ“¥ process_user_input() ENTRY - text: 'Hell o....'
2025-12-14T07:29:52.473342432Z [err]  2025-12-14 07:29:52,457 - calling_service - INFO - â±ï¸ [07:29:52.457] â© About to call _process_call_flow_streaming()
2025-12-14T07:29:52.473347230Z [err]  2025-12-14 07:29:52,457 - calling_service - INFO - â±ï¸ [07:29:52.457] ğŸ”€ Agent type: call_flow, calling flow processor...
2025-12-14T07:29:52.473351885Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - â±ï¸ [07:29:52.457] ğŸ”€ _process_call_flow_streaming() ENTRY
2025-12-14T07:29:52.473356044Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-14T07:29:52.473362989Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - â±ï¸ [07:29:52.458] âœ… Node selected, about to process content...
2025-12-14T07:29:52.473369602Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - ğŸ”§ Replaced {{now}} with Sunday, December 14, 2025 at 2:29 AM EST in content
2025-12-14T07:29:52.473377056Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - ğŸ”§ Replaced {{customer_name}} with Kendrick in content
2025-12-14T07:29:52.473383927Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - ğŸ”§ Replaced {{callerName}} with  in content
2025-12-14T07:29:52.473390236Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - ğŸ”§ Replaced {{lead_id}} with None in content
2025-12-14T07:29:52.473396299Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - ğŸ”§ Replaced {{qc_tracking_enabled}} with False in content
2025-12-14T07:29:52.473966827Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - ğŸ”§ Replaced {{track_keywords}} with  in content
2025-12-14T07:29:52.473974332Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - ğŸ”§ Replaced {{expected_commitment}} with not_specified in content
2025-12-14T07:29:52.473981843Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - ğŸ”§ Replaced {{to_number}} with +17708336397 in content
2025-12-14T07:29:52.473988595Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - ğŸ”§ Replaced {{phone_number}} with +17708336397 in content
2025-12-14T07:29:52.473995003Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - ğŸ”§ Replaced {{email}} with None in content
2025-12-14T07:29:52.474001064Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - âœ… Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-14T07:29:52.474007213Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-14T07:29:52.474013343Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - ğŸ“š skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-14T07:29:52.474019746Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - â±ï¸ [07:29:52.458] ğŸ“„ About to process content (mode=script, length=9)
2025-12-14T07:29:52.474027057Z [err]  2025-12-14 07:29:52,458 - calling_service - INFO - ğŸ“¤ Streaming script as 1 sentence(s)
2025-12-14T07:29:52.474034881Z [err]  2025-12-14 07:29:52,458 - server - INFO - ğŸ“¤ Sentence arrived from LLM: Kendrick?...
2025-12-14T07:29:52.474041387Z [err]  2025-12-14 07:29:52,458 - server - INFO - â±ï¸ [TIMING] TTFS (Time To First Sentence): 91ms
2025-12-14T07:29:52.474047848Z [err]  2025-12-14 07:29:52,458 - server - INFO - âš¡ Starting REAL-TIME TTS for first sentence
2025-12-14T07:29:52.474051864Z [err]  2025-12-14 07:29:52,458 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:mF2I2rgHD5TphLrvn... (active sessions: ['v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA'])
2025-12-14T07:29:52.474155007Z [err]  2025-12-14 07:29:52,458 - server - INFO - âš¡ ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-14T07:29:52.551230639Z [err]  2025-12-14 07:29:52,540 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:29:52.551230816Z [err]  2025-12-14 07:29:52,540 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:29:52.551239154Z [err]  2025-12-14 07:29:52,540 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.started', 'id': '4414b5df-ff8b-4366-a44a-7ff4354ca65d', 'occurred_at': '2025-12-14T07:29:52.103935Z', 'payload': {'call_control_id': 'v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g', 'call_leg_id': 'a90889b8-d8be-11f0-9670-02420aef93a1', 'call_session_id': 'a904f3e8-d8be-11f0-8e3d-02420aef93a1', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': '17fhe-zlag', 'start_time': '2025-12-14T07:29:52.103935Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:29:52.551239249Z [inf]  100.64.0.15:49840 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:29:52.551246053Z [err]  2025-12-14 07:29:52,546 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:29:52.551247236Z [err]  2025-12-14 07:29:52,540 - server - INFO - ğŸ¯ Event type: call.playback.started, Call ID: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:52.643313528Z [err]  2025-12-14 07:29:52,634 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:29:52.726186900Z [err]  2025-12-14 07:29:52,722 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:29:52.746632327Z [err]  2025-12-14 07:29:52,742 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-14T07:29:52.746641612Z [err]  2025-12-14 07:29:52,742 - server - INFO - âœ… ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-14T07:29:52.746650911Z [err]  2025-12-14 07:29:52,742 - persistent_tts_service - INFO - ğŸ™ï¸ Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-14T07:29:52.746656504Z [err]  2025-12-14 07:29:52,742 - persistent_tts_service - INFO - ğŸ”Œ [Call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g] Establishing persistent TTS WebSocket...
2025-12-14T07:29:52.746660353Z [err]  2025-12-14 07:29:52,742 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-14T07:29:52.746665160Z [err]  2025-12-14 07:29:52,742 - elevenlabs_ws_service - INFO - ğŸ”Œ Connecting to ElevenLabs WebSocket: voice=kJKMPwrIKzwVkMKOfRtr, model=eleven_flash_v2_5
2025-12-14T07:29:52.746669358Z [err]  2025-12-14 07:29:52,742 - elevenlabs_ws_service - INFO - ğŸ™ï¸ Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-14T07:29:52.935116477Z [err]  2025-12-14 07:29:52,870 - elevenlabs_ws_service - INFO - âœ… Connected to ElevenLabs WebSocket
2025-12-14T07:29:52.935125347Z [err]  2025-12-14 07:29:52,870 - elevenlabs_ws_service - INFO - ğŸ“¤ Sent BOS message with voice settings
2025-12-14T07:29:52.935130815Z [err]  2025-12-14 07:29:52,870 - persistent_tts_service - INFO - âœ… [Call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g] Persistent TTS WebSocket established
2025-12-14T07:29:52.935135766Z [err]  2025-12-14 07:29:52,870 - persistent_tts_service - INFO - ğŸ”Š [Call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g] Comfort noise loop started
2025-12-14T07:29:52.935141516Z [err]  2025-12-14 07:29:52,870 - persistent_tts_service - INFO - âœ… Created persistent TTS session for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:52.935146529Z [err]  2025-12-14 07:29:52,870 - server - INFO - âœ… ON-DEMAND: Persistent TTS session created successfully!
2025-12-14T07:29:52.935150925Z [err]  2025-12-14 07:29:52,870 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:mF2I2rgHD5TphLrvn..., session=FOUND
2025-12-14T07:29:52.935155790Z [err]  2025-12-14 07:29:52,870 - server - INFO - ğŸš€ Streaming sentence #1 via persistent WebSocket
2025-12-14T07:29:52.935160430Z [err]  2025-12-14 07:29:52,870 - server - INFO - ğŸµ TTS task #1 started at +412ms
2025-12-14T07:29:52.935165379Z [err]  2025-12-14 07:29:52,870 - server - INFO - â±ï¸ [TIMING] TTFT_TTS (First TTS Task Started): 504ms
2025-12-14T07:29:52.935169859Z [err]  2025-12-14 07:29:52,870 - calling_service - INFO - ğŸ“¤ Streamed script sentence 1/1: Kendrick?...
2025-12-14T07:29:52.935180316Z [err]  2025-12-14 07:29:52,870 - calling_service - INFO - ğŸ”Š Silence tracking reset for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g (user responded)
2025-12-14T07:29:52.935184953Z [err]  2025-12-14 07:29:52,870 - calling_service - INFO - âœ… User responded to regular message, resetting counter
2025-12-14T07:29:52.939560077Z [err]  2025-12-14 07:29:52,870 - calling_service - INFO - ğŸ’¾ Storing node ID 2 in conversation history
2025-12-14T07:29:52.939567577Z [err]  2025-12-14 07:29:52,870 - calling_service - INFO - LLM response (0.41s): Kendrick?
2025-12-14T07:29:52.939571932Z [err]  2025-12-14 07:29:52,870 - calling_service - INFO - Total latency: 0.41s
2025-12-14T07:29:52.939576171Z [err]  2025-12-14 07:29:52,871 - server - INFO - âœ… LLM finished in 504ms, TTS tasks already running in background
2025-12-14T07:29:52.939580063Z [err]  2025-12-14 07:29:52,871 - server - INFO - ğŸµ Streaming 1 TTS chunks as they complete...
2025-12-14T07:29:52.939584395Z [err]  2025-12-14 07:29:52,871 - server - INFO - ğŸš€ Persistent TTS: Audio already streaming in background!
2025-12-14T07:29:52.939588539Z [err]  2025-12-14 07:29:52,871 - server - INFO -    1 sentences queued and playing seamlessly
2025-12-14T07:29:52.939593100Z [err]  2025-12-14 07:29:52,871 - persistent_tts_service - INFO - ğŸµ [Call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g] Playback consumer started
2025-12-14T07:29:52.939597897Z [err]  2025-12-14 07:29:52,871 - persistent_tts_service - INFO - ğŸ’“ [Call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g] Starting TTS keep-alive loop (every 15s)
2025-12-14T07:29:52.939602928Z [err]  2025-12-14 07:29:52,871 - persistent_tts_service - INFO - ğŸ”Š [Call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g] Starting comfort noise loop
2025-12-14T07:29:52.939607201Z [err]  2025-12-14 07:29:52,871 - persistent_tts_service - INFO - ğŸ¤ [Call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g] Streaming sentence #1: Kendrick?...
2025-12-14T07:29:52.939611077Z [err]  2025-12-14 07:29:52,893 - elevenlabs_ws_service - INFO - ğŸ’¬ ElevenLabs message: A voice with voice_id kJKMPwrIKzwVkMKOfRtr does not exist.
2025-12-14T07:29:52.939615829Z [err]  2025-12-14 07:29:52,893 - server - INFO - âœ… All 1 persistent TTS streams completed
2025-12-14T07:29:52.939620335Z [err]  2025-12-14 07:29:52,893 - server - INFO - âœ… Agent generation complete (persistent TTS) - response window closed
2025-12-14T07:29:52.939624691Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  FIRST AUDIO STARTED: 526ms from user stop ğŸš€
2025-12-14T07:29:52.939629240Z [err]  2025-12-14 07:29:52,893 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:52.939633316Z [err]  2025-12-14 07:29:52,893 - server - INFO - âœ… Agent generation complete - response window closed
2025-12-14T07:29:52.939637520Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-14T07:29:52.939642029Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-14T07:29:52.939647318Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  [TIMING] STT: 10ms (provider: soniox, model: stt-rt-v3)
2025-12-14T07:29:52.939651725Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  [TIMING] LLM_TOTAL: 504ms (provider: grok, model: grok-4-fast-non-reasoning)
2025-12-14T07:29:52.939655549Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  [TIMING] TTS_TOTAL: 435ms (provider: elevenlabs, websocket: False)
2025-12-14T07:29:52.939659129Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  [TIMING] E2E_TOTAL: 526ms (user stopped â†’ play_audio_url called)
2025-12-14T07:29:52.939663137Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  [TIMING] âš ï¸ NOTE: E2E_TOTAL does not include:
2025-12-14T07:29:52.939666917Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-14T07:29:52.939670719Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-14T07:29:52.939674761Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-14T07:29:52.939678479Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-14T07:29:52.939683604Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  [TIMING]   - REAL USER LATENCY: 826ms estimated
2025-12-14T07:29:52.939688354Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  [TIMING] RESPONSE_TEXT: 9 chars, 1 sentences
2025-12-14T07:29:52.939692487Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  [TIMING] USER_INPUT: 'Hell o....'
2025-12-14T07:29:52.939696121Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  [TIMING] AI_RESPONSE: 'Kendrick?...'
2025-12-14T07:29:52.939699909Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  [TIMING] ==========================
2025-12-14T07:29:52.939704099Z [err]  2025-12-14 07:29:52,893 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-14T07:29:53.046278624Z [err]  2025-12-14 07:29:53,036 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:29:53.046284400Z [err]  2025-12-14 07:29:53,036 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': 'd07835e7-9e57-4f4b-9b3b-4515537e15f5', 'occurred_at': '2025-12-14T07:29:52.903932Z', 'payload': {'call_control_id': 'v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g', 'call_leg_id': 'a90889b8-d8be-11f0-9670-02420aef93a1', 'call_session_id': 'a904f3e8-d8be-11f0-8e3d-02420aef93a1', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:29:53.046288145Z [err]  2025-12-14 07:29:53,036 - server - INFO - ğŸ¯ Event type: call.machine.premium.detection.ended, Call ID: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:29:53.046292467Z [err]  2025-12-14 07:29:53,036 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:29:53.046296613Z [inf]  100.64.0.15:49840 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:29:53.083947144Z [err]  2025-12-14 07:29:53,075 - server - INFO - ğŸ“ Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 949ms)
2025-12-14T07:29:53.083952993Z [err]  2025-12-14 07:29:53,075 - server - INFO - ğŸ”Š Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-14T07:29:55.758469602Z [err]  2025-12-14 07:29:55,755 - server - INFO - ğŸ“¤ Audio flowing: 302 packets sent to Soniox (5s update)
2025-12-14T07:30:00.507432858Z [err]  2025-12-14 07:30:00,434 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-14T07:30:00.792102300Z [err]  2025-12-14 07:30:00,774 - server - INFO - ğŸ“¤ Audio flowing: 553 packets sent to Soniox (5s update)
2025-12-14T07:30:00.950256533Z [err]  2025-12-14 07:30:00,944 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-14T07:30:01.032972133Z [err]  2025-12-14 07:30:01,032 - server - INFO - ğŸ¤ Soniox receiver alive - 11 messages received in last 10s
2025-12-14T07:30:02.750864303Z [err]  2025-12-14 07:30:02,687 - server - INFO - ğŸ”¤ RAW TOKENS: [" H"?]
2025-12-14T07:30:02.750873992Z [err]  2025-12-14 07:30:02,688 - calling_service - INFO - ğŸ”Š Silence timer reset for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g (user started speaking)
2025-12-14T07:30:02.750883793Z [err]  2025-12-14 07:30:02,688 - calling_service - INFO - ğŸ‘¤ User started speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:02.750888896Z [err]  2025-12-14 07:30:02,688 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-14T07:30:02.834163841Z [err]  2025-12-14 07:30:02,831 - server - INFO - ğŸ”¤ RAW TOKENS: [" H"?, "ello"?]
2025-12-14T07:30:02.834174172Z [err]  2025-12-14 07:30:02,831 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'Hello' | Generating: False
2025-12-14T07:30:02.973905152Z [err]  2025-12-14 07:30:02,952 - server - INFO - ğŸ”¤ RAW TOKENS: [" H"âœ“, "ello"âœ“, "?"âœ“, "<end>"âœ“]
2025-12-14T07:30:02.973911516Z [err]  2025-12-14 07:30:02,952 - server - INFO - ğŸ¯ Endpoint detected: <end> token received
2025-12-14T07:30:02.973917088Z [err]  2025-12-14 07:30:02,952 - server - INFO - ğŸ§¹ Cleaned transcript: ' H ello ?' -> 'Hello?'
2025-12-14T07:30:02.973922990Z [err]  2025-12-14 07:30:02,952 - server - INFO - ğŸ“¥ FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-14T07:30:02.973929510Z [err]  2025-12-14 07:30:02,952 - server - INFO - ğŸ¤ Soniox final transcript: 'Hello?'
2025-12-14T07:30:02.973935474Z [err]  2025-12-14 07:30:02,952 - server - INFO - ğŸ” FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-14T07:30:02.973940831Z [err]  2025-12-14 07:30:02,952 - server - INFO - ğŸš€ Spawned tracked background task for endpoint processing
2025-12-14T07:30:02.973947080Z [err]  2025-12-14 07:30:02,952 - server - INFO - â±ï¸ [07:30:02.952] ğŸ“ FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-14T07:30:02.973953110Z [err]  2025-12-14 07:30:02,952 - server - INFO - â±ï¸ [07:30:02.952] STT endpoint detection latency: 18ms
2025-12-14T07:30:02.973958458Z [err]  2025-12-14 07:30:02,952 - server - INFO - â±ï¸ [07:30:02.952] ğŸ¤ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-14T07:30:02.973964087Z [err]  2025-12-14 07:30:02,958 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g (TTL: 3600s)
2025-12-14T07:30:02.973969713Z [err]  2025-12-14 07:30:02,958 - server - INFO - ğŸ‘¤ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-14T07:30:02.973975682Z [err]  2025-12-14 07:30:02,958 - server - INFO - âœ… Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-14T07:30:02.973980965Z [err]  2025-12-14 07:30:02,968 - server - INFO - ğŸ¤ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-14T07:30:02.974169398Z [err]  2025-12-14 07:30:02,968 - calling_service - INFO - ğŸ‘¤ User stopped speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:02.974173790Z [err]  2025-12-14 07:30:02,968 - server - INFO - âœ… User starting new turn - resetting agent speaking flag
2025-12-14T07:30:02.974177794Z [err]  2025-12-14 07:30:02,968 - server - INFO - â±ï¸ [TIMING] STT_START: User last audio packet received
2025-12-14T07:30:02.974181558Z [err]  2025-12-14 07:30:02,968 - server - INFO - â±ï¸ [TIMING] STT_END: Endpoint detected at T+9ms
2025-12-14T07:30:02.974185242Z [err]  2025-12-14 07:30:02,968 - server - INFO - â±ï¸ [TIMING] STT_LATENCY: 9ms (Soniox model: stt-rt-v3)
2025-12-14T07:30:02.974189003Z [err]  2025-12-14 07:30:02,968 - server - INFO - â±ï¸  USER STOPPED SPEAKING at T=0ms
2025-12-14T07:30:02.974192731Z [err]  2025-12-14 07:30:02,968 - server - INFO - ğŸ™ï¸ Agent generating response - interruption detection active
2025-12-14T07:30:02.974196497Z [err]  2025-12-14 07:30:02,968 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:03.087908664Z [err]  2025-12-14 07:30:03,059 - server - INFO - ğŸ“ Saved user transcript to database
2025-12-14T07:30:03.087918153Z [err]  2025-12-14 07:30:03,059 - calling_service - INFO - â±ï¸ [07:30:03.059] ğŸ“¥ process_user_input() ENTRY - text: 'Hello?...'
2025-12-14T07:30:03.087925083Z [err]  2025-12-14 07:30:03,059 - calling_service - INFO - â±ï¸ [07:30:03.059] â© About to call _process_call_flow_streaming()
2025-12-14T07:30:03.087931480Z [err]  2025-12-14 07:30:03,059 - calling_service - INFO - â±ï¸ [07:30:03.059] ğŸ”€ Agent type: call_flow, calling flow processor...
2025-12-14T07:30:03.087937550Z [err]  2025-12-14 07:30:03,060 - calling_service - INFO - â±ï¸ [07:30:03.060] ğŸ”€ _process_call_flow_streaming() ENTRY
2025-12-14T07:30:03.087943734Z [err]  2025-12-14 07:30:03,060 - calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-14T07:30:03.087949950Z [err]  2025-12-14 07:30:03,060 - calling_service - INFO - ğŸ” Using explicitly set current_node_id: 2
2025-12-14T07:30:03.087955707Z [err]  2025-12-14 07:30:03,060 - calling_service - INFO - â±ï¸ [07:30:03.060] ğŸ”€ About to call _follow_transition() for: Hello?...
2025-12-14T07:30:03.087962015Z [err]  2025-12-14 07:30:03,060 - calling_service - INFO - Evaluating transitions from Greeting for message: Hello?
2025-12-14T07:30:03.087968455Z [err]  2025-12-14 07:30:03,067 - calling_service - INFO - â±ï¸ [07:30:03.067] ğŸ”€ TRANSITION EVALUATION START - Calling LLM for 4 options
2025-12-14T07:30:03.536820562Z [err]  2025-12-14 07:30:03,435 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-14T07:30:03.536834299Z [err]  2025-12-14 07:30:03,436 - calling_service - INFO - â±ï¸ [07:30:03.436] ğŸ”€ TRANSITION EVALUATION COMPLETE - took 368ms
2025-12-14T07:30:03.536845338Z [err]  2025-12-14 07:30:03,436 - calling_service - INFO - ğŸ¤– AI transition decision: '-1'
2025-12-14T07:30:03.536853121Z [err]  2025-12-14 07:30:03,436 - calling_service - INFO - ğŸ“Š Available transitions: ['Confirms name (Yes|Speaking|This is he/she|etc)...', 'Wrong number (No John here|Wrong number|etc)...', "The customer says let's set an appointment....", "Let's talk about my inances..."]
2025-12-14T07:30:03.536860491Z [err]  2025-12-14 07:30:03,436 - calling_service - INFO - Selected transition index: -1
2025-12-14T07:30:03.536868846Z [err]  2025-12-14 07:30:03,436 - calling_service - INFO - No specific condition matched, looking for default transition...
2025-12-14T07:30:03.536876746Z [err]  2025-12-14 07:30:03,436 - calling_service - INFO - âš ï¸ No transition matched, but node has GOAL. Staying on current node to continue with goal-based guidance.
2025-12-14T07:30:03.536879979Z [err]  2025-12-14 07:30:03,436 - calling_service - INFO - ğŸ¯ Goal: Say the customer's name...
2025-12-14T07:30:03.536888624Z [err]  2025-12-14 07:30:03,436 - calling_service - INFO - â±ï¸ [TIMING] TRANSITION_EVAL: 376ms
2025-12-14T07:30:03.536896638Z [err]  2025-12-14 07:30:03,436 - calling_service - INFO - â±ï¸ [07:30:03.436] âœ… Node selected, about to process content...
2025-12-14T07:30:03.536904018Z [err]  2025-12-14 07:30:03,436 - calling_service - INFO - ğŸ”§ Replaced {{now}} with Sunday, December 14, 2025 at 2:30 AM EST in content
2025-12-14T07:30:03.536919409Z [err]  2025-12-14 07:30:03,436 - calling_service - INFO - ğŸ”§ Replaced {{customer_name}} with Kendrick in content
2025-12-14T07:30:03.536928068Z [err]  2025-12-14 07:30:03,436 - calling_service - INFO - ğŸ”§ Replaced {{callerName}} with  in content
2025-12-14T07:30:03.537397288Z [err]  2025-12-14 07:30:03,436 - calling_service - INFO - ğŸ”§ Replaced {{lead_id}} with None in content
2025-12-14T07:30:03.537428393Z [err]  2025-12-14 07:30:03,436 - calling_service - INFO - ğŸ”§ Replaced {{qc_tracking_enabled}} with False in content
2025-12-14T07:30:03.537434613Z [err]  2025-12-14 07:30:03,436 - calling_service - INFO - ğŸ”§ Replaced {{track_keywords}} with  in content
2025-12-14T07:30:03.537440877Z [err]  2025-12-14 07:30:03,437 - calling_service - INFO - ğŸ”§ Replaced {{expected_commitment}} with not_specified in content
2025-12-14T07:30:03.537446542Z [err]  2025-12-14 07:30:03,437 - calling_service - INFO - ğŸ”§ Replaced {{to_number}} with +17708336397 in content
2025-12-14T07:30:03.537452393Z [err]  2025-12-14 07:30:03,437 - calling_service - INFO - ğŸ”§ Replaced {{phone_number}} with +17708336397 in content
2025-12-14T07:30:03.537458214Z [err]  2025-12-14 07:30:03,437 - calling_service - INFO - ğŸ”§ Replaced {{email}} with None in content
2025-12-14T07:30:03.537464037Z [err]  2025-12-14 07:30:03,437 - calling_service - INFO - âœ… Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-14T07:30:03.537469484Z [err]  2025-12-14 07:30:03,437 - calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-14T07:30:03.537475013Z [err]  2025-12-14 07:30:03,437 - calling_service - INFO - ğŸ“š skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-14T07:30:03.537480657Z [err]  2025-12-14 07:30:03,437 - calling_service - INFO - â±ï¸ [07:30:03.437] ğŸ“„ About to process content (mode=script, length=9)
2025-12-14T07:30:03.537486164Z [err]  2025-12-14 07:30:03,437 - calling_service - INFO - ğŸ“¤ Streaming script as 1 sentence(s)
2025-12-14T07:30:03.537491258Z [err]  2025-12-14 07:30:03,437 - server - INFO - ğŸ“¤ Sentence arrived from LLM: Kendrick?...
2025-12-14T07:30:03.537494955Z [err]  2025-12-14 07:30:03,437 - server - INFO - â±ï¸ [TIMING] TTFS (Time To First Sentence): 468ms
2025-12-14T07:30:03.537770124Z [err]  2025-12-14 07:30:03,437 - server - INFO - âš¡ Starting REAL-TIME TTS for first sentence
2025-12-14T07:30:03.537775682Z [err]  2025-12-14 07:30:03,437 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:mF2I2rgHD5TphLrvn..., session=FOUND
2025-12-14T07:30:03.537780119Z [err]  2025-12-14 07:30:03,437 - server - INFO - ğŸš€ Streaming sentence #1 via persistent WebSocket
2025-12-14T07:30:03.537784377Z [err]  2025-12-14 07:30:03,437 - server - INFO - ğŸµ TTS task #1 started at +0ms
2025-12-14T07:30:03.537789247Z [err]  2025-12-14 07:30:03,437 - server - INFO - â±ï¸ [TIMING] TTFT_TTS (First TTS Task Started): 469ms
2025-12-14T07:30:03.537796006Z [err]  2025-12-14 07:30:03,437 - calling_service - INFO - ğŸ“¤ Streamed script sentence 1/1: Kendrick?...
2025-12-14T07:30:03.537802590Z [err]  2025-12-14 07:30:03,437 - calling_service - INFO - ğŸ”Š Silence tracking reset for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g (user responded)
2025-12-14T07:30:03.537808908Z [err]  2025-12-14 07:30:03,437 - calling_service - INFO - âœ… User responded to regular message, resetting counter
2025-12-14T07:30:03.537815567Z [err]  2025-12-14 07:30:03,437 - calling_service - INFO - ğŸ’¾ Storing node ID 2 in conversation history
2025-12-14T07:30:03.537821942Z [err]  2025-12-14 07:30:03,437 - calling_service - INFO - LLM response (0.38s): Kendrick?
2025-12-14T07:30:03.537828157Z [err]  2025-12-14 07:30:03,437 - calling_service - INFO - Total latency: 0.38s
2025-12-14T07:30:03.537835227Z [err]  2025-12-14 07:30:03,437 - server - INFO - âœ… LLM finished in 469ms, TTS tasks already running in background
2025-12-14T07:30:03.537842116Z [err]  2025-12-14 07:30:03,437 - server - INFO - ğŸµ Streaming 1 TTS chunks as they complete...
2025-12-14T07:30:03.537847029Z [err]  2025-12-14 07:30:03,437 - server - INFO - ğŸš€ Persistent TTS: Audio already streaming in background!
2025-12-14T07:30:03.537851433Z [err]  2025-12-14 07:30:03,437 - server - INFO -    1 sentences queued and playing seamlessly
2025-12-14T07:30:03.538190996Z [err]  2025-12-14 07:30:03,437 - persistent_tts_service - INFO - ğŸ¤ [Call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g] Streaming sentence #2: Kendrick?...
2025-12-14T07:30:03.538198191Z [err]  2025-12-14 07:30:03,437 - elevenlabs_ws_service - ERROR - âŒ Error sending text to ElevenLabs: received 1008 (policy violation) A voice with voice_id kJKMPwrIKzwVkMKOfRtr does not exist.; then sent 1008 (policy violation) A voice with voice_id kJKMPwrIKzwVkMKOfRtr does not exist.
2025-12-14T07:30:03.538204812Z [err]  2025-12-14 07:30:03,438 - elevenlabs_ws_service - ERROR - âŒ WebSocket not connected
2025-12-14T07:30:03.538211626Z [err]  2025-12-14 07:30:03,438 - elevenlabs_ws_service - ERROR - âŒ WebSocket not connected
2025-12-14T07:30:03.538215911Z [err]  2025-12-14 07:30:03,438 - server - INFO - âœ… All 1 persistent TTS streams completed
2025-12-14T07:30:03.538220955Z [err]  2025-12-14 07:30:03,438 - server - INFO - âœ… Agent generation complete (persistent TTS) - response window closed
2025-12-14T07:30:03.538224563Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  FIRST AUDIO STARTED: 469ms from user stop ğŸš€
2025-12-14T07:30:03.538228341Z [err]  2025-12-14 07:30:03,438 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:03.538232161Z [err]  2025-12-14 07:30:03,438 - server - INFO - âœ… Agent generation complete - response window closed
2025-12-14T07:30:03.538235898Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-14T07:30:03.538239965Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-14T07:30:03.538243632Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  [TIMING] STT: 9ms (provider: soniox, model: stt-rt-v3)
2025-12-14T07:30:03.538911881Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  [TIMING] RESPONSE_TEXT: 9 chars, 1 sentences
2025-12-14T07:30:03.538913521Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  [TIMING] LLM_TOTAL: 469ms (provider: grok, model: grok-4-fast-non-reasoning)
2025-12-14T07:30:03.538918811Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  [TIMING] USER_INPUT: 'Hello?...'
2025-12-14T07:30:03.538924075Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  [TIMING] AI_RESPONSE: 'Kendrick?...'
2025-12-14T07:30:03.538924418Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  [TIMING] TTS_TOTAL: 0ms (provider: elevenlabs, websocket: False)
2025-12-14T07:30:03.538929795Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  [TIMING] ==========================
2025-12-14T07:30:03.538930201Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  [TIMING] E2E_TOTAL: 469ms (user stopped â†’ play_audio_url called)
2025-12-14T07:30:03.538935707Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  [TIMING] âš ï¸ NOTE: E2E_TOTAL does not include:
2025-12-14T07:30:03.538935909Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-14T07:30:03.538940493Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-14T07:30:03.538944243Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-14T07:30:03.538947806Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-14T07:30:03.538951392Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-14T07:30:03.538955096Z [err]  2025-12-14 07:30:03,438 - server - INFO - â±ï¸  [TIMING]   - REAL USER LATENCY: 769ms estimated
2025-12-14T07:30:03.630650981Z [err]  2025-12-14 07:30:03,620 - server - INFO - ğŸ“ Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 478ms)
2025-12-14T07:30:03.630657039Z [err]  2025-12-14 07:30:03,620 - server - INFO - ğŸ”Š Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-14T07:30:05.794575561Z [err]  2025-12-14 07:30:05,776 - server - INFO - ğŸ“¤ Audio flowing: 803 packets sent to Soniox (5s update)
2025-12-14T07:30:10.139873427Z [err]  2025-12-14 07:30:10,136 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-14T07:30:10.656081160Z [err]  2025-12-14 07:30:10,646 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-14T07:30:10.812735275Z [err]  2025-12-14 07:30:10,794 - server - INFO - ğŸ“¤ Audio flowing: 1054 packets sent to Soniox (5s update)
2025-12-14T07:30:11.608359797Z [err]  2025-12-14 07:30:11,584 - server - INFO - ğŸ¤ Soniox receiver alive - 12 messages received in last 10s
2025-12-14T07:30:12.858270643Z [err]  2025-12-14 07:30:12,855 - server - INFO - ğŸ”¤ RAW TOKENS: [" Can"?]
2025-12-14T07:30:12.858277625Z [err]  2025-12-14 07:30:12,855 - calling_service - INFO - ğŸ”Š Silence timer reset for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g (user started speaking)
2025-12-14T07:30:12.858283296Z [err]  2025-12-14 07:30:12,855 - calling_service - INFO - ğŸ‘¤ User started speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:12.858288568Z [err]  2025-12-14 07:30:12,855 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'Can' | Generating: False
2025-12-14T07:30:12.983001493Z [err]  2025-12-14 07:30:12,980 - server - INFO - ğŸ”¤ RAW TOKENS: [" Can"?, " y"?]
2025-12-14T07:30:12.983009764Z [err]  2025-12-14 07:30:12,981 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'Can y' | Generating: False
2025-12-14T07:30:13.118321266Z [err]  2025-12-14 07:30:13,116 - server - INFO - ğŸ”¤ RAW TOKENS: [" Can"?, " y"?, "ou"?]
2025-12-14T07:30:13.118325398Z [err]  2025-12-14 07:30:13,116 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'Can you' | Generating: False
2025-12-14T07:30:13.178739916Z [err]  2025-12-14 07:30:13,170 - server - INFO - ğŸ”¤ RAW TOKENS: [" Can"?, " y"?, "ou"?, " he"?, "ar"?]
2025-12-14T07:30:13.178749386Z [err]  2025-12-14 07:30:13,171 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'Can you he ar' | Generating: False
2025-12-14T07:30:13.292436849Z [err]  2025-12-14 07:30:13,289 - server - INFO - ğŸ”¤ RAW TOKENS: [" Can"?, " y"?, "ou"?, " he"?, "ar"?, " me"?]
2025-12-14T07:30:13.292447443Z [err]  2025-12-14 07:30:13,290 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'Can you he ar me' | Generating: False
2025-12-14T07:30:13.461729614Z [err]  2025-12-14 07:30:13,432 - server - INFO - â±ï¸ [07:30:13.432] ğŸ“ FINAL TRANSCRIPT RECEIVED: 'Can you he ar me?'
2025-12-14T07:30:13.461739407Z [err]  2025-12-14 07:30:13,432 - server - INFO - â±ï¸ [07:30:13.432] STT endpoint detection latency: 7ms
2025-12-14T07:30:13.461745755Z [err]  2025-12-14 07:30:13,432 - server - INFO - â±ï¸ [07:30:13.432] ğŸ¤ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-14T07:30:13.461751788Z [err]  2025-12-14 07:30:13,437 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g (TTL: 3600s)
2025-12-14T07:30:13.461757584Z [err]  2025-12-14 07:30:13,437 - server - INFO - ğŸ‘¤ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-14T07:30:13.461763534Z [err]  2025-12-14 07:30:13,437 - server - INFO - âœ… Agent SILENT - User said 5 word(s): 'Can you he ar me?' - Processing...
2025-12-14T07:30:13.461790389Z [err]  2025-12-14 07:30:13,431 - server - INFO - ğŸ”¤ RAW TOKENS: [" Can"âœ“, " y"âœ“, "ou"âœ“, " he"âœ“, "ar"âœ“, " me"âœ“, "?"âœ“, "<end>"âœ“]
2025-12-14T07:30:13.461798889Z [err]  2025-12-14 07:30:13,431 - server - INFO - ğŸ¯ Endpoint detected: <end> token received
2025-12-14T07:30:13.461809278Z [err]  2025-12-14 07:30:13,431 - server - INFO - ğŸ§¹ Cleaned transcript: ' Can  y ou  he ar  me ?' -> 'Can you he ar me?'
2025-12-14T07:30:13.461815464Z [err]  2025-12-14 07:30:13,431 - server - INFO - ğŸ“¥ FINAL TOKENS: 'Can you he ar me?' (7 tokens)
2025-12-14T07:30:13.461821267Z [err]  2025-12-14 07:30:13,431 - server - INFO - ğŸ¤ Soniox final transcript: 'Can you he ar me?'
2025-12-14T07:30:13.461826701Z [err]  2025-12-14 07:30:13,431 - server - INFO - ğŸ” FILTER CHECK: words=5, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-14T07:30:13.461832648Z [err]  2025-12-14 07:30:13,432 - server - INFO - ğŸš€ Spawned tracked background task for endpoint processing
2025-12-14T07:30:13.465885485Z [err]  2025-12-14 07:30:13,446 - server - INFO - ğŸ¤ Endpoint detected by Soniox - processing transcript: Can you he ar me?
2025-12-14T07:30:13.465891775Z [err]  2025-12-14 07:30:13,446 - calling_service - INFO - ğŸ‘¤ User stopped speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:13.465895863Z [err]  2025-12-14 07:30:13,447 - server - INFO - âœ… User starting new turn - resetting agent speaking flag
2025-12-14T07:30:13.465899495Z [err]  2025-12-14 07:30:13,447 - server - INFO - â±ï¸ [TIMING] STT_START: User last audio packet received
2025-12-14T07:30:13.465903097Z [err]  2025-12-14 07:30:13,447 - server - INFO - â±ï¸ [TIMING] STT_END: Endpoint detected at T+9ms
2025-12-14T07:30:13.465906676Z [err]  2025-12-14 07:30:13,447 - server - INFO - â±ï¸ [TIMING] STT_LATENCY: 9ms (Soniox model: stt-rt-v3)
2025-12-14T07:30:13.465910347Z [err]  2025-12-14 07:30:13,447 - server - INFO - â±ï¸  USER STOPPED SPEAKING at T=0ms
2025-12-14T07:30:13.465914195Z [err]  2025-12-14 07:30:13,447 - server - INFO - ğŸ™ï¸ Agent generating response - interruption detection active
2025-12-14T07:30:13.465917723Z [err]  2025-12-14 07:30:13,447 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:13.631830487Z [err]  2025-12-14 07:30:13,538 - server - INFO - ğŸ“ Saved user transcript to database
2025-12-14T07:30:13.631843269Z [err]  2025-12-14 07:30:13,538 - calling_service - INFO - â±ï¸ [07:30:13.538] ğŸ“¥ process_user_input() ENTRY - text: 'Can you he ar me?...'
2025-12-14T07:30:13.631851000Z [err]  2025-12-14 07:30:13,538 - calling_service - INFO - â±ï¸ [07:30:13.538] â© About to call _process_call_flow_streaming()
2025-12-14T07:30:13.631860186Z [err]  2025-12-14 07:30:13,538 - calling_service - INFO - â±ï¸ [07:30:13.538] ğŸ”€ Agent type: call_flow, calling flow processor...
2025-12-14T07:30:13.631866805Z [err]  2025-12-14 07:30:13,538 - calling_service - INFO - â±ï¸ [07:30:13.538] ğŸ”€ _process_call_flow_streaming() ENTRY
2025-12-14T07:30:13.631875341Z [err]  2025-12-14 07:30:13,538 - calling_service - INFO - Flow processing - History length: 5, Is first: False
2025-12-14T07:30:13.631882309Z [err]  2025-12-14 07:30:13,538 - calling_service - INFO - ğŸ” Using explicitly set current_node_id: 2
2025-12-14T07:30:13.631888516Z [err]  2025-12-14 07:30:13,538 - calling_service - INFO - â±ï¸ [07:30:13.538] ğŸ”€ About to call _follow_transition() for: Can you he ar me?...
2025-12-14T07:30:13.631895192Z [err]  2025-12-14 07:30:13,538 - calling_service - INFO - Evaluating transitions from Greeting for message: Can you he ar me?
2025-12-14T07:30:13.631904526Z [err]  2025-12-14 07:30:13,546 - calling_service - INFO - â±ï¸ [07:30:13.546] ğŸ”€ TRANSITION EVALUATION START - Calling LLM for 4 options
2025-12-14T07:30:13.960639780Z [err]  2025-12-14 07:30:13,936 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-14T07:30:13.960646426Z [err]  2025-12-14 07:30:13,937 - calling_service - INFO - â±ï¸ [07:30:13.937] ğŸ”€ TRANSITION EVALUATION COMPLETE - took 390ms
2025-12-14T07:30:13.960651231Z [err]  2025-12-14 07:30:13,937 - calling_service - INFO - ğŸ¤– AI transition decision: '-1'
2025-12-14T07:30:13.960655613Z [err]  2025-12-14 07:30:13,937 - calling_service - INFO - ğŸ“Š Available transitions: ['Confirms name (Yes|Speaking|This is he/she|etc)...', 'Wrong number (No John here|Wrong number|etc)...', "The customer says let's set an appointment....", "Let's talk about my inances..."]
2025-12-14T07:30:13.960660014Z [err]  2025-12-14 07:30:13,937 - calling_service - INFO - Selected transition index: -1
2025-12-14T07:30:13.960664659Z [err]  2025-12-14 07:30:13,937 - calling_service - INFO - No specific condition matched, looking for default transition...
2025-12-14T07:30:13.960668762Z [err]  2025-12-14 07:30:13,937 - calling_service - INFO - âš ï¸ No transition matched, but node has GOAL. Staying on current node to continue with goal-based guidance.
2025-12-14T07:30:13.960672608Z [err]  2025-12-14 07:30:13,937 - calling_service - INFO - ğŸ¯ Goal: Say the customer's name...
2025-12-14T07:30:13.960676385Z [err]  2025-12-14 07:30:13,937 - calling_service - INFO - â±ï¸ [TIMING] TRANSITION_EVAL: 398ms
2025-12-14T07:30:13.960680412Z [err]  2025-12-14 07:30:13,937 - calling_service - INFO - â±ï¸ [07:30:13.937] âœ… Node selected, about to process content...
2025-12-14T07:30:13.960684795Z [err]  2025-12-14 07:30:13,937 - calling_service - INFO - ğŸ”§ Replaced {{now}} with Sunday, December 14, 2025 at 2:30 AM EST in content
2025-12-14T07:30:13.960688346Z [err]  2025-12-14 07:30:13,937 - calling_service - INFO - ğŸ”§ Replaced {{customer_name}} with Kendrick in content
2025-12-14T07:30:13.960692752Z [err]  2025-12-14 07:30:13,937 - calling_service - INFO - ğŸ”§ Replaced {{callerName}} with  in content
2025-12-14T07:30:13.961230866Z [err]  2025-12-14 07:30:13,937 - calling_service - INFO - ğŸ”§ Replaced {{lead_id}} with None in content
2025-12-14T07:30:13.961236926Z [err]  2025-12-14 07:30:13,937 - calling_service - INFO - ğŸ”§ Replaced {{qc_tracking_enabled}} with False in content
2025-12-14T07:30:13.961242216Z [err]  2025-12-14 07:30:13,937 - calling_service - INFO - ğŸ”§ Replaced {{track_keywords}} with  in content
2025-12-14T07:30:13.961246679Z [err]  2025-12-14 07:30:13,937 - calling_service - INFO - ğŸ”§ Replaced {{expected_commitment}} with not_specified in content
2025-12-14T07:30:13.961250631Z [err]  2025-12-14 07:30:13,937 - calling_service - INFO - ğŸ”§ Replaced {{to_number}} with +17708336397 in content
2025-12-14T07:30:13.961255228Z [err]  2025-12-14 07:30:13,938 - calling_service - INFO - ğŸ”§ Replaced {{phone_number}} with +17708336397 in content
2025-12-14T07:30:13.961259784Z [err]  2025-12-14 07:30:13,938 - calling_service - INFO - ğŸ”§ Replaced {{email}} with None in content
2025-12-14T07:30:13.961263583Z [err]  2025-12-14 07:30:13,938 - calling_service - INFO - âœ… Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-14T07:30:13.961267187Z [err]  2025-12-14 07:30:13,938 - calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-14T07:30:13.961271500Z [err]  2025-12-14 07:30:13,938 - calling_service - INFO - ğŸ“š skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-14T07:30:13.961275059Z [err]  2025-12-14 07:30:13,938 - calling_service - INFO - â±ï¸ [07:30:13.938] ğŸ“„ About to process content (mode=script, length=9)
2025-12-14T07:30:13.961279749Z [err]  2025-12-14 07:30:13,938 - calling_service - INFO - ğŸ“¤ Streaming script as 1 sentence(s)
2025-12-14T07:30:13.961283567Z [err]  2025-12-14 07:30:13,938 - server - INFO - ğŸ“¤ Sentence arrived from LLM: Kendrick?...
2025-12-14T07:30:13.961287465Z [err]  2025-12-14 07:30:13,938 - server - INFO - â±ï¸ [TIMING] TTFS (Time To First Sentence): 491ms
2025-12-14T07:30:13.961853378Z [err]  2025-12-14 07:30:13,938 - server - INFO - âš¡ Starting REAL-TIME TTS for first sentence
2025-12-14T07:30:13.961861873Z [err]  2025-12-14 07:30:13,938 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:mF2I2rgHD5TphLrvn..., session=FOUND
2025-12-14T07:30:13.961868239Z [err]  2025-12-14 07:30:13,938 - server - INFO - ğŸš€ Streaming sentence #1 via persistent WebSocket
2025-12-14T07:30:13.961875677Z [err]  2025-12-14 07:30:13,938 - server - INFO - ğŸµ TTS task #1 started at +0ms
2025-12-14T07:30:13.961882549Z [err]  2025-12-14 07:30:13,938 - server - INFO - â±ï¸ [TIMING] TTFT_TTS (First TTS Task Started): 491ms
2025-12-14T07:30:13.961889429Z [err]  2025-12-14 07:30:13,938 - calling_service - INFO - ğŸ“¤ Streamed script sentence 1/1: Kendrick?...
2025-12-14T07:30:13.961896676Z [err]  2025-12-14 07:30:13,938 - calling_service - INFO - ğŸ”Š Silence tracking reset for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g (user responded)
2025-12-14T07:30:13.961903627Z [err]  2025-12-14 07:30:13,938 - calling_service - INFO - âœ… User responded to regular message, resetting counter
2025-12-14T07:30:13.961909982Z [err]  2025-12-14 07:30:13,938 - calling_service - INFO - ğŸ’¾ Storing node ID 2 in conversation history
2025-12-14T07:30:13.961923111Z [err]  2025-12-14 07:30:13,938 - calling_service - INFO - LLM response (0.40s): Kendrick?
2025-12-14T07:30:13.961929960Z [err]  2025-12-14 07:30:13,938 - calling_service - INFO - Total latency: 0.40s
2025-12-14T07:30:13.961936874Z [err]  2025-12-14 07:30:13,938 - server - INFO - âœ… LLM finished in 491ms, TTS tasks already running in background
2025-12-14T07:30:13.961941199Z [err]  2025-12-14 07:30:13,938 - server - INFO - ğŸµ Streaming 1 TTS chunks as they complete...
2025-12-14T07:30:13.961945157Z [err]  2025-12-14 07:30:13,938 - server - INFO - ğŸš€ Persistent TTS: Audio already streaming in background!
2025-12-14T07:30:13.961949433Z [err]  2025-12-14 07:30:13,938 - server - INFO -    1 sentences queued and playing seamlessly
2025-12-14T07:30:13.967950468Z [err]  2025-12-14 07:30:13,938 - persistent_tts_service - WARNING - âš ï¸ [Call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g] TTS WebSocket disconnected, attempting reconnection...
2025-12-14T07:30:13.967959533Z [err]  2025-12-14 07:30:13,939 - persistent_tts_service - INFO - ğŸ”„ [Call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g] Attempting TTS WebSocket reconnection...
2025-12-14T07:30:13.967967370Z [err]  2025-12-14 07:30:13,939 - elevenlabs_ws_service - INFO - ğŸ”Œ Closed ElevenLabs WebSocket connection
2025-12-14T07:30:13.967973400Z [err]  2025-12-14 07:30:13,939 - elevenlabs_ws_service - INFO - ğŸ”Œ Connecting to ElevenLabs WebSocket: voice=kJKMPwrIKzwVkMKOfRtr, model=eleven_flash_v2_5
2025-12-14T07:30:13.967982550Z [err]  2025-12-14 07:30:13,939 - elevenlabs_ws_service - INFO - ğŸ™ï¸ Voice settings: stability=0.4, similarity=0.75, style=0.2
2025-12-14T07:30:14.066740641Z [err]  2025-12-14 07:30:14,062 - elevenlabs_ws_service - INFO - âœ… Connected to ElevenLabs WebSocket
2025-12-14T07:30:14.066748303Z [err]  2025-12-14 07:30:14,063 - elevenlabs_ws_service - INFO - ğŸ“¤ Sent BOS message with voice settings
2025-12-14T07:30:14.066753013Z [err]  2025-12-14 07:30:14,063 - persistent_tts_service - INFO - âœ… [Call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g] TTS WebSocket reconnected
2025-12-14T07:30:14.066757626Z [err]  2025-12-14 07:30:14,063 - persistent_tts_service - INFO - âœ… [Call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g] TTS WebSocket reconnected successfully
2025-12-14T07:30:14.066764162Z [err]  2025-12-14 07:30:14,063 - persistent_tts_service - INFO - ğŸ¤ [Call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g] Streaming sentence #3: Kendrick?...
2025-12-14T07:30:14.066769757Z [err]  2025-12-14 07:30:14,063 - persistent_tts_service - INFO - ğŸ’“ [Call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g] Starting TTS keep-alive loop (every 15s)
2025-12-14T07:30:14.087910071Z [err]  2025-12-14 07:30:14,079 - elevenlabs_ws_service - INFO - ğŸ’¬ ElevenLabs message: A voice with voice_id kJKMPwrIKzwVkMKOfRtr does not exist.
2025-12-14T07:30:14.087917111Z [err]  2025-12-14 07:30:14,079 - server - INFO - âœ… All 1 persistent TTS streams completed
2025-12-14T07:30:14.087922580Z [err]  2025-12-14 07:30:14,079 - server - INFO - âœ… Agent generation complete (persistent TTS) - response window closed
2025-12-14T07:30:14.087923524Z [err]  2025-12-14 07:30:14,080 - server - INFO - â±ï¸  [TIMING] TTS_TOTAL: 141ms (provider: elevenlabs, websocket: False)
2025-12-14T07:30:14.087927326Z [err]  2025-12-14 07:30:14,079 - server - INFO - â±ï¸  FIRST AUDIO STARTED: 632ms from user stop ğŸš€
2025-12-14T07:30:14.087933277Z [err]  2025-12-14 07:30:14,079 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:14.087933993Z [err]  2025-12-14 07:30:14,080 - server - INFO - â±ï¸  [TIMING] E2E_TOTAL: 632ms (user stopped â†’ play_audio_url called)
2025-12-14T07:30:14.087938715Z [err]  2025-12-14 07:30:14,079 - server - INFO - âœ… Agent generation complete - response window closed
2025-12-14T07:30:14.087941645Z [err]  2025-12-14 07:30:14,080 - server - INFO - â±ï¸  [TIMING] âš ï¸ NOTE: E2E_TOTAL does not include:
2025-12-14T07:30:14.087943935Z [err]  2025-12-14 07:30:14,079 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-14T07:30:14.087948113Z [err]  2025-12-14 07:30:14,080 - server - INFO - â±ï¸  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-14T07:30:14.087953550Z [err]  2025-12-14 07:30:14,080 - server - INFO - â±ï¸  [TIMING] STT: 9ms (provider: soniox, model: stt-rt-v3)
2025-12-14T07:30:14.087957630Z [err]  2025-12-14 07:30:14,080 - server - INFO - â±ï¸  [TIMING] LLM_TOTAL: 491ms (provider: grok, model: grok-4-fast-non-reasoning)
2025-12-14T07:30:14.088427529Z [err]  2025-12-14 07:30:14,080 - server - INFO - â±ï¸  [TIMING] AI_RESPONSE: 'Kendrick?...'
2025-12-14T07:30:14.088434323Z [err]  2025-12-14 07:30:14,080 - server - INFO - â±ï¸  [TIMING] ==========================
2025-12-14T07:30:14.088435257Z [err]  2025-12-14 07:30:14,080 - server - INFO - â±ï¸  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-14T07:30:14.088439734Z [err]  2025-12-14 07:30:14,080 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-14T07:30:14.088443915Z [err]  2025-12-14 07:30:14,080 - server - INFO - â±ï¸  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-14T07:30:14.088448720Z [err]  2025-12-14 07:30:14,080 - server - INFO - â±ï¸  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-14T07:30:14.088455607Z [err]  2025-12-14 07:30:14,080 - server - INFO - â±ï¸  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-14T07:30:14.088459557Z [err]  2025-12-14 07:30:14,080 - server - INFO - â±ï¸  [TIMING]   - REAL USER LATENCY: 932ms estimated
2025-12-14T07:30:14.088464307Z [err]  2025-12-14 07:30:14,080 - server - INFO - â±ï¸  [TIMING] RESPONSE_TEXT: 9 chars, 1 sentences
2025-12-14T07:30:14.088469169Z [err]  2025-12-14 07:30:14,080 - server - INFO - â±ï¸  [TIMING] USER_INPUT: 'Can you he ar me?...'
2025-12-14T07:30:14.287471879Z [err]  2025-12-14 07:30:14,264 - server - INFO - ğŸ“ Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 641ms)
2025-12-14T07:30:14.287480490Z [err]  2025-12-14 07:30:14,264 - server - INFO - ğŸ”Š Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-14T07:30:15.830162060Z [err]  2025-12-14 07:30:15,818 - server - INFO - ğŸ“¤ Audio flowing: 1304 packets sent to Soniox (5s update)
2025-12-14T07:30:20.349685119Z [err]  2025-12-14 07:30:20,344 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-14T07:30:20.862286601Z [err]  2025-12-14 07:30:20,835 - server - INFO - ğŸ“¤ Audio flowing: 1555 packets sent to Soniox (5s update)
2025-12-14T07:30:20.862293153Z [err]  2025-12-14 07:30:20,855 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-14T07:30:22.125061244Z [err]  2025-12-14 07:30:22,072 - server - INFO - ğŸ¤ Soniox receiver alive - 15 messages received in last 10s
2025-12-14T07:30:25.881935533Z [err]  2025-12-14 07:30:25,861 - server - INFO - ğŸ“¤ Audio flowing: 1806 packets sent to Soniox (5s update)
2025-12-14T07:30:27.119129014Z [err]  2025-12-14 07:30:27,108 - server - INFO - ğŸ”¤ RAW TOKENS: [" H"?]
2025-12-14T07:30:27.119137166Z [err]  2025-12-14 07:30:27,109 - calling_service - INFO - ğŸ”Š Silence timer reset for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g (user started speaking)
2025-12-14T07:30:27.119141371Z [err]  2025-12-14 07:30:27,109 - calling_service - INFO - ğŸ‘¤ User started speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:27.119145215Z [err]  2025-12-14 07:30:27,109 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-14T07:30:27.371016016Z [err]  2025-12-14 07:30:27,369 - server - INFO - ğŸ”¤ RAW TOKENS: [" H"?, "ello"?]
2025-12-14T07:30:27.371020461Z [err]  2025-12-14 07:30:27,370 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'Hello' | Generating: False
2025-12-14T07:30:27.551487645Z [err]  2025-12-14 07:30:27,521 - server - INFO - ğŸ”¤ RAW TOKENS: [" H"âœ“, "ello"âœ“, "?"âœ“, "<end>"âœ“]
2025-12-14T07:30:27.551496230Z [err]  2025-12-14 07:30:27,521 - server - INFO - ğŸ¯ Endpoint detected: <end> token received
2025-12-14T07:30:27.551504040Z [err]  2025-12-14 07:30:27,522 - server - INFO - ğŸ§¹ Cleaned transcript: ' H ello ?' -> 'Hello?'
2025-12-14T07:30:27.551511568Z [err]  2025-12-14 07:30:27,522 - server - INFO - ğŸ“¥ FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-14T07:30:27.551518988Z [err]  2025-12-14 07:30:27,522 - server - INFO - ğŸ¤ Soniox final transcript: 'Hello?'
2025-12-14T07:30:27.551525675Z [err]  2025-12-14 07:30:27,522 - server - INFO - ğŸ” FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-14T07:30:27.551534431Z [err]  2025-12-14 07:30:27,522 - server - INFO - ğŸš€ Spawned tracked background task for endpoint processing
2025-12-14T07:30:27.551540877Z [err]  2025-12-14 07:30:27,522 - server - INFO - â±ï¸ [07:30:27.522] ğŸ“ FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-14T07:30:27.551548807Z [err]  2025-12-14 07:30:27,522 - server - INFO - â±ï¸ [07:30:27.522] STT endpoint detection latency: 7ms
2025-12-14T07:30:27.551555559Z [err]  2025-12-14 07:30:27,522 - server - INFO - â±ï¸ [07:30:27.522] ğŸ¤ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-14T07:30:27.551563169Z [err]  2025-12-14 07:30:27,528 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g (TTL: 3600s)
2025-12-14T07:30:27.551570083Z [err]  2025-12-14 07:30:27,528 - server - INFO - ğŸ‘¤ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-14T07:30:27.551577827Z [err]  2025-12-14 07:30:27,528 - server - INFO - âœ… Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-14T07:30:27.551584479Z [err]  2025-12-14 07:30:27,539 - server - INFO - ğŸ¤ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-14T07:30:27.551743610Z [err]  2025-12-14 07:30:27,539 - calling_service - INFO - ğŸ‘¤ User stopped speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:27.551749523Z [err]  2025-12-14 07:30:27,539 - server - INFO - âœ… User starting new turn - resetting agent speaking flag
2025-12-14T07:30:27.551754800Z [err]  2025-12-14 07:30:27,539 - server - INFO - â±ï¸ [TIMING] STT_START: User last audio packet received
2025-12-14T07:30:27.551759757Z [err]  2025-12-14 07:30:27,539 - server - INFO - â±ï¸ [TIMING] STT_END: Endpoint detected at T+4ms
2025-12-14T07:30:27.551765010Z [err]  2025-12-14 07:30:27,539 - server - INFO - â±ï¸ [TIMING] STT_LATENCY: 4ms (Soniox model: stt-rt-v3)
2025-12-14T07:30:27.551770898Z [err]  2025-12-14 07:30:27,539 - server - INFO - â±ï¸  USER STOPPED SPEAKING at T=0ms
2025-12-14T07:30:27.551776965Z [err]  2025-12-14 07:30:27,539 - server - INFO - ğŸ™ï¸ Agent generating response - interruption detection active
2025-12-14T07:30:27.551783390Z [err]  2025-12-14 07:30:27,539 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:27.764832610Z [err]  2025-12-14 07:30:27,631 - server - INFO - ğŸ“ Saved user transcript to database
2025-12-14T07:30:27.764843177Z [err]  2025-12-14 07:30:27,631 - calling_service - INFO - â±ï¸ [07:30:27.631] ğŸ“¥ process_user_input() ENTRY - text: 'Hello?...'
2025-12-14T07:30:27.764849024Z [err]  2025-12-14 07:30:27,631 - calling_service - INFO - â±ï¸ [07:30:27.631] â© About to call _process_call_flow_streaming()
2025-12-14T07:30:27.764854592Z [err]  2025-12-14 07:30:27,631 - calling_service - INFO - â±ï¸ [07:30:27.631] ğŸ”€ Agent type: call_flow, calling flow processor...
2025-12-14T07:30:27.764863156Z [err]  2025-12-14 07:30:27,631 - calling_service - INFO - â±ï¸ [07:30:27.631] ğŸ”€ _process_call_flow_streaming() ENTRY
2025-12-14T07:30:27.764868629Z [err]  2025-12-14 07:30:27,631 - calling_service - INFO - Flow processing - History length: 7, Is first: False
2025-12-14T07:30:27.764877570Z [err]  2025-12-14 07:30:27,631 - calling_service - INFO - ğŸ” Using explicitly set current_node_id: 2
2025-12-14T07:30:27.764884842Z [err]  2025-12-14 07:30:27,631 - calling_service - INFO - â±ï¸ [07:30:27.631] ğŸ”€ About to call _follow_transition() for: Hello?...
2025-12-14T07:30:27.764890114Z [err]  2025-12-14 07:30:27,631 - calling_service - INFO - Evaluating transitions from Greeting for message: Hello?
2025-12-14T07:30:27.764895320Z [err]  2025-12-14 07:30:27,642 - calling_service - INFO - â±ï¸ [07:30:27.642] ğŸ”€ TRANSITION EVALUATION START - Calling LLM for 4 options
2025-12-14T07:30:28.410907626Z [err]  2025-12-14 07:30:28,409 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-14T07:30:28.411681401Z [err]  2025-12-14 07:30:28,410 - calling_service - INFO - â±ï¸ [07:30:28.410] ğŸ”€ TRANSITION EVALUATION COMPLETE - took 768ms
2025-12-14T07:30:28.411689340Z [err]  2025-12-14 07:30:28,410 - calling_service - INFO - ğŸ¤– AI transition decision: '-1'
2025-12-14T07:30:28.411694321Z [err]  2025-12-14 07:30:28,410 - calling_service - INFO - ğŸ“Š Available transitions: ['Confirms name (Yes|Speaking|This is he/she|etc)...', 'Wrong number (No John here|Wrong number|etc)...', "The customer says let's set an appointment....", "Let's talk about my inances..."]
2025-12-14T07:30:28.411698749Z [err]  2025-12-14 07:30:28,410 - calling_service - INFO - Selected transition index: -1
2025-12-14T07:30:28.411703465Z [err]  2025-12-14 07:30:28,410 - calling_service - INFO - No specific condition matched, looking for default transition...
2025-12-14T07:30:28.411707902Z [err]  2025-12-14 07:30:28,410 - calling_service - INFO - âš ï¸ No transition matched, but node has GOAL. Staying on current node to continue with goal-based guidance.
2025-12-14T07:30:28.411713123Z [err]  2025-12-14 07:30:28,410 - calling_service - INFO - ğŸ¯ Goal: Say the customer's name...
2025-12-14T07:30:28.411717181Z [err]  2025-12-14 07:30:28,410 - calling_service - INFO - â±ï¸ [TIMING] TRANSITION_EVAL: 779ms
2025-12-14T07:30:28.411724585Z [err]  2025-12-14 07:30:28,410 - calling_service - INFO - â±ï¸ [07:30:28.410] âœ… Node selected, about to process content...
2025-12-14T07:30:28.411728641Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - ğŸ”§ Replaced {{now}} with Sunday, December 14, 2025 at 2:30 AM EST in content
2025-12-14T07:30:28.411732637Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - ğŸ”§ Replaced {{customer_name}} with Kendrick in content
2025-12-14T07:30:28.411737432Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - ğŸ”§ Replaced {{callerName}} with  in content
2025-12-14T07:30:28.411741537Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - ğŸ”§ Replaced {{lead_id}} with None in content
2025-12-14T07:30:28.412136656Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - ğŸ”§ Replaced {{qc_tracking_enabled}} with False in content
2025-12-14T07:30:28.412144663Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - ğŸ”§ Replaced {{track_keywords}} with  in content
2025-12-14T07:30:28.412150435Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - ğŸ”§ Replaced {{expected_commitment}} with not_specified in content
2025-12-14T07:30:28.412156111Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - ğŸ”§ Replaced {{to_number}} with +17708336397 in content
2025-12-14T07:30:28.412161496Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - ğŸ”§ Replaced {{phone_number}} with +17708336397 in content
2025-12-14T07:30:28.412173067Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - ğŸ”§ Replaced {{email}} with None in content
2025-12-14T07:30:28.412178802Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - âœ… Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-14T07:30:28.412184533Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-14T07:30:28.412191154Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - ğŸ“š skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-14T07:30:28.412198063Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - â±ï¸ [07:30:28.411] ğŸ“„ About to process content (mode=script, length=9)
2025-12-14T07:30:28.412215108Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - ğŸ“¤ Streaming script as 1 sentence(s)
2025-12-14T07:30:28.412220107Z [err]  2025-12-14 07:30:28,411 - server - INFO - ğŸ“¤ Sentence arrived from LLM: Kendrick?...
2025-12-14T07:30:28.412223780Z [err]  2025-12-14 07:30:28,411 - server - INFO - â±ï¸ [TIMING] TTFS (Time To First Sentence): 871ms
2025-12-14T07:30:28.412227714Z [err]  2025-12-14 07:30:28,411 - server - INFO - âš¡ Starting REAL-TIME TTS for first sentence
2025-12-14T07:30:28.412827842Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - Total latency: 0.78s
2025-12-14T07:30:28.412834750Z [err]  2025-12-14 07:30:28,411 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:mF2I2rgHD5TphLrvn..., session=FOUND
2025-12-14T07:30:28.412837012Z [err]  2025-12-14 07:30:28,411 - server - INFO - âœ… LLM finished in 872ms, TTS tasks already running in background
2025-12-14T07:30:28.412842143Z [err]  2025-12-14 07:30:28,411 - server - INFO - ğŸš€ Streaming sentence #1 via persistent WebSocket
2025-12-14T07:30:28.412842796Z [err]  2025-12-14 07:30:28,411 - server - INFO - ğŸµ Streaming 1 TTS chunks as they complete...
2025-12-14T07:30:28.412848117Z [err]  2025-12-14 07:30:28,411 - server - INFO - ğŸš€ Persistent TTS: Audio already streaming in background!
2025-12-14T07:30:28.412848692Z [err]  2025-12-14 07:30:28,411 - server - INFO - ğŸµ TTS task #1 started at +0ms
2025-12-14T07:30:28.412854929Z [err]  2025-12-14 07:30:28,411 - server - INFO - â±ï¸ [TIMING] TTFT_TTS (First TTS Task Started): 872ms
2025-12-14T07:30:28.412855123Z [err]  2025-12-14 07:30:28,411 - server - INFO -    1 sentences queued and playing seamlessly
2025-12-14T07:30:28.412860513Z [err]  2025-12-14 07:30:28,411 - persistent_tts_service - INFO - ğŸ¤ [Call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g] Streaming sentence #4: Kendrick?...
2025-12-14T07:30:28.412860817Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - ğŸ“¤ Streamed script sentence 1/1: Kendrick?...
2025-12-14T07:30:28.412865286Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - ğŸ”Š Silence tracking reset for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g (user responded)
2025-12-14T07:30:28.412869644Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - âœ… User responded to regular message, resetting counter
2025-12-14T07:30:28.412873476Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - ğŸ’¾ Storing node ID 2 in conversation history
2025-12-14T07:30:28.412880598Z [err]  2025-12-14 07:30:28,411 - calling_service - INFO - LLM response (0.78s): Kendrick?
2025-12-14T07:30:28.413310071Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  [TIMING] LLM_TOTAL: 872ms (provider: grok, model: grok-4-fast-non-reasoning)
2025-12-14T07:30:28.413315164Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  [TIMING] TTS_TOTAL: 0ms (provider: elevenlabs, websocket: False)
2025-12-14T07:30:28.413319354Z [err]  2025-12-14 07:30:28,411 - elevenlabs_ws_service - ERROR - âŒ Error sending text to ElevenLabs: received 1008 (policy violation) A voice with voice_id kJKMPwrIKzwVkMKOfRtr does not exist.; then sent 1008 (policy violation) A voice with voice_id kJKMPwrIKzwVkMKOfRtr does not exist.
2025-12-14T07:30:28.413325116Z [err]  2025-12-14 07:30:28,411 - elevenlabs_ws_service - ERROR - âŒ WebSocket not connected
2025-12-14T07:30:28.413328805Z [err]  2025-12-14 07:30:28,411 - elevenlabs_ws_service - ERROR - âŒ WebSocket not connected
2025-12-14T07:30:28.413332322Z [err]  2025-12-14 07:30:28,412 - server - INFO - âœ… All 1 persistent TTS streams completed
2025-12-14T07:30:28.413336272Z [err]  2025-12-14 07:30:28,412 - server - INFO - âœ… Agent generation complete (persistent TTS) - response window closed
2025-12-14T07:30:28.413339822Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  FIRST AUDIO STARTED: 872ms from user stop ğŸš€
2025-12-14T07:30:28.413343364Z [err]  2025-12-14 07:30:28,412 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:28.413347000Z [err]  2025-12-14 07:30:28,412 - server - INFO - âœ… Agent generation complete - response window closed
2025-12-14T07:30:28.413350526Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-14T07:30:28.413354056Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-14T07:30:28.413357873Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  [TIMING] STT: 4ms (provider: soniox, model: stt-rt-v3)
2025-12-14T07:30:28.414031512Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  [TIMING] E2E_TOTAL: 872ms (user stopped â†’ play_audio_url called)
2025-12-14T07:30:28.414036516Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  [TIMING] âš ï¸ NOTE: E2E_TOTAL does not include:
2025-12-14T07:30:28.414040939Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-14T07:30:28.414042224Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-14T07:30:28.414045652Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-14T07:30:28.414049769Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-14T07:30:28.414053501Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-14T07:30:28.414057415Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  [TIMING]   - REAL USER LATENCY: 1172ms estimated
2025-12-14T07:30:28.414061331Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  [TIMING] RESPONSE_TEXT: 9 chars, 1 sentences
2025-12-14T07:30:28.414065059Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  [TIMING] USER_INPUT: 'Hello?...'
2025-12-14T07:30:28.414068682Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  [TIMING] AI_RESPONSE: 'Kendrick?...'
2025-12-14T07:30:28.414073065Z [err]  2025-12-14 07:30:28,412 - server - INFO - â±ï¸  [TIMING] ==========================
2025-12-14T07:30:28.777546937Z [err]  2025-12-14 07:30:28,599 - server - INFO - ğŸ“ Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 876ms)
2025-12-14T07:30:28.777558492Z [err]  2025-12-14 07:30:28,599 - server - INFO - ğŸ”Š Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-14T07:30:30.040360942Z [err]  2025-12-14 07:30:30,039 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-14T07:30:30.573598482Z [err]  2025-12-14 07:30:30,550 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-14T07:30:30.880246054Z [err]  2025-12-14 07:30:30,875 - server - INFO - ğŸ“¤ Audio flowing: 2057 packets sent to Soniox (5s update)
2025-12-14T07:30:32.921610321Z [err]  2025-12-14 07:30:32,873 - server - INFO - ğŸ¤ Soniox receiver alive - 12 messages received in last 10s
2025-12-14T07:30:35.967537453Z [err]  2025-12-14 07:30:35,875 - server - INFO - ğŸ“¤ Audio flowing: 2307 packets sent to Soniox (5s update)
2025-12-14T07:30:40.293287464Z [err]  2025-12-14 07:30:40,264 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-14T07:30:40.806106733Z [err]  2025-12-14 07:30:40,775 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-14T07:30:40.879023172Z [err]  2025-12-14 07:30:40,878 - server - INFO - ğŸ“¤ Audio flowing: 2557 packets sent to Soniox (5s update)
2025-12-14T07:30:43.757642817Z [err]  2025-12-14 07:30:43,723 - server - INFO - ğŸ¤ Soniox receiver alive - 10 messages received in last 10s
2025-12-14T07:30:45.888762658Z [err]  2025-12-14 07:30:45,883 - server - INFO - ğŸ“¤ Audio flowing: 2807 packets sent to Soniox (5s update)
2025-12-14T07:30:49.487061721Z [err]  2025-12-14 07:30:49,454 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:30:49.487065414Z [err]  2025-12-14 07:30:49,454 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.hangup', 'id': '3945a878-9082-4877-88c0-b67417624df9', 'occurred_at': '2025-12-14T07:30:49.223916Z', 'payload': {'call_control_id': 'v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g', 'call_leg_id': 'a90889b8-d8be-11f0-9670-02420aef93a1', 'call_quality_stats': {'inbound': {'jitter_max_variance': '0.37', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '3031', 'skip_packet_count': '14'}, 'outbound': {'packet_count': '2979', 'skip_packet_count': '0'}}, 'call_session_id': 'a904f3e8-d8be-11f0-8e3d-02420aef93a1', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-14T07:30:49.223916Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-14T07:29:44.103936Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:30:49.487070080Z [err]  2025-12-14 07:30:49,454 - server - INFO - ğŸ¯ Event type: call.hangup, Call ID: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:49.487073910Z [err]  2025-12-14 07:30:49,454 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:30:49.487078092Z [err]  2025-12-14 07:30:49,454 - server - INFO - ğŸ“ Call ended: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:49.487081632Z [err]  2025-12-14 07:30:49,454 - server - INFO - ğŸ“ Hangup cause: normal_clearing
2025-12-14T07:30:49.487085250Z [err]  [2025-12-14 07:30:49 +0000] [6] [INFO] connection closed
2025-12-14T07:30:49.487090643Z [err]  2025-12-14 07:30:49,455 - server - INFO - ğŸ“ Telnyx WebSocket disconnected. Sent 2977 total packets
2025-12-14T07:30:49.639302471Z [err]  2025-12-14 07:30:49,632 - server - INFO - ğŸ“ Updated call log: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:49.726897928Z [err]  2025-12-14 07:30:49,722 - server - INFO - âœ… Finalized call log: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g (duration=59s, status=completed)
2025-12-14T07:30:49.726906820Z [err]  2025-12-14 07:30:49,725 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:30:49.726913054Z [err]  2025-12-14 07:30:49,725 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'streaming.stopped', 'id': 'd78b29c0-7fad-4df7-a1c5-c9ae457f75fa', 'occurred_at': '2025-12-14T07:30:49.382988Z', 'payload': {'call_control_id': 'v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g', 'call_leg_id': 'a90889b8-d8be-11f0-9670-02420aef93a1', 'call_session_id': 'a904f3e8-d8be-11f0-8e3d-02420aef93a1', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '5b717ac7-493f-4298-87bb-591bca32a9fb', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:30:49.726928123Z [err]  2025-12-14 07:30:49,725 - server - INFO - ğŸ¯ Event type: streaming.stopped, Call ID: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:49.726934345Z [err]  2025-12-14 07:30:49,725 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:30:49.726941718Z [inf]  100.64.0.6:43380 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:30:49.819828856Z [err]  2025-12-14 07:30:49,812 - server - INFO - ğŸ“¦ Saved 11 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-14T07:30:49.908314574Z [err]  2025-12-14 07:30:49,904 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:30:49.908322774Z [err]  2025-12-14 07:30:49,904 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'ebfb0e27-07d5-4ce3-8237-60c9e1d4f883', 'occurred_at': '2025-12-14T07:30:49.323918Z', 'payload': {'call_control_id': 'v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g', 'call_leg_id': 'a90889b8-d8be-11f0-9670-02420aef93a1', 'call_session_id': 'a904f3e8-d8be-11f0-8e3d-02420aef93a1', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-14T07:30:49.323918Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': '17fhe-zlag', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:30:49.908328093Z [err]  2025-12-14 07:30:49,904 - server - INFO - ğŸ¯ Event type: call.playback.ended, Call ID: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:49.908332529Z [err]  2025-12-14 07:30:49,904 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:30:50.051838229Z [err]  2025-12-14 07:30:49,914 - redis_service - INFO - â– Removed playback 17fhe-zlag, 0 remaining for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:50.051843566Z [err]  2025-12-14 07:30:49,915 - server - INFO - ğŸ”Š Redis: Removed playback 17fhe-zlag, 0 remaining
2025-12-14T07:30:50.051848071Z [err]  2025-12-14 07:30:49,915 - server - INFO - ğŸ”Š ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-14T07:30:50.051852375Z [err]  2025-12-14 07:30:49,915 - server - INFO - â±ï¸ CLEARED playback_expected_end_time - agent is definitely done speaking
2025-12-14T07:30:50.051856329Z [err]  2025-12-14 07:30:49,920 - server - INFO - âœ… Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-14T07:30:50.051861123Z [err]  2025-12-14 07:30:49,920 - server - INFO - âœ… Found session locally: agent_speaking=True, user_speaking=False
2025-12-14T07:30:50.051865779Z [err]  2025-12-14 07:30:49,920 - calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1765697449.9201875 for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:50.051871188Z [err]  2025-12-14 07:30:49,920 - calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:50.051875107Z [err]  2025-12-14 07:30:49,920 - server - INFO - â±ï¸ Agent done speaking, silence timer STARTED (local)
2025-12-14T07:30:50.051879003Z [inf]  100.64.0.8:56400 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:30:50.467129221Z [err]  2025-12-14 07:30:50,465 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=0.5s, checkin_count=0/2
2025-12-14T07:30:50.541247179Z [err]  2025-12-14 07:30:50,512 - server - INFO - ğŸ“Š Auto-added call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-14T07:30:50.705198116Z [err]  2025-12-14 07:30:50,700 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:50.705205951Z [err]  2025-12-14 07:30:50,700 - server - INFO - ğŸ“‡ [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-14T07:30:50.705212100Z [err]  2025-12-14 07:30:50,700 - server - INFO - ğŸ“‡ [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-14T07:30:50.823309309Z [err]  2025-12-14 07:30:50,789 - server - INFO - ğŸ“‡ [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-14T07:30:50.895794718Z [err]  2025-12-14 07:30:50,882 - server - INFO - ğŸ§¹ Cleaned up call session from Redis and memory: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:50.895801332Z [inf]  100.64.0.7:15104 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:30:50.895805788Z [err]  2025-12-14 07:30:50,882 - server - INFO - ğŸ” Starting QC analysis for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:50.895810509Z [err]  2025-12-14 07:30:50,882 - server - INFO - ğŸ” [AUTO-QC] Starting campaign QC check for call=v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-14T07:30:50.895844208Z [err]  2025-12-14 07:30:50,876 - server - INFO - ğŸ“‡ [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-14T07:30:50.895850401Z [err]  2025-12-14 07:30:50,876 - server - INFO - ğŸ“‡ [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-14T07:30:50.895856724Z [err]  2025-12-14 07:30:50,876 - server - INFO - ğŸ“‡ [HANGUP] Agent info keys: None
2025-12-14T07:30:50.895863004Z [err]  2025-12-14 07:30:50,876 - server - INFO - ğŸš€ Triggered QC analysis for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:50.895868977Z [err]  2025-12-14 07:30:50,876 - server - INFO - ğŸ“Š Triggered Campaign QC for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:50.895876370Z [err]  2025-12-14 07:30:50,876 - server - INFO - ğŸ“‡ Triggered CRM update for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:50.895882945Z [err]  2025-12-14 07:30:50,877 - server - INFO - âœ… Closed persistent TTS session for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:50.895889422Z [err]  2025-12-14 07:30:50,882 - redis_service - INFO - ğŸ§¹ Deleted call data from Redis: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:50.896044435Z [err]  2025-12-14 07:30:50,882 - server - INFO - ğŸ“‡ CRM update starting for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:30:50.896051508Z [err]  2025-12-14 07:30:50,882 - server - INFO - ğŸ“‡ Normalized phone: +17708336397
2025-12-14T07:30:50.896056850Z [err]  2025-12-14 07:30:50,882 - server - INFO - ğŸ“‡ CRM: Got 11 variables from active session
2025-12-14T07:30:51.069065239Z [err]  2025-12-14 07:30:50,971 - server - INFO - ğŸ“ Converted transcript from 8 messages to 147 characters
2025-12-14T07:30:51.069071805Z [err]  2025-12-14 07:30:50,971 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=1.1s, checkin_count=0/2
2025-12-14T07:30:51.069078431Z [err]  2025-12-14 07:30:50,971 - server - INFO - ğŸ” [AUTO-QC] Call log found: transcript_turns=8, logs_count=10, status=completed
2025-12-14T07:30:51.069086978Z [err]  2025-12-14 07:30:50,972 - server - INFO - ğŸ“‡ CRM: Got 11 extracted variables
2025-12-14T07:30:51.069094467Z [err]  2025-12-14 07:30:50,972 - server - INFO - ğŸ“‡ CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-14T07:30:51.069101562Z [err]  2025-12-14 07:30:51,058 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:30:51.069107244Z [err]  2025-12-14 07:30:51,061 - server - INFO - ğŸ” [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-14T07:30:51.157162881Z [err]  2025-12-14 07:30:51,148 - server - INFO - ğŸ“Š [AUTO-QC] Running full QC analysis: call=v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g â†’ campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-14T07:30:51.157170857Z [err]  2025-12-14 07:30:51,148 - server - INFO - ğŸ“Š [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-14T07:30:51.157178820Z [err]  2025-12-14 07:30:51,149 - server - ERROR - âŒ [AUTO-QC] Error in campaign QC for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-14T07:30:51.157186750Z [err]  2025-12-14 07:30:51,149 - server - ERROR - âŒ [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-14T07:30:51.157194350Z [err]    File "/app/backend/server.py", line 9475, in trigger_campaign_qc_for_call
2025-12-14T07:30:51.157202723Z [err]      await run_full_qc_analysis(
2025-12-14T07:30:51.157210146Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-14T07:30:51.157215757Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-14T07:30:51.157221453Z [err]  
2025-12-14T07:30:51.157228214Z [err]  2025-12-14 07:30:51,149 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-14T07:30:51.157233452Z [err]  2025-12-14 07:30:51,152 - server - INFO - ğŸ“‡ CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-14T07:30:51.240303052Z [err]  2025-12-14 07:30:51,236 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-14T07:30:51.240309220Z [err]  2025-12-14 07:30:51,237 - qc_agents.orchestrator - INFO - âœ… Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:30:51.240313685Z [err]  2025-12-14 07:30:51,237 - qc_agents.orchestrator - INFO - ğŸ” Running Commitment Detector on call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:52.599558971Z [err]  2025-12-14 07:30:52,597 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:30:52.599564987Z [err]  2025-12-14 07:30:52,598 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '2c8c84f1-5b30-4878-9fc3-0d83a3b753ba', 'occurred_at': '2025-12-14T07:30:52.503570Z', 'payload': {'call_control_id': 'v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g', 'call_leg_id': 'a90889b8-d8be-11f0-9670-02420aef93a1', 'call_session_id': 'a904f3e8-d8be-11f0-8e3d-02420aef93a1', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-14T07:30:49.337013Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-14T07:30:49.337013Z', 'recording_id': 'bb77fe86-cd86-4200-b103-e11d87d67d83', 'recording_started_at': '2025-12-14T07:29:50.767659Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-14/a90889b8-d8be-11f0-9670-02420aef93a1-1765697390702843.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251214%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251214T073052Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=5f1bfbf1a244df12bda0891f97b44072777aeb9faedff62aed4582e040375b86'}, 'start_time': '2025-12-14T07:29:50.767659Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:30:52.599570652Z [err]  2025-12-14 07:30:52,598 - server - INFO - ğŸ¯ Event type: call.recording.saved, Call ID: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:52.599576242Z [err]  2025-12-14 07:30:52,598 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:30:52.599581429Z [err]  2025-12-14 07:30:52,598 - server - INFO - ğŸ™ï¸ Recording saved for call: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:52.603990146Z [err]  2025-12-14 07:30:52,603 - redis_service - WARNING - âš ï¸ Call data not found in Redis: v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:52.603996295Z [err]  2025-12-14 07:30:52,603 - server - INFO - ğŸ” Recording check: download_url=True, channels=dual, recording_id=bb77fe86-cd86-4200-b103-e11d87d67d83, call_data=False
2025-12-14T07:30:52.717094306Z [err]  2025-12-14 07:30:52,694 - server - INFO - ğŸ’¾ Saved recording URL and ID to database: bb77fe86-cd86-4200-b103-e11d87d67d83
2025-12-14T07:30:52.717100519Z [err]  2025-12-14 07:30:52,694 - server - INFO - âœ… Entering dual-channel processing
2025-12-14T07:30:52.717107454Z [err]  2025-12-14 07:30:52,694 - server - INFO - ğŸ“¥ Downloading DUAL-CHANNEL recording...
2025-12-14T07:30:53.096388939Z [err]  2025-12-14 07:30:52,999 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-14/a90889b8-d8be-11f0-9670-02420aef93a1-1765697390702843.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251214%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251214T073052Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=5f1bfbf1a244df12bda0891f97b44072777aeb9faedff62aed4582e040375b86 "HTTP/1.1 200 OK"
2025-12-14T07:30:53.274369175Z [err]  2025-12-14 07:30:53,261 - server - INFO - âœ… Downloaded 234518 bytes
2025-12-14T07:30:53.660412888Z [err]  2025-12-14 07:30:53,656 - server - INFO - âœ… Split into 2 channels
2025-12-14T07:30:53.660422178Z [err]  2025-12-14 07:30:53,656 - server - INFO - ğŸ¤ Using STT provider: soniox for interruption detection
2025-12-14T07:30:53.660428474Z [err]  2025-12-14 07:30:53,657 - server - INFO - ğŸ“Š Channel 0: 1288364 bytes
2025-12-14T07:30:53.660434729Z [err]  2025-12-14 07:30:53,657 - server - ERROR - âŒ No Soniox API key available
2025-12-14T07:30:53.660440796Z [err]  2025-12-14 07:30:53,657 - server - INFO - âŒ Channel 0: No speech
2025-12-14T07:30:53.660447532Z [err]  2025-12-14 07:30:53,657 - server - INFO - ğŸ“Š Channel 1: 1288364 bytes
2025-12-14T07:30:53.660453876Z [err]  2025-12-14 07:30:53,657 - server - ERROR - âŒ No Soniox API key available
2025-12-14T07:30:53.660461603Z [err]  2025-12-14 07:30:53,657 - server - INFO - âŒ Channel 1: No speech
2025-12-14T07:30:53.660467350Z [err]  2025-12-14 07:30:53,657 - server - WARNING - âš ï¸ No speech in any channel
2025-12-14T07:30:53.660473240Z [inf]  100.64.0.7:15104 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:30:56.108882183Z [err]  2025-12-14 07:30:56,040 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-14T07:30:56.108890376Z [err]  2025-12-14 07:30:56,043 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-14T07:30:56.108898392Z [err]  2025-12-14 07:30:56,043 - qc_agents.orchestrator - INFO - ğŸ—ºï¸  Running Conversion Pathfinder on call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:57.122135393Z [err]  2025-12-14 07:30:57,041 - dead_air_monitor - INFO - ğŸ’¬ Sending check-in after 7.1s silence: Are you still there?
2025-12-14T07:30:57.122147718Z [err]  2025-12-14 07:30:57,042 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-14T07:30:57.122151899Z [err]  2025-12-14 07:30:57,041 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:57.122165178Z [err]  2025-12-14 07:30:57,041 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g: Are you still there?...
2025-12-14T07:30:57.122176767Z [err]  2025-12-14 07:30:57,041 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-14T07:30:57.122188051Z [err]  2025-12-14 07:30:57,041 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-14T07:30:57.122197796Z [err]  2025-12-14 07:30:57,041 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-14T07:30:57.122205376Z [err]  2025-12-14 07:30:57,041 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-14T07:30:57.122213658Z [err]  2025-12-14 07:30:57,041 - server - INFO - ğŸ’¾ TTS CACHE HIT: Returning cached audio (15509 bytes)
2025-12-14T07:30:57.122219773Z [err]  2025-12-14 07:30:57,042 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.00s
2025-12-14T07:30:57.122226851Z [err]  2025-12-14 07:30:57,042 - telnyx_service - INFO - âœ… Generated 15509 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-14T07:30:57.122268406Z [err]  2025-12-14 07:30:57,035 - calling_service - INFO - â° Check-in triggered after 7.1s silence (threshold: 7s)
2025-12-14T07:30:57.122274376Z [err]  2025-12-14 07:30:57,041 - calling_service - INFO - ğŸ’¬ Sending check-in #1/2: Are you still there?
2025-12-14T07:30:57.337688337Z [err]  2025-12-14 07:30:57,335 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-14T07:30:57.337695698Z [err]  2025-12-14 07:30:57,336 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.29s
2025-12-14T07:30:57.337702193Z [err]  2025-12-14 07:30:57,336 - telnyx_service - ERROR - âŒ Telnyx playback failed: 422 - {
2025-12-14T07:30:57.337706622Z [err]    "errors": [
2025-12-14T07:30:57.337710973Z [err]      {
2025-12-14T07:30:57.337716023Z [err]        "code": "90018",
2025-12-14T07:30:57.337720057Z [err]        "title": "Call has already ended",
2025-12-14T07:30:57.337724505Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-14T07:30:57.337728473Z [err]      }
2025-12-14T07:30:57.337733927Z [err]    ]
2025-12-14T07:30:57.337737922Z [err]  }
2025-12-14T07:30:57.337741747Z [err]  2025-12-14 07:30:57,336 - telnyx_service - INFO - ğŸ“¢ Using Telnyx built-in TTS
2025-12-14T07:30:57.564064986Z [err]  2025-12-14 07:30:57,545 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-14T07:30:57.564072820Z [err]  2025-12-14 07:30:57,546 - telnyx_service - ERROR - âŒ Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-14T07:30:57.564079800Z [err]  2025-12-14 07:30:57,546 - dead_air_monitor - INFO - âœ… Check-in message sent
2025-12-14T07:30:58.123821965Z [err]  2025-12-14 07:30:58,053 - dead_air_monitor - INFO - ğŸš© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-14T07:30:58.123829927Z [err]  2025-12-14 07:30:58,053 - calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1765697458.0534918 for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:58.123837678Z [err]  2025-12-14 07:30:58,053 - calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:30:59.199187224Z [err]  2025-12-14 07:30:59,194 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-14T07:30:59.199195276Z [err]  2025-12-14 07:30:59,197 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-14T07:30:59.199200615Z [err]  2025-12-14 07:30:59,198 - qc_agents.orchestrator - INFO - â­ Running Excellence Replicator on call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:31:00.136245693Z [err]  2025-12-14 07:31:00,080 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=2.0s, checkin_count=1/2
2025-12-14T07:31:00.589979813Z [err]  2025-12-14 07:31:00,586 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=2.5s, checkin_count=1/2
2025-12-14T07:31:02.650897939Z [err]  2025-12-14 07:31:02,627 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-14T07:31:02.650903081Z [err]  2025-12-14 07:31:02,631 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Expecting value: line 1 column 1 (char 0)
2025-12-14T07:31:02.728172435Z [err]  2025-12-14 07:31:02,724 - qc_agents.orchestrator - INFO - âœ… QC analysis stored for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:31:02.728182577Z [err]  2025-12-14 07:31:02,724 - server - INFO - âœ… QC analysis completed for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:31:02.728191030Z [err]  2025-12-14 07:31:02,724 - server - INFO - ğŸ“Š Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-14T07:31:02.916264504Z [err]  2025-12-14 07:31:02,901 - server - INFO - ğŸ“Š Updated campaign_calls with QC scores for v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:31:03.168156214Z [err]  2025-12-14 07:31:03,077 - server - INFO - ğŸ“ˆ Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-14T07:31:03.168162786Z [err]  2025-12-14 07:31:03,165 - server - INFO - ğŸ·ï¸ Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-14T07:31:03.168169331Z [err]  2025-12-14 07:31:03,165 - server - ERROR - âŒ Error in auto appointment detection for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g: 'str' object has no attribute 'get'
2025-12-14T07:31:04.594173034Z [inf]  100.64.0.13:29654 - "GET /api/agents HTTP/1.1" 200
2025-12-14T07:31:05.192548481Z [err]  2025-12-14 07:31:05,146 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.00s
2025-12-14T07:31:05.192561687Z [err]  2025-12-14 07:31:05,146 - telnyx_service - INFO - âœ… Generated 15509 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-14T07:31:05.192568841Z [err]  2025-12-14 07:31:05,146 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-14T07:31:05.192611679Z [err]  2025-12-14 07:31:05,140 - calling_service - INFO - â° Check-in triggered after 7.1s silence (threshold: 7s)
2025-12-14T07:31:05.192618152Z [err]  2025-12-14 07:31:05,145 - calling_service - INFO - ğŸ’¬ Sending FINAL check-in #2/2: Are you still there?
2025-12-14T07:31:05.192624285Z [err]  2025-12-14 07:31:05,146 - calling_service - INFO - âš ï¸ Will end call if no response after next silence timeout
2025-12-14T07:31:05.192631583Z [err]  2025-12-14 07:31:05,146 - dead_air_monitor - INFO - ğŸ’¬ Sending check-in after 7.1s silence: Are you still there?
2025-12-14T07:31:05.192637759Z [err]  2025-12-14 07:31:05,146 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:31:05.192643652Z [err]  2025-12-14 07:31:05,146 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g: Are you still there?...
2025-12-14T07:31:05.192650909Z [err]  2025-12-14 07:31:05,146 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-14T07:31:05.192657001Z [err]  2025-12-14 07:31:05,146 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-14T07:31:05.192662823Z [err]  2025-12-14 07:31:05,146 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-14T07:31:05.192668456Z [err]  2025-12-14 07:31:05,146 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-14T07:31:05.192673689Z [err]  2025-12-14 07:31:05,146 - server - INFO - ğŸ’¾ TTS CACHE HIT: Returning cached audio (15509 bytes)
2025-12-14T07:31:05.439455758Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-14T07:31:05.439465789Z [err]      }
2025-12-14T07:31:05.439473868Z [err]    ]
2025-12-14T07:31:05.439480586Z [err]  }
2025-12-14T07:31:05.439485841Z [err]  2025-12-14 07:31:05,435 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-14T07:31:05.439488778Z [err]  2025-12-14 07:31:05,436 - telnyx_service - INFO - ğŸ“¢ Using Telnyx built-in TTS
2025-12-14T07:31:05.439493109Z [err]  2025-12-14 07:31:05,436 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.29s
2025-12-14T07:31:05.439498798Z [err]  2025-12-14 07:31:05,436 - telnyx_service - ERROR - âŒ Telnyx playback failed: 422 - {
2025-12-14T07:31:05.439504089Z [err]    "errors": [
2025-12-14T07:31:05.439511053Z [err]      {
2025-12-14T07:31:05.439516717Z [err]        "code": "90018",
2025-12-14T07:31:05.439522213Z [err]        "title": "Call has already ended",
2025-12-14T07:31:05.712540110Z [err]  2025-12-14 07:31:05,700 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-14T07:31:05.712544870Z [err]  2025-12-14 07:31:05,700 - telnyx_service - ERROR - âŒ Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-14T07:31:05.712549869Z [err]  2025-12-14 07:31:05,700 - dead_air_monitor - INFO - âœ… Check-in message sent
2025-12-14T07:31:08.714466316Z [inf]  100.64.0.13:29654 - "GET /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb HTTP/1.1" 200
2025-12-14T07:31:08.944272982Z [inf]  100.64.0.13:29658 - "GET /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/kb HTTP/1.1" 200
2025-12-14T07:31:09.325102698Z [inf]  100.64.0.13:29658 - "GET /api/qc/enhanced/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/auto-qc-settings HTTP/1.1" 200
2025-12-14T07:31:09.511975860Z [err]  2025-12-14 07:31:09,484 - qc_enhanced_router - INFO - Listed 1 campaigns for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:31:09.511986948Z [inf]  100.64.0.13:29654 - "GET /api/qc/enhanced/campaigns HTTP/1.1" 200
2025-12-14T07:31:09.511992336Z [err]  2025-12-14 07:31:09,510 - server - INFO - ğŸ¤ Soniox receiver alive - 6 messages received in last 10s
2025-12-14T07:31:09.511996687Z [err]  2025-12-14 07:31:09,510 - server - ERROR - âŒ Soniox error: {'tokens': [], 'final_audio_proc_ms': 53760, 'total_audio_proc_ms': 59040, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-14T07:31:09.512000645Z [err]  2025-12-14 07:31:09,510 - server - INFO - âœ… Soniox receive loop ended normally
2025-12-14T07:31:09.512004819Z [err]  2025-12-14 07:31:09,510 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring cancelled for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:31:09.512008799Z [err]  2025-12-14 07:31:09,510 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring stopped for call v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g
2025-12-14T07:31:09.512012533Z [err]  2025-12-14 07:31:09,510 - server - INFO - ğŸ”‡ Dead air monitoring task cancelled
2025-12-14T07:31:10.515043514Z [err]  2025-12-14 07:31:10,514 - soniox_service - ERROR - âŒ Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-14T07:31:10.515051131Z [err]  2025-12-14 07:31:10,514 - server - INFO - ğŸ”Œ Telnyx WebSocket disconnected
2025-12-14T07:31:50.544737896Z [inf]  100.64.0.4:40610 - "PUT /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb HTTP/1.1" 200
2025-12-14T07:31:50.544744021Z [err]  2025-12-14 07:31:45,196 - qc_enhanced_router - INFO - Listed 1 campaigns for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:31:50.544750410Z [inf]  100.64.0.4:40610 - "GET /api/qc/enhanced/campaigns HTTP/1.1" 200
2025-12-14T07:31:50.544754461Z [inf]  100.64.0.4:40650 - "GET /api/qc/enhanced/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/auto-qc-settings HTTP/1.1" 200
2025-12-14T07:31:50.544758336Z [inf]  100.64.0.4:40652 - "GET /api/agents HTTP/1.1" 200
2025-12-14T07:31:52.613072392Z [err]  2025-12-14 07:31:52,604 - server - INFO - ğŸŒ Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-14T07:31:52.708395147Z [err]  2025-12-14 07:31:52,691 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:31:52.847205013Z [err]  2025-12-14 07:31:52,779 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:31:52.847213780Z [err]  2025-12-14 07:31:52,813 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-14T07:31:52.847220295Z [err]  2025-12-14 07:31:52,813 - telnyx_service - INFO - ğŸ“ Initiating outbound call from +14048000152 to +17708336397
2025-12-14T07:31:52.847227770Z [err]  2025-12-14 07:31:52,813 - telnyx_service - INFO - ğŸ¤– Enabling AMD (premium mode)
2025-12-14T07:31:52.847234119Z [err]  2025-12-14 07:31:52,813 - telnyx_service - INFO - ğŸŒ Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-14T07:31:53.610979257Z [err]  2025-12-14 07:31:53,600 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:31:53.610990947Z [err]  2025-12-14 07:31:53,600 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.initiated', 'id': '570b322e-0e43-4ad2-8279-812c54c58d11', 'occurred_at': '2025-12-14T07:31:53.499943Z', 'payload': {'call_control_id': 'v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ', 'call_leg_id': 'f630d556-d8be-11f0-8284-02420aef9920', 'call_session_id': 'f62e53b2-d8be-11f0-b219-02420aef9920', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:31:53.610998927Z [err]  2025-12-14 07:31:53,600 - server - INFO - ğŸ¯ Event type: call.initiated, Call ID: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:53.611005846Z [err]  2025-12-14 07:31:53,600 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:31:53.611012867Z [err]  2025-12-14 07:31:53,600 - server - INFO - ğŸ“ Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-14T07:31:53.611019765Z [inf]  100.64.0.7:15104 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:31:53.611026747Z [err]  2025-12-14 07:31:53,602 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-14T07:31:53.611033124Z [err]  2025-12-14 07:31:53,602 - telnyx_service - INFO - âœ… Call initiated: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:53.708227770Z [err]  2025-12-14 07:31:53,692 - server - INFO - ğŸ“ Created call log: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:53.728577903Z [err]  2025-12-14 07:31:53,724 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ (TTL: 3600s)
2025-12-14T07:31:53.728585666Z [err]  2025-12-14 07:31:53,725 - server - INFO - ğŸ“¦ Call data stored in Redis and memory
2025-12-14T07:31:53.728591712Z [err]  2025-12-14 07:31:53,725 - server - INFO - ğŸ“ Outbound call initiated: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:53.728597278Z [inf]  100.64.0.12:41150 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-14T07:31:53.906772330Z [err]  2025-12-14 07:31:53,901 - server - INFO - ğŸ”ŒğŸ”ŒğŸ”Œ WEBSOCKET CONNECTION ATTEMPT
2025-12-14T07:31:53.906782104Z [err]  2025-12-14 07:31:53,901 - server - INFO -    Client: Address(host='100.64.0.8', port=51094)
2025-12-14T07:31:53.906786225Z [err]  2025-12-14 07:31:53,901 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'PEg+GJgM61fG5ZqZFetb5w==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'OEtJZyVaTdK0HY32-_9nXA', 'x-real-ip': '192.76.120.151', 'x-request-start': '1765697513672', 'accept-encoding': 'gzip'}
2025-12-14T07:31:53.906790125Z [err]  2025-12-14 07:31:53,902 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-14T07:31:53.906795544Z [err]  2025-12-14 07:31:53,902 - server - INFO - ğŸ”Œ Incoming Telnyx WebSocket connection
2025-12-14T07:31:53.906799633Z [err]  [2025-12-14 07:31:53 +0000] [6] [INFO] ('100.64.0.8', 51094) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-14T07:31:53.906803208Z [err]  2025-12-14 07:31:53,902 - server - INFO - âœ… WebSocket accepted, waiting for Telnyx events
2025-12-14T07:31:53.906806645Z [err]  [2025-12-14 07:31:53 +0000] [6] [INFO] connection open
2025-12-14T07:31:54.059741632Z [err]  2025-12-14 07:31:54,058 - server - INFO - ğŸ“¬ Received Telnyx event: connected
2025-12-14T07:31:54.059747618Z [err]  2025-12-14 07:31:54,059 - server - INFO - ğŸ“ Telnyx connected event received, waiting for 'start'...
2025-12-14T07:31:58.109495420Z [err]  2025-12-14 07:31:58,103 - server - INFO - ğŸ“¬ Received Telnyx event: start
2025-12-14T07:31:58.109503259Z [err]  2025-12-14 07:31:58,103 - server - INFO - ğŸ¬ Stream started for call: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:58.129909749Z [err]  2025-12-14 07:31:58,129 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:58.134257977Z [err]  2025-12-14 07:31:58,131 - server - INFO - âœ… Call data found after 0s wait
2025-12-14T07:31:58.134264469Z [err]  2025-12-14 07:31:58,131 - server - INFO - â³ Session not found locally, waiting briefly for webhook...
2025-12-14T07:31:58.345875367Z [err]  2025-12-14 07:31:58,340 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:31:58.345881693Z [err]  2025-12-14 07:31:58,340 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.answered', 'id': '0d87cd3d-b59b-43c0-85a3-908f12781077', 'occurred_at': '2025-12-14T07:31:57.899950Z', 'payload': {'call_control_id': 'v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ', 'call_leg_id': 'f630d556-d8be-11f0-8284-02420aef9920', 'call_session_id': 'f62e53b2-d8be-11f0-b219-02420aef9920', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-14T07:31:53.499943Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:31:58.345885948Z [err]  2025-12-14 07:31:58,340 - server - INFO - ğŸ¯ Event type: call.answered, Call ID: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:58.345890538Z [err]  2025-12-14 07:31:58,340 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:31:58.345895125Z [err]  2025-12-14 07:31:58,340 - server - INFO - âœ… Call answered: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:58.383964767Z [err]  2025-12-14 07:31:58,371 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:58.383971168Z [err]  2025-12-14 07:31:58,371 - server - INFO - âœ… Found call in Redis (multi-worker state sharing working)
2025-12-14T07:31:58.383976581Z [err]  2025-12-14 07:31:58,372 - server - INFO - ğŸ“ Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-14T07:31:58.493582870Z [err]  2025-12-14 07:31:58,466 - server - INFO - âœ… Call log updated
2025-12-14T07:31:58.493591313Z [err]  2025-12-14 07:31:58,466 - server - INFO - ğŸ”§ Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:31:58.493597519Z [err]  2025-12-14 07:31:58,481 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:31:58.493602319Z [err]  2025-12-14 07:31:58,481 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'streaming.started', 'id': '31d3ef2c-e9d6-44ee-ac43-52de790b1378', 'occurred_at': '2025-12-14T07:31:58.259953Z', 'payload': {'call_control_id': 'v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ', 'call_leg_id': 'f630d556-d8be-11f0-8284-02420aef9920', 'call_session_id': 'f62e53b2-d8be-11f0-b219-02420aef9920', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': 'b7e89748-656f-48ba-b33e-fc3bf9734acc', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:31:58.493633237Z [err]  2025-12-14 07:31:58,481 - server - INFO - ğŸ¯ Event type: streaming.started, Call ID: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:58.493639587Z [err]  2025-12-14 07:31:58,481 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:31:58.493644187Z [inf]  100.64.0.8:56400 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:31:58.564891031Z [err]  2025-12-14 07:31:58,554 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:31:58.646558179Z [err]  2025-12-14 07:31:58,631 - server - INFO - âš ï¸ Session still not found after wait, will create in worker
2025-12-14T07:31:58.646563446Z [err]  2025-12-14 07:31:58,631 - server - WARNING - âš ï¸ Session not found after waiting, creating in WebSocket worker...
2025-12-14T07:31:58.646568486Z [err]  2025-12-14 07:31:58,641 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:31:58.646572672Z [err]  2025-12-14 07:31:58,641 - server - INFO - ğŸ”§ Creating Telnyx service with user's keys...
2025-12-14T07:31:58.650914370Z [err]  2025-12-14 07:31:58,647 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:58.650920287Z [err]  2025-12-14 07:31:58,648 - server - INFO - ğŸ“ Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:31:58.650924568Z [err]  2025-12-14 07:31:58,648 - calling_service - INFO - ğŸ” Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-14T07:31:58.660931766Z [err]  2025-12-14 07:31:58,660 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-14T07:31:58.752520661Z [err]  2025-12-14 07:31:58,736 - calling_service - INFO - ğŸ” KB count query completed: 4 items
2025-12-14T07:31:58.752527274Z [err]  2025-12-14 07:31:58,736 - calling_service - INFO - ğŸ“š Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-14T07:31:58.752531888Z [err]  2025-12-14 07:31:58,736 - calling_service - INFO - ğŸ“‹ Built cached system prompt: 4159 chars (global) + 866 chars (technical)
2025-12-14T07:31:58.752536450Z [err]  2025-12-14 07:31:58,736 - calling_service - INFO - ğŸ“š KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-14T07:31:58.752540227Z [err]  2025-12-14 07:31:58,736 - calling_service - INFO - ğŸ”¥ Pre-warming LLM client (grok)...
2025-12-14T07:31:58.830298974Z [err]  2025-12-14 07:31:58,823 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:31:58.833974727Z [err]  2025-12-14 07:31:58,832 - calling_service - INFO - âœ… LLM client pre-warmed in 95ms
2025-12-14T07:31:58.833981448Z [err]  2025-12-14 07:31:58,832 - server - INFO - âœ… Session created in WebSocket worker
2025-12-14T07:31:58.833986282Z [err]  2025-12-14 07:31:58,832 - server - INFO - ğŸ“ Call data loaded, starting SONIOX connection...
2025-12-14T07:31:58.833990263Z [err]  2025-12-14 07:31:58,832 - server - INFO - âœ… Initialized call_states for v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ with session reference
2025-12-14T07:31:58.833994347Z [err]  2025-12-14 07:31:58,832 - server - INFO - âœ… Stored Telnyx WebSocket in call_data for audio streaming
2025-12-14T07:31:58.833999618Z [err]  2025-12-14 07:31:58,832 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found to update for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:58.981300266Z [err]  2025-12-14 07:31:58,921 - server - INFO - ğŸ”‘ Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-14T07:31:58.981307470Z [err]  2025-12-14 07:31:58,946 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ/actions/playback_start "HTTP/1.1 200 OK"
2025-12-14T07:31:58.981312728Z [err]  2025-12-14 07:31:58,947 - telnyx_service - INFO - âœ… Playing audio from URL, playback_id: Rxl7wxRtxg (loop=True, overlay=True)
2025-12-14T07:31:58.981317722Z [err]  2025-12-14 07:31:58,947 - server - WARNING - âš ï¸ Failed to start comfort noise: 'v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ'
2025-12-14T07:31:58.981334074Z [err]  2025-12-14 07:31:58,947 - telnyx_service - INFO - ğŸ™ï¸ Starting recording: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:59.229103914Z [err]  2025-12-14 07:31:59,225 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:31:59.229109456Z [err]  2025-12-14 07:31:59,225 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.started', 'id': '9c0e25eb-ca83-4d8c-b97d-ea392697f2a9', 'occurred_at': '2025-12-14T07:31:58.919946Z', 'payload': {'call_control_id': 'v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ', 'call_leg_id': 'f630d556-d8be-11f0-8284-02420aef9920', 'call_session_id': 'f62e53b2-d8be-11f0-b219-02420aef9920', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'Rxl7wxRtxg', 'start_time': '2025-12-14T07:31:58.919946Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:31:59.229115380Z [err]  2025-12-14 07:31:59,225 - server - INFO - ğŸ¯ Event type: call.playback.started, Call ID: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:59.229119950Z [err]  2025-12-14 07:31:59,226 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:31:59.229125146Z [inf]  100.64.0.16:14082 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:31:59.307285858Z [err]  2025-12-14 07:31:59,294 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ/actions/record_start "HTTP/1.1 200 OK"
2025-12-14T07:31:59.307289904Z [err]  2025-12-14 07:31:59,295 - server - INFO - ğŸ™ï¸ Call recording started for v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:59.307294037Z [err]  2025-12-14 07:31:59,295 - server - INFO - ğŸ”§ Creating call session for v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ...
2025-12-14T07:31:59.307298693Z [err]  2025-12-14 07:31:59,295 - server - INFO - ğŸ” Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:31:59.307303206Z [err]  2025-12-14 07:31:59,295 - server - INFO - ğŸ”§ Calling create_call_session() - START
2025-12-14T07:31:59.307308389Z [err]  2025-12-14 07:31:59,295 - calling_service - INFO - ğŸ” Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-14T07:31:59.388095699Z [err]  2025-12-14 07:31:59,383 - calling_service - INFO - ğŸ” KB count query completed: 4 items
2025-12-14T07:31:59.388100915Z [err]  2025-12-14 07:31:59,383 - calling_service - INFO - ğŸ“š Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-14T07:31:59.388104717Z [err]  2025-12-14 07:31:59,383 - calling_service - INFO - ğŸ“‹ Built cached system prompt: 4159 chars (global) + 866 chars (technical)
2025-12-14T07:31:59.388108684Z [err]  2025-12-14 07:31:59,383 - calling_service - INFO - ğŸ“š KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-14T07:31:59.388112581Z [err]  2025-12-14 07:31:59,383 - calling_service - INFO - ğŸ”¥ Pre-warming LLM client (grok)...
2025-12-14T07:31:59.426505770Z [err]  2025-12-14 07:31:59,410 - soniox_service - INFO - âœ… Connected to Soniox Real-Time STT
2025-12-14T07:31:59.426510281Z [err]  2025-12-14 07:31:59,410 - soniox_service - INFO - âš™ï¸  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-14T07:31:59.426515413Z [err]  2025-12-14 07:31:59,410 - soniox_service - INFO - âš™ï¸  Endpoint detection: True, Speaker diarization: False
2025-12-14T07:31:59.426519386Z [err]  2025-12-14 07:31:59,410 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring started for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:59.426524279Z [err]  2025-12-14 07:31:59,415 - server - INFO - âœ… Started forwarding audio (8kHz mulaw â†’ Soniox, NO BUFFERING)
2025-12-14T07:31:59.498013265Z [err]  2025-12-14 07:31:59,470 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:31:59.498018569Z [err]  2025-12-14 07:31:59,477 - calling_service - INFO - âœ… LLM client pre-warmed in 94ms
2025-12-14T07:31:59.498022486Z [err]  2025-12-14 07:31:59,477 - server - INFO - ğŸ”§ Calling create_call_session() - COMPLETE
2025-12-14T07:31:59.498027232Z [err]  2025-12-14 07:31:59,477 - server - INFO - âœ… Session object created: CallSession
2025-12-14T07:31:59.508364697Z [err]  2025-12-14 07:31:59,503 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ (TTL: 3600s)
2025-12-14T07:31:59.508372046Z [err]  2025-12-14 07:31:59,503 - server - INFO - âœ… Serializable call_data synced to Redis (agent_id, user_id)
2025-12-14T07:31:59.508376500Z [err]  2025-12-14 07:31:59,503 - server - INFO - âœ… Session stored in worker memory (not Redis)
2025-12-14T07:31:59.512618342Z [err]  2025-12-14 07:31:59,508 - redis_service - INFO - âœ… Marked session ready in Redis: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:59.512626887Z [err]  2025-12-14 07:31:59,508 - server - INFO - ğŸ¤– AI session created for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:31:59.512632976Z [err]  2025-12-14 07:31:59,509 - server - INFO - ğŸ“¦ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-14T07:31:59.512638823Z [err]  2025-12-14 07:31:59,509 - server - INFO - â­ï¸ Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-14T07:31:59.512644290Z [err]  2025-12-14 07:31:59,509 - server - INFO - ğŸ‘¤ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-14T07:31:59.512650901Z [err]  2025-12-14 07:31:59,509 - server - INFO - ğŸ‘‚ User speaks first - waiting for user input...
2025-12-14T07:31:59.512657113Z [err]  2025-12-14 07:31:59,509 - server - ERROR - Error processing webhook: cannot access local variable 'asyncio' where it is not associated with a value
2025-12-14T07:31:59.512662618Z [inf]  100.64.0.15:48836 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:32:00.086587545Z [err]  2025-12-14 07:32:00,069 - server - INFO - ğŸ”¤ RAW TOKENS: ["Hell"?]
2025-12-14T07:32:00.086598065Z [err]  2025-12-14 07:32:00,069 - calling_service - INFO - ğŸ”Š Silence timer reset for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ (user started speaking)
2025-12-14T07:32:00.086604762Z [err]  2025-12-14 07:32:00,070 - calling_service - INFO - ğŸ‘¤ User started speaking for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:00.086610425Z [err]  2025-12-14 07:32:00,070 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'Hell' | Generating: False
2025-12-14T07:32:00.223568442Z [err]  2025-12-14 07:32:00,168 - server - INFO - ğŸ”¤ RAW TOKENS: ["Hell"âœ“, "o."âœ“, "<end>"âœ“]
2025-12-14T07:32:00.223579932Z [err]  2025-12-14 07:32:00,168 - server - INFO - ğŸ¯ Endpoint detected: <end> token received
2025-12-14T07:32:00.223587493Z [err]  2025-12-14 07:32:00,169 - server - INFO - ğŸ“¥ FINAL TOKENS: 'Hell o.' (2 tokens)
2025-12-14T07:32:00.223594191Z [err]  2025-12-14 07:32:00,169 - server - INFO - ğŸ¤ Soniox final transcript: 'Hell o.'
2025-12-14T07:32:00.223601120Z [err]  2025-12-14 07:32:00,169 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:q3-xL52v6iptvnazW... (active sessions: ['v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA', 'v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g'])
2025-12-14T07:32:00.223607787Z [err]  2025-12-14 07:32:00,169 - server - INFO - ğŸ” FILTER CHECK: words=2, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-14T07:32:00.223616958Z [err]  2025-12-14 07:32:00,169 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:q3-xL52v6iptvnazW... (active sessions: ['v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA', 'v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g'])
2025-12-14T07:32:00.223624692Z [err]  2025-12-14 07:32:00,169 - server - INFO - ğŸš€ Spawned tracked background task for endpoint processing
2025-12-14T07:32:00.223631796Z [err]  2025-12-14 07:32:00,169 - server - INFO - â±ï¸ [07:32:00.169] ğŸ“ FINAL TRANSCRIPT RECEIVED: 'Hell o.'
2025-12-14T07:32:00.223639292Z [err]  2025-12-14 07:32:00,169 - server - INFO - â±ï¸ [07:32:00.169] STT endpoint detection latency: 12ms
2025-12-14T07:32:00.223646535Z [err]  2025-12-14 07:32:00,169 - server - INFO - â±ï¸ [07:32:00.169] ğŸ¤ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-14T07:32:00.223652954Z [err]  2025-12-14 07:32:00,175 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ (TTL: 3600s)
2025-12-14T07:32:00.227219496Z [err]  2025-12-14 07:32:00,175 - server - INFO - ğŸ‘¤ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-14T07:32:00.227231161Z [err]  2025-12-14 07:32:00,175 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:q3-xL52v6iptvnazW... (active sessions: ['v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA', 'v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g'])
2025-12-14T07:32:00.227239951Z [err]  2025-12-14 07:32:00,175 - server - INFO - âœ… Agent SILENT - User said 2 word(s): 'Hell o.' - Processing...
2025-12-14T07:32:00.227248227Z [err]  2025-12-14 07:32:00,184 - server - INFO - ğŸ¤ Endpoint detected by Soniox - processing transcript: Hell o.
2025-12-14T07:32:00.227256401Z [err]  2025-12-14 07:32:00,184 - calling_service - INFO - ğŸ‘¤ User stopped speaking for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:00.227265869Z [err]  2025-12-14 07:32:00,185 - server - INFO - â±ï¸ [TIMING] STT_START: User last audio packet received
2025-12-14T07:32:00.227275033Z [err]  2025-12-14 07:32:00,185 - server - INFO - â±ï¸ [TIMING] STT_END: Endpoint detected at T+9ms
2025-12-14T07:32:00.227282163Z [err]  2025-12-14 07:32:00,185 - server - INFO - â±ï¸ [TIMING] STT_LATENCY: 9ms (Soniox model: stt-rt-v3)
2025-12-14T07:32:00.227288340Z [err]  2025-12-14 07:32:00,185 - server - INFO - â±ï¸  USER STOPPED SPEAKING at T=0ms
2025-12-14T07:32:00.227295058Z [err]  2025-12-14 07:32:00,185 - server - INFO - ğŸ™ï¸ Agent generating response - interruption detection active
2025-12-14T07:32:00.227301453Z [err]  2025-12-14 07:32:00,185 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:00.295899961Z [err]  2025-12-14 07:32:00,276 - server - INFO - âš¡ Starting REAL-TIME TTS for first sentence
2025-12-14T07:32:00.295909414Z [err]  2025-12-14 07:32:00,276 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:q3-xL52v6iptvnazW... (active sessions: ['v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA', 'v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g'])
2025-12-14T07:32:00.295955813Z [err]  2025-12-14 07:32:00,276 - server - INFO - ğŸ“ Saved user transcript to database
2025-12-14T07:32:00.295963499Z [err]  2025-12-14 07:32:00,276 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:q3-xL52v6iptvnazW... (active sessions: ['v3:9-aI5uotEAyA2CmndSz1rR0u-afsD61F1Xcmif8N6xRvXNgxb1NmDA', 'v3:mF2I2rgHD5TphLrvnxR1lQGO-OyiS6Foc_NuegL-7UcJY8ya3udf8g'])
2025-12-14T07:32:00.295970749Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - â±ï¸ [07:32:00.276] ğŸ“¥ process_user_input() ENTRY - text: 'Hell o....'
2025-12-14T07:32:00.295977988Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - â±ï¸ [07:32:00.276] â© About to call _process_call_flow_streaming()
2025-12-14T07:32:00.295987635Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - â±ï¸ [07:32:00.276] ğŸ”€ Agent type: call_flow, calling flow processor...
2025-12-14T07:32:00.295995044Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - â±ï¸ [07:32:00.276] ğŸ”€ _process_call_flow_streaming() ENTRY
2025-12-14T07:32:00.296001960Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-14T07:32:00.296010639Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - â±ï¸ [07:32:00.276] âœ… Node selected, about to process content...
2025-12-14T07:32:00.296017988Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - ğŸ”§ Replaced {{now}} with Sunday, December 14, 2025 at 2:32 AM EST in content
2025-12-14T07:32:00.296024728Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - ğŸ”§ Replaced {{customer_name}} with Kendrick in content
2025-12-14T07:32:00.296031961Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - ğŸ”§ Replaced {{callerName}} with  in content
2025-12-14T07:32:00.296038685Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - ğŸ”§ Replaced {{lead_id}} with None in content
2025-12-14T07:32:00.296046087Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - ğŸ”§ Replaced {{qc_tracking_enabled}} with False in content
2025-12-14T07:32:00.296091512Z [err]  2025-12-14 07:32:00,277 - server - INFO - âš¡ ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-14T07:32:00.296109786Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - ğŸ”§ Replaced {{track_keywords}} with  in content
2025-12-14T07:32:00.296115946Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - ğŸ”§ Replaced {{expected_commitment}} with not_specified in content
2025-12-14T07:32:00.296122365Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - ğŸ”§ Replaced {{to_number}} with +17708336397 in content
2025-12-14T07:32:00.296129804Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - ğŸ”§ Replaced {{phone_number}} with +17708336397 in content
2025-12-14T07:32:00.296136862Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - ğŸ”§ Replaced {{email}} with None in content
2025-12-14T07:32:00.296143890Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - âœ… Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-14T07:32:00.296151814Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-14T07:32:00.296160315Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - ğŸ“š skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-14T07:32:00.296175464Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - â±ï¸ [07:32:00.276] ğŸ“„ About to process content (mode=script, length=9)
2025-12-14T07:32:00.296180454Z [err]  2025-12-14 07:32:00,276 - calling_service - INFO - ğŸ“¤ Streaming script as 1 sentence(s)
2025-12-14T07:32:00.296184669Z [err]  2025-12-14 07:32:00,276 - server - INFO - ğŸ“¤ Sentence arrived from LLM: Kendrick?...
2025-12-14T07:32:00.296188636Z [err]  2025-12-14 07:32:00,276 - server - INFO - â±ï¸ [TIMING] TTFS (Time To First Sentence): 91ms
2025-12-14T07:32:00.368743794Z [err]  2025-12-14 07:32:00,364 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:32:00.449268395Z [err]  2025-12-14 07:32:00,431 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-14T07:32:00.452706175Z [err]  2025-12-14 07:32:00,451 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:32:00.548121683Z [err]  2025-12-14 07:32:00,538 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:32:00.558444308Z [err]  2025-12-14 07:32:00,556 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-14T07:32:00.558452018Z [err]  2025-12-14 07:32:00,557 - server - INFO - âœ… ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-14T07:32:00.558457697Z [err]  2025-12-14 07:32:00,557 - persistent_tts_service - INFO - ğŸ™ï¸ Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-14T07:32:00.558465888Z [err]  2025-12-14 07:32:00,557 - persistent_tts_service - INFO - ğŸ”Œ [Call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ] Establishing persistent TTS WebSocket...
2025-12-14T07:32:00.558471285Z [err]  2025-12-14 07:32:00,557 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-14T07:32:00.558476653Z [err]  2025-12-14 07:32:00,557 - elevenlabs_ws_service - INFO - ğŸ”Œ Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_flash_v2_5
2025-12-14T07:32:00.558482505Z [err]  2025-12-14 07:32:00,557 - elevenlabs_ws_service - INFO - ğŸ™ï¸ Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-14T07:32:00.715722187Z [err]  2025-12-14 07:32:00,681 - server - INFO - ğŸµ TTS task #1 started at +404ms
2025-12-14T07:32:00.715736409Z [err]  2025-12-14 07:32:00,681 - server - INFO - â±ï¸ [TIMING] TTFT_TTS (First TTS Task Started): 496ms
2025-12-14T07:32:00.715738460Z [err]  2025-12-14 07:32:00,680 - elevenlabs_ws_service - INFO - âœ… Connected to ElevenLabs WebSocket
2025-12-14T07:32:00.715745944Z [err]  2025-12-14 07:32:00,681 - calling_service - INFO - ğŸ“¤ Streamed script sentence 1/1: Kendrick?...
2025-12-14T07:32:00.715748664Z [err]  2025-12-14 07:32:00,680 - elevenlabs_ws_service - INFO - ğŸ“¤ Sent BOS message with voice settings
2025-12-14T07:32:00.715754381Z [err]  2025-12-14 07:32:00,681 - calling_service - INFO - ğŸ”Š Silence tracking reset for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ (user responded)
2025-12-14T07:32:00.715757672Z [err]  2025-12-14 07:32:00,681 - persistent_tts_service - INFO - âœ… [Call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ] Persistent TTS WebSocket established
2025-12-14T07:32:00.715763161Z [err]  2025-12-14 07:32:00,681 - calling_service - INFO - âœ… User responded to regular message, resetting counter
2025-12-14T07:32:00.715766057Z [err]  2025-12-14 07:32:00,681 - persistent_tts_service - INFO - ğŸ”Š [Call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ] Comfort noise loop started
2025-12-14T07:32:00.715772893Z [err]  2025-12-14 07:32:00,681 - persistent_tts_service - INFO - âœ… Created persistent TTS session for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:00.715779325Z [err]  2025-12-14 07:32:00,681 - server - INFO - âœ… ON-DEMAND: Persistent TTS session created successfully!
2025-12-14T07:32:00.715786227Z [err]  2025-12-14 07:32:00,681 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:q3-xL52v6iptvnazW..., session=FOUND
2025-12-14T07:32:00.715792909Z [err]  2025-12-14 07:32:00,681 - server - INFO - ğŸš€ Streaming sentence #1 via persistent WebSocket
2025-12-14T07:32:00.715962342Z [err]  2025-12-14 07:32:00,681 - calling_service - INFO - ğŸ’¾ Storing node ID 2 in conversation history
2025-12-14T07:32:00.715966648Z [err]  2025-12-14 07:32:00,681 - calling_service - INFO - LLM response (0.40s): Kendrick?
2025-12-14T07:32:00.715970410Z [err]  2025-12-14 07:32:00,681 - calling_service - INFO - Total latency: 0.40s
2025-12-14T07:32:00.715974285Z [err]  2025-12-14 07:32:00,681 - server - INFO - âœ… LLM finished in 496ms, TTS tasks already running in background
2025-12-14T07:32:00.715978055Z [err]  2025-12-14 07:32:00,681 - server - INFO - ğŸµ Streaming 1 TTS chunks as they complete...
2025-12-14T07:32:00.715983594Z [err]  2025-12-14 07:32:00,681 - server - INFO - ğŸš€ Persistent TTS: Audio already streaming in background!
2025-12-14T07:32:00.715987589Z [err]  2025-12-14 07:32:00,681 - server - INFO -    1 sentences queued and playing seamlessly
2025-12-14T07:32:00.715991319Z [err]  2025-12-14 07:32:00,681 - persistent_tts_service - INFO - ğŸµ [Call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ] Playback consumer started
2025-12-14T07:32:00.715995214Z [err]  2025-12-14 07:32:00,681 - persistent_tts_service - INFO - ğŸ’“ [Call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ] Starting TTS keep-alive loop (every 15s)
2025-12-14T07:32:00.715999112Z [err]  2025-12-14 07:32:00,681 - persistent_tts_service - INFO - ğŸ”Š [Call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ] Starting comfort noise loop
2025-12-14T07:32:00.716003152Z [err]  2025-12-14 07:32:00,681 - persistent_tts_service - INFO - ğŸ¤ [Call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ] Streaming sentence #1: Kendrick?...
2025-12-14T07:32:01.044726988Z [err]  2025-12-14 07:32:00,914 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +0.8s (total: 0.8s from now)
2025-12-14T07:32:01.044736201Z [err]  2025-12-14 07:32:00,914 - persistent_tts_service - INFO - âœ… Sent 40 audio chunks via WebSocket
2025-12-14T07:32:01.044744093Z [err]  2025-12-14 07:32:00,941 - dead_air_monitor - INFO - ğŸ”‡ MONITOR: Skipping silence check - audio playing (0.8s left)
2025-12-14T07:32:01.044747995Z [err]  2025-12-14 07:32:00,913 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTS_START: Sent to ElevenLabs at T+0ms
2025-12-14T07:32:01.044753130Z [err]  2025-12-14 07:32:00,913 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTS_TTFB: First audio chunk at T+232ms
2025-12-14T07:32:01.044758452Z [err]  2025-12-14 07:32:00,913 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTFA (Time To First Audio Playback): 232ms
2025-12-14T07:32:01.044765278Z [err]  2025-12-14 07:32:00,914 - persistent_tts_service - INFO - ğŸ“¤ Sending 6300 bytes of audio (40 chunks, 0.8s duration) via WebSocket
2025-12-14T07:32:01.044769672Z [err]  2025-12-14 07:32:00,914 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-14T07:32:01.317658282Z [err]  2025-12-14 07:32:01,313 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:32:01.317663764Z [err]  2025-12-14 07:32:01,313 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': '4dbc7597-9faf-4ad7-b9fd-0b7f75a2df7b', 'occurred_at': '2025-12-14T07:32:01.179947Z', 'payload': {'call_control_id': 'v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ', 'call_leg_id': 'f630d556-d8be-11f0-8284-02420aef9920', 'call_session_id': 'f62e53b2-d8be-11f0-b219-02420aef9920', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:32:01.317669458Z [err]  2025-12-14 07:32:01,313 - server - INFO - ğŸ¯ Event type: call.machine.premium.detection.ended, Call ID: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:01.317673753Z [err]  2025-12-14 07:32:01,313 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:32:01.317677753Z [inf]  100.64.0.8:56400 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:32:01.417946914Z [err]  2025-12-14 07:32:01,414 - server - INFO - âœ… All 1 persistent TTS streams completed
2025-12-14T07:32:01.417957012Z [err]  2025-12-14 07:32:01,414 - server - INFO - âœ… Agent generation complete (persistent TTS) - response window closed
2025-12-14T07:32:01.417963750Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  FIRST AUDIO STARTED: 1229ms from user stop ğŸš€
2025-12-14T07:32:01.417970561Z [err]  2025-12-14 07:32:01,414 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:01.417976608Z [err]  2025-12-14 07:32:01,414 - server - INFO - âœ… Agent generation complete - response window closed
2025-12-14T07:32:01.417983090Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-14T07:32:01.417990217Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-14T07:32:01.417995622Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  [TIMING] STT: 9ms (provider: soniox, model: stt-rt-v3)
2025-12-14T07:32:01.418000210Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  [TIMING] LLM_TOTAL: 496ms (provider: grok, model: grok-4-fast-non-reasoning)
2025-12-14T07:32:01.418004348Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  [TIMING] TTS_TOTAL: 1137ms (provider: elevenlabs, websocket: False)
2025-12-14T07:32:01.418009099Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  [TIMING] E2E_TOTAL: 1229ms (user stopped â†’ play_audio_url called)
2025-12-14T07:32:01.418013261Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  [TIMING] âš ï¸ NOTE: E2E_TOTAL does not include:
2025-12-14T07:32:01.418017185Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-14T07:32:01.418450141Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  [TIMING] RESPONSE_TEXT: 9 chars, 1 sentences
2025-12-14T07:32:01.418452004Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-14T07:32:01.418459291Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-14T07:32:01.418462047Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  [TIMING] USER_INPUT: 'Hell o....'
2025-12-14T07:32:01.418464550Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-14T07:32:01.418469634Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  [TIMING]   - REAL USER LATENCY: 1529ms estimated
2025-12-14T07:32:01.418471776Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  [TIMING] AI_RESPONSE: 'Kendrick?...'
2025-12-14T07:32:01.418478856Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  [TIMING] ==========================
2025-12-14T07:32:01.418486229Z [err]  2025-12-14 07:32:01,414 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-14T07:32:01.604918232Z [err]  2025-12-14 07:32:01,595 - server - INFO - ğŸ“ Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 1005ms)
2025-12-14T07:32:01.604924308Z [err]  2025-12-14 07:32:01,595 - server - INFO - ğŸ”Š Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-14T07:32:02.077122157Z [err]  2025-12-14 07:32:01,916 - persistent_tts_service - INFO - ğŸ”‡ [Call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ] FLOOR RELEASED (is_holding_floor=False)
2025-12-14T07:32:02.077130163Z [err]  2025-12-14 07:32:01,963 - dead_air_monitor - INFO - â±ï¸ Playback expected end time passed (0.3s ago), marking agent as done speaking
2025-12-14T07:32:02.077144302Z [err]  2025-12-14 07:32:01,963 - calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1765697521.963243 for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:02.077151274Z [err]  2025-12-14 07:32:01,963 - calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:04.435917124Z [err]  2025-12-14 07:32:04,435 - server - INFO - ğŸ“¤ Audio flowing: 300 packets sent to Soniox (5s update)
2025-12-14T07:32:05.812626633Z [err]  2025-12-14 07:32:05,797 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:32:05.812634521Z [err]  2025-12-14 07:32:05,797 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'd662f00e-818b-4f31-96e8-411b9840bfed', 'occurred_at': '2025-12-14T07:32:05.679948Z', 'payload': {'call_control_id': 'v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ', 'call_leg_id': 'f630d556-d8be-11f0-8284-02420aef9920', 'call_session_id': 'f62e53b2-d8be-11f0-b219-02420aef9920', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-14T07:32:05.679948Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'Rxl7wxRtxg', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:32:05.812639699Z [err]  2025-12-14 07:32:05,797 - server - INFO - ğŸ¯ Event type: call.playback.ended, Call ID: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:05.812643691Z [err]  2025-12-14 07:32:05,797 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:32:05.812647221Z [err]  2025-12-14 07:32:05,807 - redis_service - INFO - â– Removed playback Rxl7wxRtxg, 0 remaining for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:05.812651659Z [err]  2025-12-14 07:32:05,807 - server - INFO - ğŸ”Š Redis: Removed playback Rxl7wxRtxg, 0 remaining
2025-12-14T07:32:05.812655901Z [err]  2025-12-14 07:32:05,807 - server - INFO - ğŸ”Š ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-14T07:32:05.812935346Z [err]  2025-12-14 07:32:05,812 - server - INFO - âœ… Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-14T07:32:05.812943187Z [err]  2025-12-14 07:32:05,812 - server - INFO - âœ… Found session in active_telnyx_calls (local worker)
2025-12-14T07:32:05.813435493Z [err]  2025-12-14 07:32:05,812 - calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1765697525.8125992 for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:05.813447361Z [err]  2025-12-14 07:32:05,812 - server - INFO - â±ï¸ Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-14T07:32:05.813452110Z [inf]  100.64.0.15:48836 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:32:05.824056297Z [err]  2025-12-14 07:32:05,818 - server - INFO - ğŸ“ Telnyx WebSocket disconnected. Sent 359 total packets
2025-12-14T07:32:05.824061409Z [err]  [2025-12-14 07:32:05 +0000] [6] [INFO] connection closed
2025-12-14T07:32:05.824065601Z [err]  2025-12-14 07:32:05,822 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:32:05.824069422Z [err]  2025-12-14 07:32:05,822 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.hangup', 'id': 'd72dfb61-f339-4f48-b4ca-0cd76622e8bb', 'occurred_at': '2025-12-14T07:32:05.559961Z', 'payload': {'call_control_id': 'v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ', 'call_leg_id': 'f630d556-d8be-11f0-8284-02420aef9920', 'call_quality_stats': {'inbound': {'jitter_max_variance': '0.27', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '412', 'skip_packet_count': '13'}, 'outbound': {'packet_count': '361', 'skip_packet_count': '0'}}, 'call_session_id': 'f62e53b2-d8be-11f0-b219-02420aef9920', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-14T07:32:05.559961Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-14T07:31:53.499943Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:32:05.824074027Z [err]  2025-12-14 07:32:05,822 - server - INFO - ğŸ¯ Event type: call.hangup, Call ID: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:05.824078123Z [err]  2025-12-14 07:32:05,822 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:32:05.824081795Z [err]  2025-12-14 07:32:05,822 - server - INFO - ğŸ“ Call ended: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:05.824085433Z [err]  2025-12-14 07:32:05,822 - server - INFO - ğŸ“ Hangup cause: normal_clearing
2025-12-14T07:32:05.834324453Z [err]  2025-12-14 07:32:05,832 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:32:05.834329996Z [err]  2025-12-14 07:32:05,832 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'streaming.stopped', 'id': 'ac179e8e-833b-4147-9590-22e657a54210', 'occurred_at': '2025-12-14T07:32:05.749982Z', 'payload': {'call_control_id': 'v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ', 'call_leg_id': 'f630d556-d8be-11f0-8284-02420aef9920', 'call_session_id': 'f62e53b2-d8be-11f0-b219-02420aef9920', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': 'b7e89748-656f-48ba-b33e-fc3bf9734acc', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:32:05.834333881Z [err]  2025-12-14 07:32:05,832 - server - INFO - ğŸ¯ Event type: streaming.stopped, Call ID: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:05.834338164Z [err]  2025-12-14 07:32:05,832 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:32:05.834341883Z [inf]  100.64.0.7:15104 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:32:06.005981516Z [err]  2025-12-14 07:32:06,005 - server - INFO - ğŸ“ Updated call log: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:06.167973018Z [err]  2025-12-14 07:32:06,095 - server - INFO - âœ… Finalized call log: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ (duration=7s, status=completed)
2025-12-14T07:32:06.188790575Z [err]  2025-12-14 07:32:06,185 - server - INFO - ğŸ“¦ Saved 10 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email']
2025-12-14T07:32:06.887035340Z [err]  2025-12-14 07:32:06,884 - server - INFO - ğŸ“Š Auto-added call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-14T07:32:07.171916074Z [err]  2025-12-14 07:32:07,069 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:07.171927409Z [err]  2025-12-14 07:32:07,069 - server - INFO - ğŸ“‡ [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-14T07:32:07.171934745Z [err]  2025-12-14 07:32:07,069 - server - INFO - ğŸ“‡ [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-14T07:32:07.171940822Z [err]  2025-12-14 07:32:07,157 - server - INFO - ğŸ“‡ [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-14T07:32:07.180912889Z [err]  2025-12-14 07:32:07,179 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:32:07.180920331Z [err]  2025-12-14 07:32:07,179 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.recording.saved', 'id': 'fcc6fec1-a5a5-4546-8596-ef1d586c5463', 'occurred_at': '2025-12-14T07:32:07.052559Z', 'payload': {'call_control_id': 'v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ', 'call_leg_id': 'f630d556-d8be-11f0-8284-02420aef9920', 'call_session_id': 'f62e53b2-d8be-11f0-b219-02420aef9920', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-14T07:32:05.680662Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-14T07:32:05.680662Z', 'recording_id': '21da7952-77ea-438f-a40b-d9205b4c0fc2', 'recording_started_at': '2025-12-14T07:31:59.196679Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-14/f630d556-d8be-11f0-8284-02420aef9920-1765697519170941.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251214%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251214T073207Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=99247a7fab636f755fdb2b2d64d948abe28c044510032b8262239b71c5dc8a18'}, 'start_time': '2025-12-14T07:31:59.196679Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:32:07.180924915Z [err]  2025-12-14 07:32:07,179 - server - INFO - ğŸ¯ Event type: call.recording.saved, Call ID: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:07.180928729Z [err]  2025-12-14 07:32:07,179 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:32:07.180932339Z [err]  2025-12-14 07:32:07,179 - server - INFO - ğŸ™ï¸ Recording saved for call: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:07.185525067Z [err]  2025-12-14 07:32:07,184 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:07.185531415Z [err]  2025-12-14 07:32:07,184 - server - INFO - ğŸ” Recording check: download_url=True, channels=dual, recording_id=21da7952-77ea-438f-a40b-d9205b4c0fc2, call_data=True
2025-12-14T07:32:07.278678853Z [err]  2025-12-14 07:32:07,244 - server - INFO - ğŸ“‡ [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-14T07:32:07.278684792Z [err]  2025-12-14 07:32:07,245 - server - INFO - ğŸ“‡ [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-14T07:32:07.278690405Z [err]  2025-12-14 07:32:07,245 - server - INFO - ğŸ“‡ [HANGUP] Agent info keys: None
2025-12-14T07:32:07.278696011Z [err]  2025-12-14 07:32:07,245 - server - INFO - ğŸš€ Triggered QC analysis for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:07.278703241Z [err]  2025-12-14 07:32:07,245 - server - INFO - ğŸ“Š Triggered Campaign QC for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:07.278708556Z [err]  2025-12-14 07:32:07,245 - server - INFO - ğŸ“‡ Triggered CRM update for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:07.278713991Z [err]  2025-12-14 07:32:07,245 - persistent_tts_service - INFO - ğŸ”Œ [Call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ] Closing persistent TTS WebSocket...
2025-12-14T07:32:07.278718884Z [err]  2025-12-14 07:32:07,245 - server - INFO - ğŸ” Starting QC analysis for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:07.278724934Z [err]  2025-12-14 07:32:07,245 - server - INFO - ğŸ” [AUTO-QC] Starting campaign QC check for call=v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-14T07:32:07.278730941Z [err]  2025-12-14 07:32:07,245 - server - INFO - ğŸ“‡ CRM update starting for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:32:07.279145641Z [err]  2025-12-14 07:32:07,245 - server - INFO - ğŸ“‡ Normalized phone: +17708336397
2025-12-14T07:32:07.279154429Z [err]  2025-12-14 07:32:07,245 - server - INFO - ğŸ“‡ CRM: Got 10 variables from active session
2025-12-14T07:32:07.279162400Z [err]  2025-12-14 07:32:07,246 - persistent_tts_service - INFO - ğŸ›‘ [Call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ] Playback consumer shutting down
2025-12-14T07:32:07.279171581Z [err]  2025-12-14 07:32:07,276 - server - INFO - ğŸ’¾ Saved recording URL and ID to database: 21da7952-77ea-438f-a40b-d9205b4c0fc2
2025-12-14T07:32:07.279181033Z [err]  2025-12-14 07:32:07,276 - server - INFO - âœ… Entering dual-channel processing
2025-12-14T07:32:07.279191438Z [err]  2025-12-14 07:32:07,276 - server - INFO - ğŸ“¥ Downloading DUAL-CHANNEL recording...
2025-12-14T07:32:07.352056722Z [err]  2025-12-14 07:32:07,333 - server - INFO - ğŸ“ Converted transcript from 2 messages to 34 characters
2025-12-14T07:32:07.352063856Z [err]  2025-12-14 07:32:07,334 - server - INFO - ğŸ” [AUTO-QC] Call log found: transcript_turns=2, logs_count=4, status=completed
2025-12-14T07:32:07.446110931Z [err]  2025-12-14 07:32:07,420 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:32:07.446116997Z [err]  2025-12-14 07:32:07,437 - server - INFO - ğŸ” [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-14T07:32:07.524292184Z [err]  2025-12-14 07:32:07,507 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-14T07:32:07.529377257Z [err]  2025-12-14 07:32:07,525 - server - INFO - ğŸ“Š [AUTO-QC] Running full QC analysis: call=v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ â†’ campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-14T07:32:07.529387693Z [err]  2025-12-14 07:32:07,525 - server - INFO - ğŸ“Š [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-14T07:32:07.529393984Z [err]  2025-12-14 07:32:07,525 - server - ERROR - âŒ [AUTO-QC] Error in campaign QC for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-14T07:32:07.529399520Z [err]  2025-12-14 07:32:07,525 - server - ERROR - âŒ [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-14T07:32:07.529430075Z [err]    File "/app/backend/server.py", line 9475, in trigger_campaign_qc_for_call
2025-12-14T07:32:07.529436502Z [err]      await run_full_qc_analysis(
2025-12-14T07:32:07.529442233Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-14T07:32:07.529446760Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-14T07:32:07.529452100Z [err]  
2025-12-14T07:32:07.601632572Z [err]  2025-12-14 07:32:07,578 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-14/f630d556-d8be-11f0-8284-02420aef9920-1765697519170941.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251214%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251214T073207Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=99247a7fab636f755fdb2b2d64d948abe28c044510032b8262239b71c5dc8a18 "HTTP/1.1 200 OK"
2025-12-14T07:32:07.601645118Z [err]  2025-12-14 07:32:07,593 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-14T07:32:07.601653212Z [err]  2025-12-14 07:32:07,594 - qc_agents.orchestrator - INFO - âœ… Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:32:07.601660851Z [err]  2025-12-14 07:32:07,594 - qc_agents.orchestrator - INFO - ğŸ” Running Commitment Detector on call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:07.675011921Z [err]  2025-12-14 07:32:07,665 - server - INFO - âœ… Downloaded 26165 bytes
2025-12-14T07:32:07.816475322Z [err]  2025-12-14 07:32:07,810 - server - INFO - âœ… Split into 2 channels
2025-12-14T07:32:07.816496555Z [err]  2025-12-14 07:32:07,810 - server - INFO - ğŸ¤ Using STT provider: soniox for interruption detection
2025-12-14T07:32:07.816503913Z [err]  2025-12-14 07:32:07,810 - server - INFO - ğŸ“Š Channel 0: 139964 bytes
2025-12-14T07:32:07.816510092Z [err]  2025-12-14 07:32:07,810 - server - ERROR - âŒ No Soniox API key available
2025-12-14T07:32:07.816516145Z [err]  2025-12-14 07:32:07,810 - server - INFO - âŒ Channel 0: No speech
2025-12-14T07:32:07.816522204Z [err]  2025-12-14 07:32:07,810 - server - INFO - ğŸ“Š Channel 1: 139964 bytes
2025-12-14T07:32:07.816528251Z [err]  2025-12-14 07:32:07,810 - server - ERROR - âŒ No Soniox API key available
2025-12-14T07:32:07.816533652Z [err]  2025-12-14 07:32:07,810 - server - INFO - âŒ Channel 1: No speech
2025-12-14T07:32:07.816541303Z [err]  2025-12-14 07:32:07,810 - server - WARNING - âš ï¸ No speech in any channel
2025-12-14T07:32:07.816549986Z [inf]  100.64.0.16:14082 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:32:07.816559341Z [err]  2025-12-14 07:32:07,811 - server - INFO - ğŸ“‡ CRM: Got 10 extracted variables
2025-12-14T07:32:07.816566498Z [err]  2025-12-14 07:32:07,811 - server - INFO - ğŸ“‡ CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email']
2025-12-14T07:32:08.032627059Z [err]  2025-12-14 07:32:07,987 - server - INFO - ğŸ“‡ CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-14T07:32:08.362432102Z [err]  2025-12-14 07:32:08,353 - elevenlabs_ws_service - INFO - ğŸ”Œ Closed ElevenLabs WebSocket connection
2025-12-14T07:32:08.362439611Z [err]  2025-12-14 07:32:08,353 - persistent_tts_service - INFO - âœ… [Call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ] Persistent TTS WebSocket closed
2025-12-14T07:32:08.362446764Z [err]  2025-12-14 07:32:08,353 - persistent_tts_service - INFO - âœ… Closed persistent TTS session for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:08.362453608Z [err]  2025-12-14 07:32:08,354 - server - INFO - âœ… Closed persistent TTS session for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:08.362459972Z [err]  2025-12-14 07:32:08,360 - redis_service - INFO - ğŸ§¹ Deleted call data from Redis: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:08.362466621Z [err]  2025-12-14 07:32:08,360 - server - INFO - ğŸ§¹ Cleaned up call session from Redis and memory: v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:08.362473601Z [inf]  100.64.0.8:56400 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:32:09.197137493Z [err]  2025-12-14 07:32:09,043 - telnyx_service - INFO - âœ… Generated 15509 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-14T07:32:09.197147296Z [err]  2025-12-14 07:32:09,043 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-14T07:32:09.197152702Z [err]  2025-12-14 07:32:09,037 - calling_service - INFO - â° Check-in triggered after 7.1s silence (threshold: 7s)
2025-12-14T07:32:09.197158763Z [err]  2025-12-14 07:32:09,042 - calling_service - INFO - ğŸ’¬ Sending check-in #1/2: Are you still there?
2025-12-14T07:32:09.197163315Z [err]  2025-12-14 07:32:09,043 - dead_air_monitor - INFO - ğŸ’¬ Sending check-in after 7.1s silence: Are you still there?
2025-12-14T07:32:09.197167650Z [err]  2025-12-14 07:32:09,043 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:09.197171847Z [err]  2025-12-14 07:32:09,043 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ: Are you still there?...
2025-12-14T07:32:09.197176229Z [err]  2025-12-14 07:32:09,043 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-14T07:32:09.197180634Z [err]  2025-12-14 07:32:09,043 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-14T07:32:09.197184827Z [err]  2025-12-14 07:32:09,043 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-14T07:32:09.197189445Z [err]  2025-12-14 07:32:09,043 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-14T07:32:09.197193306Z [err]  2025-12-14 07:32:09,043 - server - INFO - ğŸ’¾ TTS CACHE HIT: Returning cached audio (15509 bytes)
2025-12-14T07:32:09.197198284Z [err]  2025-12-14 07:32:09,043 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.00s
2025-12-14T07:32:09.343085116Z [err]  }
2025-12-14T07:32:09.343095369Z [err]  2025-12-14 07:32:09,333 - telnyx_service - INFO - ğŸ“¢ Using Telnyx built-in TTS
2025-12-14T07:32:09.343099638Z [err]  2025-12-14 07:32:09,333 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-14T07:32:09.343106165Z [err]  2025-12-14 07:32:09,333 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.29s
2025-12-14T07:32:09.343113026Z [err]  2025-12-14 07:32:09,333 - telnyx_service - ERROR - âŒ Telnyx playback failed: 422 - {
2025-12-14T07:32:09.343120176Z [err]    "errors": [
2025-12-14T07:32:09.343127705Z [err]      {
2025-12-14T07:32:09.343134381Z [err]        "code": "90018",
2025-12-14T07:32:09.343138481Z [err]        "title": "Call has already ended",
2025-12-14T07:32:09.343144685Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-14T07:32:09.343149102Z [err]      }
2025-12-14T07:32:09.343152911Z [err]    ]
2025-12-14T07:32:09.626383244Z [err]  2025-12-14 07:32:09,610 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-14T07:32:09.626388455Z [err]  2025-12-14 07:32:09,610 - telnyx_service - ERROR - âŒ Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-14T07:32:09.626394817Z [err]  2025-12-14 07:32:09,610 - dead_air_monitor - INFO - âœ… Check-in message sent
2025-12-14T07:32:10.191794326Z [err]  2025-12-14 07:32:10,116 - dead_air_monitor - INFO - ğŸš© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-14T07:32:10.191805502Z [err]  2025-12-14 07:32:10,116 - calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1765697530.116114 for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:10.191816135Z [err]  2025-12-14 07:32:10,116 - calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:10.191825350Z [err]  2025-12-14 07:32:10,121 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=1/2
2025-12-14T07:32:10.636767986Z [err]  2025-12-14 07:32:10,626 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=0.5s, checkin_count=1/2
2025-12-14T07:32:11.967098239Z [err]  2025-12-14 07:32:11,949 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-14T07:32:11.967104979Z [err]  2025-12-14 07:32:11,953 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-14T07:32:11.967108970Z [err]  2025-12-14 07:32:11,954 - qc_agents.orchestrator - INFO - ğŸ—ºï¸  Running Conversion Pathfinder on call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:14.518700505Z [err]  2025-12-14 07:32:14,516 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-14T07:32:14.523222599Z [err]  2025-12-14 07:32:14,520 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-14T07:32:14.523230049Z [err]  2025-12-14 07:32:14,521 - qc_agents.orchestrator - INFO - â­ Running Excellence Replicator on call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:16.045906441Z [err]  2025-12-14 07:32:16,035 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-14T07:32:16.045915394Z [err]  2025-12-14 07:32:16,039 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Expecting value: line 1 column 1 (char 0)
2025-12-14T07:32:16.132531844Z [err]  2025-12-14 07:32:16,129 - qc_agents.orchestrator - INFO - âœ… QC analysis stored for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:16.132540022Z [err]  2025-12-14 07:32:16,129 - server - INFO - âœ… QC analysis completed for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:16.132546199Z [err]  2025-12-14 07:32:16,129 - server - INFO - ğŸ“Š Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-14T07:32:16.311577190Z [err]  2025-12-14 07:32:16,305 - server - INFO - ğŸ“Š Updated campaign_calls with QC scores for v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:16.484160542Z [err]  2025-12-14 07:32:16,481 - server - INFO - ğŸ“ˆ Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-14T07:32:16.576505980Z [err]  2025-12-14 07:32:16,569 - server - INFO - ğŸ·ï¸ Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-14T07:32:16.576515951Z [err]  2025-12-14 07:32:16,569 - server - ERROR - âŒ Error in auto appointment detection for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ: 'str' object has no attribute 'get'
2025-12-14T07:32:17.303357814Z [err]  2025-12-14 07:32:17,197 - calling_service - INFO - â° Check-in triggered after 7.1s silence (threshold: 7s)
2025-12-14T07:32:17.303364902Z [err]  2025-12-14 07:32:17,202 - calling_service - INFO - ğŸ’¬ Sending FINAL check-in #2/2: Are you still there?
2025-12-14T07:32:17.303369225Z [err]  2025-12-14 07:32:17,202 - calling_service - INFO - âš ï¸ Will end call if no response after next silence timeout
2025-12-14T07:32:17.303374089Z [err]  2025-12-14 07:32:17,202 - dead_air_monitor - INFO - ğŸ’¬ Sending check-in after 7.1s silence: Are you still there?
2025-12-14T07:32:17.303378719Z [err]  2025-12-14 07:32:17,202 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:17.303384373Z [err]  2025-12-14 07:32:17,202 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ: Are you still there?...
2025-12-14T07:32:17.303388837Z [err]  2025-12-14 07:32:17,202 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-14T07:32:17.303393627Z [err]  2025-12-14 07:32:17,202 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-14T07:32:17.303397945Z [err]  2025-12-14 07:32:17,202 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-14T07:32:17.303403033Z [err]  2025-12-14 07:32:17,202 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-14T07:32:17.303407329Z [err]  2025-12-14 07:32:17,202 - server - INFO - ğŸ’¾ TTS CACHE HIT: Returning cached audio (15509 bytes)
2025-12-14T07:32:17.303412704Z [err]  2025-12-14 07:32:17,202 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.00s
2025-12-14T07:32:17.303416981Z [err]  2025-12-14 07:32:17,202 - telnyx_service - INFO - âœ… Generated 15509 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-14T07:32:17.303421042Z [err]  2025-12-14 07:32:17,202 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-14T07:32:17.423276650Z [err]  2025-12-14 07:32:17,419 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-14T07:32:17.423283300Z [err]  2025-12-14 07:32:17,420 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.22s
2025-12-14T07:32:17.423289229Z [err]  2025-12-14 07:32:17,420 - telnyx_service - ERROR - âŒ Telnyx playback failed: 422 - {
2025-12-14T07:32:17.423294430Z [err]    "errors": [
2025-12-14T07:32:17.423300773Z [err]      {
2025-12-14T07:32:17.423309491Z [err]        "code": "90018",
2025-12-14T07:32:17.423319371Z [err]        "title": "Call has already ended",
2025-12-14T07:32:17.423327838Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-14T07:32:17.423337105Z [err]      }
2025-12-14T07:32:17.423346389Z [err]    ]
2025-12-14T07:32:17.423354642Z [err]  }
2025-12-14T07:32:17.423363439Z [err]  2025-12-14 07:32:17,420 - telnyx_service - INFO - ğŸ“¢ Using Telnyx built-in TTS
2025-12-14T07:32:17.625252623Z [err]  2025-12-14 07:32:17,623 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-14T07:32:17.625257263Z [err]  2025-12-14 07:32:17,623 - telnyx_service - ERROR - âŒ Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-14T07:32:17.625261255Z [err]  2025-12-14 07:32:17,623 - dead_air_monitor - INFO - âœ… Check-in message sent
2025-12-14T07:32:20.181740124Z [err]  2025-12-14 07:32:20,179 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=2/2
2025-12-14T07:32:20.693012476Z [err]  2025-12-14 07:32:20,690 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=2/2
2025-12-14T07:32:25.836443244Z [err]  2025-12-14 07:32:25,835 - server - INFO - ğŸ¤ Soniox receiver alive - 9 messages received in last 10s
2025-12-14T07:32:25.836454707Z [err]  2025-12-14 07:32:25,836 - server - ERROR - âŒ Soniox error: {'tokens': [], 'final_audio_proc_ms': 1320, 'total_audio_proc_ms': 6840, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-14T07:32:25.837084186Z [err]  2025-12-14 07:32:25,836 - server - INFO - âœ… Soniox receive loop ended normally
2025-12-14T07:32:25.837089916Z [err]  2025-12-14 07:32:25,836 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring cancelled for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:25.837094600Z [err]  2025-12-14 07:32:25,836 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring stopped for call v3:q3-xL52v6iptvnazWduKLmXKOk9olfiyFBnQ1gi7m8Nl-1byN8t0SQ
2025-12-14T07:32:25.837098493Z [err]  2025-12-14 07:32:25,836 - server - INFO - ğŸ”‡ Dead air monitoring task cancelled
2025-12-14T07:32:26.846261103Z [err]  2025-12-14 07:32:26,837 - soniox_service - ERROR - âŒ Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-14T07:32:26.846268409Z [err]  2025-12-14 07:32:26,837 - server - INFO - ğŸ”Œ Telnyx WebSocket disconnected
2025-12-14T07:33:26.921003089Z [inf]  100.64.0.3:26960 - "GET /api/qc/enhanced/campaigns HTTP/1.1" 200
2025-12-14T07:33:26.921117968Z [inf]  100.64.0.3:26960 - "GET /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb HTTP/1.1" 200
2025-12-14T07:33:26.921125724Z [inf]  100.64.0.3:26956 - "GET /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/kb HTTP/1.1" 200
2025-12-14T07:33:26.921132635Z [inf]  100.64.0.3:26956 - "GET /api/qc/enhanced/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/auto-qc-settings HTTP/1.1" 200
2025-12-14T07:33:26.921139471Z [err]  2025-12-14 07:33:21,706 - qc_enhanced_router - INFO - Listed 1 campaigns for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:33:34.031799571Z [inf]  100.64.0.3:26960 - "PUT /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb HTTP/1.1" 200
2025-12-14T07:33:34.768538900Z [err]  2025-12-14 07:33:34,756 - qc_enhanced_router - INFO - Listed 1 campaigns for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:33:34.768545699Z [inf]  100.64.0.3:26960 - "GET /api/qc/enhanced/campaigns HTTP/1.1" 200
2025-12-14T07:33:35.077580259Z [inf]  100.64.0.3:26956 - "GET /api/qc/enhanced/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/auto-qc-settings HTTP/1.1" 200
2025-12-14T07:33:35.242024909Z [inf]  100.64.0.3:28310 - "GET /api/agents HTTP/1.1" 200
2025-12-14T07:33:38.816326089Z [err]  2025-12-14 07:33:38,812 - server - INFO - ğŸŒ Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-14T07:33:38.908008039Z [err]  2025-12-14 07:33:38,900 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:33:39.102067246Z [err]  2025-12-14 07:33:38,987 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:33:39.102072199Z [err]  2025-12-14 07:33:39,013 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-14T07:33:39.102077211Z [err]  2025-12-14 07:33:39,013 - telnyx_service - INFO - ğŸ“ Initiating outbound call from +14048000152 to +17708336397
2025-12-14T07:33:39.102081122Z [err]  2025-12-14 07:33:39,013 - telnyx_service - INFO - ğŸ¤– Enabling AMD (premium mode)
2025-12-14T07:33:39.102085249Z [err]  2025-12-14 07:33:39,013 - telnyx_service - INFO - ğŸŒ Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-14T07:33:39.766382637Z [err]  2025-12-14 07:33:39,732 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-14T07:33:39.766390361Z [err]  2025-12-14 07:33:39,733 - telnyx_service - INFO - âœ… Call initiated: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:39.848499399Z [err]  2025-12-14 07:33:39,823 - server - INFO - ğŸ“ Created call log: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:39.858889481Z [err]  2025-12-14 07:33:39,856 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ (TTL: 3600s)
2025-12-14T07:33:39.858897713Z [err]  2025-12-14 07:33:39,856 - server - INFO - ğŸ“¦ Call data stored in Redis and memory
2025-12-14T07:33:39.858903568Z [err]  2025-12-14 07:33:39,856 - server - INFO - ğŸ“ Outbound call initiated: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:39.858909033Z [inf]  100.64.0.3:28310 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-14T07:33:39.972155453Z [err]  2025-12-14 07:33:39,944 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:33:39.972166685Z [err]  2025-12-14 07:33:39,944 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.initiated', 'id': '68436502-b558-4991-9b3a-125d22551623', 'occurred_at': '2025-12-14T07:33:39.540654Z', 'payload': {'call_control_id': 'v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ', 'call_leg_id': '354adeee-d8bf-11f0-ad57-02420aef93a1', 'call_session_id': '35480be2-d8bf-11f0-84e9-02420aef93a1', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:33:39.972174642Z [err]  2025-12-14 07:33:39,944 - server - INFO - ğŸ¯ Event type: call.initiated, Call ID: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:39.972181450Z [err]  2025-12-14 07:33:39,944 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:33:39.972189242Z [err]  2025-12-14 07:33:39,944 - server - INFO - ğŸ“ Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-14T07:33:39.972196039Z [inf]  100.64.0.14:49200 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:33:40.202854515Z [err]  2025-12-14 07:33:40,171 - server - INFO - ğŸ”ŒğŸ”ŒğŸ”Œ WEBSOCKET CONNECTION ATTEMPT
2025-12-14T07:33:40.202872272Z [err]  2025-12-14 07:33:40,171 - server - INFO -    Client: Address(host='100.64.0.16', port=49210)
2025-12-14T07:33:40.202877045Z [err]  2025-12-14 07:33:40,171 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'T2yWNZlH3zJM8YMvK73cKg==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'jK3ae_XUTTerLnNA2prcFg', 'x-real-ip': '192.76.120.151', 'x-request-start': '1765697619934', 'accept-encoding': 'gzip'}
2025-12-14T07:33:40.202882564Z [err]  2025-12-14 07:33:40,171 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-14T07:33:40.202886541Z [err]  2025-12-14 07:33:40,171 - server - INFO - ğŸ”Œ Incoming Telnyx WebSocket connection
2025-12-14T07:33:40.202890499Z [err]  [2025-12-14 07:33:40 +0000] [4] [INFO] ('100.64.0.16', 49210) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-14T07:33:40.202894345Z [err]  2025-12-14 07:33:40,172 - server - INFO - âœ… WebSocket accepted, waiting for Telnyx events
2025-12-14T07:33:40.202899122Z [err]  [2025-12-14 07:33:40 +0000] [4] [INFO] connection open
2025-12-14T07:33:40.335612470Z [err]  2025-12-14 07:33:40,329 - server - INFO - ğŸ“¬ Received Telnyx event: connected
2025-12-14T07:33:40.335620581Z [err]  2025-12-14 07:33:40,329 - server - INFO - ğŸ“ Telnyx connected event received, waiting for 'start'...
2025-12-14T07:33:44.331706518Z [err]  2025-12-14 07:33:44,319 - server - INFO - ğŸ“¬ Received Telnyx event: start
2025-12-14T07:33:44.331711814Z [err]  2025-12-14 07:33:44,319 - server - INFO - ğŸ¬ Stream started for call: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:44.331717137Z [err]  2025-12-14 07:33:44,321 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:33:44.331724170Z [err]  2025-12-14 07:33:44,322 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.answered', 'id': 'f2216f82-2e39-4307-9edc-e880101c2341', 'occurred_at': '2025-12-14T07:33:44.080645Z', 'payload': {'call_control_id': 'v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ', 'call_leg_id': '354adeee-d8bf-11f0-ad57-02420aef93a1', 'call_session_id': '35480be2-d8bf-11f0-84e9-02420aef93a1', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-14T07:33:39.540654Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:33:44.331729957Z [err]  2025-12-14 07:33:44,322 - server - INFO - ğŸ¯ Event type: call.answered, Call ID: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:44.331737225Z [err]  2025-12-14 07:33:44,322 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:33:44.331742864Z [err]  2025-12-14 07:33:44,322 - server - INFO - âœ… Call answered: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:44.368453140Z [err]  2025-12-14 07:33:44,351 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:44.368463181Z [err]  2025-12-14 07:33:44,352 - server - INFO - âœ… Call data found after 0s wait
2025-12-14T07:33:44.368469840Z [err]  2025-12-14 07:33:44,352 - server - INFO - â³ Session not found locally, waiting briefly for webhook...
2025-12-14T07:33:44.368475912Z [err]  2025-12-14 07:33:44,353 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:44.368481460Z [err]  2025-12-14 07:33:44,354 - server - INFO - âœ… Found call in Redis (multi-worker state sharing working)
2025-12-14T07:33:44.368487848Z [err]  2025-12-14 07:33:44,354 - server - INFO - ğŸ“ Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-14T07:33:44.456982053Z [err]  2025-12-14 07:33:44,454 - server - INFO - âœ… Call log updated
2025-12-14T07:33:44.456989357Z [err]  2025-12-14 07:33:44,454 - server - INFO - ğŸ”§ Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:33:44.548404173Z [err]  2025-12-14 07:33:44,543 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:33:44.661559502Z [err]  2025-12-14 07:33:44,630 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:33:44.661563017Z [err]  2025-12-14 07:33:44,630 - server - INFO - ğŸ”§ Creating Telnyx service with user's keys...
2025-12-14T07:33:44.661566904Z [err]  2025-12-14 07:33:44,652 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-14T07:33:44.830589682Z [err]  2025-12-14 07:33:44,829 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:33:44.830600016Z [err]  2025-12-14 07:33:44,829 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'streaming.started', 'id': 'd1b3d5e9-221a-49e3-85e8-48e47d42031a', 'occurred_at': '2025-12-14T07:33:44.440649Z', 'payload': {'call_control_id': 'v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ', 'call_leg_id': '354adeee-d8bf-11f0-ad57-02420aef93a1', 'call_session_id': '35480be2-d8bf-11f0-84e9-02420aef93a1', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '1e65489b-e35f-4eca-90c3-81de1f0d6e7d', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:33:44.830606568Z [err]  2025-12-14 07:33:44,829 - server - INFO - ğŸ¯ Event type: streaming.started, Call ID: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:44.830613421Z [err]  2025-12-14 07:33:44,829 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:33:44.830620755Z [inf]  100.64.0.14:10754 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:33:44.868396367Z [err]  2025-12-14 07:33:44,852 - server - INFO - âš ï¸ Session still not found after wait, will create in worker
2025-12-14T07:33:44.868403809Z [err]  2025-12-14 07:33:44,853 - server - WARNING - âš ï¸ Session not found after waiting, creating in WebSocket worker...
2025-12-14T07:33:44.873063295Z [err]  2025-12-14 07:33:44,869 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:44.873071631Z [err]  2025-12-14 07:33:44,870 - server - INFO - ğŸ“ Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:33:44.873078301Z [err]  2025-12-14 07:33:44,870 - calling_service - INFO - ğŸ” Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-14T07:33:45.154035293Z [err]  2025-12-14 07:33:44,968 - calling_service - INFO - ğŸ“‹ Built cached system prompt: 4159 chars (global) + 866 chars (technical)
2025-12-14T07:33:45.154043803Z [err]  2025-12-14 07:33:44,968 - calling_service - INFO - ğŸ“š KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-14T07:33:45.154052183Z [err]  2025-12-14 07:33:44,957 - calling_service - INFO - ğŸ” KB count query completed: 4 items
2025-12-14T07:33:45.154063108Z [err]  2025-12-14 07:33:45,065 - calling_service - INFO - âœ… LLM client pre-warmed in 97ms
2025-12-14T07:33:45.154071074Z [err]  2025-12-14 07:33:44,957 - calling_service - INFO - ğŸ“š Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-14T07:33:45.154071688Z [err]  2025-12-14 07:33:45,065 - server - INFO - âœ… Session created in WebSocket worker
2025-12-14T07:33:45.154082431Z [err]  2025-12-14 07:33:45,065 - server - INFO - ğŸ“ Call data loaded, starting SONIOX connection...
2025-12-14T07:33:45.154091732Z [err]  2025-12-14 07:33:45,066 - server - INFO - âœ… Initialized call_states for v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ with session reference
2025-12-14T07:33:45.154095235Z [err]  2025-12-14 07:33:45,105 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ/actions/playback_start "HTTP/1.1 200 OK"
2025-12-14T07:33:45.154100528Z [err]  2025-12-14 07:33:44,968 - calling_service - INFO - ğŸ”¥ Pre-warming LLM client (grok)...
2025-12-14T07:33:45.154100966Z [err]  2025-12-14 07:33:45,106 - telnyx_service - INFO - ğŸ™ï¸ Starting recording: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:45.154106852Z [err]  2025-12-14 07:33:45,057 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:33:45.154107080Z [err]  2025-12-14 07:33:45,105 - telnyx_service - INFO - âœ… Playing audio from URL, playback_id: eCL8_cnQhA (loop=True, overlay=True)
2025-12-14T07:33:45.154114132Z [err]  2025-12-14 07:33:45,106 - server - WARNING - âš ï¸ Failed to start comfort noise: 'v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ'
2025-12-14T07:33:45.158136406Z [err]  2025-12-14 07:33:45,155 - server - INFO - ğŸ”‘ Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-14T07:33:45.662379751Z [err]  2025-12-14 07:33:45,661 - soniox_service - INFO - âœ… Connected to Soniox Real-Time STT
2025-12-14T07:33:45.662383928Z [err]  2025-12-14 07:33:45,661 - soniox_service - INFO - âš™ï¸  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-14T07:33:45.662388288Z [err]  2025-12-14 07:33:45,661 - soniox_service - INFO - âš™ï¸  Endpoint detection: True, Speaker diarization: False
2025-12-14T07:33:45.686950760Z [err]  2025-12-14 07:33:45,682 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-14T07:33:45.686956211Z [err]  2025-12-14 07:33:45,682 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring started for call v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:45.691475127Z [err]  2025-12-14 07:33:45,688 - server - INFO - âœ… Started forwarding audio (8kHz mulaw â†’ Soniox, NO BUFFERING)
2025-12-14T07:33:46.722135469Z [err]  2025-12-14 07:33:46,682 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ/actions/record_start "HTTP/1.1 200 OK"
2025-12-14T07:33:46.722144863Z [err]  2025-12-14 07:33:46,683 - server - INFO - ğŸ™ï¸ Call recording started for v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:46.722153574Z [err]  2025-12-14 07:33:46,683 - server - INFO - ğŸ”§ Creating call session for v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ...
2025-12-14T07:33:46.722161346Z [err]  2025-12-14 07:33:46,683 - server - INFO - ğŸ” Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-14T07:33:46.722170447Z [err]  2025-12-14 07:33:46,683 - server - INFO - ğŸ”§ Calling create_call_session() - START
2025-12-14T07:33:46.722178518Z [err]  2025-12-14 07:33:46,683 - calling_service - INFO - ğŸ” Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-14T07:33:46.729063317Z [inf]  100.64.0.6:59320 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-14T07:33:46.775147095Z [err]  2025-12-14 07:33:46,771 - calling_service - INFO - ğŸ” KB count query completed: 4 items
2025-12-14T07:33:46.775155577Z [err]  2025-12-14 07:33:46,771 - calling_service - INFO - ğŸ“š Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-14T07:33:46.785699280Z [err]  2025-12-14 07:33:46,781 - calling_service - INFO - ğŸ“‹ Built cached system prompt: 4159 chars (global) + 866 chars (technical)
2025-12-14T07:33:46.785708939Z [err]  2025-12-14 07:33:46,781 - calling_service - INFO - ğŸ“š KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-14T07:33:46.785716265Z [err]  2025-12-14 07:33:46,781 - calling_service - INFO - ğŸ”¥ Pre-warming LLM client (grok)...
2025-12-14T07:33:46.872312305Z [err]  2025-12-14 07:33:46,868 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:33:46.877005075Z [err]  2025-12-14 07:33:46,875 - calling_service - INFO - âœ… LLM client pre-warmed in 94ms
2025-12-14T07:33:46.877012683Z [err]  2025-12-14 07:33:46,875 - server - INFO - ğŸ”§ Calling create_call_session() - COMPLETE
2025-12-14T07:33:46.877017084Z [err]  2025-12-14 07:33:46,875 - server - INFO - âœ… Session object created: CallSession
2025-12-14T07:33:46.920078575Z [err]  2025-12-14 07:33:46,902 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ (TTL: 3600s)
2025-12-14T07:33:46.920086613Z [err]  2025-12-14 07:33:46,902 - server - INFO - âœ… Serializable call_data synced to Redis (agent_id, user_id)
2025-12-14T07:33:46.920091679Z [err]  2025-12-14 07:33:46,902 - server - INFO - âœ… Session stored in worker memory (not Redis)
2025-12-14T07:33:46.920096052Z [err]  2025-12-14 07:33:46,907 - redis_service - INFO - âœ… Marked session ready in Redis: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:46.920100677Z [err]  2025-12-14 07:33:46,908 - server - INFO - ğŸ¤– AI session created for call v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:46.920106105Z [err]  2025-12-14 07:33:46,908 - server - INFO - ğŸ“¦ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-14T07:33:46.920114051Z [err]  2025-12-14 07:33:46,908 - server - INFO - â­ï¸ Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-14T07:33:46.920121708Z [err]  2025-12-14 07:33:46,908 - server - INFO - ğŸ‘¤ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-14T07:33:46.920128129Z [err]  2025-12-14 07:33:46,908 - server - INFO - ğŸ‘‚ User speaks first - waiting for user input...
2025-12-14T07:33:46.920134305Z [err]  2025-12-14 07:33:46,908 - server - ERROR - Error processing webhook: cannot access local variable 'asyncio' where it is not associated with a value
2025-12-14T07:33:46.920140104Z [inf]  100.64.0.14:49200 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:33:47.855883590Z [err]  2025-12-14 07:33:47,851 - server - INFO - ğŸ”¤ RAW TOKENS: ["H"?]
2025-12-14T07:33:47.855889879Z [err]  2025-12-14 07:33:47,854 - calling_service - INFO - ğŸ”Š Silence timer reset for call v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ (user started speaking)
2025-12-14T07:33:47.855893888Z [err]  2025-12-14 07:33:47,854 - calling_service - INFO - ğŸ‘¤ User started speaking for call v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:47.855898443Z [err]  2025-12-14 07:33:47,854 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-14T07:33:48.167641126Z [err]  2025-12-14 07:33:48,030 - server - INFO - ğŸ”¤ RAW TOKENS: ["H"?, "ello"?]
2025-12-14T07:33:48.167644681Z [err]  2025-12-14 07:33:48,031 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'Hello' | Generating: False
2025-12-14T07:33:48.171747680Z [err]  2025-12-14 07:33:48,170 - server - INFO - ğŸ”¤ RAW TOKENS: ["H"âœ“, "ello"âœ“, "?"âœ“, "<end>"âœ“]
2025-12-14T07:33:48.171756549Z [err]  2025-12-14 07:33:48,171 - server - INFO - ğŸ¯ Endpoint detected: <end> token received
2025-12-14T07:33:48.171762119Z [err]  2025-12-14 07:33:48,171 - server - INFO - ğŸ§¹ Cleaned transcript: 'H ello ?' -> 'Hello?'
2025-12-14T07:33:48.171766545Z [err]  2025-12-14 07:33:48,171 - server - INFO - ğŸ“¥ FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-14T07:33:48.171770856Z [err]  2025-12-14 07:33:48,171 - server - INFO - ğŸ¤ Soniox final transcript: 'Hello?'
2025-12-14T07:33:48.176275194Z [err]  2025-12-14 07:33:48,171 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:yBYc8d2f30wrzGcRF... (active sessions: [])
2025-12-14T07:33:48.176285784Z [err]  2025-12-14 07:33:48,171 - server - INFO - ğŸ” FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-14T07:33:48.176294994Z [err]  2025-12-14 07:33:48,172 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:yBYc8d2f30wrzGcRF... (active sessions: [])
2025-12-14T07:33:48.176301975Z [err]  2025-12-14 07:33:48,172 - server - INFO - ğŸš€ Spawned tracked background task for endpoint processing
2025-12-14T07:33:48.176307851Z [err]  2025-12-14 07:33:48,172 - server - INFO - â±ï¸ [07:33:48.172] ğŸ“ FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-14T07:33:48.176312206Z [err]  2025-12-14 07:33:48,172 - server - INFO - â±ï¸ [07:33:48.172] STT endpoint detection latency: 19ms
2025-12-14T07:33:48.176316398Z [err]  2025-12-14 07:33:48,172 - server - INFO - â±ï¸ [07:33:48.172] ğŸ¤ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-14T07:33:48.180539049Z [err]  2025-12-14 07:33:48,177 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ (TTL: 3600s)
2025-12-14T07:33:48.180548199Z [err]  2025-12-14 07:33:48,177 - server - INFO - ğŸ‘¤ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-14T07:33:48.180554985Z [err]  2025-12-14 07:33:48,177 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:yBYc8d2f30wrzGcRF... (active sessions: [])
2025-12-14T07:33:48.180561248Z [err]  2025-12-14 07:33:48,177 - server - INFO - âœ… Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-14T07:33:48.189570280Z [err]  2025-12-14 07:33:48,188 - server - INFO - ğŸ¤ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-14T07:33:48.189578945Z [err]  2025-12-14 07:33:48,188 - calling_service - INFO - ğŸ‘¤ User stopped speaking for call v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:48.189586553Z [err]  2025-12-14 07:33:48,188 - server - INFO - â±ï¸ [TIMING] STT_START: User last audio packet received
2025-12-14T07:33:48.189592631Z [err]  2025-12-14 07:33:48,188 - server - INFO - â±ï¸ [TIMING] STT_END: Endpoint detected at T+10ms
2025-12-14T07:33:48.189598797Z [err]  2025-12-14 07:33:48,188 - server - INFO - â±ï¸ [TIMING] STT_LATENCY: 10ms (Soniox model: stt-rt-v3)
2025-12-14T07:33:48.189605125Z [err]  2025-12-14 07:33:48,188 - server - INFO - â±ï¸  USER STOPPED SPEAKING at T=0ms
2025-12-14T07:33:48.189611383Z [err]  2025-12-14 07:33:48,188 - server - INFO - ğŸ™ï¸ Agent generating response - interruption detection active
2025-12-14T07:33:48.189617973Z [err]  2025-12-14 07:33:48,188 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:48.332125284Z [err]  2025-12-14 07:33:48,279 - server - INFO - ğŸ“¤ Sentence arrived from LLM: Kendrick?...
2025-12-14T07:33:48.332127049Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - ğŸ”§ Replaced {{to_number}} with +17708336397 in content
2025-12-14T07:33:48.332132922Z [err]  2025-12-14 07:33:48,279 - server - INFO - â±ï¸ [TIMING] TTFS (Time To First Sentence): 91ms
2025-12-14T07:33:48.332134502Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - ğŸ”§ Replaced {{phone_number}} with +17708336397 in content
2025-12-14T07:33:48.332139365Z [err]  2025-12-14 07:33:48,279 - server - INFO - âš¡ Starting REAL-TIME TTS for first sentence
2025-12-14T07:33:48.332141308Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - ğŸ”§ Replaced {{email}} with None in content
2025-12-14T07:33:48.332145265Z [err]  2025-12-14 07:33:48,279 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:yBYc8d2f30wrzGcRF... (active sessions: [])
2025-12-14T07:33:48.332149221Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - ğŸ”§ Replaced {{callerName}} with  in content
2025-12-14T07:33:48.332149515Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - âœ… Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-14T07:33:48.332160158Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - ğŸ”§ Replaced {{lead_id}} with None in content
2025-12-14T07:33:48.332162928Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-14T07:33:48.332167491Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - ğŸ”§ Replaced {{qc_tracking_enabled}} with False in content
2025-12-14T07:33:48.332174901Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - ğŸ“š skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-14T07:33:48.332184159Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - â±ï¸ [07:33:48.279] ğŸ“„ About to process content (mode=script, length=9)
2025-12-14T07:33:48.332191443Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - ğŸ“¤ Streaming script as 1 sentence(s)
2025-12-14T07:33:48.332230022Z [err]  2025-12-14 07:33:48,278 - server - INFO - ğŸ“ Saved user transcript to database
2025-12-14T07:33:48.332233167Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - ğŸ”§ Replaced {{track_keywords}} with  in content
2025-12-14T07:33:48.332236846Z [err]  2025-12-14 07:33:48,278 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:yBYc8d2f30wrzGcRF... (active sessions: [])
2025-12-14T07:33:48.332243231Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - ğŸ”§ Replaced {{expected_commitment}} with not_specified in content
2025-12-14T07:33:48.332243838Z [err]  2025-12-14 07:33:48,278 - calling_service - INFO - â±ï¸ [07:33:48.278] ğŸ“¥ process_user_input() ENTRY - text: 'Hello?...'
2025-12-14T07:33:48.332250165Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - â±ï¸ [07:33:48.279] â© About to call _process_call_flow_streaming()
2025-12-14T07:33:48.332256428Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - â±ï¸ [07:33:48.279] ğŸ”€ Agent type: call_flow, calling flow processor...
2025-12-14T07:33:48.332261872Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - â±ï¸ [07:33:48.279] ğŸ”€ _process_call_flow_streaming() ENTRY
2025-12-14T07:33:48.332267551Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-14T07:33:48.332272919Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - â±ï¸ [07:33:48.279] âœ… Node selected, about to process content...
2025-12-14T07:33:48.332280377Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - ğŸ”§ Replaced {{now}} with Sunday, December 14, 2025 at 2:33 AM EST in content
2025-12-14T07:33:48.332286210Z [err]  2025-12-14 07:33:48,279 - calling_service - INFO - ğŸ”§ Replaced {{customer_name}} with Kendrick in content
2025-12-14T07:33:48.335947755Z [err]  2025-12-14 07:33:48,279 - server - INFO - âš¡ ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-14T07:33:48.335954022Z [err]  2025-12-14 07:33:48,281 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:33:48.335958882Z [err]  2025-12-14 07:33:48,281 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.started', 'id': 'd098d688-31a0-4119-9746-e5ece64b98da', 'occurred_at': '2025-12-14T07:33:47.900648Z', 'payload': {'call_control_id': 'v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ', 'call_leg_id': '354adeee-d8bf-11f0-ad57-02420aef93a1', 'call_session_id': '35480be2-d8bf-11f0-84e9-02420aef93a1', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'eCL8_cnQhA', 'start_time': '2025-12-14T07:33:47.900648Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:33:48.335962748Z [err]  2025-12-14 07:33:48,281 - server - INFO - ğŸ¯ Event type: call.playback.started, Call ID: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:48.335966272Z [err]  2025-12-14 07:33:48,281 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:33:48.335970366Z [inf]  100.64.0.16:27666 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:33:48.369206813Z [err]  2025-12-14 07:33:48,366 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:33:48.460988948Z [err]  2025-12-14 07:33:48,453 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:33:48.564187808Z [err]  2025-12-14 07:33:48,540 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-14T07:33:48.564193576Z [err]  2025-12-14 07:33:48,559 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-14T07:33:48.564197379Z [err]  2025-12-14 07:33:48,559 - server - INFO - âœ… ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-14T07:33:48.564201168Z [err]  2025-12-14 07:33:48,559 - persistent_tts_service - INFO - ğŸ™ï¸ Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-14T07:33:48.564204819Z [err]  2025-12-14 07:33:48,559 - persistent_tts_service - INFO - ğŸ”Œ [Call v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ] Establishing persistent TTS WebSocket...
2025-12-14T07:33:48.564209957Z [err]  2025-12-14 07:33:48,559 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-14T07:33:48.564213502Z [err]  2025-12-14 07:33:48,559 - elevenlabs_ws_service - INFO - ğŸ”Œ Connecting to ElevenLabs WebSocket: voice=Aa6nEBJJMKJwJkCx8VU2, model=eleven_flash_v2_5
2025-12-14T07:33:48.564217159Z [err]  2025-12-14 07:33:48,559 - elevenlabs_ws_service - INFO - ğŸ™ï¸ Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-14T07:33:48.692356642Z [err]  2025-12-14 07:33:48,687 - elevenlabs_ws_service - INFO - âœ… Connected to ElevenLabs WebSocket
2025-12-14T07:33:48.692360878Z [err]  2025-12-14 07:33:48,688 - server - INFO - ğŸš€ Streaming sentence #1 via persistent WebSocket
2025-12-14T07:33:48.692362892Z [err]  2025-12-14 07:33:48,688 - elevenlabs_ws_service - INFO - ğŸ“¤ Sent BOS message with voice settings
2025-12-14T07:33:48.692368567Z [err]  2025-12-14 07:33:48,688 - server - INFO - ğŸµ TTS task #1 started at +408ms
2025-12-14T07:33:48.692368754Z [err]  2025-12-14 07:33:48,688 - persistent_tts_service - INFO - âœ… [Call v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ] Persistent TTS WebSocket established
2025-12-14T07:33:48.692375415Z [err]  2025-12-14 07:33:48,688 - server - INFO - â±ï¸ [TIMING] TTFT_TTS (First TTS Task Started): 500ms
2025-12-14T07:33:48.692375635Z [err]  2025-12-14 07:33:48,688 - persistent_tts_service - INFO - ğŸ”Š [Call v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ] Comfort noise loop started
2025-12-14T07:33:48.692381461Z [err]  2025-12-14 07:33:48,688 - persistent_tts_service - INFO - âœ… Created persistent TTS session for call v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:48.692381785Z [err]  2025-12-14 07:33:48,688 - calling_service - INFO - ğŸ“¤ Streamed script sentence 1/1: Kendrick?...
2025-12-14T07:33:48.692387816Z [err]  2025-12-14 07:33:48,688 - server - INFO - âœ… ON-DEMAND: Persistent TTS session created successfully!
2025-12-14T07:33:48.692387867Z [err]  2025-12-14 07:33:48,688 - calling_service - INFO - ğŸ”Š Silence tracking reset for call v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ (user responded)
2025-12-14T07:33:48.692394099Z [err]  2025-12-14 07:33:48,688 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:yBYc8d2f30wrzGcRF..., session=FOUND
2025-12-14T07:33:48.692394182Z [err]  2025-12-14 07:33:48,688 - calling_service - INFO - âœ… User responded to regular message, resetting counter
2025-12-14T07:33:48.692904340Z [err]  2025-12-14 07:33:48,688 - persistent_tts_service - INFO - ğŸ”Š [Call v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ] Starting comfort noise loop
2025-12-14T07:33:48.692909564Z [err]  2025-12-14 07:33:48,688 - comfort_noise - INFO - ğŸµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-14T07:33:48.692926941Z [err]  2025-12-14 07:33:48,688 - calling_service - INFO - ğŸ’¾ Storing node ID 2 in conversation history
2025-12-14T07:33:48.692935951Z [err]  2025-12-14 07:33:48,688 - calling_service - INFO - LLM response (0.41s): Kendrick?
2025-12-14T07:33:48.692942623Z [err]  2025-12-14 07:33:48,688 - calling_service - INFO - Total latency: 0.41s
2025-12-14T07:33:48.692948510Z [err]  2025-12-14 07:33:48,688 - server - INFO - âœ… LLM finished in 500ms, TTS tasks already running in background
2025-12-14T07:33:48.692954588Z [err]  2025-12-14 07:33:48,688 - server - INFO - ğŸµ Streaming 1 TTS chunks as they complete...
2025-12-14T07:33:48.692960857Z [err]  2025-12-14 07:33:48,688 - server - INFO - ğŸš€ Persistent TTS: Audio already streaming in background!
2025-12-14T07:33:48.692967385Z [err]  2025-12-14 07:33:48,688 - server - INFO -    1 sentences queued and playing seamlessly
2025-12-14T07:33:48.692973443Z [err]  2025-12-14 07:33:48,688 - persistent_tts_service - INFO - ğŸµ [Call v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ] Playback consumer started
2025-12-14T07:33:48.692979364Z [err]  2025-12-14 07:33:48,688 - persistent_tts_service - INFO - ğŸ’“ [Call v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ] Starting TTS keep-alive loop (every 15s)
2025-12-14T07:33:49.168968744Z [err]  2025-12-14 07:33:49,032 - server - INFO - ğŸ¯ Event type: call.machine.premium.detection.ended, Call ID: v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:49.168978231Z [err]  2025-12-14 07:33:49,032 - server - INFO - ğŸ“¨ ================================================
2025-12-14T07:33:49.168986297Z [inf]  100.64.0.5:60546 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-14T07:33:49.169042849Z [err]  2025-12-14 07:33:49,032 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-14T07:33:49.169047238Z [err]  2025-12-14 07:33:49,032 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': '521d3d45-5b82-49a4-a5de-72a179a5b127', 'occurred_at': '2025-12-14T07:33:48.600649Z', 'payload': {'call_control_id': 'v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ', 'call_leg_id': '354adeee-d8bf-11f0-ad57-02420aef93a1', 'call_session_id': '35480be2-d8bf-11f0-84e9-02420aef93a1', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-14T07:33:49.363021837Z [err]  2025-12-14 07:33:49,354 - comfort_noise - INFO - âœ… Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-14T07:33:49.470103230Z [err]  2025-12-14 07:33:49,460 - server - INFO - â±ï¸  FIRST AUDIO STARTED: 1272ms from user stop ğŸš€
2025-12-14T07:33:49.470112825Z [err]  2025-12-14 07:33:49,460 - calling_service - INFO - ğŸ¤– Agent started speaking for call v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ
2025-12-14T07:33:49.470119955Z [err]  2025-12-14 07:33:49,460 - server - INFO - âœ… Agent generation complete - response window closed
2025-12-14T07:33:49.470126223Z [err]  2025-12-14 07:33:49,460 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-14T07:33:49.470131033Z [err]  2025-12-14 07:33:49,460 - server - INFO - â±ï¸  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-14T07:33:49.470135886Z [err]  2025-12-14 07:33:49,460 - server - INFO - â±ï¸  [TIMING] STT: 10ms (provider: soniox, model: stt-rt-v3)
2025-12-14T07:33:49.470140303Z [err]  2025-12-14 07:33:49,460 - server - INFO - â±ï¸  [TIMING] LLM_TOTAL: 500ms (provider: grok, model: grok-4-fast-non-reasoning)
2025-12-14T07:33:49.470144903Z [err]  2025-12-14 07:33:49,461 - server - INFO - â±ï¸  [TIMING] TTS_TOTAL: 1181ms (provider: elevenlabs, websocket: False)
2025-12-14T07:33:49.470167208Z [err]  2025-12-14 07:33:49,446 - comfort_noise - INFO - âœ… Generated mulaw comfort noise: 240000 bytes
2025-12-14T07:33:49.470173222Z [err]  2025-12-14 07:33:49,447 - persistent_tts_service - INFO - ğŸ¤ [Call v3:yBYc8d2f30wrzGcRFvnWE0FL1DdOFbXGeHO-wfEVlCC_gGZdvwCnqQ] Streaming sentence #1: Kendrick?...
2025-12-14T07:33:49.470179779Z [err]  2025-12-14 07:33:49,460 - elevenlabs_ws_service - INFO - ğŸ’¬ ElevenLabs message: A voice with voice_id Aa6nEBJJMKJwJkCx8VU2 does not exist.
2025-12-14T07:33:49.470186334Z [err]  2025-12-14 07:33:49,460 - server - INFO - âœ… All 1 persistent TTS streams completed
2025-12-14T07:33:49.470191514Z [err]  2025-12-14 07:33:49,460 - server - INFO - âœ… Agent generation complete (persistent TTS) - response window closed
2025-12-14T07:33:49.470350762Z [err]  2025-12-14 07:33:49,461 - server - INFO - â±ï¸  [TIMING] E2E_TOTAL: 1272ms (user stopped â†’ play_audio_url called)
2025-12-14T07:33:49.470354963Z [err]  2025-12-14 07:33:49,461 - server - INFO - â±ï¸  [TIMING] âš ï¸ NOTE: E2E_TOTAL does not include:
2025-12-14T07:33:49.470359875Z [err]  2025-12-14 07:33:49,461 - server - INFO - â±ï¸  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-14T07:33:49.470363821Z [err]  2025-12-14 07:33:49,461 - server - INFO - â±ï¸  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-14T07:33:49.470367643Z [err]  2025-12-14 07:33:49,461 - server - INFO - â±ï¸  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-14T07:33:49.470371460Z [err]  2025-12-14 07:33:49,461 - server - INFO - â±ï¸  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-14T07:33:49.470375248Z [err]  2025-12-14 07:33:49,461 - server - INFO - â±ï¸  [TIMING]   - REAL USER LATENCY: 1572ms estimated
2025-12-14T07:33:49.470379013Z [err]  2025-12-14 07:33:49,461 - server - INFO - â±ï¸  [TIMING] RESPONSE_TEXT: 9 chars, 1 sentences
2025-12-14T07:33:49.470382771Z [err]  2025-12-14 07:33:49,461 - server - INFO - â±ï¸  [TIMING] USER_INPUT: 'Hello?...'
2025-12-14T07:33:49.470386542Z [err]  2025-12-14 07:33:49,461 - server - INFO - â±ï¸  [TIMING] AI_RESPONSE: 'Kendrick?...'
2025-12-14T07:33:49.470390063Z [err]  2025-12-14 07:33:49,461 - server - INFO - â±ï¸  [TIMING] ==========================
2025-12-14T07:33:49.470393779Z [err]  2025-12-14 07:33:49,461 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-14T07:33:49.646876171Z [err]  2025-12-14 07:33:49,642 - server - INFO - ğŸ“ Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 1010ms)
2025-12-14T07:33:49.646882979Z [err]  2025-12-14 07:33:49,642 - server - INFO - ğŸ”Š Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-14T07:33:50.494330362Z [err]  2025-12-14 07:33:50,479 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-14T07:33:50.703770904Z [err]  2025-12-14 07:33:50,692 - server - INFO - ğŸ“¤ Audio flowing: 301 packets sent to Soniox (5s update)
2025-12-14T07:33:51.000116983Z [err]  2025-12-14 07:33:50,990 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-14T07:33:55.704057737Z [err]  2025-12-14 07:33:55,699 - server - INFO - ğŸ“¤ Audio flowing: 551 packets sent to Soniox (5s update)
2025-12-14T07:33:56.014422930Z [err]  2025-12-14 07:33:56,012 - server - INFO - ğŸ¤ Soniox receiver alive - 12 messages received in last 10s
2025-12-14T07:34:00.310837016Z [err]  2025-12-14 07:34:00,177 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-14T07:34:00.689699120Z [err]  2025-12-14 07:34:00,687 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-14T07:34:00.721085469Z [err]  2025-12-14 07:34:00,712 - server - INFO - ğŸ“¤ Audio flowing: 802 packets sent to Soniox (5s update)
2025-12-14T07:34:03.696103567Z [err]  2025-12-14 07:34:03,689 - elevenlabs_ws_service - ERROR - âŒ Error sending text to ElevenLabs: received 1008 (policy violation) A voice with voice_id Aa6nEBJJMKJwJkCx8VU2 does not exist.; then sent 1008 (policy violation) A voice with voice_id Aa6nEBJJMKJwJkCx8VU2 does not exist.
2025-12-14T07:34:05.715142643Z [err]  2025-12-14 07:34:05,713 - server - INFO - ğŸ“¤ Audio flowing: 1052 packets sent to Soniox (5s update)
2025-12-14T07:34:06.819606079Z [err]  2025-12-14 07:34:06,818 - server - INFO - ğŸ¤ Soniox receiver alive - 10 messages received in last 10s