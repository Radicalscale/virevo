2025-12-29T14:22:35.000000000Z [inf]  Starting Container
2025-12-29T14:22:36.336001095Z [inf]  =========================================
2025-12-29T14:22:36.338243923Z [inf]  üöÄ START.SH SCRIPT IS EXECUTING
2025-12-29T14:22:36.338260451Z [inf]  =========================================
2025-12-29T14:22:36.338265886Z [inf]  üìç Working directory: /app/backend
2025-12-29T14:22:36.338272450Z [inf]  üîç Python path: /app/backend
2025-12-29T14:22:36.338278750Z [inf]  üåê Starting Gunicorn on 0.0.0.0:8080...
2025-12-29T14:22:36.338284549Z [inf]  =========================================
2025-12-29T14:22:36.338291254Z [err]  [2025-12-29 14:22:36 +0000] [1] [INFO] Starting gunicorn 22.0.0
2025-12-29T14:22:36.338296978Z [err]  [2025-12-29 14:22:36 +0000] [1] [INFO] Listening at: http://0.0.0.0:8080 (1)
2025-12-29T14:22:36.338303119Z [err]  [2025-12-29 14:22:36 +0000] [1] [INFO] Using worker: uvicorn.workers.UvicornWorker
2025-12-29T14:22:36.338309738Z [err]  [2025-12-29 14:22:36 +0000] [3] [INFO] Booting worker with pid: 3
2025-12-29T14:22:36.338315533Z [err]  [2025-12-29 14:22:36 +0000] [4] [INFO] Booting worker with pid: 4
2025-12-29T14:22:36.338321616Z [err]  [2025-12-29 14:22:36 +0000] [5] [INFO] Booting worker with pid: 5
2025-12-29T14:22:36.338327130Z [err]  [2025-12-29 14:22:36 +0000] [6] [INFO] Booting worker with pid: 6
2025-12-29T14:22:56.333995361Z [err]  2025-12-29 14:22:49,607 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-29T14:22:56.334007670Z [err]  2025-12-29 14:22:49,607 - server - INFO - üî• Pre-warming connection libraries...
2025-12-29T14:22:56.334015038Z [err]  2025-12-29 14:22:49,613 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-29T14:22:56.334021552Z [err]  2025-12-29 14:22:49,613 - server - INFO - üî• Pre-warming connection libraries...
2025-12-29T14:22:56.334028368Z [err]  2025-12-29 14:22:49,642 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-29T14:22:56.334034894Z [err]  2025-12-29 14:22:49,645 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-29T14:22:56.334040791Z [err]  2025-12-29 14:22:49,728 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-29T14:22:56.334046580Z [err]  2025-12-29 14:22:49,728 - server - INFO - üî• Pre-warming connection libraries...
2025-12-29T14:22:56.334052306Z [err]  2025-12-29 14:22:49,755 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-29T14:22:56.334059116Z [err]  2025-12-29 14:22:49,771 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-29T14:22:56.334065471Z [err]  2025-12-29 14:22:49,772 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-29T14:22:56.334072334Z [err]  2025-12-29 14:22:49,880 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-29T14:22:56.334078484Z [err]  2025-12-29 14:22:49,881 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-29T14:22:56.334082724Z [err]  2025-12-29 14:22:49,885 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-29T14:22:56.336234376Z [err]  2025-12-29 14:22:49,890 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-29T14:22:56.336239376Z [err]  2025-12-29 14:22:49,890 - server - INFO - üî• Pre-warming connection libraries...
2025-12-29T14:22:56.336243554Z [err]  2025-12-29 14:22:49,914 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-29T14:22:56.336248223Z [err]  2025-12-29 14:22:49,926 - server - INFO - ‚úÖ QC agent router loaded
2025-12-29T14:22:56.336252421Z [err]  2025-12-29 14:22:49,927 - server - INFO - ‚úÖ QC agent router loaded
2025-12-29T14:22:56.336256928Z [err]  2025-12-29 14:22:49,939 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-29T14:22:56.336261680Z [err]  2025-12-29 14:22:49,951 - server - INFO - ‚úÖ QC learning router loaded
2025-12-29T14:22:56.336266233Z [err]  2025-12-29 14:22:49,953 - server - INFO - ‚úÖ QC learning router loaded
2025-12-29T14:22:56.336270643Z [err]  2025-12-29 14:22:49,979 - server - INFO - ‚úÖ QC agent router loaded
2025-12-29T14:22:56.336274894Z [err]  2025-12-29 14:22:50,002 - server - INFO - ‚úÖ QC learning router loaded
2025-12-29T14:22:56.336280152Z [err]  2025-12-29 14:22:50,026 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-29T14:22:56.336284962Z [err]  2025-12-29 14:22:50,066 - server - INFO - ‚úÖ CRM router loaded
2025-12-29T14:22:56.336290634Z [err]  2025-12-29 14:22:50,075 - server - INFO - ‚úÖ CRM router loaded
2025-12-29T14:22:56.336295012Z [err]  2025-12-29 14:22:50,081 - server - INFO - ‚úÖ QC test router loaded
2025-12-29T14:22:56.336299157Z [err]  2025-12-29 14:22:50,082 - server - INFO - ‚úÖ QC test router loaded
2025-12-29T14:22:56.336303676Z [err]  2025-12-29 14:22:50,082 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-29T14:22:56.336308215Z [err]  2025-12-29 14:22:50,104 - server - INFO - ‚úÖ Agent test router loaded
2025-12-29T14:22:56.338706728Z [err]  2025-12-29 14:22:50,141 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-29T14:22:56.338709239Z [err]  [2025-12-29 14:22:50 +0000] [3] [INFO] Waiting for application startup.
2025-12-29T14:22:56.338714144Z [err]  2025-12-29 14:22:50,107 - server - INFO - ‚úÖ Agent test router loaded
2025-12-29T14:22:56.338717264Z [err]  2025-12-29 14:22:50,142 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-29T14:22:56.338718449Z [err]  2025-12-29 14:22:50,132 - server - INFO - ‚úÖ Agent test router loaded
2025-12-29T14:22:56.338729125Z [err]  2025-12-29 14:22:50,113 - server - INFO - ‚úÖ CRM router loaded
2025-12-29T14:22:56.338730109Z [err]  [2025-12-29 14:22:50 +0000] [6] [INFO] Started server process [6]
2025-12-29T14:22:56.338730512Z [err]  2025-12-29 14:22:50,119 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-29T14:22:56.338730585Z [err]  [2025-12-29 14:22:50 +0000] [6] [INFO] Waiting for application startup.
2025-12-29T14:22:56.338742306Z [err]  2025-12-29 14:22:50,120 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-29T14:22:56.338744911Z [err]  2025-12-29 14:22:50,115 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-29T14:22:56.338749292Z [err]  2025-12-29 14:22:50,139 - server - INFO - ‚úÖ QC learning router loaded
2025-12-29T14:22:56.338752188Z [err]  [2025-12-29 14:22:50 +0000] [3] [INFO] Started server process [3]
2025-12-29T14:22:56.338756675Z [err]  2025-12-29 14:22:50,115 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-29T14:22:56.338768400Z [err]  2025-12-29 14:22:50,117 - server - INFO - ‚úÖ QC test router loaded
2025-12-29T14:22:56.338769724Z [err]  2025-12-29 14:22:50,140 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-29T14:22:56.338782288Z [err]  2025-12-29 14:22:50,119 - server - INFO - ‚úÖ QC agent router loaded
2025-12-29T14:22:56.338786028Z [err]  2025-12-29 14:22:50,140 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-29T14:22:56.340917597Z [err]  [2025-12-29 14:22:50 +0000] [5] [INFO] Started server process [5]
2025-12-29T14:22:56.340923856Z [err]  2025-12-29 14:22:50,270 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-29T14:22:56.340924196Z [err]  [2025-12-29 14:22:50 +0000] [5] [INFO] Waiting for application startup.
2025-12-29T14:22:56.340930207Z [err]  2025-12-29 14:22:50,165 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-29T14:22:56.340935415Z [err]  2025-12-29 14:22:50,243 - server - INFO - ‚úÖ CRM router loaded
2025-12-29T14:22:56.340940721Z [err]  2025-12-29 14:22:50,246 - server - INFO - ‚úÖ QC test router loaded
2025-12-29T14:22:56.340946931Z [err]  2025-12-29 14:22:50,263 - server - INFO - ‚úÖ Agent test router loaded
2025-12-29T14:22:56.340952919Z [err]  2025-12-29 14:22:50,270 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-29T14:22:56.340968055Z [err]  [2025-12-29 14:22:50 +0000] [4] [INFO] Started server process [4]
2025-12-29T14:22:56.340975677Z [err]  [2025-12-29 14:22:50 +0000] [4] [INFO] Waiting for application startup.
2025-12-29T14:22:56.340983899Z [err]  2025-12-29 14:22:50,293 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-29T14:22:57.358496998Z [err]  2025-12-29 14:22:57,200 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-29T14:22:57.358504540Z [err]  2025-12-29 14:22:57,205 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-29T14:22:57.358514506Z [err]  2025-12-29 14:22:57,205 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-29T14:22:57.358521284Z [err]  2025-12-29 14:22:57,205 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-29T14:22:57.428713902Z [err]  2025-12-29 14:22:57,425 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-29T14:22:57.434106254Z [err]  2025-12-29 14:22:57,431 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-29T14:22:57.434110122Z [err]  2025-12-29 14:22:57,432 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-29T14:22:57.434115265Z [err]  2025-12-29 14:22:57,432 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-29T14:22:57.536491875Z [err]  2025-12-29 14:22:57,534 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-29T14:22:57.536499180Z [err]  2025-12-29 14:22:57,534 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-29T14:22:57.536507929Z [err]  2025-12-29 14:22:57,534 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-29T14:22:57.536515299Z [err]  2025-12-29 14:22:57,534 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-29T14:22:58.413022832Z [err]  2025-12-29 14:22:57,912 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-29T14:22:58.413027101Z [err]  2025-12-29 14:22:57,925 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-29T14:22:58.413031462Z [err]  2025-12-29 14:22:57,926 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-29T14:22:58.413035748Z [err]  2025-12-29 14:22:57,926 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-29T14:22:58.413039397Z [err]  2025-12-29 14:22:57,926 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-29T14:22:58.413043669Z [err]  2025-12-29 14:22:58,013 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-29T14:22:58.413052500Z [err]  2025-12-29 14:22:58,013 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-29T14:22:58.413056138Z [err]  [2025-12-29 14:22:58 +0000] [3] [INFO] Application startup complete.
2025-12-29T14:22:58.413061468Z [err]  2025-12-29 14:22:58,179 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-29T14:22:58.413067261Z [err]  2025-12-29 14:22:58,292 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-29T14:22:58.413072990Z [err]  2025-12-29 14:22:58,293 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-29T14:22:58.413077065Z [err]  [2025-12-29 14:22:58 +0000] [6] [INFO] Application startup complete.
2025-12-29T14:22:58.413082069Z [err]  2025-12-29 14:22:58,323 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-29T14:22:58.432665520Z [err]  2025-12-29 14:22:58,429 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-29T14:22:58.432678416Z [err]  2025-12-29 14:22:58,430 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-29T14:22:58.432687473Z [err]  [2025-12-29 14:22:58 +0000] [5] [INFO] Application startup complete.
2025-12-29T14:22:58.724918882Z [err]  2025-12-29 14:22:58,723 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-29T14:22:58.829040944Z [err]  2025-12-29 14:22:58,826 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-29T14:22:58.829047056Z [err]  2025-12-29 14:22:58,826 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-29T14:22:58.829052672Z [err]  [2025-12-29 14:22:58 +0000] [4] [INFO] Application startup complete.
2025-12-29T14:35:09.756350111Z [inf]  100.64.0.2:16876 - "GET /.git/config HTTP/1.1" 404
2025-12-29T15:15:03.638689755Z [inf]  100.64.0.3:33166 - "POST / HTTP/1.1" 404
2025-12-29T15:15:03.638698007Z [inf]  100.64.0.4:54868 - "POST / HTTP/1.1" 404
2025-12-29T15:38:25.842814046Z [inf]  100.64.0.5:55578 - "GET / HTTP/1.1" 404
2025-12-29T15:57:18.164358290Z [inf]  100.64.0.6:43628 - "GET / HTTP/1.1" 404
2025-12-29T17:10:09.046682975Z [inf]  100.64.0.7:54004 - "GET / HTTP/1.1" 404
2025-12-29T18:15:08.474314221Z [inf]  100.64.0.8:10556 - "POST /api/webhook/telnyx HTTP/1.1" 404
2025-12-29T18:15:08.474318616Z [inf]  100.64.0.8:10556 - "POST /api/webhook/telnyx HTTP/1.1" 404
2025-12-29T18:15:08.474322933Z [inf]  100.64.0.8:10556 - "POST /api/webhook/telnyx HTTP/1.1" 404
2025-12-29T18:15:48.474918196Z [inf]  100.64.0.9:51030 - "POST /api/webhook/telnyx HTTP/1.1" 404
2025-12-29T18:15:48.474931753Z [inf]  100.64.0.9:51030 - "POST /api/webhook/telnyx HTTP/1.1" 404
2025-12-29T18:15:48.474940627Z [inf]  100.64.0.9:51030 - "POST /api/webhook/telnyx HTTP/1.1" 404
2025-12-29T21:38:13.978835034Z [inf]  100.64.0.10:52646 - "GET /api/auth/me HTTP/1.1" 401
2025-12-29T21:38:15.381206984Z [inf]  100.64.0.6:14798 - "OPTIONS /api/auth/login HTTP/1.1" 200
2025-12-29T21:38:16.927702873Z [inf]  100.64.0.6:14798 - "POST /api/auth/login HTTP/1.1" 200
2025-12-29T21:38:17.953870824Z [inf]  100.64.0.6:14798 - "GET /api/agents HTTP/1.1" 200
2025-12-29T21:38:23.032268526Z [inf]  100.64.0.11:20854 - "GET /api/agents HTTP/1.1" 200
2025-12-29T21:38:43.075379228Z [inf]  100.64.0.12:25232 - "OPTIONS /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-29T21:38:43.075383698Z [err]  2025-12-29 21:38:39,495 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T21:38:43.075388168Z [err]  2025-12-29 21:38:39,592 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:38:43.075394070Z [err]  2025-12-29 21:38:39,677 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:38:43.075399736Z [err]  2025-12-29 21:38:39,700 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:38:43.075405319Z [err]  2025-12-29 21:38:39,701 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-29T21:38:43.075414051Z [err]  2025-12-29 21:38:39,701 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-29T21:38:43.075419105Z [err]  2025-12-29 21:38:39,701 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T21:38:43.075423564Z [err]  2025-12-29 21:38:40,538 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-29T21:38:43.077821636Z [err]  2025-12-29 21:38:40,540 - telnyx_service - INFO - ‚úÖ Call initiated: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:43.077833276Z [err]  2025-12-29 21:38:40,641 - server - INFO - üìù Created call log: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:43.077841322Z [err]  2025-12-29 21:38:40,641 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:38:43.077847860Z [err]  2025-12-29 21:38:40,641 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-29T21:38:43.078161703Z [err]  2025-12-29 21:38:40,990 - server - INFO - üì® ================================================
2025-12-29T21:38:43.078167412Z [err]  2025-12-29 21:38:40,990 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-29T21:38:43.078174399Z [inf]  100.64.0.13:13394 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:38:43.078207736Z [err]  2025-12-29 21:38:41,018 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-29T21:38:43.078219265Z [err]  [2025-12-29 21:38:41 +0000] [4] [INFO] ('100.64.0.13', 13408) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-29T21:38:43.078226069Z [err]  2025-12-29 21:38:41,018 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-29T21:38:43.078232385Z [err]  [2025-12-29 21:38:41 +0000] [4] [INFO] connection open
2025-12-29T21:38:43.078252004Z [err]  2025-12-29 21:38:41,018 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-29T21:38:43.078258497Z [err]  2025-12-29 21:38:41,018 - server - INFO -    Client: Address(host='100.64.0.13', port=13408)
2025-12-29T21:38:43.078264994Z [err]  2025-12-29 21:38:41,018 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': '4K23is14o/w15FcF+jJn6w==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'GT8JJsMwRz2GoCBv2prcFg', 'x-real-ip': '192.76.120.151', 'x-request-start': '1767044320734', 'accept-encoding': 'gzip'}
2025-12-29T21:38:43.078274251Z [err]  2025-12-29 21:38:41,018 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-29T21:38:43.078287342Z [err]  2025-12-29 21:38:41,178 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-29T21:38:43.078297307Z [err]  2025-12-29 21:38:41,178 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-29T21:38:43.078428271Z [err]  2025-12-29 21:38:40,641 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:38:43.078438512Z [err]  2025-12-29 21:38:40,641 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:38:43.078444293Z [err]  2025-12-29 21:38:40,649 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg (TTL: 3600s)
2025-12-29T21:38:43.078450085Z [err]  2025-12-29 21:38:40,649 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-29T21:38:43.078458687Z [err]  2025-12-29 21:38:40,649 - server - INFO - üìû Outbound call initiated: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:43.078466221Z [inf]  100.64.0.12:25232 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-29T21:38:43.078471933Z [err]  2025-12-29 21:38:40,990 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:38:43.078477913Z [err]  2025-12-29 21:38:40,990 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': '0ce45139-e7db-4a2f-ae8c-4251ecca30e5', 'occurred_at': '2025-12-29T21:38:40.363282Z', 'payload': {'call_control_id': 'v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg', 'call_leg_id': 'bd7d4086-e4fe-11f0-bae1-02420aef941f', 'call_session_id': 'bd7a48ae-e4fe-11f0-854e-02420aef941f', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:38:43.078484616Z [err]  2025-12-29 21:38:40,990 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:43.080875243Z [err]  2025-12-29 21:38:41,486 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:38:43.080883183Z [err]  2025-12-29 21:38:41,486 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-29T21:38:48.017565525Z [err]  2025-12-29 21:38:48,014 - server - INFO - üì¨ Received Telnyx event: start
2025-12-29T21:38:48.017574068Z [err]  2025-12-29 21:38:48,015 - server - INFO - üé¨ Stream started for call: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:48.025366289Z [err]  2025-12-29 21:38:48,020 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:48.025375526Z [err]  2025-12-29 21:38:48,022 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-29T21:38:48.025381404Z [err]  2025-12-29 21:38:48,022 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-29T21:38:48.398079788Z [err]  2025-12-29 21:38:48,394 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:38:48.398086998Z [err]  2025-12-29 21:38:48,394 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': 'f19d137b-565c-46d6-a05b-99aa4671d239', 'occurred_at': '2025-12-29T21:38:47.823279Z', 'payload': {'call_control_id': 'v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg', 'call_leg_id': 'bd7d4086-e4fe-11f0-bae1-02420aef941f', 'call_session_id': 'bd7a48ae-e4fe-11f0-854e-02420aef941f', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-29T21:38:40.363282Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:38:48.398092023Z [err]  2025-12-29 21:38:48,394 - server - INFO - üéØ Event type: call.answered, Call ID: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:48.398096765Z [err]  2025-12-29 21:38:48,394 - server - INFO - üì® ================================================
2025-12-29T21:38:48.398100961Z [err]  2025-12-29 21:38:48,394 - server - INFO - ‚úÖ Call answered: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:48.410484745Z [err]  2025-12-29 21:38:48,400 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:48.410493312Z [err]  2025-12-29 21:38:48,401 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-29T21:38:48.410498560Z [err]  2025-12-29 21:38:48,401 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-29T21:38:48.530721805Z [err]  2025-12-29 21:38:48,521 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-29T21:38:48.530728388Z [err]  2025-12-29 21:38:48,522 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-29T21:38:48.530732341Z [err]  2025-12-29 21:38:48,526 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:48.530740607Z [err]  2025-12-29 21:38:48,528 - server - INFO - üìù Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:38:48.530744810Z [err]  2025-12-29 21:38:48,528 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T21:38:49.064907676Z [err]  2025-12-29 21:38:48,666 - server - INFO - üì® ================================================
2025-12-29T21:38:49.065021609Z [err]  2025-12-29 21:38:48,627 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-29T21:38:49.065027824Z [err]  2025-12-29 21:38:48,627 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T21:38:49.065034249Z [err]  2025-12-29 21:38:48,652 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T21:38:49.065041087Z [err]  2025-12-29 21:38:48,652 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T21:38:49.065046958Z [err]  2025-12-29 21:38:48,654 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-29T21:38:49.065058074Z [err]  2025-12-29 21:38:48,666 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:38:49.065067688Z [err]  2025-12-29 21:38:48,666 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': '763575af-3b2c-4d56-9a4f-68cb4a537ab7', 'occurred_at': '2025-12-29T21:38:48.103277Z', 'payload': {'call_control_id': 'v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg', 'call_leg_id': 'bd7d4086-e4fe-11f0-bae1-02420aef941f', 'call_session_id': 'bd7a48ae-e4fe-11f0-854e-02420aef941f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '3b8791f0-d836-43ea-95ba-825db98e948d', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:38:49.065076254Z [err]  2025-12-29 21:38:48,666 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:49.068836361Z [inf]  100.64.0.14:53872 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:38:49.068841148Z [err]  2025-12-29 21:38:48,740 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:38:49.068846478Z [err]  2025-12-29 21:38:48,751 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 96ms
2025-12-29T21:38:49.068851003Z [err]  2025-12-29 21:38:48,751 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-29T21:38:49.068855486Z [err]  2025-12-29 21:38:48,751 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-29T21:38:49.068859724Z [err]  2025-12-29 21:38:48,751 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-29T21:38:49.068863819Z [err]  2025-12-29 21:38:48,751 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-29T21:38:49.068868682Z [err]  2025-12-29 21:38:48,755 - server - INFO - ‚úÖ Initialized call_states for v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg with session reference
2025-12-29T21:38:49.068873133Z [err]  2025-12-29 21:38:48,755 - server - INFO - ‚úÖ Stored Telnyx WebSocket in call_data for audio streaming
2025-12-29T21:38:49.068877757Z [err]  2025-12-29 21:38:48,755 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found to update for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:49.068881566Z [err]  2025-12-29 21:38:48,757 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-29T21:38:49.068886190Z [err]  2025-12-29 21:38:48,851 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-29T21:38:49.285826933Z [err]  2025-12-29 21:38:49,281 - server - INFO - ‚úÖ Call log updated
2025-12-29T21:38:49.285847497Z [err]  2025-12-29 21:38:49,281 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:38:49.285856419Z [err]  2025-12-29 21:38:49,281 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:38:49.285874492Z [err]  2025-12-29 21:38:49,281 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:38:49.354936002Z [err]  2025-12-29 21:38:49,345 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-29T21:38:49.354945649Z [err]  2025-12-29 21:38:49,346 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-29T21:38:49.354952602Z [err]  2025-12-29 21:38:49,346 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-29T21:38:49.373511182Z [err]  2025-12-29 21:38:49,371 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:38:49.373516517Z [err]  2025-12-29 21:38:49,371 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:38:49.375578831Z [err]  2025-12-29 21:38:49,372 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:49.375593883Z [err]  2025-12-29 21:38:49,373 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Y7jef5Qoat0bcBDCG... (active sessions: [])
2025-12-29T21:38:49.375601592Z [err]  2025-12-29 21:38:49,373 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-29T21:38:49.461153776Z [err]  2025-12-29 21:38:49,458 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:38:49.461160065Z [err]  2025-12-29 21:38:49,458 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-29T21:38:49.490342477Z [err]  2025-12-29 21:38:49,487 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:38:50.037910311Z [err]  2025-12-29 21:38:49,688 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:38:50.037917915Z [err]  2025-12-29 21:38:49,688 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-29T21:38:50.037923111Z [err]  2025-12-29 21:38:49,775 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg/actions/playback_start "HTTP/1.1 200 OK"
2025-12-29T21:38:50.037944505Z [err]  2025-12-29 21:38:49,776 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: 5vRfieNBRQ (loop=True, overlay=True)
2025-12-29T21:38:50.037951168Z [err]  2025-12-29 21:38:49,776 - server - WARNING - ‚ö†Ô∏è Failed to start comfort noise: 'v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'
2025-12-29T21:38:50.037957112Z [err]  2025-12-29 21:38:49,776 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:50.037963072Z [err]  2025-12-29 21:38:49,874 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Y7jef5Qoat0bcBDCG... (active sessions: [])
2025-12-29T21:38:50.067698309Z [err]  2025-12-29 21:38:50,062 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg/actions/record_start "HTTP/1.1 200 OK"
2025-12-29T21:38:50.067703194Z [err]  2025-12-29 21:38:50,064 - server - INFO - üéôÔ∏è Call recording started for v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:50.067707838Z [err]  2025-12-29 21:38:50,064 - server - INFO - üîß Creating call session for v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg...
2025-12-29T21:38:50.067712465Z [err]  2025-12-29 21:38:50,064 - server - INFO - üîç Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:38:50.067717497Z [err]  2025-12-29 21:38:50,064 - server - INFO - üîß Calling create_call_session() - START
2025-12-29T21:38:50.067723680Z [err]  2025-12-29 21:38:50,064 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T21:38:50.154773927Z [err]  2025-12-29 21:38:50,152 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-29T21:38:50.154780841Z [err]  2025-12-29 21:38:50,152 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T21:38:50.162944637Z [inf]  100.64.0.15:27638 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-29T21:38:50.167037185Z [err]  2025-12-29 21:38:50,165 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T21:38:50.167044736Z [err]  2025-12-29 21:38:50,165 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T21:38:50.167051012Z [err]  2025-12-29 21:38:50,165 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-29T21:38:50.255130020Z [err]  2025-12-29 21:38:50,253 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:38:50.262896194Z [err]  2025-12-29 21:38:50,260 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 94ms
2025-12-29T21:38:50.262907233Z [err]  2025-12-29 21:38:50,260 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-29T21:38:50.262913779Z [err]  2025-12-29 21:38:50,260 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-29T21:38:50.275613481Z [err]  2025-12-29 21:38:50,268 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg (TTL: 3600s)
2025-12-29T21:38:50.275622834Z [err]  2025-12-29 21:38:50,268 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-29T21:38:50.275628026Z [err]  2025-12-29 21:38:50,268 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-29T21:38:50.275632417Z [err]  2025-12-29 21:38:50,269 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:50.275637140Z [err]  2025-12-29 21:38:50,269 - server - INFO - ü§ñ AI session created for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:50.275642522Z [err]  2025-12-29 21:38:50,269 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-29T21:38:50.275647178Z [err]  2025-12-29 21:38:50,269 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-29T21:38:50.275654765Z [err]  2025-12-29 21:38:50,269 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-29T21:38:50.275672806Z [err]  2025-12-29 21:38:50,269 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-29T21:38:50.275677736Z [err]  2025-12-29 21:38:50,269 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-29T21:38:50.275682592Z [err]  2025-12-29 21:38:50,269 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-29T21:38:50.275687312Z [err]  2025-12-29 21:38:50,269 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-29T21:38:50.277299257Z [err]  2025-12-29 21:38:50,275 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:50.279346464Z [err]  2025-12-29 21:38:50,276 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-29T21:38:50.279354517Z [err]  2025-12-29 21:38:50,276 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-29T21:38:50.279359922Z [inf]  100.64.0.8:54440 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:38:50.382328685Z [err]  2025-12-29 21:38:50,378 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Y7jef5Qoat0bcBDCG... (active sessions: [])
2025-12-29T21:38:50.382336995Z [err]  2025-12-29 21:38:50,378 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-29T21:38:51.112526541Z [err]  2025-12-29 21:38:50,764 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:51.112533487Z [err]  2025-12-29 21:38:50,770 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:51.112540129Z [err]  2025-12-29 21:38:50,777 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg (TTL: 3600s)
2025-12-29T21:38:51.112548243Z [err]  2025-12-29 21:38:50,777 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-29T21:38:51.112562379Z [err]  2025-12-29 21:38:50,777 - core_calling_service - INFO - ‚è±Ô∏è [21:38:50.777] üì• process_user_input() ENTRY - text: '...'
2025-12-29T21:38:51.112571823Z [err]  2025-12-29 21:38:50,781 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:51.112579214Z [err]  2025-12-29 21:38:50,782 - core_calling_service - INFO - ‚è±Ô∏è [21:38:50.782] ‚è© About to call _process_call_flow_streaming()
2025-12-29T21:38:51.112584892Z [err]  2025-12-29 21:38:50,782 - core_calling_service - INFO - ‚è±Ô∏è [21:38:50.782] üîÄ Agent type: call_flow, calling flow processor...
2025-12-29T21:38:51.112590671Z [err]  2025-12-29 21:38:50,782 - core_calling_service - INFO - ‚è±Ô∏è [21:38:50.782] üîÄ _process_call_flow_streaming() ENTRY
2025-12-29T21:38:51.112596442Z [err]  2025-12-29 21:38:50,782 - core_calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-29T21:38:51.112603224Z [err]  2025-12-29 21:38:50,782 - core_calling_service - INFO - ‚è±Ô∏è [21:38:50.782] ‚úÖ Node selected, about to process content...
2025-12-29T21:38:51.112609673Z [err]  2025-12-29 21:38:50,782 - core_calling_service - INFO - üîß Replaced {{now}} with Monday, December 29, 2025 at 4:38 PM EST in content
2025-12-29T21:38:51.116615472Z [err]  2025-12-29 21:38:50,782 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-29T21:38:51.116620826Z [err]  2025-12-29 21:38:50,782 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-29T21:38:51.116625388Z [err]  2025-12-29 21:38:50,783 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-29T21:38:51.116630608Z [err]  2025-12-29 21:38:50,783 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T21:38:51.116636337Z [err]  2025-12-29 21:38:50,783 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-29T21:38:51.116640997Z [err]  2025-12-29 21:38:50,783 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-29T21:38:51.116645786Z [err]  2025-12-29 21:38:50,783 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-29T21:38:51.116652903Z [err]  2025-12-29 21:38:50,783 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-29T21:38:51.116657305Z [err]  2025-12-29 21:38:50,783 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-29T21:38:51.116662049Z [err]  2025-12-29 21:38:50,783 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-29T21:38:51.116668175Z [err]  2025-12-29 21:38:50,783 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-29T21:38:51.116672744Z [err]  2025-12-29 21:38:50,783 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-29T21:38:51.116676553Z [err]  2025-12-29 21:38:50,783 - core_calling_service - INFO - ‚è±Ô∏è [21:38:50.783] üìÑ About to process content (mode=script, length=9)
2025-12-29T21:38:51.118143334Z [err]  2025-12-29 21:38:50,783 - core_calling_service - INFO - üîä Silence tracking reset for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg (user responded)
2025-12-29T21:38:51.118148318Z [err]  2025-12-29 21:38:50,783 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-29T21:38:51.118172511Z [err]  2025-12-29 21:38:50,783 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-29T21:38:51.118178148Z [err]  2025-12-29 21:38:50,783 - core_calling_service - INFO - LLM response (0.01s): Kendrick?
2025-12-29T21:38:51.118183664Z [err]  2025-12-29 21:38:50,783 - core_calling_service - INFO - Total latency: 0.01s
2025-12-29T21:38:51.118188322Z [err]  2025-12-29 21:38:50,783 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-29T21:38:51.118193460Z [err]  2025-12-29 21:38:50,878 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:51.118198128Z [err]  2025-12-29 21:38:50,879 - telnyx_service - INFO - üîä Speaking text on call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg: Kendrick?...
2025-12-29T21:38:51.118202643Z [err]  2025-12-29 21:38:50,879 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-29T21:38:51.118207044Z [err]  2025-12-29 21:38:50,879 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-29T21:38:51.118211878Z [err]  2025-12-29 21:38:50,879 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-29T21:38:51.118216990Z [err]  2025-12-29 21:38:50,879 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-29T21:38:51.118220976Z [err]  2025-12-29 21:38:50,879 - server - INFO - ‚è±Ô∏è [21:38:50.879] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-29T21:38:51.118225478Z [err]  2025-12-29 21:38:50,880 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-29T21:38:51.120749050Z [err]  2025-12-29 21:38:50,965 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-29T21:38:51.120756359Z [err]  2025-12-29 21:38:50,880 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-29T21:38:51.120757401Z [err]  2025-12-29 21:38:50,965 - server - INFO -    Full data: {'text': 'Kendrick?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-29T21:38:51.120771834Z [err]  2025-12-29 21:38:50,965 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-29T21:38:51.120773398Z [err]  2025-12-29 21:38:50,884 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Y7jef5Qoat0bcBDCG... (active sessions: [])
2025-12-29T21:38:51.120781847Z [err]  2025-12-29 21:38:50,884 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-29T21:38:51.120789223Z [err]  2025-12-29 21:38:50,965 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:38:51.120796793Z [err]  2025-12-29 21:38:50,965 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-29T21:38:51.120811907Z [err]  2025-12-29 21:38:50,965 - server - INFO -    Text length: 9 chars
2025-12-29T21:38:51.120824338Z [err]  2025-12-29 21:38:50,965 - server - INFO -    Text content: 'Kendrick?'
2025-12-29T21:38:51.120830520Z [err]  2025-12-29 21:38:50,965 - server - INFO -    Text bytes: b'Kendrick?'
2025-12-29T21:38:51.120837756Z [err]  2025-12-29 21:38:50,965 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-29T21:38:51.120844661Z [err]  2025-12-29 21:38:50,965 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-29T21:38:51.122993122Z [err]  2025-12-29 21:38:50,965 - server - INFO -    Timeout: 10.0s
2025-12-29T21:38:51.123003117Z [err]  2025-12-29 21:38:50,974 - server - INFO -    ‚úì HTTP client created (0.008s)
2025-12-29T21:38:51.123010942Z [err]  2025-12-29 21:38:50,974 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-29T21:38:51.393150093Z [err]  2025-12-29 21:38:51,384 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Y7jef5Qoat0bcBDCG... (active sessions: [])
2025-12-29T21:38:52.033697815Z [err]  2025-12-29 21:38:51,613 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:38:52.033711744Z [err]  2025-12-29 21:38:51,613 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '3ea64cab-e752-4980-9008-261a68c48f43', 'occurred_at': '2025-12-29T21:38:51.263276Z', 'payload': {'call_control_id': 'v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg', 'call_leg_id': 'bd7d4086-e4fe-11f0-bae1-02420aef941f', 'call_session_id': 'bd7a48ae-e4fe-11f0-854e-02420aef941f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': '5vRfieNBRQ', 'start_time': '2025-12-29T21:38:51.263276Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:38:52.033718162Z [err]  2025-12-29 21:38:51,613 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:52.033724393Z [err]  2025-12-29 21:38:51,613 - server - INFO - üì® ================================================
2025-12-29T21:38:52.033733588Z [inf]  100.64.0.15:27638 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:38:52.033740099Z [err]  2025-12-29 21:38:51,699 - server - INFO - üî§ RAW TOKENS: ["H"?]
2025-12-29T21:38:52.033747616Z [err]  2025-12-29 21:38:51,703 - core_calling_service - INFO - üîä Silence timer reset for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg (user started speaking)
2025-12-29T21:38:52.033753360Z [err]  2025-12-29 21:38:51,703 - core_calling_service - INFO - üë§ User started speaking for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:52.033759551Z [err]  2025-12-29 21:38:51,703 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-29T21:38:52.037615960Z [err]  2025-12-29 21:38:51,703 - server - INFO - üîç PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-29T21:38:52.037621077Z [err]  2025-12-29 21:38:51,862 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-29T21:38:52.037625638Z [err]  2025-12-29 21:38:51,863 - server - INFO -    ‚úì Connection established (0.897s) [TARGET: <200ms]
2025-12-29T21:38:52.037630705Z [err]  2025-12-29 21:38:51,863 - server - INFO -    ‚úì Response status: 200
2025-12-29T21:38:52.037635383Z [err]  2025-12-29 21:38:51,863 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-29T21:38:52.037640581Z [err]  2025-12-29 21:38:51,887 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Y7jef5Qoat0bcBDCG... (active sessions: [])
2025-12-29T21:38:52.037645367Z [err]  2025-12-29 21:38:51,906 - server - INFO -    ‚úì FIRST CHUNK received (0.941s, 1107 bytes) [TARGET: <300ms]
2025-12-29T21:38:52.037649969Z [err]  2025-12-29 21:38:51,908 - server - INFO -    ‚úì ALL CHUNKS received: 29 chunks (0.943s)
2025-12-29T21:38:52.037654592Z [err]  2025-12-29 21:38:51,908 - server - INFO -    ‚úì Total audio size: 13837 bytes
2025-12-29T21:38:52.037659906Z [err]  2025-12-29 21:38:51,908 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-29T21:38:52.037666374Z [err]  2025-12-29 21:38:51,908 - server - INFO -       - Connection: 897ms
2025-12-29T21:38:52.037670376Z [err]  2025-12-29 21:38:51,908 - server - INFO -       - First chunk: 941ms
2025-12-29T21:38:52.037674297Z [err]  2025-12-29 21:38:51,908 - server - INFO -       - All chunks: 943ms
2025-12-29T21:38:52.037679378Z [err]  2025-12-29 21:38:51,908 - server - INFO -       - Audio generation only: 43ms
2025-12-29T21:38:52.037683710Z [err]  2025-12-29 21:38:51,908 - server - INFO - ‚è±Ô∏è [21:38:51.908] üîä TTS COMPLETE: 1028ms, audio_size=13837 bytes
2025-12-29T21:38:52.039190425Z [err]  2025-12-29 21:38:51,908 - server - INFO - üíæ TTS CACHED: elevenlabs:Kendrick?... (13837 bytes)
2025-12-29T21:38:52.039201591Z [err]  2025-12-29 21:38:51,908 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 1.03s
2025-12-29T21:38:52.039210312Z [err]  2025-12-29 21:38:51,909 - telnyx_service - INFO - ‚úÖ Generated 13837 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-29T21:38:52.039218139Z [err]  2025-12-29 21:38:51,909 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-29T21:38:52.039224335Z [err]  2025-12-29 21:38:51,967 - server - INFO - üî§ RAW TOKENS: ["H"?, "ello"?]
2025-12-29T21:38:52.039231095Z [err]  2025-12-29 21:38:51,968 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Hello' | Generating: False
2025-12-29T21:38:52.094007607Z [err]  2025-12-29 21:38:52,087 - server - INFO - üî§ RAW TOKENS: ["H"‚úì, "ello"‚úì, "?"‚úì, "<end>"‚úì]
2025-12-29T21:38:52.094014319Z [err]  2025-12-29 21:38:52,087 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-29T21:38:52.094018489Z [err]  2025-12-29 21:38:52,087 - server - INFO - üßπ Cleaned transcript: 'H ello ?' -> 'Hello?'
2025-12-29T21:38:52.094022434Z [err]  2025-12-29 21:38:52,087 - server - INFO - üì• FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-29T21:38:52.094026188Z [err]  2025-12-29 21:38:52,087 - server - INFO - üé§ Soniox final transcript: 'Hello?'
2025-12-29T21:38:52.094030013Z [err]  2025-12-29 21:38:52,088 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Y7jef5Qoat0bcBDCG... (active sessions: [])
2025-12-29T21:38:52.094034293Z [err]  2025-12-29 21:38:52,088 - server - INFO - üîç FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-29T21:38:52.094038007Z [err]  2025-12-29 21:38:52,088 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Y7jef5Qoat0bcBDCG... (active sessions: [])
2025-12-29T21:38:52.094041862Z [err]  2025-12-29 21:38:52,088 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-29T21:38:52.094046359Z [err]  2025-12-29 21:38:52,088 - server - INFO - ‚è±Ô∏è [21:38:52.088] üìù FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-29T21:38:52.094050334Z [err]  2025-12-29 21:38:52,088 - server - INFO - ‚è±Ô∏è [21:38:52.088] STT endpoint detection latency: 13ms
2025-12-29T21:38:52.094054179Z [err]  2025-12-29 21:38:52,088 - server - INFO - ‚è±Ô∏è [21:38:52.088] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-29T21:38:52.094059227Z [err]  2025-12-29 21:38:52,088 - server - INFO - ‚è±Ô∏è User spoke at 1767044332.0883534
2025-12-29T21:38:52.094063088Z [err]  2025-12-29 21:38:52,089 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg (TTL: 3600s)
2025-12-29T21:38:52.096059933Z [err]  2025-12-29 21:38:52,089 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-29T21:38:52.096067688Z [err]  2025-12-29 21:38:52,089 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Y7jef5Qoat0bcBDCG... (active sessions: [])
2025-12-29T21:38:52.096073583Z [err]  2025-12-29 21:38:52,089 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-29T21:38:52.104066582Z [err]  2025-12-29 21:38:52,099 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-29T21:38:52.104079868Z [err]  2025-12-29 21:38:52,100 - core_calling_service - INFO - üë§ User stopped speaking for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:52.104084975Z [err]  2025-12-29 21:38:52,100 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-29T21:38:52.104090234Z [err]  2025-12-29 21:38:52,100 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+5ms
2025-12-29T21:38:52.104095286Z [err]  2025-12-29 21:38:52,100 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 5ms (Soniox model: stt-rt-v3)
2025-12-29T21:38:52.104101109Z [err]  2025-12-29 21:38:52,100 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-29T21:38:52.104106355Z [err]  2025-12-29 21:38:52,100 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-29T21:38:52.104110872Z [err]  2025-12-29 21:38:52,100 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:52.118834138Z [err]  2025-12-29 21:38:52,116 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg/actions/playback_start "HTTP/1.1 200 OK"
2025-12-29T21:38:52.118843434Z [err]  2025-12-29 21:38:52,117 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.21s
2025-12-29T21:38:52.118848620Z [err]  2025-12-29 21:38:52,117 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 1.24s
2025-12-29T21:38:52.118853334Z [err]  2025-12-29 21:38:52,117 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-29T21:38:52.118858199Z [err]  2025-12-29 21:38:52,117 - telnyx_service - INFO - üé¨ Playback ID: Q-wov5BX3w
2025-12-29T21:38:52.120681341Z [err]  2025-12-29 21:38:52,117 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-29T21:38:52.120689180Z [err]  2025-12-29 21:38:52,117 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Greeting playback started at 1767044332.117822
2025-12-29T21:38:52.120694938Z [err]  2025-12-29 21:38:52,117 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-29T21:38:52.193166785Z [err]  2025-12-29 21:38:52,191 - server - INFO - üìù Saved user transcript to database
2025-12-29T21:38:52.193172644Z [err]  2025-12-29 21:38:52,191 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Y7jef5Qoat0bcBDCG... (active sessions: [])
2025-12-29T21:38:52.193177270Z [err]  2025-12-29 21:38:52,192 - core_calling_service - INFO - ‚è±Ô∏è [21:38:52.191] üì• process_user_input() ENTRY - text: 'Hello?...'
2025-12-29T21:38:52.195197805Z [err]  2025-12-29 21:38:52,193 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:52.195205308Z [err]  2025-12-29 21:38:52,193 - core_calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg: User spoke while Silence Greeting was triggering
2025-12-29T21:38:52.222643280Z [err]  2025-12-29 21:38:52,216 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:38:52.222651600Z [err]  2025-12-29 21:38:52,216 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:52.391012025Z [err]  2025-12-29 21:38:52,388 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Y7jef5Qoat0bcBDCG... (active sessions: [])
2025-12-29T21:38:52.391018208Z [err]  2025-12-29 21:38:52,389 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Y7jef5Qoat0bcBDCG... (active sessions: [])
2025-12-29T21:38:52.401740344Z [inf]  100.64.0.16:28760 - "GET /api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3 HTTP/1.1" 200
2025-12-29T21:38:53.020316478Z [err]  2025-12-29 21:38:52,544 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg/actions/playback_stop "HTTP/1.1 200 OK"
2025-12-29T21:38:53.020320202Z [err]  2025-12-29 21:38:52,545 - telnyx_service - INFO - ‚úÖ Successfully stopped audio playback
2025-12-29T21:38:53.020324020Z [err]  2025-12-29 21:38:52,545 - core_calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-29T21:38:53.020327534Z [err]  2025-12-29 21:38:52,545 - core_calling_service - INFO - ‚úÖ BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-29T21:38:53.020331261Z [err]  2025-12-29 21:38:52,546 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:53.020334894Z [err]  2025-12-29 21:38:52,547 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg (TTL: 3600s)
2025-12-29T21:38:53.020665601Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-29T21:38:53.020680660Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - ‚è±Ô∏è [21:38:52.547] ‚è© About to call _process_call_flow_streaming()
2025-12-29T21:38:53.020690509Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - ‚è±Ô∏è [21:38:52.547] üîÄ Agent type: call_flow, calling flow processor...
2025-12-29T21:38:53.020697508Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - ‚è±Ô∏è [21:38:52.547] üîÄ _process_call_flow_streaming() ENTRY
2025-12-29T21:38:53.020704510Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-29T21:38:53.020711083Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-29T21:38:53.020717106Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - ‚è±Ô∏è [21:38:52.547] üîÄ About to call _follow_transition() for: Hello?...
2025-12-29T21:38:53.022215732Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Hello?
2025-12-29T21:38:53.022220240Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - ‚è∏Ô∏è User spoke (1767044332.0883534) BEFORE greeting playback started (1767044332.117822)
2025-12-29T21:38:53.022224486Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - ‚è∏Ô∏è Skipping transition eval - user hasn't heard greeting yet, will deliver it as response
2025-12-29T21:38:53.022229916Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 0ms
2025-12-29T21:38:53.022234685Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - ‚è±Ô∏è [21:38:52.547] ‚úÖ Node selected, about to process content...
2025-12-29T21:38:53.022239461Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - üîß Replaced {{now}} with Monday, December 29, 2025 at 4:38 PM EST in content
2025-12-29T21:38:53.022245109Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-29T21:38:53.022251949Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-29T21:38:53.022256076Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-29T21:38:53.022262519Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T21:38:53.022266752Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-29T21:38:53.022271780Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-29T21:38:53.022277044Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-29T21:38:53.023612800Z [err]  2025-12-29 21:38:52,547 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 447ms
2025-12-29T21:38:53.023620085Z [err]  2025-12-29 21:38:52,547 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-29T21:38:53.023625712Z [err]  2025-12-29 21:38:52,547 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Y7jef5Qoat0bcBDCG... (active sessions: [])
2025-12-29T21:38:53.023630670Z [err]  2025-12-29 21:38:52,547 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-29T21:38:53.023639222Z [err]  2025-12-29 21:38:52,633 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:38:53.023642596Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-29T21:38:53.023650797Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-29T21:38:53.023661165Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-29T21:38:53.023669068Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-29T21:38:53.023675964Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-29T21:38:53.023683028Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - ‚è±Ô∏è [21:38:52.547] üìÑ About to process content (mode=script, length=9)
2025-12-29T21:38:53.023689783Z [err]  2025-12-29 21:38:52,547 - core_calling_service - INFO - ‚è∏Ô∏è Skip sticky-prevention - delivering script as response to user's opener
2025-12-29T21:38:53.023696363Z [err]  2025-12-29 21:38:52,547 - server - INFO - üì§ Sentence arrived from LLM: Kendrick?...
2025-12-29T21:38:53.026182338Z [err]  2025-12-29 21:38:52,718 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:38:53.026190220Z [err]  2025-12-29 21:38:52,803 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:38:53.026195179Z [err]  2025-12-29 21:38:52,828 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:38:53.026199608Z [err]  2025-12-29 21:38:52,828 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-29T21:38:53.026204300Z [err]  2025-12-29 21:38:52,828 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:38:53.026209937Z [err]  2025-12-29 21:38:52,828 - persistent_tts_service - INFO - üîå [Call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg] Establishing persistent TTS WebSocket...
2025-12-29T21:38:53.026258753Z [err]  2025-12-29 21:38:52,828 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:38:53.026264088Z [err]  2025-12-29 21:38:52,828 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-29T21:38:53.026320021Z [err]  2025-12-29 21:38:52,828 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-29T21:38:53.026327737Z [err]  2025-12-29 21:38:52,890 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Y7jef5Qoat0bcBDCG... (active sessions: [])
2025-12-29T21:38:53.026334645Z [err]  2025-12-29 21:38:52,890 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Y7jef5Qoat0bcBDCG... (active sessions: [])
2025-12-29T21:38:53.027906102Z [err]  2025-12-29 21:38:52,909 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:38:53.027912432Z [err]  2025-12-29 21:38:52,909 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '03458748-4392-4773-b9e7-c094475cffff', 'occurred_at': '2025-12-29T21:38:52.602262Z', 'payload': {'call_control_id': 'v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg', 'call_leg_id': 'bd7d4086-e4fe-11f0-bae1-02420aef941f', 'call_session_id': 'bd7a48ae-e4fe-11f0-854e-02420aef941f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'Q-wov5BX3w', 'status': 'cancelled', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:38:53.027917093Z [err]  2025-12-29 21:38:52,909 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:53.027921721Z [err]  2025-12-29 21:38:52,909 - server - INFO - üì® ================================================
2025-12-29T21:38:53.027926331Z [err]  2025-12-29 21:38:52,911 - redis_service - INFO - ‚ûñ Removed playback Q-wov5BX3w, 0 remaining for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:53.027931596Z [err]  2025-12-29 21:38:52,911 - server - INFO - üîä Redis: Removed playback Q-wov5BX3w, 0 remaining
2025-12-29T21:38:53.027936127Z [err]  2025-12-29 21:38:52,911 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T21:38:53.027941644Z [err]  2025-12-29 21:38:52,911 - server - INFO - ‚è±Ô∏è CLEARED playback_expected_end_time - agent is definitely done speaking
2025-12-29T21:38:53.027945713Z [err]  2025-12-29 21:38:52,912 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T21:38:53.029697430Z [err]  2025-12-29 21:38:52,912 - server - INFO - ‚úÖ Found session locally: agent_speaking=True, user_speaking=False
2025-12-29T21:38:53.029707158Z [err]  2025-12-29 21:38:52,912 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044332.9122353 for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:53.029714962Z [err]  2025-12-29 21:38:52,912 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:53.029721607Z [err]  2025-12-29 21:38:52,912 - server - INFO - ‚è±Ô∏è Agent done speaking, silence timer STARTED (local)
2025-12-29T21:38:53.029728632Z [inf]  100.64.0.16:28760 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:38:53.029737684Z [err]  2025-12-29 21:38:52,962 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-29T21:38:53.029744037Z [err]  2025-12-29 21:38:52,962 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-29T21:38:53.029750605Z [err]  2025-12-29 21:38:52,962 - persistent_tts_service - INFO - ‚úÖ [Call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg] Persistent TTS WebSocket established
2025-12-29T21:38:53.029757379Z [err]  2025-12-29 21:38:52,962 - persistent_tts_service - INFO - üéß [Call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg] Audio receiver loop started
2025-12-29T21:38:53.029766379Z [err]  2025-12-29 21:38:52,962 - persistent_tts_service - INFO - üîä [Call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg] Comfort noise loop started
2025-12-29T21:38:53.029778334Z [err]  2025-12-29 21:38:52,962 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:53.029790667Z [err]  2025-12-29 21:38:52,962 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-29T21:38:53.032027566Z [err]  2025-12-29 21:38:52,962 - server - INFO - üîç Persistent TTS lookup: call_id=v3:Y7jef5Qoat0bcBDCG..., session=FOUND
2025-12-29T21:38:53.032037740Z [err]  2025-12-29 21:38:52,962 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-29T21:38:53.032044921Z [err]  2025-12-29 21:38:52,962 - server - INFO - üéµ TTS task #1 started at +414ms
2025-12-29T21:38:53.032052156Z [err]  2025-12-29 21:38:52,962 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 862ms
2025-12-29T21:38:53.032059713Z [err]  2025-12-29 21:38:52,962 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user gave meaningful response) for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:53.032066802Z [err]  2025-12-29 21:38:52,964 - server - INFO -    1 sentences queued and playing seamlessly
2025-12-29T21:38:53.032068512Z [err]  2025-12-29 21:38:52,962 - core_calling_service - INFO - üîä Silence tracking reset for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg (user responded)
2025-12-29T21:38:53.032075660Z [err]  2025-12-29 21:38:52,962 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-29T21:38:53.032082820Z [err]  2025-12-29 21:38:52,962 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-29T21:38:53.032089092Z [err]  2025-12-29 21:38:52,962 - core_calling_service - INFO - LLM response (0.77s): Kendrick?
2025-12-29T21:38:53.032096335Z [err]  2025-12-29 21:38:52,962 - core_calling_service - INFO - Total latency: 0.77s
2025-12-29T21:38:53.032102663Z [err]  2025-12-29 21:38:52,963 - server - INFO - ‚úÖ LLM finished in 863ms, TTS tasks already running in background
2025-12-29T21:38:53.032111243Z [err]  2025-12-29 21:38:52,964 - server - INFO - üéµ Streaming 1 TTS chunks as they complete...
2025-12-29T21:38:53.032118103Z [err]  2025-12-29 21:38:52,964 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-29T21:38:53.033773241Z [err]  2025-12-29 21:38:52,964 - persistent_tts_service - INFO - üéµ [Call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg] Playback consumer started
2025-12-29T21:38:53.033780048Z [err]  2025-12-29 21:38:52,964 - persistent_tts_service - INFO - üéß [Call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg] Audio Receiver Loop STARTED
2025-12-29T21:38:53.033784609Z [err]  2025-12-29 21:38:52,964 - persistent_tts_service - INFO - üíì [Call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg] Starting TTS keep-alive loop (every 15s)
2025-12-29T21:38:53.033789601Z [err]  2025-12-29 21:38:52,964 - persistent_tts_service - INFO - üîä [Call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg] Starting comfort noise loop
2025-12-29T21:38:53.033794491Z [err]  2025-12-29 21:38:52,964 - persistent_tts_service - INFO - üé§ [Call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg] Streaming sentence #1: Kendrick?...
2025-12-29T21:38:53.033799677Z [err]  2025-12-29 21:38:52,964 - persistent_tts_service - INFO - üöÄ [Call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-29T21:38:53.033806158Z [err]  2025-12-29 21:38:52,964 - persistent_tts_service - INFO - üìä [Call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-29T21:38:53.033813235Z [err]  2025-12-29 21:38:52,964 - persistent_tts_service - INFO - üéß [Call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg] Receiver processing sentence #1: 'Kendrick?...'
2025-12-29T21:38:53.033817917Z [err]  2025-12-29 21:38:52,964 - persistent_tts_service - INFO - üìä [Call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg] DIAGNOSTIC: queue_latency=0ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-29T21:38:53.033842005Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚úÖ All 1 persistent TTS streams completed
2025-12-29T21:38:53.034969659Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 865ms (user stopped ‚Üí play_audio_url called)
2025-12-29T21:38:53.034975827Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-29T21:38:53.034981167Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-29T21:38:53.034990279Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-29T21:38:53.034995894Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 864ms from user stop üöÄ
2025-12-29T21:38:53.034999698Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-29T21:38:53.035009616Z [err]  2025-12-29 21:38:52,965 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:53.035017657Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-29T21:38:53.035025122Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-29T21:38:53.035033231Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-29T21:38:53.035041220Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 5ms (provider: soniox, model: stt-rt-v3)
2025-12-29T21:38:53.035048962Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 863ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-29T21:38:53.035057446Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 417ms (provider: elevenlabs, websocket: False)
2025-12-29T21:38:53.036766504Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-29T21:38:53.036776155Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-29T21:38:53.036783391Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 1165ms estimated
2025-12-29T21:38:53.036789654Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 9 chars, 1 sentences
2025-12-29T21:38:53.036795495Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Hello?...'
2025-12-29T21:38:53.036801343Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: 'Kendrick?...'
2025-12-29T21:38:53.036808476Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-29T21:38:53.036814204Z [err]  2025-12-29 21:38:52,965 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-29T21:38:53.078889261Z [err]  2025-12-29 21:38:53,075 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:38:53.078895408Z [err]  2025-12-29 21:38:53,075 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': '07bcb787-ba13-4517-9d74-17d026bf872b', 'occurred_at': '2025-12-29T21:38:52.583279Z', 'payload': {'call_control_id': 'v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg', 'call_leg_id': 'bd7d4086-e4fe-11f0-bae1-02420aef941f', 'call_session_id': 'bd7a48ae-e4fe-11f0-854e-02420aef941f', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:38:53.078902374Z [err]  2025-12-29 21:38:53,075 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:53.078906910Z [err]  2025-12-29 21:38:53,075 - server - INFO - üì® ================================================
2025-12-29T21:38:53.078910880Z [inf]  100.64.0.14:53888 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:38:53.153304918Z [err]  2025-12-29 21:38:53,149 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 1285ms)
2025-12-29T21:38:53.153316060Z [err]  2025-12-29 21:38:53,149 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-29T21:38:53.153323628Z [err]  2025-12-29 21:38:53,149 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-29T21:38:53.216138743Z [err]  2025-12-29 21:38:53,212 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 247ms
2025-12-29T21:38:53.216150629Z [err]  2025-12-29 21:38:53,212 - persistent_tts_service - INFO - üì§ Sending 7043 bytes of audio (45 chunks, 0.9s duration) via WebSocket
2025-12-29T21:38:53.216157797Z [err]  2025-12-29 21:38:53,212 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:38:53.216163148Z [err]  2025-12-29 21:38:53,212 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +0.9s (total: 0.9s from now)
2025-12-29T21:38:53.216168098Z [err]  2025-12-29 21:38:53,213 - persistent_tts_service - INFO - ‚úÖ Sent 45 audio chunks via WebSocket
2025-12-29T21:38:53.396205143Z [err]  2025-12-29 21:38:53,391 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-29T21:38:53.396214030Z [err]  2025-12-29 21:38:53,392 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044333.3920217 for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:53.396220483Z [err]  2025-12-29 21:38:53,392 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:38:54.219566774Z [err]  2025-12-29 21:38:54,214 - persistent_tts_service - INFO - üîá [Call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg] FLOOR RELEASED (is_holding_floor=False)
2025-12-29T21:38:54.380778019Z [err]  2025-12-29 21:38:54,374 - server - INFO - üì§ Audio flowing: 302 packets sent to Soniox (5s update)
2025-12-29T21:38:55.215967083Z [err]  2025-12-29 21:38:55,212 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-29T21:38:55.215979616Z [err]  2025-12-29 21:38:55,212 - persistent_tts_service - INFO - ‚úÖ [Call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg] Receiver finished sentence #1: 1 chunks in 2247ms
2025-12-29T21:38:59.376408982Z [err]  2025-12-29 21:38:59,374 - server - INFO - üì§ Audio flowing: 552 packets sent to Soniox (5s update)
2025-12-29T21:39:00.038270614Z [err]  2025-12-29 21:38:59,634 - server - INFO - üé§ Soniox receiver alive - 12 messages received in last 10s
2025-12-29T21:39:00.038275023Z [err]  2025-12-29 21:38:59,670 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 560 total packets
2025-12-29T21:39:00.038279930Z [err]  [2025-12-29 21:38:59 +0000] [4] [INFO] connection closed
2025-12-29T21:39:00.038288573Z [err]  2025-12-29 21:38:59,854 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:00.038293680Z [err]  2025-12-29 21:38:59,854 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'b749a04c-cd09-4a28-9b0b-d398f9451434', 'occurred_at': '2025-12-29T21:38:59.483276Z', 'payload': {'call_control_id': 'v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg', 'call_leg_id': 'bd7d4086-e4fe-11f0-bae1-02420aef941f', 'call_session_id': 'bd7a48ae-e4fe-11f0-854e-02420aef941f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:38:59.483276Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': '5vRfieNBRQ', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:00.038298804Z [err]  2025-12-29 21:38:59,854 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:00.038303300Z [err]  2025-12-29 21:38:59,854 - server - INFO - üì® ================================================
2025-12-29T21:39:00.038308255Z [err]  2025-12-29 21:38:59,855 - redis_service - INFO - ‚ûñ Removed playback 5vRfieNBRQ, 0 remaining for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:00.038313096Z [err]  2025-12-29 21:38:59,855 - server - INFO - üîä Redis: Removed playback 5vRfieNBRQ, 0 remaining
2025-12-29T21:39:00.042014632Z [err]  2025-12-29 21:38:59,855 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T21:39:00.042020395Z [err]  2025-12-29 21:38:59,856 - server - INFO - ‚è±Ô∏è CLEARED playback_expected_end_time - agent is definitely done speaking
2025-12-29T21:39:00.042026353Z [err]  2025-12-29 21:38:59,856 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T21:39:00.042031871Z [err]  2025-12-29 21:38:59,856 - server - INFO - ‚úÖ Found session locally: agent_speaking=False, user_speaking=False
2025-12-29T21:39:00.042037423Z [err]  2025-12-29 21:38:59,856 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044339.8566163 for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:00.042043069Z [err]  2025-12-29 21:38:59,856 - server - INFO - ‚è±Ô∏è Silence timer STARTED (local, agent wasn't marked as speaking)
2025-12-29T21:39:00.042048722Z [inf]  100.64.0.15:61586 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:00.087866389Z [err]  2025-12-29 21:39:00,085 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:00.087876138Z [err]  2025-12-29 21:39:00,086 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': '3a2e1231-567a-437c-9919-b997b4635b75', 'occurred_at': '2025-12-29T21:38:59.403291Z', 'payload': {'call_control_id': 'v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg', 'call_leg_id': 'bd7d4086-e4fe-11f0-bae1-02420aef941f', 'call_quality_stats': {'inbound': {'jitter_max_variance': '21.62', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '607', 'skip_packet_count': '11'}, 'outbound': {'packet_count': '560', 'skip_packet_count': '0'}}, 'call_session_id': 'bd7a48ae-e4fe-11f0-854e-02420aef941f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:38:59.403291Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-29T21:38:40.363282Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:00.087883893Z [err]  2025-12-29 21:39:00,086 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:00.087891843Z [err]  2025-12-29 21:39:00,086 - server - INFO - üì® ================================================
2025-12-29T21:39:00.087897785Z [err]  2025-12-29 21:39:00,086 - server - INFO - üìû Call ended: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:00.087903793Z [err]  2025-12-29 21:39:00,086 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-29T21:39:00.095939534Z [err]  2025-12-29 21:39:00,093 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:00.095948040Z [err]  2025-12-29 21:39:00,093 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': '74077855-6930-46e4-8ff6-a85b9bbb9e7f', 'occurred_at': '2025-12-29T21:38:59.625240Z', 'payload': {'call_control_id': 'v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg', 'call_leg_id': 'bd7d4086-e4fe-11f0-bae1-02420aef941f', 'call_session_id': 'bd7a48ae-e4fe-11f0-854e-02420aef941f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '3b8791f0-d836-43ea-95ba-825db98e948d', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:00.095956854Z [err]  2025-12-29 21:39:00,093 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:00.095961909Z [err]  2025-12-29 21:39:00,093 - server - INFO - üì® ================================================
2025-12-29T21:39:00.095966911Z [inf]  100.64.0.5:41994 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:00.417546421Z [err]  2025-12-29 21:39:00,411 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.6s, checkin_count=0/2
2025-12-29T21:39:01.052533678Z [err]  2025-12-29 21:39:00,913 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=1.1s, checkin_count=0/2
2025-12-29T21:39:01.084779394Z [err]  2025-12-29 21:39:01,082 - server - INFO - üìù Updated call log: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:01.188994086Z [err]  2025-12-29 21:39:01,180 - server - INFO - ‚úÖ Finalized call log: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg (duration=12s, status=completed)
2025-12-29T21:39:01.358409780Z [err]  2025-12-29 21:39:01,354 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:01.358419241Z [err]  2025-12-29 21:39:01,355 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '88f7b5ad-5adf-405b-a030-fae52ee77c1e', 'occurred_at': '2025-12-29T21:39:00.869851Z', 'payload': {'call_control_id': 'v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg', 'call_leg_id': 'bd7d4086-e4fe-11f0-bae1-02420aef941f', 'call_session_id': 'bd7a48ae-e4fe-11f0-854e-02420aef941f', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:38:59.495044Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-29T21:38:59.495044Z', 'recording_id': '4e48b4a5-5e4a-4d31-bcd6-9b63c33451ee', 'recording_started_at': '2025-12-29T21:38:49.897762Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/bd7d4086-e4fe-11f0-bae1-02420aef941f-1767044329872727.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T213900Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=918c9e6bdf3c73d236e0bbb580921fbd0bd8a67f6996e50e0b23ee3641374f6b'}, 'start_time': '2025-12-29T21:38:49.897762Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:01.358426013Z [err]  2025-12-29 21:39:01,355 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:01.358432950Z [err]  2025-12-29 21:39:01,355 - server - INFO - üì® ================================================
2025-12-29T21:39:01.358440335Z [err]  2025-12-29 21:39:01,355 - server - INFO - üéôÔ∏è Recording saved for call: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:01.358447907Z [err]  2025-12-29 21:39:01,355 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:01.361139398Z [err]  2025-12-29 21:39:01,356 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=4e48b4a5-5e4a-4d31-bcd6-9b63c33451ee, call_data=True
2025-12-29T21:39:01.452102545Z [err]  2025-12-29 21:39:01,449 - server - INFO - üíæ Saved recording URL and ID to database: 4e48b4a5-5e4a-4d31-bcd6-9b63c33451ee
2025-12-29T21:39:01.452113035Z [err]  2025-12-29 21:39:01,449 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-29T21:39:01.452120209Z [err]  2025-12-29 21:39:01,449 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-29T21:39:02.044028457Z [err]  2025-12-29 21:39:01,758 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/bd7d4086-e4fe-11f0-bae1-02420aef941f-1767044329872727.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T213900Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=918c9e6bdf3c73d236e0bbb580921fbd0bd8a67f6996e50e0b23ee3641374f6b "HTTP/1.1 200 OK"
2025-12-29T21:39:02.044036223Z [err]  2025-12-29 21:39:01,844 - server - INFO - ‚úÖ Downloaded 38704 bytes
2025-12-29T21:39:02.044041767Z [err]  2025-12-29 21:39:01,922 - server - INFO - üìä Auto-added call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-29T21:39:02.115178731Z [err]  2025-12-29 21:39:02,113 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:39:02.123411369Z [err]  2025-12-29 21:39:02,117 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:02.123422410Z [err]  2025-12-29 21:39:02,117 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=No
2025-12-29T21:39:02.123430134Z [err]  2025-12-29 21:39:02,117 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-29T21:39:02.139645872Z [err]  2025-12-29 21:39:02,137 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T21:39:02.217277822Z [err]  2025-12-29 21:39:02,214 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-29T21:39:02.227502956Z [err]  2025-12-29 21:39:02,224 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:02.257062944Z [err]  2025-12-29 21:39:02,255 - server - INFO - ‚úÖ Split into 2 channels
2025-12-29T21:39:02.257070611Z [err]  2025-12-29 21:39:02,255 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-29T21:39:02.257076015Z [err]  2025-12-29 21:39:02,255 - server - INFO - üìä Channel 0: 209484 bytes
2025-12-29T21:39:02.257081723Z [err]  2025-12-29 21:39:02,255 - server - ERROR - ‚ùå No Soniox API key available
2025-12-29T21:39:02.257086804Z [err]  2025-12-29 21:39:02,255 - server - INFO - ‚ùå Channel 0: No speech
2025-12-29T21:39:02.260164124Z [err]  2025-12-29 21:39:02,255 - server - INFO - üìä Channel 1: 209484 bytes
2025-12-29T21:39:02.260172687Z [err]  2025-12-29 21:39:02,255 - server - ERROR - ‚ùå No Soniox API key available
2025-12-29T21:39:02.260182339Z [err]  2025-12-29 21:39:02,255 - server - INFO - ‚ùå Channel 1: No speech
2025-12-29T21:39:02.260188128Z [err]  2025-12-29 21:39:02,255 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-29T21:39:02.260194214Z [inf]  100.64.0.9:57120 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:02.308245901Z [err]  2025-12-29 21:39:02,306 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-29T21:39:02.308254931Z [err]  2025-12-29 21:39:02,306 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-29T21:39:02.308260337Z [err]  2025-12-29 21:39:02,306 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-29T21:39:02.308264993Z [err]  2025-12-29 21:39:02,306 - server - INFO - üöÄ Triggered QC analysis for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:02.308269516Z [err]  2025-12-29 21:39:02,306 - server - INFO - üìä Triggered Campaign QC for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:02.308275002Z [err]  2025-12-29 21:39:02,306 - server - INFO - üìá Triggered CRM update for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:02.308281384Z [err]  2025-12-29 21:39:02,306 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:02.310135972Z [err]  2025-12-29 21:39:02,307 - redis_service - INFO - üßπ Deleted call data from Redis: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:02.310142318Z [err]  2025-12-29 21:39:02,307 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:02.310146740Z [inf]  100.64.0.16:56430 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:02.310152222Z [err]  2025-12-29 21:39:02,307 - server - INFO - üîç Starting QC analysis for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:02.310156514Z [err]  2025-12-29 21:39:02,307 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-29T21:39:02.312265836Z [err]  2025-12-29 21:39:02,309 - server - INFO - üìá CRM update starting for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:02.312272358Z [err]  2025-12-29 21:39:02,309 - server - INFO - üìá Normalized phone: +17708336397
2025-12-29T21:39:02.314870721Z [err]  2025-12-29 21:39:02,311 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:02.337576217Z [err]  2025-12-29 21:39:02,335 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:02.337587285Z [err]  2025-12-29 21:39:02,335 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-29T21:39:02.337594270Z [err]  2025-12-29 21:39:02,335 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-29T21:39:02.337600044Z [err]  2025-12-29 21:39:02,335 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T21:39:02.405823399Z [err]  2025-12-29 21:39:02,403 - server - INFO - üìù Converted transcript from 3 messages to 54 characters
2025-12-29T21:39:02.499131423Z [err]  2025-12-29 21:39:02,496 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:02.513578671Z [err]  2025-12-29 21:39:02,505 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:39:02.513584165Z [err]  2025-12-29 21:39:02,506 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-29T21:39:03.062914813Z [err]  2025-12-29 21:39:02,589 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-29T21:39:03.062924653Z [err]  2025-12-29 21:39:02,681 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-29T21:39:03.062931062Z [err]  2025-12-29 21:39:02,681 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:03.062940279Z [err]  2025-12-29 21:39:02,681 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:03.062948220Z [err]  2025-12-29 21:39:02,861 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=3, logs_count=4, status=completed
2025-12-29T21:39:03.062955005Z [err]  2025-12-29 21:39:02,901 - server - INFO - üìá CRM: Total variables collected: []
2025-12-29T21:39:03.103875543Z [err]  2025-12-29 21:39:03,101 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name']
2025-12-29T21:39:03.155666644Z [err]  2025-12-29 21:39:03,151 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-29T21:39:03.157262823Z [err]  2025-12-29 21:39:03,154 - telnyx_service - INFO - ‚úÖ Call initiated: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:03.248507870Z [err]  2025-12-29 21:39:03,245 - server - INFO - üìù Created call log: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:03.248517488Z [err]  2025-12-29 21:39:03,245 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:39:03.248525115Z [err]  2025-12-29 21:39:03,245 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-29T21:39:03.251024928Z [err]  2025-12-29 21:39:03,245 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:39:03.251031141Z [err]  2025-12-29 21:39:03,245 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:39:03.254907668Z [err]  2025-12-29 21:39:03,251 - redis_service - INFO - üì¶ Stored call data in Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ (TTL: 3600s)
2025-12-29T21:39:03.254918519Z [err]  2025-12-29 21:39:03,251 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-29T21:39:03.254925531Z [err]  2025-12-29 21:39:03,251 - server - INFO - üìû Outbound call initiated: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:03.254932590Z [inf]  100.64.0.17:26646 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-29T21:39:03.293706547Z [err]  2025-12-29 21:39:03,288 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-29T21:39:03.357893842Z [err]  2025-12-29 21:39:03,354 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-29T21:39:03.357906411Z [err]  2025-12-29 21:39:03,354 - server - INFO -    Client: Address(host='100.64.0.14', port=40704)
2025-12-29T21:39:03.357915116Z [err]  2025-12-29 21:39:03,354 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'bOn/hKiWAHmOSgxbqxRGCQ==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'kNmKAv_RSmeQ81PZxtoGcA', 'x-real-ip': '192.76.120.151', 'x-request-start': '1767044343067', 'accept-encoding': 'gzip'}
2025-12-29T21:39:03.357923509Z [err]  2025-12-29 21:39:03,354 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-29T21:39:03.357928648Z [err]  2025-12-29 21:39:03,354 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-29T21:39:03.357935171Z [err]  [2025-12-29 21:39:03 +0000] [5] [INFO] ('100.64.0.14', 40704) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-29T21:39:03.357940426Z [err]  2025-12-29 21:39:03,354 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-29T21:39:03.357946028Z [err]  [2025-12-29 21:39:03 +0000] [5] [INFO] connection open
2025-12-29T21:39:03.379555050Z [err]  2025-12-29 21:39:03,375 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-29T21:39:03.379562270Z [err]  2025-12-29 21:39:03,375 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-29T21:39:03.379566821Z [err]  2025-12-29 21:39:03,375 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:39:03.379572233Z [err]  2025-12-29 21:39:03,376 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-29T21:39:03.379576946Z [err]    File "/app/backend/server.py", line 9773, in trigger_campaign_qc_for_call
2025-12-29T21:39:03.379580982Z [err]      await run_full_qc_analysis(
2025-12-29T21:39:03.379586158Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-29T21:39:03.379591084Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:39:03.379595347Z [err]  
2025-12-29T21:39:03.464838640Z [err]  2025-12-29 21:39:03,461 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:03.464847496Z [err]  2025-12-29 21:39:03,461 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': '1c39b9d3-3d4c-40a8-ad0b-6eba59ba64f3', 'occurred_at': '2025-12-29T21:39:02.983973Z', 'payload': {'call_control_id': 'v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'call_leg_id': 'cafa9c68-e4fe-11f0-a9ae-02420aef98a0', 'call_session_id': 'caf76912-e4fe-11f0-a394-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:03.464852725Z [err]  2025-12-29 21:39:03,461 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:03.464858002Z [err]  2025-12-29 21:39:03,461 - server - INFO - üì® ================================================
2025-12-29T21:39:03.464862233Z [err]  2025-12-29 21:39:03,461 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-29T21:39:03.464868274Z [inf]  100.64.0.15:61586 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:03.515727749Z [err]  2025-12-29 21:39:03,509 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-29T21:39:03.515733798Z [err]  2025-12-29 21:39:03,509 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-29T21:39:04.024000822Z [err]  2025-12-29 21:39:03,662 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:39:04.024008651Z [err]  2025-12-29 21:39:03,663 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:04.024018063Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:04.024027346Z [err]  2025-12-29 21:39:03,663 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:04.024035882Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:39:04.024043448Z [err]  2025-12-29 21:39:03,665 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:04.024050143Z [err]  2025-12-29 21:39:03,680 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:39:04.024056177Z [err]  2025-12-29 21:39:03,681 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-29T21:39:05.175597369Z [err]  2025-12-29 21:39:05,057 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:39:05.175602425Z [err]  2025-12-29 21:39:05,058 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:05.175607667Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:05.175613787Z [err]  2025-12-29 21:39:05,058 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:05.175620822Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:39:05.178277936Z [err]  2025-12-29 21:39:05,059 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:06.206765758Z [err]  2025-12-29 21:39:06,202 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:39:06.206774856Z [err]  2025-12-29 21:39:06,203 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:06.206781598Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:06.206787593Z [err]  2025-12-29 21:39:06,203 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:06.206794665Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:06.302485807Z [err]  2025-12-29 21:39:06,298 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:06.302493701Z [err]  2025-12-29 21:39:06,298 - server - INFO - ‚úÖ QC analysis completed for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:06.302498566Z [err]  2025-12-29 21:39:06,298 - server - INFO - üìä Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-29T21:39:06.484514263Z [err]  2025-12-29 21:39:06,482 - server - INFO - üìä Updated campaign_calls with QC scores for v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:07.094639769Z [err]  2025-12-29 21:39:06,657 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-29T21:39:07.094644086Z [err]  2025-12-29 21:39:06,704 - server - INFO - üì¨ Received Telnyx event: start
2025-12-29T21:39:07.094648194Z [err]  2025-12-29 21:39:06,705 - server - INFO - üé¨ Stream started for call: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:07.094652037Z [err]  2025-12-29 21:39:06,710 - redis_service - INFO - üì• Retrieved call data from Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:07.094655909Z [err]  2025-12-29 21:39:06,712 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-29T21:39:07.094659993Z [err]  2025-12-29 21:39:06,712 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-29T21:39:07.094665668Z [err]  2025-12-29 21:39:06,744 - server - INFO - üè∑Ô∏è Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-29T21:39:07.094669382Z [err]  2025-12-29 21:39:06,744 - server - ERROR - ‚ùå Error in auto appointment detection for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg: 'str' object has no attribute 'get'
2025-12-29T21:39:07.094674224Z [err]  2025-12-29 21:39:07,009 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:07.094678022Z [err]  2025-12-29 21:39:07,010 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': 'd1ccfb9a-f964-4543-aacb-e960b4eeb8cb', 'occurred_at': '2025-12-29T21:39:06.523982Z', 'payload': {'call_control_id': 'v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'call_leg_id': 'cafa9c68-e4fe-11f0-a9ae-02420aef98a0', 'call_session_id': 'caf76912-e4fe-11f0-a394-02420aef98a0', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-29T21:39:02.963973Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:07.097754023Z [err]  2025-12-29 21:39:07,015 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-29T21:39:07.097812482Z [err]  2025-12-29 21:39:07,010 - server - INFO - üì® ================================================
2025-12-29T21:39:07.097822445Z [err]  2025-12-29 21:39:07,010 - server - INFO - ‚úÖ Call answered: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:07.097829316Z [err]  2025-12-29 21:39:07,014 - redis_service - INFO - üì• Retrieved call data from Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:07.097836164Z [err]  2025-12-29 21:39:07,010 - server - INFO - üéØ Event type: call.answered, Call ID: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:07.097838108Z [err]  2025-12-29 21:39:07,015 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-29T21:39:07.114766373Z [err]  2025-12-29 21:39:07,109 - server - INFO - ‚úÖ Call log updated
2025-12-29T21:39:07.114773541Z [err]  2025-12-29 21:39:07,109 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:39:07.114781228Z [err]  2025-12-29 21:39:07,109 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:39:07.114787091Z [err]  2025-12-29 21:39:07,109 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:07.129452765Z [err]  2025-12-29 21:39:07,125 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:07.129460184Z [err]  2025-12-29 21:39:07,125 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': '0775794b-a449-4d0f-b655-07772ce4f55d', 'occurred_at': '2025-12-29T21:39:06.803972Z', 'payload': {'call_control_id': 'v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'call_leg_id': 'cafa9c68-e4fe-11f0-a9ae-02420aef98a0', 'call_session_id': 'caf76912-e4fe-11f0-a394-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': 'b31af26b-88ce-42a8-9374-168b54ce870e', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:07.129465433Z [err]  2025-12-29 21:39:07,125 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:07.129470365Z [err]  2025-12-29 21:39:07,125 - server - INFO - üì® ================================================
2025-12-29T21:39:07.129475713Z [inf]  100.64.0.15:61586 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:07.200562231Z [err]  2025-12-29 21:39:07,195 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:07.215566857Z [err]  2025-12-29 21:39:07,212 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-29T21:39:07.215575699Z [err]  2025-12-29 21:39:07,212 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-29T21:39:07.221171958Z [err]  2025-12-29 21:39:07,219 - redis_service - INFO - üì• Retrieved call data from Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:07.224109635Z [err]  2025-12-29 21:39:07,220 - server - INFO - üìù Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:07.224117835Z [err]  2025-12-29 21:39:07,220 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T21:39:07.273595946Z [err]  2025-12-29 21:39:07,268 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.4s silence (threshold: 7s)
2025-12-29T21:39:07.273608290Z [err]  2025-12-29 21:39:07,269 - core_calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-29T21:39:07.273615944Z [err]  2025-12-29 21:39:07,269 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.4s silence: Are you still there?
2025-12-29T21:39:07.273621789Z [err]  2025-12-29 21:39:07,269 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:07.273629223Z [err]  2025-12-29 21:39:07,269 - telnyx_service - INFO - üîä Speaking text on call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg: Are you still there?...
2025-12-29T21:39:07.273642125Z [err]  2025-12-29 21:39:07,269 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-29T21:39:07.273648764Z [err]  2025-12-29 21:39:07,269 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-29T21:39:07.273653964Z [err]  2025-12-29 21:39:07,269 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-29T21:39:07.273659660Z [err]  2025-12-29 21:39:07,269 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-29T21:39:07.273671552Z [err]  2025-12-29 21:39:07,269 - server - INFO - ‚è±Ô∏è [21:39:07.269] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-29T21:39:07.273681149Z [err]  2025-12-29 21:39:07,269 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-29T21:39:07.273687151Z [err]  2025-12-29 21:39:07,269 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-29T21:39:07.285857850Z [err]  2025-12-29 21:39:07,280 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:07.285867428Z [err]  2025-12-29 21:39:07,280 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-29T21:39:07.307240783Z [err]  2025-12-29 21:39:07,302 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:07.310151133Z [err]  2025-12-29 21:39:07,306 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-29T21:39:07.310163863Z [err]  2025-12-29 21:39:07,306 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T21:39:07.326112010Z [err]  2025-12-29 21:39:07,319 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T21:39:07.326122987Z [err]  2025-12-29 21:39:07,319 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T21:39:07.326131537Z [err]  2025-12-29 21:39:07,320 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-29T21:39:07.411850414Z [err]  2025-12-29 21:39:07,407 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:07.430613409Z [err]  2025-12-29 21:39:07,425 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 105ms
2025-12-29T21:39:07.430620509Z [err]  2025-12-29 21:39:07,425 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-29T21:39:07.430625181Z [err]  2025-12-29 21:39:07,425 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-29T21:39:07.430629326Z [err]  2025-12-29 21:39:07,425 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-29T21:39:07.430633833Z [err]  2025-12-29 21:39:07,426 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-29T21:39:07.430638592Z [err]  2025-12-29 21:39:07,426 - server - INFO - ‚úÖ Initialized call_states for v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ with session reference
2025-12-29T21:39:07.433526008Z [err]  2025-12-29 21:39:07,429 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-29T21:39:07.501745382Z [err]  2025-12-29 21:39:07,499 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:39:07.506267182Z [err]  2025-12-29 21:39:07,500 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-29T21:39:07.517883958Z [err]  2025-12-29 21:39:07,514 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-29T21:39:07.583276127Z [err]  2025-12-29 21:39:07,579 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ/actions/playback_start "HTTP/1.1 200 OK"
2025-12-29T21:39:07.583284787Z [err]  2025-12-29 21:39:07,580 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: Wc5eOpK9Xg (loop=True, overlay=True)
2025-12-29T21:39:07.583292112Z [err]  2025-12-29 21:39:07,580 - server - WARNING - ‚ö†Ô∏è Failed to start comfort noise: 'v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'
2025-12-29T21:39:07.583297559Z [err]  2025-12-29 21:39:07,580 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:08.089675038Z [err]  2025-12-29 21:39:07,915 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ/actions/record_start "HTTP/1.1 200 OK"
2025-12-29T21:39:08.089681760Z [err]  2025-12-29 21:39:07,917 - server - INFO - üéôÔ∏è Call recording started for v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:08.089687677Z [err]  2025-12-29 21:39:07,917 - server - INFO - üîß Creating call session for v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ...
2025-12-29T21:39:08.089693105Z [err]  2025-12-29 21:39:07,917 - server - INFO - üîç Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:08.089699121Z [err]  2025-12-29 21:39:07,917 - server - INFO - üîß Calling create_call_session() - START
2025-12-29T21:39:08.089708713Z [err]  2025-12-29 21:39:07,917 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T21:39:08.089714063Z [err]  2025-12-29 21:39:07,918 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:08.089720076Z [err]  2025-12-29 21:39:07,918 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-29T21:39:08.089725864Z [err]  2025-12-29 21:39:07,918 - server - INFO -    Text length: 20 chars
2025-12-29T21:39:08.089731707Z [err]  2025-12-29 21:39:07,918 - server - INFO -    Text content: 'Are you still there?'
2025-12-29T21:39:08.089748041Z [err]  2025-12-29 21:39:07,918 - server - INFO -    Text bytes: b'Are you still there?'
2025-12-29T21:39:08.089753378Z [err]  2025-12-29 21:39:07,918 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-29T21:39:08.089758059Z [err]  2025-12-29 21:39:07,918 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-29T21:39:08.089763736Z [err]  2025-12-29 21:39:07,918 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-29T21:39:08.093426361Z [err]  2025-12-29 21:39:07,918 - server - INFO -    Full data: {'text': 'Are you still there?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-29T21:39:08.093446124Z [err]  2025-12-29 21:39:07,918 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-29T21:39:08.093450339Z [err]  2025-12-29 21:39:07,918 - server - INFO -    Timeout: 10.0s
2025-12-29T21:39:08.093454876Z [err]  2025-12-29 21:39:07,929 - server - INFO -    ‚úì HTTP client created (0.010s)
2025-12-29T21:39:08.093459696Z [err]  2025-12-29 21:39:07,929 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-29T21:39:08.093463623Z [err]  2025-12-29 21:39:07,990 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-29T21:39:08.093467618Z [err]  2025-12-29 21:39:07,991 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-29T21:39:08.093471547Z [err]  2025-12-29 21:39:07,991 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-29T21:39:08.093475574Z [err]  2025-12-29 21:39:08,003 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-29T21:39:08.093479813Z [err]  2025-12-29 21:39:08,003 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T21:39:08.093483610Z [err]  2025-12-29 21:39:08,003 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T21:39:08.093487354Z [err]  2025-12-29 21:39:08,003 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T21:39:08.095819135Z [err]  2025-12-29 21:39:08,003 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-29T21:39:08.095827917Z [inf]  100.64.0.14:13126 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-29T21:39:08.095833527Z [err]  2025-12-29 21:39:08,018 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:08.095839225Z [err]  2025-12-29 21:39:08,018 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:08.095844986Z [err]  2025-12-29 21:39:08,020 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:08.095849952Z [err]  2025-12-29 21:39:08,021 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-29T21:39:08.095855471Z [err]  2025-12-29 21:39:08,090 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:08.105845209Z [err]  2025-12-29 21:39:08,100 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 96ms
2025-12-29T21:39:08.105856534Z [err]  2025-12-29 21:39:08,100 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-29T21:39:08.105866487Z [err]  2025-12-29 21:39:08,100 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-29T21:39:08.112015041Z [err]  2025-12-29 21:39:08,107 - redis_service - INFO - üì¶ Stored call data in Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ (TTL: 3600s)
2025-12-29T21:39:08.112026545Z [err]  2025-12-29 21:39:08,107 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-29T21:39:08.112032993Z [err]  2025-12-29 21:39:08,107 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-29T21:39:08.112039081Z [err]  2025-12-29 21:39:08,108 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:08.112046163Z [err]  2025-12-29 21:39:08,108 - server - INFO - ü§ñ AI session created for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:08.112052227Z [err]  2025-12-29 21:39:08,108 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-29T21:39:08.112057285Z [err]  2025-12-29 21:39:08,108 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-29T21:39:08.112064665Z [err]  2025-12-29 21:39:08,109 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-29T21:39:08.112070104Z [err]  2025-12-29 21:39:08,109 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-29T21:39:08.112075308Z [err]  2025-12-29 21:39:08,109 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-29T21:39:08.112080293Z [err]  2025-12-29 21:39:08,109 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-29T21:39:08.112084978Z [err]  2025-12-29 21:39:08,109 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-29T21:39:08.118195883Z [err]  2025-12-29 21:39:08,115 - redis_service - INFO - üì• Retrieved call data from Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:08.120865497Z [err]  2025-12-29 21:39:08,118 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-29T21:39:08.120871554Z [err]  2025-12-29 21:39:08,118 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-29T21:39:08.123449397Z [inf]  100.64.0.8:48944 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:08.277630570Z [err]  2025-12-29 21:39:08,275 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-29T21:39:08.277638697Z [err]  2025-12-29 21:39:08,275 - server - INFO -    ‚úì Connection established (0.357s) [TARGET: <200ms]
2025-12-29T21:39:08.277643202Z [err]  2025-12-29 21:39:08,275 - server - INFO -    ‚úì Response status: 200
2025-12-29T21:39:08.277648508Z [err]  2025-12-29 21:39:08,275 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-29T21:39:08.296277815Z [err]  2025-12-29 21:39:08,292 - server - INFO -    ‚úì FIRST CHUNK received (0.374s, 1135 bytes) [TARGET: <300ms]
2025-12-29T21:39:08.300023068Z [err]  2025-12-29 21:39:08,294 - server - INFO -    ‚úì ALL CHUNKS received: 49 chunks (0.376s)
2025-12-29T21:39:08.300033202Z [err]  2025-12-29 21:39:08,294 - server - INFO -    ‚úì Total audio size: 17599 bytes
2025-12-29T21:39:08.300044056Z [err]  2025-12-29 21:39:08,294 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-29T21:39:08.300049402Z [err]  2025-12-29 21:39:08,294 - server - INFO -       - Connection: 357ms
2025-12-29T21:39:08.300057257Z [err]  2025-12-29 21:39:08,294 - server - INFO -       - First chunk: 374ms
2025-12-29T21:39:08.300062750Z [err]  2025-12-29 21:39:08,294 - server - INFO -       - All chunks: 376ms
2025-12-29T21:39:08.300067770Z [err]  2025-12-29 21:39:08,294 - server - INFO -       - Audio generation only: 17ms
2025-12-29T21:39:08.300072424Z [err]  2025-12-29 21:39:08,294 - server - INFO - ‚è±Ô∏è [21:39:08.294] üîä TTS COMPLETE: 1025ms, audio_size=17599 bytes
2025-12-29T21:39:08.300076864Z [err]  2025-12-29 21:39:08,295 - server - INFO - üíæ TTS CACHED: elevenlabs:Are you still there?... (17599 bytes)
2025-12-29T21:39:08.300081853Z [err]  2025-12-29 21:39:08,295 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 1.03s
2025-12-29T21:39:08.300088263Z [err]  2025-12-29 21:39:08,295 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:08.300108523Z [err]  2025-12-29 21:39:08,295 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:08.528103296Z [err]  2025-12-29 21:39:08,522 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:08.584401570Z [err]  2025-12-29 21:39:08,578 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:08.584408177Z [err]  2025-12-29 21:39:08,578 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.28s
2025-12-29T21:39:08.584412482Z [err]  2025-12-29 21:39:08,578 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-29T21:39:08.584416539Z [err]    "errors": [
2025-12-29T21:39:08.584420523Z [err]      {
2025-12-29T21:39:08.584424893Z [err]        "code": "90018",
2025-12-29T21:39:08.584429506Z [err]        "title": "Call has already ended",
2025-12-29T21:39:08.584433356Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:39:08.584437251Z [err]      }
2025-12-29T21:39:08.584442314Z [err]    ]
2025-12-29T21:39:08.584446830Z [err]  }
2025-12-29T21:39:08.584451244Z [err]  2025-12-29 21:39:08,578 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-29T21:39:09.104650838Z [err]  2025-12-29 21:39:08,843 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:09.104657376Z [err]  2025-12-29 21:39:08,844 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:39:09.104665442Z [err]  2025-12-29 21:39:08,844 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-29T21:39:09.104671426Z [err]  2025-12-29 21:39:09,023 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:09.354518630Z [err]  2025-12-29 21:39:09,345 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-29T21:39:09.354529274Z [err]  2025-12-29 21:39:09,345 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044349.3453753 for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:09.354536166Z [err]  2025-12-29 21:39:09,345 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:09.439397008Z [err]  2025-12-29 21:39:09,435 - redis_service - INFO - üì• Retrieved call data from Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:09.445004284Z [err]  2025-12-29 21:39:09,441 - redis_service - INFO - üì• Retrieved call data from Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:09.452742327Z [err]  2025-12-29 21:39:09,449 - redis_service - INFO - üì¶ Stored call data in Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ (TTL: 3600s)
2025-12-29T21:39:09.452754923Z [err]  2025-12-29 21:39:09,449 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-29T21:39:09.452761915Z [err]  2025-12-29 21:39:09,449 - core_calling_service - INFO - ‚è±Ô∏è [21:39:09.449] üì• process_user_input() ENTRY - text: '...'
2025-12-29T21:39:09.456346107Z [err]  2025-12-29 21:39:09,453 - redis_service - INFO - üì• Retrieved call data from Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:09.459125324Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - ‚è±Ô∏è [21:39:09.454] ‚è© About to call _process_call_flow_streaming()
2025-12-29T21:39:09.459135055Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - ‚è±Ô∏è [21:39:09.454] üîÄ Agent type: call_flow, calling flow processor...
2025-12-29T21:39:09.459143035Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - ‚è±Ô∏è [21:39:09.454] üîÄ _process_call_flow_streaming() ENTRY
2025-12-29T21:39:09.459148950Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-29T21:39:09.459156639Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - ‚è±Ô∏è [21:39:09.454] ‚úÖ Node selected, about to process content...
2025-12-29T21:39:09.459162593Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - üîß Replaced {{now}} with Monday, December 29, 2025 at 4:39 PM EST in content
2025-12-29T21:39:09.459168281Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-29T21:39:09.459173847Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-29T21:39:09.459179829Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-29T21:39:09.459185155Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T21:39:09.459191286Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-29T21:39:09.459197185Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-29T21:39:09.459202905Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-29T21:39:09.463011571Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-29T21:39:09.463021674Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-29T21:39:09.463028322Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-29T21:39:09.463034188Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-29T21:39:09.463040619Z [err]  2025-12-29 21:39:09,454 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-29T21:39:09.463047394Z [err]  2025-12-29 21:39:09,455 - core_calling_service - INFO - ‚è±Ô∏è [21:39:09.455] üìÑ About to process content (mode=script, length=9)
2025-12-29T21:39:09.463053289Z [err]  2025-12-29 21:39:09,455 - core_calling_service - INFO - üîä Silence tracking reset for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ (user responded)
2025-12-29T21:39:09.463060107Z [err]  2025-12-29 21:39:09,455 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-29T21:39:09.463065807Z [err]  2025-12-29 21:39:09,455 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-29T21:39:09.463072855Z [err]  2025-12-29 21:39:09,455 - core_calling_service - INFO - LLM response (0.01s): Kendrick?
2025-12-29T21:39:09.463080147Z [err]  2025-12-29 21:39:09,455 - core_calling_service - INFO - Total latency: 0.01s
2025-12-29T21:39:09.463086673Z [err]  2025-12-29 21:39:09,455 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-29T21:39:09.483491871Z [err]  2025-12-29 21:39:09,480 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:09.483505675Z [err]  2025-12-29 21:39:09,480 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '66825f2d-e77e-4fdc-89a4-1df943c017f5', 'occurred_at': '2025-12-29T21:39:09.004011Z', 'payload': {'call_control_id': 'v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'call_leg_id': 'cafa9c68-e4fe-11f0-a9ae-02420aef98a0', 'call_session_id': 'caf76912-e4fe-11f0-a394-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'Wc5eOpK9Xg', 'start_time': '2025-12-29T21:39:09.004011Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:09.483512633Z [err]  2025-12-29 21:39:09,480 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:09.483518384Z [err]  2025-12-29 21:39:09,480 - server - INFO - üì® ================================================
2025-12-29T21:39:09.483525063Z [inf]  100.64.0.16:41158 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:09.531768540Z [err]  2025-12-29 21:39:09,526 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:09.560226451Z [err]  2025-12-29 21:39:09,552 - redis_service - INFO - üì• Retrieved call data from Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:09.560239153Z [err]  2025-12-29 21:39:09,554 - telnyx_service - INFO - üîä Speaking text on call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ: Kendrick?...
2025-12-29T21:39:09.560250151Z [err]  2025-12-29 21:39:09,554 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-29T21:39:09.560256750Z [err]  2025-12-29 21:39:09,554 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-29T21:39:09.560263937Z [err]  2025-12-29 21:39:09,554 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-29T21:39:09.560270029Z [err]  2025-12-29 21:39:09,554 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-29T21:39:09.560275606Z [err]  2025-12-29 21:39:09,554 - server - INFO - ‚è±Ô∏è [21:39:09.554] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-29T21:39:09.560282420Z [err]  2025-12-29 21:39:09,554 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-29T21:39:09.560287911Z [err]  2025-12-29 21:39:09,554 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-29T21:39:10.100908692Z [err]  2025-12-29 21:39:09,640 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:10.100912202Z [err]  2025-12-29 21:39:09,640 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-29T21:39:10.100918822Z [err]  2025-12-29 21:39:09,640 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-29T21:39:10.100925766Z [err]  2025-12-29 21:39:09,640 - server - INFO -    Full data: {'text': 'Kendrick?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-29T21:39:10.100929620Z [err]  2025-12-29 21:39:09,640 - server - INFO -    Text length: 9 chars
2025-12-29T21:39:10.100938099Z [err]  2025-12-29 21:39:09,640 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-29T21:39:10.100940561Z [err]  2025-12-29 21:39:09,640 - server - INFO -    Text content: 'Kendrick?'
2025-12-29T21:39:10.100946511Z [err]  2025-12-29 21:39:09,640 - server - INFO -    Timeout: 10.0s
2025-12-29T21:39:10.100949896Z [err]  2025-12-29 21:39:09,640 - server - INFO -    Text bytes: b'Kendrick?'
2025-12-29T21:39:10.100958419Z [err]  2025-12-29 21:39:09,651 - server - INFO -    ‚úì HTTP client created (0.010s)
2025-12-29T21:39:10.100958674Z [err]  2025-12-29 21:39:09,640 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-29T21:39:10.100968599Z [err]  2025-12-29 21:39:09,640 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-29T21:39:10.100968841Z [err]  2025-12-29 21:39:09,651 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-29T21:39:10.100977086Z [err]  2025-12-29 21:39:10,017 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-29T21:39:10.104973273Z [err]  2025-12-29 21:39:10,028 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.47s
2025-12-29T21:39:10.105084536Z [err]  2025-12-29 21:39:10,028 - telnyx_service - INFO - ‚úÖ Generated 13419 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-29T21:39:10.105101439Z [err]  2025-12-29 21:39:10,028 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-29T21:39:10.105315989Z [err]  2025-12-29 21:39:10,017 - server - INFO -    ‚úì Connection established (0.376s) [TARGET: <200ms]
2025-12-29T21:39:10.105320367Z [err]  2025-12-29 21:39:10,017 - server - INFO -    ‚úì Response status: 200
2025-12-29T21:39:10.105326011Z [err]  2025-12-29 21:39:10,017 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-29T21:39:10.105331547Z [err]  2025-12-29 21:39:10,025 - server - INFO -    ‚úì FIRST CHUNK received (0.385s, 921 bytes) [TARGET: <300ms]
2025-12-29T21:39:10.105336609Z [err]  2025-12-29 21:39:10,026 - server - INFO -    ‚úì ALL CHUNKS received: 25 chunks (0.386s)
2025-12-29T21:39:10.105341587Z [err]  2025-12-29 21:39:10,026 - server - INFO -    ‚úì Total audio size: 13419 bytes
2025-12-29T21:39:10.105345963Z [err]  2025-12-29 21:39:10,026 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-29T21:39:10.105350397Z [err]  2025-12-29 21:39:10,027 - server - INFO -       - Connection: 376ms
2025-12-29T21:39:10.105355304Z [err]  2025-12-29 21:39:10,027 - server - INFO -       - First chunk: 385ms
2025-12-29T21:39:10.105360315Z [err]  2025-12-29 21:39:10,027 - server - INFO -       - All chunks: 386ms
2025-12-29T21:39:10.105365157Z [err]  2025-12-29 21:39:10,027 - server - INFO -       - Audio generation only: 8ms
2025-12-29T21:39:10.105370120Z [err]  2025-12-29 21:39:10,027 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:10.105374399Z [err]  2025-12-29 21:39:10,027 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-29T21:39:10.105379217Z [err]  2025-12-29 21:39:10,028 - server - INFO - ‚è±Ô∏è [21:39:10.028] üîä TTS COMPLETE: 473ms, audio_size=13419 bytes
2025-12-29T21:39:10.105384178Z [err]  2025-12-29 21:39:10,028 - server - INFO - üíæ TTS CACHED: elevenlabs:Kendrick?... (13419 bytes)
2025-12-29T21:39:10.313684169Z [err]  2025-12-29 21:39:10,307 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ/actions/playback_start "HTTP/1.1 200 OK"
2025-12-29T21:39:10.313694156Z [err]  2025-12-29 21:39:10,308 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.28s
2025-12-29T21:39:10.313701712Z [err]  2025-12-29 21:39:10,308 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 0.75s
2025-12-29T21:39:10.313707669Z [err]  2025-12-29 21:39:10,308 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-29T21:39:10.313714478Z [err]  2025-12-29 21:39:10,308 - telnyx_service - INFO - üé¨ Playback ID: bvPyHNlU-w
2025-12-29T21:39:10.313721089Z [err]  2025-12-29 21:39:10,309 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-29T21:39:10.313725832Z [err]  2025-12-29 21:39:10,309 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Greeting playback started at 1767044350.3090425
2025-12-29T21:39:10.313730221Z [err]  2025-12-29 21:39:10,309 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044350.3090737 for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:10.313734810Z [err]  2025-12-29 21:39:10,309 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-29T21:39:10.353276894Z [err]  2025-12-29 21:39:10,348 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=1.0s, checkin_count=1/2
2025-12-29T21:39:10.402290870Z [inf]  100.64.0.8:48944 - "GET /api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3 HTTP/1.1" 200
2025-12-29T21:39:10.412491074Z [err]  2025-12-29 21:39:10,405 - server - INFO - üî§ RAW TOKENS: ["H"?]
2025-12-29T21:39:10.412501552Z [err]  2025-12-29 21:39:10,408 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user started speaking) for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:10.412508645Z [err]  2025-12-29 21:39:10,408 - core_calling_service - INFO - üîä Silence timer reset for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ (user started speaking)
2025-12-29T21:39:10.412518117Z [err]  2025-12-29 21:39:10,408 - core_calling_service - INFO - üë§ User started speaking for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:10.412523890Z [err]  2025-12-29 21:39:10,408 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-29T21:39:10.412533060Z [err]  2025-12-29 21:39:10,408 - server - INFO - üîç PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-29T21:39:10.526294352Z [err]  2025-12-29 21:39:10,523 - server - INFO - üî§ RAW TOKENS: ["H"?, "ello"?]
2025-12-29T21:39:10.526300834Z [err]  2025-12-29 21:39:10,523 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Hello' | Generating: False
2025-12-29T21:39:10.533611479Z [err]  2025-12-29 21:39:10,529 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:10.533618071Z [err]  2025-12-29 21:39:10,529 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=True, silence=0.0s, checkin_count=0/2
2025-12-29T21:39:11.099316150Z [err]  2025-12-29 21:39:10,660 - server - INFO - ‚è±Ô∏è User spoke at 1767044350.6609733
2025-12-29T21:39:11.099326519Z [err]  2025-12-29 21:39:10,661 - redis_service - INFO - üì¶ Stored call data in Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ (TTL: 3600s)
2025-12-29T21:39:11.099653366Z [err]  2025-12-29 21:39:10,659 - server - INFO - üî§ RAW TOKENS: ["H"‚úì, "ello"‚úì, "?"‚úì, "<end>"‚úì]
2025-12-29T21:39:11.099661700Z [err]  2025-12-29 21:39:10,659 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-29T21:39:11.099669401Z [err]  2025-12-29 21:39:10,660 - server - INFO - üßπ Cleaned transcript: 'H ello ?' -> 'Hello?'
2025-12-29T21:39:11.099676954Z [err]  2025-12-29 21:39:10,660 - server - INFO - üì• FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-29T21:39:11.099684377Z [err]  2025-12-29 21:39:10,660 - server - INFO - üé§ Soniox final transcript: 'Hello?'
2025-12-29T21:39:11.099693453Z [err]  2025-12-29 21:39:10,660 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:11.099700025Z [err]  2025-12-29 21:39:10,660 - server - INFO - üîç FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-29T21:39:11.099706796Z [err]  2025-12-29 21:39:10,660 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:11.099713795Z [err]  2025-12-29 21:39:10,660 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-29T21:39:11.099722495Z [err]  2025-12-29 21:39:10,660 - server - INFO - ‚è±Ô∏è [21:39:10.660] üìù FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-29T21:39:11.099729788Z [err]  2025-12-29 21:39:10,660 - server - INFO - ‚è±Ô∏è [21:39:10.660] STT endpoint detection latency: 9ms
2025-12-29T21:39:11.099736894Z [err]  2025-12-29 21:39:10,660 - server - INFO - ‚è±Ô∏è [21:39:10.660] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-29T21:39:11.108732840Z [err]  2025-12-29 21:39:10,661 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-29T21:39:11.108740412Z [err]  2025-12-29 21:39:10,661 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:11.108746857Z [err]  2025-12-29 21:39:10,661 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-29T21:39:11.108755269Z [err]  2025-12-29 21:39:10,672 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-29T21:39:11.108762356Z [err]  2025-12-29 21:39:10,672 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-29T21:39:11.108762886Z [err]  2025-12-29 21:39:10,672 - core_calling_service - INFO - üë§ User stopped speaking for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:11.108770629Z [err]  2025-12-29 21:39:10,672 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-29T21:39:11.108779054Z [err]  2025-12-29 21:39:10,672 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:11.108780814Z [err]  2025-12-29 21:39:10,672 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+20ms
2025-12-29T21:39:11.108795423Z [err]  2025-12-29 21:39:10,764 - server - INFO - üìù Saved user transcript to database
2025-12-29T21:39:11.108796081Z [err]  2025-12-29 21:39:10,672 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 20ms (Soniox model: stt-rt-v3)
2025-12-29T21:39:11.108811094Z [err]  2025-12-29 21:39:10,672 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-29T21:39:11.108814962Z [err]  2025-12-29 21:39:10,764 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:11.116709242Z [err]  2025-12-29 21:39:10,764 - core_calling_service - INFO - ‚è±Ô∏è [21:39:10.764] üì• process_user_input() ENTRY - text: 'Hello?...'
2025-12-29T21:39:11.116717959Z [err]  2025-12-29 21:39:10,766 - redis_service - INFO - üì• Retrieved call data from Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:11.116726076Z [err]  2025-12-29 21:39:10,766 - core_calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ: User spoke while Silence Greeting was triggering
2025-12-29T21:39:11.116734222Z [err]  2025-12-29 21:39:10,792 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:11.116743095Z [err]  2025-12-29 21:39:10,792 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:11.116751741Z [err]  2025-12-29 21:39:10,849 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=1.5s, checkin_count=1/2
2025-12-29T21:39:11.116760121Z [err]  2025-12-29 21:39:11,032 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:11.116766630Z [err]  2025-12-29 21:39:11,033 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:11.116778935Z [err]  2025-12-29 21:39:11,062 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ/actions/playback_stop "HTTP/1.1 200 OK"
2025-12-29T21:39:11.116790314Z [err]  2025-12-29 21:39:11,064 - telnyx_service - INFO - ‚úÖ Successfully stopped audio playback
2025-12-29T21:39:11.116797097Z [err]  2025-12-29 21:39:11,064 - core_calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-29T21:39:11.116803519Z [err]  2025-12-29 21:39:11,064 - core_calling_service - INFO - ‚úÖ BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-29T21:39:11.118936075Z [err]  2025-12-29 21:39:11,065 - redis_service - INFO - üì• Retrieved call data from Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:11.118942477Z [err]  2025-12-29 21:39:11,066 - redis_service - INFO - üì¶ Stored call data in Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ (TTL: 3600s)
2025-12-29T21:39:11.118946850Z [err]  2025-12-29 21:39:11,066 - core_calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-29T21:39:11.118952014Z [err]  2025-12-29 21:39:11,066 - core_calling_service - INFO - ‚è±Ô∏è [21:39:11.066] ‚è© About to call _process_call_flow_streaming()
2025-12-29T21:39:11.118956329Z [err]  2025-12-29 21:39:11,066 - core_calling_service - INFO - ‚è±Ô∏è [21:39:11.066] üîÄ Agent type: call_flow, calling flow processor...
2025-12-29T21:39:11.118960891Z [err]  2025-12-29 21:39:11,066 - core_calling_service - INFO - ‚è±Ô∏è [21:39:11.066] üîÄ _process_call_flow_streaming() ENTRY
2025-12-29T21:39:11.118966957Z [err]  2025-12-29 21:39:11,066 - core_calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-29T21:39:11.118971679Z [err]  2025-12-29 21:39:11,067 - core_calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-29T21:39:11.118976158Z [err]  2025-12-29 21:39:11,067 - core_calling_service - INFO - ‚è±Ô∏è [21:39:11.067] üîÄ About to call _follow_transition() for: Hello?...
2025-12-29T21:39:11.118980067Z [err]  2025-12-29 21:39:11,067 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Hello?
2025-12-29T21:39:11.118984314Z [err]  2025-12-29 21:39:11,067 - core_calling_service - INFO - üîç Checking 'Hello=Yes' override [DEPLOYMENT VERIFIED] for msg='hello' on node='Greeting'
2025-12-29T21:39:11.118988514Z [err]  2025-12-29 21:39:11,067 - core_calling_service - WARNING - ‚ö†Ô∏è Auto-transition after response target not found: None, falling back to normal evaluation
2025-12-29T21:39:11.122931885Z [err]  2025-12-29 21:39:11,079 - core_calling_service - INFO - ‚è±Ô∏è [21:39:11.079] üîÄ TRANSITION EVALUATION START - Calling LLM for 2 options
2025-12-29T21:39:11.257889833Z [err]  2025-12-29 21:39:11,254 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:11.257898969Z [err]  2025-12-29 21:39:11,254 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': 'a867c156-05c0-4686-b354-d595d29bac14', 'occurred_at': '2025-12-29T21:39:10.744046Z', 'payload': {'call_control_id': 'v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'call_leg_id': 'cafa9c68-e4fe-11f0-a9ae-02420aef98a0', 'call_session_id': 'caf76912-e4fe-11f0-a394-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'bvPyHNlU-w'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:11.257905192Z [err]  2025-12-29 21:39:11,254 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:11.257910960Z [err]  2025-12-29 21:39:11,254 - server - INFO - üì® ================================================
2025-12-29T21:39:11.257915680Z [inf]  100.64.0.18:52020 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:11.419406754Z [err]  2025-12-29 21:39:11,415 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:11.419416167Z [err]  2025-12-29 21:39:11,415 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '21b1b84d-71a5-41ab-a1cb-6dd2e577a954', 'occurred_at': '2025-12-29T21:39:10.903984Z', 'payload': {'call_control_id': 'v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'call_leg_id': 'cafa9c68-e4fe-11f0-a9ae-02420aef98a0', 'call_session_id': 'caf76912-e4fe-11f0-a394-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'bvPyHNlU-w', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:11.419421535Z [err]  2025-12-29 21:39:11,415 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:11.419426167Z [err]  2025-12-29 21:39:11,415 - server - INFO - üì® ================================================
2025-12-29T21:39:11.419430435Z [err]  2025-12-29 21:39:11,417 - redis_service - INFO - ‚ûñ Removed playback bvPyHNlU-w, 0 remaining for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:11.419435420Z [err]  2025-12-29 21:39:11,417 - server - INFO - üîä Redis: Removed playback bvPyHNlU-w, 0 remaining
2025-12-29T21:39:11.419441585Z [err]  2025-12-29 21:39:11,417 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T21:39:11.421099568Z [err]  2025-12-29 21:39:11,417 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T21:39:11.421106318Z [err]  2025-12-29 21:39:11,418 - server - INFO - üí° Session not on this worker - Redis flag set for WebSocket worker to handle
2025-12-29T21:39:11.421110572Z [inf]  100.64.0.18:52020 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:11.537806496Z [err]  2025-12-29 21:39:11,533 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-29T21:39:11.537814790Z [err]  2025-12-29 21:39:11,534 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044351.5340834 for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:11.537821174Z [err]  2025-12-29 21:39:11,534 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:11.537829258Z [err]  2025-12-29 21:39:11,534 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:11.547053666Z [err]  2025-12-29 21:39:11,543 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:11.547061923Z [err]  2025-12-29 21:39:11,543 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': '0a82a8f0-9575-4179-85b1-856cfff75b34', 'occurred_at': '2025-12-29T21:39:11.063970Z', 'payload': {'call_control_id': 'v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'call_leg_id': 'cafa9c68-e4fe-11f0-a9ae-02420aef98a0', 'call_session_id': 'caf76912-e4fe-11f0-a394-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:11.547066769Z [err]  2025-12-29 21:39:11,543 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:11.547074575Z [err]  2025-12-29 21:39:11,543 - server - INFO - üì® ================================================
2025-12-29T21:39:11.547079148Z [inf]  100.64.0.15:19018 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:12.110340877Z [err]  2025-12-29 21:39:11,880 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-29T21:39:12.110351269Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - ‚è±Ô∏è [21:39:11.892] üîÄ TRANSITION EVALUATION COMPLETE - took 812ms
2025-12-29T21:39:12.110358350Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - ü§ñ AI transition decision: '-1'
2025-12-29T21:39:12.110367296Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - üìä Available transitions: ['Confirms name (Yes|Speaking|This is he/she) OR Ask...', 'Wrong number (No John here|Wrong number|etc) - don...']
2025-12-29T21:39:12.110372121Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-29T21:39:12.110383408Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-29T21:39:12.110415547Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - Selected transition index: -1
2025-12-29T21:39:12.110424847Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - No specific condition matched, looking for default transition...
2025-12-29T21:39:12.110432308Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - ‚ö†Ô∏è No transition matched, but node has GOAL. Staying on current node to continue with goal-based guidance.
2025-12-29T21:39:12.110438065Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - üéØ Goal: Say the customer's name...
2025-12-29T21:39:12.110444972Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 825ms
2025-12-29T21:39:12.110452022Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - ‚è±Ô∏è [21:39:11.892] ‚úÖ Node selected, about to process content...
2025-12-29T21:39:12.110458399Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - üîß Replaced {{now}} with Monday, December 29, 2025 at 4:39 PM EST in content
2025-12-29T21:39:12.115542440Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-29T21:39:12.115548194Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T21:39:12.115553635Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-29T21:39:12.115561034Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-29T21:39:12.115567091Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-29T21:39:12.115571705Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-29T21:39:12.115576542Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-29T21:39:12.115581290Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-29T21:39:12.115585464Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-29T21:39:12.115590184Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-29T21:39:12.115594955Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - ‚è±Ô∏è [21:39:11.893] üìÑ About to process content (mode=script, length=9)
2025-12-29T21:39:12.115600318Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - üõ°Ô∏è Preventing Dead Air: User stayed on script node 'Greeting' without transition
2025-12-29T21:39:12.115604690Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - ü§ñ Generating sticky-prevention response...
2025-12-29T21:39:12.115810332Z [err]  2025-12-29 21:39:11,903 - core_calling_service - INFO - ‚ö° PARALLEL MODE: Running KB + analysis simultaneously
2025-12-29T21:39:12.115815904Z [err]  2025-12-29 21:39:11,906 - kb_router - INFO - üö¶ KB Router: SKIP (simple chat pattern matched)
2025-12-29T21:39:12.115821714Z [err]  2025-12-29 21:39:11,906 - core_calling_service - INFO - ‚ö° Skipping KB (reason: simple_chat)
2025-12-29T21:39:12.115827039Z [err]  2025-12-29 21:39:11,906 - core_calling_service - INFO - ‚ö° Parallel operations completed in 0ms
2025-12-29T21:39:12.115832810Z [err]  2025-12-29 21:39:11,906 - core_calling_service - INFO - üîç Node 'Greeting': use_parallel_llm=True
2025-12-29T21:39:12.115838860Z [err]  2025-12-29 21:39:11,910 - core_calling_service - INFO - ‚ö° Parallel mode: Using condensed history (3/3 messages)
2025-12-29T21:39:12.115846357Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - ‚è±Ô∏è [21:39:11.910] üí¨ LLM REQUEST START: 3 conversation turns, 7881 system chars (KB cached)
2025-12-29T21:39:12.115851890Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - üìù ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LLM PROMPT BREAKDOWN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-29T21:39:12.115858653Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - üìù [SYSTEM MSG 1 - GLOBAL PROMPT] (6467 chars):
2025-12-29T21:39:12.115865809Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - üìù   Preview: # Global Prompt: Direct Drive Engine (V4.2 - Acknowledging & Fluid)
2025-12-29T21:39:12.115873471Z [err]  
2025-12-29T21:39:12.115880375Z [err]  When user states income, convert/update as [yearly_income] variable for logic splits.
2025-12-29T21:39:12.115886992Z [err]  
2025-12-29T21:39:12.115893775Z [err]  If user says a name, don't assume it's theirs‚Äîwait for explicit correction.
2025-12-29T21:39:12.115900950Z [err]  
2025-12-29T21:39:12.115907388Z [err]  If user asks to repeat info, rephrase naturally‚Äînever exact repeat.
2025-12-29T21:39:12.116644634Z [err]  
2025-12-29T21:39:12.116651540Z [err]  If asked your state: "Atlanta, GA. Been in Midtown 10 years."
2025-12-29T21:39:12.116657288Z [err]  
2025-12-29T21:39:12.116662068Z [err]  If asked about call number: "Company number."
2025-12-29T21:39:12.116668150Z [err]  
2025-12-29T21:39:12.116673003Z [err]  User email: {customer_email} (for them: {{customer_email}}).
2025-12-29T21:39:12.116678086Z [err]  
2025-12-29T21:39:12.116682789Z [err]  If explaining ends in peri...
2025-12-29T21:39:12.116688183Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - üìù [SYSTEM MSG 2 - DYNAMIC CONTEXT] (1414 chars):
2025-12-29T21:39:12.116697193Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - üìù   Preview: 
2025-12-29T21:39:12.116702280Z [err]  
2025-12-29T21:39:12.116707314Z [err]  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
2025-12-29T21:39:12.116713940Z [err]  PREPROCESSED CONTEXT (to help you prioritize and focus):
2025-12-29T21:39:12.116720922Z [err]  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
2025-12-29T21:39:12.116724780Z [err]  
2025-12-29T21:39:12.116728560Z [err]  USER COMMUNICATION STYLE: C type - adjust your response accordingly
2025-12-29T21:39:12.116732304Z [err]  CONVERSATION STATUS: Turn 2, objection handling phase
2025-12-29T21:39:12.116736532Z [err]  
2025-12-29T21:39:12.116740247Z [err]  This context is provided to help you focus. You still need to:
2025-12-29T21:39:12.116743974Z [err]  1. Generate a natural, contextual response
2025-12-29T21:39:12.116747499Z [err]  2. Evaluate transitions per your node instructions
2025-12-29T21:39:12.118841573Z [err]  
2025-12-29T21:39:12.118847491Z [err]  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
2025-12-29T21:39:12.118852403Z [err]  
2025-12-29T21:39:12.118856780Z [err]  # CURRENT CONTEXT
2025-12-29T21:39:12.118861497Z [err]  Customer: Kendrick
2025-12-29T21:39:12.118867441Z [err]  Variables: {"now": "Monday, December 29, 2025 at 4:39 PM EST", "customer_name": "Kendrick", "callerName": "", "lead_id": null, "qc_tracking_enabled": false, "track_keywords": "", "expected_commitment": ...
2025-12-29T21:39:12.118872468Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - üìù [CONVERSATION HISTORY] (3 messages)
2025-12-29T21:39:12.118877510Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - üìù   assistant: Kendrick?...
2025-12-29T21:39:12.118882109Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - üìù   user: Hello?...
2025-12-29T21:39:12.118891934Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - üìù ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-29T21:39:12.118897726Z [err]  2025-12-29 21:39:12,036 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:12.346099523Z [err]  2025-12-29 21:39:12,340 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-29T21:39:12.544006834Z [err]  2025-12-29 21:39:12,538 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:13.216330713Z [err]  2025-12-29 21:39:12,661 - core_calling_service - INFO - ‚è±Ô∏è [21:39:12.661] üí¨ LLM FIRST TOKEN: 750ms (grok grok-4-1-fast-non-reasoning)
2025-12-29T21:39:13.216337281Z [err]  2025-12-29 21:39:12,742 - server - INFO - üì§ Sentence arrived from LLM: [N] Hey Kendrick,...
2025-12-29T21:39:13.216343704Z [err]  2025-12-29 21:39:12,742 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 2070ms
2025-12-29T21:39:13.216349195Z [err]  2025-12-29 21:39:12,742 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-29T21:39:13.216355332Z [err]  2025-12-29 21:39:12,742 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:13.216360882Z [err]  2025-12-29 21:39:12,742 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-29T21:39:13.219029804Z [err]  2025-12-29 21:39:12,828 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:13.219039009Z [err]  2025-12-29 21:39:12,913 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:13.219046018Z [err]  2025-12-29 21:39:12,998 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:13.219053208Z [err]  2025-12-29 21:39:13,022 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:13.219063806Z [err]  2025-12-29 21:39:13,022 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-29T21:39:13.219071102Z [err]  2025-12-29 21:39:13,022 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:39:13.219078542Z [err]  2025-12-29 21:39:13,022 - persistent_tts_service - INFO - üîå [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Establishing persistent TTS WebSocket...
2025-12-29T21:39:13.219162150Z [err]  2025-12-29 21:39:13,022 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:39:13.219169017Z [err]  2025-12-29 21:39:13,022 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-29T21:39:13.219176027Z [err]  2025-12-29 21:39:13,022 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-29T21:39:13.219201836Z [err]  2025-12-29 21:39:13,030 - server - INFO - üì§ Audio flowing: 293 packets sent to Soniox (5s update)
2025-12-29T21:39:13.219208609Z [err]  2025-12-29 21:39:13,039 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:13.219219316Z [err]  2025-12-29 21:39:13,156 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-29T21:39:13.219229433Z [err]  2025-12-29 21:39:13,156 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-29T21:39:13.219252436Z [err]  2025-12-29 21:39:13,156 - persistent_tts_service - INFO - ‚úÖ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Persistent TTS WebSocket established
2025-12-29T21:39:13.219260465Z [err]  2025-12-29 21:39:13,157 - persistent_tts_service - INFO - üéß [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Audio receiver loop started
2025-12-29T21:39:13.219267608Z [err]  2025-12-29 21:39:13,157 - persistent_tts_service - INFO - üîä [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Comfort noise loop started
2025-12-29T21:39:13.219277850Z [err]  2025-12-29 21:39:13,157 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:13.219491544Z [err]  2025-12-29 21:39:13,157 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-29T21:39:13.219498000Z [err]  2025-12-29 21:39:13,157 - server - INFO - üîç Persistent TTS lookup: call_id=v3:tsihRGQZxbPBg2zqu..., session=FOUND
2025-12-29T21:39:13.219504985Z [err]  2025-12-29 21:39:13,157 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-29T21:39:13.219553567Z [err]  2025-12-29 21:39:13,157 - server - INFO - üéµ TTS task #1 started at +414ms
2025-12-29T21:39:13.219560386Z [err]  2025-12-29 21:39:13,157 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 2484ms
2025-12-29T21:39:13.219568015Z [err]  2025-12-29 21:39:13,157 - core_calling_service - INFO - üì§ Streamed sentence: [N] Hey Kendrick,...
2025-12-29T21:39:13.219575078Z [err]  2025-12-29 21:39:13,158 - persistent_tts_service - INFO - üéµ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Playback consumer started
2025-12-29T21:39:13.219582273Z [err]  2025-12-29 21:39:13,158 - persistent_tts_service - INFO - üéß [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Audio Receiver Loop STARTED
2025-12-29T21:39:13.219589032Z [err]  2025-12-29 21:39:13,158 - persistent_tts_service - INFO - üíì [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Starting TTS keep-alive loop (every 15s)
2025-12-29T21:39:13.219595751Z [err]  2025-12-29 21:39:13,158 - persistent_tts_service - INFO - üîä [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Starting comfort noise loop
2025-12-29T21:39:13.219604532Z [err]  2025-12-29 21:39:13,158 - persistent_tts_service - INFO - üé§ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Streaming sentence #1: [N] Hey Kendrick,...
2025-12-29T21:39:13.219611089Z [err]  2025-12-29 21:39:13,158 - persistent_tts_service - INFO - üöÄ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-29T21:39:13.223541621Z [err]  2025-12-29 21:39:13,158 - persistent_tts_service - INFO - üìä [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-29T21:39:13.223560498Z [err]  2025-12-29 21:39:13,160 - server - INFO - üì§ Sentence arrived from LLM: it's Jake here from JK....
2025-12-29T21:39:13.223568800Z [err]  2025-12-29 21:39:13,160 - server - INFO - üîç Persistent TTS lookup: call_id=v3:tsihRGQZxbPBg2zqu..., session=FOUND
2025-12-29T21:39:13.223604701Z [err]  2025-12-29 21:39:13,160 - server - INFO - üöÄ Streaming sentence #2 via persistent WebSocket
2025-12-29T21:39:13.223612316Z [err]  2025-12-29 21:39:13,160 - server - INFO - üéµ TTS task #2 started at +417ms
2025-12-29T21:39:13.223619315Z [err]  2025-12-29 21:39:13,160 - core_calling_service - INFO - üì§ Streamed sentence: it's Jake here from JK....
2025-12-29T21:39:13.223625100Z [err]  2025-12-29 21:39:13,162 - persistent_tts_service - INFO - üéß [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Receiver processing sentence #1: '[N] Hey Kendrick,...'
2025-12-29T21:39:13.223631165Z [err]  2025-12-29 21:39:13,162 - persistent_tts_service - INFO - üìä [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] DIAGNOSTIC: queue_latency=3ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-29T21:39:13.223636718Z [err]  2025-12-29 21:39:13,162 - persistent_tts_service - INFO - üé§ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Streaming sentence #2: it's Jake here from JK....
2025-12-29T21:39:13.223644130Z [err]  2025-12-29 21:39:13,162 - persistent_tts_service - INFO - üöÄ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Sent sentence #2 (NON-BLOCKING) in 0ms
2025-12-29T21:39:13.223651640Z [err]  2025-12-29 21:39:13,162 - persistent_tts_service - INFO - üìä [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=False, is_last=False
2025-12-29T21:39:13.225290613Z [err]  2025-12-29 21:39:13,163 - server - INFO - üì§ Sentence arrived from LLM: You there?...
2025-12-29T21:39:13.225301412Z [err]  2025-12-29 21:39:13,163 - server - INFO - üîç Persistent TTS lookup: call_id=v3:tsihRGQZxbPBg2zqu..., session=FOUND
2025-12-29T21:39:13.225309361Z [err]  2025-12-29 21:39:13,163 - server - INFO - üöÄ Streaming sentence #3 via persistent WebSocket
2025-12-29T21:39:13.225316431Z [err]  2025-12-29 21:39:13,163 - server - INFO - üéµ TTS task #3 started at +420ms
2025-12-29T21:39:13.225327257Z [err]  2025-12-29 21:39:13,163 - core_calling_service - INFO - üì§ Streamed final fragment: You there?...
2025-12-29T21:39:13.225334632Z [err]  2025-12-29 21:39:13,163 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] LLM_TOTAL: 1252ms for 52 chars (grok grok-4-1-fast-non-reasoning)
2025-12-29T21:39:13.225341602Z [err]  2025-12-29 21:39:13,163 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user gave meaningful response) for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:13.225348314Z [err]  2025-12-29 21:39:13,163 - core_calling_service - INFO - üîä Silence tracking reset for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ (user responded)
2025-12-29T21:39:13.225357801Z [err]  2025-12-29 21:39:13,163 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-29T21:39:13.225365317Z [err]  2025-12-29 21:39:13,163 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-29T21:39:13.225375386Z [err]  2025-12-29 21:39:13,163 - core_calling_service - INFO - LLM response (2.40s): [N] Hey Kendrick, it's Jake here from JK. You there?
2025-12-29T21:39:13.225381906Z [err]  2025-12-29 21:39:13,163 - core_calling_service - INFO - Total latency: 2.40s
2025-12-29T21:39:13.225388146Z [err]  2025-12-29 21:39:13,165 - server - INFO - ‚úÖ LLM finished in 2492ms, TTS tasks already running in background
2025-12-29T21:39:13.226814683Z [err]  2025-12-29 21:39:13,165 - server - INFO - üéµ Streaming 3 TTS chunks as they complete...
2025-12-29T21:39:13.226820922Z [err]  2025-12-29 21:39:13,165 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-29T21:39:13.226826819Z [err]  2025-12-29 21:39:13,165 - server - INFO -    3 sentences queued and playing seamlessly
2025-12-29T21:39:13.226836246Z [err]  2025-12-29 21:39:13,166 - persistent_tts_service - INFO - üé§ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Streaming sentence #3: You there?...
2025-12-29T21:39:13.226841603Z [err]  2025-12-29 21:39:13,166 - persistent_tts_service - INFO - üöÄ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Sent sentence #3 (NON-BLOCKING) in 0ms
2025-12-29T21:39:13.226854373Z [err]  2025-12-29 21:39:13,166 - persistent_tts_service - INFO - üìä [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] DIAGNOSTIC: pending_sentences=2, audio_queue=0, is_first=False, is_last=False
2025-12-29T21:39:13.226859777Z [err]  2025-12-29 21:39:13,166 - server - INFO - ‚úÖ All 3 persistent TTS streams completed
2025-12-29T21:39:13.226864989Z [err]  2025-12-29 21:39:13,166 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-29T21:39:13.226871768Z [err]  2025-12-29 21:39:13,166 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 2494ms from user stop üöÄ
2025-12-29T21:39:13.226880759Z [err]  2025-12-29 21:39:13,166 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:13.226891115Z [err]  2025-12-29 21:39:13,166 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-29T21:39:13.226897157Z [err]  2025-12-29 21:39:13,166 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-29T21:39:13.229350542Z [err]  2025-12-29 21:39:13,166 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-29T21:39:13.229358373Z [err]  2025-12-29 21:39:13,166 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 20ms (provider: soniox, model: stt-rt-v3)
2025-12-29T21:39:13.229362888Z [err]  2025-12-29 21:39:13,166 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 2492ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-29T21:39:13.229368181Z [err]  2025-12-29 21:39:13,166 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 424ms (provider: elevenlabs, websocket: False)
2025-12-29T21:39:13.229374491Z [err]  2025-12-29 21:39:13,167 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 2494ms (user stopped ‚Üí play_audio_url called)
2025-12-29T21:39:13.229382744Z [err]  2025-12-29 21:39:13,167 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-29T21:39:13.229389779Z [err]  2025-12-29 21:39:13,167 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-29T21:39:13.229397877Z [err]  2025-12-29 21:39:13,167 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-29T21:39:13.229408788Z [err]  2025-12-29 21:39:13,167 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-29T21:39:13.229415593Z [err]  2025-12-29 21:39:13,167 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-29T21:39:13.229422147Z [err]  2025-12-29 21:39:13,167 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 2794ms estimated
2025-12-29T21:39:13.229443343Z [err]  2025-12-29 21:39:13,167 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 52 chars, 3 sentences
2025-12-29T21:39:13.229450475Z [err]  2025-12-29 21:39:13,167 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Hello?...'
2025-12-29T21:39:13.229455116Z [err]  2025-12-29 21:39:13,167 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: '[N] Hey Kendrick, it's Jake here from JK. You there?...'
2025-12-29T21:39:13.231829577Z [err]  2025-12-29 21:39:13,167 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-29T21:39:13.231840693Z [err]  2025-12-29 21:39:13,167 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-29T21:39:13.355640078Z [err]  2025-12-29 21:39:13,352 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 2936ms)
2025-12-29T21:39:13.355650741Z [err]  2025-12-29 21:39:13,353 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-29T21:39:13.355657935Z [err]  2025-12-29 21:39:13,353 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-29T21:39:13.411415610Z [err]  2025-12-29 21:39:13,409 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 250ms
2025-12-29T21:39:13.411423933Z [err]  2025-12-29 21:39:13,409 - persistent_tts_service - INFO - üì§ Sending 10387 bytes of audio (65 chunks, 1.3s duration) via WebSocket
2025-12-29T21:39:13.411429568Z [err]  2025-12-29 21:39:13,409 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:39:13.411435657Z [err]  2025-12-29 21:39:13,409 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.3s (total: 1.3s from now)
2025-12-29T21:39:13.414216085Z [err]  2025-12-29 21:39:13,410 - persistent_tts_service - INFO - ‚úÖ Sent 65 audio chunks via WebSocket
2025-12-29T21:39:14.079443937Z [err]  2025-12-29 21:39:13,599 - persistent_tts_service - INFO - üì§ Sending 13746 bytes of audio (86 chunks, 1.7s duration) via WebSocket
2025-12-29T21:39:14.079450245Z [err]  2025-12-29 21:39:13,599 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:39:14.079455313Z [err]  2025-12-29 21:39:13,599 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.7s (total: 2.8s from now)
2025-12-29T21:39:14.079460788Z [err]  2025-12-29 21:39:13,601 - persistent_tts_service - INFO - ‚úÖ Sent 86 audio chunks via WebSocket
2025-12-29T21:39:14.079464992Z [err]  2025-12-29 21:39:13,808 - persistent_tts_service - INFO - üì§ Sending 5944 bytes of audio (38 chunks, 0.7s duration) via WebSocket
2025-12-29T21:39:14.079470575Z [err]  2025-12-29 21:39:13,808 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:39:14.079476455Z [err]  2025-12-29 21:39:13,808 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +0.7s (total: 3.4s from now)
2025-12-29T21:39:14.079482235Z [err]  2025-12-29 21:39:13,809 - persistent_tts_service - INFO - ‚úÖ Sent 38 audio chunks via WebSocket
2025-12-29T21:39:15.094953896Z [err]  2025-12-29 21:39:15,049 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (2.1s left)
2025-12-29T21:39:15.558288673Z [err]  2025-12-29 21:39:15,551 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (1.6s left)
2025-12-29T21:39:16.199827519Z [err]  2025-12-29 21:39:15,809 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-29T21:39:16.199832658Z [err]  2025-12-29 21:39:15,809 - persistent_tts_service - INFO - ‚úÖ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Receiver finished sentence #1: 3 chunks in 2650ms
2025-12-29T21:39:16.199838380Z [err]  2025-12-29 21:39:15,809 - persistent_tts_service - INFO - üéß [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Receiver processing sentence #2: 'it's Jake here from JK....'
2025-12-29T21:39:16.199844865Z [err]  2025-12-29 21:39:15,809 - persistent_tts_service - INFO - üìä [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] DIAGNOSTIC: queue_latency=2646ms, pending_sentences=1, audio_queue=0, interrupted=False
2025-12-29T21:39:16.366969963Z [err]  2025-12-29 21:39:16,363 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-29T21:39:16.371421873Z [err]  2025-12-29 21:39:16,365 - core_calling_service - INFO - üí¨ Sending FINAL check-in #2/2: Are you still there?
2025-12-29T21:39:16.371436754Z [err]  2025-12-29 21:39:16,365 - core_calling_service - INFO - ‚ö†Ô∏è Will end call if no response after next silence timeout
2025-12-29T21:39:16.371446163Z [err]  2025-12-29 21:39:16,365 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-29T21:39:16.371453778Z [err]  2025-12-29 21:39:16,365 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:16.371459402Z [err]  2025-12-29 21:39:16,365 - telnyx_service - INFO - üîä Speaking text on call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg: Are you still there?...
2025-12-29T21:39:16.371465472Z [err]  2025-12-29 21:39:16,365 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-29T21:39:16.371471169Z [err]  2025-12-29 21:39:16,365 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-29T21:39:16.371477312Z [err]  2025-12-29 21:39:16,365 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-29T21:39:16.371483327Z [err]  2025-12-29 21:39:16,365 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-29T21:39:16.371489439Z [err]  2025-12-29 21:39:16,365 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-29T21:39:16.371495044Z [err]  2025-12-29 21:39:16,365 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-29T21:39:16.371502013Z [err]  2025-12-29 21:39:16,366 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:16.371507160Z [err]  2025-12-29 21:39:16,366 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:17.149242216Z [err]  2025-12-29 21:39:16,951 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-29T21:39:17.149284601Z [err]  2025-12-29 21:39:16,694 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:17.149290884Z [err]  2025-12-29 21:39:16,694 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.33s
2025-12-29T21:39:17.149298414Z [err]  2025-12-29 21:39:16,694 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-29T21:39:17.149304608Z [err]    "errors": [
2025-12-29T21:39:17.149313982Z [err]      {
2025-12-29T21:39:17.149319855Z [err]        "code": "90018",
2025-12-29T21:39:17.149326892Z [err]        "title": "Call has already ended",
2025-12-29T21:39:17.149332145Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:39:17.149337745Z [err]      }
2025-12-29T21:39:17.149344761Z [err]    ]
2025-12-29T21:39:17.149350583Z [err]  }
2025-12-29T21:39:17.149356378Z [err]  2025-12-29 21:39:16,695 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-29T21:39:17.149362199Z [err]  2025-12-29 21:39:16,950 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:17.149367932Z [err]  2025-12-29 21:39:16,950 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:39:17.416542523Z [err]  2025-12-29 21:39:17,411 - persistent_tts_service - INFO - üîá [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] FLOOR RELEASED (is_holding_floor=False)
2025-12-29T21:39:17.562748068Z [err]  2025-12-29 21:39:17,559 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (0.4s ago), marking agent as done speaking
2025-12-29T21:39:17.562754467Z [err]  2025-12-29 21:39:17,559 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044357.5596902 for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:17.562759907Z [err]  2025-12-29 21:39:17,559 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:18.136412037Z [err]  2025-12-29 21:39:18,031 - server - INFO - üì§ Audio flowing: 544 packets sent to Soniox (5s update)
2025-12-29T21:39:18.314379061Z [err]  2025-12-29 21:39:18,310 - elevenlabs_ws_service - WARNING - ‚ö†Ô∏è  [TIMING] ElevenLabs timeout waiting for first chunk (2.5s) - No audio received!
2025-12-29T21:39:18.314387666Z [err]  2025-12-29 21:39:18,310 - persistent_tts_service - WARNING - ‚ö†Ô∏è [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Receiver got 0 chunks for sentence #2! interrupted=False
2025-12-29T21:39:18.314394123Z [err]  2025-12-29 21:39:18,310 - persistent_tts_service - INFO - üéß [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Receiver processing sentence #3: 'You there?...'
2025-12-29T21:39:18.314401688Z [err]  2025-12-29 21:39:18,310 - persistent_tts_service - INFO - üìä [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] DIAGNOSTIC: queue_latency=5143ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-29T21:39:19.097170855Z [err]  2025-12-29 21:39:18,819 - server - INFO - üé§ Soniox receiver alive - 13 messages received in last 10s
2025-12-29T21:39:19.097179470Z [err]  2025-12-29 21:39:18,963 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 580 total packets
2025-12-29T21:39:19.097193729Z [err]  [2025-12-29 21:39:18 +0000] [5] [INFO] connection closed
2025-12-29T21:39:19.139716580Z [err]  2025-12-29 21:39:19,130 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:19.139723809Z [err]  2025-12-29 21:39:19,130 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': 'fdf17a0a-a69a-4b37-8b09-49c82455a3d9', 'occurred_at': '2025-12-29T21:39:18.834915Z', 'payload': {'call_control_id': 'v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'call_leg_id': 'cafa9c68-e4fe-11f0-a9ae-02420aef98a0', 'call_session_id': 'caf76912-e4fe-11f0-a394-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': 'b31af26b-88ce-42a8-9374-168b54ce870e', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:19.139731501Z [err]  2025-12-29 21:39:19,131 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:19.139739549Z [err]  2025-12-29 21:39:19,131 - server - INFO - üì® ================================================
2025-12-29T21:39:19.139747399Z [inf]  100.64.0.15:12706 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:19.223667843Z [err]  2025-12-29 21:39:19,221 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T21:39:19.223671249Z [err]  2025-12-29 21:39:19,218 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:19.223680576Z [err]  2025-12-29 21:39:19,218 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'b56816bb-1215-4541-8db1-6f95f52f935d', 'occurred_at': '2025-12-29T21:39:18.723971Z', 'payload': {'call_control_id': 'v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'call_leg_id': 'cafa9c68-e4fe-11f0-a9ae-02420aef98a0', 'call_session_id': 'caf76912-e4fe-11f0-a394-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:18.723971Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'Wc5eOpK9Xg', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:19.223687336Z [err]  2025-12-29 21:39:19,218 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:19.223694168Z [err]  2025-12-29 21:39:19,218 - server - INFO - üì® ================================================
2025-12-29T21:39:19.223700736Z [err]  2025-12-29 21:39:19,220 - redis_service - INFO - ‚ûñ Removed playback Wc5eOpK9Xg, 0 remaining for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:19.223706449Z [err]  2025-12-29 21:39:19,220 - server - INFO - üîä Redis: Removed playback Wc5eOpK9Xg, 0 remaining
2025-12-29T21:39:19.223712585Z [err]  2025-12-29 21:39:19,220 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T21:39:19.223720260Z [err]  2025-12-29 21:39:19,220 - server - INFO - ‚è±Ô∏è CLEARED playback_expected_end_time - agent is definitely done speaking
2025-12-29T21:39:19.225945879Z [err]  2025-12-29 21:39:19,221 - server - INFO - ‚úÖ Found session locally: agent_speaking=False, user_speaking=False
2025-12-29T21:39:19.225952015Z [err]  2025-12-29 21:39:19,221 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044359.2217927 for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:19.225957234Z [err]  2025-12-29 21:39:19,221 - server - INFO - ‚è±Ô∏è Silence timer STARTED (local, agent wasn't marked as speaking)
2025-12-29T21:39:19.225966972Z [inf]  100.64.0.16:48750 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:19.283049129Z [err]  2025-12-29 21:39:19,278 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:19.283058811Z [err]  2025-12-29 21:39:19,278 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': '21c73cb3-e29e-48ff-a2b2-8f63bbd5e485', 'occurred_at': '2025-12-29T21:39:18.643964Z', 'payload': {'call_control_id': 'v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'call_leg_id': 'cafa9c68-e4fe-11f0-a9ae-02420aef98a0', 'call_quality_stats': {'inbound': {'jitter_max_variance': '11.49', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '609', 'skip_packet_count': '20'}, 'outbound': {'packet_count': '583', 'skip_packet_count': '0'}}, 'call_session_id': 'caf76912-e4fe-11f0-a394-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:18.643964Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-29T21:39:02.963973Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:19.283065198Z [err]  2025-12-29 21:39:19,278 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:19.283075482Z [err]  2025-12-29 21:39:19,278 - server - INFO - üì® ================================================
2025-12-29T21:39:19.283079584Z [err]  2025-12-29 21:39:19,278 - server - INFO - üìû Call ended: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:19.283084106Z [err]  2025-12-29 21:39:19,278 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-29T21:39:19.463490533Z [err]  2025-12-29 21:39:19,461 - server - INFO - üìù Updated call log: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:19.559708519Z [err]  2025-12-29 21:39:19,553 - server - INFO - ‚úÖ Finalized call log: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ (duration=12s, status=completed)
2025-12-29T21:39:20.089678937Z [err]  2025-12-29 21:39:19,645 - server - INFO - üì¶ Saved 11 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-29T21:39:20.089684005Z [err]  2025-12-29 21:39:19,750 - server - INFO - üé§ Soniox receiver alive - 1 messages received in last 10s
2025-12-29T21:39:20.089691040Z [err]  2025-12-29 21:39:19,750 - server - ERROR - ‚ùå Soniox error: {'tokens': [], 'final_audio_proc_ms': 5520, 'total_audio_proc_ms': 11040, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-29T21:39:20.089696806Z [err]  2025-12-29 21:39:19,750 - server - INFO - ‚úÖ Soniox receive loop ended normally
2025-12-29T21:39:20.089705320Z [err]  2025-12-29 21:39:19,750 - dead_air_monitor - INFO - üîá Dead air monitoring cancelled for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:20.089711619Z [err]  2025-12-29 21:39:19,750 - dead_air_monitor - INFO - üîá Dead air monitoring stopped for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:20.089717275Z [err]  2025-12-29 21:39:19,750 - server - INFO - üîá Dead air monitoring task cancelled
2025-12-29T21:39:20.089722144Z [err]  2025-12-29 21:39:20,064 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.8s, checkin_count=0/2
2025-12-29T21:39:20.345031136Z [err]  2025-12-29 21:39:20,341 - server - INFO - üìä Auto-added call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-29T21:39:20.569025023Z [err]  2025-12-29 21:39:20,566 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=1.3s, checkin_count=0/2
2025-12-29T21:39:20.610817460Z [err]  2025-12-29 21:39:20,604 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:39:20.610825070Z [err]  2025-12-29 21:39:20,605 - redis_service - INFO - üì• Retrieved call data from Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:20.610830075Z [err]  2025-12-29 21:39:20,606 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-29T21:39:20.610835702Z [err]  2025-12-29 21:39:20,606 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-29T21:39:21.184879369Z [err]  2025-12-29 21:39:20,699 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-29T21:39:21.184880733Z [err]  2025-12-29 21:39:20,786 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.184885675Z [err]  2025-12-29 21:39:20,785 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-29T21:39:21.184890788Z [inf]  100.64.0.15:12706 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:21.184891594Z [err]  2025-12-29 21:39:20,785 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-29T21:39:21.184897665Z [err]  2025-12-29 21:39:20,785 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-29T21:39:21.184899739Z [err]  2025-12-29 21:39:20,787 - server - INFO - üîç Starting QC analysis for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.184903042Z [err]  2025-12-29 21:39:20,785 - server - INFO - üöÄ Triggered QC analysis for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.184908334Z [err]  2025-12-29 21:39:20,785 - server - INFO - üìä Triggered Campaign QC for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.184913846Z [err]  2025-12-29 21:39:20,785 - server - INFO - üìá Triggered CRM update for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.184918706Z [err]  2025-12-29 21:39:20,785 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.184923222Z [err]  2025-12-29 21:39:20,786 - redis_service - INFO - üßπ Deleted call data from Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.187259262Z [err]  2025-12-29 21:39:20,787 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-29T21:39:21.187268918Z [err]  2025-12-29 21:39:20,787 - server - INFO - üìá CRM update starting for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:21.187277235Z [err]  2025-12-29 21:39:20,787 - server - INFO - üìá Normalized phone: +17708336397
2025-12-29T21:39:21.187286683Z [err]  2025-12-29 21:39:20,787 - server - INFO - üìá CRM: Got 11 variables from active session
2025-12-29T21:39:21.187299580Z [err]  2025-12-29 21:39:20,795 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:21.187309013Z [err]  2025-12-29 21:39:20,795 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '9fff5c2c-a172-44eb-857b-9c62273349e9', 'occurred_at': '2025-12-29T21:39:20.276817Z', 'payload': {'call_control_id': 'v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'call_leg_id': 'cafa9c68-e4fe-11f0-a9ae-02420aef98a0', 'call_session_id': 'caf76912-e4fe-11f0-a394-02420aef98a0', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:18.734745Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-29T21:39:18.734745Z', 'recording_id': '37490784-2204-4c50-992a-1a159ff78fb8', 'recording_started_at': '2025-12-29T21:39:07.749997Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/cafa9c68-e4fe-11f0-a9ae-02420aef98a0-1767044347724393.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T213920Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=0fd5717981d65c42b3d4cb57cb3cbc8cfa8cd419e11f3c54267a9a83480d5cb3'}, 'start_time': '2025-12-29T21:39:07.749997Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:21.187453720Z [err]  2025-12-29 21:39:20,976 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-29T21:39:21.187461101Z [err]  2025-12-29 21:39:21,002 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:39:21.187467903Z [err]  2025-12-29 21:39:20,795 - server - INFO - üì® ================================================
2025-12-29T21:39:21.187474349Z [err]  2025-12-29 21:39:20,796 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=37490784-2204-4c50-992a-1a159ff78fb8, call_data=False
2025-12-29T21:39:21.187480009Z [err]  2025-12-29 21:39:20,795 - server - INFO - üéôÔ∏è Recording saved for call: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.187489215Z [err]  2025-12-29 21:39:20,810 - elevenlabs_ws_service - WARNING - ‚ö†Ô∏è  [TIMING] ElevenLabs timeout waiting for first chunk (2.5s) - No audio received!
2025-12-29T21:39:21.187497429Z [err]  2025-12-29 21:39:20,796 - redis_service - WARNING - ‚ö†Ô∏è Call data not found in Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.187498708Z [err]  2025-12-29 21:39:20,795 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.187504992Z [err]  2025-12-29 21:39:20,811 - persistent_tts_service - WARNING - ‚ö†Ô∏è [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Receiver got 0 chunks for sentence #3! interrupted=False
2025-12-29T21:39:21.187518571Z [err]  2025-12-29 21:39:20,877 - server - INFO - üìù Converted transcript from 3 messages to 97 characters
2025-12-29T21:39:21.187528303Z [err]  2025-12-29 21:39:20,878 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=3, logs_count=4, status=completed
2025-12-29T21:39:21.187535634Z [err]  2025-12-29 21:39:20,972 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:21.191744280Z [err]  2025-12-29 21:39:21,003 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-29T21:39:21.191755184Z [err]  2025-12-29 21:39:21,057 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-29T21:39:21.191763336Z [err]  2025-12-29 21:39:21,063 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-29T21:39:21.191771880Z [err]  2025-12-29 21:39:21,063 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-29T21:39:21.191778872Z [err]  2025-12-29 21:39:21,063 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:39:21.191785845Z [err]  2025-12-29 21:39:21,063 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-29T21:39:21.191792958Z [err]    File "/app/backend/server.py", line 9773, in trigger_campaign_qc_for_call
2025-12-29T21:39:21.191798360Z [err]      await run_full_qc_analysis(
2025-12-29T21:39:21.191804675Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-29T21:39:21.191810298Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:39:21.191815206Z [err]  
2025-12-29T21:39:21.191820386Z [err]  2025-12-29 21:39:21,142 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-29T21:39:21.191826789Z [err]  2025-12-29 21:39:21,143 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:21.191831907Z [err]  2025-12-29 21:39:21,143 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.330092076Z [err]  2025-12-29 21:39:21,328 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T21:39:21.337847629Z [err]  2025-12-29 21:39:21,335 - server - INFO - üìá CRM: Got 11 extracted variables
2025-12-29T21:39:21.337864340Z [err]  2025-12-29 21:39:21,336 - server - INFO - üìá CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-29T21:39:21.345333708Z [err]  2025-12-29 21:39:21,342 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:39:21.345340960Z [err]  2025-12-29 21:39:21,343 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:21.345346102Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:21.345350637Z [err]  2025-12-29 21:39:21,343 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:21.345354879Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:39:21.348124722Z [err]  2025-12-29 21:39:21,345 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.363945027Z [err]  2025-12-29 21:39:21,356 - server - INFO - üíæ Saved recording URL and ID to database: 37490784-2204-4c50-992a-1a159ff78fb8
2025-12-29T21:39:21.363960238Z [err]  2025-12-29 21:39:21,356 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-29T21:39:21.363968688Z [err]  2025-12-29 21:39:21,356 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-29T21:39:21.418086242Z [err]  2025-12-29 21:39:21,414 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:21.502866007Z [err]  2025-12-29 21:39:21,500 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:21.512981995Z [err]  2025-12-29 21:39:21,510 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-29T21:39:21.530720246Z [err]  2025-12-29 21:39:21,526 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:21.530726710Z [err]  2025-12-29 21:39:21,527 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-29T21:39:21.530737829Z [err]  2025-12-29 21:39:21,527 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-29T21:39:21.530741843Z [err]  2025-12-29 21:39:21,527 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T21:39:22.111465386Z [err]  2025-12-29 21:39:21,654 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/cafa9c68-e4fe-11f0-a9ae-02420aef98a0-1767044347724393.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T213920Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=0fd5717981d65c42b3d4cb57cb3cbc8cfa8cd419e11f3c54267a9a83480d5cb3 "HTTP/1.1 200 OK"
2025-12-29T21:39:22.111469676Z [err]  2025-12-29 21:39:21,740 - server - INFO - ‚úÖ Downloaded 44346 bytes
2025-12-29T21:39:22.111474172Z [err]  2025-12-29 21:39:21,935 - server - INFO - ‚úÖ Split into 2 channels
2025-12-29T21:39:22.111478142Z [err]  2025-12-29 21:39:21,935 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-29T21:39:22.111482460Z [err]  2025-12-29 21:39:21,935 - server - INFO - üìä Channel 0: 240284 bytes
2025-12-29T21:39:22.111486563Z [err]  2025-12-29 21:39:21,936 - server - ERROR - ‚ùå No Soniox API key available
2025-12-29T21:39:22.111490349Z [err]  2025-12-29 21:39:21,936 - server - INFO - ‚ùå Channel 0: No speech
2025-12-29T21:39:22.111494425Z [err]  2025-12-29 21:39:21,936 - server - INFO - üìä Channel 1: 240284 bytes
2025-12-29T21:39:22.111498802Z [err]  2025-12-29 21:39:21,936 - server - ERROR - ‚ùå No Soniox API key available
2025-12-29T21:39:22.111503308Z [err]  2025-12-29 21:39:21,936 - server - INFO - ‚ùå Channel 1: No speech
2025-12-29T21:39:22.111508190Z [err]  2025-12-29 21:39:21,936 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-29T21:39:22.111512077Z [inf]  100.64.0.5:37176 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:22.111516909Z [err]  2025-12-29 21:39:21,936 - soniox_service - ERROR - ‚ùå Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-29T21:39:22.111526162Z [err]  2025-12-29 21:39:21,936 - server - INFO - üîå Telnyx WebSocket disconnected
2025-12-29T21:39:22.218124545Z [err]  2025-12-29 21:39:22,214 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:22.218132095Z [err]  2025-12-29 21:39:22,214 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': '3dc7ab80-7388-490d-bc57-8e7262a4c78e', 'occurred_at': '2025-12-29T21:39:22.015963Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:22.218137355Z [err]  2025-12-29 21:39:22,214 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:22.218143607Z [err]  2025-12-29 21:39:22,214 - server - INFO - üì® ================================================
2025-12-29T21:39:22.218148566Z [err]  2025-12-29 21:39:22,214 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-29T21:39:22.218153169Z [inf]  100.64.0.15:12706 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:22.273495581Z [err]  2025-12-29 21:39:22,269 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-29T21:39:22.276511728Z [err]  2025-12-29 21:39:22,273 - telnyx_service - INFO - ‚úÖ Call initiated: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:22.290234859Z [err]  2025-12-29 21:39:22,284 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:39:22.290248026Z [err]  2025-12-29 21:39:22,284 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:22.290254205Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:22.290259531Z [err]  2025-12-29 21:39:22,284 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:22.290264488Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:39:22.290270229Z [err]  2025-12-29 21:39:22,285 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:22.363855206Z [err]  2025-12-29 21:39:22,361 - server - INFO - üìù Created call log: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:22.363862582Z [err]  2025-12-29 21:39:22,361 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:39:22.363867375Z [err]  2025-12-29 21:39:22,361 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-29T21:39:22.365271643Z [err]  2025-12-29 21:39:22,361 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:39:22.365277719Z [err]  2025-12-29 21:39:22,362 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:39:22.375243603Z [err]  2025-12-29 21:39:22,369 - redis_service - INFO - üì¶ Stored call data in Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (TTL: 3600s)
2025-12-29T21:39:22.375250362Z [err]  2025-12-29 21:39:22,369 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-29T21:39:22.375254424Z [err]  2025-12-29 21:39:22,369 - server - INFO - üìû Outbound call initiated: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:22.375258243Z [inf]  100.64.0.6:14798 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-29T21:39:22.482610853Z [err]  2025-12-29 21:39:22,475 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-29T21:39:22.482622067Z [err]  2025-12-29 21:39:22,475 - server - INFO -    Client: Address(host='100.64.0.16', port=48758)
2025-12-29T21:39:22.482629626Z [err]  2025-12-29 21:39:22,475 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'j+DCQTUpn+zyFCcAoGebVA==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'D8B1DpP9QGuHBakH-_9nXA', 'x-real-ip': '192.76.120.151', 'x-request-start': '1767044362193', 'accept-encoding': 'gzip'}
2025-12-29T21:39:22.482636532Z [err]  2025-12-29 21:39:22,475 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-29T21:39:22.482643575Z [err]  2025-12-29 21:39:22,475 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-29T21:39:22.482652786Z [err]  [2025-12-29 21:39:22 +0000] [5] [INFO] ('100.64.0.16', 48758) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-29T21:39:22.482658924Z [err]  2025-12-29 21:39:22,476 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-29T21:39:22.482665075Z [err]  [2025-12-29 21:39:22 +0000] [5] [INFO] connection open
2025-12-29T21:39:22.543868611Z [err]  2025-12-29 21:39:22,537 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:39:22.543879580Z [err]  2025-12-29 21:39:22,538 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-29T21:39:23.124705203Z [err]  2025-12-29 21:39:22,627 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-29T21:39:23.124715334Z [err]  2025-12-29 21:39:22,627 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-29T21:39:23.124734589Z [err]  2025-12-29 21:39:22,974 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:39:23.124742054Z [err]  2025-12-29 21:39:22,974 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:23.124750697Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:23.124758595Z [err]  2025-12-29 21:39:22,974 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:23.124789280Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:23.124798405Z [err]  2025-12-29 21:39:23,063 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:23.124804833Z [err]  2025-12-29 21:39:23,063 - server - INFO - ‚úÖ QC analysis completed for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:23.124811905Z [err]  2025-12-29 21:39:23,063 - server - INFO - üìä Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-29T21:39:23.252079988Z [err]  2025-12-29 21:39:23,243 - server - INFO - üìä Updated campaign_calls with QC scores for v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:23.424173178Z [err]  2025-12-29 21:39:23,417 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-29T21:39:23.505557449Z [err]  2025-12-29 21:39:23,503 - server - INFO - üè∑Ô∏è Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-29T21:39:23.505568446Z [err]  2025-12-29 21:39:23,503 - server - ERROR - ‚ùå Error in auto appointment detection for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ: 'str' object has no attribute 'get'
2025-12-29T21:39:25.186474685Z [err]  2025-12-29 21:39:25,181 - server - INFO - üì¨ Received Telnyx event: start
2025-12-29T21:39:25.186484261Z [err]  2025-12-29 21:39:25,181 - server - INFO - üé¨ Stream started for call: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:25.190102337Z [err]  2025-12-29 21:39:25,185 - redis_service - INFO - üì• Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:25.190111406Z [err]  2025-12-29 21:39:25,187 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-29T21:39:25.190116465Z [err]  2025-12-29 21:39:25,187 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-29T21:39:25.348356306Z [err]  2025-12-29 21:39:25,344 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:25.348368142Z [err]  2025-12-29 21:39:25,344 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': 'aacc225d-a70b-4c95-8422-8e06ee283abd', 'occurred_at': '2025-12-29T21:39:24.795970Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-29T21:39:22.015963Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:25.348377013Z [err]  2025-12-29 21:39:25,344 - server - INFO - üéØ Event type: call.answered, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:25.348383665Z [err]  2025-12-29 21:39:25,344 - server - INFO - üì® ================================================
2025-12-29T21:39:25.348389369Z [err]  2025-12-29 21:39:25,344 - server - INFO - ‚úÖ Call answered: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:25.351924309Z [err]  2025-12-29 21:39:25,349 - redis_service - INFO - üì• Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:25.354714318Z [err]  2025-12-29 21:39:25,350 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-29T21:39:25.354730984Z [err]  2025-12-29 21:39:25,350 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-29T21:39:25.455965023Z [err]  2025-12-29 21:39:25,452 - server - INFO - ‚úÖ Call log updated
2025-12-29T21:39:25.455976017Z [err]  2025-12-29 21:39:25,452 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:39:25.455982940Z [err]  2025-12-29 21:39:25,452 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:39:25.455988100Z [err]  2025-12-29 21:39:25,453 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:25.543187042Z [err]  2025-12-29 21:39:25,539 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:26.171810775Z [err]  2025-12-29 21:39:25,625 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:26.171865840Z [err]  2025-12-29 21:39:25,692 - server - INFO - üìù Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:26.171878537Z [err]  2025-12-29 21:39:25,692 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T21:39:26.171886134Z [err]  2025-12-29 21:39:25,779 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-29T21:39:26.171913374Z [err]  2025-12-29 21:39:25,625 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-29T21:39:26.171924703Z [err]  2025-12-29 21:39:25,655 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:26.171927420Z [err]  2025-12-29 21:39:25,780 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T21:39:26.171936064Z [err]  2025-12-29 21:39:25,688 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-29T21:39:26.171937587Z [err]  2025-12-29 21:39:25,780 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T21:39:26.171948314Z [err]  2025-12-29 21:39:25,688 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-29T21:39:26.171949742Z [err]  2025-12-29 21:39:25,780 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T21:39:26.171958707Z [err]  2025-12-29 21:39:25,691 - redis_service - INFO - üì• Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:26.171982327Z [err]  2025-12-29 21:39:25,780 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-29T21:39:26.175082119Z [err]  2025-12-29 21:39:25,839 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:39:26.175086430Z [err]  2025-12-29 21:39:25,839 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-29T21:39:26.175090605Z [err]  2025-12-29 21:39:25,859 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-29T21:39:26.175094186Z [err]  2025-12-29 21:39:25,860 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: 2r9zR7I2TQ (loop=True, overlay=True)
2025-12-29T21:39:26.175098024Z [err]  2025-12-29 21:39:25,860 - server - WARNING - ‚ö†Ô∏è Failed to start comfort noise: 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'
2025-12-29T21:39:26.175101630Z [err]  2025-12-29 21:39:25,860 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:26.175106874Z [err]  2025-12-29 21:39:25,866 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:26.175111416Z [err]  2025-12-29 21:39:25,876 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 95ms
2025-12-29T21:39:26.175115190Z [err]  2025-12-29 21:39:25,876 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-29T21:39:26.175119288Z [err]  2025-12-29 21:39:25,876 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-29T21:39:26.175123164Z [err]  2025-12-29 21:39:25,876 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-29T21:39:26.175128216Z [err]  2025-12-29 21:39:25,876 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-29T21:39:26.175134056Z [err]  2025-12-29 21:39:25,876 - server - INFO - ‚úÖ Initialized call_states for v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA with session reference
2025-12-29T21:39:26.176871112Z [err]  2025-12-29 21:39:25,876 - server - INFO - ‚úÖ Stored Telnyx WebSocket in call_data for audio streaming
2025-12-29T21:39:26.176886564Z [err]  2025-12-29 21:39:25,876 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found to update for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:26.176895933Z [err]  2025-12-29 21:39:25,878 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-29T21:39:26.176908247Z [err]  2025-12-29 21:39:25,925 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:26.176917747Z [err]  2025-12-29 21:39:25,925 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': 'df3e64d7-7280-4d3c-b13c-ed0970d7520d', 'occurred_at': '2025-12-29T21:39:25.355972Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '7559e05e-7071-4515-aa1e-73d3ce291eb2', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:26.176928512Z [err]  2025-12-29 21:39:25,925 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:26.176937797Z [err]  2025-12-29 21:39:25,925 - server - INFO - üì® ================================================
2025-12-29T21:39:26.176947334Z [inf]  100.64.0.18:37270 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:26.176962068Z [err]  2025-12-29 21:39:25,964 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-29T21:39:26.292330993Z [err]  2025-12-29 21:39:26,290 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.1s silence (threshold: 7s)
2025-12-29T21:39:26.295343544Z [err]  2025-12-29 21:39:26,291 - core_calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-29T21:39:26.295353665Z [err]  2025-12-29 21:39:26,291 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.1s silence: Are you still there?
2025-12-29T21:39:26.295360331Z [err]  2025-12-29 21:39:26,291 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:26.295367804Z [err]  2025-12-29 21:39:26,291 - telnyx_service - INFO - üîä Speaking text on call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ: Are you still there?...
2025-12-29T21:39:26.295373955Z [err]  2025-12-29 21:39:26,291 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-29T21:39:26.295383265Z [err]  2025-12-29 21:39:26,291 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-29T21:39:26.295390108Z [err]  2025-12-29 21:39:26,291 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-29T21:39:26.295396976Z [err]  2025-12-29 21:39:26,291 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-29T21:39:26.295403261Z [err]  2025-12-29 21:39:26,291 - server - INFO - ‚è±Ô∏è [21:39:26.291] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-29T21:39:26.295409728Z [err]  2025-12-29 21:39:26,291 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-29T21:39:26.295416267Z [err]  2025-12-29 21:39:26,291 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-29T21:39:26.379863080Z [err]  2025-12-29 21:39:26,376 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:26.379877732Z [err]  2025-12-29 21:39:26,377 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-29T21:39:26.379886428Z [err]  2025-12-29 21:39:26,377 - server - INFO -    Text length: 20 chars
2025-12-29T21:39:26.379897825Z [err]  2025-12-29 21:39:26,377 - server - INFO -    Text content: 'Are you still there?'
2025-12-29T21:39:26.379906020Z [err]  2025-12-29 21:39:26,377 - server - INFO -    Text bytes: b'Are you still there?'
2025-12-29T21:39:26.379913614Z [err]  2025-12-29 21:39:26,377 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-29T21:39:26.379921915Z [err]  2025-12-29 21:39:26,377 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-29T21:39:26.379928237Z [err]  2025-12-29 21:39:26,377 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-29T21:39:26.379935161Z [err]  2025-12-29 21:39:26,377 - server - INFO -    Full data: {'text': 'Are you still there?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-29T21:39:26.379943260Z [err]  2025-12-29 21:39:26,377 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-29T21:39:26.379949730Z [err]  2025-12-29 21:39:26,377 - server - INFO -    Timeout: 10.0s
2025-12-29T21:39:26.388235524Z [err]  2025-12-29 21:39:26,385 - server - INFO -    ‚úì HTTP client created (0.008s)
2025-12-29T21:39:26.388245429Z [err]  2025-12-29 21:39:26,385 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-29T21:39:26.435499040Z [err]  2025-12-29 21:39:26,432 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-29T21:39:26.435509832Z [err]  2025-12-29 21:39:26,432 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-29T21:39:26.435517481Z [err]  2025-12-29 21:39:26,432 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-29T21:39:26.435524427Z [err]  2025-12-29 21:39:26,433 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:26.438432990Z [err]  2025-12-29 21:39:26,434 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:26.438441454Z [err]  2025-12-29 21:39:26,434 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-29T21:39:27.213153800Z [err]  2025-12-29 21:39:26,750 - server - INFO - üíæ TTS CACHED: elevenlabs:Are you still there?... (17599 bytes)
2025-12-29T21:39:27.213163917Z [err]  2025-12-29 21:39:26,750 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.46s
2025-12-29T21:39:27.213175192Z [err]  2025-12-29 21:39:26,750 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:27.213316865Z [err]  2025-12-29 21:39:26,735 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-29T21:39:27.213327428Z [err]  2025-12-29 21:39:26,735 - server - INFO -    ‚úì Connection established (0.359s) [TARGET: <200ms]
2025-12-29T21:39:27.213335041Z [err]  2025-12-29 21:39:26,735 - server - INFO -    ‚úì Response status: 200
2025-12-29T21:39:27.213343422Z [err]  2025-12-29 21:39:26,735 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-29T21:39:27.213354320Z [err]  2025-12-29 21:39:26,747 - server - INFO -    ‚úì FIRST CHUNK received (0.370s, 927 bytes) [TARGET: <300ms]
2025-12-29T21:39:27.213361460Z [err]  2025-12-29 21:39:26,749 - server - INFO -    ‚úì ALL CHUNKS received: 59 chunks (0.373s)
2025-12-29T21:39:27.213369206Z [err]  2025-12-29 21:39:26,749 - server - INFO -    ‚úì Total audio size: 17599 bytes
2025-12-29T21:39:27.213376785Z [err]  2025-12-29 21:39:26,749 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-29T21:39:27.213385318Z [err]  2025-12-29 21:39:26,749 - server - INFO -       - Connection: 359ms
2025-12-29T21:39:27.213393390Z [err]  2025-12-29 21:39:26,750 - server - INFO -       - First chunk: 370ms
2025-12-29T21:39:27.213400412Z [err]  2025-12-29 21:39:26,750 - server - INFO -       - All chunks: 373ms
2025-12-29T21:39:27.213406288Z [err]  2025-12-29 21:39:26,750 - server - INFO -       - Audio generation only: 11ms
2025-12-29T21:39:27.213411583Z [err]  2025-12-29 21:39:26,750 - server - INFO - ‚è±Ô∏è [21:39:26.750] üîä TTS COMPLETE: 458ms, audio_size=17599 bytes
2025-12-29T21:39:27.219045966Z [err]  2025-12-29 21:39:26,750 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:27.219063255Z [inf]  100.64.0.13:23294 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-29T21:39:27.219071299Z [err]  2025-12-29 21:39:26,935 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:27.219078977Z [err]  2025-12-29 21:39:27,030 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:27.219085506Z [err]  2025-12-29 21:39:27,031 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.28s
2025-12-29T21:39:27.219199647Z [err]  2025-12-29 21:39:27,031 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-29T21:39:27.219208310Z [err]    "errors": [
2025-12-29T21:39:27.219215631Z [err]      {
2025-12-29T21:39:27.219223847Z [err]        "code": "90018",
2025-12-29T21:39:27.219230349Z [err]        "title": "Call has already ended",
2025-12-29T21:39:27.219236114Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:39:27.219241691Z [err]      }
2025-12-29T21:39:27.219259537Z [err]    ]
2025-12-29T21:39:27.219266026Z [err]  }
2025-12-29T21:39:27.219271576Z [err]  2025-12-29 21:39:27,031 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-29T21:39:27.227984789Z [err]  2025-12-29 21:39:27,225 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:27.230631276Z [err]  2025-12-29 21:39:27,226 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:39:27.230638891Z [err]  2025-12-29 21:39:27,226 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-29T21:39:27.257461365Z [err]  2025-12-29 21:39:27,253 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA/actions/record_start "HTTP/1.1 200 OK"
2025-12-29T21:39:27.257467562Z [err]  2025-12-29 21:39:27,254 - server - INFO - üéôÔ∏è Call recording started for v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:27.257473327Z [err]  2025-12-29 21:39:27,254 - server - INFO - üîß Creating call session for v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA...
2025-12-29T21:39:27.257480348Z [err]  2025-12-29 21:39:27,254 - server - INFO - üîç Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:27.257485105Z [err]  2025-12-29 21:39:27,254 - server - INFO - üîß Calling create_call_session() - START
2025-12-29T21:39:27.257491119Z [err]  2025-12-29 21:39:27,254 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T21:39:27.344780122Z [err]  2025-12-29 21:39:27,341 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-29T21:39:27.344805569Z [err]  2025-12-29 21:39:27,341 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T21:39:27.344822022Z [err]  2025-12-29 21:39:27,341 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T21:39:27.344830138Z [err]  2025-12-29 21:39:27,341 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T21:39:27.344837349Z [err]  2025-12-29 21:39:27,341 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-29T21:39:27.431338557Z [err]  2025-12-29 21:39:27,427 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:27.441598558Z [err]  2025-12-29 21:39:27,437 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:27.444675699Z [err]  2025-12-29 21:39:27,438 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 97ms
2025-12-29T21:39:27.444683222Z [err]  2025-12-29 21:39:27,438 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-29T21:39:27.444688452Z [err]  2025-12-29 21:39:27,438 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-29T21:39:27.447183119Z [err]  2025-12-29 21:39:27,444 - redis_service - INFO - üì¶ Stored call data in Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (TTL: 3600s)
2025-12-29T21:39:27.447193169Z [err]  2025-12-29 21:39:27,445 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-29T21:39:27.447198699Z [err]  2025-12-29 21:39:27,445 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-29T21:39:27.449839373Z [err]  2025-12-29 21:39:27,445 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:27.449859376Z [err]  2025-12-29 21:39:27,445 - server - INFO - ü§ñ AI session created for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:27.449866285Z [err]  2025-12-29 21:39:27,445 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-29T21:39:27.449871604Z [err]  2025-12-29 21:39:27,445 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-29T21:39:27.449877417Z [err]  2025-12-29 21:39:27,445 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-29T21:39:27.449884063Z [err]  2025-12-29 21:39:27,445 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-29T21:39:27.449893779Z [err]  2025-12-29 21:39:27,446 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-29T21:39:27.449899125Z [err]  2025-12-29 21:39:27,446 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-29T21:39:27.449903841Z [err]  2025-12-29 21:39:27,446 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-29T21:39:27.456815156Z [err]  2025-12-29 21:39:27,450 - redis_service - INFO - üì• Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:27.456829317Z [err]  2025-12-29 21:39:27,452 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-29T21:39:27.456837213Z [err]  2025-12-29 21:39:27,452 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-29T21:39:27.456842255Z [inf]  100.64.0.5:37176 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:28.250619882Z [err]  2025-12-29 21:39:27,727 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-29T21:39:28.250628445Z [err]  2025-12-29 21:39:27,727 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044367.7273884 for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:28.250633764Z [err]  2025-12-29 21:39:27,727 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:28.250641575Z [err]  2025-12-29 21:39:27,883 - redis_service - INFO - üì• Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:28.250647641Z [err]  2025-12-29 21:39:27,895 - redis_service - INFO - üì• Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:28.250653654Z [err]  2025-12-29 21:39:27,907 - redis_service - INFO - üì¶ Stored call data in Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (TTL: 3600s)
2025-12-29T21:39:28.250659956Z [err]  2025-12-29 21:39:27,907 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-29T21:39:28.250667808Z [err]  2025-12-29 21:39:27,907 - core_calling_service - INFO - ‚è±Ô∏è [21:39:27.907] üì• process_user_input() ENTRY - text: '...'
2025-12-29T21:39:28.250707621Z [err]  2025-12-29 21:39:27,915 - redis_service - INFO - üì• Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:28.250718411Z [err]  2025-12-29 21:39:27,916 - core_calling_service - INFO - ‚è±Ô∏è [21:39:27.916] ‚è© About to call _process_call_flow_streaming()
2025-12-29T21:39:28.250725638Z [err]  2025-12-29 21:39:27,916 - core_calling_service - INFO - ‚è±Ô∏è [21:39:27.916] üîÄ Agent type: call_flow, calling flow processor...
2025-12-29T21:39:28.250731908Z [err]  2025-12-29 21:39:27,916 - core_calling_service - INFO - ‚è±Ô∏è [21:39:27.916] üîÄ _process_call_flow_streaming() ENTRY
2025-12-29T21:39:28.255884489Z [err]  2025-12-29 21:39:27,916 - core_calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-29T21:39:28.255892503Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - ‚è±Ô∏è [21:39:27.917] ‚úÖ Node selected, about to process content...
2025-12-29T21:39:28.255900062Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - üîß Replaced {{now}} with Monday, December 29, 2025 at 4:39 PM EST in content
2025-12-29T21:39:28.255907577Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-29T21:39:28.255914585Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-29T21:39:28.255921090Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-29T21:39:28.255928307Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T21:39:28.255936092Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-29T21:39:28.255942999Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-29T21:39:28.255968219Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-29T21:39:28.255975188Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-29T21:39:28.255981700Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-29T21:39:28.255989267Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-29T21:39:28.256329185Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-29T21:39:28.256334002Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-29T21:39:28.256338245Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - ‚è±Ô∏è [21:39:27.917] üìÑ About to process content (mode=script, length=9)
2025-12-29T21:39:28.256342046Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - üîä Silence tracking reset for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (user responded)
2025-12-29T21:39:28.256345835Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-29T21:39:28.256349859Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-29T21:39:28.256354546Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - LLM response (0.01s): Kendrick?
2025-12-29T21:39:28.256358668Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - Total latency: 0.01s
2025-12-29T21:39:28.256362458Z [err]  2025-12-29 21:39:27,917 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-29T21:39:28.256367239Z [err]  2025-12-29 21:39:27,938 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:28.256371417Z [err]  2025-12-29 21:39:28,013 - redis_service - INFO - üì• Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:28.256377925Z [err]  2025-12-29 21:39:28,015 - telnyx_service - INFO - üîä Speaking text on call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA: Kendrick?...
2025-12-29T21:39:28.259663479Z [err]  2025-12-29 21:39:28,015 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-29T21:39:28.259672997Z [err]  2025-12-29 21:39:28,015 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-29T21:39:28.259679289Z [err]  2025-12-29 21:39:28,015 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-29T21:39:28.259684382Z [err]  2025-12-29 21:39:28,015 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-29T21:39:28.259705310Z [err]  2025-12-29 21:39:28,015 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (13419 bytes)
2025-12-29T21:39:28.259711929Z [err]  2025-12-29 21:39:28,015 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-29T21:39:28.259716903Z [err]  2025-12-29 21:39:28,016 - telnyx_service - INFO - ‚úÖ Generated 13419 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-29T21:39:28.259721882Z [err]  2025-12-29 21:39:28,016 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-29T21:39:28.278406344Z [err]  2025-12-29 21:39:28,274 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-29T21:39:28.278416416Z [err]  2025-12-29 21:39:28,275 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.26s
2025-12-29T21:39:28.278423503Z [err]  2025-12-29 21:39:28,275 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 0.26s
2025-12-29T21:39:28.278431069Z [err]  2025-12-29 21:39:28,275 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-29T21:39:28.278437618Z [err]  2025-12-29 21:39:28,275 - telnyx_service - INFO - üé¨ Playback ID: wuJo4IVVgw
2025-12-29T21:39:28.282502411Z [err]  2025-12-29 21:39:28,275 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-29T21:39:28.282513927Z [err]  2025-12-29 21:39:28,275 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Greeting playback started at 1767044368.2754192
2025-12-29T21:39:28.282523302Z [err]  2025-12-29 21:39:28,275 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044368.275456 for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:28.282530239Z [err]  2025-12-29 21:39:28,275 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-29T21:39:28.402782646Z [err]  2025-12-29 21:39:28,399 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:28.402794027Z [err]  2025-12-29 21:39:28,399 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': 'b7231169-32b1-4c22-80c7-9feac5413f32', 'occurred_at': '2025-12-29T21:39:27.976106Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': '2r9zR7I2TQ', 'start_time': '2025-12-29T21:39:27.976106Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:28.402801350Z [err]  2025-12-29 21:39:28,400 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:28.402807752Z [err]  2025-12-29 21:39:28,400 - server - INFO - üì® ================================================
2025-12-29T21:39:28.402814636Z [inf]  100.64.0.16:37566 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:28.442494488Z [err]  2025-12-29 21:39:28,439 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:28.594527971Z [inf]  100.64.0.8:57616 - "GET /api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3 HTTP/1.1" 200
2025-12-29T21:39:29.257490552Z [err]  2025-12-29 21:39:28,940 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:29.448479597Z [err]  2025-12-29 21:39:29,442 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:29.451055447Z [err]  2025-12-29 21:39:29,448 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:29.451063328Z [err]  2025-12-29 21:39:29,448 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '56908055-05dc-45d4-992e-8b28aabc1764', 'occurred_at': '2025-12-29T21:39:29.035966Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'wuJo4IVVgw'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:29.451069336Z [err]  2025-12-29 21:39:29,448 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:29.451074610Z [err]  2025-12-29 21:39:29,448 - server - INFO - üì® ================================================
2025-12-29T21:39:29.451079444Z [inf]  100.64.0.15:50120 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:30.193073074Z [err]  2025-12-29 21:39:29,944 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:30.237791458Z [err]  2025-12-29 21:39:30,235 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=2.5s, checkin_count=1/2
2025-12-29T21:39:30.361296509Z [err]  2025-12-29 21:39:30,358 - server - INFO - üî§ RAW TOKENS: ["H"?]
2025-12-29T21:39:30.361304736Z [err]  2025-12-29 21:39:30,358 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user started speaking) for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:30.361309350Z [err]  2025-12-29 21:39:30,359 - core_calling_service - INFO - üîä Silence timer reset for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (user started speaking)
2025-12-29T21:39:30.361313224Z [err]  2025-12-29 21:39:30,359 - core_calling_service - INFO - üë§ User started speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:30.361317059Z [err]  2025-12-29 21:39:30,359 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-29T21:39:30.361322615Z [err]  2025-12-29 21:39:30,359 - server - INFO - üîç PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-29T21:39:30.448790455Z [err]  2025-12-29 21:39:30,446 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:30.448808583Z [err]  2025-12-29 21:39:30,446 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=True, silence=0.0s, checkin_count=0/2
2025-12-29T21:39:30.459273112Z [err]  2025-12-29 21:39:30,452 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:30.459283359Z [err]  2025-12-29 21:39:30,452 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'd6debbb1-60b3-45c1-990c-5e589fd1f770', 'occurred_at': '2025-12-29T21:39:29.875963Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'wuJo4IVVgw', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:30.459289349Z [err]  2025-12-29 21:39:30,452 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:30.459294418Z [err]  2025-12-29 21:39:30,452 - server - INFO - üì® ================================================
2025-12-29T21:39:30.459300441Z [err]  2025-12-29 21:39:30,454 - redis_service - INFO - ‚ûñ Removed playback wuJo4IVVgw, 0 remaining for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:30.459305498Z [err]  2025-12-29 21:39:30,454 - server - INFO - üîä Redis: Removed playback wuJo4IVVgw, 0 remaining
2025-12-29T21:39:30.459310311Z [err]  2025-12-29 21:39:30,454 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T21:39:30.459314860Z [err]  2025-12-29 21:39:30,455 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T21:39:30.459319436Z [err]  2025-12-29 21:39:30,455 - server - INFO - üí° Session not on this worker - Redis flag set for WebSocket worker to handle
2025-12-29T21:39:30.461322210Z [inf]  100.64.0.9:42186 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:30.606172299Z [err]  2025-12-29 21:39:30,584 - server - INFO - üî§ RAW TOKENS: ["H"?, "ello"?]
2025-12-29T21:39:30.606178076Z [err]  2025-12-29 21:39:30,584 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Hello' | Generating: False
2025-12-29T21:39:31.208604963Z [err]  2025-12-29 21:39:30,719 - server - INFO - üî§ RAW TOKENS: ["H"‚úì, "ello"‚úì, "?"‚úì, "<end>"‚úì]
2025-12-29T21:39:31.208610909Z [err]  2025-12-29 21:39:30,719 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-29T21:39:31.208616071Z [err]  2025-12-29 21:39:30,719 - server - INFO - üßπ Cleaned transcript: 'H ello ?' -> 'Hello?'
2025-12-29T21:39:31.208621375Z [err]  2025-12-29 21:39:30,719 - server - INFO - üì• FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-29T21:39:31.208627024Z [err]  2025-12-29 21:39:30,719 - server - INFO - üé§ Soniox final transcript: 'Hello?'
2025-12-29T21:39:31.208632630Z [err]  2025-12-29 21:39:30,719 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:31.208638459Z [err]  2025-12-29 21:39:30,719 - server - INFO - üîç FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-29T21:39:31.208644230Z [err]  2025-12-29 21:39:30,719 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:31.208650727Z [err]  2025-12-29 21:39:30,719 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-29T21:39:31.208656838Z [err]  2025-12-29 21:39:30,719 - server - INFO - ‚è±Ô∏è [21:39:30.719] üìù FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-29T21:39:31.208662750Z [err]  2025-12-29 21:39:30,719 - server - INFO - ‚è±Ô∏è [21:39:30.719] STT endpoint detection latency: 1ms
2025-12-29T21:39:31.208668000Z [err]  2025-12-29 21:39:30,719 - server - INFO - ‚è±Ô∏è [21:39:30.719] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-29T21:39:31.208673628Z [err]  2025-12-29 21:39:30,719 - server - INFO - ‚è±Ô∏è User spoke at 1767044370.719977
2025-12-29T21:39:31.212729301Z [err]  2025-12-29 21:39:30,720 - redis_service - INFO - üì¶ Stored call data in Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (TTL: 3600s)
2025-12-29T21:39:31.212737274Z [err]  2025-12-29 21:39:30,720 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-29T21:39:31.212743869Z [err]  2025-12-29 21:39:30,721 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:31.212749530Z [err]  2025-12-29 21:39:30,721 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-29T21:39:31.212755970Z [err]  2025-12-29 21:39:30,730 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-29T21:39:31.212761886Z [err]  2025-12-29 21:39:30,730 - core_calling_service - INFO - üë§ User stopped speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:31.212768751Z [err]  2025-12-29 21:39:30,731 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-29T21:39:31.212775570Z [err]  2025-12-29 21:39:30,731 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+13ms
2025-12-29T21:39:31.212781252Z [err]  2025-12-29 21:39:30,823 - server - INFO - üìù Saved user transcript to database
2025-12-29T21:39:31.212782509Z [err]  2025-12-29 21:39:30,731 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 13ms (Soniox model: stt-rt-v3)
2025-12-29T21:39:31.212789654Z [err]  2025-12-29 21:39:30,823 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:31.212790132Z [err]  2025-12-29 21:39:30,731 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-29T21:39:31.212795880Z [err]  2025-12-29 21:39:30,823 - core_calling_service - INFO - ‚è±Ô∏è [21:39:30.823] üì• process_user_input() ENTRY - text: 'Hello?...'
2025-12-29T21:39:31.212798286Z [err]  2025-12-29 21:39:30,731 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-29T21:39:31.212801659Z [err]  2025-12-29 21:39:30,824 - redis_service - INFO - üì• Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:31.212806243Z [err]  2025-12-29 21:39:30,731 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:31.212812437Z [err]  2025-12-29 21:39:30,737 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=3.0s, checkin_count=1/2
2025-12-29T21:39:31.213592696Z [err]  2025-12-29 21:39:30,825 - core_calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA: User spoke while Silence Greeting was triggering
2025-12-29T21:39:31.213603545Z [err]  2025-12-29 21:39:30,846 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:31.213611007Z [err]  2025-12-29 21:39:30,846 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:31.213618411Z [err]  2025-12-29 21:39:30,948 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-29T21:39:31.214820608Z [err]  2025-12-29 21:39:30,948 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044370.9486556 for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:31.214826298Z [err]  2025-12-29 21:39:30,948 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:31.214830250Z [err]  2025-12-29 21:39:30,950 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:31.216534943Z [err]  2025-12-29 21:39:30,950 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-29T21:39:31.279068444Z [err]  2025-12-29 21:39:31,275 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA/actions/playback_stop "HTTP/1.1 200 OK"
2025-12-29T21:39:31.279081053Z [err]  2025-12-29 21:39:31,276 - telnyx_service - INFO - ‚úÖ Successfully stopped audio playback
2025-12-29T21:39:31.282054030Z [err]  2025-12-29 21:39:31,277 - core_calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-29T21:39:31.282065511Z [err]  2025-12-29 21:39:31,277 - core_calling_service - INFO - ‚úÖ BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-29T21:39:31.282074909Z [err]  2025-12-29 21:39:31,278 - redis_service - INFO - üì• Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:31.282080762Z [err]  2025-12-29 21:39:31,279 - redis_service - INFO - üì¶ Stored call data in Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (TTL: 3600s)
2025-12-29T21:39:31.282087106Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-29T21:39:31.282093604Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - ‚è±Ô∏è [21:39:31.279] ‚è© About to call _process_call_flow_streaming()
2025-12-29T21:39:31.282098900Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - ‚è±Ô∏è [21:39:31.279] üîÄ Agent type: call_flow, calling flow processor...
2025-12-29T21:39:31.282105289Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - ‚è±Ô∏è [21:39:31.279] üîÄ _process_call_flow_streaming() ENTRY
2025-12-29T21:39:31.282110796Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-29T21:39:31.282117282Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-29T21:39:31.282122943Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - ‚è±Ô∏è [21:39:31.279] üîÄ About to call _follow_transition() for: Hello?...
2025-12-29T21:39:31.282128418Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Hello?
2025-12-29T21:39:31.282133443Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - üîç Checking 'Hello=Yes' override [DEPLOYMENT VERIFIED] for msg='hello' on node='Greeting'
2025-12-29T21:39:31.284989695Z [err]  2025-12-29 21:39:31,279 - core_calling_service - WARNING - ‚ö†Ô∏è Auto-transition after response target not found: None, falling back to normal evaluation
2025-12-29T21:39:31.291974962Z [err]  2025-12-29 21:39:31,288 - core_calling_service - INFO - ‚è±Ô∏è [21:39:31.288] üîÄ TRANSITION EVALUATION START - Calling LLM for 2 options
2025-12-29T21:39:31.445503416Z [err]  2025-12-29 21:39:31,438 - server - INFO - üì§ Audio flowing: 284 packets sent to Soniox (5s update)
2025-12-29T21:39:31.457728091Z [err]  2025-12-29 21:39:31,452 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:32.133880673Z [err]  2025-12-29 21:39:31,704 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-29T21:39:32.133884931Z [err]  2025-12-29 21:39:31,705 - core_calling_service - INFO - ‚è±Ô∏è [21:39:31.705] üîÄ TRANSITION EVALUATION COMPLETE - took 417ms
2025-12-29T21:39:32.133891712Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ü§ñ AI transition decision: '-1'
2025-12-29T21:39:32.133896283Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - üìä Available transitions: ['Confirms name (Yes|Speaking|This is he/she) OR Ask...', 'Wrong number (No John here|Wrong number|etc) - don...']
2025-12-29T21:39:32.133902296Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - Selected transition index: -1
2025-12-29T21:39:32.133906789Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - No specific condition matched, looking for default transition...
2025-12-29T21:39:32.133911603Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ‚ö†Ô∏è No transition matched, but node has GOAL. Staying on current node to continue with goal-based guidance.
2025-12-29T21:39:32.133916714Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - üéØ Goal: Say the customer's name...
2025-12-29T21:39:32.133922422Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 426ms
2025-12-29T21:39:32.133927653Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ‚è±Ô∏è [21:39:31.706] ‚úÖ Node selected, about to process content...
2025-12-29T21:39:32.133932563Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - üîß Replaced {{now}} with Monday, December 29, 2025 at 4:39 PM EST in content
2025-12-29T21:39:32.133938421Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-29T21:39:32.133944251Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-29T21:39:32.137743421Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-29T21:39:32.137748676Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T21:39:32.137753949Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-29T21:39:32.137759666Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-29T21:39:32.137764689Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-29T21:39:32.137769720Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-29T21:39:32.137775926Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-29T21:39:32.137781012Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-29T21:39:32.137788888Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-29T21:39:32.137793854Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-29T21:39:32.137798487Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ‚è±Ô∏è [21:39:31.706] üìÑ About to process content (mode=script, length=9)
2025-12-29T21:39:32.137803190Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - üõ°Ô∏è Preventing Dead Air: User stayed on script node 'Greeting' without transition
2025-12-29T21:39:32.137808379Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ü§ñ Generating sticky-prevention response...
2025-12-29T21:39:32.140370994Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - ‚ö° PARALLEL MODE: Running KB + analysis simultaneously
2025-12-29T21:39:32.140381165Z [err]  2025-12-29 21:39:31,715 - kb_router - INFO - üö¶ KB Router: SKIP (simple chat pattern matched)
2025-12-29T21:39:32.140385192Z [err]  If user says a name, don't assume it's theirs‚Äîwait for explicit correction.
2025-12-29T21:39:32.140390622Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - ‚ö° Skipping KB (reason: simple_chat)
2025-12-29T21:39:32.140398471Z [err]  
2025-12-29T21:39:32.140398994Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - ‚ö° Parallel operations completed in 0ms
2025-12-29T21:39:32.140408678Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - üîç Node 'Greeting': use_parallel_llm=True
2025-12-29T21:39:32.140409145Z [err]  If user asks to repeat info, rephrase naturally‚Äînever exact repeat.
2025-12-29T21:39:32.140415574Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - ‚ö° Parallel mode: Using condensed history (3/3 messages)
2025-12-29T21:39:32.140421073Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - ‚è±Ô∏è [21:39:31.715] üí¨ LLM REQUEST START: 3 conversation turns, 7881 system chars (KB cached)
2025-12-29T21:39:32.140425466Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - üìù ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LLM PROMPT BREAKDOWN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-29T21:39:32.140430366Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - üìù [SYSTEM MSG 1 - GLOBAL PROMPT] (6467 chars):
2025-12-29T21:39:32.140435007Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - üìù   Preview: # Global Prompt: Direct Drive Engine (V4.2 - Acknowledging & Fluid)
2025-12-29T21:39:32.140439598Z [err]  
2025-12-29T21:39:32.140445297Z [err]  When user states income, convert/update as [yearly_income] variable for logic splits.
2025-12-29T21:39:32.140450937Z [err]  
2025-12-29T21:39:32.142218713Z [err]  
2025-12-29T21:39:32.142224880Z [err]  If asked your state: "Atlanta, GA. Been in Midtown 10 years."
2025-12-29T21:39:32.142230558Z [err]  
2025-12-29T21:39:32.142238005Z [err]  If asked about call number: "Company number."
2025-12-29T21:39:32.142244434Z [err]  
2025-12-29T21:39:32.142250068Z [err]  
2025-12-29T21:39:32.142251806Z [err]  User email: {customer_email} (for them: {{customer_email}}).
2025-12-29T21:39:32.142263209Z [err]  
2025-12-29T21:39:32.142265317Z [err]  1. Generate a natural, contextual response
2025-12-29T21:39:32.142265321Z [err]  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
2025-12-29T21:39:32.142268006Z [err]  USER COMMUNICATION STYLE: C type - adjust your response accordingly
2025-12-29T21:39:32.142271999Z [err]  If explaining ends in peri...
2025-12-29T21:39:32.142276541Z [err]  PREPROCESSED CONTEXT (to help you prioritize and focus):
2025-12-29T21:39:32.142282577Z [err]  2. Evaluate transitions per your node instructions
2025-12-29T21:39:32.142282789Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - üìù [SYSTEM MSG 2 - DYNAMIC CONTEXT] (1414 chars):
2025-12-29T21:39:32.142284313Z [err]  CONVERSATION STATUS: Turn 2, objection handling phase
2025-12-29T21:39:32.142288100Z [err]  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
2025-12-29T21:39:32.142293560Z [err]  2025-12-29 21:39:31,716 - core_calling_service - INFO - üìù   Preview: 
2025-12-29T21:39:32.142297625Z [err]  
2025-12-29T21:39:32.142298147Z [err]  
2025-12-29T21:39:32.142308648Z [err]  This context is provided to help you focus. You still need to:
2025-12-29T21:39:32.146121602Z [err]  
2025-12-29T21:39:32.146133076Z [err]  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
2025-12-29T21:39:32.146140571Z [err]  
2025-12-29T21:39:32.146147298Z [err]  # CURRENT CONTEXT
2025-12-29T21:39:32.146153071Z [err]  Customer: Kendrick
2025-12-29T21:39:32.146160607Z [err]  Variables: {"now": "Monday, December 29, 2025 at 4:39 PM EST", "customer_name": "Kendrick", "callerName": "", "lead_id": null, "qc_tracking_enabled": false, "track_keywords": "", "expected_commitment": ...
2025-12-29T21:39:32.146166629Z [err]  2025-12-29 21:39:31,716 - core_calling_service - INFO - üìù [CONVERSATION HISTORY] (3 messages)
2025-12-29T21:39:32.146173839Z [err]  2025-12-29 21:39:31,716 - core_calling_service - INFO - üìù   assistant: Kendrick?...
2025-12-29T21:39:32.146179828Z [err]  2025-12-29 21:39:31,716 - core_calling_service - INFO - üìù   user: Hello?...
2025-12-29T21:39:32.146185462Z [err]  2025-12-29 21:39:31,716 - core_calling_service - INFO - üìù ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-29T21:39:32.146191422Z [err]  2025-12-29 21:39:31,764 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:32.146197486Z [err]  2025-12-29 21:39:31,764 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': 'ba40002c-5507-434b-9596-b699dc86bc48', 'occurred_at': '2025-12-29T21:39:31.095971Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:32.150370767Z [err]  2025-12-29 21:39:31,764 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:32.150379402Z [err]  2025-12-29 21:39:31,765 - server - INFO - üì® ================================================
2025-12-29T21:39:32.150389116Z [inf]  100.64.0.14:16928 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:32.150396184Z [err]  2025-12-29 21:39:31,864 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-29T21:39:32.150402785Z [err]  2025-12-29 21:39:31,955 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:32.150410690Z [err]  2025-12-29 21:39:32,140 - core_calling_service - INFO - ‚è±Ô∏è [21:39:32.140] üí¨ LLM FIRST TOKEN: 424ms (grok grok-4-1-fast-non-reasoning)
2025-12-29T21:39:32.219907977Z [err]  2025-12-29 21:39:32,214 - server - INFO - üì§ Sentence arrived from LLM: [N] Hey Kendrick,...
2025-12-29T21:39:32.219919582Z [err]  2025-12-29 21:39:32,214 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 1482ms
2025-12-29T21:39:32.219926564Z [err]  2025-12-29 21:39:32,214 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-29T21:39:32.219932366Z [err]  2025-12-29 21:39:32,214 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:32.219940812Z [err]  2025-12-29 21:39:32,214 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-29T21:39:32.306384446Z [err]  2025-12-29 21:39:32,301 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:32.390289037Z [err]  2025-12-29 21:39:32,386 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:32.458571161Z [err]  2025-12-29 21:39:32,456 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:32.475041949Z [err]  2025-12-29 21:39:32,471 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:32.495687963Z [err]  2025-12-29 21:39:32,491 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:32.495702337Z [err]  2025-12-29 21:39:32,491 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-29T21:39:32.495718159Z [err]  2025-12-29 21:39:32,492 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:39:32.495725882Z [err]  2025-12-29 21:39:32,492 - persistent_tts_service - INFO - üîå [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Establishing persistent TTS WebSocket...
2025-12-29T21:39:32.495733451Z [err]  2025-12-29 21:39:32,492 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:39:32.495741210Z [err]  2025-12-29 21:39:32,492 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-29T21:39:32.495748661Z [err]  2025-12-29 21:39:32,492 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-29T21:39:32.636203324Z [err]  2025-12-29 21:39:32,630 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-29T21:39:32.636213840Z [err]  2025-12-29 21:39:32,630 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-29T21:39:32.636219654Z [err]  2025-12-29 21:39:32,630 - persistent_tts_service - INFO - ‚úÖ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Persistent TTS WebSocket established
2025-12-29T21:39:32.636224612Z [err]  2025-12-29 21:39:32,630 - persistent_tts_service - INFO - üéß [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Audio receiver loop started
2025-12-29T21:39:32.636228887Z [err]  2025-12-29 21:39:32,630 - persistent_tts_service - INFO - üîä [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Comfort noise loop started
2025-12-29T21:39:32.636233596Z [err]  2025-12-29 21:39:32,630 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:32.636238213Z [err]  2025-12-29 21:39:32,630 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-29T21:39:32.636242676Z [err]  2025-12-29 21:39:32,630 - server - INFO - üîç Persistent TTS lookup: call_id=v3:QiUB4hXB0fhw8r7RO..., session=FOUND
2025-12-29T21:39:32.636247656Z [err]  2025-12-29 21:39:32,630 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-29T21:39:32.636254278Z [err]  2025-12-29 21:39:32,630 - server - INFO - üéµ TTS task #1 started at +416ms
2025-12-29T21:39:32.636258673Z [err]  2025-12-29 21:39:32,630 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 1899ms
2025-12-29T21:39:32.636263792Z [err]  2025-12-29 21:39:32,630 - core_calling_service - INFO - üì§ Streamed sentence: [N] Hey Kendrick,...
2025-12-29T21:39:32.636268133Z [err]  2025-12-29 21:39:32,631 - persistent_tts_service - INFO - üéµ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Playback consumer started
2025-12-29T21:39:32.639212536Z [err]  2025-12-29 21:39:32,631 - persistent_tts_service - INFO - üéß [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Audio Receiver Loop STARTED
2025-12-29T21:39:32.639220292Z [err]  2025-12-29 21:39:32,631 - persistent_tts_service - INFO - üíì [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Starting TTS keep-alive loop (every 15s)
2025-12-29T21:39:32.639225737Z [err]  2025-12-29 21:39:32,631 - persistent_tts_service - INFO - üîä [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Starting comfort noise loop
2025-12-29T21:39:32.639230070Z [err]  2025-12-29 21:39:32,631 - persistent_tts_service - INFO - üé§ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Streaming sentence #1: [N] Hey Kendrick,...
2025-12-29T21:39:32.639234131Z [err]  2025-12-29 21:39:32,631 - persistent_tts_service - INFO - üöÄ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-29T21:39:32.639239592Z [err]  2025-12-29 21:39:32,631 - persistent_tts_service - INFO - üìä [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-29T21:39:32.639243964Z [err]  2025-12-29 21:39:32,633 - persistent_tts_service - INFO - üéß [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Receiver processing sentence #1: '[N] Hey Kendrick,...'
2025-12-29T21:39:32.639249144Z [err]  2025-12-29 21:39:32,633 - persistent_tts_service - INFO - üìä [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] DIAGNOSTIC: queue_latency=2ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-29T21:39:32.639255298Z [err]  2025-12-29 21:39:32,634 - server - INFO - üì§ Sentence arrived from LLM: yeah it's me - you there?...
2025-12-29T21:39:32.639262531Z [err]  2025-12-29 21:39:32,634 - server - INFO - üîç Persistent TTS lookup: call_id=v3:QiUB4hXB0fhw8r7RO..., session=FOUND
2025-12-29T21:39:33.228150802Z [err]  2025-12-29 21:39:32,634 - server - INFO - üöÄ Streaming sentence #2 via persistent WebSocket
2025-12-29T21:39:33.228157638Z [err]  2025-12-29 21:39:32,634 - server - INFO - üéµ TTS task #2 started at +419ms
2025-12-29T21:39:33.228164543Z [err]  2025-12-29 21:39:32,634 - core_calling_service - INFO - üì§ Streamed final fragment: yeah it's me - you there?...
2025-12-29T21:39:33.228173053Z [err]  2025-12-29 21:39:32,634 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] LLM_TOTAL: 918ms for 43 chars (grok grok-4-1-fast-non-reasoning)
2025-12-29T21:39:33.228178760Z [err]  2025-12-29 21:39:32,634 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user gave meaningful response) for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:33.228184152Z [err]  2025-12-29 21:39:32,634 - core_calling_service - INFO - üîä Silence tracking reset for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (user responded)
2025-12-29T21:39:33.228189554Z [err]  2025-12-29 21:39:32,634 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-29T21:39:33.228196076Z [err]  2025-12-29 21:39:32,634 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-29T21:39:33.228201675Z [err]  2025-12-29 21:39:32,634 - core_calling_service - INFO - LLM response (1.81s): [N] Hey Kendrick, yeah it's me - you there?
2025-12-29T21:39:33.228210535Z [err]  2025-12-29 21:39:32,634 - core_calling_service - INFO - Total latency: 1.81s
2025-12-29T21:39:33.228215844Z [err]  2025-12-29 21:39:32,636 - server - INFO - ‚úÖ LLM finished in 1904ms, TTS tasks already running in background
2025-12-29T21:39:33.228223976Z [err]  2025-12-29 21:39:32,637 - server - INFO - üéµ Streaming 2 TTS chunks as they complete...
2025-12-29T21:39:33.228228932Z [err]  2025-12-29 21:39:32,637 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-29T21:39:33.232466818Z [err]  2025-12-29 21:39:32,638 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-29T21:39:33.232473872Z [err]  2025-12-29 21:39:32,638 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-29T21:39:33.232481069Z [err]  2025-12-29 21:39:32,638 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-29T21:39:33.232485716Z [err]  2025-12-29 21:39:32,638 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 1904ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-29T21:39:33.232493789Z [err]  2025-12-29 21:39:32,638 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 423ms (provider: elevenlabs, websocket: False)
2025-12-29T21:39:33.232494527Z [err]  2025-12-29 21:39:32,639 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 43 chars, 2 sentences
2025-12-29T21:39:33.232495663Z [err]  2025-12-29 21:39:32,638 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-29T21:39:33.232502772Z [err]  2025-12-29 21:39:32,638 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 1906ms (user stopped ‚Üí play_audio_url called)
2025-12-29T21:39:33.232503778Z [err]  2025-12-29 21:39:32,639 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Hello?...'
2025-12-29T21:39:33.232505097Z [err]  2025-12-29 21:39:32,639 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-29T21:39:33.232513532Z [err]  2025-12-29 21:39:32,639 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 2206ms estimated
2025-12-29T21:39:33.232515362Z [err]  2025-12-29 21:39:32,639 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: '[N] Hey Kendrick, yeah it's me - you there?...'
2025-12-29T21:39:33.232521784Z [err]  2025-12-29 21:39:32,639 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-29T21:39:33.232526463Z [err]  2025-12-29 21:39:32,639 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-29T21:39:33.232838145Z [err]  2025-12-29 21:39:32,637 - server - INFO -    2 sentences queued and playing seamlessly
2025-12-29T21:39:33.232843081Z [err]  2025-12-29 21:39:32,637 - persistent_tts_service - INFO - üé§ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Streaming sentence #2: yeah it's me - you there?...
2025-12-29T21:39:33.232849054Z [err]  2025-12-29 21:39:32,637 - persistent_tts_service - INFO - üöÄ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Sent sentence #2 (NON-BLOCKING) in 0ms
2025-12-29T21:39:33.232854614Z [err]  2025-12-29 21:39:32,638 - persistent_tts_service - INFO - üìä [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=False, is_last=False
2025-12-29T21:39:33.232861030Z [err]  2025-12-29 21:39:32,638 - server - INFO - ‚úÖ All 2 persistent TTS streams completed
2025-12-29T21:39:33.232866224Z [err]  2025-12-29 21:39:32,638 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-29T21:39:33.232871134Z [err]  2025-12-29 21:39:32,638 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 1906ms from user stop üöÄ
2025-12-29T21:39:33.232875720Z [err]  2025-12-29 21:39:32,638 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:33.232880498Z [err]  2025-12-29 21:39:32,638 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-29T21:39:33.232886621Z [err]  2025-12-29 21:39:32,638 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-29T21:39:33.232891531Z [err]  2025-12-29 21:39:32,638 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-29T21:39:33.232898895Z [err]  2025-12-29 21:39:32,638 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 13ms (provider: soniox, model: stt-rt-v3)
2025-12-29T21:39:33.238154815Z [err]  2025-12-29 21:39:32,824 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 2340ms)
2025-12-29T21:39:33.238161820Z [err]  2025-12-29 21:39:32,824 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-29T21:39:33.238168680Z [err]  2025-12-29 21:39:32,824 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-29T21:39:33.238174591Z [err]  2025-12-29 21:39:32,886 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 255ms
2025-12-29T21:39:33.238182064Z [err]  2025-12-29 21:39:32,887 - persistent_tts_service - INFO - üì§ Sending 9643 bytes of audio (61 chunks, 1.2s duration) via WebSocket
2025-12-29T21:39:33.238189382Z [err]  2025-12-29 21:39:32,887 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:39:33.238195747Z [err]  2025-12-29 21:39:32,887 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.2s (total: 1.2s from now)
2025-12-29T21:39:33.238201460Z [err]  2025-12-29 21:39:32,888 - persistent_tts_service - INFO - ‚úÖ Sent 61 audio chunks via WebSocket
2025-12-29T21:39:33.238207240Z [err]  2025-12-29 21:39:33,069 - persistent_tts_service - INFO - üì§ Sending 10775 bytes of audio (68 chunks, 1.3s duration) via WebSocket
2025-12-29T21:39:33.238213254Z [err]  2025-12-29 21:39:33,069 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:39:33.238219657Z [err]  2025-12-29 21:39:33,069 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.3s (total: 2.4s from now)
2025-12-29T21:39:33.238225981Z [err]  2025-12-29 21:39:33,070 - persistent_tts_service - INFO - ‚úÖ Sent 68 audio chunks via WebSocket
2025-12-29T21:39:35.130535128Z [err]  2025-12-29 21:39:34,749 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-29T21:39:35.130544377Z [err]  2025-12-29 21:39:34,750 - core_calling_service - INFO - üí¨ Sending FINAL check-in #2/2: Are you still there?
2025-12-29T21:39:35.130552431Z [err]  2025-12-29 21:39:34,750 - core_calling_service - INFO - ‚ö†Ô∏è Will end call if no response after next silence timeout
2025-12-29T21:39:35.130560230Z [err]  2025-12-29 21:39:34,750 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-29T21:39:35.130571557Z [err]  2025-12-29 21:39:34,750 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:35.130581524Z [err]  2025-12-29 21:39:34,750 - telnyx_service - INFO - üîä Speaking text on call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ: Are you still there?...
2025-12-29T21:39:35.130588519Z [err]  2025-12-29 21:39:34,750 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-29T21:39:35.130596452Z [err]  2025-12-29 21:39:34,750 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-29T21:39:35.130603768Z [err]  2025-12-29 21:39:34,750 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-29T21:39:35.130614111Z [err]  2025-12-29 21:39:34,750 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-29T21:39:35.130622159Z [err]  2025-12-29 21:39:34,750 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-29T21:39:35.130629514Z [err]  2025-12-29 21:39:34,750 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-29T21:39:35.130637905Z [err]  2025-12-29 21:39:34,750 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:35.130648782Z [err]  2025-12-29 21:39:34,750 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:35.133303877Z [err]  2025-12-29 21:39:35,026 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.28s
2025-12-29T21:39:35.133303895Z [err]  2025-12-29 21:39:35,026 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-29T21:39:35.133314819Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:39:35.133319952Z [err]    "errors": [
2025-12-29T21:39:35.133330365Z [err]      {
2025-12-29T21:39:35.133340543Z [err]      }
2025-12-29T21:39:35.133344034Z [err]        "code": "90018",
2025-12-29T21:39:35.133351101Z [err]        "title": "Call has already ended",
2025-12-29T21:39:35.133354120Z [err]  2025-12-29 21:39:35,027 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-29T21:39:35.133368724Z [err]    ]
2025-12-29T21:39:35.133382693Z [err]  }
2025-12-29T21:39:35.134241620Z [err]  2025-12-29 21:39:35,026 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:35.229021817Z [err]  2025-12-29 21:39:35,222 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:35.229031622Z [err]  2025-12-29 21:39:35,222 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:39:35.229042955Z [err]  2025-12-29 21:39:35,222 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-29T21:39:35.229048863Z [err]  2025-12-29 21:39:35,223 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-29T21:39:35.229055839Z [err]  2025-12-29 21:39:35,223 - persistent_tts_service - INFO - ‚úÖ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Receiver finished sentence #1: 2 chunks in 2592ms
2025-12-29T21:39:35.229061594Z [err]  2025-12-29 21:39:35,223 - persistent_tts_service - INFO - üéß [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Receiver processing sentence #2: 'yeah it's me - you there?...'
2025-12-29T21:39:35.229067810Z [err]  2025-12-29 21:39:35,223 - persistent_tts_service - INFO - üìä [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] DIAGNOSTIC: queue_latency=2585ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-29T21:39:35.479741716Z [err]  2025-12-29 21:39:35,469 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (0.0s ago), marking agent as done speaking
2025-12-29T21:39:35.479762466Z [err]  2025-12-29 21:39:35,469 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044375.4696348 for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:35.479768380Z [err]  2025-12-29 21:39:35,469 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:36.175456116Z [err]  2025-12-29 21:39:35,740 - persistent_tts_service - INFO - üîá [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] FLOOR RELEASED (is_holding_floor=False)
2025-12-29T21:39:36.447797747Z [err]  2025-12-29 21:39:36,443 - server - INFO - üì§ Audio flowing: 534 packets sent to Soniox (5s update)
2025-12-29T21:39:37.236437439Z [err]  2025-12-29 21:39:37,186 - server - INFO - üé§ Soniox receiver alive - 13 messages received in last 10s
2025-12-29T21:39:38.183645622Z [err]  2025-12-29 21:39:37,724 - elevenlabs_ws_service - WARNING - ‚ö†Ô∏è  [TIMING] ElevenLabs timeout waiting for first chunk (2.5s) - No audio received!
2025-12-29T21:39:38.183650802Z [err]  2025-12-29 21:39:37,724 - persistent_tts_service - WARNING - ‚ö†Ô∏è [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Receiver got 0 chunks for sentence #2! interrupted=False
2025-12-29T21:39:39.177261594Z [err]  2025-12-29 21:39:38,972 - server - INFO - üé§ Soniox receiver alive - 1 messages received in last 10s
2025-12-29T21:39:39.177265925Z [err]  2025-12-29 21:39:38,972 - server - ERROR - ‚ùå Soniox error: {'tokens': [], 'final_audio_proc_ms': 5280, 'total_audio_proc_ms': 11280, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-29T21:39:39.177270250Z [err]  2025-12-29 21:39:38,973 - server - INFO - ‚úÖ Soniox receive loop ended normally
2025-12-29T21:39:39.177274668Z [err]  2025-12-29 21:39:38,973 - dead_air_monitor - INFO - üîá Dead air monitoring cancelled for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:39.177278867Z [err]  2025-12-29 21:39:38,973 - dead_air_monitor - INFO - üîá Dead air monitoring stopped for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:39.177282679Z [err]  2025-12-29 21:39:38,973 - server - INFO - üîá Dead air monitoring task cancelled
2025-12-29T21:39:39.230317101Z [err]  2025-12-29 21:39:39,220 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 665 total packets
2025-12-29T21:39:39.230322126Z [err]  [2025-12-29 21:39:39 +0000] [5] [INFO] connection closed
2025-12-29T21:39:39.376843317Z [err]  2025-12-29 21:39:39,370 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:39.376851013Z [err]  2025-12-29 21:39:39,370 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': '64e99236-3e2e-4a0d-a95f-f79f5f0eb789', 'occurred_at': '2025-12-29T21:39:38.915967Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_quality_stats': {'inbound': {'jitter_max_variance': '40.21', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '691', 'skip_packet_count': '22'}, 'outbound': {'packet_count': '672', 'skip_packet_count': '0'}}, 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:38.915967Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-29T21:39:22.015963Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:39.376856177Z [err]  2025-12-29 21:39:39,370 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:39.376860763Z [err]  2025-12-29 21:39:39,370 - server - INFO - üì® ================================================
2025-12-29T21:39:39.376865270Z [err]  2025-12-29 21:39:39,370 - server - INFO - üìû Call ended: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:39.376869870Z [err]  2025-12-29 21:39:39,370 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-29T21:39:39.412607770Z [err]  2025-12-29 21:39:39,409 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:39.412617839Z [err]  2025-12-29 21:39:39,409 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': '0caf8aed-a012-4847-83a8-c5658a7082db', 'occurred_at': '2025-12-29T21:39:39.111745Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '7559e05e-7071-4515-aa1e-73d3ce291eb2', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:39.412623354Z [err]  2025-12-29 21:39:39,410 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:39.412635067Z [err]  2025-12-29 21:39:39,410 - server - INFO - üì® ================================================
2025-12-29T21:39:39.412641010Z [inf]  100.64.0.15:19184 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:39.445502470Z [err]  2025-12-29 21:39:39,443 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '73e8efd8-8d05-4706-8594-7ec6f957fb11', 'occurred_at': '2025-12-29T21:39:38.955988Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:38.955988Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': '2r9zR7I2TQ', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:39.445509528Z [err]  2025-12-29 21:39:39,442 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:39.445516655Z [err]  2025-12-29 21:39:39,443 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:39.445525031Z [err]  2025-12-29 21:39:39,443 - server - INFO - üì® ================================================
2025-12-29T21:39:39.448463075Z [err]  2025-12-29 21:39:39,444 - redis_service - INFO - ‚ûñ Removed playback 2r9zR7I2TQ, 0 remaining for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:39.448470447Z [err]  2025-12-29 21:39:39,444 - server - INFO - üîä Redis: Removed playback 2r9zR7I2TQ, 0 remaining
2025-12-29T21:39:39.448477752Z [err]  2025-12-29 21:39:39,444 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T21:39:39.448482381Z [err]  2025-12-29 21:39:39,445 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T21:39:39.448488046Z [err]  2025-12-29 21:39:39,445 - server - INFO - ‚úÖ Found session in active_telnyx_calls (local worker)
2025-12-29T21:39:39.448493564Z [err]  2025-12-29 21:39:39,445 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044379.4453008 for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:39.448498047Z [err]  2025-12-29 21:39:39,445 - server - INFO - ‚è±Ô∏è Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-29T21:39:39.448502987Z [inf]  100.64.0.9:33454 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:39.560439116Z [err]  2025-12-29 21:39:39,553 - server - INFO - üìù Updated call log: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:39.650196710Z [err]  2025-12-29 21:39:39,645 - server - INFO - ‚úÖ Finalized call log: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (duration=14s, status=completed)
2025-12-29T21:39:40.164860602Z [err]  2025-12-29 21:39:39,738 - server - INFO - üì¶ Saved 11 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-29T21:39:40.430011897Z [err]  2025-12-29 21:39:40,427 - server - INFO - üìä Auto-added call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-29T21:39:40.489590625Z [err]  2025-12-29 21:39:40,482 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=5.0s, checkin_count=0/2
2025-12-29T21:39:40.614640481Z [err]  2025-12-29 21:39:40,611 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:39:40.614647226Z [err]  2025-12-29 21:39:40,612 - redis_service - INFO - üì• Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:40.614652029Z [err]  2025-12-29 21:39:40,612 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-29T21:39:40.614656483Z [err]  2025-12-29 21:39:40,612 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-29T21:39:41.139151433Z [err]  2025-12-29 21:39:40,683 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:41.139162871Z [err]  2025-12-29 21:39:40,683 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '805b0037-e8c7-482c-adb6-f4004c6ac375', 'occurred_at': '2025-12-29T21:39:40.383439Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:39.012085Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-29T21:39:39.012085Z', 'recording_id': 'd445d263-f759-444d-9c45-b9fc37ad437b', 'recording_started_at': '2025-12-29T21:39:26.948768Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/d667d23c-e4fe-11f0-ac10-02420aef97a0-1767044366061007.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T213940Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=896c7d566ef50ddd3be97f6725c92ea276bd0f73eb6bbb151a09ce8a955e001f'}, 'start_time': '2025-12-29T21:39:26.948768Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:41.139168728Z [err]  2025-12-29 21:39:40,683 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.139175400Z [err]  2025-12-29 21:39:40,683 - server - INFO - üì® ================================================
2025-12-29T21:39:41.139183739Z [err]  2025-12-29 21:39:40,684 - server - INFO - üéôÔ∏è Recording saved for call: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.139189346Z [err]  2025-12-29 21:39:40,684 - redis_service - INFO - üì• Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.142054594Z [err]  2025-12-29 21:39:40,685 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=d445d263-f759-444d-9c45-b9fc37ad437b, call_data=True
2025-12-29T21:39:41.142066742Z [err]  2025-12-29 21:39:40,704 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-29T21:39:41.142068904Z [err]  2025-12-29 21:39:40,777 - server - INFO - üíæ Saved recording URL and ID to database: d445d263-f759-444d-9c45-b9fc37ad437b
2025-12-29T21:39:41.142084863Z [err]  2025-12-29 21:39:40,791 - server - INFO - üìä Triggered Campaign QC for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.142088200Z [err]  2025-12-29 21:39:40,778 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-29T21:39:41.142092924Z [err]  2025-12-29 21:39:40,791 - server - INFO - üìá Triggered CRM update for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.142093312Z [err]  2025-12-29 21:39:40,790 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-29T21:39:41.142098758Z [err]  2025-12-29 21:39:40,778 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-29T21:39:41.142099839Z [err]  2025-12-29 21:39:40,791 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.142104896Z [err]  2025-12-29 21:39:40,791 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-29T21:39:41.142116439Z [err]  2025-12-29 21:39:40,791 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-29T21:39:41.142125294Z [err]  2025-12-29 21:39:40,791 - server - INFO - üöÄ Triggered QC analysis for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.143605328Z [err]  2025-12-29 21:39:40,792 - redis_service - INFO - üßπ Deleted call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.143613161Z [err]  2025-12-29 21:39:40,792 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.143623662Z [inf]  100.64.0.5:32276 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:41.143633213Z [err]  2025-12-29 21:39:40,793 - server - INFO - üîç Starting QC analysis for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.143640205Z [err]  2025-12-29 21:39:40,793 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-29T21:39:41.143648490Z [err]  2025-12-29 21:39:40,793 - server - INFO - üìá CRM update starting for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:41.143657106Z [err]  2025-12-29 21:39:40,793 - server - INFO - üìá Normalized phone: +17708336397
2025-12-29T21:39:41.143664706Z [err]  2025-12-29 21:39:40,793 - server - INFO - üìá CRM: Got 11 variables from active session
2025-12-29T21:39:41.143672651Z [err]  2025-12-29 21:39:40,883 - server - INFO - üìá CRM: Got 11 extracted variables
2025-12-29T21:39:41.143680173Z [err]  2025-12-29 21:39:40,883 - server - INFO - üìá CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-29T21:39:41.143687400Z [err]  2025-12-29 21:39:40,884 - server - INFO - üìù Converted transcript from 3 messages to 88 characters
2025-12-29T21:39:41.143695454Z [err]  2025-12-29 21:39:40,885 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=3, logs_count=4, status=completed
2025-12-29T21:39:41.145717957Z [err]  2025-12-29 21:39:40,970 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:41.145725576Z [err]  2025-12-29 21:39:40,975 - soniox_service - ERROR - ‚ùå Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-29T21:39:41.145730420Z [err]  2025-12-29 21:39:40,975 - server - INFO - üîå Telnyx WebSocket disconnected
2025-12-29T21:39:41.145734876Z [err]  2025-12-29 21:39:40,982 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=5.5s, checkin_count=0/2
2025-12-29T21:39:41.145739234Z [err]  2025-12-29 21:39:41,008 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:39:41.145746050Z [err]  2025-12-29 21:39:41,009 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-29T21:39:41.145750256Z [err]  2025-12-29 21:39:41,055 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-29T21:39:41.145754950Z [err]  2025-12-29 21:39:41,057 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-29T21:39:41.145759590Z [err]  2025-12-29 21:39:41,085 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/d667d23c-e4fe-11f0-ac10-02420aef97a0-1767044366061007.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T213940Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=896c7d566ef50ddd3be97f6725c92ea276bd0f73eb6bbb151a09ce8a955e001f "HTTP/1.1 200 OK"
2025-12-29T21:39:41.146410070Z [err]  2025-12-29 21:39:41,142 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-29T21:39:41.146415120Z [err]  2025-12-29 21:39:41,142 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:41.146419708Z [err]  2025-12-29 21:39:41,142 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.175123087Z [err]  2025-12-29 21:39:41,173 - server - INFO - ‚úÖ Downloaded 48526 bytes
2025-12-29T21:39:41.355429602Z [err]  2025-12-29 21:39:41,349 - server - INFO - ‚úÖ Split into 2 channels
2025-12-29T21:39:41.355442804Z [err]  2025-12-29 21:39:41,349 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-29T21:39:41.355447263Z [err]  2025-12-29 21:39:41,353 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:41.355448111Z [err]  2025-12-29 21:39:41,349 - server - INFO - üìä Channel 0: 263164 bytes
2025-12-29T21:39:41.355453415Z [err]  2025-12-29 21:39:41,349 - server - ERROR - ‚ùå No Soniox API key available
2025-12-29T21:39:41.355458373Z [err]  2025-12-29 21:39:41,349 - server - INFO - ‚ùå Channel 0: No speech
2025-12-29T21:39:41.355463165Z [err]  2025-12-29 21:39:41,349 - server - INFO - üìä Channel 1: 263164 bytes
2025-12-29T21:39:41.355467641Z [err]  2025-12-29 21:39:41,349 - server - ERROR - ‚ùå No Soniox API key available
2025-12-29T21:39:41.355471581Z [err]  2025-12-29 21:39:41,350 - server - INFO - ‚ùå Channel 1: No speech
2025-12-29T21:39:41.355479517Z [err]  2025-12-29 21:39:41,350 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-29T21:39:41.355483780Z [inf]  100.64.0.14:53582 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:41.355488117Z [err]  2025-12-29 21:39:41,351 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:39:41.355493510Z [err]  2025-12-29 21:39:41,351 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-29T21:39:41.355498209Z [err]  2025-12-29 21:39:41,353 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:41.355502698Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:41.357015940Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:39:41.357021789Z [err]  2025-12-29 21:39:41,353 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.441381868Z [err]  2025-12-29 21:39:41,438 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-29T21:39:41.441390013Z [err]  2025-12-29 21:39:41,438 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-29T21:39:41.441396437Z [err]  2025-12-29 21:39:41,438 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:39:41.441403082Z [err]  2025-12-29 21:39:41,438 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-29T21:39:41.441410316Z [err]    File "/app/backend/server.py", line 9773, in trigger_campaign_qc_for_call
2025-12-29T21:39:41.441417119Z [err]      await run_full_qc_analysis(
2025-12-29T21:39:41.441423242Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-29T21:39:41.441524944Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:39:41.441532805Z [err]  
2025-12-29T21:39:41.518796223Z [err]  2025-12-29 21:39:41,515 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:39:41.518809984Z [err]  2025-12-29 21:39:41,516 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:41.518819729Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:41.518825565Z [err]  2025-12-29 21:39:41,516 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:41.518831405Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:39:41.518837204Z [err]  2025-12-29 21:39:41,516 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:42.213299443Z [err]  2025-12-29 21:39:41,925 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T21:39:42.213305221Z [err]  2025-12-29 21:39:42,011 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:42.213310980Z [err]  2025-12-29 21:39:42,097 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:42.213317234Z [err]  2025-12-29 21:39:42,125 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:42.213323941Z [err]  2025-12-29 21:39:42,126 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-29T21:39:42.213328946Z [err]  2025-12-29 21:39:42,126 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-29T21:39:42.213334093Z [err]  2025-12-29 21:39:42,126 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T21:39:42.487597874Z [err]  2025-12-29 21:39:42,485 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-29T21:39:42.490322382Z [err]  2025-12-29 21:39:42,486 - core_calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-29T21:39:42.490334125Z [err]  2025-12-29 21:39:42,486 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-29T21:39:42.490343126Z [err]  2025-12-29 21:39:42,486 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:42.490350933Z [err]  2025-12-29 21:39:42,486 - telnyx_service - INFO - üîä Speaking text on call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA: Are you still there?...
2025-12-29T21:39:42.490357887Z [err]  2025-12-29 21:39:42,486 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-29T21:39:42.490365215Z [err]  2025-12-29 21:39:42,486 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-29T21:39:42.490371566Z [err]  2025-12-29 21:39:42,486 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-29T21:39:42.490381333Z [err]  2025-12-29 21:39:42,486 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-29T21:39:42.490387936Z [err]  2025-12-29 21:39:42,487 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-29T21:39:42.490394837Z [err]  2025-12-29 21:39:42,487 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-29T21:39:42.490402848Z [err]  2025-12-29 21:39:42,487 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:42.490410729Z [err]  2025-12-29 21:39:42,487 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:43.156568271Z [err]  2025-12-29 21:39:42,754 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.27s
2025-12-29T21:39:43.156569801Z [err]  2025-12-29 21:39:42,839 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:43.156578397Z [err]  2025-12-29 21:39:42,754 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-29T21:39:43.156585163Z [err]    "errors": [
2025-12-29T21:39:43.156592591Z [err]      {
2025-12-29T21:39:43.156598312Z [err]        "code": "90018",
2025-12-29T21:39:43.156604918Z [err]        "title": "Call has already ended",
2025-12-29T21:39:43.156610543Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:39:43.156616822Z [err]      }
2025-12-29T21:39:43.156623158Z [err]    ]
2025-12-29T21:39:43.156630139Z [err]  }
2025-12-29T21:39:43.156636875Z [err]  2025-12-29 21:39:42,755 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-29T21:39:43.156643719Z [err]  2025-12-29 21:39:42,836 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-29T21:39:43.156645973Z [err]  2025-12-29 21:39:42,754 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:43.156651622Z [err]  2025-12-29 21:39:42,837 - telnyx_service - INFO - ‚úÖ Call initiated: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:43.156657892Z [err]  2025-12-29 21:39:42,838 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:39:43.156663742Z [err]  2025-12-29 21:39:42,839 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:43.156670173Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:43.159988576Z [err]  2025-12-29 21:39:42,925 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-29T21:39:43.160023539Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:43.160028751Z [err]  2025-12-29 21:39:42,925 - server - INFO - üìù Created call log: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:43.160035274Z [err]  2025-12-29 21:39:42,925 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:39:43.160076523Z [inf]  100.64.0.12:25232 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-29T21:39:43.160078344Z [err]  2025-12-29 21:39:42,925 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:39:43.160085997Z [err]  2025-12-29 21:39:42,944 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:43.160087880Z [err]  2025-12-29 21:39:42,931 - redis_service - INFO - üì¶ Stored call data in Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (TTL: 3600s)
2025-12-29T21:39:43.160091836Z [err]  2025-12-29 21:39:42,944 - server - INFO - ‚úÖ QC analysis completed for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:43.160101246Z [err]  2025-12-29 21:39:42,932 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-29T21:39:43.160135297Z [err]  2025-12-29 21:39:42,944 - server - INFO - üìä Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-29T21:39:43.160142850Z [err]  2025-12-29 21:39:43,021 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:43.160149494Z [err]  2025-12-29 21:39:43,022 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:39:43.160157369Z [err]  2025-12-29 21:39:42,932 - server - INFO - üìû Outbound call initiated: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:43.160173634Z [err]  2025-12-29 21:39:42,925 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:39:43.162323525Z [err]  2025-12-29 21:39:43,022 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-29T21:39:43.162328458Z [err]  2025-12-29 21:39:43,105 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:39:43.162333677Z [err]  2025-12-29 21:39:43,106 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-29T21:39:43.162338163Z [err]  2025-12-29 21:39:43,133 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-29T21:39:43.162343022Z [err]  2025-12-29 21:39:43,133 - server - INFO -    Client: Address(host='100.64.0.14', port=53586)
2025-12-29T21:39:43.162350380Z [err]  2025-12-29 21:39:43,133 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'SwnTGJ7azzLEQjPRAGvkMw==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'W7uJ108gRwCMGz7GxtoGcA', 'x-real-ip': '192.76.120.151', 'x-request-start': '1767044382843', 'accept-encoding': 'gzip'}
2025-12-29T21:39:43.162355820Z [err]  2025-12-29 21:39:43,133 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-29T21:39:43.162360563Z [err]  2025-12-29 21:39:43,133 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-29T21:39:43.162365157Z [err]  [2025-12-29 21:39:43 +0000] [6] [INFO] ('100.64.0.14', 53586) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-29T21:39:43.162370282Z [err]  2025-12-29 21:39:43,133 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-29T21:39:43.162374692Z [err]  [2025-12-29 21:39:43 +0000] [6] [INFO] connection open
2025-12-29T21:39:43.162379065Z [err]  2025-12-29 21:39:43,137 - server - INFO - üìä Updated campaign_calls with QC scores for v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:43.204524451Z [err]  2025-12-29 21:39:43,199 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:43.204534805Z [err]  2025-12-29 21:39:43,199 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': '7a845211-7201-4ddb-a533-b205d0bc35d4', 'occurred_at': '2025-12-29T21:39:42.663963Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:43.204542386Z [err]  2025-12-29 21:39:43,199 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:43.204549230Z [err]  2025-12-29 21:39:43,199 - server - INFO - üì® ================================================
2025-12-29T21:39:43.204559409Z [err]  2025-12-29 21:39:43,199 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-29T21:39:43.204567192Z [inf]  100.64.0.9:33454 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:43.291328699Z [err]  2025-12-29 21:39:43,288 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-29T21:39:43.291334942Z [err]  2025-12-29 21:39:43,288 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-29T21:39:43.315938564Z [err]  2025-12-29 21:39:43,311 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-29T21:39:43.406930401Z [err]  2025-12-29 21:39:43,400 - server - INFO - üè∑Ô∏è Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-29T21:39:43.406941025Z [err]  2025-12-29 21:39:43,400 - server - ERROR - ‚ùå Error in auto appointment detection for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA: 'str' object has no attribute 'get'
2025-12-29T21:39:43.527717927Z [err]  2025-12-29 21:39:43,524 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-29T21:39:43.527723224Z [err]  2025-12-29 21:39:43,524 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044383.524147 for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:43.527730577Z [err]  2025-12-29 21:39:43,524 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:46.196297870Z [err]  2025-12-29 21:39:45,740 - server - INFO - üì¨ Received Telnyx event: start
2025-12-29T21:39:46.196304714Z [err]  2025-12-29 21:39:45,740 - server - INFO - üé¨ Stream started for call: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.196309886Z [err]  2025-12-29 21:39:45,747 - redis_service - INFO - üì• Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.196315426Z [err]  2025-12-29 21:39:45,748 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-29T21:39:46.196321531Z [err]  2025-12-29 21:39:45,748 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-29T21:39:46.196326787Z [err]  2025-12-29 21:39:45,762 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:46.196332060Z [err]  2025-12-29 21:39:45,762 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': 'aec0fe05-9f84-407f-9f6e-b2756d39b9e2', 'occurred_at': '2025-12-29T21:39:45.483977Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-29T21:39:42.663963Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:46.196337005Z [err]  2025-12-29 21:39:45,762 - server - INFO - üéØ Event type: call.answered, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.196342266Z [err]  2025-12-29 21:39:45,762 - server - INFO - üì® ================================================
2025-12-29T21:39:46.196349318Z [err]  2025-12-29 21:39:45,762 - server - INFO - ‚úÖ Call answered: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.201700561Z [err]  2025-12-29 21:39:45,767 - redis_service - INFO - üì• Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.201705101Z [err]  2025-12-29 21:39:45,768 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-29T21:39:46.201710016Z [err]  2025-12-29 21:39:45,768 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-29T21:39:46.201715103Z [err]  2025-12-29 21:39:45,861 - server - INFO - ‚úÖ Call log updated
2025-12-29T21:39:46.201719658Z [err]  2025-12-29 21:39:45,861 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:39:46.201723970Z [err]  2025-12-29 21:39:45,861 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:39:46.201729257Z [err]  2025-12-29 21:39:45,861 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:46.201733768Z [err]  2025-12-29 21:39:45,947 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:46.201738300Z [err]  2025-12-29 21:39:46,026 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:39:46.201742996Z [err]  2025-12-29 21:39:46,027 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-29T21:39:46.201748157Z [err]  2025-12-29 21:39:46,033 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:46.201753137Z [err]  2025-12-29 21:39:46,033 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-29T21:39:46.201758125Z [err]  2025-12-29 21:39:46,058 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:46.204447639Z [err]  2025-12-29 21:39:46,163 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:46.204478192Z [err]  2025-12-29 21:39:46,163 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': '8367fc21-40dd-4852-b974-a6378eab7eb0', 'occurred_at': '2025-12-29T21:39:45.843962Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': 'd484b5a0-988c-4d67-9ec0-a1847f8ba7ac', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:46.204483498Z [err]  2025-12-29 21:39:46,163 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.204488573Z [err]  2025-12-29 21:39:46,163 - server - INFO - üì® ================================================
2025-12-29T21:39:46.204493561Z [inf]  100.64.0.5:10352 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:46.253663117Z [err]  2025-12-29 21:39:46,249 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-29T21:39:46.253673056Z [err]  2025-12-29 21:39:46,249 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-29T21:39:46.259666577Z [err]  2025-12-29 21:39:46,255 - redis_service - INFO - üì• Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.259673408Z [err]  2025-12-29 21:39:46,257 - server - INFO - üìù Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:46.259678674Z [err]  2025-12-29 21:39:46,257 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T21:39:46.347728996Z [err]  2025-12-29 21:39:46,345 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-29T21:39:46.347737838Z [err]  2025-12-29 21:39:46,345 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T21:39:46.347744457Z [err]  2025-12-29 21:39:46,345 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T21:39:46.347757498Z [err]  2025-12-29 21:39:46,345 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T21:39:46.347762784Z [err]  2025-12-29 21:39:46,345 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-29T21:39:46.353953849Z [err]  2025-12-29 21:39:46,351 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw/actions/playback_start "HTTP/1.1 200 OK"
2025-12-29T21:39:46.356430112Z [err]  2025-12-29 21:39:46,352 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: OQ6dK3i3pw (loop=True, overlay=True)
2025-12-29T21:39:46.356437145Z [err]  2025-12-29 21:39:46,352 - server - WARNING - ‚ö†Ô∏è Failed to start comfort noise: 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw'
2025-12-29T21:39:46.356442341Z [err]  2025-12-29 21:39:46,352 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.436628501Z [err]  2025-12-29 21:39:46,432 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:46.447926510Z [err]  2025-12-29 21:39:46,444 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 98ms
2025-12-29T21:39:46.447935255Z [err]  2025-12-29 21:39:46,444 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-29T21:39:46.447940863Z [err]  2025-12-29 21:39:46,444 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-29T21:39:46.447946300Z [err]  2025-12-29 21:39:46,444 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-29T21:39:46.447952235Z [err]  2025-12-29 21:39:46,444 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-29T21:39:46.447957769Z [err]  2025-12-29 21:39:46,445 - server - INFO - ‚úÖ Initialized call_states for v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw with session reference
2025-12-29T21:39:46.450854919Z [err]  2025-12-29 21:39:46,446 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-29T21:39:46.540234350Z [err]  2025-12-29 21:39:46,536 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-29T21:39:46.599553229Z [err]  2025-12-29 21:39:46,594 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:46.599562173Z [err]  2025-12-29 21:39:46,594 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '5b79edbe-dc73-4d0b-94aa-aa4acf987d7d', 'occurred_at': '2025-12-29T21:39:46.263969Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'OQ6dK3i3pw', 'start_time': '2025-12-29T21:39:46.263969Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:46.599567960Z [err]  2025-12-29 21:39:46,594 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.599572435Z [err]  2025-12-29 21:39:46,594 - server - INFO - üì® ================================================
2025-12-29T21:39:46.599577155Z [inf]  100.64.0.16:36860 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:46.641691671Z [err]  2025-12-29 21:39:46,640 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw/actions/record_start "HTTP/1.1 200 OK"
2025-12-29T21:39:46.643768795Z [err]  2025-12-29 21:39:46,641 - server - INFO - üéôÔ∏è Call recording started for v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.643775292Z [err]  2025-12-29 21:39:46,641 - server - INFO - üîß Creating call session for v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw...
2025-12-29T21:39:46.643780704Z [err]  2025-12-29 21:39:46,641 - server - INFO - üîç Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:46.643785959Z [err]  2025-12-29 21:39:46,641 - server - INFO - üîß Calling create_call_session() - START
2025-12-29T21:39:46.643790911Z [err]  2025-12-29 21:39:46,641 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T21:39:47.153794963Z [err]  2025-12-29 21:39:46,727 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-29T21:39:47.153802131Z [err]  2025-12-29 21:39:46,727 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T21:39:47.153810151Z [err]  2025-12-29 21:39:46,727 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T21:39:47.153818009Z [err]  2025-12-29 21:39:46,727 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T21:39:47.153829220Z [err]  2025-12-29 21:39:46,727 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-29T21:39:47.153836137Z [err]  2025-12-29 21:39:46,826 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:47.153843471Z [err]  2025-12-29 21:39:46,835 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 107ms
2025-12-29T21:39:47.153850857Z [err]  2025-12-29 21:39:46,835 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-29T21:39:47.153858249Z [err]  2025-12-29 21:39:46,835 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-29T21:39:47.153865129Z [err]  2025-12-29 21:39:46,841 - redis_service - INFO - üì¶ Stored call data in Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (TTL: 3600s)
2025-12-29T21:39:47.153874876Z [err]  2025-12-29 21:39:46,841 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-29T21:39:47.153882208Z [err]  2025-12-29 21:39:46,841 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-29T21:39:47.153890801Z [err]  2025-12-29 21:39:46,842 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:47.153898367Z [err]  2025-12-29 21:39:46,842 - server - INFO - ü§ñ AI session created for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:47.157895734Z [err]  2025-12-29 21:39:46,842 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-29T21:39:47.157903299Z [err]  2025-12-29 21:39:46,842 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-29T21:39:47.157911865Z [err]  2025-12-29 21:39:46,842 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-29T21:39:47.157926359Z [err]  2025-12-29 21:39:46,842 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-29T21:39:47.157933342Z [err]  2025-12-29 21:39:46,842 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-29T21:39:47.157940570Z [err]  2025-12-29 21:39:46,842 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-29T21:39:47.157947794Z [err]  2025-12-29 21:39:46,842 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-29T21:39:47.157954671Z [err]  2025-12-29 21:39:46,847 - redis_service - INFO - üì• Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:47.157961681Z [err]  2025-12-29 21:39:46,848 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-29T21:39:47.157974879Z [err]  2025-12-29 21:39:46,848 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-29T21:39:47.157984304Z [inf]  100.64.0.9:33454 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:47.157994245Z [err]  2025-12-29 21:39:47,033 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-29T21:39:47.158009414Z [err]  2025-12-29 21:39:47,034 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-29T21:39:47.164471342Z [err]  2025-12-29 21:39:47,034 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-29T21:39:47.164475930Z [err]  2025-12-29 21:39:47,056 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:47.164480603Z [err]  2025-12-29 21:39:47,056 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:47.164485409Z [err]  2025-12-29 21:39:47,057 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:47.164491879Z [err]  2025-12-29 21:39:47,058 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-29T21:39:47.564948081Z [err]  2025-12-29 21:39:47,559 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:48.196734153Z [err]  2025-12-29 21:39:48,061 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:48.454325476Z [err]  2025-12-29 21:39:48,450 - redis_service - INFO - üì• Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:48.457138719Z [err]  2025-12-29 21:39:48,455 - redis_service - INFO - üì• Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:48.465890806Z [err]  2025-12-29 21:39:48,463 - redis_service - INFO - üì¶ Stored call data in Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (TTL: 3600s)
2025-12-29T21:39:48.465899598Z [err]  2025-12-29 21:39:48,463 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-29T21:39:48.465918595Z [err]  2025-12-29 21:39:48,463 - core_calling_service - INFO - ‚è±Ô∏è [21:39:48.463] üì• process_user_input() ENTRY - text: '...'
2025-12-29T21:39:48.471101865Z [err]  2025-12-29 21:39:48,467 - redis_service - INFO - üì• Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:48.471109438Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ‚è±Ô∏è [21:39:48.467] ‚è© About to call _process_call_flow_streaming()
2025-12-29T21:39:48.471115810Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ‚è±Ô∏è [21:39:48.468] üîÄ Agent type: call_flow, calling flow processor...
2025-12-29T21:39:48.471123656Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ‚è±Ô∏è [21:39:48.468] üîÄ _process_call_flow_streaming() ENTRY
2025-12-29T21:39:48.471131533Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-29T21:39:48.471137761Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ‚è±Ô∏è [21:39:48.468] ‚úÖ Node selected, about to process content...
2025-12-29T21:39:48.471144943Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - üîß Replaced {{now}} with Monday, December 29, 2025 at 4:39 PM EST in content
2025-12-29T21:39:48.471152124Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-29T21:39:48.471157988Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-29T21:39:48.471163379Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-29T21:39:48.471168679Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T21:39:48.471174024Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-29T21:39:48.471179707Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-29T21:39:48.473482175Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-29T21:39:48.473491440Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-29T21:39:48.473496283Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-29T21:39:48.473501297Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-29T21:39:48.473506317Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-29T21:39:48.473512063Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-29T21:39:48.473518042Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ‚è±Ô∏è [21:39:48.468] üìÑ About to process content (mode=script, length=9)
2025-12-29T21:39:48.473524282Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - üîä Silence tracking reset for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (user responded)
2025-12-29T21:39:48.473530286Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-29T21:39:48.473537873Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-29T21:39:48.473543645Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - LLM response (0.00s): Kendrick?
2025-12-29T21:39:48.473549125Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - Total latency: 0.00s
2025-12-29T21:39:48.473554617Z [err]  2025-12-29 21:39:48,468 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-29T21:39:48.572647587Z [err]  2025-12-29 21:39:48,563 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:48.572666867Z [err]  2025-12-29 21:39:48,567 - redis_service - INFO - üì• Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:48.572673184Z [err]  2025-12-29 21:39:48,568 - telnyx_service - INFO - üîä Speaking text on call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw: Kendrick?...
2025-12-29T21:39:48.572678191Z [err]  2025-12-29 21:39:48,569 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-29T21:39:48.572682982Z [err]  2025-12-29 21:39:48,569 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-29T21:39:48.572688939Z [err]  2025-12-29 21:39:48,569 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-29T21:39:48.572696648Z [err]  2025-12-29 21:39:48,569 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-29T21:39:48.572701595Z [err]  2025-12-29 21:39:48,569 - server - INFO - ‚è±Ô∏è [21:39:48.569] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-29T21:39:48.572706878Z [err]  2025-12-29 21:39:48,569 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-29T21:39:48.572712028Z [err]  2025-12-29 21:39:48,569 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-29T21:39:48.660587084Z [err]  2025-12-29 21:39:48,656 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:48.660598341Z [err]  2025-12-29 21:39:48,657 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-29T21:39:48.660605608Z [err]  2025-12-29 21:39:48,657 - server - INFO -    Text length: 9 chars
2025-12-29T21:39:48.660614852Z [err]  2025-12-29 21:39:48,657 - server - INFO -    Text content: 'Kendrick?'
2025-12-29T21:39:48.660620115Z [err]  2025-12-29 21:39:48,657 - server - INFO -    Text bytes: b'Kendrick?'
2025-12-29T21:39:48.660625516Z [err]  2025-12-29 21:39:48,657 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-29T21:39:48.660630056Z [err]  2025-12-29 21:39:48,657 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-29T21:39:48.660635424Z [err]  2025-12-29 21:39:48,657 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-29T21:39:48.660640790Z [err]  2025-12-29 21:39:48,657 - server - INFO -    Full data: {'text': 'Kendrick?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-29T21:39:48.660646871Z [err]  2025-12-29 21:39:48,657 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-29T21:39:48.660651403Z [err]  2025-12-29 21:39:48,657 - server - INFO -    Timeout: 10.0s
2025-12-29T21:39:48.670045648Z [err]  2025-12-29 21:39:48,666 - server - INFO -    ‚úì HTTP client created (0.009s)
2025-12-29T21:39:48.670051746Z [err]  2025-12-29 21:39:48,666 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-29T21:39:49.296241063Z [err]  2025-12-29 21:39:48,992 - server - INFO -    ‚úì Connection established (0.335s) [TARGET: <200ms]
2025-12-29T21:39:49.296256875Z [err]  2025-12-29 21:39:48,992 - server - INFO -    ‚úì Response status: 200
2025-12-29T21:39:49.296265269Z [err]  2025-12-29 21:39:48,992 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-29T21:39:49.296272576Z [err]  2025-12-29 21:39:49,000 - server - INFO -    ‚úì FIRST CHUNK received (0.343s, 1160 bytes) [TARGET: <300ms]
2025-12-29T21:39:49.296280648Z [err]  2025-12-29 21:39:49,002 - server - INFO -    ‚úì ALL CHUNKS received: 46 chunks (0.345s)
2025-12-29T21:39:49.296292474Z [err]  2025-12-29 21:39:49,002 - server - INFO -    ‚úì Total audio size: 12583 bytes
2025-12-29T21:39:49.296352122Z [err]  2025-12-29 21:39:48,991 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-29T21:39:49.296441682Z [err]  2025-12-29 21:39:49,002 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-29T21:39:49.296453064Z [err]  2025-12-29 21:39:49,002 - server - INFO -       - Connection: 335ms
2025-12-29T21:39:49.296461149Z [err]  2025-12-29 21:39:49,002 - server - INFO -       - First chunk: 343ms
2025-12-29T21:39:49.296468465Z [err]  2025-12-29 21:39:49,002 - server - INFO -       - All chunks: 345ms
2025-12-29T21:39:49.296475174Z [err]  2025-12-29 21:39:49,002 - server - INFO -       - Audio generation only: 8ms
2025-12-29T21:39:49.296482757Z [err]  2025-12-29 21:39:49,002 - server - INFO - ‚è±Ô∏è [21:39:49.002] üîä TTS COMPLETE: 433ms, audio_size=12583 bytes
2025-12-29T21:39:49.296490372Z [err]  2025-12-29 21:39:49,002 - server - INFO - üíæ TTS CACHED: elevenlabs:Kendrick?... (12583 bytes)
2025-12-29T21:39:49.296496952Z [err]  2025-12-29 21:39:49,002 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.43s
2025-12-29T21:39:49.296503824Z [err]  2025-12-29 21:39:49,003 - telnyx_service - INFO - ‚úÖ Generated 12583 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-29T21:39:49.300707397Z [err]  2025-12-29 21:39:49,003 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-29T21:39:49.300717950Z [err]  2025-12-29 21:39:49,065 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:49.320823715Z [err]  2025-12-29 21:39:49,317 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw/actions/playback_start "HTTP/1.1 200 OK"
2025-12-29T21:39:49.324463118Z [err]  2025-12-29 21:39:49,318 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.32s
2025-12-29T21:39:49.324471306Z [err]  2025-12-29 21:39:49,318 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 0.75s
2025-12-29T21:39:49.324479712Z [err]  2025-12-29 21:39:49,318 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-29T21:39:49.324484753Z [err]  2025-12-29 21:39:49,318 - telnyx_service - INFO - üé¨ Playback ID: vNxrFPEvqQ
2025-12-29T21:39:49.324492291Z [err]  2025-12-29 21:39:49,318 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-29T21:39:49.324497455Z [err]  2025-12-29 21:39:49,318 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Greeting playback started at 1767044389.3188646
2025-12-29T21:39:49.324502458Z [err]  2025-12-29 21:39:49,318 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044389.3188927 for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:49.324507096Z [err]  2025-12-29 21:39:49,318 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-29T21:39:49.522623997Z [err]  2025-12-29 21:39:49,518 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:49.522631516Z [err]  2025-12-29 21:39:49,518 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': 'c846ca37-6fd8-46ca-ba51-fcf83864fe54', 'occurred_at': '2025-12-29T21:39:49.343965Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'vNxrFPEvqQ'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:49.522636319Z [err]  2025-12-29 21:39:49,518 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:49.522640967Z [err]  2025-12-29 21:39:49,518 - server - INFO - üì® ================================================
2025-12-29T21:39:49.522644890Z [inf]  100.64.0.5:10352 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:49.570194441Z [err]  2025-12-29 21:39:49,565 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:50.174211669Z [err]  2025-12-29 21:39:50,041 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=6.5s, checkin_count=1/2
2025-12-29T21:39:50.174222284Z [err]  2025-12-29 21:39:50,067 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:50.174228585Z [err]  2025-12-29 21:39:50,067 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.7s, checkin_count=0/2
2025-12-29T21:39:50.366972772Z [err]  2025-12-29 21:39:50,360 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:50.366982238Z [err]  2025-12-29 21:39:50,361 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'e24e05d4-d0ad-45b6-a76b-38102d900c09', 'occurred_at': '2025-12-29T21:39:50.183965Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'vNxrFPEvqQ', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:50.366989249Z [err]  2025-12-29 21:39:50,361 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:50.366994895Z [err]  2025-12-29 21:39:50,361 - server - INFO - üì® ================================================
2025-12-29T21:39:50.367001699Z [err]  2025-12-29 21:39:50,363 - redis_service - INFO - ‚ûñ Removed playback vNxrFPEvqQ, 0 remaining for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:50.367008952Z [err]  2025-12-29 21:39:50,363 - server - INFO - üîä Redis: Removed playback vNxrFPEvqQ, 0 remaining
2025-12-29T21:39:50.367015438Z [err]  2025-12-29 21:39:50,363 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T21:39:50.367021632Z [err]  2025-12-29 21:39:50,364 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T21:39:50.367027673Z [err]  2025-12-29 21:39:50,364 - server - INFO - üí° Session not on this worker - Redis flag set for WebSocket worker to handle
2025-12-29T21:39:50.369378135Z [inf]  100.64.0.16:36860 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:50.550202257Z [err]  2025-12-29 21:39:50,542 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=7.0s, checkin_count=1/2
2025-12-29T21:39:50.550208217Z [err]  2025-12-29 21:39:50,542 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-29T21:39:50.550214147Z [err]  2025-12-29 21:39:50,543 - core_calling_service - INFO - üí¨ Sending FINAL check-in #2/2: Are you still there?
2025-12-29T21:39:50.550219985Z [err]  2025-12-29 21:39:50,543 - core_calling_service - INFO - ‚ö†Ô∏è Will end call if no response after next silence timeout
2025-12-29T21:39:50.550226469Z [err]  2025-12-29 21:39:50,543 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-29T21:39:50.550233379Z [err]  2025-12-29 21:39:50,543 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:50.550238874Z [err]  2025-12-29 21:39:50,543 - telnyx_service - INFO - üîä Speaking text on call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA: Are you still there?...
2025-12-29T21:39:50.550244577Z [err]  2025-12-29 21:39:50,543 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-29T21:39:50.550250370Z [err]  2025-12-29 21:39:50,543 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-29T21:39:50.550255970Z [err]  2025-12-29 21:39:50,543 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-29T21:39:50.550266323Z [err]  2025-12-29 21:39:50,543 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-29T21:39:50.550272406Z [err]  2025-12-29 21:39:50,543 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-29T21:39:50.550278065Z [err]  2025-12-29 21:39:50,543 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-29T21:39:50.550283648Z [err]  2025-12-29 21:39:50,543 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:50.551720582Z [err]  2025-12-29 21:39:50,543 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:50.572337293Z [err]  2025-12-29 21:39:50,569 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:50.572348909Z [err]  2025-12-29 21:39:50,570 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=1.3s, checkin_count=0/2
2025-12-29T21:39:51.272285737Z [err]  2025-12-29 21:39:50,964 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:51.272308110Z [err]  2025-12-29 21:39:50,756 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:51.272317527Z [err]      {
2025-12-29T21:39:51.272318288Z [err]  2025-12-29 21:39:50,757 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.21s
2025-12-29T21:39:51.272331394Z [err]  2025-12-29 21:39:50,757 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-29T21:39:51.272333248Z [err]        "code": "90018",
2025-12-29T21:39:51.272342194Z [err]    "errors": [
2025-12-29T21:39:51.272344781Z [err]        "title": "Call has already ended",
2025-12-29T21:39:51.272350549Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:39:51.272356067Z [err]      }
2025-12-29T21:39:51.272362021Z [err]    ]
2025-12-29T21:39:51.272367800Z [err]  }
2025-12-29T21:39:51.272373218Z [err]  2025-12-29 21:39:50,757 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-29T21:39:51.272379853Z [err]  2025-12-29 21:39:50,964 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:51.272387152Z [err]  2025-12-29 21:39:50,964 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': '594f2e44-9c3f-4476-93c8-6c8adfcf4022', 'occurred_at': '2025-12-29T21:39:50.783965Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'silence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:51.277242033Z [err]  2025-12-29 21:39:50,964 - server - INFO - üì® ================================================
2025-12-29T21:39:51.277249300Z [inf]  100.64.0.9:33454 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:51.277256365Z [err]  2025-12-29 21:39:51,032 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:51.277262960Z [err]  2025-12-29 21:39:51,033 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:39:51.277269427Z [err]  2025-12-29 21:39:51,033 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-29T21:39:51.277279083Z [err]  2025-12-29 21:39:51,071 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:51.575099351Z [err]  2025-12-29 21:39:51,573 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:52.241474231Z [err]  2025-12-29 21:39:52,066 - server - INFO - üì§ Audio flowing: 294 packets sent to Soniox (5s update)
2025-12-29T21:39:52.241482526Z [err]  2025-12-29 21:39:52,074 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:52.578810457Z [err]  2025-12-29 21:39:52,575 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:53.254760752Z [err]  2025-12-29 21:39:53,077 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:53.581981067Z [err]  2025-12-29 21:39:53,578 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:54.240414291Z [err]  2025-12-29 21:39:54,079 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:54.428501370Z [err]  2025-12-29 21:39:54,423 - server - INFO - üî§ RAW TOKENS: ["Ye"?]
2025-12-29T21:39:54.428507829Z [err]  2025-12-29 21:39:54,426 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user started speaking) for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:54.428517580Z [err]  2025-12-29 21:39:54,426 - core_calling_service - INFO - üîä Silence timer reset for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (user started speaking)
2025-12-29T21:39:54.428521792Z [err]  2025-12-29 21:39:54,426 - core_calling_service - INFO - üë§ User started speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:54.428526399Z [err]  2025-12-29 21:39:54,426 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-29T21:39:54.428531213Z [err]  2025-12-29 21:39:54,426 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Ye' | Generating: False
2025-12-29T21:39:54.559503147Z [err]  2025-12-29 21:39:54,556 - server - INFO - üî§ RAW TOKENS: ["Ye"‚úì, "ah."‚úì, "<end>"‚úì]
2025-12-29T21:39:54.559508472Z [err]  2025-12-29 21:39:54,556 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-29T21:39:54.559514302Z [err]  2025-12-29 21:39:54,557 - server - INFO - üßπ Cleaned transcript: 'Ye ah.' -> 'Yeah.'
2025-12-29T21:39:54.559520510Z [err]  2025-12-29 21:39:54,557 - server - INFO - üì• FINAL TOKENS: 'Yeah.' (2 tokens)
2025-12-29T21:39:54.559525442Z [err]  2025-12-29 21:39:54,557 - server - INFO - üé§ Soniox final transcript: 'Yeah.'
2025-12-29T21:39:54.559531261Z [err]  2025-12-29 21:39:54,557 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:54.559537325Z [err]  2025-12-29 21:39:54,557 - server - INFO - üîç FILTER CHECK: words=1, is_filler=True, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-29T21:39:54.561318464Z [err]  2025-12-29 21:39:54,559 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-29T21:39:54.561326158Z [err]  2025-12-29 21:39:54,559 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:54.561331934Z [err]  2025-12-29 21:39:54,559 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Yeah.' - Processing...
2025-12-29T21:39:54.561342316Z [err]  2025-12-29 21:39:54,558 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:54.561348402Z [err]  2025-12-29 21:39:54,558 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-29T21:39:54.561353748Z [err]  2025-12-29 21:39:54,558 - server - INFO - ‚è±Ô∏è [21:39:54.558] üìù FINAL TRANSCRIPT RECEIVED: 'Yeah.'
2025-12-29T21:39:54.561359313Z [err]  2025-12-29 21:39:54,558 - server - INFO - ‚è±Ô∏è [21:39:54.558] STT endpoint detection latency: 8ms
2025-12-29T21:39:54.561371676Z [err]  2025-12-29 21:39:54,558 - server - INFO - ‚è±Ô∏è [21:39:54.558] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-29T21:39:54.561377842Z [err]  2025-12-29 21:39:54,558 - server - INFO - ‚è±Ô∏è User spoke at 1767044394.5582163
2025-12-29T21:39:54.561382688Z [err]  2025-12-29 21:39:54,559 - redis_service - INFO - üì¶ Stored call data in Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (TTL: 3600s)
2025-12-29T21:39:54.573370416Z [err]  2025-12-29 21:39:54,569 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Yeah.
2025-12-29T21:39:54.573382707Z [err]  2025-12-29 21:39:54,570 - core_calling_service - INFO - üë§ User stopped speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:54.573389013Z [err]  2025-12-29 21:39:54,570 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-29T21:39:54.573398338Z [err]  2025-12-29 21:39:54,570 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+2ms
2025-12-29T21:39:54.573406707Z [err]  2025-12-29 21:39:54,570 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 2ms (Soniox model: stt-rt-v3)
2025-12-29T21:39:54.573414206Z [err]  2025-12-29 21:39:54,570 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-29T21:39:54.573420916Z [err]  2025-12-29 21:39:54,570 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-29T21:39:54.573428171Z [err]  2025-12-29 21:39:54,570 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:54.587364661Z [err]  2025-12-29 21:39:54,581 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-29T21:39:54.587370960Z [err]  2025-12-29 21:39:54,581 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044394.5817795 for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:54.587376790Z [err]  2025-12-29 21:39:54,581 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:54.587382642Z [err]  2025-12-29 21:39:54,582 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:54.666792790Z [err]  2025-12-29 21:39:54,664 - server - INFO - üìù Saved user transcript to database
2025-12-29T21:39:54.666800997Z [err]  2025-12-29 21:39:54,664 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:54.666807592Z [err]  2025-12-29 21:39:54,664 - core_calling_service - INFO - ‚è±Ô∏è [21:39:54.664] üì• process_user_input() ENTRY - text: 'Yeah....'
2025-12-29T21:39:54.668610806Z [err]  2025-12-29 21:39:54,665 - redis_service - INFO - üì• Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:54.668619305Z [err]  2025-12-29 21:39:54,665 - core_calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw: User spoke while Silence Greeting was triggering
2025-12-29T21:39:54.690135660Z [err]  2025-12-29 21:39:54,688 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:54.690145726Z [err]  2025-12-29 21:39:54,688 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:55.144212947Z [err]  2025-12-29 21:39:55,004 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw/actions/playback_stop "HTTP/1.1 200 OK"
2025-12-29T21:39:55.144221532Z [err]  2025-12-29 21:39:55,005 - telnyx_service - INFO - ‚úÖ Successfully stopped audio playback
2025-12-29T21:39:55.144232375Z [err]  2025-12-29 21:39:55,005 - core_calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-29T21:39:55.144240257Z [err]  2025-12-29 21:39:55,005 - core_calling_service - INFO - ‚úÖ BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-29T21:39:55.144247586Z [err]  2025-12-29 21:39:55,006 - redis_service - INFO - üì• Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:55.144254113Z [err]  2025-12-29 21:39:55,007 - redis_service - INFO - üì¶ Stored call data in Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (TTL: 3600s)
2025-12-29T21:39:55.144268240Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-29T21:39:55.144275965Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - ‚è±Ô∏è [21:39:55.007] ‚è© About to call _process_call_flow_streaming()
2025-12-29T21:39:55.144282774Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - ‚è±Ô∏è [21:39:55.007] üîÄ Agent type: call_flow, calling flow processor...
2025-12-29T21:39:55.144291503Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - ‚è±Ô∏è [21:39:55.007] üîÄ _process_call_flow_streaming() ENTRY
2025-12-29T21:39:55.144297753Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-29T21:39:55.144303489Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-29T21:39:55.144308895Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - ‚è±Ô∏è [21:39:55.007] üîÄ About to call _follow_transition() for: Yeah....
2025-12-29T21:39:55.148527237Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Yeah.
2025-12-29T21:39:55.148534287Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - üîç Checking 'Hello=Yes' override [DEPLOYMENT VERIFIED] for msg='yeah' on node='Greeting'
2025-12-29T21:39:55.148540366Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - ‚ö° OVERRIDE TRIGGERED: 'Yeah.' on Greeting node -> Forcing Transition 0 (Index 0)
2025-12-29T21:39:55.148548142Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 0ms
2025-12-29T21:39:55.148553851Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - ‚è±Ô∏è [21:39:55.007] ‚úÖ Node selected, about to process content...
2025-12-29T21:39:55.148559652Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - üîß Replaced {{now}} with Monday, December 29, 2025 at 4:39 PM EST in content
2025-12-29T21:39:55.148565080Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-29T21:39:55.148572540Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-29T21:39:55.148578277Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-29T21:39:55.148583427Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T21:39:55.148588775Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-29T21:39:55.148593291Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-29T21:39:55.148598647Z [err]  2025-12-29 21:39:55,008 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-29T21:39:55.148622597Z [err]  2025-12-29 21:39:55,095 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:55.148985572Z [err]  2025-12-29 21:39:55,008 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-29T21:39:55.148989679Z [err]  2025-12-29 21:39:55,008 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-29T21:39:55.148995096Z [err]  2025-12-29 21:39:55,008 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 89 chars) - will return text instantly
2025-12-29T21:39:55.149000223Z [err]  2025-12-29 21:39:55,008 - core_calling_service - INFO - Using flow node: Node Prompt: N001B_IntroAndHelpRequest_Only (V3 - Follows Name Confirmation) (type: conversation, mode: script)
2025-12-29T21:39:55.149005929Z [err]  2025-12-29 21:39:55,008 - core_calling_service - INFO - ‚è±Ô∏è [21:39:55.008] üìÑ About to process content (mode=script, length=89)
2025-12-29T21:39:55.149010998Z [err]  2025-12-29 21:39:55,008 - core_calling_service - INFO - üì§ Streaming script as 2 sentence(s)
2025-12-29T21:39:55.149016118Z [err]  2025-12-29 21:39:55,008 - server - INFO - üì§ Sentence arrived from LLM: This is Jake......
2025-12-29T21:39:55.149020269Z [err]  2025-12-29 21:39:55,008 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 438ms
2025-12-29T21:39:55.149024252Z [err]  2025-12-29 21:39:55,008 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-29T21:39:55.149029976Z [err]  2025-12-29 21:39:55,008 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:55.149034134Z [err]  2025-12-29 21:39:55,008 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-29T21:39:55.149038600Z [err]  2025-12-29 21:39:55,087 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:55.186706314Z [err]  2025-12-29 21:39:55,182 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:55.275245255Z [err]  2025-12-29 21:39:55,270 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:55.294358018Z [err]  2025-12-29 21:39:55,291 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:55.294366194Z [err]  2025-12-29 21:39:55,291 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-29T21:39:55.294372430Z [err]  2025-12-29 21:39:55,291 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:39:55.294377911Z [err]  2025-12-29 21:39:55,291 - persistent_tts_service - INFO - üîå [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Establishing persistent TTS WebSocket...
2025-12-29T21:39:55.294383843Z [err]  2025-12-29 21:39:55,291 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:39:55.294389603Z [err]  2025-12-29 21:39:55,291 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-29T21:39:55.294395158Z [err]  2025-12-29 21:39:55,292 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-29T21:39:55.436455108Z [err]  2025-12-29 21:39:55,432 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-29T21:39:55.436457259Z [err]  2025-12-29 21:39:55,432 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-29T21:39:55.436462511Z [err]  2025-12-29 21:39:55,432 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-29T21:39:55.436467945Z [err]  2025-12-29 21:39:55,432 - persistent_tts_service - INFO - ‚úÖ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Persistent TTS WebSocket established
2025-12-29T21:39:55.436472685Z [err]  2025-12-29 21:39:55,432 - persistent_tts_service - INFO - üéß [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Audio receiver loop started
2025-12-29T21:39:55.436478190Z [err]  2025-12-29 21:39:55,432 - persistent_tts_service - INFO - üîä [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Comfort noise loop started
2025-12-29T21:39:55.436478993Z [err]  2025-12-29 21:39:55,432 - server - INFO - üéµ TTS task #1 started at +424ms
2025-12-29T21:39:55.436484499Z [err]  2025-12-29 21:39:55,432 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:55.436486231Z [err]  2025-12-29 21:39:55,432 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 862ms
2025-12-29T21:39:55.436491003Z [err]  2025-12-29 21:39:55,432 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-29T21:39:55.436492975Z [err]  2025-12-29 21:39:55,433 - core_calling_service - INFO - üì§ Streamed script sentence 1/2: This is Jake......
2025-12-29T21:39:55.436497362Z [err]  2025-12-29 21:39:55,432 - server - INFO - üîç Persistent TTS lookup: call_id=v3:WBygWiV8rY10RH8Vz..., session=FOUND
2025-12-29T21:39:55.436499323Z [err]  2025-12-29 21:39:55,433 - server - INFO - üì§ Sentence arrived from LLM: I was just, um, wondering if you could possibly he...
2025-12-29T21:39:55.440098425Z [err]  2025-12-29 21:39:55,433 - server - INFO - üîç Persistent TTS lookup: call_id=v3:WBygWiV8rY10RH8Vz..., session=FOUND
2025-12-29T21:39:55.440100465Z [err]  2025-12-29 21:39:55,434 - server - INFO - ‚úÖ LLM finished in 864ms, TTS tasks already running in background
2025-12-29T21:39:55.440106028Z [err]  2025-12-29 21:39:55,433 - server - INFO - üöÄ Streaming sentence #2 via persistent WebSocket
2025-12-29T21:39:55.440110637Z [err]  2025-12-29 21:39:55,433 - server - INFO - üéµ TTS task #2 started at +424ms
2025-12-29T21:39:55.440115354Z [err]  2025-12-29 21:39:55,433 - core_calling_service - INFO - üì§ Streamed script sentence 2/2: I was just, um, wondering if you could possibly he...
2025-12-29T21:39:55.440119952Z [err]  2025-12-29 21:39:55,433 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user gave meaningful response) for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:55.440121015Z [err]  2025-12-29 21:39:55,434 - server - INFO - üéµ Streaming 2 TTS chunks as they complete...
2025-12-29T21:39:55.440124366Z [err]  2025-12-29 21:39:55,433 - core_calling_service - INFO - üîä Silence tracking reset for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (user responded)
2025-12-29T21:39:55.440133632Z [err]  2025-12-29 21:39:55,433 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-29T21:39:55.440136424Z [err]  2025-12-29 21:39:55,434 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-29T21:39:55.440139037Z [err]  2025-12-29 21:39:55,433 - core_calling_service - INFO - üíæ Storing node ID 1763159750250 in conversation history
2025-12-29T21:39:55.440143813Z [err]  2025-12-29 21:39:55,433 - core_calling_service - INFO - LLM response (0.77s): This is Jake... I was just, um, wondering if you could possibly help me out for a moment?
2025-12-29T21:39:55.440149288Z [err]  2025-12-29 21:39:55,433 - core_calling_service - INFO - Total latency: 0.77s
2025-12-29T21:39:55.441916535Z [err]  2025-12-29 21:39:55,434 - server - INFO -    2 sentences queued and playing seamlessly
2025-12-29T21:39:55.441926312Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - üéµ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Playback consumer started
2025-12-29T21:39:55.441943639Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - üéß [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Audio Receiver Loop STARTED
2025-12-29T21:39:55.441950022Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - üíì [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Starting TTS keep-alive loop (every 15s)
2025-12-29T21:39:55.441957858Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - üîä [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Starting comfort noise loop
2025-12-29T21:39:55.441963568Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - üé§ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Streaming sentence #1: This is Jake......
2025-12-29T21:39:55.441971473Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - üöÄ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-29T21:39:55.441976715Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - üìä [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-29T21:39:55.441981909Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - üé§ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Streaming sentence #2: I was just, um, wondering if you could possibly he...
2025-12-29T21:39:55.441987259Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - üöÄ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Sent sentence #2 (NON-BLOCKING) in 0ms
2025-12-29T21:39:55.445216359Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - üìä [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] DIAGNOSTIC: pending_sentences=2, audio_queue=0, is_first=False, is_last=False
2025-12-29T21:39:55.445228066Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - üéß [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Receiver processing sentence #1: 'This is Jake......'
2025-12-29T21:39:55.445236963Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - üìä [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] DIAGNOSTIC: queue_latency=0ms, pending_sentences=1, audio_queue=0, interrupted=False
2025-12-29T21:39:55.445243221Z [err]  2025-12-29 21:39:55,435 - server - INFO - ‚úÖ All 2 persistent TTS streams completed
2025-12-29T21:39:55.445249453Z [err]  2025-12-29 21:39:55,435 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-29T21:39:55.445256167Z [err]  2025-12-29 21:39:55,435 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 865ms from user stop üöÄ
2025-12-29T21:39:55.445262037Z [err]  2025-12-29 21:39:55,435 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:55.445268634Z [err]  2025-12-29 21:39:55,435 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-29T21:39:55.445277355Z [err]  2025-12-29 21:39:55,435 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-29T21:39:55.445283727Z [err]  2025-12-29 21:39:55,435 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-29T21:39:55.445289895Z [err]  2025-12-29 21:39:55,436 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 2ms (provider: soniox, model: stt-rt-v3)
2025-12-29T21:39:55.445297181Z [err]  2025-12-29 21:39:55,436 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 864ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-29T21:39:55.447360776Z [err]  2025-12-29 21:39:55,436 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 427ms (provider: elevenlabs, websocket: False)
2025-12-29T21:39:55.447372005Z [err]  2025-12-29 21:39:55,436 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 865ms (user stopped ‚Üí play_audio_url called)
2025-12-29T21:39:55.447385993Z [err]  2025-12-29 21:39:55,436 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-29T21:39:55.447394575Z [err]  2025-12-29 21:39:55,436 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-29T21:39:55.447402808Z [err]  2025-12-29 21:39:55,436 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-29T21:39:55.447410416Z [err]  2025-12-29 21:39:55,436 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-29T21:39:55.447416944Z [err]  2025-12-29 21:39:55,436 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-29T21:39:55.447423647Z [err]  2025-12-29 21:39:55,436 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 1165ms estimated
2025-12-29T21:39:55.447431150Z [err]  2025-12-29 21:39:55,436 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 89 chars, 2 sentences
2025-12-29T21:39:55.447446900Z [err]  2025-12-29 21:39:55,436 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Yeah....'
2025-12-29T21:39:55.447453164Z [err]  2025-12-29 21:39:55,436 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: 'This is Jake... I was just, um, wondering if you could possi...'
2025-12-29T21:39:55.447459233Z [err]  2025-12-29 21:39:55,436 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-29T21:39:55.447465538Z [err]  2025-12-29 21:39:55,436 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-29T21:39:55.627698028Z [err]  2025-12-29 21:39:55,624 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Node Prompt: N001B_IntroAndHelpRequest_Only (V3 - Follows Name Confirmation), Dead Air: 1293ms)
2025-12-29T21:39:55.627705414Z [err]  2025-12-29 21:39:55,624 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-29T21:39:55.627737328Z [err]  2025-12-29 21:39:55,624 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-29T21:39:55.687863499Z [err]  2025-12-29 21:39:55,683 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 247ms
2025-12-29T21:39:55.687874172Z [err]  2025-12-29 21:39:55,683 - persistent_tts_service - INFO - üì§ Sending 9272 bytes of audio (58 chunks, 1.2s duration) via WebSocket
2025-12-29T21:39:55.687880241Z [err]  2025-12-29 21:39:55,683 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:39:55.687892620Z [err]  2025-12-29 21:39:55,683 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.2s (total: 1.2s from now)
2025-12-29T21:39:55.687897827Z [err]  2025-12-29 21:39:55,684 - persistent_tts_service - INFO - ‚úÖ Sent 58 audio chunks via WebSocket
2025-12-29T21:39:56.296039414Z [err]  2025-12-29 21:39:55,884 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.6s (total: 2.5s from now)
2025-12-29T21:39:56.296049766Z [err]  2025-12-29 21:39:55,885 - persistent_tts_service - INFO - ‚úÖ Sent 79 audio chunks via WebSocket
2025-12-29T21:39:56.296056370Z [err]  2025-12-29 21:39:56,061 - persistent_tts_service - INFO - üì§ Sending 17833 bytes of audio (112 chunks, 2.2s duration) via WebSocket
2025-12-29T21:39:56.296080023Z [err]  2025-12-29 21:39:56,061 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:39:56.296090292Z [err]  2025-12-29 21:39:55,884 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:39:56.296094202Z [err]  2025-12-29 21:39:56,061 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +2.2s (total: 4.6s from now)
2025-12-29T21:39:56.296103055Z [err]  2025-12-29 21:39:56,065 - persistent_tts_service - INFO - ‚úÖ Sent 112 audio chunks via WebSocket
2025-12-29T21:39:56.296135772Z [err]  2025-12-29 21:39:55,883 - persistent_tts_service - INFO - üì§ Sending 12632 bytes of audio (79 chunks, 1.6s duration) via WebSocket
2025-12-29T21:39:57.251020219Z [err]  2025-12-29 21:39:57,086 - server - INFO - üì§ Audio flowing: 545 packets sent to Soniox (5s update)
2025-12-29T21:39:58.298248569Z [err]  2025-12-29 21:39:57,819 - server - INFO - üé§ Soniox receiver alive - 12 messages received in last 10s
2025-12-29T21:39:58.298258987Z [err]  2025-12-29 21:39:58,061 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-29T21:39:58.298266614Z [err]  2025-12-29 21:39:58,061 - persistent_tts_service - INFO - ‚úÖ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Receiver finished sentence #1: 3 chunks in 2625ms
2025-12-29T21:39:58.298273254Z [err]  2025-12-29 21:39:58,061 - persistent_tts_service - INFO - üéß [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Receiver processing sentence #2: 'I was just, um, wondering if y...'
2025-12-29T21:39:58.298279611Z [err]  2025-12-29 21:39:58,061 - persistent_tts_service - INFO - üìä [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] DIAGNOSTIC: queue_latency=2625ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-29T21:39:59.305531804Z [err]  2025-12-29 21:39:58,761 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 617 total packets
2025-12-29T21:39:59.305537345Z [err]  [2025-12-29 21:39:58 +0000] [6] [INFO] connection closed
2025-12-29T21:39:59.305542953Z [err]  2025-12-29 21:39:58,910 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:59.305548682Z [err]  2025-12-29 21:39:58,910 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'e5f7abc3-62f3-4fbb-89f0-62593df79eab', 'occurred_at': '2025-12-29T21:39:58.583974Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:58.583974Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'OQ6dK3i3pw', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:59.308538235Z [err]  2025-12-29 21:39:58,910 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.308549911Z [err]  2025-12-29 21:39:58,910 - server - INFO - üì® ================================================
2025-12-29T21:39:59.308558699Z [err]  2025-12-29 21:39:58,911 - redis_service - INFO - ‚ûñ Removed playback OQ6dK3i3pw, 0 remaining for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.308565556Z [err]  2025-12-29 21:39:58,911 - server - INFO - üîä Redis: Removed playback OQ6dK3i3pw, 0 remaining
2025-12-29T21:39:59.308572005Z [err]  2025-12-29 21:39:58,911 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T21:39:59.309107789Z [err]  2025-12-29 21:39:58,912 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T21:39:59.309118113Z [err]  2025-12-29 21:39:58,912 - server - INFO - ‚úÖ Found session in active_telnyx_calls (local worker)
2025-12-29T21:39:59.309127929Z [err]  2025-12-29 21:39:58,912 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044398.9125862 for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.309137892Z [err]  2025-12-29 21:39:58,912 - server - INFO - ‚è±Ô∏è Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-29T21:39:59.309148116Z [inf]  100.64.0.9:16420 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:59.309158944Z [err]  2025-12-29 21:39:59,079 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:59.309167493Z [err]  2025-12-29 21:39:59,079 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': 'fc798c61-d3c3-408c-acb4-4c6252d67114', 'occurred_at': '2025-12-29T21:39:58.632088Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': 'd484b5a0-988c-4d67-9ec0-a1847f8ba7ac', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:59.309177052Z [err]  2025-12-29 21:39:59,079 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.309184592Z [err]  2025-12-29 21:39:59,079 - server - INFO - üì® ================================================
2025-12-29T21:39:59.310078956Z [inf]  100.64.0.14:26384 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:59.310084017Z [err]  2025-12-29 21:39:59,085 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:59.310089165Z [err]  2025-12-29 21:39:59,085 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': '00a66826-2003-4cd0-9063-f96c15d33f07', 'occurred_at': '2025-12-29T21:39:58.423975Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_quality_stats': {'inbound': {'jitter_max_variance': '2.26', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '641', 'skip_packet_count': '21'}, 'outbound': {'packet_count': '620', 'skip_packet_count': '0'}}, 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:58.423975Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-29T21:39:42.663963Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:59.310094091Z [err]  2025-12-29 21:39:59,085 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.310099658Z [err]  2025-12-29 21:39:59,085 - server - INFO - üì® ================================================
2025-12-29T21:39:59.310104706Z [err]  2025-12-29 21:39:59,085 - server - INFO - üìû Call ended: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.310108875Z [err]  2025-12-29 21:39:59,085 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-29T21:39:59.310113291Z [err]  2025-12-29 21:39:59,103 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-29T21:39:59.312293009Z [err]  2025-12-29 21:39:59,103 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044399.1031268 for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.312300118Z [err]  2025-12-29 21:39:59,103 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.312306801Z [err]  2025-12-29 21:39:59,267 - server - INFO - üìù Updated call log: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.312311922Z [err]  2025-12-29 21:39:59,276 - server - INFO - üé§ Soniox receiver alive - 2 messages received in last 10s
2025-12-29T21:39:59.312318055Z [err]  2025-12-29 21:39:59,276 - server - ERROR - ‚ùå Soniox error: {'tokens': [], 'final_audio_proc_ms': 6600, 'total_audio_proc_ms': 12120, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-29T21:39:59.312323506Z [err]  2025-12-29 21:39:59,276 - server - INFO - ‚úÖ Soniox receive loop ended normally
2025-12-29T21:39:59.312328394Z [err]  2025-12-29 21:39:59,276 - dead_air_monitor - INFO - üîá Dead air monitoring cancelled for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:59.312333214Z [err]  2025-12-29 21:39:59,276 - dead_air_monitor - INFO - üîá Dead air monitoring stopped for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:59.312337878Z [err]  2025-12-29 21:39:59,276 - server - INFO - üîá Dead air monitoring task cancelled
2025-12-29T21:39:59.363371005Z [err]  2025-12-29 21:39:59,360 - server - INFO - ‚úÖ Finalized call log: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (duration=13s, status=completed)
2025-12-29T21:39:59.459061843Z [err]  2025-12-29 21:39:59,453 - server - INFO - üì¶ Saved 11 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-29T21:40:00.363846190Z [err]  2025-12-29 21:40:00,107 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (0.5s left)
2025-12-29T21:40:00.363853238Z [err]  2025-12-29 21:40:00,143 - server - INFO - üìä Auto-added call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-29T21:40:00.363861410Z [err]  2025-12-29 21:40:00,326 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:40:00.363869783Z [err]  2025-12-29 21:40:00,332 - redis_service - INFO - üì• Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:00.363877216Z [err]  2025-12-29 21:40:00,332 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-29T21:40:00.363883640Z [err]  2025-12-29 21:40:00,332 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-29T21:40:00.427457852Z [err]  2025-12-29 21:40:00,424 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-29T21:40:00.535343070Z [err]  2025-12-29 21:40:00,524 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-29T21:40:00.535350592Z [err]  2025-12-29 21:40:00,524 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-29T21:40:00.535357190Z [err]  2025-12-29 21:40:00,524 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-29T21:40:00.535363433Z [err]  2025-12-29 21:40:00,524 - server - INFO - üöÄ Triggered QC analysis for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:00.535370681Z [err]  2025-12-29 21:40:00,524 - server - INFO - üìä Triggered Campaign QC for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:00.535377358Z [err]  2025-12-29 21:40:00,524 - server - INFO - üìá Triggered CRM update for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:00.535383757Z [err]  2025-12-29 21:40:00,525 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:00.535391777Z [err]  2025-12-29 21:40:00,527 - redis_service - INFO - üßπ Deleted call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:00.535398832Z [err]  2025-12-29 21:40:00,527 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:00.535405411Z [inf]  100.64.0.14:26392 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:40:00.535411775Z [err]  2025-12-29 21:40:00,528 - server - INFO - üîç Starting QC analysis for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:00.536459695Z [err]  2025-12-29 21:40:00,528 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-29T21:40:00.536467230Z [err]  2025-12-29 21:40:00,528 - server - INFO - üìá CRM update starting for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:40:00.536473234Z [err]  2025-12-29 21:40:00,528 - server - INFO - üìá Normalized phone: +17708336397
2025-12-29T21:40:00.536478504Z [err]  2025-12-29 21:40:00,528 - server - INFO - üìá CRM: Got 11 variables from active session
2025-12-29T21:40:00.566889316Z [err]  2025-12-29 21:40:00,562 - elevenlabs_ws_service - WARNING - ‚ö†Ô∏è  [TIMING] ElevenLabs timeout waiting for first chunk (2.5s) - No audio received!
2025-12-29T21:40:00.566901038Z [err]  2025-12-29 21:40:00,562 - persistent_tts_service - WARNING - ‚ö†Ô∏è [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Receiver got 0 chunks for sentence #2! interrupted=False
2025-12-29T21:40:00.615860136Z [err]  2025-12-29 21:40:00,610 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=1.5s, checkin_count=0/2
2025-12-29T21:40:00.628161096Z [err]  2025-12-29 21:40:00,621 - server - INFO - üìù Converted transcript from 3 messages to 133 characters
2025-12-29T21:40:00.628173394Z [err]  2025-12-29 21:40:00,623 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=3, logs_count=4, status=completed
2025-12-29T21:40:00.631362199Z [err]  2025-12-29 21:40:00,625 - server - INFO - üìá CRM: Got 11 extracted variables
2025-12-29T21:40:00.631389172Z [err]  2025-12-29 21:40:00,625 - server - INFO - üìá CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-29T21:40:00.691828256Z [err]  2025-12-29 21:40:00,686 - persistent_tts_service - INFO - üîá [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] FLOOR RELEASED (is_holding_floor=False)
2025-12-29T21:40:01.347055163Z [err]  2025-12-29 21:40:00,794 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-29T21:40:01.347086996Z [err]  2025-12-29 21:40:00,708 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:40:01.347100054Z [err]  2025-12-29 21:40:00,711 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-29T21:40:01.347108518Z [err]  2025-12-29 21:40:00,733 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:40:01.347118111Z [err]  2025-12-29 21:40:00,734 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-29T21:40:01.347120376Z [err]  2025-12-29 21:40:00,797 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-29T21:40:01.347130749Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:40:01.347166991Z [err]  
2025-12-29T21:40:01.347176187Z [err]    File "/app/backend/server.py", line 9773, in trigger_campaign_qc_for_call
2025-12-29T21:40:01.347190965Z [err]      await run_full_qc_analysis(
2025-12-29T21:40:01.347212654Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-29T21:40:01.347243200Z [err]  2025-12-29 21:40:00,797 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-29T21:40:01.347251663Z [err]  2025-12-29 21:40:00,797 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-29T21:40:01.347258342Z [err]  2025-12-29 21:40:00,797 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:40:01.352569981Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:40:01.352606058Z [err]  2025-12-29 21:40:01,232 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:01.352611967Z [err]  2025-12-29 21:40:01,232 - server - INFO - üì® ================================================
2025-12-29T21:40:01.352619474Z [err]  2025-12-29 21:40:01,232 - server - INFO - üéôÔ∏è Recording saved for call: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:01.352625149Z [err]  2025-12-29 21:40:01,233 - redis_service - WARNING - ‚ö†Ô∏è Call data not found in Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:01.352631811Z [err]  2025-12-29 21:40:01,233 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:40:01.352637173Z [err]  2025-12-29 21:40:01,233 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=dc93e00e-d320-40eb-a320-c921f93e56d5, call_data=False
2025-12-29T21:40:01.352644402Z [err]  2025-12-29 21:40:01,233 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:40:01.352711273Z [err]  2025-12-29 21:40:01,234 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:40:01.352716432Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:40:01.352721946Z [err]  2025-12-29 21:40:01,234 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:01.352739050Z [err]  2025-12-29 21:40:00,802 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-29T21:40:01.352747039Z [err]  2025-12-29 21:40:00,881 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-29T21:40:01.352753175Z [err]  2025-12-29 21:40:00,881 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:40:01.352759878Z [err]  2025-12-29 21:40:00,881 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:01.352766213Z [err]  2025-12-29 21:40:01,057 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:40:01.352772834Z [err]  2025-12-29 21:40:01,058 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:40:01.352779428Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:40:01.352785879Z [err]  2025-12-29 21:40:01,058 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:40:01.352792082Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:40:01.352798194Z [err]  2025-12-29 21:40:01,059 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:01.352804111Z [err]  2025-12-29 21:40:01,232 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:40:01.352809936Z [err]  2025-12-29 21:40:01,232 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '588093bc-4e06-4ced-a141-a46fadd093e5', 'occurred_at': '2025-12-29T21:40:00.933842Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:58.585061Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-29T21:39:58.585061Z', 'recording_id': 'dc93e00e-d320-40eb-a320-c921f93e56d5', 'recording_started_at': '2025-12-29T21:39:46.483958Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/e2a17bca-e4fe-11f0-b723-02420aef96a0-1767044386435343.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T214000Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=ab5f785b8df223a4d7851cc12a4e33b92c3a5486bca5ef5df19c1d80455ae228'}, 'start_time': '2025-12-29T21:39:46.483958Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:40:01.355703623Z [err]  2025-12-29 21:40:01,276 - soniox_service - ERROR - ‚ùå Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-29T21:40:01.355710993Z [err]  2025-12-29 21:40:01,276 - server - INFO - üîå Telnyx WebSocket disconnected
2025-12-29T21:40:01.355716856Z [err]  2025-12-29 21:40:01,326 - server - INFO - üíæ Saved recording URL and ID to database: dc93e00e-d320-40eb-a320-c921f93e56d5
2025-12-29T21:40:01.355723466Z [err]  2025-12-29 21:40:01,326 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-29T21:40:01.355729876Z [err]  2025-12-29 21:40:01,326 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-29T21:40:01.402494470Z [err]  2025-12-29 21:40:01,399 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:40:01.402506776Z [err]  2025-12-29 21:40:01,399 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:40:01.402513940Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:40:01.402520391Z [err]  2025-12-29 21:40:01,399 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:40:01.402526861Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:40:01.493687414Z [err]  2025-12-29 21:40:01,490 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:01.493701104Z [err]  2025-12-29 21:40:01,491 - server - INFO - ‚úÖ QC analysis completed for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:01.493709787Z [err]  2025-12-29 21:40:01,491 - server - INFO - üìä Scores: Commitment=50, Conversion=20, Excellence=50
2025-12-29T21:40:01.632344098Z [err]  2025-12-29 21:40:01,629 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/e2a17bca-e4fe-11f0-b723-02420aef96a0-1767044386435343.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T214000Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=ab5f785b8df223a4d7851cc12a4e33b92c3a5486bca5ef5df19c1d80455ae228 "HTTP/1.1 200 OK"
2025-12-29T21:40:01.675777263Z [err]  2025-12-29 21:40:01,671 - server - INFO - üìä Updated campaign_calls with QC scores for v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:02.347536828Z [err]  2025-12-29 21:40:01,717 - server - INFO - ‚úÖ Downloaded 48526 bytes
2025-12-29T21:40:02.347543353Z [err]  2025-12-29 21:40:01,845 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-29T21:40:02.347550396Z [err]  2025-12-29 21:40:01,907 - server - INFO - ‚úÖ Split into 2 channels
2025-12-29T21:40:02.347557353Z [err]  2025-12-29 21:40:01,907 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-29T21:40:02.347565071Z [err]  2025-12-29 21:40:01,907 - server - INFO - üìä Channel 0: 263164 bytes
2025-12-29T21:40:02.347572701Z [err]  2025-12-29 21:40:01,907 - server - ERROR - ‚ùå No Soniox API key available
2025-12-29T21:40:02.347580682Z [err]  2025-12-29 21:40:01,907 - server - INFO - ‚ùå Channel 0: No speech
2025-12-29T21:40:02.347588038Z [err]  2025-12-29 21:40:01,907 - server - INFO - üìä Channel 1: 263164 bytes
2025-12-29T21:40:02.347595552Z [err]  2025-12-29 21:40:01,907 - server - ERROR - ‚ùå No Soniox API key available
2025-12-29T21:40:02.347602563Z [err]  2025-12-29 21:40:01,907 - server - INFO - ‚ùå Channel 1: No speech
2025-12-29T21:40:02.347610300Z [err]  2025-12-29 21:40:01,907 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-29T21:40:02.347618389Z [inf]  100.64.0.15:30080 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:40:02.347626722Z [err]  2025-12-29 21:40:01,931 - server - INFO - üè∑Ô∏è Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-29T21:40:02.347635051Z [err]  2025-12-29 21:40:01,931 - server - ERROR - ‚ùå Error in auto appointment detection for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw: 'str' object has no attribute 'get'
2025-12-29T21:40:06.250951060Z [err]  2025-12-29 21:40:06,125 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-29T21:40:06.250956051Z [err]  2025-12-29 21:40:06,125 - core_calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-29T21:40:06.250960934Z [err]  2025-12-29 21:40:06,125 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-29T21:40:06.250966680Z [err]  2025-12-29 21:40:06,125 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:06.250971780Z [err]  2025-12-29 21:40:06,125 - telnyx_service - INFO - üîä Speaking text on call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw: Are you still there?...
2025-12-29T21:40:06.250978196Z [err]  2025-12-29 21:40:06,125 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-29T21:40:06.250981119Z [err]  2025-12-29 21:40:06,213 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-29T21:40:06.250987694Z [err]  2025-12-29 21:40:06,213 - server - INFO -    Full data: {'text': 'Are you still there?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-29T21:40:06.250989738Z [err]  2025-12-29 21:40:06,126 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-29T21:40:06.250994952Z [err]  2025-12-29 21:40:06,126 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-29T21:40:06.251000474Z [err]  2025-12-29 21:40:06,126 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-29T21:40:06.251007281Z [err]  2025-12-29 21:40:06,126 - server - INFO - ‚è±Ô∏è [21:40:06.126] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-29T21:40:06.251014122Z [err]  2025-12-29 21:40:06,126 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-29T21:40:06.251020708Z [err]  2025-12-29 21:40:06,126 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-29T21:40:06.251025125Z [err]  2025-12-29 21:40:06,213 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-29T21:40:06.251029608Z [err]  2025-12-29 21:40:06,213 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:40:06.251032164Z [err]  2025-12-29 21:40:06,213 - server - INFO -    Text length: 20 chars
2025-12-29T21:40:06.251036824Z [err]  2025-12-29 21:40:06,213 - server - INFO -    Text content: 'Are you still there?'
2025-12-29T21:40:06.251043160Z [err]  2025-12-29 21:40:06,213 - server - INFO -    Text bytes: b'Are you still there?'
2025-12-29T21:40:06.251047384Z [err]  2025-12-29 21:40:06,213 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-29T21:40:06.251052543Z [err]  2025-12-29 21:40:06,213 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-29T21:40:06.251099328Z [err]  2025-12-29 21:40:06,213 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-29T21:40:06.251107268Z [err]  2025-12-29 21:40:06,213 - server - INFO -    Timeout: 10.0s
2025-12-29T21:40:06.251112304Z [err]  2025-12-29 21:40:06,222 - server - INFO -    ‚úì HTTP client created (0.009s)
2025-12-29T21:40:06.251116388Z [err]  2025-12-29 21:40:06,222 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-29T21:40:06.588952724Z [err]  2025-12-29 21:40:06,586 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-29T21:40:06.588958722Z [err]  2025-12-29 21:40:06,586 - server - INFO -    ‚úì Connection established (0.373s) [TARGET: <200ms]
2025-12-29T21:40:06.588967202Z [err]  2025-12-29 21:40:06,586 - server - INFO -    ‚úì Response status: 200
2025-12-29T21:40:06.588972836Z [err]  2025-12-29 21:40:06,586 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-29T21:40:06.615513732Z [err]  2025-12-29 21:40:06,611 - server - INFO -    ‚úì FIRST CHUNK received (0.398s, 1066 bytes) [TARGET: <300ms]
2025-12-29T21:40:06.619908027Z [err]  2025-12-29 21:40:06,614 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:40:06.619915234Z [err]  2025-12-29 21:40:06,613 - server - INFO -    ‚úì ALL CHUNKS received: 55 chunks (0.400s)
2025-12-29T21:40:06.619920074Z [err]  2025-12-29 21:40:06,615 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:40:06.619931728Z [err]  2025-12-29 21:40:06,614 - server - INFO -    ‚úì Total audio size: 17599 bytes
2025-12-29T21:40:06.619939724Z [err]  2025-12-29 21:40:06,614 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-29T21:40:06.619947110Z [err]  2025-12-29 21:40:06,614 - server - INFO -       - Connection: 373ms
2025-12-29T21:40:06.619957399Z [err]  2025-12-29 21:40:06,614 - server - INFO -       - First chunk: 398ms
2025-12-29T21:40:06.619966092Z [err]  2025-12-29 21:40:06,614 - server - INFO -       - All chunks: 400ms
2025-12-29T21:40:06.619979730Z [err]  2025-12-29 21:40:06,614 - server - INFO -       - Audio generation only: 25ms
2025-12-29T21:40:06.619986699Z [err]  2025-12-29 21:40:06,614 - server - INFO - ‚è±Ô∏è [21:40:06.614] üîä TTS COMPLETE: 488ms, audio_size=17599 bytes
2025-12-29T21:40:06.619993067Z [err]  2025-12-29 21:40:06,614 - server - INFO - üíæ TTS CACHED: elevenlabs:Are you still there?... (17599 bytes)
2025-12-29T21:40:06.620000076Z [err]  2025-12-29 21:40:06,614 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.49s
2025-12-29T21:40:07.282479700Z [err]      {
2025-12-29T21:40:07.282493836Z [err]        "code": "90018",
2025-12-29T21:40:07.282504189Z [err]        "title": "Call has already ended",
2025-12-29T21:40:07.282511751Z [err]  2025-12-29 21:40:06,882 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-29T21:40:07.282515730Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:40:07.282524502Z [err]  2025-12-29 21:40:07,164 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:40:07.282527345Z [err]      }
2025-12-29T21:40:07.282536029Z [err]  2025-12-29 21:40:07,165 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:40:07.282542611Z [err]    ]
2025-12-29T21:40:07.282547047Z [err]  2025-12-29 21:40:07,165 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-29T21:40:07.282557030Z [err]  }
2025-12-29T21:40:07.282587223Z [err]  2025-12-29 21:40:06,881 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:40:07.282594216Z [err]  2025-12-29 21:40:06,881 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.27s
2025-12-29T21:40:07.282600834Z [err]  2025-12-29 21:40:06,881 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-29T21:40:07.282607751Z [err]    "errors": [
2025-12-29T21:40:07.671516211Z [err]  2025-12-29 21:40:07,667 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (7.0s ago), marking agent as done speaking
2025-12-29T21:40:07.671526609Z [err]  2025-12-29 21:40:07,667 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767044407.6674142 for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:07.671533776Z [err]  2025-12-29 21:40:07,667 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:10.253096064Z [err]  2025-12-29 21:40:10,173 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=2.5s, checkin_count=1/2
2025-12-29T21:40:10.679199658Z [err]  2025-12-29 21:40:10,674 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=3.0s, checkin_count=1/2
2025-12-29T21:40:14.689453831Z [err]  2025-12-29 21:40:14,685 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-29T21:40:14.689464959Z [err]  2025-12-29 21:40:14,686 - core_calling_service - INFO - üí¨ Sending FINAL check-in #2/2: Are you still there?
2025-12-29T21:40:14.689473789Z [err]  2025-12-29 21:40:14,686 - core_calling_service - INFO - ‚ö†Ô∏è Will end call if no response after next silence timeout
2025-12-29T21:40:14.689481613Z [err]  2025-12-29 21:40:14,686 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-29T21:40:14.689493827Z [err]  2025-12-29 21:40:14,686 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:14.689501830Z [err]  2025-12-29 21:40:14,686 - telnyx_service - INFO - üîä Speaking text on call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw: Are you still there?...
2025-12-29T21:40:14.689509120Z [err]  2025-12-29 21:40:14,686 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-29T21:40:14.689519020Z [err]  2025-12-29 21:40:14,686 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-29T21:40:14.689526344Z [err]  2025-12-29 21:40:14,686 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-29T21:40:14.689533648Z [err]  2025-12-29 21:40:14,686 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-29T21:40:14.689541652Z [err]  2025-12-29 21:40:14,686 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-29T21:40:14.689548503Z [err]  2025-12-29 21:40:14,686 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-29T21:40:14.692065810Z [err]  2025-12-29 21:40:14,686 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:40:14.692075612Z [err]  2025-12-29 21:40:14,686 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:40:15.268388227Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:40:15.268400081Z [err]      }
2025-12-29T21:40:15.268409786Z [err]    ]
2025-12-29T21:40:15.268415711Z [err]  }
2025-12-29T21:40:15.268421851Z [err]  2025-12-29 21:40:14,966 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-29T21:40:15.268430924Z [err]  2025-12-29 21:40:15,240 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:40:15.268436304Z [err]  2025-12-29 21:40:15,241 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:40:15.268441864Z [err]  2025-12-29 21:40:15,241 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-29T21:40:15.268496436Z [err]  2025-12-29 21:40:14,965 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:40:15.268501112Z [err]  2025-12-29 21:40:14,965 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.28s
2025-12-29T21:40:15.268506070Z [err]  2025-12-29 21:40:14,965 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-29T21:40:15.268511735Z [err]    "errors": [
2025-12-29T21:40:15.268515809Z [err]      {
2025-12-29T21:40:15.268521087Z [err]        "code": "90018",
2025-12-29T21:40:15.268525482Z [err]        "title": "Call has already ended",
2025-12-29T21:40:19.429142507Z [err]  2025-12-29 21:40:18,815 - server - INFO - üé§ Soniox receiver alive - 1 messages received in last 10s
2025-12-29T21:40:19.429149190Z [err]  2025-12-29 21:40:18,815 - server - ERROR - ‚ùå Soniox error: {'tokens': [], 'final_audio_proc_ms': 8040, 'total_audio_proc_ms': 11280, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-29T21:40:19.429154502Z [err]  2025-12-29 21:40:18,815 - server - INFO - ‚úÖ Soniox receive loop ended normally
2025-12-29T21:40:19.429159848Z [err]  2025-12-29 21:40:18,816 - dead_air_monitor - INFO - üîá Dead air monitoring cancelled for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:19.429165263Z [err]  2025-12-29 21:40:18,816 - dead_air_monitor - INFO - üîá Dead air monitoring stopped for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:19.429171617Z [err]  2025-12-29 21:40:18,816 - server - INFO - üîá Dead air monitoring task cancelled