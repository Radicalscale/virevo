2025-12-30T06:24:38.899485506Z [inf]  100.64.0.5:32518 - "GET /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/kb HTTP/1.1" 200
2025-12-30T06:24:39.511875362Z [inf]  100.64.0.5:32520 - "GET /api/qc/enhanced/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/auto-qc-settings HTTP/1.1" 200
2025-12-30T06:24:39.512719966Z [err]  2025-12-30 06:24:39,512 - qc_enhanced_router - INFO - Listed 1 campaigns for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:24:39.513510104Z [inf]  100.64.0.5:32518 - "GET /api/qc/enhanced/campaigns HTTP/1.1" 200
2025-12-30T06:24:42.720286399Z [inf]  100.64.0.4:21892 - "GET /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/flow HTTP/1.1" 200
2025-12-30T06:24:42.720291231Z [inf]  100.64.0.4:21886 - "GET /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb HTTP/1.1" 200
2025-12-30T06:25:52.659453837Z [inf]  100.64.0.5:32518 - "OPTIONS /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/flow HTTP/1.1" 200
2025-12-30T06:25:52.659460161Z [inf]  100.64.0.13:27346 - "PUT /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/flow HTTP/1.1" 200
2025-12-30T06:26:22.817584845Z [inf]  100.64.0.5:32518 - "GET /api/agents HTTP/1.1" 200
2025-12-30T06:26:27.064180883Z [err]  2025-12-30 06:26:27,057 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-30T06:26:27.149686782Z [err]  2025-12-30 06:26:27,144 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:26:27.240357863Z [err]  2025-12-30 06:26:27,232 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:26:27.269738267Z [err]  2025-12-30 06:26:27,265 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:26:27.269745384Z [err]  2025-12-30 06:26:27,265 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-30T06:26:27.269752047Z [err]  2025-12-30 06:26:27,265 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-30T06:26:27.269758448Z [err]  2025-12-30 06:26:27,265 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-30T06:26:27.962910208Z [err]  2025-12-30 06:26:27,960 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-30T06:26:27.962918235Z [err]  2025-12-30 06:26:27,961 - telnyx_service - INFO - ‚úÖ Call initiated: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:28.056799545Z [err]  2025-12-30 06:26:28,052 - server - INFO - üìù Created call log: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:28.056808472Z [err]  2025-12-30 06:26:28,052 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T06:26:28.056812468Z [err]  2025-12-30 06:26:28,052 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-30T06:26:28.057616043Z [err]  2025-12-30 06:26:28,052 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T06:26:28.057626424Z [err]  2025-12-30 06:26:28,052 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T06:26:28.097383631Z [err]  2025-12-30 06:26:28,093 - redis_service - INFO - üì¶ Stored call data in Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA (TTL: 3600s)
2025-12-30T06:26:28.097392184Z [err]  2025-12-30 06:26:28,093 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-30T06:26:28.097397651Z [err]  2025-12-30 06:26:28,093 - server - INFO - üìû Outbound call initiated: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:28.097402506Z [inf]  100.64.0.4:34418 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-30T06:26:28.172273067Z [err]  2025-12-30 06:26:28,164 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:26:28.172282603Z [err]  2025-12-30 06:26:28,165 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': '4eb1250e-37f5-4cb6-a2f9-867af5f87dbd', 'occurred_at': '2025-12-30T06:26:27.769242Z', 'payload': {'call_control_id': 'v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA', 'call_leg_id': '78c63b92-e548-11f0-8f9e-02420aef981f', 'call_session_id': '78c35120-e548-11f0-b542-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:26:28.172289965Z [err]  2025-12-30 06:26:28,165 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:28.172296920Z [err]  2025-12-30 06:26:28,165 - server - INFO - üì® ================================================
2025-12-30T06:26:28.172303790Z [err]  2025-12-30 06:26:28,165 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-30T06:26:28.172312619Z [inf]  100.64.0.12:41108 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:26:28.264751320Z [err]  2025-12-30 06:26:28,253 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-30T06:26:28.264766071Z [err]  2025-12-30 06:26:28,253 - server - INFO -    Client: Address(host='100.64.0.7', port=27552)
2025-12-30T06:26:28.264782156Z [err]  2025-12-30 06:26:28,253 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'g7Xj5LAn9+me3OJkY+FFEA==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'XRaOvShIQhuVMGptLPU1MQ', 'x-real-ip': '192.76.120.151', 'x-request-start': '1767075988023', 'accept-encoding': 'gzip'}
2025-12-30T06:26:28.264790058Z [err]  2025-12-30 06:26:28,253 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-30T06:26:28.264798593Z [err]  2025-12-30 06:26:28,253 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-30T06:26:28.264806346Z [err]  [2025-12-30 06:26:28 +0000] [5] [INFO] ('100.64.0.7', 27552) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-30T06:26:28.264816202Z [err]  2025-12-30 06:26:28,253 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-30T06:26:28.264839909Z [err]  [2025-12-30 06:26:28 +0000] [5] [INFO] connection open
2025-12-30T06:26:28.420511343Z [err]  2025-12-30 06:26:28,415 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-30T06:26:28.420517920Z [err]  2025-12-30 06:26:28,415 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-30T06:26:28.624876841Z [err]  2025-12-30 06:26:28,624 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T06:26:28.626259403Z [err]  2025-12-30 06:26:28,625 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-30T06:26:31.656879208Z [err]  2025-12-30 06:26:31,633 - server - INFO - üì¨ Received Telnyx event: start
2025-12-30T06:26:31.656885591Z [err]  2025-12-30 06:26:31,633 - server - INFO - üé¨ Stream started for call: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:31.667647147Z [err]  2025-12-30 06:26:31,662 - redis_service - INFO - üì• Retrieved call data from Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:31.667653214Z [err]  2025-12-30 06:26:31,665 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-30T06:26:31.667657674Z [err]  2025-12-30 06:26:31,665 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-30T06:26:31.872216045Z [err]  2025-12-30 06:26:31,811 - server - INFO - ‚úÖ Call answered: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:31.872228943Z [err]  2025-12-30 06:26:31,818 - redis_service - INFO - üì• Retrieved call data from Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:31.872235956Z [err]  2025-12-30 06:26:31,820 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-30T06:26:31.872242648Z [err]  2025-12-30 06:26:31,820 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-30T06:26:31.872276283Z [err]  2025-12-30 06:26:31,810 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:26:31.872283616Z [err]  2025-12-30 06:26:31,810 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': 'd2cd1a77-70c4-4906-9d0c-f2e89714059e', 'occurred_at': '2025-12-30T06:26:31.349216Z', 'payload': {'call_control_id': 'v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA', 'call_leg_id': '78c63b92-e548-11f0-8f9e-02420aef981f', 'call_session_id': '78c35120-e548-11f0-b542-02420aef981f', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-30T06:26:27.769242Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:26:31.872291262Z [err]  2025-12-30 06:26:31,810 - server - INFO - üéØ Event type: call.answered, Call ID: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:31.872298491Z [err]  2025-12-30 06:26:31,810 - server - INFO - üì® ================================================
2025-12-30T06:26:31.917916864Z [err]  2025-12-30 06:26:31,914 - server - INFO - ‚úÖ Call log updated
2025-12-30T06:26:31.917921914Z [err]  2025-12-30 06:26:31,914 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T06:26:31.917926280Z [err]  2025-12-30 06:26:31,914 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T06:26:31.917930001Z [err]  2025-12-30 06:26:31,914 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:26:32.004669770Z [err]  2025-12-30 06:26:32,002 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:26:32.097483290Z [err]  2025-12-30 06:26:32,089 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:26:32.097499421Z [err]  2025-12-30 06:26:32,089 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-30T06:26:32.125175089Z [err]  2025-12-30 06:26:32,116 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:26:32.168813908Z [err]  2025-12-30 06:26:32,165 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-30T06:26:32.168819498Z [err]  2025-12-30 06:26:32,165 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-30T06:26:32.174133273Z [err]  2025-12-30 06:26:32,173 - redis_service - INFO - üì• Retrieved call data from Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:32.175067500Z [err]  2025-12-30 06:26:32,174 - server - INFO - üìù Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:26:32.175075181Z [err]  2025-12-30 06:26:32,174 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-30T06:26:32.252367051Z [err]  2025-12-30 06:26:32,247 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:26:32.252379721Z [err]  2025-12-30 06:26:32,247 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': 'e206e307-c28f-4a21-b0e3-0a2acae341a1', 'occurred_at': '2025-12-30T06:26:31.869213Z', 'payload': {'call_control_id': 'v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA', 'call_leg_id': '78c63b92-e548-11f0-8f9e-02420aef981f', 'call_session_id': '78c35120-e548-11f0-b542-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '5c17f660-c239-4674-a8b9-2a152b6b2249', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:26:32.252388046Z [err]  2025-12-30 06:26:32,247 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:32.252395158Z [err]  2025-12-30 06:26:32,247 - server - INFO - üì® ================================================
2025-12-30T06:26:32.252403840Z [inf]  100.64.0.10:23350 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:26:32.265376154Z [err]  2025-12-30 06:26:32,262 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-30T06:26:32.265382329Z [err]  2025-12-30 06:26:32,262 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-30T06:26:32.265387257Z [err]  2025-12-30 06:26:32,262 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-30T06:26:32.265391467Z [err]  2025-12-30 06:26:32,262 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-30T06:26:32.265396413Z [err]  2025-12-30 06:26:32,262 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-30T06:26:32.310896912Z [err]  2025-12-30 06:26:32,300 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T06:26:32.310906814Z [err]  2025-12-30 06:26:32,301 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-30T06:26:32.363471538Z [err]  2025-12-30 06:26:32,358 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-30T06:26:32.363475946Z [err]  2025-12-30 06:26:32,350 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:26:32.363482390Z [err]  2025-12-30 06:26:32,357 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 94ms
2025-12-30T06:26:32.363488196Z [err]  2025-12-30 06:26:32,357 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-30T06:26:32.363494878Z [err]  2025-12-30 06:26:32,357 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-30T06:26:32.363501642Z [err]  2025-12-30 06:26:32,357 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-30T06:26:32.363507423Z [err]  2025-12-30 06:26:32,357 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-30T06:26:32.363513702Z [err]  2025-12-30 06:26:32,357 - server - INFO - ‚úÖ Initialized call_states for v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA with session reference
2025-12-30T06:26:32.363519997Z [err]  2025-12-30 06:26:32,357 - server - INFO - ‚úÖ Stored Telnyx WebSocket in call_data for audio streaming
2025-12-30T06:26:32.363526818Z [err]  2025-12-30 06:26:32,357 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found to update for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:32.407917621Z [err]  2025-12-30 06:26:32,407 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-30T06:26:32.408818162Z [err]  2025-12-30 06:26:32,407 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: f7l0J3Jvmg (loop=True, overlay=True)
2025-12-30T06:26:32.408867906Z [err]  2025-12-30 06:26:32,407 - server - INFO - üéµ Comfort noise started as continuous background overlay (playback_id: f7l0J3Jvmg)
2025-12-30T06:26:32.408876658Z [err]  2025-12-30 06:26:32,407 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:32.715202099Z [err]  2025-12-30 06:26:32,711 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:26:32.715210970Z [err]  2025-12-30 06:26:32,711 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '7d996384-fe71-456d-a9da-ee5f34160def', 'occurred_at': '2025-12-30T06:26:32.509211Z', 'payload': {'call_control_id': 'v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA', 'call_leg_id': '78c63b92-e548-11f0-8f9e-02420aef981f', 'call_session_id': '78c35120-e548-11f0-b542-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'f7l0J3Jvmg', 'start_time': '2025-12-30T06:26:32.509211Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:26:32.715216939Z [err]  2025-12-30 06:26:32,711 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:32.715222523Z [err]  2025-12-30 06:26:32,711 - server - INFO - üì® ================================================
2025-12-30T06:26:32.715227765Z [inf]  100.64.0.10:23350 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:26:33.986941444Z [err]  2025-12-30 06:26:33,983 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA/actions/record_start "HTTP/1.1 200 OK"
2025-12-30T06:26:33.986947919Z [err]  2025-12-30 06:26:33,983 - server - INFO - üéôÔ∏è Call recording started for v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:33.986952371Z [err]  2025-12-30 06:26:33,984 - server - INFO - üîß Creating call session for v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA...
2025-12-30T06:26:33.986956577Z [err]  2025-12-30 06:26:33,984 - server - INFO - üîç Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:26:33.986962401Z [err]  2025-12-30 06:26:33,984 - server - INFO - üîß Calling create_call_session() - START
2025-12-30T06:26:33.986966080Z [err]  2025-12-30 06:26:33,984 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-30T06:26:33.986970860Z [err]  2025-12-30 06:26:33,985 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-30T06:26:34.074571690Z [err]  2025-12-30 06:26:34,072 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-30T06:26:34.074581232Z [err]  2025-12-30 06:26:34,072 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-30T06:26:34.074587579Z [err]  2025-12-30 06:26:34,072 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-30T06:26:34.074597295Z [err]  2025-12-30 06:26:34,072 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-30T06:26:34.074604145Z [err]  2025-12-30 06:26:34,072 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-30T06:26:34.161025965Z [err]  2025-12-30 06:26:34,159 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:26:34.172929725Z [err]  2025-12-30 06:26:34,168 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 95ms
2025-12-30T06:26:34.172940070Z [err]  2025-12-30 06:26:34,168 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-30T06:26:34.172949047Z [err]  2025-12-30 06:26:34,168 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-30T06:26:34.213919818Z [err]  2025-12-30 06:26:34,204 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-30T06:26:34.213919821Z [err]  2025-12-30 06:26:34,197 - redis_service - INFO - üì¶ Stored call data in Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA (TTL: 3600s)
2025-12-30T06:26:34.213929526Z [err]  2025-12-30 06:26:34,204 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-30T06:26:34.213929962Z [err]  2025-12-30 06:26:34,197 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-30T06:26:34.213936530Z [err]  2025-12-30 06:26:34,198 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-30T06:26:34.213945241Z [err]  2025-12-30 06:26:34,203 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:34.213952064Z [err]  2025-12-30 06:26:34,203 - server - INFO - ü§ñ AI session created for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:34.213958848Z [err]  2025-12-30 06:26:34,203 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-30T06:26:34.213965140Z [err]  2025-12-30 06:26:34,204 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-30T06:26:34.213971853Z [err]  2025-12-30 06:26:34,204 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-30T06:26:34.213978918Z [err]  2025-12-30 06:26:34,204 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-30T06:26:34.213985852Z [err]  2025-12-30 06:26:34,204 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-30T06:26:34.236154142Z [err]  2025-12-30 06:26:34,232 - redis_service - INFO - üì• Retrieved call data from Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:34.236168335Z [err]  2025-12-30 06:26:34,233 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-30T06:26:34.236175725Z [err]  2025-12-30 06:26:34,233 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-30T06:26:34.236180437Z [inf]  100.64.0.9:22522 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:26:34.374904012Z [err]  2025-12-30 06:26:34,367 - redis_service - INFO - üì• Retrieved call data from Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:34.379902855Z [err]  2025-12-30 06:26:34,375 - redis_service - INFO - üì• Retrieved call data from Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:34.392003964Z [err]  2025-12-30 06:26:34,389 - redis_service - INFO - üì¶ Stored call data in Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA (TTL: 3600s)
2025-12-30T06:26:34.392011837Z [err]  2025-12-30 06:26:34,389 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-30T06:26:34.392022840Z [err]  2025-12-30 06:26:34,389 - core_calling_service - INFO - ‚è±Ô∏è [06:26:34.389] üì• process_user_input() ENTRY - text: '...'
2025-12-30T06:26:34.404948292Z [err]  2025-12-30 06:26:34,398 - redis_service - INFO - üì• Retrieved call data from Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:34.404956348Z [err]  2025-12-30 06:26:34,400 - core_calling_service - INFO - ‚è±Ô∏è [06:26:34.400] ‚è© About to call _process_call_flow_streaming()
2025-12-30T06:26:34.404963502Z [err]  2025-12-30 06:26:34,400 - core_calling_service - INFO - ‚è±Ô∏è [06:26:34.400] üîÄ Agent type: call_flow, calling flow processor...
2025-12-30T06:26:34.404970425Z [err]  2025-12-30 06:26:34,400 - core_calling_service - INFO - ‚è±Ô∏è [06:26:34.400] üîÄ _process_call_flow_streaming() ENTRY
2025-12-30T06:26:34.404977073Z [err]  2025-12-30 06:26:34,400 - core_calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-30T06:26:34.404983954Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - ‚è±Ô∏è [06:26:34.400] ‚úÖ Node selected, about to process content...
2025-12-30T06:26:34.404991148Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - üîß Replaced {{now}} with Tuesday, December 30, 2025 at 1:26 AM EST in content
2025-12-30T06:26:34.404998814Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-30T06:26:34.405005796Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-30T06:26:34.405012573Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-30T06:26:34.405021029Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-30T06:26:34.405028193Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-30T06:26:34.405035466Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-30T06:26:34.405549075Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-30T06:26:34.405560112Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-30T06:26:34.405564680Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-30T06:26:34.405569243Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-30T06:26:34.405573023Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-30T06:26:34.405576751Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-30T06:26:34.405580436Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - ‚è±Ô∏è [06:26:34.401] üìÑ About to process content (mode=script, length=9)
2025-12-30T06:26:34.405584184Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - üîä Silence tracking reset for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA (user responded)
2025-12-30T06:26:34.405588602Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-30T06:26:34.405592291Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-30T06:26:34.405597216Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - LLM response (0.01s): Kendrick?
2025-12-30T06:26:34.405600699Z [err]  2025-12-30 06:26:34,401 - core_calling_service - INFO - Total latency: 0.01s
2025-12-30T06:26:34.405604389Z [err]  2025-12-30 06:26:34,401 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-30T06:26:34.485436375Z [err]  2025-12-30 06:26:34,472 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-30T06:26:34.485440799Z [err]  2025-12-30 06:26:34,472 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-30T06:26:34.485445118Z [err]  2025-12-30 06:26:34,473 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-30T06:26:34.485449103Z [err]  2025-12-30 06:26:34,473 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:34.485453763Z [err]  2025-12-30 06:26:34,479 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:34.485457784Z [err]  2025-12-30 06:26:34,479 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-30T06:26:34.508322647Z [err]  2025-12-30 06:26:34,505 - telnyx_service - INFO - ‚úÖ Generated 13419 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-30T06:26:34.508325423Z [err]  2025-12-30 06:26:34,503 - redis_service - INFO - üì• Retrieved call data from Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:34.508332003Z [err]  2025-12-30 06:26:34,505 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-30T06:26:34.508334862Z [err]  2025-12-30 06:26:34,504 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T06:26:34.508346517Z [err]  2025-12-30 06:26:34,504 - telnyx_service - INFO - üîä Speaking text on call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA: Kendrick?...
2025-12-30T06:26:34.508348224Z [err]  2025-12-30 06:26:34,504 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T06:26:34.508358872Z [err]  2025-12-30 06:26:34,504 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (13419 bytes)
2025-12-30T06:26:34.508364172Z [err]  2025-12-30 06:26:34,504 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T06:26:34.508367962Z [err]  2025-12-30 06:26:34,504 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-30T06:26:34.508379636Z [err]  2025-12-30 06:26:34,504 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T06:26:34.963972638Z [err]  2025-12-30 06:26:34,805 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-30T06:26:34.963977098Z [err]  2025-12-30 06:26:34,805 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.30s
2025-12-30T06:26:34.963981922Z [err]  2025-12-30 06:26:34,805 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 0.30s
2025-12-30T06:26:34.963985827Z [err]  2025-12-30 06:26:34,805 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-30T06:26:34.963989847Z [err]  2025-12-30 06:26:34,805 - telnyx_service - INFO - üé¨ Playback ID: avi07w_CcA
2025-12-30T06:26:34.963994172Z [err]  2025-12-30 06:26:34,805 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-30T06:26:34.963998349Z [err]  2025-12-30 06:26:34,805 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Greeting playback started at 1767075994.8058412
2025-12-30T06:26:34.964002744Z [err]  2025-12-30 06:26:34,805 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767075994.8058727 for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:34.964007452Z [err]  2025-12-30 06:26:34,805 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-30T06:26:34.987315282Z [err]  2025-12-30 06:26:34,985 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:35.449517977Z [err]  2025-12-30 06:26:35,443 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:26:35.449525600Z [err]  2025-12-30 06:26:35,443 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '8d9c25f6-fc61-4081-84ed-9fabcdc23205', 'occurred_at': '2025-12-30T06:26:35.089214Z', 'payload': {'call_control_id': 'v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA', 'call_leg_id': '78c63b92-e548-11f0-8f9e-02420aef981f', 'call_session_id': '78c35120-e548-11f0-b542-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'avi07w_CcA'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:26:35.449533128Z [err]  2025-12-30 06:26:35,443 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:35.449540685Z [err]  2025-12-30 06:26:35,443 - server - INFO - üì® ================================================
2025-12-30T06:26:35.449547456Z [inf]  100.64.0.12:41114 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:26:35.492882739Z [err]  2025-12-30 06:26:35,490 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:35.998416038Z [err]  2025-12-30 06:26:35,997 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:36.171223179Z [err]  2025-12-30 06:26:36,133 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:26:36.171234756Z [err]  2025-12-30 06:26:36,133 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '2082195d-e99e-498b-9763-5874b32a8ab2', 'occurred_at': '2025-12-30T06:26:35.929215Z', 'payload': {'call_control_id': 'v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA', 'call_leg_id': '78c63b92-e548-11f0-8f9e-02420aef981f', 'call_session_id': '78c35120-e548-11f0-b542-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'avi07w_CcA', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:26:36.171245491Z [err]  2025-12-30 06:26:36,133 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:36.171256434Z [err]  2025-12-30 06:26:36,134 - server - INFO - üì® ================================================
2025-12-30T06:26:36.171266838Z [err]  2025-12-30 06:26:36,151 - redis_service - INFO - ‚ûñ Removed playback avi07w_CcA, 0 remaining for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:36.171275771Z [err]  2025-12-30 06:26:36,151 - server - INFO - üîä Redis: Removed playback avi07w_CcA, 0 remaining
2025-12-30T06:26:36.171285244Z [err]  2025-12-30 06:26:36,151 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-30T06:26:36.171295169Z [err]  2025-12-30 06:26:36,156 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-30T06:26:36.171305715Z [err]  2025-12-30 06:26:36,156 - server - INFO - üí° Session not on this worker - Redis flag set for WebSocket worker to handle
2025-12-30T06:26:36.171828545Z [inf]  100.64.0.12:41114 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:26:36.512427598Z [err]  2025-12-30 06:26:36,503 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:37.014664382Z [err]  2025-12-30 06:26:37,009 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:37.083729678Z [err]  2025-12-30 06:26:37,065 - server - INFO - üî§ RAW TOKENS: ["Hell"?]
2025-12-30T06:26:37.083737437Z [err]  2025-12-30 06:26:37,066 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user started speaking) for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:37.083744405Z [err]  2025-12-30 06:26:37,066 - core_calling_service - INFO - üîä Silence timer reset for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA (user started speaking)
2025-12-30T06:26:37.083761551Z [err]  2025-12-30 06:26:37,066 - core_calling_service - INFO - üë§ User started speaking for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:37.083768729Z [err]  2025-12-30 06:26:37,066 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-30T06:26:37.083776447Z [err]  2025-12-30 06:26:37,066 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Hell' | Generating: False
2025-12-30T06:26:37.327434875Z [err]  2025-12-30 06:26:37,326 - server - INFO - üî§ RAW TOKENS: ["Hell"‚úì, "o."‚úì, "<end>"‚úì]
2025-12-30T06:26:37.327448826Z [err]  2025-12-30 06:26:37,326 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-30T06:26:37.328454584Z [err]  2025-12-30 06:26:37,327 - server - INFO - ‚è±Ô∏è [06:26:37.327] üìù FINAL TRANSCRIPT RECEIVED: 'Hell o.'
2025-12-30T06:26:37.328465024Z [err]  2025-12-30 06:26:37,327 - server - INFO - ‚è±Ô∏è [06:26:37.327] STT endpoint detection latency: 20ms
2025-12-30T06:26:37.328465376Z [err]  2025-12-30 06:26:37,326 - server - INFO - üì• FINAL TOKENS: 'Hell o.' (2 tokens)
2025-12-30T06:26:37.328474302Z [err]  2025-12-30 06:26:37,327 - server - INFO - üé§ Soniox final transcript: 'Hell o.'
2025-12-30T06:26:37.328476085Z [err]  2025-12-30 06:26:37,327 - server - INFO - ‚è±Ô∏è [06:26:37.327] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-30T06:26:37.328479702Z [err]  2025-12-30 06:26:37,327 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:37.328484477Z [err]  2025-12-30 06:26:37,327 - server - INFO - ‚è±Ô∏è User spoke at 1767075997.3275442
2025-12-30T06:26:37.328486446Z [err]  2025-12-30 06:26:37,327 - server - INFO - üîç FILTER CHECK: words=2, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-30T06:26:37.328491515Z [err]  2025-12-30 06:26:37,327 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:37.328496858Z [err]  2025-12-30 06:26:37,327 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-30T06:26:37.334773048Z [err]  2025-12-30 06:26:37,333 - redis_service - INFO - üì¶ Stored call data in Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA (TTL: 3600s)
2025-12-30T06:26:37.334780198Z [err]  2025-12-30 06:26:37,333 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-30T06:26:37.334787936Z [err]  2025-12-30 06:26:37,333 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:37.334794781Z [err]  2025-12-30 06:26:37,333 - server - INFO - ‚úÖ Agent SILENT - User said 2 word(s): 'Hell o.' - Processing...
2025-12-30T06:26:37.347114294Z [err]  2025-12-30 06:26:37,344 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:37.347120003Z [err]  2025-12-30 06:26:37,343 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Hell o.
2025-12-30T06:26:37.347129951Z [err]  2025-12-30 06:26:37,344 - core_calling_service - INFO - üë§ User stopped speaking for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:37.347136357Z [err]  2025-12-30 06:26:37,344 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-30T06:26:37.347142817Z [err]  2025-12-30 06:26:37,344 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+10ms
2025-12-30T06:26:37.347148728Z [err]  2025-12-30 06:26:37,344 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 10ms (Soniox model: stt-rt-v3)
2025-12-30T06:26:37.347158392Z [err]  2025-12-30 06:26:37,344 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-30T06:26:37.347164572Z [err]  2025-12-30 06:26:37,344 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-30T06:26:37.472648493Z [err]  2025-12-30 06:26:37,469 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:26:37.472660626Z [err]  2025-12-30 06:26:37,469 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:37.472681450Z [err]  2025-12-30 06:26:37,438 - server - INFO - üìù Saved user transcript to database
2025-12-30T06:26:37.472686855Z [err]  2025-12-30 06:26:37,438 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:37.472692477Z [err]  2025-12-30 06:26:37,438 - core_calling_service - INFO - ‚è±Ô∏è [06:26:37.438] üì• process_user_input() ENTRY - text: 'Hell o....'
2025-12-30T06:26:37.472698303Z [err]  2025-12-30 06:26:37,444 - redis_service - INFO - üì• Retrieved call data from Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:37.472704166Z [err]  2025-12-30 06:26:37,444 - core_calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA: User spoke while Silence Greeting was triggering
2025-12-30T06:26:37.520892485Z [err]  2025-12-30 06:26:37,515 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-30T06:26:37.520905571Z [err]  2025-12-30 06:26:37,516 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767075997.5160131 for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:37.520914940Z [err]  2025-12-30 06:26:37,516 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:37.526312972Z [err]  2025-12-30 06:26:37,521 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:38.030137183Z [err]  2025-12-30 06:26:37,913 - core_calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-30T06:26:38.030149310Z [err]  2025-12-30 06:26:37,914 - core_calling_service - INFO - ‚è±Ô∏è [06:26:37.914] ‚è© About to call _process_call_flow_streaming()
2025-12-30T06:26:38.030160801Z [err]  2025-12-30 06:26:37,914 - core_calling_service - INFO - ‚è±Ô∏è [06:26:37.914] üîÄ Agent type: call_flow, calling flow processor...
2025-12-30T06:26:38.030172262Z [err]  2025-12-30 06:26:37,914 - core_calling_service - INFO - ‚è±Ô∏è [06:26:37.914] üîÄ _process_call_flow_streaming() ENTRY
2025-12-30T06:26:38.030181853Z [err]  2025-12-30 06:26:37,901 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA/actions/playback_stop "HTTP/1.1 200 OK"
2025-12-30T06:26:38.030183585Z [err]  2025-12-30 06:26:37,914 - core_calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-30T06:26:38.030191465Z [err]  2025-12-30 06:26:37,902 - telnyx_service - INFO - ‚úÖ Successfully stopped audio playback
2025-12-30T06:26:38.030196148Z [err]  2025-12-30 06:26:37,914 - core_calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-30T06:26:38.030201243Z [err]  2025-12-30 06:26:37,902 - core_calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-30T06:26:38.030210631Z [err]  2025-12-30 06:26:37,902 - core_calling_service - INFO - ‚úÖ BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-30T06:26:38.030210641Z [err]  2025-12-30 06:26:37,914 - core_calling_service - INFO - ‚è±Ô∏è [06:26:37.914] üîÄ About to call _follow_transition() for: Hell o....
2025-12-30T06:26:38.030217309Z [err]  2025-12-30 06:26:37,908 - redis_service - INFO - üì• Retrieved call data from Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:38.030221730Z [err]  2025-12-30 06:26:37,913 - redis_service - INFO - üì¶ Stored call data in Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA (TTL: 3600s)
2025-12-30T06:26:38.033483448Z [err]  2025-12-30 06:26:37,914 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Hell o.
2025-12-30T06:26:38.033491341Z [err]  2025-12-30 06:26:37,914 - core_calling_service - INFO - üîç Checking 'Hello=Yes' override [DEPLOYMENT VERIFIED] for msg='hell o' on node='Greeting'
2025-12-30T06:26:38.033497406Z [err]  2025-12-30 06:26:37,914 - core_calling_service - WARNING - ‚ö†Ô∏è Auto-transition after response target not found: None, falling back to normal evaluation
2025-12-30T06:26:38.033502841Z [err]  2025-12-30 06:26:37,921 - core_calling_service - INFO - ‚è±Ô∏è [06:26:37.921] üîÄ TRANSITION EVALUATION START - Calling LLM for 2 options
2025-12-30T06:26:38.033508814Z [err]  2025-12-30 06:26:37,947 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:26:38.033514334Z [err]  2025-12-30 06:26:37,947 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': 'e411419b-5b26-4289-b4e0-2b7f82be5a6f', 'occurred_at': '2025-12-30T06:26:37.549210Z', 'payload': {'call_control_id': 'v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA', 'call_leg_id': '78c63b92-e548-11f0-8f9e-02420aef981f', 'call_session_id': '78c35120-e548-11f0-b542-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:26:38.033520655Z [err]  2025-12-30 06:26:37,947 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:38.033525959Z [err]  2025-12-30 06:26:37,947 - server - INFO - üì® ================================================
2025-12-30T06:26:38.033531787Z [inf]  100.64.0.17:14366 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:26:38.033537589Z [err]  2025-12-30 06:26:38,027 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:38.452343130Z [err]  2025-12-30 06:26:38,448 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-30T06:26:38.452350977Z [err]  2025-12-30 06:26:38,449 - core_calling_service - INFO - ‚è±Ô∏è [06:26:38.449] üîÄ TRANSITION EVALUATION COMPLETE - took 527ms
2025-12-30T06:26:38.452356108Z [err]  2025-12-30 06:26:38,449 - core_calling_service - INFO - ü§ñ AI transition decision: '-1'
2025-12-30T06:26:38.452360897Z [err]  2025-12-30 06:26:38,449 - core_calling_service - INFO - üìä Available transitions: ['Confirms name (Yes|Speaking|This is he/she) OR Ask...', 'Wrong number (No John here|Wrong number|etc) - don...']
2025-12-30T06:26:38.452366344Z [err]  2025-12-30 06:26:38,449 - core_calling_service - INFO - Selected transition index: -1
2025-12-30T06:26:38.452371442Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - No specific condition matched, looking for default transition...
2025-12-30T06:26:38.452375999Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - ‚ö†Ô∏è No transition matched, but node has GOAL. Staying on current node to continue with goal-based guidance.
2025-12-30T06:26:38.452380514Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - üéØ Goal: Say the customer's name...
2025-12-30T06:26:38.452396982Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 535ms
2025-12-30T06:26:38.452401926Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - ‚è±Ô∏è [06:26:38.450] ‚úÖ Node selected, about to process content...
2025-12-30T06:26:38.452407951Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - üîß Replaced {{now}} with Tuesday, December 30, 2025 at 1:26 AM EST in content
2025-12-30T06:26:38.452412952Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-30T06:26:38.452417849Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-30T06:26:38.453319634Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-30T06:26:38.453328923Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-30T06:26:38.453336990Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-30T06:26:38.453345534Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-30T06:26:38.453352917Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-30T06:26:38.453360087Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-30T06:26:38.453367281Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-30T06:26:38.453374450Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-30T06:26:38.453385072Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-30T06:26:38.453391834Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-30T06:26:38.453397787Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - ‚è±Ô∏è [06:26:38.450] üìÑ About to process content (mode=script, length=9)
2025-12-30T06:26:38.453404067Z [err]  2025-12-30 06:26:38,450 - core_calling_service - INFO - üîÑ Dynamic rephrase enabled - generating natural variation of script
2025-12-30T06:26:38.453411854Z [err]  2025-12-30 06:26:38,451 - core_calling_service - ERROR - Error generating rephrased script: No module named 'api_key_service'
2025-12-30T06:26:38.454357645Z [err]  2025-12-30 06:26:38,451 - server - INFO - üì§ Sentence arrived from LLM: Let me say that again - Kendrick?...
2025-12-30T06:26:38.454363404Z [err]  2025-12-30 06:26:38,451 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 1107ms
2025-12-30T06:26:38.454367745Z [err]  2025-12-30 06:26:38,451 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-30T06:26:38.454372557Z [err]  2025-12-30 06:26:38,451 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:38.454376335Z [err]  2025-12-30 06:26:38,451 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-30T06:26:38.548545961Z [err]  2025-12-30 06:26:38,533 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:38.548557520Z [err]  2025-12-30 06:26:38,539 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:26:38.629831093Z [err]  2025-12-30 06:26:38,627 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:26:38.718818795Z [err]  2025-12-30 06:26:38,714 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:26:38.739806139Z [err]  2025-12-30 06:26:38,738 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:26:38.739818021Z [err]  2025-12-30 06:26:38,738 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-30T06:26:38.739825313Z [err]  2025-12-30 06:26:38,738 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-30T06:26:38.739832969Z [err]  2025-12-30 06:26:38,738 - persistent_tts_service - INFO - üîå [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Establishing persistent TTS WebSocket...
2025-12-30T06:26:38.739839534Z [err]  2025-12-30 06:26:38,738 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-30T06:26:38.739846576Z [err]  2025-12-30 06:26:38,738 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-30T06:26:38.739852757Z [err]  2025-12-30 06:26:38,738 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-30T06:26:38.874528495Z [err]  2025-12-30 06:26:38,868 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-30T06:26:38.874535758Z [err]  2025-12-30 06:26:38,868 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-30T06:26:38.874541330Z [err]  2025-12-30 06:26:38,868 - persistent_tts_service - INFO - ‚úÖ [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Persistent TTS WebSocket established
2025-12-30T06:26:38.874545555Z [err]  2025-12-30 06:26:38,868 - persistent_tts_service - INFO - üéß [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Audio receiver loop started
2025-12-30T06:26:38.874550067Z [err]  2025-12-30 06:26:38,868 - persistent_tts_service - INFO - üîä [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Comfort noise loop started
2025-12-30T06:26:38.874554417Z [err]  2025-12-30 06:26:38,868 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:38.874558667Z [err]  2025-12-30 06:26:38,868 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-30T06:26:38.874562480Z [err]  2025-12-30 06:26:38,868 - server - INFO - üîç Persistent TTS lookup: call_id=v3:OK2b1rFz5bxZX81es..., session=FOUND
2025-12-30T06:26:38.874566420Z [err]  2025-12-30 06:26:38,868 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-30T06:26:38.874573860Z [err]  2025-12-30 06:26:38,868 - server - INFO - üéµ TTS task #1 started at +417ms
2025-12-30T06:26:38.874577951Z [err]  2025-12-30 06:26:38,868 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 1524ms
2025-12-30T06:26:38.874584637Z [err]  2025-12-30 06:26:38,868 - core_calling_service - INFO - üîÑ Rephrased script: Let me say that again - Kendrick?...
2025-12-30T06:26:38.874588518Z [err]  2025-12-30 06:26:38,868 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user gave meaningful response) for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:38.875482359Z [err]  2025-12-30 06:26:38,871 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-30T06:26:38.875489245Z [err]  2025-12-30 06:26:38,871 - server - INFO -    1 sentences queued and playing seamlessly
2025-12-30T06:26:38.875494161Z [err]  2025-12-30 06:26:38,868 - core_calling_service - INFO - üîä Silence tracking reset for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA (user responded)
2025-12-30T06:26:38.875494667Z [err]  2025-12-30 06:26:38,871 - persistent_tts_service - INFO - üéµ [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Playback consumer started
2025-12-30T06:26:38.875499685Z [err]  2025-12-30 06:26:38,871 - persistent_tts_service - INFO - üéß [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Audio Receiver Loop STARTED
2025-12-30T06:26:38.875505725Z [err]  2025-12-30 06:26:38,871 - persistent_tts_service - INFO - üíì [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Starting TTS keep-alive loop (every 15s)
2025-12-30T06:26:38.875506977Z [err]  2025-12-30 06:26:38,869 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-30T06:26:38.875514855Z [err]  2025-12-30 06:26:38,871 - persistent_tts_service - INFO - üîä [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Starting comfort noise loop
2025-12-30T06:26:38.875517035Z [err]  2025-12-30 06:26:38,869 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-30T06:26:38.875523909Z [err]  2025-12-30 06:26:38,869 - core_calling_service - INFO - LLM response (1.43s): Let me say that again - Kendrick?
2025-12-30T06:26:38.875586465Z [err]  2025-12-30 06:26:38,869 - core_calling_service - INFO - Total latency: 1.43s
2025-12-30T06:26:38.875594970Z [err]  2025-12-30 06:26:38,870 - server - INFO - ‚úÖ LLM finished in 1526ms, TTS tasks already running in background
2025-12-30T06:26:38.875599533Z [err]  2025-12-30 06:26:38,870 - server - INFO - üéµ Streaming 1 TTS chunks as they complete...
2025-12-30T06:26:38.876546966Z [err]  2025-12-30 06:26:38,871 - persistent_tts_service - INFO - üé§ [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Streaming sentence #1: Let me say that again - Kendrick?...
2025-12-30T06:26:38.876550926Z [err]  2025-12-30 06:26:38,871 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-30T06:26:38.876559096Z [err]  2025-12-30 06:26:38,871 - persistent_tts_service - INFO - üöÄ [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-30T06:26:38.876567888Z [err]  2025-12-30 06:26:38,872 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T06:26:38.876570458Z [err]  2025-12-30 06:26:38,871 - persistent_tts_service - INFO - üìä [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-30T06:26:38.876584910Z [err]  2025-12-30 06:26:38,871 - persistent_tts_service - INFO - üéß [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Receiver processing sentence #1: 'Let me say that again - Kendri...'
2025-12-30T06:26:38.876593563Z [err]  2025-12-30 06:26:38,871 - persistent_tts_service - INFO - üìä [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] DIAGNOSTIC: queue_latency=0ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-30T06:26:38.876601599Z [err]  2025-12-30 06:26:38,871 - server - INFO - ‚úÖ All 1 persistent TTS streams completed
2025-12-30T06:26:38.876609538Z [err]  2025-12-30 06:26:38,871 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-30T06:26:38.876617257Z [err]  2025-12-30 06:26:38,871 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 1527ms from user stop üöÄ
2025-12-30T06:26:38.876627646Z [err]  2025-12-30 06:26:38,871 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:38.877314394Z [err]  2025-12-30 06:26:38,872 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 1827ms estimated
2025-12-30T06:26:38.877318599Z [err]  2025-12-30 06:26:38,872 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-30T06:26:38.877325368Z [err]  2025-12-30 06:26:38,872 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 10ms (provider: soniox, model: stt-rt-v3)
2025-12-30T06:26:38.877326058Z [err]  2025-12-30 06:26:38,872 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 33 chars, 1 sentences
2025-12-30T06:26:38.877333246Z [err]  2025-12-30 06:26:38,872 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Hell o....'
2025-12-30T06:26:38.877333586Z [err]  2025-12-30 06:26:38,872 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 1526ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-30T06:26:38.877338711Z [err]  2025-12-30 06:26:38,872 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: 'Let me say that again - Kendrick?...'
2025-12-30T06:26:38.877342369Z [err]  2025-12-30 06:26:38,872 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 420ms (provider: elevenlabs, websocket: False)
2025-12-30T06:26:38.877348710Z [err]  2025-12-30 06:26:38,872 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 1527ms (user stopped ‚Üí play_audio_url called)
2025-12-30T06:26:38.877356703Z [err]  2025-12-30 06:26:38,872 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-30T06:26:38.877363672Z [err]  2025-12-30 06:26:38,872 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-30T06:26:38.877370651Z [err]  2025-12-30 06:26:38,872 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-30T06:26:38.877377268Z [err]  2025-12-30 06:26:38,872 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-30T06:26:38.877383771Z [err]  2025-12-30 06:26:38,872 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-30T06:26:38.877892102Z [err]  2025-12-30 06:26:38,872 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-30T06:26:38.877899472Z [err]  2025-12-30 06:26:38,872 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T06:26:39.066236378Z [err]  2025-12-30 06:26:39,059 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 1956ms)
2025-12-30T06:26:39.066244612Z [err]  2025-12-30 06:26:39,059 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-30T06:26:39.066248818Z [err]  2025-12-30 06:26:39,059 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-30T06:26:39.154713687Z [err]  2025-12-30 06:26:39,150 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 279ms
2025-12-30T06:26:39.154722368Z [err]  2025-12-30 06:26:39,150 - persistent_tts_service - INFO - üì§ Sending 14473 bytes of audio (91 chunks, 1.8s duration) via WebSocket
2025-12-30T06:26:39.154727877Z [err]  2025-12-30 06:26:39,150 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-30T06:26:39.154733704Z [err]  2025-12-30 06:26:39,150 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.8s (total: 1.8s from now)
2025-12-30T06:26:39.154739967Z [err]  2025-12-30 06:26:39,152 - persistent_tts_service - INFO - ‚úÖ Sent 91 audio chunks via WebSocket
2025-12-30T06:26:39.504385198Z [err]  2025-12-30 06:26:39,488 - server - INFO - üì§ Audio flowing: 365 packets sent to Soniox (5s update)
2025-12-30T06:26:40.069378497Z [err]  2025-12-30 06:26:40,068 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (0.9s left)
2025-12-30T06:26:40.591913437Z [err]  2025-12-30 06:26:40,580 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-30T06:26:41.125110689Z [err]  2025-12-30 06:26:41,091 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (0.1s ago), marking agent as done speaking
2025-12-30T06:26:41.125123860Z [err]  2025-12-30 06:26:41,091 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767076001.0919263 for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:41.125131399Z [err]  2025-12-30 06:26:41,091 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:41.154252869Z [err]  2025-12-30 06:26:41,151 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-30T06:26:41.154263867Z [err]  2025-12-30 06:26:41,151 - persistent_tts_service - INFO - ‚úÖ [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Receiver finished sentence #1: 1 chunks in 2279ms
2025-12-30T06:26:41.159058889Z [err]  2025-12-30 06:26:41,154 - persistent_tts_service - INFO - üîá [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] FLOOR RELEASED (is_holding_floor=False)
2025-12-30T06:26:44.533624186Z [err]  2025-12-30 06:26:44,510 - server - INFO - üì§ Audio flowing: 616 packets sent to Soniox (5s update)
2025-12-30T06:26:44.824349019Z [err]  2025-12-30 06:26:44,802 - server - INFO - üé§ Soniox receiver alive - 12 messages received in last 10s
2025-12-30T06:26:45.147753027Z [err]  2025-12-30 06:26:44,973 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 630 total packets
2025-12-30T06:26:45.147756660Z [err]  [2025-12-30 06:26:44 +0000] [5] [INFO] connection closed
2025-12-30T06:26:45.147761359Z [err]  2025-12-30 06:26:45,128 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:26:45.147765983Z [err]  2025-12-30 06:26:45,128 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': 'c7492719-4669-4368-833b-d30e85b4d9cb', 'occurred_at': '2025-12-30T06:26:44.729221Z', 'payload': {'call_control_id': 'v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA', 'call_leg_id': '78c63b92-e548-11f0-8f9e-02420aef981f', 'call_quality_stats': {'inbound': {'jitter_max_variance': '51.22', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '654', 'skip_packet_count': '23'}, 'outbound': {'packet_count': '636', 'skip_packet_count': '0'}}, 'call_session_id': '78c35120-e548-11f0-b542-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T06:26:44.729221Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-30T06:26:27.769242Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:26:45.147770493Z [err]  2025-12-30 06:26:45,128 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:45.147774143Z [err]  2025-12-30 06:26:45,128 - server - INFO - üì® ================================================
2025-12-30T06:26:45.147777900Z [err]  2025-12-30 06:26:45,128 - server - INFO - üìû Call ended: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:45.147781858Z [err]  2025-12-30 06:26:45,128 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-30T06:26:45.163327759Z [err]  2025-12-30 06:26:45,158 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:26:45.163333124Z [err]  2025-12-30 06:26:45,158 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': 'b10bdb2c-3d7c-4768-9ca5-77e56797f435', 'occurred_at': '2025-12-30T06:26:44.902354Z', 'payload': {'call_control_id': 'v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA', 'call_leg_id': '78c63b92-e548-11f0-8f9e-02420aef981f', 'call_session_id': '78c35120-e548-11f0-b542-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '5c17f660-c239-4674-a8b9-2a152b6b2249', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:26:45.163337683Z [err]  2025-12-30 06:26:45,158 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:45.163342768Z [err]  2025-12-30 06:26:45,158 - server - INFO - üì® ================================================
2025-12-30T06:26:45.163348371Z [inf]  100.64.0.6:19042 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:26:45.215838261Z [err]  2025-12-30 06:26:45,205 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:26:45.215844949Z [err]  2025-12-30 06:26:45,205 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '6206b89c-0505-4b19-a9ac-18cc241e609a', 'occurred_at': '2025-12-30T06:26:44.769219Z', 'payload': {'call_control_id': 'v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA', 'call_leg_id': '78c63b92-e548-11f0-8f9e-02420aef981f', 'call_session_id': '78c35120-e548-11f0-b542-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T06:26:44.769219Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'f7l0J3Jvmg', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:26:45.215849360Z [err]  2025-12-30 06:26:45,206 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:45.215853771Z [err]  2025-12-30 06:26:45,206 - server - INFO - üì® ================================================
2025-12-30T06:26:45.227121696Z [err]  2025-12-30 06:26:45,222 - redis_service - INFO - ‚ûñ Removed playback f7l0J3Jvmg, 0 remaining for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:45.227128726Z [err]  2025-12-30 06:26:45,223 - server - INFO - üîä Redis: Removed playback f7l0J3Jvmg, 0 remaining
2025-12-30T06:26:45.227133250Z [err]  2025-12-30 06:26:45,223 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-30T06:26:45.232759788Z [err]  2025-12-30 06:26:45,228 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-30T06:26:45.232769747Z [err]  2025-12-30 06:26:45,228 - server - INFO - üí° Session not on this worker - Redis flag set for WebSocket worker to handle
2025-12-30T06:26:45.232780168Z [inf]  100.64.0.9:53752 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:26:45.320684981Z [err]  2025-12-30 06:26:45,314 - server - INFO - üìù Updated call log: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:45.409783834Z [err]  2025-12-30 06:26:45,408 - server - INFO - ‚úÖ Finalized call log: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA (duration=13s, status=completed)
2025-12-30T06:26:45.512296294Z [err]  2025-12-30 06:26:45,501 - server - INFO - üì¶ Saved 11 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-30T06:26:46.215038924Z [err]  2025-12-30 06:26:46,204 - server - INFO - üìä Auto-added call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-30T06:26:46.397368944Z [err]  2025-12-30 06:26:46,391 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T06:26:46.403090329Z [err]  2025-12-30 06:26:46,398 - redis_service - INFO - üì• Retrieved call data from Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:46.403098681Z [err]  2025-12-30 06:26:46,398 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-30T06:26:46.403105267Z [err]  2025-12-30 06:26:46,398 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-30T06:26:46.492857947Z [err]  2025-12-30 06:26:46,491 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-30T06:26:46.609172859Z [err]  2025-12-30 06:26:46,578 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T06:26:46.609178458Z [err]  2025-12-30 06:26:46,579 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-30T06:26:46.609182536Z [err]  2025-12-30 06:26:46,579 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-30T06:26:46.609186193Z [err]  2025-12-30 06:26:46,579 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-30T06:26:46.609190326Z [err]  2025-12-30 06:26:46,579 - server - INFO - üöÄ Triggered QC analysis for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:46.609194056Z [err]  2025-12-30 06:26:46,579 - server - INFO - üìä Triggered Campaign QC for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:46.609197795Z [err]  2025-12-30 06:26:46,579 - server - INFO - üìá Triggered CRM update for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:46.609201400Z [err]  2025-12-30 06:26:46,579 - persistent_tts_service - INFO - üîå [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Closing persistent TTS WebSocket...
2025-12-30T06:26:46.609205004Z [err]  2025-12-30 06:26:46,579 - server - INFO - üîç Starting QC analysis for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:46.609209784Z [err]  2025-12-30 06:26:46,580 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-30T06:26:46.610284724Z [err]  2025-12-30 06:26:46,580 - server - INFO - üìá CRM update starting for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:26:46.610294071Z [err]  2025-12-30 06:26:46,580 - server - INFO - üìá Normalized phone: +17708336397
2025-12-30T06:26:46.610301551Z [err]  2025-12-30 06:26:46,580 - server - INFO - üìá CRM: Got 11 variables from active session
2025-12-30T06:26:46.610309197Z [err]  2025-12-30 06:26:46,581 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-30T06:26:46.610316339Z [err]  2025-12-30 06:26:46,582 - persistent_tts_service - INFO - üõë [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Audio Receiver Loop CANCELLED
2025-12-30T06:26:46.610323121Z [err]  2025-12-30 06:26:46,582 - persistent_tts_service - INFO - üëã [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Audio Receiver Loop STOPPED
2025-12-30T06:26:46.610331572Z [err]  2025-12-30 06:26:46,582 - persistent_tts_service - INFO - üõë [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Playback consumer shutting down
2025-12-30T06:26:46.674569756Z [err]  2025-12-30 06:26:46,671 - server - INFO - üìù Converted transcript from 3 messages to 79 characters
2025-12-30T06:26:46.674578737Z [err]  2025-12-30 06:26:46,673 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=3, logs_count=4, status=completed
2025-12-30T06:26:46.781794525Z [err]  2025-12-30 06:26:46,759 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:26:46.848876986Z [err]  2025-12-30 06:26:46,846 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-30T06:26:46.939140273Z [err]  2025-12-30 06:26:46,933 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-30T06:26:46.939146675Z [err]  2025-12-30 06:26:46,934 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:26:46.939152670Z [err]  2025-12-30 06:26:46,934 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:46.980544813Z [err]  2025-12-30 06:26:46,961 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:26:46.980552972Z [err]  2025-12-30 06:26:46,961 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '95af752c-6d61-4b39-8bfb-5f081983dea8', 'occurred_at': '2025-12-30T06:26:46.446738Z', 'payload': {'call_control_id': 'v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA', 'call_leg_id': '78c63b92-e548-11f0-8f9e-02420aef981f', 'call_session_id': '78c35120-e548-11f0-b542-02420aef981f', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T06:26:44.818493Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-30T06:26:44.818493Z', 'recording_id': '1ef585f0-d4ce-47db-b046-13923440a1a0', 'recording_started_at': '2025-12-30T06:26:33.743379Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-30/78c63b92-e548-11f0-8f9e-02420aef981f-1767075992811305.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251230%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251230T062646Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=742564817a4fba87821a2114193ba30ab26e4f8cf4fad6f1be5a9961fa556bcf'}, 'start_time': '2025-12-30T06:26:33.743379Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:26:46.980561113Z [err]  2025-12-30 06:26:46,961 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:46.980568633Z [err]  2025-12-30 06:26:46,961 - server - INFO - üì® ================================================
2025-12-30T06:26:46.980576201Z [err]  2025-12-30 06:26:46,961 - server - INFO - üéôÔ∏è Recording saved for call: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:46.980583754Z [err]  2025-12-30 06:26:46,967 - redis_service - INFO - üì• Retrieved call data from Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:46.981403148Z [err]  2025-12-30 06:26:46,967 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=1ef585f0-d4ce-47db-b046-13923440a1a0, call_data=True
2025-12-30T06:26:47.179597123Z [err]  2025-12-30 06:26:47,061 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-30T06:26:47.179608584Z [err]  2025-12-30 06:26:47,110 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-30T06:26:47.179616310Z [err]  2025-12-30 06:26:47,121 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T06:26:47.179623502Z [err]  2025-12-30 06:26:47,122 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:26:47.179631172Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T06:26:47.179638720Z [err]  2025-12-30 06:26:47,122 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:26:47.179645659Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-30T06:26:47.179654230Z [err]  2025-12-30 06:26:47,124 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:47.179654635Z [err]  2025-12-30 06:26:47,061 - server - INFO - üíæ Saved recording URL and ID to database: 1ef585f0-d4ce-47db-b046-13923440a1a0
2025-12-30T06:26:47.179660811Z [err]  2025-12-30 06:26:47,061 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-30T06:26:47.179663429Z [err]  2025-12-30 06:26:47,169 - server - INFO - üìá CRM: Got 11 extracted variables
2025-12-30T06:26:47.179669909Z [err]  2025-12-30 06:26:47,169 - server - INFO - üìá CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-30T06:26:47.207567050Z [err]  2025-12-30 06:26:47,199 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-30T06:26:47.207576989Z [err]  2025-12-30 06:26:47,199 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-30T06:26:47.207584491Z [err]  2025-12-30 06:26:47,199 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-30T06:26:47.207591112Z [err]  2025-12-30 06:26:47,200 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-30T06:26:47.207597673Z [err]    File "/app/backend/server.py", line 9773, in trigger_campaign_qc_for_call
2025-12-30T06:26:47.207605168Z [err]      await run_full_qc_analysis(
2025-12-30T06:26:47.207611482Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-30T06:26:47.207618072Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-30T06:26:47.207624797Z [err]  
2025-12-30T06:26:47.356550044Z [err]  2025-12-30 06:26:47,347 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-30T06:26:47.379608430Z [err]  2025-12-30 06:26:47,372 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-30/78c63b92-e548-11f0-8f9e-02420aef981f-1767075992811305.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251230%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251230T062646Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=742564817a4fba87821a2114193ba30ab26e4f8cf4fad6f1be5a9961fa556bcf "HTTP/1.1 200 OK"
2025-12-30T06:26:47.512349476Z [inf]  100.64.0.11:52478 - "GET /api/agents HTTP/1.1" 200
2025-12-30T06:26:47.512362383Z [err]  2025-12-30 06:26:47,486 - server - INFO - ‚úÖ Downloaded 44555 bytes
2025-12-30T06:26:48.193181185Z [err]  2025-12-30 06:26:48,174 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T06:26:48.193187799Z [err]  2025-12-30 06:26:48,180 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.1s silence (threshold: 7s)
2025-12-30T06:26:48.193197207Z [err]  2025-12-30 06:26:48,186 - core_calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-30T06:26:48.193197472Z [err]  2025-12-30 06:26:48,172 - server - ERROR - ‚ùå No Soniox API key available
2025-12-30T06:26:48.193199276Z [err]  2025-12-30 06:26:48,186 - telnyx_service - INFO - üîä Speaking text on call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA: Are you still there?...
2025-12-30T06:26:48.193201096Z [err]  2025-12-30 06:26:48,186 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T06:26:48.193202578Z [err]  2025-12-30 06:26:48,186 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T06:26:48.193207976Z [err]  2025-12-30 06:26:48,173 - server - ERROR - ‚ùå No Soniox API key available
2025-12-30T06:26:48.193208533Z [err]  2025-12-30 06:26:48,186 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.1s silence: Are you still there?
2025-12-30T06:26:48.193209454Z [err]  2025-12-30 06:26:48,172 - server - INFO - ‚úÖ Split into 2 channels
2025-12-30T06:26:48.193211925Z [err]  2025-12-30 06:26:48,186 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-30T06:26:48.193215784Z [err]  2025-12-30 06:26:48,173 - server - INFO - ‚ùå Channel 0: No speech
2025-12-30T06:26:48.193219036Z [err]  2025-12-30 06:26:48,186 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:48.193219619Z [err]  2025-12-30 06:26:48,186 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T06:26:48.193220956Z [err]  2025-12-30 06:26:48,172 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-30T06:26:48.193223663Z [err]  2025-12-30 06:26:48,186 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-30T06:26:48.193228458Z [err]  2025-12-30 06:26:48,173 - server - INFO - ‚ùå Channel 1: No speech
2025-12-30T06:26:48.193231963Z [err]  2025-12-30 06:26:48,172 - server - INFO - üìä Channel 0: 241164 bytes
2025-12-30T06:26:48.193232142Z [err]  2025-12-30 06:26:48,186 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T06:26:48.193233546Z [err]  2025-12-30 06:26:48,173 - server - INFO - üìä Channel 1: 241164 bytes
2025-12-30T06:26:48.193234918Z [err]  2025-12-30 06:26:48,187 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T06:26:48.193243894Z [err]  2025-12-30 06:26:48,173 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-30T06:26:48.193244546Z [err]  2025-12-30 06:26:48,187 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T06:26:48.193254828Z [inf]  100.64.0.14:33406 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:26:48.198562675Z [err]  2025-12-30 06:26:48,195 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:26:48.198569681Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T06:26:48.198574885Z [err]  2025-12-30 06:26:48,196 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:26:48.198579085Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-30T06:26:48.198583773Z [err]  2025-12-30 06:26:48,196 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:48.210619333Z [err]  2025-12-30 06:26:48,204 - elevenlabs_ws_service - INFO - üîå Closed ElevenLabs WebSocket connection
2025-12-30T06:26:48.210628624Z [err]  2025-12-30 06:26:48,204 - persistent_tts_service - INFO - ‚úÖ [Call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA] Persistent TTS WebSocket closed
2025-12-30T06:26:48.210635850Z [err]  2025-12-30 06:26:48,204 - persistent_tts_service - INFO - ‚úÖ Closed persistent TTS session for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:48.210644440Z [err]  2025-12-30 06:26:48,204 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:48.211574898Z [err]  2025-12-30 06:26:48,210 - redis_service - INFO - üßπ Deleted call data from Redis: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:48.211583768Z [err]  2025-12-30 06:26:48,210 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:48.212422371Z [inf]  100.64.0.12:59952 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:26:48.397399558Z [err]  2025-12-30 06:26:48,377 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T06:26:48.397417434Z [err]  2025-12-30 06:26:48,378 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:26:48.397427819Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T06:26:48.397439405Z [err]  2025-12-30 06:26:48,378 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:26:48.397448702Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T06:26:48.496365934Z [err]  2025-12-30 06:26:48,469 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:48.496376475Z [err]  2025-12-30 06:26:48,469 - server - INFO - ‚úÖ QC analysis completed for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:48.496384066Z [err]  2025-12-30 06:26:48,469 - server - INFO - üìä Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-30T06:26:48.496390709Z [err]  2025-12-30 06:26:48,488 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T06:26:48.496396673Z [err]  2025-12-30 06:26:48,488 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.30s
2025-12-30T06:26:48.496401732Z [err]  2025-12-30 06:26:48,489 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-30T06:26:48.496407098Z [err]    "errors": [
2025-12-30T06:26:48.496412146Z [err]      {
2025-12-30T06:26:48.496417153Z [err]        "code": "90018",
2025-12-30T06:26:48.496421380Z [err]        "title": "Call has already ended",
2025-12-30T06:26:48.496425394Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-30T06:26:48.496429290Z [err]      }
2025-12-30T06:26:48.496433758Z [err]    ]
2025-12-30T06:26:48.496437896Z [err]  }
2025-12-30T06:26:48.496441809Z [err]  2025-12-30 06:26:48,489 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-30T06:26:48.753782573Z [err]  2025-12-30 06:26:48,752 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T06:26:48.753794152Z [err]  2025-12-30 06:26:48,752 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-30T06:26:48.753805428Z [err]  2025-12-30 06:26:48,752 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-30T06:26:48.854534113Z [err]  2025-12-30 06:26:48,848 - server - INFO - üìä Updated campaign_calls with QC scores for v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:49.165883670Z [err]  2025-12-30 06:26:49,025 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-30T06:26:49.165890953Z [err]  2025-12-30 06:26:49,124 - server - INFO - üè∑Ô∏è Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-30T06:26:49.165897560Z [err]  2025-12-30 06:26:49,125 - server - ERROR - ‚ùå Error in auto appointment detection for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA: 'str' object has no attribute 'get'
2025-12-30T06:26:49.263849296Z [err]  2025-12-30 06:26:49,257 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-30T06:26:49.263856113Z [err]  2025-12-30 06:26:49,257 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767076009.257911 for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:49.263860492Z [err]  2025-12-30 06:26:49,257 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:49.264941920Z [err]  2025-12-30 06:26:49,263 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:49.772011202Z [err]  2025-12-30 06:26:49,771 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:50.277959381Z [err]  2025-12-30 06:26:50,276 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:50.277965553Z [err]  2025-12-30 06:26:50,277 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=1.0s, checkin_count=1/2
2025-12-30T06:26:50.850652411Z [err]  2025-12-30 06:26:50,782 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:50.850656621Z [err]  2025-12-30 06:26:50,782 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=1.5s, checkin_count=1/2
2025-12-30T06:26:51.294422522Z [err]  2025-12-30 06:26:51,288 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:51.879733026Z [err]  2025-12-30 06:26:51,793 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:52.306119117Z [err]  2025-12-30 06:26:52,300 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:52.833951578Z [err]  2025-12-30 06:26:52,805 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:53.319057473Z [err]  2025-12-30 06:26:53,312 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:53.832139812Z [err]  2025-12-30 06:26:53,817 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:54.356619985Z [err]  2025-12-30 06:26:54,323 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:54.830744681Z [err]  2025-12-30 06:26:54,828 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:55.340866646Z [err]  2025-12-30 06:26:55,335 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:55.856776692Z [err]  2025-12-30 06:26:55,841 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:55.916808909Z [inf]  100.64.0.4:34418 - "GET /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/flow HTTP/1.1" 200
2025-12-30T06:26:56.005206785Z [inf]  100.64.0.4:28448 - "GET /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb HTTP/1.1" 200
2025-12-30T06:26:56.357952268Z [err]  2025-12-30 06:26:56,347 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:56.357961394Z [err]  2025-12-30 06:26:56,347 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.1s silence (threshold: 7s)
2025-12-30T06:26:56.357968996Z [err]  2025-12-30 06:26:56,353 - core_calling_service - INFO - üí¨ Sending FINAL check-in #2/2: Are you still there?
2025-12-30T06:26:56.357976271Z [err]  2025-12-30 06:26:56,353 - core_calling_service - INFO - ‚ö†Ô∏è Will end call if no response after next silence timeout
2025-12-30T06:26:56.357982753Z [err]  2025-12-30 06:26:56,353 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.1s silence: Are you still there?
2025-12-30T06:26:56.357988693Z [err]  2025-12-30 06:26:56,353 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:26:56.357996858Z [err]  2025-12-30 06:26:56,353 - telnyx_service - INFO - üîä Speaking text on call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA: Are you still there?...
2025-12-30T06:26:56.358003362Z [err]  2025-12-30 06:26:56,353 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T06:26:56.358008899Z [err]  2025-12-30 06:26:56,353 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T06:26:56.358015259Z [err]  2025-12-30 06:26:56,353 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T06:26:56.358021342Z [err]  2025-12-30 06:26:56,353 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T06:26:56.358026994Z [err]  2025-12-30 06:26:56,353 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-30T06:26:56.359206826Z [err]  2025-12-30 06:26:56,353 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-30T06:26:56.359215073Z [err]  2025-12-30 06:26:56,358 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T06:26:56.359221842Z [err]  2025-12-30 06:26:56,358 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T06:26:56.641696089Z [err]  2025-12-30 06:26:56,639 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-30T06:26:56.641698632Z [err]  2025-12-30 06:26:56,638 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T06:26:56.641704852Z [err]  2025-12-30 06:26:56,638 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.28s
2025-12-30T06:26:56.641709973Z [err]  2025-12-30 06:26:56,639 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-30T06:26:56.641713871Z [err]    "errors": [
2025-12-30T06:26:56.641717820Z [err]      {
2025-12-30T06:26:56.641721507Z [err]        "code": "90018",
2025-12-30T06:26:56.641725575Z [err]        "title": "Call has already ended",
2025-12-30T06:26:56.641729240Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-30T06:26:56.641733391Z [err]      }
2025-12-30T06:26:56.641737589Z [err]    ]
2025-12-30T06:26:56.641745455Z [err]  }
2025-12-30T06:26:56.971241126Z [err]  2025-12-30 06:26:56,905 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T06:26:56.971250741Z [err]  2025-12-30 06:26:56,905 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-30T06:26:56.971261491Z [err]  2025-12-30 06:26:56,905 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-30T06:26:57.419229022Z [err]  2025-12-30 06:26:57,417 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:57.419236080Z [err]  2025-12-30 06:26:57,417 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:57.938964004Z [err]  2025-12-30 06:26:57,928 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:57.938971427Z [err]  2025-12-30 06:26:57,928 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:58.441812567Z [err]  2025-12-30 06:26:58,439 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:58.441818015Z [err]  2025-12-30 06:26:58,439 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:58.954055686Z [err]  2025-12-30 06:26:58,950 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:58.954064936Z [err]  2025-12-30 06:26:58,950 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:59.463716971Z [err]  2025-12-30 06:26:59,462 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:59.463722088Z [err]  2025-12-30 06:26:59,463 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:59.991753222Z [err]  2025-12-30 06:26:59,974 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:26:59.991759877Z [err]  2025-12-30 06:26:59,975 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:00.489868301Z [err]  2025-12-30 06:27:00,487 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:00.489875128Z [err]  2025-12-30 06:27:00,487 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:00.489881938Z [err]  2025-12-30 06:27:00,488 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=2/2
2025-12-30T06:27:01.035789678Z [err]  2025-12-30 06:27:01,000 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:01.035795254Z [err]  2025-12-30 06:27:01,000 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:01.515909770Z [err]  2025-12-30 06:27:01,512 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:01.515915920Z [err]  2025-12-30 06:27:01,512 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:02.025430865Z [err]  2025-12-30 06:27:02,024 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:02.025439925Z [err]  2025-12-30 06:27:02,024 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:02.537493351Z [err]  2025-12-30 06:27:02,535 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:02.537505766Z [err]  2025-12-30 06:27:02,535 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:03.062425031Z [err]  2025-12-30 06:27:03,047 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:03.062430107Z [err]  2025-12-30 06:27:03,047 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:03.559963582Z [err]  2025-12-30 06:27:03,558 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:03.559973855Z [err]  2025-12-30 06:27:03,558 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:04.351263099Z [err]  2025-12-30 06:27:04,069 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:04.351284174Z [err]  2025-12-30 06:27:04,069 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:04.599128500Z [err]  2025-12-30 06:27:04,582 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:04.599132185Z [err]  2025-12-30 06:27:04,582 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:OK2b1rFz5bxZX81es... (active sessions: ['v3:PbTJbbhAUvNOTM6aKlUXsOBFAYohUmeRf4rKoDkI_-ebWRd_b4SGig', 'v3:oE4qBPGV9o-mO3yNmX54zARaLmFuZmCRqdXcHsw-VrnTxvKFa5TqHg', 'v3:pjVjZmXjXmua3l2mdchCWTqZ4R2aFMNzHsnijLgTsOAEdwdJo-HY9A'])
2025-12-30T06:27:05.009593288Z [err]  2025-12-30 06:27:05,005 - server - INFO - üé§ Soniox receiver alive - 1 messages received in last 10s
2025-12-30T06:27:05.009603549Z [err]  2025-12-30 06:27:05,005 - server - ERROR - ‚ùå Soniox error: {'tokens': [], 'final_audio_proc_ms': 6840, 'total_audio_proc_ms': 12240, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-30T06:27:05.009611684Z [err]  2025-12-30 06:27:05,005 - server - INFO - ‚úÖ Soniox receive loop ended normally
2025-12-30T06:27:05.009619249Z [err]  2025-12-30 06:27:05,005 - dead_air_monitor - INFO - üîá Dead air monitoring cancelled for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:27:05.009626685Z [err]  2025-12-30 06:27:05,005 - dead_air_monitor - INFO - üîá Dead air monitoring stopped for call v3:OK2b1rFz5bxZX81esdlfqkeMnLj0vTvisSMnNO4MMizV5G_iwPQzdA
2025-12-30T06:27:05.009636538Z [err]  2025-12-30 06:27:05,005 - server - INFO - üîá Dead air monitoring task cancelled
2025-12-30T06:27:07.009577484Z [err]  2025-12-30 06:27:07,007 - soniox_service - ERROR - ‚ùå Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-30T06:27:07.009583595Z [err]  2025-12-30 06:27:07,007 - server - INFO - üîå Telnyx WebSocket disconnected
2025-12-30T06:27:37.034234826Z [inf]  100.64.0.2:31330 - "PUT /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/flow HTTP/1.1" 200
2025-12-30T06:27:39.686512919Z [inf]  100.64.0.4:28448 - "GET /api/agents HTTP/1.1" 200
2025-12-30T06:27:59.556316403Z [err]  2025-12-30 06:27:52,949 - server - INFO - üìù Created call log: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.556318396Z [err]  2025-12-30 06:27:52,146 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-30T06:27:59.556331449Z [err]  2025-12-30 06:27:52,950 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T06:27:59.556333499Z [err]  2025-12-30 06:27:52,233 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:27:59.556343111Z [err]  2025-12-30 06:27:52,950 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-30T06:27:59.556482840Z [err]  2025-12-30 06:27:52,321 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:27:59.556499978Z [err]  2025-12-30 06:27:52,340 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:27:59.556509894Z [err]  2025-12-30 06:27:52,340 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-30T06:27:59.556518972Z [err]  2025-12-30 06:27:52,340 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-30T06:27:59.556527256Z [err]  2025-12-30 06:27:52,340 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-30T06:27:59.556536970Z [err]  2025-12-30 06:27:52,850 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-30T06:27:59.556545186Z [err]  2025-12-30 06:27:52,851 - telnyx_service - INFO - ‚úÖ Call initiated: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.557920119Z [err]  2025-12-30 06:27:52,950 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T06:27:59.557928641Z [err]  2025-12-30 06:27:52,950 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T06:27:59.557935716Z [err]  2025-12-30 06:27:52,986 - redis_service - INFO - üì¶ Stored call data in Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g (TTL: 3600s)
2025-12-30T06:27:59.557943849Z [err]  2025-12-30 06:27:52,986 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-30T06:27:59.557950561Z [err]  2025-12-30 06:27:52,986 - server - INFO - üìû Outbound call initiated: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.557958104Z [inf]  100.64.0.16:23406 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-30T06:27:59.557965433Z [err]  2025-12-30 06:27:53,112 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:27:59.557974433Z [err]  2025-12-30 06:27:53,112 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': '03eeb76b-b8bf-4946-ad21-7b1902c93d97', 'occurred_at': '2025-12-30T06:27:52.738811Z', 'payload': {'call_control_id': 'v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g', 'call_leg_id': 'ab7aeb8c-e548-11f0-ac8b-02420aef971f', 'call_session_id': 'ab78b592-e548-11f0-b2ce-02420aef971f', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:27:59.557981541Z [err]  2025-12-30 06:27:53,112 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.559778960Z [err]  2025-12-30 06:27:53,112 - server - INFO - üì® ================================================
2025-12-30T06:27:59.559790701Z [err]  2025-12-30 06:27:53,112 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-30T06:27:59.559801063Z [inf]  100.64.0.12:32768 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:27:59.559809686Z [err]  2025-12-30 06:27:53,172 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-30T06:27:59.559818518Z [err]  2025-12-30 06:27:53,172 - server - INFO -    Client: Address(host='100.64.0.14', port=10962)
2025-12-30T06:27:59.559828164Z [err]  2025-12-30 06:27:53,172 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'hjhw2tKrOdZgQjjGAWZS6w==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'eUGA9xCCRAqTlBWW9I3ezw', 'x-real-ip': '192.76.120.151', 'x-request-start': '1767076072943', 'accept-encoding': 'gzip'}
2025-12-30T06:27:59.559836296Z [err]  2025-12-30 06:27:53,172 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-30T06:27:59.559843614Z [err]  2025-12-30 06:27:53,172 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-30T06:27:59.559849981Z [err]  [2025-12-30 06:27:53 +0000] [3] [INFO] ('100.64.0.14', 10962) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-30T06:27:59.559857664Z [err]  2025-12-30 06:27:53,172 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-30T06:27:59.559865541Z [err]  [2025-12-30 06:27:53 +0000] [3] [INFO] connection open
2025-12-30T06:27:59.559881529Z [err]  2025-12-30 06:27:53,328 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-30T06:27:59.559892096Z [err]  2025-12-30 06:27:53,328 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-30T06:27:59.561090854Z [err]  2025-12-30 06:27:53,419 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T06:27:59.561099879Z [err]  2025-12-30 06:27:53,419 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-30T06:27:59.561106744Z [err]  2025-12-30 06:27:58,294 - server - INFO - üì¨ Received Telnyx event: start
2025-12-30T06:27:59.561113520Z [err]  2025-12-30 06:27:58,294 - server - INFO - üé¨ Stream started for call: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.561119722Z [err]  2025-12-30 06:27:58,321 - redis_service - INFO - üì• Retrieved call data from Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.561126174Z [err]  2025-12-30 06:27:58,322 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-30T06:27:59.561132182Z [err]  2025-12-30 06:27:58,322 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-30T06:27:59.561139030Z [err]  2025-12-30 06:27:58,470 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:27:59.561144698Z [err]  2025-12-30 06:27:58,470 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': '74125268-79e1-4141-92ae-b221255d2cd2', 'occurred_at': '2025-12-30T06:27:58.158811Z', 'payload': {'call_control_id': 'v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g', 'call_leg_id': 'ab7aeb8c-e548-11f0-ac8b-02420aef971f', 'call_session_id': 'ab78b592-e548-11f0-b2ce-02420aef971f', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-30T06:27:52.738811Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:27:59.561150741Z [err]  2025-12-30 06:27:58,470 - server - INFO - üéØ Event type: call.answered, Call ID: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.562262634Z [err]  2025-12-30 06:27:58,470 - server - INFO - üì® ================================================
2025-12-30T06:27:59.562273249Z [err]  2025-12-30 06:27:58,470 - server - INFO - ‚úÖ Call answered: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.562291155Z [err]  2025-12-30 06:27:58,477 - redis_service - INFO - üì• Retrieved call data from Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.562304609Z [err]  2025-12-30 06:27:58,480 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-30T06:27:59.562310632Z [err]  2025-12-30 06:27:58,480 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-30T06:27:59.562319199Z [err]  2025-12-30 06:27:58,574 - server - INFO - ‚úÖ Call log updated
2025-12-30T06:27:59.562327151Z [err]  2025-12-30 06:27:58,574 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T06:27:59.562335755Z [err]  2025-12-30 06:27:58,574 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T06:27:59.562344566Z [err]  2025-12-30 06:27:58,574 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:27:59.562353025Z [err]  2025-12-30 06:27:58,661 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:27:59.562358865Z [err]  2025-12-30 06:27:58,749 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:27:59.562364752Z [err]  2025-12-30 06:27:58,749 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-30T06:27:59.562373448Z [err]  2025-12-30 06:27:58,752 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:27:59.562379459Z [err]  2025-12-30 06:27:58,752 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': 'c099058f-8843-45a8-bc35-63b42f92b86c', 'occurred_at': '2025-12-30T06:27:58.458811Z', 'payload': {'call_control_id': 'v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g', 'call_leg_id': 'ab7aeb8c-e548-11f0-ac8b-02420aef971f', 'call_session_id': 'ab78b592-e548-11f0-b2ce-02420aef971f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '8dd28949-3165-42e9-a980-ca7a9d26d7a0', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:27:59.563547795Z [err]  2025-12-30 06:27:58,830 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-30T06:27:59.563557473Z [err]  2025-12-30 06:27:58,752 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.563560045Z [err]  2025-12-30 06:27:58,918 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-30T06:27:59.563565797Z [err]  2025-12-30 06:27:58,918 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-30T06:27:59.563567003Z [err]  2025-12-30 06:27:58,752 - server - INFO - üì® ================================================
2025-12-30T06:27:59.563571189Z [err]  2025-12-30 06:27:58,918 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-30T06:27:59.563575309Z [inf]  100.64.0.8:43120 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:27:59.563577762Z [err]  2025-12-30 06:27:58,918 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-30T06:27:59.563582983Z [err]  2025-12-30 06:27:58,777 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:27:59.563589477Z [err]  2025-12-30 06:27:58,822 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-30T06:27:59.563596618Z [err]  2025-12-30 06:27:58,822 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-30T06:27:59.563602944Z [err]  2025-12-30 06:27:58,829 - redis_service - INFO - üì• Retrieved call data from Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.563609637Z [err]  2025-12-30 06:27:58,830 - server - INFO - üìù Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:27:59.564483207Z [err]  2025-12-30 06:27:59,016 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-30T06:27:59.564485355Z [err]  2025-12-30 06:27:58,918 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-30T06:27:59.564490330Z [err]  2025-12-30 06:27:59,068 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g/actions/playback_start "HTTP/1.1 200 OK"
2025-12-30T06:27:59.564492535Z [err]  2025-12-30 06:27:58,984 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T06:27:59.564498385Z [err]  2025-12-30 06:27:58,984 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-30T06:27:59.564503299Z [err]  2025-12-30 06:27:59,005 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:27:59.564507826Z [err]  2025-12-30 06:27:59,014 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 95ms
2025-12-30T06:27:59.564511445Z [err]  2025-12-30 06:27:59,014 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-30T06:27:59.564515134Z [err]  2025-12-30 06:27:59,014 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-30T06:27:59.564518704Z [err]  2025-12-30 06:27:59,014 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-30T06:27:59.564523418Z [err]  2025-12-30 06:27:59,014 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-30T06:27:59.564527869Z [err]  2025-12-30 06:27:59,014 - server - INFO - ‚úÖ Initialized call_states for v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g with session reference
2025-12-30T06:27:59.564532285Z [err]  2025-12-30 06:27:59,014 - server - INFO - ‚úÖ Stored Telnyx WebSocket in call_data for audio streaming
2025-12-30T06:27:59.564536047Z [err]  2025-12-30 06:27:59,014 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found to update for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.565667495Z [err]  2025-12-30 06:27:59,069 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: 8BbVhZyeYg (loop=True, overlay=True)
2025-12-30T06:27:59.565674550Z [err]  2025-12-30 06:27:59,069 - server - INFO - üéµ Comfort noise started as continuous background overlay (playback_id: 8BbVhZyeYg)
2025-12-30T06:27:59.565680440Z [err]  2025-12-30 06:27:59,069 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.565686603Z [err]  2025-12-30 06:27:59,427 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g/actions/record_start "HTTP/1.1 200 OK"
2025-12-30T06:27:59.565692158Z [err]  2025-12-30 06:27:59,428 - server - INFO - üéôÔ∏è Call recording started for v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.565698257Z [err]  2025-12-30 06:27:59,431 - server - INFO - üîß Creating call session for v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g...
2025-12-30T06:27:59.565704351Z [err]  2025-12-30 06:27:59,431 - server - INFO - üîç Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:27:59.565710335Z [err]  2025-12-30 06:27:59,432 - server - INFO - üîß Calling create_call_session() - START
2025-12-30T06:27:59.565715928Z [err]  2025-12-30 06:27:59,432 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-30T06:27:59.565721743Z [inf]  100.64.0.12:37800 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-30T06:27:59.565727518Z [err]  2025-12-30 06:27:59,433 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-30T06:27:59.565734100Z [err]  2025-12-30 06:27:59,520 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-30T06:27:59.565740051Z [err]  2025-12-30 06:27:59,520 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-30T06:27:59.566452416Z [err]  2025-12-30 06:27:59,520 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-30T06:27:59.566460196Z [err]  2025-12-30 06:27:59,520 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-30T06:27:59.566465892Z [err]  2025-12-30 06:27:59,520 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-30T06:27:59.609831463Z [err]  2025-12-30 06:27:59,608 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:27:59.622141916Z [err]  2025-12-30 06:27:59,616 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 95ms
2025-12-30T06:27:59.622148150Z [err]  2025-12-30 06:27:59,616 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-30T06:27:59.622152739Z [err]  2025-12-30 06:27:59,616 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-30T06:27:59.650190293Z [err]  2025-12-30 06:27:59,645 - redis_service - INFO - üì¶ Stored call data in Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g (TTL: 3600s)
2025-12-30T06:27:59.650203830Z [err]  2025-12-30 06:27:59,645 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-30T06:27:59.650214943Z [err]  2025-12-30 06:27:59,645 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-30T06:27:59.655687070Z [err]  2025-12-30 06:27:59,651 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.655694669Z [err]  2025-12-30 06:27:59,651 - server - INFO - ü§ñ AI session created for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.655699995Z [err]  2025-12-30 06:27:59,651 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-30T06:27:59.655703914Z [err]  2025-12-30 06:27:59,651 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-30T06:27:59.655709219Z [err]  2025-12-30 06:27:59,651 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-30T06:27:59.655714202Z [err]  2025-12-30 06:27:59,651 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-30T06:27:59.655720076Z [err]  2025-12-30 06:27:59,651 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-30T06:27:59.655724079Z [err]  2025-12-30 06:27:59,651 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-30T06:27:59.655728279Z [err]  2025-12-30 06:27:59,651 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-30T06:27:59.817346240Z [err]  2025-12-30 06:27:59,668 - redis_service - INFO - üì• Retrieved call data from Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.817350665Z [err]  2025-12-30 06:27:59,669 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-30T06:27:59.817355470Z [err]  2025-12-30 06:27:59,669 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-30T06:27:59.817361500Z [inf]  100.64.0.10:30208 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:27:59.939540225Z [err]  2025-12-30 06:27:59,934 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-30T06:27:59.939546185Z [err]  2025-12-30 06:27:59,934 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-30T06:27:59.939553729Z [err]  2025-12-30 06:27:59,934 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-30T06:27:59.939560531Z [err]  2025-12-30 06:27:59,935 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:27:59.952158830Z [err]  2025-12-30 06:27:59,946 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:grbDJkmu7q7-nCqb7... (active sessions: [])
2025-12-30T06:27:59.952167290Z [err]  2025-12-30 06:27:59,946 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-30T06:28:00.457885358Z [err]  2025-12-30 06:28:00,452 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:grbDJkmu7q7-nCqb7... (active sessions: [])
2025-12-30T06:28:00.457892546Z [err]  2025-12-30 06:28:00,452 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-30T06:28:00.601049828Z [err]  2025-12-30 06:28:00,590 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:28:00.601054109Z [err]  2025-12-30 06:28:00,590 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '6ef1535f-c95c-4f86-9fee-85c5bfc22125', 'occurred_at': '2025-12-30T06:28:00.478813Z', 'payload': {'call_control_id': 'v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g', 'call_leg_id': 'ab7aeb8c-e548-11f0-ac8b-02420aef971f', 'call_session_id': 'ab78b592-e548-11f0-b2ce-02420aef971f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': '8BbVhZyeYg', 'start_time': '2025-12-30T06:28:00.478813Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:28:00.601057931Z [err]  2025-12-30 06:28:00,590 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:00.601061925Z [err]  2025-12-30 06:28:00,591 - server - INFO - üì® ================================================
2025-12-30T06:28:00.601065635Z [inf]  100.64.0.8:43120 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:28:00.968965185Z [err]  2025-12-30 06:28:00,958 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:grbDJkmu7q7-nCqb7... (active sessions: [])
2025-12-30T06:28:00.968969232Z [err]  2025-12-30 06:28:00,958 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-30T06:28:01.049027229Z [err]  2025-12-30 06:28:01,045 - redis_service - INFO - üì• Retrieved call data from Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:01.058723023Z [err]  2025-12-30 06:28:01,055 - redis_service - INFO - üì• Retrieved call data from Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:01.111582046Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - üîß Replaced {{now}} with Tuesday, December 30, 2025 at 1:28 AM EST in content
2025-12-30T06:28:01.111590597Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-30T06:28:01.111597419Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-30T06:28:01.111605485Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-30T06:28:01.111612100Z [err]  2025-12-30 06:28:01,093 - redis_service - INFO - üì¶ Stored call data in Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g (TTL: 3600s)
2025-12-30T06:28:01.111618222Z [err]  2025-12-30 06:28:01,093 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-30T06:28:01.111625717Z [err]  2025-12-30 06:28:01,093 - core_calling_service - INFO - ‚è±Ô∏è [06:28:01.093] üì• process_user_input() ENTRY - text: '...'
2025-12-30T06:28:01.111632819Z [err]  2025-12-30 06:28:01,102 - redis_service - INFO - üì• Retrieved call data from Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:01.111639261Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - ‚è±Ô∏è [06:28:01.103] ‚è© About to call _process_call_flow_streaming()
2025-12-30T06:28:01.111643972Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - ‚è±Ô∏è [06:28:01.103] üîÄ Agent type: call_flow, calling flow processor...
2025-12-30T06:28:01.111648337Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - ‚è±Ô∏è [06:28:01.103] üîÄ _process_call_flow_streaming() ENTRY
2025-12-30T06:28:01.111652443Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-30T06:28:01.111656431Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - ‚è±Ô∏è [06:28:01.103] ‚úÖ Node selected, about to process content...
2025-12-30T06:28:01.112520191Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-30T06:28:01.112531290Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-30T06:28:01.112535844Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-30T06:28:01.112540324Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-30T06:28:01.112544327Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-30T06:28:01.112548828Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-30T06:28:01.112552459Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-30T06:28:01.112556736Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-30T06:28:01.112560929Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-30T06:28:01.112565027Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - ‚è±Ô∏è [06:28:01.103] üìÑ About to process content (mode=script, length=9)
2025-12-30T06:28:01.112569707Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - üîä Silence tracking reset for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g (user responded)
2025-12-30T06:28:01.112573640Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-30T06:28:01.112578471Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-30T06:28:01.113244412Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - LLM response (0.01s): Kendrick?
2025-12-30T06:28:01.113252414Z [err]  2025-12-30 06:28:01,103 - core_calling_service - INFO - Total latency: 0.01s
2025-12-30T06:28:01.113259198Z [err]  2025-12-30 06:28:01,103 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-30T06:28:01.262255016Z [err]  2025-12-30 06:28:01,207 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-30T06:28:01.262265062Z [err]  2025-12-30 06:28:01,207 - telnyx_service - INFO - ‚úÖ Generated 13837 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-30T06:28:01.262273058Z [err]  2025-12-30 06:28:01,207 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-30T06:28:01.262280182Z [err]  2025-12-30 06:28:01,205 - redis_service - INFO - üì• Retrieved call data from Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:01.262298963Z [err]  2025-12-30 06:28:01,206 - telnyx_service - INFO - üîä Speaking text on call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g: Kendrick?...
2025-12-30T06:28:01.262308698Z [err]  2025-12-30 06:28:01,206 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T06:28:01.262316987Z [err]  2025-12-30 06:28:01,206 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T06:28:01.262325023Z [err]  2025-12-30 06:28:01,206 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T06:28:01.262331372Z [err]  2025-12-30 06:28:01,206 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T06:28:01.262340934Z [err]  2025-12-30 06:28:01,206 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (13837 bytes)
2025-12-30T06:28:01.469150774Z [err]  2025-12-30 06:28:01,464 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:grbDJkmu7q7-nCqb7... (active sessions: [])
2025-12-30T06:28:01.491195676Z [err]  2025-12-30 06:28:01,480 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g/actions/playback_start "HTTP/1.1 200 OK"
2025-12-30T06:28:01.491204869Z [err]  2025-12-30 06:28:01,481 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.27s
2025-12-30T06:28:01.491211919Z [err]  2025-12-30 06:28:01,481 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 0.27s
2025-12-30T06:28:01.491218510Z [err]  2025-12-30 06:28:01,481 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-30T06:28:01.491224565Z [err]  2025-12-30 06:28:01,481 - telnyx_service - INFO - üé¨ Playback ID: qxkxsIjwUw
2025-12-30T06:28:01.491230689Z [err]  2025-12-30 06:28:01,481 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-30T06:28:01.491236589Z [err]  2025-12-30 06:28:01,481 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Greeting playback started at 1767076081.481727
2025-12-30T06:28:01.491242653Z [err]  2025-12-30 06:28:01,481 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767076081.4817584 for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:01.491248826Z [err]  2025-12-30 06:28:01,481 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-30T06:28:01.827844122Z [inf]  100.64.0.6:16894 - "GET /api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3 HTTP/1.1" 200
2025-12-30T06:28:01.980140889Z [err]  2025-12-30 06:28:01,970 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:grbDJkmu7q7-nCqb7... (active sessions: [])
2025-12-30T06:28:02.242026996Z [err]  2025-12-30 06:28:02,233 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:28:02.242031326Z [err]  2025-12-30 06:28:02,233 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '1da3bee0-b879-4432-86b7-587cf0cc123d', 'occurred_at': '2025-12-30T06:28:02.118812Z', 'payload': {'call_control_id': 'v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g', 'call_leg_id': 'ab7aeb8c-e548-11f0-ac8b-02420aef971f', 'call_session_id': 'ab78b592-e548-11f0-b2ce-02420aef971f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'qxkxsIjwUw'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:28:02.242035541Z [err]  2025-12-30 06:28:02,233 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:02.242039858Z [err]  2025-12-30 06:28:02,233 - server - INFO - üì® ================================================
2025-12-30T06:28:02.242044839Z [inf]  100.64.0.8:43120 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:28:02.502234983Z [err]  2025-12-30 06:28:02,476 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:grbDJkmu7q7-nCqb7... (active sessions: [])
2025-12-30T06:28:03.010865023Z [err]  2025-12-30 06:28:02,981 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:grbDJkmu7q7-nCqb7... (active sessions: [])
2025-12-30T06:28:03.117789147Z [err]  2025-12-30 06:28:03,114 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:28:03.117792872Z [err]  2025-12-30 06:28:03,114 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '925039a3-cefe-40ef-96cd-2885f236d3de', 'occurred_at': '2025-12-30T06:28:02.998813Z', 'payload': {'call_control_id': 'v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g', 'call_leg_id': 'ab7aeb8c-e548-11f0-ac8b-02420aef971f', 'call_session_id': 'ab78b592-e548-11f0-b2ce-02420aef971f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'qxkxsIjwUw', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:28:03.117797105Z [err]  2025-12-30 06:28:03,114 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:03.117802042Z [err]  2025-12-30 06:28:03,114 - server - INFO - üì® ================================================
2025-12-30T06:28:03.128785035Z [err]  2025-12-30 06:28:03,125 - redis_service - INFO - ‚ûñ Removed playback qxkxsIjwUw, 0 remaining for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:03.128793050Z [err]  2025-12-30 06:28:03,125 - server - INFO - üîä Redis: Removed playback qxkxsIjwUw, 0 remaining
2025-12-30T06:28:03.128801291Z [err]  2025-12-30 06:28:03,125 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-30T06:28:03.128809230Z [err]  2025-12-30 06:28:03,125 - server - INFO - ‚è±Ô∏è CLEARED playback_expected_end_time - agent is definitely done speaking
2025-12-30T06:28:03.134358541Z [err]  2025-12-30 06:28:03,131 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-30T06:28:03.134366789Z [err]  2025-12-30 06:28:03,131 - server - INFO - ‚úÖ Found session locally: agent_speaking=False, user_speaking=False
2025-12-30T06:28:03.134372031Z [err]  2025-12-30 06:28:03,131 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767076083.1311266 for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:03.134376563Z [err]  2025-12-30 06:28:03,131 - server - INFO - ‚è±Ô∏è Silence timer STARTED (local, agent wasn't marked as speaking)
2025-12-30T06:28:03.134381488Z [inf]  100.64.0.10:30208 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:28:03.492656524Z [err]  2025-12-30 06:28:03,488 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:grbDJkmu7q7-nCqb7... (active sessions: [])
2025-12-30T06:28:03.534462280Z [err]  2025-12-30 06:28:03,515 - server - INFO - üî§ RAW TOKENS: ["H"?]
2025-12-30T06:28:03.534471703Z [err]  2025-12-30 06:28:03,515 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user started speaking) for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:03.534479022Z [err]  2025-12-30 06:28:03,515 - core_calling_service - INFO - üîä Silence timer reset for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g (user started speaking)
2025-12-30T06:28:03.534486884Z [err]  2025-12-30 06:28:03,516 - core_calling_service - INFO - üë§ User started speaking for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:03.534493349Z [err]  2025-12-30 06:28:03,516 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-30T06:28:03.534499726Z [err]  2025-12-30 06:28:03,516 - server - INFO - üîç PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-30T06:28:03.890647107Z [err]  2025-12-30 06:28:03,776 - server - INFO - üßπ Cleaned transcript: 'H ello ?' -> 'Hello?'
2025-12-30T06:28:03.890658690Z [err]  2025-12-30 06:28:03,776 - server - INFO - üì• FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-30T06:28:03.890665353Z [err]  2025-12-30 06:28:03,776 - server - INFO - üé§ Soniox final transcript: 'Hello?'
2025-12-30T06:28:03.890672831Z [err]  2025-12-30 06:28:03,776 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:grbDJkmu7q7-nCqb7... (active sessions: [])
2025-12-30T06:28:03.890678780Z [err]  2025-12-30 06:28:03,776 - server - INFO - üîç FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-30T06:28:03.890684526Z [err]  2025-12-30 06:28:03,776 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:grbDJkmu7q7-nCqb7... (active sessions: [])
2025-12-30T06:28:03.890690931Z [err]  2025-12-30 06:28:03,776 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-30T06:28:03.890696168Z [err]  2025-12-30 06:28:03,776 - server - INFO - ‚è±Ô∏è [06:28:03.776] üìù FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-30T06:28:03.890700327Z [err]  2025-12-30 06:28:03,776 - server - INFO - ‚è±Ô∏è [06:28:03.776] STT endpoint detection latency: 16ms
2025-12-30T06:28:03.890705998Z [err]  2025-12-30 06:28:03,776 - server - INFO - ‚è±Ô∏è [06:28:03.776] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-30T06:28:03.890713788Z [err]  2025-12-30 06:28:03,776 - server - INFO - ‚è±Ô∏è User spoke at 1767076083.7767076
2025-12-30T06:28:03.890721186Z [err]  2025-12-30 06:28:03,782 - redis_service - INFO - üì¶ Stored call data in Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g (TTL: 3600s)
2025-12-30T06:28:03.890762348Z [err]  2025-12-30 06:28:03,775 - server - INFO - üî§ RAW TOKENS: ["H"‚úì, "ello"‚úì, "?"‚úì, "<end>"‚úì]
2025-12-30T06:28:03.890772375Z [err]  2025-12-30 06:28:03,775 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-30T06:28:03.891221763Z [err]  2025-12-30 06:28:03,782 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-30T06:28:03.891227439Z [err]  2025-12-30 06:28:03,782 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:grbDJkmu7q7-nCqb7... (active sessions: [])
2025-12-30T06:28:03.891231128Z [err]  2025-12-30 06:28:03,782 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-30T06:28:03.891234834Z [err]  2025-12-30 06:28:03,793 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-30T06:28:03.891238688Z [err]  2025-12-30 06:28:03,793 - core_calling_service - INFO - üë§ User stopped speaking for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:03.891243098Z [err]  2025-12-30 06:28:03,794 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-30T06:28:03.891247085Z [err]  2025-12-30 06:28:03,794 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+5ms
2025-12-30T06:28:03.891250735Z [err]  2025-12-30 06:28:03,794 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 5ms (Soniox model: stt-rt-v3)
2025-12-30T06:28:03.891254625Z [err]  2025-12-30 06:28:03,794 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-30T06:28:03.891258115Z [err]  2025-12-30 06:28:03,794 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-30T06:28:03.891262066Z [err]  2025-12-30 06:28:03,794 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:03.891266324Z [err]  2025-12-30 06:28:03,887 - server - INFO - üìù Saved user transcript to database
2025-12-30T06:28:03.891270266Z [err]  2025-12-30 06:28:03,888 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:grbDJkmu7q7-nCqb7... (active sessions: [])
2025-12-30T06:28:03.892229289Z [err]  2025-12-30 06:28:03,888 - core_calling_service - INFO - ‚è±Ô∏è [06:28:03.888] üì• process_user_input() ENTRY - text: 'Hello?...'
2025-12-30T06:28:03.895031012Z [err]  2025-12-30 06:28:03,893 - redis_service - INFO - üì• Retrieved call data from Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:03.895036694Z [err]  2025-12-30 06:28:03,893 - core_calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g: User spoke while Silence Greeting was triggering
2025-12-30T06:28:03.895042669Z [err]  2025-12-30 06:28:03,893 - core_calling_service - INFO - ‚è≥ Smart Barge-In: User spoke early (2.41s) - LETTING GREETING FINISH
2025-12-30T06:28:03.895048817Z [err]  2025-12-30 06:28:03,893 - core_calling_service - INFO - ‚úÖ BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-30T06:28:03.900748656Z [err]  2025-12-30 06:28:03,899 - redis_service - INFO - üì• Retrieved call data from Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:03.906740793Z [err]  2025-12-30 06:28:03,904 - redis_service - INFO - üì¶ Stored call data in Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g (TTL: 3600s)
2025-12-30T06:28:03.906750494Z [err]  2025-12-30 06:28:03,904 - core_calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-30T06:28:03.906759428Z [err]  2025-12-30 06:28:03,905 - core_calling_service - INFO - ‚è±Ô∏è [06:28:03.904] ‚è© About to call _process_call_flow_streaming()
2025-12-30T06:28:03.906765861Z [err]  2025-12-30 06:28:03,905 - core_calling_service - INFO - ‚è±Ô∏è [06:28:03.905] üîÄ Agent type: call_flow, calling flow processor...
2025-12-30T06:28:03.906773822Z [err]  2025-12-30 06:28:03,905 - core_calling_service - INFO - ‚è±Ô∏è [06:28:03.905] üîÄ _process_call_flow_streaming() ENTRY
2025-12-30T06:28:03.906781787Z [err]  2025-12-30 06:28:03,905 - core_calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-30T06:28:03.906788710Z [err]  2025-12-30 06:28:03,905 - core_calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-30T06:28:03.906796137Z [err]  2025-12-30 06:28:03,905 - core_calling_service - INFO - ‚è±Ô∏è [06:28:03.905] üîÄ About to call _follow_transition() for: Hello?...
2025-12-30T06:28:03.906803432Z [err]  2025-12-30 06:28:03,905 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Hello?
2025-12-30T06:28:03.906813070Z [err]  2025-12-30 06:28:03,905 - core_calling_service - INFO - üîç Checking 'Hello=Yes' override [DEPLOYMENT VERIFIED] for msg='hello' on node='Greeting'
2025-12-30T06:28:03.906819755Z [err]  2025-12-30 06:28:03,905 - core_calling_service - WARNING - ‚ö†Ô∏è Auto-transition after response target not found: None, falling back to normal evaluation
2025-12-30T06:28:03.914297518Z [err]  2025-12-30 06:28:03,913 - core_calling_service - INFO - ‚è±Ô∏è [06:28:03.913] üîÄ TRANSITION EVALUATION START - Calling LLM for 2 options
2025-12-30T06:28:04.391009371Z [err]  2025-12-30 06:28:04,380 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:28:04.391023571Z [err]  2025-12-30 06:28:04,380 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': 'cad920eb-945c-4c97-a498-60a4bcdcef54', 'occurred_at': '2025-12-30T06:28:04.258813Z', 'payload': {'call_control_id': 'v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g', 'call_leg_id': 'ab7aeb8c-e548-11f0-ac8b-02420aef971f', 'call_session_id': 'ab78b592-e548-11f0-b2ce-02420aef971f', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:28:04.391030241Z [err]  2025-12-30 06:28:04,380 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:04.391036897Z [err]  2025-12-30 06:28:04,380 - server - INFO - üì® ================================================
2025-12-30T06:28:04.391042268Z [inf]  100.64.0.8:43120 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:28:04.432793216Z [err]  2025-12-30 06:28:04,422 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-30T06:28:04.432800244Z [err]  2025-12-30 06:28:04,422 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767076084.4227674 for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:04.432807324Z [err]  2025-12-30 06:28:04,422 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:04.432814445Z [err]  2025-12-30 06:28:04,428 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:grbDJkmu7q7-nCqb7... (active sessions: [])
2025-12-30T06:28:04.896943703Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - ‚è±Ô∏è [06:28:04.895] ‚úÖ Node selected, about to process content...
2025-12-30T06:28:04.896947905Z [err]  2025-12-30 06:28:04,888 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-30T06:28:04.896954269Z [err]  2025-12-30 06:28:04,894 - core_calling_service - INFO - ‚è±Ô∏è [06:28:04.894] üîÄ TRANSITION EVALUATION COMPLETE - took 981ms
2025-12-30T06:28:04.896954720Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - üîß Replaced {{now}} with Tuesday, December 30, 2025 at 1:28 AM EST in content
2025-12-30T06:28:04.896959869Z [err]  2025-12-30 06:28:04,894 - core_calling_service - INFO - ü§ñ AI transition decision: '-1'
2025-12-30T06:28:04.896963828Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-30T06:28:04.896967296Z [err]  2025-12-30 06:28:04,894 - core_calling_service - INFO - üìä Available transitions: ['Confirms name (Yes|Speaking|This is he/she) OR Ask...', 'Wrong number (No John here|Wrong number|etc) - don...']
2025-12-30T06:28:04.896971606Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-30T06:28:04.896973499Z [err]  2025-12-30 06:28:04,894 - core_calling_service - INFO - Selected transition index: -1
2025-12-30T06:28:04.896977785Z [err]  2025-12-30 06:28:04,894 - core_calling_service - INFO - No specific condition matched, looking for default transition...
2025-12-30T06:28:04.896982683Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - ‚ö†Ô∏è No transition matched, but node has GOAL. Staying on current node to continue with goal-based guidance.
2025-12-30T06:28:04.896987391Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - üéØ Goal: Say the customer's name...
2025-12-30T06:28:04.896991727Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 989ms
2025-12-30T06:28:04.897899305Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-30T06:28:04.897902124Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-30T06:28:04.897909654Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-30T06:28:04.897911658Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-30T06:28:04.897917085Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-30T06:28:04.897921018Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-30T06:28:04.897925028Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-30T06:28:04.897930774Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-30T06:28:04.897934050Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-30T06:28:04.897939571Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - ‚è±Ô∏è [06:28:04.895] üìÑ About to process content (mode=script, length=9)
2025-12-30T06:28:04.897942506Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-30T06:28:04.897949921Z [err]  2025-12-30 06:28:04,895 - core_calling_service - INFO - üîÑ Dynamic rephrase enabled - generating natural variation of script
2025-12-30T06:28:04.897956888Z [err]  2025-12-30 06:28:04,895 - core_calling_service - ERROR - Error generating rephrased script: No module named 'api_key_service'
2025-12-30T06:28:04.898557458Z [err]  2025-12-30 06:28:04,895 - server - INFO - üì§ Sentence arrived from LLM: Let me say that again - Kendrick?...
2025-12-30T06:28:04.898564990Z [err]  2025-12-30 06:28:04,895 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 1101ms
2025-12-30T06:28:04.898571465Z [err]  2025-12-30 06:28:04,895 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-30T06:28:04.898578020Z [err]  2025-12-30 06:28:04,895 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:grbDJkmu7q7-nCqb7... (active sessions: [])
2025-12-30T06:28:04.898584391Z [err]  2025-12-30 06:28:04,895 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-30T06:28:04.944858132Z [err]  2025-12-30 06:28:04,933 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:grbDJkmu7q7-nCqb7... (active sessions: [])
2025-12-30T06:28:04.970355055Z [err]  2025-12-30 06:28:04,960 - server - INFO - üì§ Audio flowing: 311 packets sent to Soniox (5s update)
2025-12-30T06:28:04.992219759Z [err]  2025-12-30 06:28:04,983 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:28:05.075436903Z [err]  2025-12-30 06:28:05,070 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:28:05.165779732Z [err]  2025-12-30 06:28:05,157 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:28:05.188150197Z [err]  2025-12-30 06:28:05,178 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:28:05.188158640Z [err]  2025-12-30 06:28:05,179 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-30T06:28:05.188165682Z [err]  2025-12-30 06:28:05,179 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-30T06:28:05.188172792Z [err]  2025-12-30 06:28:05,179 - persistent_tts_service - INFO - üîå [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] Establishing persistent TTS WebSocket...
2025-12-30T06:28:05.188180183Z [err]  2025-12-30 06:28:05,179 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-30T06:28:05.188186646Z [err]  2025-12-30 06:28:05,179 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-30T06:28:05.188193117Z [err]  2025-12-30 06:28:05,179 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-30T06:28:05.312659596Z [err]  2025-12-30 06:28:05,310 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-30T06:28:05.312667528Z [err]  2025-12-30 06:28:05,311 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-30T06:28:05.312678660Z [err]  2025-12-30 06:28:05,311 - persistent_tts_service - INFO - ‚úÖ [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] Persistent TTS WebSocket established
2025-12-30T06:28:05.312683721Z [err]  2025-12-30 06:28:05,311 - persistent_tts_service - INFO - üéß [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] Audio receiver loop started
2025-12-30T06:28:05.312688840Z [err]  2025-12-30 06:28:05,311 - persistent_tts_service - INFO - üîä [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] Comfort noise loop started
2025-12-30T06:28:05.312694070Z [err]  2025-12-30 06:28:05,311 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:05.312698882Z [err]  2025-12-30 06:28:05,311 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-30T06:28:05.312704923Z [err]  2025-12-30 06:28:05,311 - server - INFO - üîç Persistent TTS lookup: call_id=v3:grbDJkmu7q7-nCqb7..., session=FOUND
2025-12-30T06:28:05.312709543Z [err]  2025-12-30 06:28:05,311 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-30T06:28:05.312714072Z [err]  2025-12-30 06:28:05,311 - server - INFO - üéµ TTS task #1 started at +415ms
2025-12-30T06:28:05.312718829Z [err]  2025-12-30 06:28:05,311 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 1517ms
2025-12-30T06:28:05.312723608Z [err]  2025-12-30 06:28:05,311 - core_calling_service - INFO - üîÑ Rephrased script: Let me say that again - Kendrick?...
2025-12-30T06:28:05.312732864Z [err]  2025-12-30 06:28:05,311 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user gave meaningful response) for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:05.313715773Z [err]  2025-12-30 06:28:05,311 - core_calling_service - INFO - üîä Silence tracking reset for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g (user responded)
2025-12-30T06:28:05.313722958Z [err]  2025-12-30 06:28:05,311 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-30T06:28:05.313727538Z [err]  2025-12-30 06:28:05,311 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-30T06:28:05.313732308Z [err]  2025-12-30 06:28:05,311 - core_calling_service - INFO - LLM response (1.42s): Let me say that again - Kendrick?
2025-12-30T06:28:05.313737048Z [err]  2025-12-30 06:28:05,311 - core_calling_service - INFO - Total latency: 1.42s
2025-12-30T06:28:05.313741000Z [err]  2025-12-30 06:28:05,311 - server - INFO - ‚úÖ LLM finished in 1517ms, TTS tasks already running in background
2025-12-30T06:28:05.313744705Z [err]  2025-12-30 06:28:05,311 - server - INFO - üéµ Streaming 1 TTS chunks as they complete...
2025-12-30T06:28:05.313748761Z [err]  2025-12-30 06:28:05,311 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-30T06:28:05.313757308Z [err]  2025-12-30 06:28:05,311 - server - INFO -    1 sentences queued and playing seamlessly
2025-12-30T06:28:05.313761674Z [err]  2025-12-30 06:28:05,311 - persistent_tts_service - INFO - üéµ [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] Playback consumer started
2025-12-30T06:28:05.313765311Z [err]  2025-12-30 06:28:05,311 - persistent_tts_service - INFO - üéß [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] Audio Receiver Loop STARTED
2025-12-30T06:28:05.313769013Z [err]  2025-12-30 06:28:05,311 - persistent_tts_service - INFO - üíì [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] Starting TTS keep-alive loop (every 15s)
2025-12-30T06:28:05.313772667Z [err]  2025-12-30 06:28:05,311 - persistent_tts_service - INFO - üîä [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] Starting comfort noise loop
2025-12-30T06:28:05.314887151Z [err]  2025-12-30 06:28:05,312 - persistent_tts_service - INFO - üé§ [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] Streaming sentence #1: Let me say that again - Kendrick?...
2025-12-30T06:28:05.314894550Z [err]  2025-12-30 06:28:05,312 - persistent_tts_service - INFO - üöÄ [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-30T06:28:05.314900140Z [err]  2025-12-30 06:28:05,312 - persistent_tts_service - INFO - üìä [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-30T06:28:05.314907265Z [err]  2025-12-30 06:28:05,312 - persistent_tts_service - INFO - üéß [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] Receiver processing sentence #1: 'Let me say that again - Kendri...'
2025-12-30T06:28:05.314913513Z [err]  2025-12-30 06:28:05,312 - persistent_tts_service - INFO - üìä [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] DIAGNOSTIC: queue_latency=0ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-30T06:28:05.314920311Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚úÖ All 1 persistent TTS streams completed
2025-12-30T06:28:05.314926160Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-30T06:28:05.314932204Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 1518ms from user stop üöÄ
2025-12-30T06:28:05.314937631Z [err]  2025-12-30 06:28:05,312 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:05.314942823Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-30T06:28:05.314949194Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T06:28:05.316150174Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-30T06:28:05.316154553Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: 'Let me say that again - Kendrick?...'
2025-12-30T06:28:05.316156601Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 5ms (provider: soniox, model: stt-rt-v3)
2025-12-30T06:28:05.316161420Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 1517ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-30T06:28:05.316166959Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 416ms (provider: elevenlabs, websocket: False)
2025-12-30T06:28:05.316171045Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 1518ms (user stopped ‚Üí play_audio_url called)
2025-12-30T06:28:05.316175015Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-30T06:28:05.316178986Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-30T06:28:05.316184388Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-30T06:28:05.316188307Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-30T06:28:05.316192202Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-30T06:28:05.316195922Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 1818ms estimated
2025-12-30T06:28:05.316200211Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 33 chars, 1 sentences
2025-12-30T06:28:05.316204551Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Hello?...'
2025-12-30T06:28:05.316995909Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-30T06:28:05.317003678Z [err]  2025-12-30 06:28:05,312 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T06:28:05.504707128Z [err]  2025-12-30 06:28:05,501 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 1938ms)
2025-12-30T06:28:05.504713306Z [err]  2025-12-30 06:28:05,501 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-30T06:28:05.504717761Z [err]  2025-12-30 06:28:05,502 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-30T06:28:05.622124212Z [err]  2025-12-30 06:28:05,588 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 276ms
2025-12-30T06:28:05.622129258Z [err]  2025-12-30 06:28:05,588 - persistent_tts_service - INFO - üì§ Sending 17074 bytes of audio (107 chunks, 2.1s duration) via WebSocket
2025-12-30T06:28:05.622134792Z [err]  2025-12-30 06:28:05,588 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-30T06:28:05.622138926Z [err]  2025-12-30 06:28:05,588 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +2.1s (total: 2.1s from now)
2025-12-30T06:28:05.622142770Z [err]  2025-12-30 06:28:05,590 - persistent_tts_service - INFO - ‚úÖ Sent 107 audio chunks via WebSocket
2025-12-30T06:28:05.963907280Z [err]  2025-12-30 06:28:05,956 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (1.8s left)
2025-12-30T06:28:07.591518936Z [err]  2025-12-30 06:28:07,588 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-30T06:28:07.591529053Z [err]  2025-12-30 06:28:07,590 - persistent_tts_service - INFO - ‚úÖ [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] Receiver finished sentence #1: 1 chunks in 2277ms
2025-12-30T06:28:08.002635129Z [err]  2025-12-30 06:28:08,001 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (0.3s ago), marking agent as done speaking
2025-12-30T06:28:08.002649006Z [err]  2025-12-30 06:28:08,001 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767076088.0013595 for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:08.002660288Z [err]  2025-12-30 06:28:08,001 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:08.024985164Z [err]  2025-12-30 06:28:08,022 - persistent_tts_service - INFO - üîá [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] FLOOR RELEASED (is_holding_floor=False)
2025-12-30T06:28:09.963888389Z [err]  2025-12-30 06:28:09,961 - server - INFO - üì§ Audio flowing: 561 packets sent to Soniox (5s update)
2025-12-30T06:28:10.027030929Z [err]  2025-12-30 06:28:10,024 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=2.0s, checkin_count=0/2
2025-12-30T06:28:10.172589275Z [err]  2025-12-30 06:28:10,113 - server - INFO - üé§ Soniox receiver alive - 12 messages received in last 10s
2025-12-30T06:28:10.533042379Z [err]  2025-12-30 06:28:10,531 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=2.5s, checkin_count=0/2
2025-12-30T06:28:12.310556510Z [err]  2025-12-30 06:28:12,291 - server - INFO - üî§ RAW TOKENS: [" H"?]
2025-12-30T06:28:12.310566457Z [err]  2025-12-30 06:28:12,292 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user started speaking) for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:12.310574167Z [err]  2025-12-30 06:28:12,292 - core_calling_service - INFO - üîä Silence timer reset for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g (user started speaking)
2025-12-30T06:28:12.310580668Z [err]  2025-12-30 06:28:12,292 - core_calling_service - INFO - üë§ User started speaking for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:12.310586720Z [err]  2025-12-30 06:28:12,292 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-30T06:28:12.310592442Z [err]  2025-12-30 06:28:12,292 - server - INFO - üîç PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-30T06:28:12.564183712Z [err]  2025-12-30 06:28:12,556 - server - INFO - üî§ RAW TOKENS: [" H"?, "ello"?]
2025-12-30T06:28:12.564195687Z [err]  2025-12-30 06:28:12,556 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Hello' | Generating: False
2025-12-30T06:28:12.622248572Z [err]  2025-12-30 06:28:12,621 - server - INFO - ‚è±Ô∏è [06:28:12.621] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-30T06:28:12.622254277Z [err]  2025-12-30 06:28:12,620 - server - INFO - üî§ RAW TOKENS: [" H"‚úì, "ello"‚úì, "?"‚úì, "<end>"‚úì]
2025-12-30T06:28:12.622258872Z [err]  2025-12-30 06:28:12,620 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-30T06:28:12.622263062Z [err]  2025-12-30 06:28:12,621 - server - INFO - ‚è±Ô∏è User spoke at 1767076092.621311
2025-12-30T06:28:12.622264459Z [err]  2025-12-30 06:28:12,620 - server - INFO - üßπ Cleaned transcript: ' H ello ?' -> 'Hello?'
2025-12-30T06:28:12.622269393Z [err]  2025-12-30 06:28:12,620 - server - INFO - üì• FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-30T06:28:12.622273355Z [err]  2025-12-30 06:28:12,620 - server - INFO - üé§ Soniox final transcript: 'Hello?'
2025-12-30T06:28:12.622277740Z [err]  2025-12-30 06:28:12,621 - server - INFO - üîç FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-30T06:28:12.622282279Z [err]  2025-12-30 06:28:12,621 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-30T06:28:12.622286507Z [err]  2025-12-30 06:28:12,621 - server - INFO - ‚è±Ô∏è [06:28:12.621] üìù FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-30T06:28:12.622290577Z [err]  2025-12-30 06:28:12,621 - server - INFO - ‚è±Ô∏è [06:28:12.621] STT endpoint detection latency: 21ms
2025-12-30T06:28:12.628404413Z [err]  2025-12-30 06:28:12,626 - redis_service - INFO - üì¶ Stored call data in Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g (TTL: 3600s)
2025-12-30T06:28:12.628412363Z [err]  2025-12-30 06:28:12,627 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-30T06:28:12.628419076Z [err]  2025-12-30 06:28:12,627 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-30T06:28:12.642088174Z [err]  2025-12-30 06:28:12,637 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-30T06:28:12.642098256Z [err]  2025-12-30 06:28:12,637 - core_calling_service - INFO - üë§ User stopped speaking for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:12.642106398Z [err]  2025-12-30 06:28:12,640 - server - INFO - ‚úÖ User starting new turn - resetting agent speaking flag
2025-12-30T06:28:12.642114142Z [err]  2025-12-30 06:28:12,640 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-30T06:28:12.642121106Z [err]  2025-12-30 06:28:12,640 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+13ms
2025-12-30T06:28:12.642129521Z [err]  2025-12-30 06:28:12,640 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 13ms (Soniox model: stt-rt-v3)
2025-12-30T06:28:12.642136808Z [err]  2025-12-30 06:28:12,640 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-30T06:28:12.642143968Z [err]  2025-12-30 06:28:12,640 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-30T06:28:12.642151187Z [err]  2025-12-30 06:28:12,640 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:12.736448590Z [err]  2025-12-30 06:28:12,734 - server - INFO - üìù Saved user transcript to database
2025-12-30T06:28:12.736456583Z [err]  2025-12-30 06:28:12,734 - core_calling_service - INFO - ‚è±Ô∏è [06:28:12.734] üì• process_user_input() ENTRY - text: 'Hello?...'
2025-12-30T06:28:12.744171948Z [err]  2025-12-30 06:28:12,740 - redis_service - INFO - üì• Retrieved call data from Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:12.744179649Z [err]  2025-12-30 06:28:12,740 - core_calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g: User spoke while Silence Greeting was triggering
2025-12-30T06:28:12.896622169Z [err]  2025-12-30 06:28:12,762 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:28:12.896628636Z [err]  2025-12-30 06:28:12,762 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:13.104510554Z [err]  2025-12-30 06:28:13,081 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g/actions/playback_stop "HTTP/1.1 200 OK"
2025-12-30T06:28:13.104515530Z [err]  2025-12-30 06:28:13,082 - telnyx_service - INFO - ‚úÖ Successfully stopped audio playback
2025-12-30T06:28:13.104519513Z [err]  2025-12-30 06:28:13,083 - core_calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-30T06:28:13.104524203Z [err]  2025-12-30 06:28:13,083 - core_calling_service - INFO - ‚úÖ BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-30T06:28:13.104529063Z [err]  2025-12-30 06:28:13,088 - redis_service - INFO - üì• Retrieved call data from Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:13.104534804Z [err]  2025-12-30 06:28:13,094 - redis_service - INFO - üì¶ Stored call data in Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g (TTL: 3600s)
2025-12-30T06:28:13.104538905Z [err]  2025-12-30 06:28:13,094 - core_calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-30T06:28:13.104542854Z [err]  2025-12-30 06:28:13,094 - core_calling_service - INFO - ‚è±Ô∏è [06:28:13.094] ‚è© About to call _process_call_flow_streaming()
2025-12-30T06:28:13.104547089Z [err]  2025-12-30 06:28:13,094 - core_calling_service - INFO - ‚è±Ô∏è [06:28:13.094] üîÄ Agent type: call_flow, calling flow processor...
2025-12-30T06:28:13.104551374Z [err]  2025-12-30 06:28:13,094 - core_calling_service - INFO - ‚è±Ô∏è [06:28:13.094] üîÄ _process_call_flow_streaming() ENTRY
2025-12-30T06:28:13.104555534Z [err]  2025-12-30 06:28:13,094 - core_calling_service - INFO - Flow processing - History length: 6, Is first: False
2025-12-30T06:28:13.104559656Z [err]  2025-12-30 06:28:13,094 - core_calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-30T06:28:13.104563679Z [err]  2025-12-30 06:28:13,094 - core_calling_service - INFO - ‚è±Ô∏è [06:28:13.094] üîÄ About to call _follow_transition() for: Hello?...
2025-12-30T06:28:13.104746773Z [err]  2025-12-30 06:28:13,094 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Hello?
2025-12-30T06:28:13.104755009Z [err]  2025-12-30 06:28:13,094 - core_calling_service - INFO - üîç Checking 'Hello=Yes' override [DEPLOYMENT VERIFIED] for msg='hello' on node='Greeting'
2025-12-30T06:28:13.104762496Z [err]  2025-12-30 06:28:13,094 - core_calling_service - WARNING - ‚ö†Ô∏è Auto-transition after response target not found: None, falling back to normal evaluation
2025-12-30T06:28:13.104769518Z [err]  2025-12-30 06:28:13,102 - core_calling_service - INFO - ‚è±Ô∏è [06:28:13.102] üîÄ TRANSITION EVALUATION START - Calling LLM for 2 options
2025-12-30T06:28:14.102185828Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - ‚è±Ô∏è [06:28:14.092] ‚úÖ Node selected, about to process content...
2025-12-30T06:28:14.102192123Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - üîß Replaced {{now}} with Tuesday, December 30, 2025 at 1:28 AM EST in content
2025-12-30T06:28:14.102196808Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-30T06:28:14.102201666Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-30T06:28:14.102215511Z [err]  2025-12-30 06:28:14,090 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-30T06:28:14.102224757Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - ‚è±Ô∏è [06:28:14.091] üîÄ TRANSITION EVALUATION COMPLETE - took 989ms
2025-12-30T06:28:14.102232758Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - ü§ñ AI transition decision: '-1'
2025-12-30T06:28:14.102240002Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - üìä Available transitions: ['Confirms name (Yes|Speaking|This is he/she) OR Ask...', 'Wrong number (No John here|Wrong number|etc) - don...']
2025-12-30T06:28:14.102245826Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - Selected transition index: -1
2025-12-30T06:28:14.102250426Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - No specific condition matched, looking for default transition...
2025-12-30T06:28:14.102255193Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - ‚ö†Ô∏è No transition matched, but node has GOAL. Staying on current node to continue with goal-based guidance.
2025-12-30T06:28:14.102263496Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - üéØ Goal: Say the customer's name...
2025-12-30T06:28:14.102269644Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 997ms
2025-12-30T06:28:14.103001440Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-30T06:28:14.103008250Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-30T06:28:14.103010489Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-30T06:28:14.103015117Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-30T06:28:14.103020437Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-30T06:28:14.103023134Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - ‚è±Ô∏è [06:28:14.092] üìÑ About to process content (mode=script, length=9)
2025-12-30T06:28:14.103026718Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-30T06:28:14.103033452Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-30T06:28:14.103034045Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - üîÑ Dynamic rephrase enabled - generating natural variation of script
2025-12-30T06:28:14.103038381Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-30T06:28:14.103044395Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-30T06:28:14.103044953Z [err]  2025-12-30 06:28:14,092 - core_calling_service - ERROR - Error generating rephrased script: No module named 'api_key_service'
2025-12-30T06:28:14.103050126Z [err]  2025-12-30 06:28:14,092 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-30T06:28:14.103951840Z [err]  2025-12-30 06:28:14,093 - core_calling_service - INFO - üîÑ Rephrased script: Let me say that again - Kendrick?...
2025-12-30T06:28:14.103952357Z [err]  2025-12-30 06:28:14,092 - server - INFO - üì§ Sentence arrived from LLM: Let me say that again - Kendrick?...
2025-12-30T06:28:14.103958160Z [err]  2025-12-30 06:28:14,092 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 1452ms
2025-12-30T06:28:14.103963479Z [err]  2025-12-30 06:28:14,093 - core_calling_service - INFO - üîä Silence tracking reset for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g (user responded)
2025-12-30T06:28:14.103964005Z [err]  2025-12-30 06:28:14,093 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-30T06:28:14.103968855Z [err]  2025-12-30 06:28:14,093 - server - INFO - üîç Persistent TTS lookup: call_id=v3:grbDJkmu7q7-nCqb7..., session=FOUND
2025-12-30T06:28:14.103974357Z [err]  2025-12-30 06:28:14,093 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-30T06:28:14.103974482Z [err]  2025-12-30 06:28:14,093 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-30T06:28:14.103979618Z [err]  2025-12-30 06:28:14,093 - server - INFO - üéµ TTS task #1 started at +0ms
2025-12-30T06:28:14.103984952Z [err]  2025-12-30 06:28:14,093 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-30T06:28:14.103984967Z [err]  2025-12-30 06:28:14,093 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 1452ms
2025-12-30T06:28:14.103993086Z [err]  2025-12-30 06:28:14,093 - core_calling_service - INFO - LLM response (1.36s): Let me say that again - Kendrick?
2025-12-30T06:28:14.104000411Z [err]  2025-12-30 06:28:14,093 - core_calling_service - INFO - Total latency: 1.36s
2025-12-30T06:28:14.104008089Z [err]  2025-12-30 06:28:14,094 - server - INFO - ‚úÖ LLM finished in 1453ms, TTS tasks already running in background
2025-12-30T06:28:14.105047721Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚úÖ All 1 persistent TTS streams completed
2025-12-30T06:28:14.105053996Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-30T06:28:14.105058499Z [err]  2025-12-30 06:28:14,094 - server - INFO - üéµ Streaming 1 TTS chunks as they complete...
2025-12-30T06:28:14.105059895Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 1454ms from user stop üöÄ
2025-12-30T06:28:14.105064984Z [err]  2025-12-30 06:28:14,095 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:14.105069073Z [err]  2025-12-30 06:28:14,094 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-30T06:28:14.105076108Z [err]  2025-12-30 06:28:14,094 - server - INFO -    1 sentences queued and playing seamlessly
2025-12-30T06:28:14.105082470Z [err]  2025-12-30 06:28:14,094 - persistent_tts_service - INFO - üé§ [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] Streaming sentence #2: Let me say that again - Kendrick?...
2025-12-30T06:28:14.105089187Z [err]  2025-12-30 06:28:14,094 - persistent_tts_service - INFO - üöÄ [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] Sent sentence #2 (NON-BLOCKING) in 0ms
2025-12-30T06:28:14.105097626Z [err]  2025-12-30 06:28:14,094 - persistent_tts_service - INFO - üìä [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-30T06:28:14.105104997Z [err]  2025-12-30 06:28:14,094 - persistent_tts_service - INFO - üéß [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] Receiver processing sentence #2: 'Let me say that again - Kendri...'
2025-12-30T06:28:14.105112345Z [err]  2025-12-30 06:28:14,095 - persistent_tts_service - INFO - üìä [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] DIAGNOSTIC: queue_latency=0ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-30T06:28:14.106159330Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-30T06:28:14.106167357Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T06:28:14.106174150Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-30T06:28:14.106176835Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-30T06:28:14.106183945Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 2ms (provider: elevenlabs, websocket: False)
2025-12-30T06:28:14.106184435Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 1754ms estimated
2025-12-30T06:28:14.106187431Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 13ms (provider: soniox, model: stt-rt-v3)
2025-12-30T06:28:14.106193697Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 33 chars, 1 sentences
2025-12-30T06:28:14.106196257Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 1454ms (user stopped ‚Üí play_audio_url called)
2025-12-30T06:28:14.106196749Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 1453ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-30T06:28:14.106205028Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-30T06:28:14.106213377Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-30T06:28:14.106220567Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-30T06:28:14.106228055Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-30T06:28:14.107023751Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Hello?...'
2025-12-30T06:28:14.107030370Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: 'Let me say that again - Kendrick?...'
2025-12-30T06:28:14.107037743Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-30T06:28:14.107044188Z [err]  2025-12-30 06:28:14,095 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T06:28:14.293489050Z [err]  2025-12-30 06:28:14,283 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 1468ms)
2025-12-30T06:28:14.293496510Z [err]  2025-12-30 06:28:14,283 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-30T06:28:14.293500406Z [err]  2025-12-30 06:28:14,283 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-30T06:28:14.424930605Z [err]  2025-12-30 06:28:14,417 - persistent_tts_service - INFO - üì§ Sending 13746 bytes of audio (86 chunks, 1.7s duration) via WebSocket
2025-12-30T06:28:14.424935248Z [err]  2025-12-30 06:28:14,417 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-30T06:28:14.424939514Z [err]  2025-12-30 06:28:14,417 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.7s (total: 1.7s from now)
2025-12-30T06:28:14.424943608Z [err]  2025-12-30 06:28:14,418 - persistent_tts_service - INFO - ‚úÖ Sent 86 audio chunks via WebSocket
2025-12-30T06:28:14.970486886Z [err]  2025-12-30 06:28:14,963 - server - INFO - üì§ Audio flowing: 811 packets sent to Soniox (5s update)
2025-12-30T06:28:15.113910155Z [err]  2025-12-30 06:28:15,111 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (1.0s left)
2025-12-30T06:28:15.634659539Z [err]  2025-12-30 06:28:15,623 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (0.5s left)
2025-12-30T06:28:16.430371011Z [err]  2025-12-30 06:28:16,417 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-30T06:28:16.430378017Z [err]  2025-12-30 06:28:16,417 - persistent_tts_service - INFO - ‚úÖ [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] Receiver finished sentence #2: 1 chunks in 2322ms
2025-12-30T06:28:16.430382441Z [err]  2025-12-30 06:28:16,418 - persistent_tts_service - INFO - üîá [Call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g] FLOOR RELEASED (is_holding_floor=False)
2025-12-30T06:28:16.649527891Z [err]  2025-12-30 06:28:16,648 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (0.5s ago), marking agent as done speaking
2025-12-30T06:28:16.649535737Z [err]  2025-12-30 06:28:16,648 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767076096.6482778 for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:16.649543233Z [err]  2025-12-30 06:28:16,648 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:17.686108666Z [err]  2025-12-30 06:28:17,662 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 941 total packets
2025-12-30T06:28:17.686119105Z [err]  [2025-12-30 06:28:17 +0000] [3] [INFO] connection closed
2025-12-30T06:28:17.969696145Z [err]  2025-12-30 06:28:17,842 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:28:17.969701241Z [err]  2025-12-30 06:28:17,842 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '2cc7563c-1bcc-4471-98ed-e010d635123e', 'occurred_at': '2025-12-30T06:28:17.558809Z', 'payload': {'call_control_id': 'v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g', 'call_leg_id': 'ab7aeb8c-e548-11f0-ac8b-02420aef971f', 'call_session_id': 'ab78b592-e548-11f0-b2ce-02420aef971f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T06:28:17.558809Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': '8BbVhZyeYg', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:28:17.969706043Z [err]  2025-12-30 06:28:17,842 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:17.969710204Z [err]  2025-12-30 06:28:17,842 - server - INFO - üì® ================================================
2025-12-30T06:28:17.969714051Z [err]  2025-12-30 06:28:17,850 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:28:17.969718506Z [err]  2025-12-30 06:28:17,850 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': '6614c9bd-2567-4a02-a1d4-236db28e87fd', 'occurred_at': '2025-12-30T06:28:17.478812Z', 'payload': {'call_control_id': 'v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g', 'call_leg_id': 'ab7aeb8c-e548-11f0-ac8b-02420aef971f', 'call_quality_stats': {'inbound': {'jitter_max_variance': '23.08', 'jitter_packet_count': '0', 'mos': '4.49', 'packet_count': '995', 'skip_packet_count': '18'}, 'outbound': {'packet_count': '940', 'skip_packet_count': '0'}}, 'call_session_id': 'ab78b592-e548-11f0-b2ce-02420aef971f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T06:28:17.478812Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-30T06:27:52.738811Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:28:17.970295519Z [err]  2025-12-30 06:28:17,850 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:17.970303980Z [err]  2025-12-30 06:28:17,850 - server - INFO - üì® ================================================
2025-12-30T06:28:17.970311271Z [err]  2025-12-30 06:28:17,850 - server - INFO - üìû Call ended: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:17.970317096Z [err]  2025-12-30 06:28:17,851 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-30T06:28:17.970322683Z [err]  2025-12-30 06:28:17,859 - redis_service - INFO - ‚ûñ Removed playback 8BbVhZyeYg, 0 remaining for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:17.970328790Z [err]  2025-12-30 06:28:17,859 - server - INFO - üîä Redis: Removed playback 8BbVhZyeYg, 0 remaining
2025-12-30T06:28:17.970334431Z [err]  2025-12-30 06:28:17,859 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-30T06:28:17.970341070Z [err]  2025-12-30 06:28:17,864 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-30T06:28:17.970352824Z [err]  2025-12-30 06:28:17,865 - server - INFO - üí° Session not on this worker - Redis flag set for WebSocket worker to handle
2025-12-30T06:28:17.970359096Z [inf]  100.64.0.10:22002 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:28:17.970365409Z [err]  2025-12-30 06:28:17,891 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:28:17.970371689Z [err]  2025-12-30 06:28:17,891 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': '95e93475-f04d-4f87-a254-fda702580d98', 'occurred_at': '2025-12-30T06:28:17.634274Z', 'payload': {'call_control_id': 'v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g', 'call_leg_id': 'ab7aeb8c-e548-11f0-ac8b-02420aef971f', 'call_session_id': 'ab78b592-e548-11f0-b2ce-02420aef971f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '8dd28949-3165-42e9-a980-ca7a9d26d7a0', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:28:17.971650364Z [err]  2025-12-30 06:28:17,891 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:17.971659704Z [err]  2025-12-30 06:28:17,891 - server - INFO - üì® ================================================
2025-12-30T06:28:17.971668459Z [inf]  100.64.0.9:60282 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:28:18.041546070Z [err]  2025-12-30 06:28:18,038 - server - INFO - üìù Updated call log: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:18.140457476Z [err]  2025-12-30 06:28:18,132 - server - INFO - ‚úÖ Finalized call log: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g (duration=19s, status=completed)
2025-12-30T06:28:18.881753562Z [err]  2025-12-30 06:28:18,838 - server - INFO - üìä Auto-added call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-30T06:28:19.093217419Z [err]  2025-12-30 06:28:19,021 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T06:28:19.093230329Z [err]  2025-12-30 06:28:19,033 - redis_service - INFO - üì• Retrieved call data from Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:19.093240273Z [err]  2025-12-30 06:28:19,033 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=No
2025-12-30T06:28:19.093251550Z [err]  2025-12-30 06:28:19,033 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-30T06:28:19.137757690Z [err]  2025-12-30 06:28:19,126 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-30T06:28:19.231176116Z [err]  2025-12-30 06:28:19,227 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-30T06:28:19.231184549Z [err]  2025-12-30 06:28:19,228 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-30T06:28:19.231192022Z [err]  2025-12-30 06:28:19,228 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-30T06:28:19.231198821Z [err]  2025-12-30 06:28:19,228 - server - INFO - üöÄ Triggered QC analysis for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:19.231206339Z [err]  2025-12-30 06:28:19,228 - server - INFO - üìä Triggered Campaign QC for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:19.231213648Z [err]  2025-12-30 06:28:19,228 - server - INFO - üìá Triggered CRM update for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:19.231220431Z [err]  2025-12-30 06:28:19,228 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:19.237415029Z [err]  2025-12-30 06:28:19,233 - redis_service - INFO - üßπ Deleted call data from Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:19.237424409Z [err]  2025-12-30 06:28:19,234 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:19.237432601Z [inf]  100.64.0.17:61510 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:28:19.237438985Z [err]  2025-12-30 06:28:19,234 - server - INFO - üîç Starting QC analysis for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:19.237444891Z [err]  2025-12-30 06:28:19,234 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-30T06:28:19.237451192Z [err]  2025-12-30 06:28:19,234 - server - INFO - üìá CRM update starting for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:28:19.237458022Z [err]  2025-12-30 06:28:19,234 - server - INFO - üìá Normalized phone: +17708336397
2025-12-30T06:28:19.243078162Z [err]  2025-12-30 06:28:19,239 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T06:28:19.243085741Z [err]  2025-12-30 06:28:19,239 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-30T06:28:19.329234737Z [err]  2025-12-30 06:28:19,326 - server - INFO - üìù Converted transcript from 5 messages to 136 characters
2025-12-30T06:28:19.329239461Z [err]  2025-12-30 06:28:19,327 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=5, logs_count=6, status=completed
2025-12-30T06:28:19.329243465Z [err]  2025-12-30 06:28:19,328 - server - INFO - üìá CRM: Total variables collected: []
2025-12-30T06:28:19.416475564Z [err]  2025-12-30 06:28:19,414 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:28:19.516744682Z [err]  2025-12-30 06:28:19,501 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-30T06:28:19.516750112Z [err]  2025-12-30 06:28:19,505 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name']
2025-12-30T06:28:19.596789701Z [err]  2025-12-30 06:28:19,589 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-30T06:28:19.596798149Z [err]  2025-12-30 06:28:19,589 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:28:19.596805557Z [err]  2025-12-30 06:28:19,589 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:19.766994756Z [err]  2025-12-30 06:28:19,766 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-30T06:28:19.791531270Z [err]  2025-12-30 06:28:19,780 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T06:28:19.791543067Z [err]  2025-12-30 06:28:19,781 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:28:19.791549477Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T06:28:19.791556780Z [err]  2025-12-30 06:28:19,781 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:28:19.791563857Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-30T06:28:19.791570180Z [err]  2025-12-30 06:28:19,781 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:19.858326255Z [err]  2025-12-30 06:28:19,855 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-30T06:28:19.858333509Z [err]  2025-12-30 06:28:19,855 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-30T06:28:19.858340289Z [err]  2025-12-30 06:28:19,855 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-30T06:28:19.858347211Z [err]  2025-12-30 06:28:19,855 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-30T06:28:19.858354227Z [err]    File "/app/backend/server.py", line 9773, in trigger_campaign_qc_for_call
2025-12-30T06:28:19.858360551Z [err]      await run_full_qc_analysis(
2025-12-30T06:28:19.858368031Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-30T06:28:19.858374622Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-30T06:28:19.858381033Z [err]  
2025-12-30T06:28:20.080063211Z [err]  2025-12-30 06:28:19,996 - server - INFO - üíæ Saved recording URL and ID to database: c8be5001-89e4-4368-99b4-d808e4c1c161
2025-12-30T06:28:20.080076092Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-30T06:28:20.080076714Z [err]  2025-12-30 06:28:19,996 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-30T06:28:20.080088711Z [err]  2025-12-30 06:28:19,996 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-30T06:28:20.080088715Z [err]  2025-12-30 06:28:19,980 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:20.080097689Z [err]  2025-12-30 06:28:19,902 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=c8be5001-89e4-4368-99b4-d808e4c1c161, call_data=True
2025-12-30T06:28:20.080107932Z [err]  2025-12-30 06:28:19,896 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:28:20.080120717Z [err]  2025-12-30 06:28:19,979 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T06:28:20.080120969Z [err]  2025-12-30 06:28:19,896 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': 'de00b19f-0f7c-4f30-8ce3-f1b6b7e76166', 'occurred_at': '2025-12-30T06:28:19.651364Z', 'payload': {'call_control_id': 'v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g', 'call_leg_id': 'ab7aeb8c-e548-11f0-ac8b-02420aef971f', 'call_session_id': 'ab78b592-e548-11f0-b2ce-02420aef971f', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T06:28:17.560609Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-30T06:28:17.560609Z', 'recording_id': 'c8be5001-89e4-4368-99b4-d808e4c1c161', 'recording_started_at': '2025-12-30T06:27:59.329860Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-30/ab7aeb8c-e548-11f0-ac8b-02420aef971f-1767076079281688.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251230%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251230T062819Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=d3539e9fb198a411d0ad3878da36e981e9d639a958534a0a264a661cf12c8579'}, 'start_time': '2025-12-30T06:27:59.329860Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:28:20.080135993Z [err]  2025-12-30 06:28:19,896 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:20.080137552Z [err]  2025-12-30 06:28:19,980 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:28:20.080150971Z [err]  2025-12-30 06:28:19,896 - server - INFO - üì® ================================================
2025-12-30T06:28:20.080151268Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T06:28:20.080165868Z [err]  2025-12-30 06:28:19,896 - server - INFO - üéôÔ∏è Recording saved for call: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:20.080165990Z [err]  2025-12-30 06:28:19,980 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:28:20.080177856Z [err]  2025-12-30 06:28:19,902 - redis_service - WARNING - ‚ö†Ô∏è Call data not found in Redis: v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:20.248577777Z [err]  2025-12-30 06:28:20,191 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T06:28:20.248587168Z [err]  2025-12-30 06:28:20,191 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=3.5s, checkin_count=0/2
2025-12-30T06:28:20.248600559Z [err]  2025-12-30 06:28:20,191 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:28:20.248609114Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T06:28:20.248617290Z [err]  2025-12-30 06:28:20,191 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:28:20.248625064Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T06:28:20.288494222Z [err]  2025-12-30 06:28:20,282 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:20.288500564Z [err]  2025-12-30 06:28:20,282 - server - INFO - ‚úÖ QC analysis completed for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:20.288507349Z [err]  2025-12-30 06:28:20,282 - server - INFO - üìä Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-30T06:28:20.449114904Z [err]  2025-12-30 06:28:20,392 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-30/ab7aeb8c-e548-11f0-ac8b-02420aef971f-1767076079281688.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251230%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251230T062819Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=d3539e9fb198a411d0ad3878da36e981e9d639a958534a0a264a661cf12c8579 "HTTP/1.1 200 OK"
2025-12-30T06:28:20.470213078Z [err]  2025-12-30 06:28:20,468 - server - INFO - üìä Updated campaign_calls with QC scores for v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:20.565008559Z [err]  2025-12-30 06:28:20,564 - server - INFO - ‚úÖ Downloaded 73185 bytes
2025-12-30T06:28:20.688609424Z [err]  2025-12-30 06:28:20,647 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-30T06:28:20.755092256Z [err]  2025-12-30 06:28:20,736 - server - INFO - üè∑Ô∏è Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-30T06:28:20.755097852Z [err]  2025-12-30 06:28:20,736 - server - ERROR - ‚ùå Error in auto appointment detection for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g: 'str' object has no attribute 'get'
2025-12-30T06:28:20.755102472Z [err]  2025-12-30 06:28:20,741 - server - INFO - ‚úÖ Split into 2 channels
2025-12-30T06:28:20.755108603Z [err]  2025-12-30 06:28:20,741 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-30T06:28:20.755113379Z [err]  2025-12-30 06:28:20,741 - server - INFO - üìä Channel 0: 399564 bytes
2025-12-30T06:28:20.755124145Z [err]  2025-12-30 06:28:20,748 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=4.1s, checkin_count=0/2
2025-12-30T06:28:20.834750773Z [err]  2025-12-30 06:28:20,829 - server - INFO - Soniox: Using user's DB API key (first 10 chars): b999f22d7b...
2025-12-30T06:28:20.834757997Z [err]  2025-12-30 06:28:20,829 - server - INFO - Soniox: Uploading audio file (0.38 MB)...
2025-12-30T06:28:20.834764214Z [err]  2025-12-30 06:28:20,830 - server - INFO - Soniox: Running curl upload command (HTTP/1.1)...
2025-12-30T06:28:20.834771102Z [err]  2025-12-30 06:28:20,831 - server - ERROR - Error transcribing audio file with Soniox: [Errno 2] No such file or directory: 'curl'
2025-12-30T06:28:21.072982077Z [err]    File "/app/backend/server.py", line 6039, in transcribe_audio_soniox_file
2025-12-30T06:28:21.072991262Z [err]      result = subprocess.run(curl_cmd, capture_output=True, text=True, timeout=300)
2025-12-30T06:28:21.072997208Z [err]               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-30T06:28:21.073002925Z [err]    File "/usr/local/lib/python3.11/subprocess.py", line 548, in run
2025-12-30T06:28:21.073009716Z [err]      with Popen(*popenargs, **kwargs) as process:
2025-12-30T06:28:21.073015388Z [err]           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-30T06:28:21.073021063Z [err]    File "/usr/local/lib/python3.11/subprocess.py", line 1026, in __init__
2025-12-30T06:28:21.073026814Z [err]      self._execute_child(args, executable, preexec_fn, close_fds,
2025-12-30T06:28:21.073031270Z [err]    File "/usr/local/lib/python3.11/subprocess.py", line 1955, in _execute_child
2025-12-30T06:28:21.073037180Z [err]      raise child_exception_type(errno_num, err_msg, err_filename)
2025-12-30T06:28:21.073038088Z [err]  2025-12-30 06:28:20,918 - server - ERROR - Traceback (most recent call last):
2025-12-30T06:28:21.073042746Z [err]  FileNotFoundError: [Errno 2] No such file or directory: 'curl'
2025-12-30T06:28:21.073049106Z [err]  
2025-12-30T06:28:21.073055265Z [err]  2025-12-30 06:28:20,918 - server - INFO - ‚ùå Channel 0: No speech
2025-12-30T06:28:21.073059009Z [err]  2025-12-30 06:28:20,918 - server - INFO - üìä Channel 1: 399564 bytes
2025-12-30T06:28:21.073062746Z [err]  2025-12-30 06:28:21,006 - server - INFO - Soniox: Using user's DB API key (first 10 chars): b999f22d7b...
2025-12-30T06:28:21.073067464Z [err]  2025-12-30 06:28:21,006 - server - INFO - Soniox: Uploading audio file (0.38 MB)...
2025-12-30T06:28:21.073071955Z [err]  2025-12-30 06:28:21,049 - server - INFO - Soniox: Running curl upload command (HTTP/1.1)...
2025-12-30T06:28:21.073076383Z [err]  2025-12-30 06:28:21,050 - server - ERROR - Error transcribing audio file with Soniox: [Errno 2] No such file or directory: 'curl'
2025-12-30T06:28:21.073991881Z [err]  2025-12-30 06:28:21,051 - server - ERROR - Traceback (most recent call last):
2025-12-30T06:28:21.074002997Z [err]    File "/app/backend/server.py", line 6039, in transcribe_audio_soniox_file
2025-12-30T06:28:21.074011010Z [err]      result = subprocess.run(curl_cmd, capture_output=True, text=True, timeout=300)
2025-12-30T06:28:21.074018998Z [err]               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-30T06:28:21.074026474Z [err]    File "/usr/local/lib/python3.11/subprocess.py", line 548, in run
2025-12-30T06:28:21.074035684Z [err]      with Popen(*popenargs, **kwargs) as process:
2025-12-30T06:28:21.074043257Z [err]           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-30T06:28:21.074050901Z [err]    File "/usr/local/lib/python3.11/subprocess.py", line 1026, in __init__
2025-12-30T06:28:21.074058240Z [err]      self._execute_child(args, executable, preexec_fn, close_fds,
2025-12-30T06:28:21.074066540Z [err]    File "/usr/local/lib/python3.11/subprocess.py", line 1955, in _execute_child
2025-12-30T06:28:21.074074163Z [err]      raise child_exception_type(errno_num, err_msg, err_filename)
2025-12-30T06:28:21.074081403Z [err]  FileNotFoundError: [Errno 2] No such file or directory: 'curl'
2025-12-30T06:28:21.074088933Z [err]  
2025-12-30T06:28:21.074096551Z [err]  2025-12-30 06:28:21,051 - server - INFO - ‚ùå Channel 1: No speech
2025-12-30T06:28:21.074105951Z [err]  2025-12-30 06:28:21,051 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-30T06:28:21.074114650Z [inf]  100.64.0.8:21412 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:28:23.793567513Z [err]  2025-12-30 06:28:23,784 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.1s silence (threshold: 7s)
2025-12-30T06:28:23.793582031Z [err]  2025-12-30 06:28:23,790 - core_calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-30T06:28:23.793592911Z [err]  2025-12-30 06:28:23,790 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.1s silence: Are you still there?
2025-12-30T06:28:23.793601426Z [err]  2025-12-30 06:28:23,790 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:23.793610017Z [err]  2025-12-30 06:28:23,790 - telnyx_service - INFO - üîä Speaking text on call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g: Are you still there?...
2025-12-30T06:28:23.793619263Z [err]  2025-12-30 06:28:23,790 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T06:28:23.793627966Z [err]  2025-12-30 06:28:23,790 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T06:28:23.793634343Z [err]  2025-12-30 06:28:23,790 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T06:28:23.793640557Z [err]  2025-12-30 06:28:23,790 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T06:28:23.793647465Z [err]  2025-12-30 06:28:23,790 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17181 bytes)
2025-12-30T06:28:23.793654551Z [err]  2025-12-30 06:28:23,790 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-30T06:28:23.793661136Z [err]  2025-12-30 06:28:23,790 - telnyx_service - INFO - ‚úÖ Generated 17181 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T06:28:23.793666848Z [err]  2025-12-30 06:28:23,790 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T06:28:24.084803548Z [err]    ]
2025-12-30T06:28:24.084815132Z [err]  }
2025-12-30T06:28:24.084823383Z [err]  2025-12-30 06:28:23,998 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-30T06:28:24.084884807Z [err]  2025-12-30 06:28:23,997 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T06:28:24.084888981Z [err]  2025-12-30 06:28:23,998 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.21s
2025-12-30T06:28:24.084893892Z [err]  2025-12-30 06:28:23,998 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-30T06:28:24.084898231Z [err]    "errors": [
2025-12-30T06:28:24.084902838Z [err]      {
2025-12-30T06:28:24.084906746Z [err]        "code": "90018",
2025-12-30T06:28:24.084910270Z [err]        "title": "Call has already ended",
2025-12-30T06:28:24.084914787Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-30T06:28:24.084919439Z [err]      }
2025-12-30T06:28:24.262051846Z [err]  2025-12-30 06:28:24,259 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T06:28:24.262057071Z [err]  2025-12-30 06:28:24,260 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-30T06:28:24.262061038Z [err]  2025-12-30 06:28:24,260 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-30T06:28:24.767851954Z [err]  2025-12-30 06:28:24,766 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-30T06:28:24.767862701Z [err]  2025-12-30 06:28:24,766 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767076104.7663298 for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:24.767871055Z [err]  2025-12-30 06:28:24,766 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:30.339805248Z [err]  2025-12-30 06:28:30,336 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=5.6s, checkin_count=1/2
2025-12-30T06:28:30.870037897Z [err]  2025-12-30 06:28:30,842 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=6.1s, checkin_count=1/2
2025-12-30T06:28:31.857052753Z [err]  2025-12-30 06:28:31,856 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.1s silence (threshold: 7s)
2025-12-30T06:28:31.862919388Z [err]  2025-12-30 06:28:31,861 - core_calling_service - INFO - üí¨ Sending FINAL check-in #2/2: Are you still there?
2025-12-30T06:28:31.862927999Z [err]  2025-12-30 06:28:31,861 - core_calling_service - INFO - ‚ö†Ô∏è Will end call if no response after next silence timeout
2025-12-30T06:28:31.862936539Z [err]  2025-12-30 06:28:31,861 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.1s silence: Are you still there?
2025-12-30T06:28:31.862945733Z [err]  2025-12-30 06:28:31,861 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:31.862951728Z [err]  2025-12-30 06:28:31,862 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T06:28:31.862951851Z [err]  2025-12-30 06:28:31,861 - telnyx_service - INFO - üîä Speaking text on call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g: Are you still there?...
2025-12-30T06:28:31.862958161Z [err]  2025-12-30 06:28:31,861 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T06:28:31.862964649Z [err]  2025-12-30 06:28:31,862 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T06:28:31.862965655Z [err]  2025-12-30 06:28:31,862 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T06:28:31.863764829Z [err]  2025-12-30 06:28:31,862 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17181 bytes)
2025-12-30T06:28:31.863772299Z [err]  2025-12-30 06:28:31,862 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-30T06:28:31.863780399Z [err]  2025-12-30 06:28:31,862 - telnyx_service - INFO - ‚úÖ Generated 17181 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T06:28:31.863787815Z [err]  2025-12-30 06:28:31,862 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T06:28:32.138741543Z [err]  }
2025-12-30T06:28:32.138750427Z [err]  2025-12-30 06:28:32,078 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-30T06:28:32.138789394Z [err]  2025-12-30 06:28:32,077 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T06:28:32.138794589Z [err]  2025-12-30 06:28:32,078 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.22s
2025-12-30T06:28:32.138798484Z [err]  2025-12-30 06:28:32,078 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-30T06:28:32.138803364Z [err]    "errors": [
2025-12-30T06:28:32.138807741Z [err]      {
2025-12-30T06:28:32.138812468Z [err]        "code": "90018",
2025-12-30T06:28:32.138816367Z [err]        "title": "Call has already ended",
2025-12-30T06:28:32.138821269Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-30T06:28:32.138825313Z [err]      }
2025-12-30T06:28:32.138829070Z [err]    ]
2025-12-30T06:28:32.356706013Z [err]  2025-12-30 06:28:32,351 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T06:28:32.356713894Z [err]  2025-12-30 06:28:32,351 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-30T06:28:32.356718751Z [err]  2025-12-30 06:28:32,351 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-30T06:28:37.824033032Z [err]  2025-12-30 06:28:37,792 - server - INFO - üé§ Soniox receiver alive - 9 messages received in last 10s
2025-12-30T06:28:37.824040350Z [err]  2025-12-30 06:28:37,792 - server - ERROR - ‚ùå Soniox error: {'tokens': [], 'final_audio_proc_ms': 13560, 'total_audio_proc_ms': 17880, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-30T06:28:37.824046559Z [err]  2025-12-30 06:28:37,792 - server - INFO - ‚úÖ Soniox receive loop ended normally
2025-12-30T06:28:37.824050855Z [err]  2025-12-30 06:28:37,792 - dead_air_monitor - INFO - üîá Dead air monitoring cancelled for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:37.824056183Z [err]  2025-12-30 06:28:37,792 - dead_air_monitor - INFO - üîá Dead air monitoring stopped for call v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g
2025-12-30T06:28:37.824060711Z [err]  2025-12-30 06:28:37,792 - server - INFO - üîá Dead air monitoring task cancelled
2025-12-30T06:28:39.811135944Z [err]  2025-12-30 06:28:39,793 - soniox_service - ERROR - ‚ùå Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-30T06:28:39.811148280Z [err]  2025-12-30 06:28:39,793 - server - INFO - üîå Telnyx WebSocket disconnected
2025-12-30T06:28:59.829253324Z [inf]  100.64.0.15:46176 - "GET /api/agents HTTP/1.1" 200
2025-12-30T06:28:59.829258316Z [inf]  100.64.0.15:46176 - "GET /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb HTTP/1.1" 200
2025-12-30T06:28:59.829262751Z [inf]  100.64.0.15:46182 - "GET /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/flow HTTP/1.1" 200
2025-12-30T06:32:40.911009703Z [inf]  100.64.0.5:21604 - "PUT /api/agents/bbeda238-e8d9-4d8c-b93b-1b7694581adb/flow HTTP/1.1" 200
2025-12-30T06:32:40.911014768Z [inf]  100.64.0.5:21604 - "GET /api/agents HTTP/1.1" 200
2025-12-30T06:32:48.425401026Z [inf]  100.64.0.15:61504 - "OPTIONS /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-30T06:32:49.093750508Z [err]  2025-12-30 06:32:49,083 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-30T06:32:49.173023255Z [err]  2025-12-30 06:32:49,171 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:32:49.264231224Z [err]  2025-12-30 06:32:49,260 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:32:49.293498538Z [err]  2025-12-30 06:32:49,290 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:32:49.293508365Z [err]  2025-12-30 06:32:49,290 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-30T06:32:49.293518381Z [err]  2025-12-30 06:32:49,290 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-30T06:32:49.293525960Z [err]  2025-12-30 06:32:49,290 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-30T06:32:50.110177037Z [err]  2025-12-30 06:32:50,102 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-30T06:32:50.110181267Z [err]  2025-12-30 06:32:50,103 - telnyx_service - INFO - ‚úÖ Call initiated: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:50.196935458Z [err]  2025-12-30 06:32:50,195 - server - INFO - üìù Created call log: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:50.196944274Z [err]  2025-12-30 06:32:50,195 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T06:32:50.196952398Z [err]  2025-12-30 06:32:50,195 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-30T06:32:50.198058510Z [err]  2025-12-30 06:32:50,195 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T06:32:50.198066706Z [err]  2025-12-30 06:32:50,195 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T06:32:50.232204621Z [err]  2025-12-30 06:32:50,230 - redis_service - INFO - üì¶ Stored call data in Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA (TTL: 3600s)
2025-12-30T06:32:50.232215986Z [err]  2025-12-30 06:32:50,230 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-30T06:32:50.232231907Z [err]  2025-12-30 06:32:50,230 - server - INFO - üìû Outbound call initiated: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:50.233192561Z [inf]  100.64.0.5:21604 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-30T06:32:50.420443634Z [err]  2025-12-30 06:32:50,415 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-30T06:32:50.420451130Z [err]  2025-12-30 06:32:50,415 - server - INFO -    Client: Address(host='100.64.0.12', port=28908)
2025-12-30T06:32:50.420455930Z [err]  2025-12-30 06:32:50,415 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'MocBxs7BqSagGe2nkw8mJQ==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'hpqVdUBpTx2BNW0onpoFkQ', 'x-real-ip': '192.76.120.151', 'x-request-start': '1767076370183', 'accept-encoding': 'gzip'}
2025-12-30T06:32:50.420460971Z [err]  2025-12-30 06:32:50,415 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-30T06:32:50.420465848Z [err]  2025-12-30 06:32:50,415 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-30T06:32:50.420469778Z [err]  [2025-12-30 06:32:50 +0000] [3] [INFO] ('100.64.0.12', 28908) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-30T06:32:50.420474944Z [err]  2025-12-30 06:32:50,415 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-30T06:32:50.420478777Z [err]  [2025-12-30 06:32:50 +0000] [3] [INFO] connection open
2025-12-30T06:32:50.456002463Z [err]  2025-12-30 06:32:50,449 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:32:50.456011678Z [err]  2025-12-30 06:32:50,449 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': '750a460b-b59f-499c-b25b-7f4d9b52c90d', 'occurred_at': '2025-12-30T06:32:49.904100Z', 'payload': {'call_control_id': 'v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA', 'call_leg_id': '5c98a9a4-e549-11f0-af4f-02420aef951f', 'call_session_id': '5c95d580-e549-11f0-9be0-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:32:50.456017548Z [err]  2025-12-30 06:32:50,449 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:50.456024342Z [err]  2025-12-30 06:32:50,449 - server - INFO - üì® ================================================
2025-12-30T06:32:50.456031861Z [err]  2025-12-30 06:32:50,449 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-30T06:32:50.456038108Z [inf]  100.64.0.8:60934 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:32:50.576690042Z [err]  2025-12-30 06:32:50,573 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-30T06:32:50.576702603Z [err]  2025-12-30 06:32:50,573 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-30T06:32:50.665611766Z [err]  2025-12-30 06:32:50,657 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T06:32:50.665621239Z [err]  2025-12-30 06:32:50,658 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-30T06:32:53.490001399Z [err]  2025-12-30 06:32:53,476 - server - INFO - üì¨ Received Telnyx event: start
2025-12-30T06:32:53.490011497Z [err]  2025-12-30 06:32:53,476 - server - INFO - üé¨ Stream started for call: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:53.512891847Z [err]  2025-12-30 06:32:53,511 - redis_service - INFO - üì• Retrieved call data from Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:53.513921412Z [err]  2025-12-30 06:32:53,513 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-30T06:32:53.513931113Z [err]  2025-12-30 06:32:53,513 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-30T06:32:53.716342146Z [err]  2025-12-30 06:32:53,705 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:32:53.716348758Z [err]  2025-12-30 06:32:53,705 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': '2da018dc-cf60-459e-a9cc-84aa617a3ad1', 'occurred_at': '2025-12-30T06:32:53.244104Z', 'payload': {'call_control_id': 'v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA', 'call_leg_id': '5c98a9a4-e549-11f0-af4f-02420aef951f', 'call_session_id': '5c95d580-e549-11f0-9be0-02420aef951f', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-30T06:32:49.904100Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:32:53.716353842Z [err]  2025-12-30 06:32:53,705 - server - INFO - üéØ Event type: call.answered, Call ID: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:53.716357829Z [err]  2025-12-30 06:32:53,705 - server - INFO - üì® ================================================
2025-12-30T06:32:53.716362589Z [err]  2025-12-30 06:32:53,705 - server - INFO - ‚úÖ Call answered: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:53.716367676Z [err]  2025-12-30 06:32:53,713 - redis_service - INFO - üì• Retrieved call data from Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:53.716371440Z [err]  2025-12-30 06:32:53,714 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-30T06:32:53.716375123Z [err]  2025-12-30 06:32:53,715 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-30T06:32:53.821307893Z [err]  2025-12-30 06:32:53,809 - server - INFO - ‚úÖ Call log updated
2025-12-30T06:32:53.821311922Z [err]  2025-12-30 06:32:53,810 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T06:32:53.821317050Z [err]  2025-12-30 06:32:53,810 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T06:32:53.821321015Z [err]  2025-12-30 06:32:53,810 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:32:54.029023149Z [err]  2025-12-30 06:32:54,013 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-30T06:32:54.029034724Z [err]  2025-12-30 06:32:54,013 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-30T06:32:54.029043102Z [err]  2025-12-30 06:32:54,025 - redis_service - INFO - üì• Retrieved call data from Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:54.029051857Z [err]  2025-12-30 06:32:54,026 - server - INFO - üìù Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:32:54.029060141Z [err]  2025-12-30 06:32:54,026 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-30T06:32:54.029088906Z [err]  2025-12-30 06:32:53,898 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:32:54.029094696Z [err]  2025-12-30 06:32:53,987 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:32:54.029099570Z [err]  2025-12-30 06:32:53,987 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-30T06:32:54.029104457Z [err]  2025-12-30 06:32:54,006 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:32:54.081666740Z [err]  2025-12-30 06:32:54,074 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:32:54.081672567Z [err]  2025-12-30 06:32:54,074 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': 'e4a5bbde-e3c5-42d2-80dd-e42e080eaa38', 'occurred_at': '2025-12-30T06:32:53.684103Z', 'payload': {'call_control_id': 'v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA', 'call_leg_id': '5c98a9a4-e549-11f0-af4f-02420aef951f', 'call_session_id': '5c95d580-e549-11f0-9be0-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '76929163-0dad-4a3c-a075-2b22159fd0eb', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:32:54.081676573Z [err]  2025-12-30 06:32:54,074 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:54.081680229Z [err]  2025-12-30 06:32:54,074 - server - INFO - üì® ================================================
2025-12-30T06:32:54.081684121Z [inf]  100.64.0.9:42022 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:32:54.124873493Z [err]  2025-12-30 06:32:54,115 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-30T06:32:54.124884267Z [err]  2025-12-30 06:32:54,115 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-30T06:32:54.124891520Z [err]  2025-12-30 06:32:54,115 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-30T06:32:54.124898908Z [err]  2025-12-30 06:32:54,115 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-30T06:32:54.124907681Z [err]  2025-12-30 06:32:54,115 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-30T06:32:54.201579716Z [err]  2025-12-30 06:32:54,196 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T06:32:54.201585696Z [err]  2025-12-30 06:32:54,197 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-30T06:32:54.208129655Z [err]  2025-12-30 06:32:54,204 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:32:54.214946626Z [err]  2025-12-30 06:32:54,211 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 95ms
2025-12-30T06:32:54.214954203Z [err]  2025-12-30 06:32:54,211 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-30T06:32:54.214959323Z [err]  2025-12-30 06:32:54,211 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-30T06:32:54.214963746Z [err]  2025-12-30 06:32:54,211 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-30T06:32:54.214968276Z [err]  2025-12-30 06:32:54,211 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-30T06:32:54.214972481Z [err]  2025-12-30 06:32:54,211 - server - INFO - ‚úÖ Initialized call_states for v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA with session reference
2025-12-30T06:32:54.214976485Z [err]  2025-12-30 06:32:54,211 - server - INFO - ‚úÖ Stored Telnyx WebSocket in call_data for audio streaming
2025-12-30T06:32:54.214982078Z [err]  2025-12-30 06:32:54,212 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found to update for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:54.214986561Z [err]  2025-12-30 06:32:54,212 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-30T06:32:54.300440735Z [err]  2025-12-30 06:32:54,295 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-30T06:32:54.300446706Z [err]  2025-12-30 06:32:54,296 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: tl1CFuHggA (loop=True, overlay=True)
2025-12-30T06:32:54.300451618Z [err]  2025-12-30 06:32:54,296 - server - INFO - üéµ Comfort noise started as continuous background overlay (playback_id: tl1CFuHggA)
2025-12-30T06:32:54.300457048Z [err]  2025-12-30 06:32:54,296 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:55.206247081Z [inf]  100.64.0.10:22802 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-30T06:32:55.752590527Z [err]  2025-12-30 06:32:55,749 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA/actions/record_start "HTTP/1.1 200 OK"
2025-12-30T06:32:55.752601194Z [err]  2025-12-30 06:32:55,750 - server - INFO - üéôÔ∏è Call recording started for v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:55.752605726Z [err]  2025-12-30 06:32:55,750 - server - INFO - üîß Creating call session for v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA...
2025-12-30T06:32:55.752609417Z [err]  2025-12-30 06:32:55,750 - server - INFO - üîç Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:32:55.752613683Z [err]  2025-12-30 06:32:55,750 - server - INFO - üîß Calling create_call_session() - START
2025-12-30T06:32:55.752617991Z [err]  2025-12-30 06:32:55,750 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-30T06:32:55.752622597Z [err]  2025-12-30 06:32:55,751 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-30T06:32:55.840833705Z [err]  2025-12-30 06:32:55,838 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-30T06:32:55.840841179Z [err]  2025-12-30 06:32:55,839 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-30T06:32:55.840847198Z [err]  2025-12-30 06:32:55,839 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-30T06:32:55.840853244Z [err]  2025-12-30 06:32:55,839 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-30T06:32:55.840859005Z [err]  2025-12-30 06:32:55,839 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-30T06:32:56.045956154Z [err]  2025-12-30 06:32:55,971 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-30T06:32:56.045964226Z [err]  2025-12-30 06:32:55,971 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-30T06:32:56.045975695Z [err]  2025-12-30 06:32:55,971 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-30T06:32:56.046038568Z [err]  2025-12-30 06:32:55,927 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:32:56.046042998Z [err]  2025-12-30 06:32:55,937 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 97ms
2025-12-30T06:32:56.046047641Z [err]  2025-12-30 06:32:55,937 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-30T06:32:56.046052811Z [err]  2025-12-30 06:32:55,937 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-30T06:32:56.046057201Z [err]  2025-12-30 06:32:55,965 - redis_service - INFO - üì¶ Stored call data in Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA (TTL: 3600s)
2025-12-30T06:32:56.046061598Z [err]  2025-12-30 06:32:55,965 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-30T06:32:56.046065514Z [err]  2025-12-30 06:32:55,965 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-30T06:32:56.046069896Z [err]  2025-12-30 06:32:55,971 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:56.046074109Z [err]  2025-12-30 06:32:55,971 - server - INFO - ü§ñ AI session created for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:56.046494475Z [err]  2025-12-30 06:32:55,971 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-30T06:32:56.046501177Z [err]  2025-12-30 06:32:55,971 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-30T06:32:56.046505886Z [err]  2025-12-30 06:32:55,971 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-30T06:32:56.046511044Z [err]  2025-12-30 06:32:55,971 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-30T06:32:56.046515760Z [err]  2025-12-30 06:32:55,998 - redis_service - INFO - üì• Retrieved call data from Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:56.046520195Z [err]  2025-12-30 06:32:55,999 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-30T06:32:56.046524469Z [err]  2025-12-30 06:32:56,000 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-30T06:32:56.046528175Z [inf]  100.64.0.14:13194 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:32:56.230055924Z [err]  2025-12-30 06:32:56,225 - redis_service - INFO - üì• Retrieved call data from Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:56.236390045Z [err]  2025-12-30 06:32:56,233 - redis_service - INFO - üì• Retrieved call data from Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:56.254620901Z [err]  2025-12-30 06:32:56,247 - redis_service - INFO - üì¶ Stored call data in Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA (TTL: 3600s)
2025-12-30T06:32:56.254629851Z [err]  2025-12-30 06:32:56,247 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-30T06:32:56.254636669Z [err]  2025-12-30 06:32:56,247 - core_calling_service - INFO - ‚è±Ô∏è [06:32:56.247] üì• process_user_input() ENTRY - text: '...'
2025-12-30T06:32:56.255767186Z [err]  2025-12-30 06:32:56,255 - redis_service - INFO - üì• Retrieved call data from Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:56.257383437Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - ‚è±Ô∏è [06:32:56.256] ‚è© About to call _process_call_flow_streaming()
2025-12-30T06:32:56.257394070Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - ‚è±Ô∏è [06:32:56.256] üîÄ Agent type: call_flow, calling flow processor...
2025-12-30T06:32:56.257394824Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-30T06:32:56.257403536Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - ‚è±Ô∏è [06:32:56.256] üîÄ _process_call_flow_streaming() ENTRY
2025-12-30T06:32:56.257406831Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-30T06:32:56.257412367Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-30T06:32:56.257416616Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-30T06:32:56.257420819Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - ‚è±Ô∏è [06:32:56.256] ‚úÖ Node selected, about to process content...
2025-12-30T06:32:56.257428746Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - üîß Replaced {{now}} with Tuesday, December 30, 2025 at 1:32 AM EST in content
2025-12-30T06:32:56.257436079Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-30T06:32:56.257442284Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-30T06:32:56.257448899Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-30T06:32:56.257456224Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-30T06:32:56.258456792Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-30T06:32:56.258466380Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-30T06:32:56.258473467Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-30T06:32:56.258480125Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-30T06:32:56.258487459Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-30T06:32:56.258493959Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - ‚è±Ô∏è [06:32:56.256] üìÑ About to process content (mode=script, length=9)
2025-12-30T06:32:56.258500378Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - üîä Silence tracking reset for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA (user responded)
2025-12-30T06:32:56.258507307Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-30T06:32:56.258513719Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-30T06:32:56.258520288Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - LLM response (0.01s): Kendrick?
2025-12-30T06:32:56.258526582Z [err]  2025-12-30 06:32:56,256 - core_calling_service - INFO - Total latency: 0.01s
2025-12-30T06:32:56.258533027Z [err]  2025-12-30 06:32:56,256 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-30T06:32:56.325330240Z [err]  2025-12-30 06:32:56,322 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-30T06:32:56.325337486Z [err]  2025-12-30 06:32:56,322 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-30T06:32:56.325344831Z [err]  2025-12-30 06:32:56,323 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-30T06:32:56.325351969Z [err]  2025-12-30 06:32:56,323 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:56.331326742Z [err]  2025-12-30 06:32:56,328 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:32:56.331336359Z [err]  2025-12-30 06:32:56,329 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-30T06:32:56.372152794Z [err]  2025-12-30 06:32:56,359 - redis_service - INFO - üì• Retrieved call data from Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:56.372159330Z [err]  2025-12-30 06:32:56,360 - telnyx_service - INFO - üîä Speaking text on call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA: Kendrick?...
2025-12-30T06:32:56.372165627Z [err]  2025-12-30 06:32:56,360 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T06:32:56.372170357Z [err]  2025-12-30 06:32:56,360 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T06:32:56.372175677Z [err]  2025-12-30 06:32:56,360 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T06:32:56.372180333Z [err]  2025-12-30 06:32:56,360 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T06:32:56.372185470Z [err]  2025-12-30 06:32:56,360 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (13837 bytes)
2025-12-30T06:32:56.372190104Z [err]  2025-12-30 06:32:56,361 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-30T06:32:56.372195183Z [err]  2025-12-30 06:32:56,361 - telnyx_service - INFO - ‚úÖ Generated 13837 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-30T06:32:56.372205872Z [err]  2025-12-30 06:32:56,361 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-30T06:32:56.659243646Z [err]  2025-12-30 06:32:56,646 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-30T06:32:56.659249375Z [err]  2025-12-30 06:32:56,647 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.29s
2025-12-30T06:32:56.659253726Z [err]  2025-12-30 06:32:56,647 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 0.29s
2025-12-30T06:32:56.659258783Z [err]  2025-12-30 06:32:56,647 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-30T06:32:56.659262707Z [err]  2025-12-30 06:32:56,647 - telnyx_service - INFO - üé¨ Playback ID: O8mi8mSWBg
2025-12-30T06:32:56.659266697Z [err]  2025-12-30 06:32:56,647 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-30T06:32:56.659270688Z [err]  2025-12-30 06:32:56,647 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Greeting playback started at 1767076376.647416
2025-12-30T06:32:56.659274401Z [err]  2025-12-30 06:32:56,647 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767076376.6474452 for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:56.659277893Z [err]  2025-12-30 06:32:56,647 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-30T06:32:56.816321431Z [inf]  100.64.0.14:13194 - "GET /api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3 HTTP/1.1" 200
2025-12-30T06:32:56.816329441Z [err]  2025-12-30 06:32:56,813 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:32:56.816336266Z [err]  2025-12-30 06:32:56,813 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '9123f8ff-bfed-4964-975b-29fcc8827f87', 'occurred_at': '2025-12-30T06:32:56.364105Z', 'payload': {'call_control_id': 'v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA', 'call_leg_id': '5c98a9a4-e549-11f0-af4f-02420aef951f', 'call_session_id': '5c95d580-e549-11f0-9be0-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'tl1CFuHggA', 'start_time': '2025-12-30T06:32:56.364105Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:32:56.816342548Z [err]  2025-12-30 06:32:56,814 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:56.816348083Z [err]  2025-12-30 06:32:56,814 - server - INFO - üì® ================================================
2025-12-30T06:32:56.816355465Z [inf]  100.64.0.8:12858 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:32:56.838842975Z [err]  2025-12-30 06:32:56,833 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:32:57.371997750Z [err]  2025-12-30 06:32:57,339 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:32:57.703737142Z [err]  2025-12-30 06:32:57,694 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:32:57.703741436Z [err]  2025-12-30 06:32:57,694 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '6563782d-f53c-4f1f-8ffd-6f2f986e9388', 'occurred_at': '2025-12-30T06:32:57.304104Z', 'payload': {'call_control_id': 'v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA', 'call_leg_id': '5c98a9a4-e549-11f0-af4f-02420aef951f', 'call_session_id': '5c95d580-e549-11f0-9be0-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'O8mi8mSWBg'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:32:57.703745521Z [err]  2025-12-30 06:32:57,694 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:57.703749848Z [err]  2025-12-30 06:32:57,694 - server - INFO - üì® ================================================
2025-12-30T06:32:57.703753641Z [inf]  100.64.0.12:28944 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:32:57.863853916Z [err]  2025-12-30 06:32:57,844 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:32:58.353263949Z [err]  2025-12-30 06:32:58,351 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:32:58.570252252Z [err]  2025-12-30 06:32:58,560 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:32:58.570260747Z [err]  2025-12-30 06:32:58,560 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '5539393e-7ad6-4240-ab5d-058bfab96588', 'occurred_at': '2025-12-30T06:32:58.184107Z', 'payload': {'call_control_id': 'v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA', 'call_leg_id': '5c98a9a4-e549-11f0-af4f-02420aef951f', 'call_session_id': '5c95d580-e549-11f0-9be0-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'O8mi8mSWBg', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:32:58.570265490Z [err]  2025-12-30 06:32:58,561 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:58.570270489Z [err]  2025-12-30 06:32:58,561 - server - INFO - üì® ================================================
2025-12-30T06:32:58.575401412Z [err]  2025-12-30 06:32:58,572 - redis_service - INFO - ‚ûñ Removed playback O8mi8mSWBg, 0 remaining for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:58.575409046Z [err]  2025-12-30 06:32:58,572 - server - INFO - üîä Redis: Removed playback O8mi8mSWBg, 0 remaining
2025-12-30T06:32:58.575414492Z [err]  2025-12-30 06:32:58,572 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-30T06:32:58.575419980Z [err]  2025-12-30 06:32:58,572 - server - INFO - ‚è±Ô∏è CLEARED playback_expected_end_time - agent is definitely done speaking
2025-12-30T06:32:58.581890679Z [err]  2025-12-30 06:32:58,577 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-30T06:32:58.581899342Z [err]  2025-12-30 06:32:58,577 - server - INFO - ‚úÖ Found session locally: agent_speaking=False, user_speaking=False
2025-12-30T06:32:58.581905892Z [err]  2025-12-30 06:32:58,577 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767076378.5779648 for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:58.581912180Z [err]  2025-12-30 06:32:58,577 - server - INFO - ‚è±Ô∏è Silence timer STARTED (local, agent wasn't marked as speaking)
2025-12-30T06:32:58.581918056Z [inf]  100.64.0.9:56938 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:32:58.870687302Z [err]  2025-12-30 06:32:58,857 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:32:59.082263699Z [err]  2025-12-30 06:32:58,979 - server - INFO - üî§ RAW TOKENS: ["H"?]
2025-12-30T06:32:59.082274783Z [err]  2025-12-30 06:32:58,979 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user started speaking) for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:59.082286080Z [err]  2025-12-30 06:32:58,979 - core_calling_service - INFO - üîä Silence timer reset for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA (user started speaking)
2025-12-30T06:32:59.082294365Z [err]  2025-12-30 06:32:58,979 - core_calling_service - INFO - üë§ User started speaking for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:59.082308267Z [err]  2025-12-30 06:32:58,979 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-30T06:32:59.082316662Z [err]  2025-12-30 06:32:58,979 - server - INFO - üîç PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-30T06:32:59.124680193Z [err]  2025-12-30 06:32:59,119 - server - INFO - üî§ RAW TOKENS: ["Hell"‚úì, "o."‚úì, "<end>"‚úì]
2025-12-30T06:32:59.124689748Z [err]  2025-12-30 06:32:59,119 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-30T06:32:59.124695827Z [err]  2025-12-30 06:32:59,120 - server - INFO - üì• FINAL TOKENS: 'Hell o.' (2 tokens)
2025-12-30T06:32:59.124700532Z [err]  2025-12-30 06:32:59,120 - server - INFO - üé§ Soniox final transcript: 'Hell o.'
2025-12-30T06:32:59.124705313Z [err]  2025-12-30 06:32:59,120 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:32:59.124709884Z [err]  2025-12-30 06:32:59,120 - server - INFO - üîç FILTER CHECK: words=2, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-30T06:32:59.124714023Z [err]  2025-12-30 06:32:59,120 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:32:59.124718567Z [err]  2025-12-30 06:32:59,120 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-30T06:32:59.124722392Z [err]  2025-12-30 06:32:59,120 - server - INFO - ‚è±Ô∏è [06:32:59.120] üìù FINAL TRANSCRIPT RECEIVED: 'Hell o.'
2025-12-30T06:32:59.124726832Z [err]  2025-12-30 06:32:59,120 - server - INFO - ‚è±Ô∏è [06:32:59.120] STT endpoint detection latency: 1ms
2025-12-30T06:32:59.124730776Z [err]  2025-12-30 06:32:59,120 - server - INFO - ‚è±Ô∏è [06:32:59.120] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-30T06:32:59.124734756Z [err]  2025-12-30 06:32:59,120 - server - INFO - ‚è±Ô∏è User spoke at 1767076379.120581
2025-12-30T06:32:59.129651855Z [err]  2025-12-30 06:32:59,126 - redis_service - INFO - üì¶ Stored call data in Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA (TTL: 3600s)
2025-12-30T06:32:59.129656011Z [err]  2025-12-30 06:32:59,126 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-30T06:32:59.129661486Z [err]  2025-12-30 06:32:59,126 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:32:59.129665593Z [err]  2025-12-30 06:32:59,126 - server - INFO - ‚úÖ Agent SILENT - User said 2 word(s): 'Hell o.' - Processing...
2025-12-30T06:32:59.140594516Z [err]  2025-12-30 06:32:59,136 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Hell o.
2025-12-30T06:32:59.140602813Z [err]  2025-12-30 06:32:59,137 - core_calling_service - INFO - üë§ User stopped speaking for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:59.140609418Z [err]  2025-12-30 06:32:59,137 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-30T06:32:59.140615630Z [err]  2025-12-30 06:32:59,137 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+18ms
2025-12-30T06:32:59.140622206Z [err]  2025-12-30 06:32:59,137 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 18ms (Soniox model: stt-rt-v3)
2025-12-30T06:32:59.140628298Z [err]  2025-12-30 06:32:59,137 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-30T06:32:59.140634125Z [err]  2025-12-30 06:32:59,137 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-30T06:32:59.140639745Z [err]  2025-12-30 06:32:59,137 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:59.239055041Z [err]  2025-12-30 06:32:59,231 - server - INFO - üìù Saved user transcript to database
2025-12-30T06:32:59.239059186Z [err]  2025-12-30 06:32:59,231 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:32:59.239064082Z [err]  2025-12-30 06:32:59,231 - core_calling_service - INFO - ‚è±Ô∏è [06:32:59.231] üì• process_user_input() ENTRY - text: 'Hell o....'
2025-12-30T06:32:59.239067929Z [err]  2025-12-30 06:32:59,237 - redis_service - INFO - üì• Retrieved call data from Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:59.239071925Z [err]  2025-12-30 06:32:59,237 - core_calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA: User spoke while Silence Greeting was triggering
2025-12-30T06:32:59.262301507Z [err]  2025-12-30 06:32:59,260 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:32:59.262310498Z [err]  2025-12-30 06:32:59,260 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:59.366560494Z [err]  2025-12-30 06:32:59,363 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-30T06:32:59.366566381Z [err]  2025-12-30 06:32:59,363 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767076379.363874 for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:59.366570793Z [err]  2025-12-30 06:32:59,363 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:59.371882787Z [err]  2025-12-30 06:32:59,371 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:32:59.613008595Z [err]  2025-12-30 06:32:59,611 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA/actions/playback_stop "HTTP/1.1 200 OK"
2025-12-30T06:32:59.614358006Z [err]  2025-12-30 06:32:59,612 - telnyx_service - INFO - ‚úÖ Successfully stopped audio playback
2025-12-30T06:32:59.614371873Z [err]  2025-12-30 06:32:59,612 - core_calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-30T06:32:59.614383348Z [err]  2025-12-30 06:32:59,612 - core_calling_service - INFO - ‚úÖ BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-30T06:32:59.620051194Z [err]  2025-12-30 06:32:59,618 - redis_service - INFO - üì• Retrieved call data from Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:59.626179624Z [err]  2025-12-30 06:32:59,624 - redis_service - INFO - üì¶ Stored call data in Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA (TTL: 3600s)
2025-12-30T06:32:59.626190731Z [err]  2025-12-30 06:32:59,624 - core_calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-30T06:32:59.626197999Z [err]  2025-12-30 06:32:59,624 - core_calling_service - INFO - ‚è±Ô∏è [06:32:59.624] ‚è© About to call _process_call_flow_streaming()
2025-12-30T06:32:59.626204581Z [err]  2025-12-30 06:32:59,624 - core_calling_service - INFO - ‚è±Ô∏è [06:32:59.624] üîÄ Agent type: call_flow, calling flow processor...
2025-12-30T06:32:59.626212011Z [err]  2025-12-30 06:32:59,625 - core_calling_service - INFO - ‚è±Ô∏è [06:32:59.625] üîÄ _process_call_flow_streaming() ENTRY
2025-12-30T06:32:59.626219358Z [err]  2025-12-30 06:32:59,625 - core_calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-30T06:32:59.626227441Z [err]  2025-12-30 06:32:59,625 - core_calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-30T06:32:59.626234005Z [err]  2025-12-30 06:32:59,625 - core_calling_service - INFO - ‚è±Ô∏è [06:32:59.625] üîÄ About to call _follow_transition() for: Hell o....
2025-12-30T06:32:59.626240679Z [err]  2025-12-30 06:32:59,625 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Hell o.
2025-12-30T06:32:59.626247301Z [err]  2025-12-30 06:32:59,625 - core_calling_service - INFO - üîç Checking 'Hello=Yes' override [DEPLOYMENT VERIFIED] for msg='hell o' on node='Greeting'
2025-12-30T06:32:59.626255131Z [err]  2025-12-30 06:32:59,625 - core_calling_service - WARNING - ‚ö†Ô∏è Auto-transition after response target not found: None, falling back to normal evaluation
2025-12-30T06:32:59.638281338Z [err]  2025-12-30 06:32:59,634 - core_calling_service - INFO - ‚è±Ô∏è [06:32:59.634] üîÄ TRANSITION EVALUATION START - Calling LLM for 2 options
2025-12-30T06:32:59.764220469Z [err]  2025-12-30 06:32:59,762 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:32:59.764225936Z [err]  2025-12-30 06:32:59,762 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': 'ab788e71-a477-4a96-b6d4-57e8b504a423', 'occurred_at': '2025-12-30T06:32:59.544101Z', 'payload': {'call_control_id': 'v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA', 'call_leg_id': '5c98a9a4-e549-11f0-af4f-02420aef951f', 'call_session_id': '5c95d580-e549-11f0-9be0-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:32:59.764230456Z [err]  2025-12-30 06:32:59,762 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:32:59.764236033Z [err]  2025-12-30 06:32:59,762 - server - INFO - üì® ================================================
2025-12-30T06:32:59.764241121Z [inf]  100.64.0.8:12858 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:32:59.881590319Z [err]  2025-12-30 06:32:59,877 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:00.091781011Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-30T06:33:00.091865062Z [err]  2025-12-30 06:33:00,060 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-30T06:33:00.091870204Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - ‚è±Ô∏è [06:33:00.062] üîÄ TRANSITION EVALUATION COMPLETE - took 427ms
2025-12-30T06:33:00.091874381Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - ü§ñ AI transition decision: '-1'
2025-12-30T06:33:00.091878505Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - üìä Available transitions: ['Confirms name (Yes|Speaking|This is he/she) OR Ask...', 'Wrong number (No John here|Wrong number|etc) - don...']
2025-12-30T06:33:00.091882840Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - Selected transition index: -1
2025-12-30T06:33:00.091886988Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - No specific condition matched, looking for default transition...
2025-12-30T06:33:00.091891984Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - ‚ö†Ô∏è No transition matched, but node has GOAL. Staying on current node to continue with goal-based guidance.
2025-12-30T06:33:00.091895928Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - üéØ Goal: Find out if your speaking to the right person....
2025-12-30T06:33:00.091901597Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 437ms
2025-12-30T06:33:00.091905688Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - ‚è±Ô∏è [06:33:00.062] ‚úÖ Node selected, about to process content...
2025-12-30T06:33:00.091910001Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - üîß Replaced {{now}} with Tuesday, December 30, 2025 at 1:32 AM EST in content
2025-12-30T06:33:00.091914251Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-30T06:33:00.092602808Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-30T06:33:00.092613677Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-30T06:33:00.092620912Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-30T06:33:00.092629283Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-30T06:33:00.092636692Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-30T06:33:00.092644592Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-30T06:33:00.092651790Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-30T06:33:00.092659075Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-30T06:33:00.092666863Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-30T06:33:00.092673833Z [err]  2025-12-30 06:33:00,062 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-30T06:33:00.092681127Z [err]  2025-12-30 06:33:00,063 - core_calling_service - INFO - ‚è±Ô∏è [06:33:00.062] üìÑ About to process content (mode=script, length=9)
2025-12-30T06:33:00.092688251Z [err]  2025-12-30 06:33:00,063 - core_calling_service - INFO - üîÑ Dynamic rephrase enabled - generating natural variation of script
2025-12-30T06:33:00.092695137Z [err]  2025-12-30 06:33:00,063 - core_calling_service - ERROR - Error generating rephrased script: No module named 'api_key_service'
2025-12-30T06:33:00.093618476Z [err]  2025-12-30 06:33:00,063 - server - INFO - üì§ Sentence arrived from LLM: Let me say that again - Kendrick?...
2025-12-30T06:33:00.093624790Z [err]  2025-12-30 06:33:00,063 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 926ms
2025-12-30T06:33:00.093628829Z [err]  2025-12-30 06:33:00,063 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-30T06:33:00.093633035Z [err]  2025-12-30 06:33:00,063 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:00.093637292Z [err]  2025-12-30 06:33:00,063 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-30T06:33:00.155372659Z [err]  2025-12-30 06:33:00,152 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:33:00.245603369Z [err]  2025-12-30 06:33:00,240 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:33:00.330789180Z [err]  2025-12-30 06:33:00,328 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:33:00.354942448Z [err]  2025-12-30 06:33:00,350 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:33:00.354949484Z [err]  2025-12-30 06:33:00,350 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-30T06:33:00.354954370Z [err]  2025-12-30 06:33:00,350 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-30T06:33:00.354958233Z [err]  2025-12-30 06:33:00,351 - persistent_tts_service - INFO - üîå [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Establishing persistent TTS WebSocket...
2025-12-30T06:33:00.354962577Z [err]  2025-12-30 06:33:00,351 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-30T06:33:00.354966365Z [err]  2025-12-30 06:33:00,351 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-30T06:33:00.354970639Z [err]  2025-12-30 06:33:00,351 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-30T06:33:00.390931058Z [err]  2025-12-30 06:33:00,383 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:00.390938484Z [err]  2025-12-30 06:33:00,383 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=1.0s, checkin_count=0/2
2025-12-30T06:33:00.533694414Z [err]  2025-12-30 06:33:00,483 - persistent_tts_service - INFO - üîä [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Comfort noise loop started
2025-12-30T06:33:00.533705902Z [err]  2025-12-30 06:33:00,482 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-30T06:33:00.533707026Z [err]  2025-12-30 06:33:00,483 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:00.533715075Z [err]  2025-12-30 06:33:00,482 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-30T06:33:00.533717168Z [err]  2025-12-30 06:33:00,483 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-30T06:33:00.533725238Z [err]  2025-12-30 06:33:00,482 - persistent_tts_service - INFO - ‚úÖ [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Persistent TTS WebSocket established
2025-12-30T06:33:00.533726912Z [err]  2025-12-30 06:33:00,483 - server - INFO - üîç Persistent TTS lookup: call_id=v3:oLcFcMqRyuLPQSMRo..., session=FOUND
2025-12-30T06:33:00.533733855Z [err]  2025-12-30 06:33:00,483 - persistent_tts_service - INFO - üéß [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Audio receiver loop started
2025-12-30T06:33:00.533736680Z [err]  2025-12-30 06:33:00,483 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-30T06:33:00.533744246Z [err]  2025-12-30 06:33:00,483 - server - INFO - üéµ TTS task #1 started at +419ms
2025-12-30T06:33:00.533753007Z [err]  2025-12-30 06:33:00,483 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 1346ms
2025-12-30T06:33:00.533759343Z [err]  2025-12-30 06:33:00,483 - core_calling_service - INFO - üîÑ Rephrased script: Let me say that again - Kendrick?...
2025-12-30T06:33:00.533766224Z [err]  2025-12-30 06:33:00,483 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user gave meaningful response) for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:00.534602752Z [err]  2025-12-30 06:33:00,483 - core_calling_service - INFO - üîä Silence tracking reset for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA (user responded)
2025-12-30T06:33:00.534610587Z [err]  2025-12-30 06:33:00,484 - persistent_tts_service - INFO - üîä [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Starting comfort noise loop
2025-12-30T06:33:00.534613056Z [err]  2025-12-30 06:33:00,483 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-30T06:33:00.534620360Z [err]  2025-12-30 06:33:00,483 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-30T06:33:00.534626606Z [err]  2025-12-30 06:33:00,483 - core_calling_service - INFO - LLM response (1.25s): Let me say that again - Kendrick?
2025-12-30T06:33:00.534632843Z [err]  2025-12-30 06:33:00,483 - core_calling_service - INFO - Total latency: 1.25s
2025-12-30T06:33:00.534639678Z [err]  2025-12-30 06:33:00,484 - server - INFO - ‚úÖ LLM finished in 1347ms, TTS tasks already running in background
2025-12-30T06:33:00.534645727Z [err]  2025-12-30 06:33:00,484 - server - INFO - üéµ Streaming 1 TTS chunks as they complete...
2025-12-30T06:33:00.534651556Z [err]  2025-12-30 06:33:00,484 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-30T06:33:00.534655935Z [err]  2025-12-30 06:33:00,484 - server - INFO -    1 sentences queued and playing seamlessly
2025-12-30T06:33:00.534661795Z [err]  2025-12-30 06:33:00,484 - persistent_tts_service - INFO - üéµ [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Playback consumer started
2025-12-30T06:33:00.534667831Z [err]  2025-12-30 06:33:00,484 - persistent_tts_service - INFO - üéß [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Audio Receiver Loop STARTED
2025-12-30T06:33:00.534673640Z [err]  2025-12-30 06:33:00,484 - persistent_tts_service - INFO - üíì [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Starting TTS keep-alive loop (every 15s)
2025-12-30T06:33:00.535899407Z [err]  2025-12-30 06:33:00,485 - persistent_tts_service - INFO - üé§ [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Streaming sentence #1: Let me say that again - Kendrick?...
2025-12-30T06:33:00.535910230Z [err]  2025-12-30 06:33:00,485 - persistent_tts_service - INFO - üöÄ [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-30T06:33:00.535917645Z [err]  2025-12-30 06:33:00,485 - persistent_tts_service - INFO - üìä [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-30T06:33:00.535924455Z [err]  2025-12-30 06:33:00,485 - persistent_tts_service - INFO - üéß [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Receiver processing sentence #1: 'Let me say that again - Kendri...'
2025-12-30T06:33:00.535931581Z [err]  2025-12-30 06:33:00,485 - persistent_tts_service - INFO - üìä [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] DIAGNOSTIC: queue_latency=0ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-30T06:33:00.535939042Z [err]  2025-12-30 06:33:00,485 - server - INFO - ‚úÖ All 1 persistent TTS streams completed
2025-12-30T06:33:00.535946904Z [err]  2025-12-30 06:33:00,485 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-30T06:33:00.535952735Z [err]  2025-12-30 06:33:00,485 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 1348ms from user stop üöÄ
2025-12-30T06:33:00.535956860Z [err]  2025-12-30 06:33:00,485 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:00.535961501Z [err]  2025-12-30 06:33:00,485 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-30T06:33:00.535965430Z [err]  2025-12-30 06:33:00,485 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T06:33:00.537116835Z [err]  2025-12-30 06:33:00,485 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-30T06:33:00.537128939Z [err]  2025-12-30 06:33:00,485 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 18ms (provider: soniox, model: stt-rt-v3)
2025-12-30T06:33:00.537136199Z [err]  2025-12-30 06:33:00,485 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 1347ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-30T06:33:00.537143019Z [err]  2025-12-30 06:33:00,486 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 422ms (provider: elevenlabs, websocket: False)
2025-12-30T06:33:00.537149562Z [err]  2025-12-30 06:33:00,486 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 1348ms (user stopped ‚Üí play_audio_url called)
2025-12-30T06:33:00.537155953Z [err]  2025-12-30 06:33:00,486 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-30T06:33:00.537162237Z [err]  2025-12-30 06:33:00,486 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-30T06:33:00.537168762Z [err]  2025-12-30 06:33:00,486 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-30T06:33:00.537175246Z [err]  2025-12-30 06:33:00,486 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-30T06:33:00.537181545Z [err]  2025-12-30 06:33:00,486 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-30T06:33:00.537187807Z [err]  2025-12-30 06:33:00,486 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 1648ms estimated
2025-12-30T06:33:00.537193989Z [err]  2025-12-30 06:33:00,486 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 33 chars, 1 sentences
2025-12-30T06:33:00.537200498Z [err]  2025-12-30 06:33:00,486 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Hell o....'
2025-12-30T06:33:00.537206761Z [err]  2025-12-30 06:33:00,486 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: 'Let me say that again - Kendrick?...'
2025-12-30T06:33:00.538014051Z [err]  2025-12-30 06:33:00,486 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-30T06:33:00.538019013Z [err]  2025-12-30 06:33:00,486 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T06:33:00.686813612Z [err]  2025-12-30 06:33:00,675 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 1787ms)
2025-12-30T06:33:00.686819028Z [err]  2025-12-30 06:33:00,675 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-30T06:33:00.686823235Z [err]  2025-12-30 06:33:00,675 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-30T06:33:00.776991123Z [err]  2025-12-30 06:33:00,774 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 289ms
2025-12-30T06:33:00.776997949Z [err]  2025-12-30 06:33:00,774 - persistent_tts_service - INFO - üì§ Sending 14845 bytes of audio (93 chunks, 1.9s duration) via WebSocket
2025-12-30T06:33:00.777002459Z [err]  2025-12-30 06:33:00,774 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-30T06:33:00.777007106Z [err]  2025-12-30 06:33:00,775 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.9s (total: 1.9s from now)
2025-12-30T06:33:00.777010809Z [err]  2025-12-30 06:33:00,776 - persistent_tts_service - INFO - ‚úÖ Sent 93 audio chunks via WebSocket
2025-12-30T06:33:00.909094758Z [err]  2025-12-30 06:33:00,895 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (1.7s left)
2025-12-30T06:33:01.341391824Z [err]  2025-12-30 06:33:01,336 - server - INFO - üì§ Audio flowing: 369 packets sent to Soniox (5s update)
2025-12-30T06:33:02.782066509Z [err]  2025-12-30 06:33:02,774 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-30T06:33:02.782075015Z [err]  2025-12-30 06:33:02,774 - persistent_tts_service - INFO - ‚úÖ [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Receiver finished sentence #1: 1 chunks in 2289ms
2025-12-30T06:33:02.782082808Z [err]  2025-12-30 06:33:02,777 - persistent_tts_service - INFO - üîá [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] FLOOR RELEASED (is_holding_floor=False)
2025-12-30T06:33:03.087679449Z [err]  2025-12-30 06:33:02,940 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (0.3s ago), marking agent as done speaking
2025-12-30T06:33:03.087689430Z [err]  2025-12-30 06:33:02,940 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767076382.9407256 for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:03.087697762Z [err]  2025-12-30 06:33:02,940 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:06.350819662Z [err]  2025-12-30 06:33:06,336 - server - INFO - üì§ Audio flowing: 619 packets sent to Soniox (5s update)
2025-12-30T06:33:06.588810301Z [err]  2025-12-30 06:33:06,565 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 621 total packets
2025-12-30T06:33:06.588819764Z [err]  [2025-12-30 06:33:06 +0000] [3] [INFO] connection closed
2025-12-30T06:33:06.726724139Z [err]  2025-12-30 06:33:06,718 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:33:06.726728751Z [err]  2025-12-30 06:33:06,718 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'c8f0bbd6-65aa-4709-b66c-542fe8c1f2f8', 'occurred_at': '2025-12-30T06:33:06.344105Z', 'payload': {'call_control_id': 'v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA', 'call_leg_id': '5c98a9a4-e549-11f0-af4f-02420aef951f', 'call_session_id': '5c95d580-e549-11f0-9be0-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T06:33:06.344105Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'tl1CFuHggA', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:33:06.726733715Z [err]  2025-12-30 06:33:06,718 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:06.726737936Z [err]  2025-12-30 06:33:06,718 - server - INFO - üì® ================================================
2025-12-30T06:33:06.732775774Z [err]  2025-12-30 06:33:06,730 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:33:06.732783561Z [err]  2025-12-30 06:33:06,731 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': 'cee6bebc-429f-461d-b689-49edaa2959e2', 'occurred_at': '2025-12-30T06:33:06.492186Z', 'payload': {'call_control_id': 'v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA', 'call_leg_id': '5c98a9a4-e549-11f0-af4f-02420aef951f', 'call_session_id': '5c95d580-e549-11f0-9be0-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '76929163-0dad-4a3c-a075-2b22159fd0eb', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:33:06.732789874Z [err]  2025-12-30 06:33:06,731 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:06.732796259Z [err]  2025-12-30 06:33:06,731 - server - INFO - üì® ================================================
2025-12-30T06:33:06.732804387Z [inf]  100.64.0.8:30470 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:33:06.738562629Z [err]  2025-12-30 06:33:06,735 - redis_service - INFO - ‚ûñ Removed playback tl1CFuHggA, 0 remaining for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:06.738569883Z [err]  2025-12-30 06:33:06,735 - server - INFO - üîä Redis: Removed playback tl1CFuHggA, 0 remaining
2025-12-30T06:33:06.738576459Z [err]  2025-12-30 06:33:06,735 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-30T06:33:06.744366016Z [err]  2025-12-30 06:33:06,741 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-30T06:33:06.744375307Z [err]  2025-12-30 06:33:06,741 - server - INFO - üí° Session not on this worker - Redis flag set for WebSocket worker to handle
2025-12-30T06:33:06.744381880Z [inf]  100.64.0.12:11760 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:33:06.744387686Z [err]  2025-12-30 06:33:06,741 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:33:06.744394067Z [err]  2025-12-30 06:33:06,742 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': '21c178cc-ebfe-48be-9d17-df1d57cb9882', 'occurred_at': '2025-12-30T06:33:06.324099Z', 'payload': {'call_control_id': 'v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA', 'call_leg_id': '5c98a9a4-e549-11f0-af4f-02420aef951f', 'call_quality_stats': {'inbound': {'jitter_max_variance': '70.08', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '646', 'skip_packet_count': '17'}, 'outbound': {'packet_count': '624', 'skip_packet_count': '0'}}, 'call_session_id': '5c95d580-e549-11f0-9be0-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T06:33:06.324099Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-30T06:32:49.904100Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:33:06.744401635Z [err]  2025-12-30 06:33:06,742 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:06.744408212Z [err]  2025-12-30 06:33:06,742 - server - INFO - üì® ================================================
2025-12-30T06:33:06.744416366Z [err]  2025-12-30 06:33:06,742 - server - INFO - üìû Call ended: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:06.745504383Z [err]  2025-12-30 06:33:06,742 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-30T06:33:06.929781241Z [err]  2025-12-30 06:33:06,929 - server - INFO - üìù Updated call log: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:07.137764920Z [err]  2025-12-30 06:33:07,023 - server - INFO - ‚úÖ Finalized call log: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA (duration=13s, status=completed)
2025-12-30T06:33:07.137769403Z [err]  2025-12-30 06:33:07,118 - server - INFO - üì¶ Saved 11 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-30T06:33:07.837366573Z [err]  2025-12-30 06:33:07,826 - server - INFO - üìä Auto-added call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-30T06:33:07.927285054Z [err]  2025-12-30 06:33:07,926 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:33:07.927293638Z [err]  2025-12-30 06:33:07,926 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '25f72d82-e306-42d0-91d6-ca147716ca39', 'occurred_at': '2025-12-30T06:33:07.591347Z', 'payload': {'call_control_id': 'v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA', 'call_leg_id': '5c98a9a4-e549-11f0-af4f-02420aef951f', 'call_session_id': '5c95d580-e549-11f0-9be0-02420aef951f', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T06:33:06.410628Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-30T06:33:06.410628Z', 'recording_id': '5352dca3-bdaf-4b9e-a7ea-d725d3ed7ce4', 'recording_started_at': '2025-12-30T06:32:55.509362Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-30/5c98a9a4-e549-11f0-af4f-02420aef951f-1767076374619377.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251230%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251230T063307Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=9a284433f1e85be1adeeb49661477e24366949568988daf3b86c56e63da0efc9'}, 'start_time': '2025-12-30T06:32:55.509362Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:33:07.927300848Z [err]  2025-12-30 06:33:07,926 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:07.927306546Z [err]  2025-12-30 06:33:07,926 - server - INFO - üì® ================================================
2025-12-30T06:33:07.928124716Z [err]  2025-12-30 06:33:07,926 - server - INFO - üéôÔ∏è Recording saved for call: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:07.940333797Z [err]  2025-12-30 06:33:07,937 - redis_service - INFO - üì• Retrieved call data from Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:07.940346942Z [err]  2025-12-30 06:33:07,937 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=5352dca3-bdaf-4b9e-a7ea-d725d3ed7ce4, call_data=True
2025-12-30T06:33:08.100506309Z [err]  2025-12-30 06:33:08,013 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T06:33:08.100513721Z [err]  2025-12-30 06:33:08,019 - redis_service - INFO - üì• Retrieved call data from Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:08.100526703Z [err]  2025-12-30 06:33:08,019 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-30T06:33:08.100533830Z [err]  2025-12-30 06:33:08,019 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-30T06:33:08.100540207Z [err]  2025-12-30 06:33:08,033 - server - INFO - üíæ Saved recording URL and ID to database: 5352dca3-bdaf-4b9e-a7ea-d725d3ed7ce4
2025-12-30T06:33:08.100546446Z [err]  2025-12-30 06:33:08,033 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-30T06:33:08.100555566Z [err]  2025-12-30 06:33:08,033 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-30T06:33:08.122580381Z [err]  2025-12-30 06:33:08,113 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-30T06:33:08.207031267Z [err]  2025-12-30 06:33:08,201 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-30T06:33:08.207033068Z [err]  2025-12-30 06:33:08,201 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-30T06:33:08.207039198Z [err]  2025-12-30 06:33:08,201 - server - INFO - üìá CRM update starting for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:33:08.207043333Z [err]  2025-12-30 06:33:08,201 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-30T06:33:08.207050630Z [err]  2025-12-30 06:33:08,201 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-30T06:33:08.207058649Z [err]  2025-12-30 06:33:08,201 - server - INFO - üöÄ Triggered QC analysis for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:08.207065698Z [err]  2025-12-30 06:33:08,201 - server - INFO - üìä Triggered Campaign QC for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:08.207069896Z [err]  2025-12-30 06:33:08,201 - server - INFO - üìá Triggered CRM update for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:08.207073641Z [err]  2025-12-30 06:33:08,201 - persistent_tts_service - INFO - üîå [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Closing persistent TTS WebSocket...
2025-12-30T06:33:08.207077657Z [err]  2025-12-30 06:33:08,201 - server - INFO - üîç Starting QC analysis for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:08.207696193Z [err]  2025-12-30 06:33:08,202 - server - INFO - üìá Normalized phone: +17708336397
2025-12-30T06:33:08.207702085Z [err]  2025-12-30 06:33:08,202 - server - INFO - üìá CRM: Got 11 variables from active session
2025-12-30T06:33:08.207706782Z [err]  2025-12-30 06:33:08,202 - persistent_tts_service - INFO - üõë [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Audio Receiver Loop CANCELLED
2025-12-30T06:33:08.207710908Z [err]  2025-12-30 06:33:08,202 - persistent_tts_service - INFO - üëã [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Audio Receiver Loop STOPPED
2025-12-30T06:33:08.207715113Z [err]  2025-12-30 06:33:08,203 - persistent_tts_service - INFO - üõë [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Playback consumer shutting down
2025-12-30T06:33:08.295696374Z [err]  2025-12-30 06:33:08,294 - server - INFO - üìá CRM: Got 11 extracted variables
2025-12-30T06:33:08.295701044Z [err]  2025-12-30 06:33:08,294 - server - INFO - üìá CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-30T06:33:08.296535208Z [err]  2025-12-30 06:33:08,295 - server - INFO - üìù Converted transcript from 3 messages to 79 characters
2025-12-30T06:33:08.297919164Z [err]  2025-12-30 06:33:08,296 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=3, logs_count=4, status=completed
2025-12-30T06:33:08.350558680Z [err]  2025-12-30 06:33:08,347 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-30/5c98a9a4-e549-11f0-af4f-02420aef951f-1767076374619377.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251230%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251230T063307Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=9a284433f1e85be1adeeb49661477e24366949568988daf3b86c56e63da0efc9 "HTTP/1.1 200 OK"
2025-12-30T06:33:08.386331319Z [err]  2025-12-30 06:33:08,383 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:33:08.464435084Z [err]  2025-12-30 06:33:08,435 - server - INFO - ‚úÖ Downloaded 43928 bytes
2025-12-30T06:33:08.477659078Z [err]  2025-12-30 06:33:08,472 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-30T06:33:08.477668140Z [err]  2025-12-30 06:33:08,473 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-30T06:33:08.501862544Z [err]  2025-12-30 06:33:08,491 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T06:33:08.501872492Z [err]  2025-12-30 06:33:08,492 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-30T06:33:08.567604100Z [err]  2025-12-30 06:33:08,560 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-30T06:33:08.567613136Z [err]  2025-12-30 06:33:08,560 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:33:08.567620493Z [err]  2025-12-30 06:33:08,560 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:08.729230548Z [err]  2025-12-30 06:33:08,728 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-30T06:33:08.771120472Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-30T06:33:08.771130381Z [err]  2025-12-30 06:33:08,766 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:08.771152294Z [err]  2025-12-30 06:33:08,765 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T06:33:08.771162512Z [err]  2025-12-30 06:33:08,766 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:33:08.771171988Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T06:33:08.771180762Z [err]  2025-12-30 06:33:08,766 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:33:08.818641918Z [err]  2025-12-30 06:33:08,815 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-30T06:33:08.818650705Z [err]  2025-12-30 06:33:08,815 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-30T06:33:08.818659671Z [err]  2025-12-30 06:33:08,815 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-30T06:33:08.818668913Z [err]  2025-12-30 06:33:08,816 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-30T06:33:08.818677411Z [err]    File "/app/backend/server.py", line 9773, in trigger_campaign_qc_for_call
2025-12-30T06:33:08.818686141Z [err]      await run_full_qc_analysis(
2025-12-30T06:33:08.818694823Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-30T06:33:08.818704344Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-30T06:33:08.818713452Z [err]  
2025-12-30T06:33:08.944366718Z [err]  2025-12-30 06:33:08,941 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T06:33:08.944371554Z [err]  2025-12-30 06:33:08,942 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:33:08.944375761Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T06:33:08.944379789Z [err]  2025-12-30 06:33:08,942 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:33:08.944383537Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-30T06:33:08.944392962Z [err]  2025-12-30 06:33:08,942 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:09.144570555Z [err]  2025-12-30 06:33:08,995 - server - INFO - üìä Channel 1: 237644 bytes
2025-12-30T06:33:09.144580224Z [err]  2025-12-30 06:33:08,995 - server - ERROR - ‚ùå No Soniox API key available
2025-12-30T06:33:09.144588795Z [err]  2025-12-30 06:33:08,995 - server - INFO - ‚ùå Channel 1: No speech
2025-12-30T06:33:09.144600776Z [err]  2025-12-30 06:33:08,995 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-30T06:33:09.144605249Z [err]  2025-12-30 06:33:08,994 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-30T06:33:09.144612555Z [inf]  100.64.0.14:47416 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:33:09.144618366Z [err]  2025-12-30 06:33:08,994 - server - INFO - üìä Channel 0: 237644 bytes
2025-12-30T06:33:09.144626435Z [err]  2025-12-30 06:33:08,994 - server - ERROR - ‚ùå No Soniox API key available
2025-12-30T06:33:09.144633591Z [err]  2025-12-30 06:33:08,994 - server - INFO - ‚ùå Channel 0: No speech
2025-12-30T06:33:09.144687243Z [err]  2025-12-30 06:33:08,994 - server - INFO - ‚úÖ Split into 2 channels
2025-12-30T06:33:09.145104539Z [err]  2025-12-30 06:33:09,142 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T06:33:09.145112285Z [err]  2025-12-30 06:33:09,143 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:33:09.145118691Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T06:33:09.145125446Z [err]  2025-12-30 06:33:09,143 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:33:09.145131960Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T06:33:09.238724025Z [err]  2025-12-30 06:33:09,234 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:09.238733001Z [err]  2025-12-30 06:33:09,234 - server - INFO - ‚úÖ QC analysis completed for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:09.238739388Z [err]  2025-12-30 06:33:09,234 - server - INFO - üìä Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-30T06:33:09.315317217Z [err]  2025-12-30 06:33:09,314 - elevenlabs_ws_service - INFO - üîå Closed ElevenLabs WebSocket connection
2025-12-30T06:33:09.315324943Z [err]  2025-12-30 06:33:09,314 - persistent_tts_service - INFO - ‚úÖ [Call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA] Persistent TTS WebSocket closed
2025-12-30T06:33:09.315330806Z [err]  2025-12-30 06:33:09,314 - persistent_tts_service - INFO - ‚úÖ Closed persistent TTS session for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:09.315339274Z [err]  2025-12-30 06:33:09,314 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:09.321283737Z [err]  2025-12-30 06:33:09,319 - redis_service - INFO - üßπ Deleted call data from Redis: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:09.321290305Z [err]  2025-12-30 06:33:09,320 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:09.321297229Z [inf]  100.64.0.12:11764 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:33:09.466484565Z [err]  2025-12-30 06:33:09,418 - server - INFO - üìä Updated campaign_calls with QC scores for v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:09.528571092Z [err]  2025-12-30 06:33:09,518 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:09.620020971Z [err]  2025-12-30 06:33:09,594 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-30T06:33:09.685668707Z [err]  2025-12-30 06:33:09,682 - server - INFO - üè∑Ô∏è Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-30T06:33:09.685680848Z [err]  2025-12-30 06:33:09,683 - server - ERROR - ‚ùå Error in auto appointment detection for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA: 'str' object has no attribute 'get'
2025-12-30T06:33:10.158298467Z [err]  2025-12-30 06:33:10,025 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:10.158306364Z [err]  2025-12-30 06:33:10,026 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=7.1s, checkin_count=0/2
2025-12-30T06:33:10.158313080Z [err]  2025-12-30 06:33:10,026 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.1s silence (threshold: 7s)
2025-12-30T06:33:10.158318934Z [err]  2025-12-30 06:33:10,031 - core_calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-30T06:33:10.158323181Z [err]  2025-12-30 06:33:10,031 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.1s silence: Are you still there?
2025-12-30T06:33:10.158328126Z [err]  2025-12-30 06:33:10,031 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:10.158331824Z [err]  2025-12-30 06:33:10,032 - telnyx_service - INFO - üîä Speaking text on call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA: Are you still there?...
2025-12-30T06:33:10.158335698Z [err]  2025-12-30 06:33:10,032 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T06:33:10.158340511Z [err]  2025-12-30 06:33:10,032 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T06:33:10.158344763Z [err]  2025-12-30 06:33:10,032 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T06:33:10.158348646Z [err]  2025-12-30 06:33:10,032 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T06:33:10.158352335Z [err]  2025-12-30 06:33:10,032 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17181 bytes)
2025-12-30T06:33:10.158355950Z [err]  2025-12-30 06:33:10,032 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-30T06:33:10.158756531Z [err]  2025-12-30 06:33:10,033 - telnyx_service - INFO - ‚úÖ Generated 17181 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T06:33:10.158764335Z [err]  2025-12-30 06:33:10,033 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T06:33:10.324241256Z [err]  2025-12-30 06:33:10,313 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T06:33:10.324257359Z [err]  2025-12-30 06:33:10,313 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.28s
2025-12-30T06:33:10.324272923Z [err]  2025-12-30 06:33:10,313 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-30T06:33:10.324287756Z [err]    "errors": [
2025-12-30T06:33:10.324301120Z [err]      {
2025-12-30T06:33:10.324315144Z [err]        "code": "90018",
2025-12-30T06:33:10.324329619Z [err]        "title": "Call has already ended",
2025-12-30T06:33:10.324342974Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-30T06:33:10.324357037Z [err]      }
2025-12-30T06:33:10.324371622Z [err]    ]
2025-12-30T06:33:10.324385189Z [err]  }
2025-12-30T06:33:10.324397736Z [err]  2025-12-30 06:33:10,313 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-30T06:33:10.587472011Z [err]  2025-12-30 06:33:10,582 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T06:33:10.587481148Z [err]  2025-12-30 06:33:10,582 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-30T06:33:10.587487510Z [err]  2025-12-30 06:33:10,582 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-30T06:33:11.145491300Z [err]  2025-12-30 06:33:11,088 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-30T06:33:11.145495436Z [err]  2025-12-30 06:33:11,089 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767076391.0890112 for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:11.145500093Z [err]  2025-12-30 06:33:11,089 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:11.145504305Z [err]  2025-12-30 06:33:11,094 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:11.629606052Z [err]  2025-12-30 06:33:11,599 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:12.170230253Z [err]  2025-12-30 06:33:12,105 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:12.618215331Z [err]  2025-12-30 06:33:12,611 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:13.167903572Z [err]  2025-12-30 06:33:13,117 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:13.641859577Z [err]  2025-12-30 06:33:13,623 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:14.181283984Z [err]  2025-12-30 06:33:14,130 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:14.637824855Z [err]  2025-12-30 06:33:14,636 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:15.152026934Z [err]  2025-12-30 06:33:15,142 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:15.654765232Z [err]  2025-12-30 06:33:15,647 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:16.171767799Z [err]  2025-12-30 06:33:16,153 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:16.661659364Z [err]  2025-12-30 06:33:16,659 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:17.202058809Z [err]  2025-12-30 06:33:17,166 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:17.690030349Z [err]  2025-12-30 06:33:17,672 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:18.217963280Z [err]  2025-12-30 06:33:18,177 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:18.217974853Z [err]  2025-12-30 06:33:18,177 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.1s silence (threshold: 7s)
2025-12-30T06:33:18.217982775Z [err]  2025-12-30 06:33:18,183 - core_calling_service - INFO - üí¨ Sending FINAL check-in #2/2: Are you still there?
2025-12-30T06:33:18.218044962Z [err]  2025-12-30 06:33:18,183 - core_calling_service - INFO - ‚ö†Ô∏è Will end call if no response after next silence timeout
2025-12-30T06:33:18.218067687Z [err]  2025-12-30 06:33:18,183 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.1s silence: Are you still there?
2025-12-30T06:33:18.218079993Z [err]  2025-12-30 06:33:18,183 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:18.218093743Z [err]  2025-12-30 06:33:18,183 - telnyx_service - INFO - üîä Speaking text on call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA: Are you still there?...
2025-12-30T06:33:18.218105082Z [err]  2025-12-30 06:33:18,183 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T06:33:18.218114832Z [err]  2025-12-30 06:33:18,183 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T06:33:18.218124308Z [err]  2025-12-30 06:33:18,183 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T06:33:18.218133646Z [err]  2025-12-30 06:33:18,183 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T06:33:18.218142283Z [err]  2025-12-30 06:33:18,183 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17181 bytes)
2025-12-30T06:33:18.218151177Z [err]  2025-12-30 06:33:18,183 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-30T06:33:18.218440507Z [err]  2025-12-30 06:33:18,183 - telnyx_service - INFO - ‚úÖ Generated 17181 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T06:33:18.218445082Z [err]  2025-12-30 06:33:18,184 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T06:33:18.460143770Z [err]  2025-12-30 06:33:18,456 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T06:33:18.460153413Z [err]  2025-12-30 06:33:18,457 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.27s
2025-12-30T06:33:18.460161197Z [err]  2025-12-30 06:33:18,457 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-30T06:33:18.460168389Z [err]    "errors": [
2025-12-30T06:33:18.460175389Z [err]      {
2025-12-30T06:33:18.460183671Z [err]        "code": "90018",
2025-12-30T06:33:18.460191168Z [err]        "title": "Call has already ended",
2025-12-30T06:33:18.460198435Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-30T06:33:18.460206246Z [err]      }
2025-12-30T06:33:18.460214907Z [err]    ]
2025-12-30T06:33:18.460222550Z [err]  }
2025-12-30T06:33:18.460229986Z [err]  2025-12-30 06:33:18,457 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-30T06:33:18.663252566Z [err]  2025-12-30 06:33:18,659 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T06:33:18.663260966Z [err]  2025-12-30 06:33:18,659 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-30T06:33:18.663267707Z [err]  2025-12-30 06:33:18,659 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-30T06:33:19.216980304Z [err]  2025-12-30 06:33:19,172 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:19.216985414Z [err]  2025-12-30 06:33:19,172 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:19.691816891Z [err]  2025-12-30 06:33:19,683 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:19.691821768Z [err]  2025-12-30 06:33:19,683 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:20.230504371Z [err]  2025-12-30 06:33:20,195 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:20.230509624Z [err]  2025-12-30 06:33:20,195 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:20.230514243Z [err]  2025-12-30 06:33:20,195 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=2/2
2025-12-30T06:33:20.716599678Z [err]  2025-12-30 06:33:20,707 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:20.716605634Z [err]  2025-12-30 06:33:20,708 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:20.716609502Z [err]  2025-12-30 06:33:20,708 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=2/2
2025-12-30T06:33:21.240317906Z [err]  2025-12-30 06:33:21,219 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:21.240324119Z [err]  2025-12-30 06:33:21,219 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:21.777239783Z [err]  2025-12-30 06:33:21,730 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:21.777244052Z [err]  2025-12-30 06:33:21,730 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:22.248391910Z [err]  2025-12-30 06:33:22,242 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:22.248396308Z [err]  2025-12-30 06:33:22,242 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:22.758847900Z [err]  2025-12-30 06:33:22,754 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:22.758857171Z [err]  2025-12-30 06:33:22,754 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:23.269246177Z [err]  2025-12-30 06:33:23,266 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:23.269251734Z [err]  2025-12-30 06:33:23,266 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:23.797248298Z [err]  2025-12-30 06:33:23,778 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:23.797251976Z [err]  2025-12-30 06:33:23,778 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:24.307488723Z [err]  2025-12-30 06:33:24,289 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:24.307500161Z [err]  2025-12-30 06:33:24,289 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:24.809568930Z [err]  2025-12-30 06:33:24,800 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:24.809578327Z [err]  2025-12-30 06:33:24,800 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:25.312943316Z [err]  2025-12-30 06:33:25,311 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:25.312950794Z [err]  2025-12-30 06:33:25,311 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:25.824280185Z [err]  2025-12-30 06:33:25,822 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:25.824284348Z [err]  2025-12-30 06:33:25,822 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:26.339851884Z [err]  2025-12-30 06:33:26,333 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:26.339859338Z [err]  2025-12-30 06:33:26,333 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:oLcFcMqRyuLPQSMRo... (active sessions: ['v3:grbDJkmu7q7-nCqb7kJayHpiU6izB-AHqYkaaMD29PhGbUfYnw0m1g'])
2025-12-30T06:33:26.637256968Z [err]  2025-12-30 06:33:26,609 - server - INFO - üé§ Soniox receiver alive - 12 messages received in last 10s
2025-12-30T06:33:26.637263675Z [err]  2025-12-30 06:33:26,609 - server - ERROR - ‚ùå Soniox error: {'tokens': [], 'final_audio_proc_ms': 6840, 'total_audio_proc_ms': 11280, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-30T06:33:26.637271203Z [err]  2025-12-30 06:33:26,609 - server - INFO - ‚úÖ Soniox receive loop ended normally
2025-12-30T06:33:26.637277377Z [err]  2025-12-30 06:33:26,610 - dead_air_monitor - INFO - üîá Dead air monitoring cancelled for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:26.637284304Z [err]  2025-12-30 06:33:26,610 - dead_air_monitor - INFO - üîá Dead air monitoring stopped for call v3:oLcFcMqRyuLPQSMRotJdh23YvIadFk7AZDhFLrbkYNB0bzCalxskvA
2025-12-30T06:33:26.637291396Z [err]  2025-12-30 06:33:26,610 - server - INFO - üîá Dead air monitoring task cancelled
2025-12-30T06:33:28.662583302Z [err]  2025-12-30 06:33:28,612 - soniox_service - ERROR - ‚ùå Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-30T06:33:28.662589265Z [err]  2025-12-30 06:33:28,612 - server - INFO - üîå Telnyx WebSocket disconnected