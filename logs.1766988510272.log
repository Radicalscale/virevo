2025-12-29T06:04:39.000000000Z [inf]  Starting Container
2025-12-29T06:04:40.118951255Z [inf]  =========================================
2025-12-29T06:04:40.118955464Z [inf]  üöÄ START.SH SCRIPT IS EXECUTING
2025-12-29T06:04:40.118960224Z [inf]  =========================================
2025-12-29T06:04:40.118964993Z [inf]  üìç Working directory: /app/backend
2025-12-29T06:04:40.118969799Z [inf]  üîç Python path: /app/backend
2025-12-29T06:04:40.118974453Z [inf]  üåê Starting Gunicorn on 0.0.0.0:8080...
2025-12-29T06:04:40.118979516Z [inf]  =========================================
2025-12-29T06:04:40.665120156Z [err]  [2025-12-29 06:04:40 +0000] [1] [INFO] Starting gunicorn 22.0.0
2025-12-29T06:04:40.665130816Z [err]  [2025-12-29 06:04:40 +0000] [1] [INFO] Listening at: http://0.0.0.0:8080 (1)
2025-12-29T06:04:40.665138272Z [err]  [2025-12-29 06:04:40 +0000] [1] [INFO] Using worker: uvicorn.workers.UvicornWorker
2025-12-29T06:04:40.665145141Z [err]  [2025-12-29 06:04:40 +0000] [3] [INFO] Booting worker with pid: 3
2025-12-29T06:04:40.721812344Z [err]  [2025-12-29 06:04:40 +0000] [4] [INFO] Booting worker with pid: 4
2025-12-29T06:04:40.802543357Z [err]  [2025-12-29 06:04:40 +0000] [5] [INFO] Booting worker with pid: 5
2025-12-29T06:04:40.902861843Z [err]  [2025-12-29 06:04:40 +0000] [6] [INFO] Booting worker with pid: 6
2025-12-29T06:05:01.081380343Z [err]  2025-12-29 06:04:57,409 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-29T06:05:01.081389521Z [err]  2025-12-29 06:04:57,409 - server - INFO - üî• Pre-warming connection libraries...
2025-12-29T06:05:01.081396844Z [err]  2025-12-29 06:04:57,427 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-29T06:05:01.081403057Z [err]  2025-12-29 06:04:57,427 - server - INFO - üî• Pre-warming connection libraries...
2025-12-29T06:05:01.081411261Z [err]  2025-12-29 06:04:57,445 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-29T06:05:01.081417441Z [err]  2025-12-29 06:04:57,459 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-29T06:05:01.081422639Z [err]  2025-12-29 06:04:57,462 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-29T06:05:01.081430921Z [err]  2025-12-29 06:04:57,462 - server - INFO - üî• Pre-warming connection libraries...
2025-12-29T06:05:01.081438979Z [err]  2025-12-29 06:04:57,492 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-29T06:05:01.081448414Z [err]  2025-12-29 06:04:57,492 - server - INFO - üî• Pre-warming connection libraries...
2025-12-29T06:05:01.081457423Z [err]  2025-12-29 06:04:57,496 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-29T06:05:01.081466130Z [err]  2025-12-29 06:04:57,528 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-29T06:05:01.081474294Z [err]  2025-12-29 06:04:57,588 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-29T06:05:01.081483038Z [err]  2025-12-29 06:04:57,613 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-29T06:05:01.081525993Z [err]  2025-12-29 06:04:57,630 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-29T06:05:01.081539220Z [err]  2025-12-29 06:04:57,703 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-29T06:05:01.081557413Z [err]  2025-12-29 06:04:57,792 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-29T06:05:01.081563273Z [err]  2025-12-29 06:04:57,798 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-29T06:05:01.081568326Z [err]  2025-12-29 06:04:57,802 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-29T06:05:01.081574198Z [err]  2025-12-29 06:04:57,830 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-29T06:05:01.081579516Z [err]  2025-12-29 06:04:57,843 - server - INFO - ‚úÖ QC agent router loaded
2025-12-29T06:05:01.081587606Z [err]  2025-12-29 06:04:57,847 - server - INFO - ‚úÖ QC agent router loaded
2025-12-29T06:05:01.081592621Z [err]  2025-12-29 06:04:57,869 - server - INFO - ‚úÖ QC agent router loaded
2025-12-29T06:05:01.081597555Z [err]  2025-12-29 06:04:57,871 - server - INFO - ‚úÖ QC learning router loaded
2025-12-29T06:05:01.081603157Z [err]  2025-12-29 06:04:57,880 - server - INFO - ‚úÖ QC agent router loaded
2025-12-29T06:05:01.081608326Z [err]  2025-12-29 06:04:57,893 - server - INFO - ‚úÖ QC learning router loaded
2025-12-29T06:05:01.081619253Z [err]  2025-12-29 06:04:57,902 - server - INFO - ‚úÖ QC learning router loaded
2025-12-29T06:05:01.081625958Z [err]  2025-12-29 06:04:57,908 - server - INFO - ‚úÖ QC learning router loaded
2025-12-29T06:05:01.081631009Z [err]  2025-12-29 06:04:58,026 - server - INFO - ‚úÖ CRM router loaded
2025-12-29T06:05:01.081635317Z [err]  2025-12-29 06:04:58,027 - server - INFO - ‚úÖ CRM router loaded
2025-12-29T06:05:01.081644238Z [err]  2025-12-29 06:04:58,041 - server - INFO - ‚úÖ QC test router loaded
2025-12-29T06:05:01.081651571Z [err]  2025-12-29 06:04:58,050 - server - INFO - ‚úÖ CRM router loaded
2025-12-29T06:05:01.081661493Z [err]  2025-12-29 06:04:58,055 - server - INFO - ‚úÖ QC test router loaded
2025-12-29T06:05:01.081669754Z [err]  2025-12-29 06:04:58,056 - server - INFO - ‚úÖ QC test router loaded
2025-12-29T06:05:01.081677662Z [err]  2025-12-29 06:04:58,071 - server - INFO - ‚úÖ Agent test router loaded
2025-12-29T06:05:01.081695527Z [err]  2025-12-29 06:04:58,072 - server - INFO - ‚úÖ Agent test router loaded
2025-12-29T06:05:01.081704334Z [err]  2025-12-29 06:04:58,074 - server - INFO - ‚úÖ Agent test router loaded
2025-12-29T06:05:01.081714900Z [err]  2025-12-29 06:04:58,075 - server - INFO - ‚úÖ CRM router loaded
2025-12-29T06:05:01.081722878Z [err]  2025-12-29 06:04:58,082 - server - INFO - ‚úÖ QC test router loaded
2025-12-29T06:05:01.081733284Z [err]  2025-12-29 06:04:58,090 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-29T06:05:01.081741073Z [err]  2025-12-29 06:04:58,090 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-29T06:05:01.081748937Z [err]  2025-12-29 06:04:58,101 - server - INFO - ‚úÖ Agent test router loaded
2025-12-29T06:05:01.081756427Z [err]  2025-12-29 06:04:58,111 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-29T06:05:01.081761257Z [err]  2025-12-29 06:04:58,111 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-29T06:05:01.081785078Z [err]  [2025-12-29 06:04:58 +0000] [6] [INFO] Started server process [6]
2025-12-29T06:05:01.081791643Z [err]  [2025-12-29 06:04:58 +0000] [6] [INFO] Waiting for application startup.
2025-12-29T06:05:01.081798021Z [err]  [2025-12-29 06:04:58 +0000] [4] [INFO] Started server process [4]
2025-12-29T06:05:01.081805247Z [err]  [2025-12-29 06:04:58 +0000] [4] [INFO] Waiting for application startup.
2025-12-29T06:05:01.081816538Z [err]  2025-12-29 06:04:58,153 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-29T06:05:01.081826271Z [err]  2025-12-29 06:04:58,153 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-29T06:05:01.081834473Z [err]  2025-12-29 06:04:58,154 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-29T06:05:01.081846251Z [err]  2025-12-29 06:04:58,154 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-29T06:05:01.081852417Z [err]  [2025-12-29 06:04:58 +0000] [5] [INFO] Started server process [5]
2025-12-29T06:05:01.081865097Z [err]  [2025-12-29 06:04:58 +0000] [5] [INFO] Waiting for application startup.
2025-12-29T06:05:01.081886462Z [err]  [2025-12-29 06:04:58 +0000] [3] [INFO] Started server process [3]
2025-12-29T06:05:01.081893021Z [err]  [2025-12-29 06:04:58 +0000] [3] [INFO] Waiting for application startup.
2025-12-29T06:05:01.081900373Z [err]  2025-12-29 06:04:58,289 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-29T06:05:01.081906909Z [err]  2025-12-29 06:04:58,289 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-29T06:05:01.081920253Z [err]  2025-12-29 06:04:58,290 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-29T06:05:01.081927933Z [err]  2025-12-29 06:04:58,290 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-29T06:05:09.719603244Z [err]  2025-12-29 06:05:09,717 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-29T06:05:09.725607456Z [err]  2025-12-29 06:05:09,722 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-29T06:05:09.725620833Z [err]  2025-12-29 06:05:09,722 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-29T06:05:09.725632116Z [err]  2025-12-29 06:05:09,722 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-29T06:05:10.017322644Z [err]  2025-12-29 06:05:10,014 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-29T06:05:10.021227120Z [err]  2025-12-29 06:05:10,019 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-29T06:05:10.021237433Z [err]  2025-12-29 06:05:10,019 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-29T06:05:10.021245862Z [err]  2025-12-29 06:05:10,019 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-29T06:05:10.263889233Z [err]  2025-12-29 06:05:10,101 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-29T06:05:10.263903625Z [err]  2025-12-29 06:05:10,101 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-29T06:05:10.263912784Z [err]  2025-12-29 06:05:10,101 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-29T06:05:10.263921957Z [err]  2025-12-29 06:05:10,103 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-29T06:05:10.263930766Z [err]  2025-12-29 06:05:10,103 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-29T06:05:10.263939518Z [err]  2025-12-29 06:05:10,103 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-29T06:05:10.263989708Z [err]  2025-12-29 06:05:10,099 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-29T06:05:10.263999492Z [err]  2025-12-29 06:05:10,100 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-29T06:05:10.852142920Z [err]  2025-12-29 06:05:10,850 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-29T06:05:10.991149504Z [err]  2025-12-29 06:05:10,987 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-29T06:05:10.991158711Z [err]  2025-12-29 06:05:10,988 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-29T06:05:10.991166559Z [err]  [2025-12-29 06:05:10 +0000] [3] [INFO] Application startup complete.
2025-12-29T06:05:11.223343501Z [err]  2025-12-29 06:05:11,108 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-29T06:05:11.223350692Z [err]  2025-12-29 06:05:11,146 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-29T06:05:11.223357925Z [err]  2025-12-29 06:05:11,148 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-29T06:05:11.236895817Z [err]  2025-12-29 06:05:11,234 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-29T06:05:11.236901117Z [err]  2025-12-29 06:05:11,235 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-29T06:05:11.236907703Z [err]  [2025-12-29 06:05:11 +0000] [6] [INFO] Application startup complete.
2025-12-29T06:05:11.266077629Z [err]  2025-12-29 06:05:11,265 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-29T06:05:11.267953361Z [err]  2025-12-29 06:05:11,265 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-29T06:05:11.267966523Z [err]  2025-12-29 06:05:11,265 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-29T06:05:11.267975111Z [err]  2025-12-29 06:05:11,265 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-29T06:05:11.267982737Z [err]  [2025-12-29 06:05:11 +0000] [5] [INFO] Application startup complete.
2025-12-29T06:05:11.267990370Z [err]  [2025-12-29 06:05:11 +0000] [4] [INFO] Application startup complete.
2025-12-29T06:07:41.267622159Z [inf]  100.64.0.2:36334 - "POST /api/auth/logout HTTP/1.1" 200
2025-12-29T06:07:41.267626527Z [inf]  100.64.0.3:28806 - "OPTIONS /api/auth/login HTTP/1.1" 200
2025-12-29T06:07:41.267630719Z [inf]  100.64.0.2:36334 - "POST /api/auth/login HTTP/1.1" 200
2025-12-29T06:07:41.267634995Z [inf]  100.64.0.2:36334 - "GET /api/agents HTTP/1.1" 200
2025-12-29T06:07:42.539702520Z [inf]  100.64.0.2:36334 - "GET /api/agents HTTP/1.1" 200
2025-12-29T06:08:02.534506064Z [inf]  100.64.0.4:26018 - "OPTIONS /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-29T06:08:02.534516041Z [err]  2025-12-29 06:07:59,045 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T06:08:02.534523823Z [err]  2025-12-29 06:07:59,150 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T06:08:02.534531918Z [err]  2025-12-29 06:07:59,238 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T06:08:02.534538994Z [err]  2025-12-29 06:07:59,287 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T06:08:02.534546074Z [err]  2025-12-29 06:07:59,287 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-29T06:08:02.534552392Z [err]  2025-12-29 06:07:59,287 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-29T06:08:02.534560080Z [err]  2025-12-29 06:07:59,287 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T06:08:02.534567556Z [err]  2025-12-29 06:08:00,189 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-29T06:08:02.534574397Z [err]  2025-12-29 06:08:00,193 - telnyx_service - INFO - ‚úÖ Call initiated: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:02.534581139Z [err]  2025-12-29 06:08:00,297 - server - INFO - üìù Created call log: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:02.534587884Z [err]  2025-12-29 06:08:00,297 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T06:08:02.534594341Z [err]  2025-12-29 06:08:00,297 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-29T06:08:02.535460668Z [err]  2025-12-29 06:08:00,297 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T06:08:02.535472309Z [err]  2025-12-29 06:08:00,297 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T06:08:02.535480362Z [err]  2025-12-29 06:08:00,333 - redis_service - INFO - üì¶ Stored call data in Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ (TTL: 3600s)
2025-12-29T06:08:02.535489124Z [err]  2025-12-29 06:08:00,333 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-29T06:08:02.535497185Z [err]  2025-12-29 06:08:00,333 - server - INFO - üìû Outbound call initiated: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:02.535505713Z [inf]  100.64.0.5:46416 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-29T06:08:02.535513361Z [err]  2025-12-29 06:08:00,430 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T06:08:02.535521279Z [inf]  100.64.0.6:19726 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T06:08:02.535529363Z [err]  2025-12-29 06:08:00,430 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': 'c1b23139-7819-4f22-a3ac-92e735858072', 'occurred_at': '2025-12-29T06:07:59.976152Z', 'payload': {'call_control_id': 'v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ', 'call_leg_id': 'ba13de32-e47c-11f0-9d95-02420aef96a0', 'call_session_id': 'ba116a62-e47c-11f0-b0c4-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T06:08:02.535537898Z [err]  2025-12-29 06:08:00,430 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:02.537276933Z [err]  2025-12-29 06:08:00,430 - server - INFO - üì® ================================================
2025-12-29T06:08:02.537286158Z [err]  2025-12-29 06:08:00,430 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-29T06:08:02.537293176Z [err]  2025-12-29 06:08:00,604 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-29T06:08:02.537300797Z [err]  2025-12-29 06:08:00,604 - server - INFO -    Client: Address(host='100.64.0.7', port=15834)
2025-12-29T06:08:02.537307835Z [err]  2025-12-29 06:08:00,604 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'oVfWxe3j3VlInj2d5bjb+g==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'gk7LDZpCTyyiSh_xn6XIxQ', 'x-real-ip': '192.76.120.151', 'x-request-start': '1766988480368', 'accept-encoding': 'gzip'}
2025-12-29T06:08:02.537315193Z [err]  2025-12-29 06:08:00,605 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-29T06:08:02.537322627Z [err]  2025-12-29 06:08:00,605 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-29T06:08:02.537330518Z [err]  [2025-12-29 06:08:00 +0000] [4] [INFO] ('100.64.0.7', 15834) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-29T06:08:02.537337294Z [err]  2025-12-29 06:08:00,605 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-29T06:08:02.537345418Z [err]  [2025-12-29 06:08:00 +0000] [4] [INFO] connection open
2025-12-29T06:08:02.537356953Z [err]  2025-12-29 06:08:00,768 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-29T06:08:02.537364677Z [err]  2025-12-29 06:08:00,768 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-29T06:08:02.538052475Z [err]  2025-12-29 06:08:00,816 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T06:08:02.538061784Z [err]  2025-12-29 06:08:00,817 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-29T06:08:02.976464841Z [err]  2025-12-29 06:08:02,971 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T06:08:02.976475253Z [err]  2025-12-29 06:08:02,971 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': '3d941dc1-1097-4814-889a-1a12c7b870a4', 'occurred_at': '2025-12-29T06:08:02.655963Z', 'payload': {'call_control_id': 'v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ', 'call_leg_id': 'ba13de32-e47c-11f0-9d95-02420aef96a0', 'call_session_id': 'ba116a62-e47c-11f0-b0c4-02420aef96a0', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-29T06:07:59.976152Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T06:08:02.976485428Z [err]  2025-12-29 06:08:02,972 - server - INFO - üéØ Event type: call.answered, Call ID: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:02.976494854Z [err]  2025-12-29 06:08:02,972 - server - INFO - üì® ================================================
2025-12-29T06:08:02.976503470Z [err]  2025-12-29 06:08:02,972 - server - INFO - ‚úÖ Call answered: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:03.002037411Z [err]  2025-12-29 06:08:02,999 - redis_service - INFO - üì• Retrieved call data from Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:03.003486027Z [err]  2025-12-29 06:08:03,001 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-29T06:08:03.003496426Z [err]  2025-12-29 06:08:03,001 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-29T06:08:03.004671484Z [err]  2025-12-29 06:08:03,003 - server - INFO - üì¨ Received Telnyx event: start
2025-12-29T06:08:03.004681327Z [err]  2025-12-29 06:08:03,003 - server - INFO - üé¨ Stream started for call: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:03.017563808Z [err]  2025-12-29 06:08:03,014 - redis_service - INFO - üì• Retrieved call data from Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:03.017570298Z [err]  2025-12-29 06:08:03,015 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-29T06:08:03.017577118Z [err]  2025-12-29 06:08:03,015 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-29T06:08:03.112569644Z [err]  2025-12-29 06:08:03,110 - server - INFO - ‚úÖ Call log updated
2025-12-29T06:08:03.112579127Z [err]  2025-12-29 06:08:03,110 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T06:08:03.112586984Z [err]  2025-12-29 06:08:03,110 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T06:08:03.112593508Z [err]  2025-12-29 06:08:03,110 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T06:08:03.408075643Z [err]  2025-12-29 06:08:03,199 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T06:08:03.408082791Z [err]  2025-12-29 06:08:03,287 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T06:08:03.408092032Z [err]  2025-12-29 06:08:03,287 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-29T06:08:03.408100409Z [err]  2025-12-29 06:08:03,316 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T06:08:03.513863043Z [err]  2025-12-29 06:08:03,510 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T06:08:03.513869816Z [err]  2025-12-29 06:08:03,511 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-29T06:08:03.519786658Z [err]  2025-12-29 06:08:03,515 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-29T06:08:03.519795003Z [err]  2025-12-29 06:08:03,515 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-29T06:08:03.543147392Z [err]  2025-12-29 06:08:03,535 - redis_service - INFO - üì• Retrieved call data from Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:03.543155006Z [err]  2025-12-29 06:08:03,539 - server - INFO - üìù Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T06:08:03.543163156Z [err]  2025-12-29 06:08:03,539 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T06:08:03.603634912Z [err]  2025-12-29 06:08:03,594 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ/actions/playback_start "HTTP/1.1 200 OK"
2025-12-29T06:08:03.603642108Z [err]  2025-12-29 06:08:03,595 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: xLTk1Pn2vg (loop=True, overlay=True)
2025-12-29T06:08:03.603647042Z [err]  2025-12-29 06:08:03,595 - server - WARNING - ‚ö†Ô∏è Failed to start comfort noise: 'v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ'
2025-12-29T06:08:03.603651962Z [err]  2025-12-29 06:08:03,595 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:03.603656888Z [err]  2025-12-29 06:08:03,598 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T06:08:03.603661578Z [err]  2025-12-29 06:08:03,598 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': 'f00731fb-8c6b-4a1d-8cc4-1d925fcfde9e', 'occurred_at': '2025-12-29T06:08:03.195968Z', 'payload': {'call_control_id': 'v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ', 'call_leg_id': 'ba13de32-e47c-11f0-9d95-02420aef96a0', 'call_session_id': 'ba116a62-e47c-11f0-b0c4-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '0b7831a1-e0aa-4cca-9238-ca4b8ef8c49e', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T06:08:03.603668330Z [err]  2025-12-29 06:08:03,598 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:03.603674349Z [err]  2025-12-29 06:08:03,598 - server - INFO - üì® ================================================
2025-12-29T06:08:03.603679391Z [inf]  100.64.0.8:18076 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T06:08:04.150819667Z [err]  2025-12-29 06:08:04,147 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T06:08:04.150826827Z [err]  2025-12-29 06:08:04,147 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '3b9e80de-0189-486b-bbfa-7a61e9da479d', 'occurred_at': '2025-12-29T06:08:03.775976Z', 'payload': {'call_control_id': 'v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ', 'call_leg_id': 'ba13de32-e47c-11f0-9d95-02420aef96a0', 'call_session_id': 'ba116a62-e47c-11f0-b0c4-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'xLTk1Pn2vg', 'start_time': '2025-12-29T06:08:03.775976Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T06:08:04.150833716Z [err]  2025-12-29 06:08:04,147 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:04.150840742Z [err]  2025-12-29 06:08:04,147 - server - INFO - üì® ================================================
2025-12-29T06:08:04.150855026Z [inf]  100.64.0.7:15840 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T06:08:05.071445667Z [err]  2025-12-29 06:08:05,069 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ/actions/record_start "HTTP/1.1 200 OK"
2025-12-29T06:08:05.077675782Z [err]  2025-12-29 06:08:05,072 - server - INFO - üéôÔ∏è Call recording started for v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:05.077685908Z [err]  2025-12-29 06:08:05,072 - server - INFO - üîß Creating call session for v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ...
2025-12-29T06:08:05.077693882Z [err]  2025-12-29 06:08:05,072 - server - INFO - üîç Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T06:08:05.077703081Z [err]  2025-12-29 06:08:05,072 - server - INFO - üîß Calling create_call_session() - START
2025-12-29T06:08:05.077711315Z [err]  2025-12-29 06:08:05,072 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T06:08:05.077719477Z [err]  2025-12-29 06:08:05,074 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-29T06:08:05.077727655Z [err]  2025-12-29 06:08:05,074 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T06:08:05.096168570Z [err]  2025-12-29 06:08:05,094 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T06:08:05.096184832Z [err]  2025-12-29 06:08:05,095 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T06:08:05.097175971Z [err]  2025-12-29 06:08:05,096 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-29T06:08:05.161879946Z [err]  2025-12-29 06:08:05,160 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-29T06:08:05.161889621Z [err]  2025-12-29 06:08:05,160 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T06:08:05.161897446Z [err]  2025-12-29 06:08:05,160 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T06:08:05.161904378Z [err]  2025-12-29 06:08:05,160 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T06:08:05.161913736Z [err]  2025-12-29 06:08:05,160 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-29T06:08:05.407619573Z [err]  2025-12-29 06:08:05,248 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T06:08:05.407619627Z [err]  2025-12-29 06:08:05,300 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-29T06:08:05.407630306Z [err]  2025-12-29 06:08:05,265 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 104ms
2025-12-29T06:08:05.407639698Z [err]  2025-12-29 06:08:05,265 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-29T06:08:05.407640847Z [err]  2025-12-29 06:08:05,294 - redis_service - INFO - üì¶ Stored call data in Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ (TTL: 3600s)
2025-12-29T06:08:05.407648775Z [err]  2025-12-29 06:08:05,266 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-29T06:08:05.407651996Z [err]  2025-12-29 06:08:05,294 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-29T06:08:05.407657701Z [err]  2025-12-29 06:08:05,294 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-29T06:08:05.407663699Z [err]  2025-12-29 06:08:05,299 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:05.407669004Z [err]  2025-12-29 06:08:05,299 - server - INFO - ü§ñ AI session created for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:05.407676515Z [err]  2025-12-29 06:08:05,299 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-29T06:08:05.407684508Z [err]  2025-12-29 06:08:05,299 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-29T06:08:05.415948695Z [err]  2025-12-29 06:08:05,300 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-29T06:08:05.415954792Z [err]  2025-12-29 06:08:05,300 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-29T06:08:05.415959924Z [err]  2025-12-29 06:08:05,300 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-29T06:08:05.415967624Z [err]  2025-12-29 06:08:05,300 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-29T06:08:05.415973316Z [err]  2025-12-29 06:08:05,326 - redis_service - INFO - üì• Retrieved call data from Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:05.415978886Z [err]  2025-12-29 06:08:05,327 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-29T06:08:05.415984050Z [err]  2025-12-29 06:08:05,327 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-29T06:08:05.415988927Z [inf]  100.64.0.6:19726 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T06:08:05.658566361Z [err]  2025-12-29 06:08:05,652 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T06:08:05.664868528Z [err]  2025-12-29 06:08:05,662 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 565ms
2025-12-29T06:08:05.664875719Z [err]  2025-12-29 06:08:05,662 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-29T06:08:05.664884309Z [err]  2025-12-29 06:08:05,662 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-29T06:08:05.664891810Z [err]  2025-12-29 06:08:05,662 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-29T06:08:05.664899420Z [err]  2025-12-29 06:08:05,662 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-29T06:08:05.665987187Z [err]  2025-12-29 06:08:05,664 - server - INFO - ‚úÖ Initialized call_states for v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ with session reference
2025-12-29T06:08:05.665994025Z [err]  2025-12-29 06:08:05,664 - server - INFO - ‚úÖ Stored Telnyx WebSocket in call_data for audio streaming
2025-12-29T06:08:05.666000202Z [err]  2025-12-29 06:08:05,664 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found to update for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:05.671827720Z [err]  2025-12-29 06:08:05,666 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-29T06:08:05.761313769Z [err]  2025-12-29 06:08:05,755 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-29T06:08:06.438984545Z [err]  2025-12-29 06:08:06,310 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-29T06:08:06.439017289Z [err]  2025-12-29 06:08:06,304 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:06.439026029Z [err]  2025-12-29 06:08:06,267 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-29T06:08:06.439029805Z [err]  2025-12-29 06:08:06,309 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:ruRl2vbN8WHfwKC_L... (active sessions: [])
2025-12-29T06:08:06.439036445Z [err]  2025-12-29 06:08:06,268 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-29T06:08:06.439050874Z [err]  2025-12-29 06:08:06,268 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-29T06:08:06.439063349Z [err]  2025-12-29 06:08:06,302 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T06:08:06.834160871Z [err]  2025-12-29 06:08:06,816 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:ruRl2vbN8WHfwKC_L... (active sessions: [])
2025-12-29T06:08:07.476663162Z [err]  2025-12-29 06:08:07,323 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:ruRl2vbN8WHfwKC_L... (active sessions: [])
2025-12-29T06:08:07.704719126Z [err]  2025-12-29 06:08:07,693 - redis_service - INFO - üì• Retrieved call data from Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:07.704723992Z [err]  2025-12-29 06:08:07,702 - redis_service - INFO - üì• Retrieved call data from Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:07.732432832Z [err]  2025-12-29 06:08:07,730 - redis_service - INFO - üì¶ Stored call data in Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ (TTL: 3600s)
2025-12-29T06:08:07.732442704Z [err]  2025-12-29 06:08:07,730 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-29T06:08:07.732450264Z [err]  2025-12-29 06:08:07,730 - core_calling_service - INFO - ‚è±Ô∏è [06:08:07.730] üì• process_user_input() ENTRY - text: '...'
2025-12-29T06:08:07.739810715Z [err]  2025-12-29 06:08:07,738 - redis_service - INFO - üì• Retrieved call data from Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:07.741871386Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - ‚è±Ô∏è [06:08:07.740] ‚è© About to call _process_call_flow_streaming()
2025-12-29T06:08:07.741878644Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - ‚è±Ô∏è [06:08:07.740] üîÄ Agent type: call_flow, calling flow processor...
2025-12-29T06:08:07.741883981Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - ‚è±Ô∏è [06:08:07.740] üîÄ _process_call_flow_streaming() ENTRY
2025-12-29T06:08:07.741889486Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-29T06:08:07.741894472Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - ‚è±Ô∏è [06:08:07.740] ‚úÖ Node selected, about to process content...
2025-12-29T06:08:07.741899458Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - üîß Replaced {{now}} with Monday, December 29, 2025 at 1:08 AM EST in content
2025-12-29T06:08:07.741904287Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-29T06:08:07.741908865Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-29T06:08:07.741913278Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-29T06:08:07.741917672Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T06:08:07.741922296Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-29T06:08:07.741927195Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-29T06:08:07.741931378Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-29T06:08:07.744055999Z [err]  2025-12-29 06:08:07,741 - core_calling_service - INFO - LLM response (0.01s): Kendrick?
2025-12-29T06:08:07.744067123Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-29T06:08:07.744067758Z [err]  2025-12-29 06:08:07,741 - core_calling_service - INFO - Total latency: 0.01s
2025-12-29T06:08:07.744076996Z [err]  2025-12-29 06:08:07,741 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-29T06:08:07.744088458Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-29T06:08:07.744098614Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-29T06:08:07.744107174Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-29T06:08:07.744115504Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-29T06:08:07.744125039Z [err]  2025-12-29 06:08:07,740 - core_calling_service - INFO - ‚è±Ô∏è [06:08:07.740] üìÑ About to process content (mode=script, length=9)
2025-12-29T06:08:07.744135961Z [err]  2025-12-29 06:08:07,741 - core_calling_service - INFO - üîä Silence tracking reset for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ (user responded)
2025-12-29T06:08:07.744144184Z [err]  2025-12-29 06:08:07,741 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-29T06:08:07.744154091Z [err]  2025-12-29 06:08:07,741 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-29T06:08:07.831676124Z [err]  2025-12-29 06:08:07,830 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:ruRl2vbN8WHfwKC_L... (active sessions: [])
2025-12-29T06:08:07.845269328Z [err]  2025-12-29 06:08:07,844 - redis_service - INFO - üì• Retrieved call data from Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:07.847200185Z [err]  2025-12-29 06:08:07,845 - telnyx_service - INFO - üîä Speaking text on call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ: Kendrick?...
2025-12-29T06:08:07.847212259Z [err]  2025-12-29 06:08:07,845 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-29T06:08:07.847220890Z [err]  2025-12-29 06:08:07,845 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-29T06:08:07.847227133Z [err]  2025-12-29 06:08:07,845 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-29T06:08:07.847238132Z [err]  2025-12-29 06:08:07,845 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-29T06:08:07.847246597Z [err]  2025-12-29 06:08:07,845 - server - INFO - ‚è±Ô∏è [06:08:07.845] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-29T06:08:07.847254939Z [err]  2025-12-29 06:08:07,845 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-29T06:08:07.847265562Z [err]  2025-12-29 06:08:07,845 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-29T06:08:07.936817207Z [err]  2025-12-29 06:08:07,934 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T06:08:07.936822577Z [err]  2025-12-29 06:08:07,934 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-29T06:08:07.936827861Z [err]  2025-12-29 06:08:07,934 - server - INFO -    Text length: 9 chars
2025-12-29T06:08:07.936832683Z [err]  2025-12-29 06:08:07,934 - server - INFO -    Text content: 'Kendrick?'
2025-12-29T06:08:07.936837251Z [err]  2025-12-29 06:08:07,934 - server - INFO -    Text bytes: b'Kendrick?'
2025-12-29T06:08:07.936841784Z [err]  2025-12-29 06:08:07,934 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-29T06:08:07.936847598Z [err]  2025-12-29 06:08:07,934 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-29T06:08:07.936852407Z [err]  2025-12-29 06:08:07,934 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-29T06:08:07.936856857Z [err]  2025-12-29 06:08:07,934 - server - INFO -    Full data: {'text': 'Kendrick?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-29T06:08:07.936861101Z [err]  2025-12-29 06:08:07,934 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-29T06:08:07.936865474Z [err]  2025-12-29 06:08:07,934 - server - INFO -    Timeout: 10.0s
2025-12-29T06:08:07.950856210Z [err]  2025-12-29 06:08:07,945 - server - INFO -    ‚úì HTTP client created (0.011s)
2025-12-29T06:08:07.950865417Z [err]  2025-12-29 06:08:07,945 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-29T06:08:07.996279336Z [err]  2025-12-29 06:08:07,993 - server - INFO - üî§ RAW TOKENS: ["H"?]
2025-12-29T06:08:08.003189154Z [err]  2025-12-29 06:08:07,998 - core_calling_service - INFO - üîä Silence timer reset for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ (user started speaking)
2025-12-29T06:08:08.003197204Z [err]  2025-12-29 06:08:07,998 - core_calling_service - INFO - üë§ User started speaking for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:08.003204323Z [err]  2025-12-29 06:08:07,998 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-29T06:08:08.003211721Z [err]  2025-12-29 06:08:07,998 - server - INFO - üîç PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-29T06:08:08.053441178Z [err]  2025-12-29 06:08:08,043 - server - INFO - üî§ RAW TOKENS: ["H"?, "ello"?]
2025-12-29T06:08:08.053448834Z [err]  2025-12-29 06:08:08,043 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Hello' | Generating: False
2025-12-29T06:08:08.106538354Z [err]  2025-12-29 06:08:08,098 - server - INFO - üî§ RAW TOKENS: ["H"‚úì, "ello"‚úì, "?"‚úì, "<end>"‚úì]
2025-12-29T06:08:08.106554571Z [err]  2025-12-29 06:08:08,099 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-29T06:08:08.106565588Z [err]  2025-12-29 06:08:08,099 - server - INFO - üßπ Cleaned transcript: 'H ello ?' -> 'Hello?'
2025-12-29T06:08:08.106574184Z [err]  2025-12-29 06:08:08,100 - server - INFO - üì• FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-29T06:08:08.106581520Z [err]  2025-12-29 06:08:08,100 - server - INFO - üé§ Soniox final transcript: 'Hello?'
2025-12-29T06:08:08.106589642Z [err]  2025-12-29 06:08:08,100 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:ruRl2vbN8WHfwKC_L... (active sessions: [])
2025-12-29T06:08:08.106597939Z [err]  2025-12-29 06:08:08,101 - server - INFO - üîç FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-29T06:08:08.106605163Z [err]  2025-12-29 06:08:08,101 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:ruRl2vbN8WHfwKC_L... (active sessions: [])
2025-12-29T06:08:08.106613041Z [err]  2025-12-29 06:08:08,101 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-29T06:08:08.106621240Z [err]  2025-12-29 06:08:08,101 - server - INFO - ‚è±Ô∏è [06:08:08.101] üìù FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-29T06:08:08.106628877Z [err]  2025-12-29 06:08:08,101 - server - INFO - ‚è±Ô∏è [06:08:08.101] STT endpoint detection latency: 19ms
2025-12-29T06:08:08.106636595Z [err]  2025-12-29 06:08:08,101 - server - INFO - ‚è±Ô∏è [06:08:08.101] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-29T06:08:08.107851991Z [err]  2025-12-29 06:08:08,106 - redis_service - INFO - üì¶ Stored call data in Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ (TTL: 3600s)
2025-12-29T06:08:08.107859991Z [err]  2025-12-29 06:08:08,107 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-29T06:08:08.107865206Z [err]  2025-12-29 06:08:08,107 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:ruRl2vbN8WHfwKC_L... (active sessions: [])
2025-12-29T06:08:08.107869883Z [err]  2025-12-29 06:08:08,107 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-29T06:08:08.121124146Z [err]  2025-12-29 06:08:08,117 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-29T06:08:08.121135744Z [err]  2025-12-29 06:08:08,117 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-29T06:08:08.121136511Z [err]  2025-12-29 06:08:08,117 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:08.121142715Z [err]  2025-12-29 06:08:08,117 - core_calling_service - INFO - üë§ User stopped speaking for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:08.121149099Z [err]  2025-12-29 06:08:08,117 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-29T06:08:08.121155149Z [err]  2025-12-29 06:08:08,117 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+9ms
2025-12-29T06:08:08.121163345Z [err]  2025-12-29 06:08:08,117 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 9ms (Soniox model: stt-rt-v3)
2025-12-29T06:08:08.121169034Z [err]  2025-12-29 06:08:08,117 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-29T06:08:08.221668652Z [err]  2025-12-29 06:08:08,212 - server - INFO - üìù Saved user transcript to database
2025-12-29T06:08:08.221675472Z [err]  2025-12-29 06:08:08,212 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:ruRl2vbN8WHfwKC_L... (active sessions: [])
2025-12-29T06:08:08.221681009Z [err]  2025-12-29 06:08:08,213 - core_calling_service - INFO - ‚è±Ô∏è [06:08:08.212] üì• process_user_input() ENTRY - text: 'Hello?...'
2025-12-29T06:08:08.221686041Z [err]  2025-12-29 06:08:08,218 - redis_service - INFO - üì• Retrieved call data from Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:08.221690646Z [err]  2025-12-29 06:08:08,218 - core_calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ: User spoke while Silence Greeting was triggering
2025-12-29T06:08:08.463664237Z [err]  2025-12-29 06:08:08,258 - core_calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-29T06:08:08.463739723Z [err]  2025-12-29 06:08:08,247 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T06:08:08.463748954Z [err]  2025-12-29 06:08:08,247 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:08.463757344Z [err]  2025-12-29 06:08:08,247 - telnyx_service - ERROR - ‚ùå Error stopping audio playback: 'ActionsResource' object has no attribute 'playback_stop'
2025-12-29T06:08:08.463765817Z [err]  2025-12-29 06:08:08,247 - core_calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-29T06:08:08.463773592Z [err]  2025-12-29 06:08:08,247 - core_calling_service - INFO - ‚úÖ BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-29T06:08:08.463782060Z [err]  2025-12-29 06:08:08,253 - redis_service - INFO - üì• Retrieved call data from Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:08.463790852Z [err]  2025-12-29 06:08:08,258 - redis_service - INFO - üì¶ Stored call data in Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ (TTL: 3600s)
2025-12-29T06:08:08.463799017Z [err]  2025-12-29 06:08:08,258 - core_calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-29T06:08:08.463807441Z [err]  2025-12-29 06:08:08,258 - core_calling_service - INFO - ‚è±Ô∏è [06:08:08.258] ‚è© About to call _process_call_flow_streaming()
2025-12-29T06:08:08.463815462Z [err]  2025-12-29 06:08:08,258 - core_calling_service - INFO - ‚è±Ô∏è [06:08:08.258] üîÄ Agent type: call_flow, calling flow processor...
2025-12-29T06:08:08.463824885Z [err]  2025-12-29 06:08:08,258 - core_calling_service - INFO - ‚è±Ô∏è [06:08:08.258] üîÄ _process_call_flow_streaming() ENTRY
2025-12-29T06:08:08.463832502Z [err]  2025-12-29 06:08:08,258 - core_calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-29T06:08:08.464747895Z [err]  2025-12-29 06:08:08,258 - core_calling_service - INFO - ‚è±Ô∏è [06:08:08.258] üîÄ About to call _follow_transition() for: Hello?...
2025-12-29T06:08:08.464756010Z [err]  2025-12-29 06:08:08,259 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Hello?
2025-12-29T06:08:08.464763646Z [err]  2025-12-29 06:08:08,270 - core_calling_service - INFO - ‚è±Ô∏è [06:08:08.270] üîÄ TRANSITION EVALUATION START - Calling LLM for 2 options
2025-12-29T06:08:08.464768616Z [err]  2025-12-29 06:08:08,447 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T06:08:08.464772782Z [err]  2025-12-29 06:08:08,447 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': '50687d36-57f5-4036-a637-3f4784cdbc45', 'occurred_at': '2025-12-29T06:08:08.015973Z', 'payload': {'call_control_id': 'v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ', 'call_leg_id': 'ba13de32-e47c-11f0-9d95-02420aef96a0', 'call_session_id': 'ba116a62-e47c-11f0-b0c4-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T06:08:08.464777159Z [err]  2025-12-29 06:08:08,448 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:08.464781332Z [err]  2025-12-29 06:08:08,448 - server - INFO - üì® ================================================
2025-12-29T06:08:08.464786026Z [inf]  100.64.0.9:31134 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T06:08:08.504627569Z [err]  2025-12-29 06:08:08,503 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-29T06:08:08.504635451Z [err]  2025-12-29 06:08:08,503 - server - INFO -    ‚úì Connection established (0.569s) [TARGET: <200ms]
2025-12-29T06:08:08.504642225Z [err]  2025-12-29 06:08:08,503 - server - INFO -    ‚úì Response status: 200
2025-12-29T06:08:08.504651260Z [err]  2025-12-29 06:08:08,503 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-29T06:08:08.506684883Z [err]  2025-12-29 06:08:08,504 - server - INFO -    ‚úì FIRST CHUNK received (0.569s, 1075 bytes) [TARGET: <300ms]
2025-12-29T06:08:08.517652231Z [err]  2025-12-29 06:08:08,516 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:ruRl2vbN8WHfwKC_L... (active sessions: [])
2025-12-29T06:08:08.517657875Z [err]  2025-12-29 06:08:08,517 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:ruRl2vbN8WHfwKC_L... (active sessions: [])
2025-12-29T06:08:08.524929911Z [err]  2025-12-29 06:08:08,520 - server - INFO -    ‚úì ALL CHUNKS received: 44 chunks (0.586s)
2025-12-29T06:08:08.524939332Z [err]  2025-12-29 06:08:08,520 - server - INFO -    ‚úì Total audio size: 13419 bytes
2025-12-29T06:08:08.524948383Z [err]  2025-12-29 06:08:08,520 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-29T06:08:08.524957031Z [err]  2025-12-29 06:08:08,520 - server - INFO -       - Connection: 569ms
2025-12-29T06:08:08.524966377Z [err]  2025-12-29 06:08:08,520 - server - INFO -       - First chunk: 569ms
2025-12-29T06:08:08.524975424Z [err]  2025-12-29 06:08:08,520 - server - INFO -       - All chunks: 586ms
2025-12-29T06:08:08.524984898Z [err]  2025-12-29 06:08:08,520 - server - INFO -       - Audio generation only: 1ms
2025-12-29T06:08:08.524993567Z [err]  2025-12-29 06:08:08,521 - server - INFO - ‚è±Ô∏è [06:08:08.521] üîä TTS COMPLETE: 675ms, audio_size=13419 bytes
2025-12-29T06:08:08.525003057Z [err]  2025-12-29 06:08:08,521 - server - INFO - üíæ TTS CACHED: elevenlabs:Kendrick?... (13419 bytes)
2025-12-29T06:08:08.525011776Z [err]  2025-12-29 06:08:08,521 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.68s
2025-12-29T06:08:08.525020289Z [err]  2025-12-29 06:08:08,521 - telnyx_service - INFO - ‚úÖ Generated 13419 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-29T06:08:08.525027837Z [err]  2025-12-29 06:08:08,522 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-29T06:08:08.825580282Z [err]  2025-12-29 06:08:08,822 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ/actions/playback_start "HTTP/1.1 200 OK"
2025-12-29T06:08:08.826475925Z [err]  2025-12-29 06:08:08,824 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.30s
2025-12-29T06:08:08.826486802Z [err]  2025-12-29 06:08:08,824 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 0.98s
2025-12-29T06:08:08.826495445Z [err]  2025-12-29 06:08:08,824 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-29T06:08:08.826502409Z [err]  2025-12-29 06:08:08,824 - telnyx_service - INFO - üé¨ Playback ID: r6AtryJMhQ
2025-12-29T06:08:08.826509835Z [err]  2025-12-29 06:08:08,824 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-29T06:08:08.826517959Z [err]  2025-12-29 06:08:08,824 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-29T06:08:08.941643981Z [err]  2025-12-29 06:08:08,938 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-29T06:08:08.949668001Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - üîß Replaced {{now}} with Monday, December 29, 2025 at 1:08 AM EST in content
2025-12-29T06:08:08.949673355Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - ‚è±Ô∏è [06:08:08.947] üîÄ TRANSITION EVALUATION COMPLETE - took 676ms
2025-12-29T06:08:08.949682802Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - ü§ñ AI transition decision: '-1'
2025-12-29T06:08:08.949685929Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-29T06:08:08.949695256Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-29T06:08:08.949703067Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-29T06:08:08.949706416Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - üìä Available transitions: ['Confirms name (Yes|Speaking|This is he/she) OR Ask...', 'Wrong number (No John here|Wrong number|etc) - don...']
2025-12-29T06:08:08.949714928Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - Selected transition index: -1
2025-12-29T06:08:08.949722874Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - No specific condition matched, looking for default transition...
2025-12-29T06:08:08.949730988Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - ‚ö†Ô∏è No transition matched, but node has GOAL. Staying on current node to continue with goal-based guidance.
2025-12-29T06:08:08.949740644Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - üéØ Goal: Say the customer's name...
2025-12-29T06:08:08.949751021Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 688ms
2025-12-29T06:08:08.949758778Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - ‚è±Ô∏è [06:08:08.947] ‚úÖ Node selected, about to process content...
2025-12-29T06:08:08.951064241Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T06:08:08.951079046Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-29T06:08:08.951086493Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-29T06:08:08.951094221Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-29T06:08:08.951100692Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-29T06:08:08.951108828Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-29T06:08:08.951116195Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-29T06:08:08.951122241Z [err]  2025-12-29 06:08:08,947 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-29T06:08:08.951128092Z [err]  2025-12-29 06:08:08,948 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-29T06:08:08.951148043Z [err]  2025-12-29 06:08:08,948 - core_calling_service - INFO - ‚è±Ô∏è [06:08:08.948] üìÑ About to process content (mode=script, length=9)
2025-12-29T06:08:08.951154628Z [err]  2025-12-29 06:08:08,948 - core_calling_service - INFO - üõ°Ô∏è Preventing Dead Air: User stayed on script node 'Greeting' without transition
2025-12-29T06:08:08.951161033Z [err]  2025-12-29 06:08:08,948 - core_calling_service - INFO - ü§ñ Generating sticky-prevention response...
2025-12-29T06:08:08.965675486Z [err]  2025-12-29 06:08:08,964 - core_calling_service - INFO - üìù   Preview: # Global Prompt: Direct Drive Engine (V4.2 - Acknowledging & Fluid)
2025-12-29T06:08:08.965675952Z [err]  2025-12-29 06:08:08,958 - core_calling_service - INFO - ‚ö° PARALLEL MODE: Running KB + analysis simultaneously
2025-12-29T06:08:08.965686658Z [err]  
2025-12-29T06:08:08.965690571Z [err]  2025-12-29 06:08:08,961 - kb_router - INFO - üö¶ KB Router: SKIP (simple chat pattern matched)
2025-12-29T06:08:08.965694059Z [err]  When user states income, convert/update as [yearly_income] variable for logic splits.
2025-12-29T06:08:08.965701478Z [err]  
2025-12-29T06:08:08.965701986Z [err]  2025-12-29 06:08:08,961 - core_calling_service - INFO - ‚ö° Skipping KB (reason: simple_chat)
2025-12-29T06:08:08.965707765Z [err]  If user says a name, don't assume it's theirs‚Äîwait for explicit correction.
2025-12-29T06:08:08.965712857Z [err]  2025-12-29 06:08:08,961 - core_calling_service - INFO - ‚ö° Parallel operations completed in 0ms
2025-12-29T06:08:08.965714967Z [err]  
2025-12-29T06:08:08.965722040Z [err]  If user asks to repeat info, rephrase naturally‚Äînever exact repeat.
2025-12-29T06:08:08.965724103Z [err]  2025-12-29 06:08:08,961 - core_calling_service - INFO - üîç Node 'Greeting': use_parallel_llm=True
2025-12-29T06:08:08.965731725Z [err]  2025-12-29 06:08:08,963 - core_calling_service - INFO - ‚ö° Parallel mode: Using condensed history (3/3 messages)
2025-12-29T06:08:08.965741235Z [err]  2025-12-29 06:08:08,963 - core_calling_service - INFO - ‚è±Ô∏è [06:08:08.963] üí¨ LLM REQUEST START: 3 conversation turns, 7881 system chars (KB cached)
2025-12-29T06:08:08.965748976Z [err]  2025-12-29 06:08:08,963 - core_calling_service - INFO - üìù ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LLM PROMPT BREAKDOWN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-29T06:08:08.965756954Z [err]  2025-12-29 06:08:08,964 - core_calling_service - INFO - üìù [SYSTEM MSG 1 - GLOBAL PROMPT] (6467 chars):
2025-12-29T06:08:08.967170818Z [err]  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
2025-12-29T06:08:08.967175398Z [err]  
2025-12-29T06:08:08.967182116Z [err]  If asked your state: "Atlanta, GA. Been in Midtown 10 years."
2025-12-29T06:08:08.967185775Z [err]  
2025-12-29T06:08:08.967188773Z [err]  
2025-12-29T06:08:08.967194849Z [err]  If asked about call number: "Company number."
2025-12-29T06:08:08.967198061Z [err]  USER COMMUNICATION STYLE: C type - adjust your response accordingly
2025-12-29T06:08:08.967201395Z [err]  
2025-12-29T06:08:08.967206886Z [err]  User email: {customer_email} (for them: {{customer_email}}).
2025-12-29T06:08:08.967209817Z [err]  CONVERSATION STATUS: Turn 2, objection handling phase
2025-12-29T06:08:08.967214013Z [err]  
2025-12-29T06:08:08.967220180Z [err]  If explaining ends in peri...
2025-12-29T06:08:08.967221509Z [err]  
2025-12-29T06:08:08.967226411Z [err]  2025-12-29 06:08:08,964 - core_calling_service - INFO - üìù [SYSTEM MSG 2 - DYNAMIC CONTEXT] (1414 chars):
2025-12-29T06:08:08.967233138Z [err]  This context is provided to help you focus. You still need to:
2025-12-29T06:08:08.967233351Z [err]  2025-12-29 06:08:08,964 - core_calling_service - INFO - üìù   Preview: 
2025-12-29T06:08:08.967239676Z [err]  
2025-12-29T06:08:08.967245165Z [err]  1. Generate a natural, contextual response
2025-12-29T06:08:08.967246028Z [err]  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
2025-12-29T06:08:08.967252733Z [err]  PREPROCESSED CONTEXT (to help you prioritize and focus):
2025-12-29T06:08:08.967257131Z [err]  2. Evaluate transitions per your node instructions
2025-12-29T06:08:08.968591531Z [err]  
2025-12-29T06:08:08.968604364Z [err]  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
2025-12-29T06:08:08.968614632Z [err]  
2025-12-29T06:08:08.968622662Z [err]  # CURRENT CONTEXT
2025-12-29T06:08:08.968630367Z [err]  Customer: Kendrick
2025-12-29T06:08:08.968637895Z [err]  Variables: {"now": "Monday, December 29, 2025 at 1:08 AM EST", "customer_name": "Kendrick", "callerName": "", "lead_id": null, "qc_tracking_enabled": false, "track_keywords": "", "expected_commitment": ...
2025-12-29T06:08:08.968647102Z [err]  2025-12-29 06:08:08,964 - core_calling_service - INFO - üìù [CONVERSATION HISTORY] (3 messages)
2025-12-29T06:08:08.968654276Z [err]  2025-12-29 06:08:08,964 - core_calling_service - INFO - üìù   assistant: Kendrick?...
2025-12-29T06:08:08.968661667Z [err]  2025-12-29 06:08:08,964 - core_calling_service - INFO - üìù   user: Hello?...
2025-12-29T06:08:08.968669572Z [err]  2025-12-29 06:08:08,964 - core_calling_service - INFO - üìù ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-29T06:08:09.030506302Z [err]  2025-12-29 06:08:09,028 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:ruRl2vbN8WHfwKC_L... (active sessions: [])
2025-12-29T06:08:09.030511896Z [err]  2025-12-29 06:08:09,028 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:ruRl2vbN8WHfwKC_L... (active sessions: [])
2025-12-29T06:08:09.504260005Z [err]  2025-12-29 06:08:09,401 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-29T06:08:09.540493508Z [err]  2025-12-29 06:08:09,538 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:ruRl2vbN8WHfwKC_L... (active sessions: [])
2025-12-29T06:08:09.540503884Z [err]  2025-12-29 06:08:09,539 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:ruRl2vbN8WHfwKC_L... (active sessions: [])
2025-12-29T06:08:09.722536076Z [err]  2025-12-29 06:08:09,716 - core_calling_service - INFO - ‚è±Ô∏è [06:08:09.715] üí¨ LLM FIRST TOKEN: 751ms (grok grok-4-1-fast-non-reasoning)
2025-12-29T06:08:09.744985821Z [err]  2025-12-29 06:08:09,744 - server - INFO - üì§ Sentence arrived from LLM: [N] Hey Kendrick,...
2025-12-29T06:08:09.744990988Z [err]  2025-12-29 06:08:09,744 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 1626ms
2025-12-29T06:08:09.744996938Z [err]  2025-12-29 06:08:09,744 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-29T06:08:09.745002535Z [err]  2025-12-29 06:08:09,744 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:ruRl2vbN8WHfwKC_L... (active sessions: [])
2025-12-29T06:08:09.746967823Z [err]  2025-12-29 06:08:09,744 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-29T06:08:09.894868116Z [err]  2025-12-29 06:08:09,832 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T06:08:09.919982498Z [inf]  100.64.0.10:27746 - "GET /api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3 HTTP/1.1" 200
2025-12-29T06:08:09.921559217Z [err]  2025-12-29 06:08:09,920 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T06:08:10.011528372Z [err]  2025-12-29 06:08:10,010 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T06:08:10.058786127Z [err]  2025-12-29 06:08:10,046 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T06:08:10.058797012Z [err]  2025-12-29 06:08:10,046 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-29T06:08:10.058805505Z [err]  2025-12-29 06:08:10,047 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T06:08:10.058813213Z [err]  2025-12-29 06:08:10,047 - persistent_tts_service - INFO - üîå [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] Establishing persistent TTS WebSocket...
2025-12-29T06:08:10.058826629Z [err]  2025-12-29 06:08:10,047 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T06:08:10.058834752Z [err]  2025-12-29 06:08:10,047 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-29T06:08:10.058842634Z [err]  2025-12-29 06:08:10,047 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-29T06:08:10.072225922Z [err]  2025-12-29 06:08:10,071 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:ruRl2vbN8WHfwKC_L... (active sessions: [])
2025-12-29T06:08:10.072237946Z [err]  2025-12-29 06:08:10,071 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:ruRl2vbN8WHfwKC_L... (active sessions: [])
2025-12-29T06:08:10.072248996Z [err]  2025-12-29 06:08:10,071 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-29T06:08:10.200488278Z [err]  2025-12-29 06:08:10,189 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:10.200494150Z [err]  2025-12-29 06:08:10,189 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-29T06:08:10.200502439Z [err]  2025-12-29 06:08:10,189 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-29T06:08:10.200505098Z [err]  2025-12-29 06:08:10,189 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-29T06:08:10.200513421Z [err]  2025-12-29 06:08:10,189 - server - INFO - üîç Persistent TTS lookup: call_id=v3:ruRl2vbN8WHfwKC_L..., session=FOUND
2025-12-29T06:08:10.200516381Z [err]  2025-12-29 06:08:10,189 - persistent_tts_service - INFO - ‚úÖ [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] Persistent TTS WebSocket established
2025-12-29T06:08:10.200523553Z [err]  2025-12-29 06:08:10,189 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-29T06:08:10.200529331Z [err]  2025-12-29 06:08:10,189 - persistent_tts_service - INFO - üéß [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] Audio receiver loop started
2025-12-29T06:08:10.200532570Z [err]  2025-12-29 06:08:10,189 - server - INFO - üéµ TTS task #1 started at +445ms
2025-12-29T06:08:10.200541074Z [err]  2025-12-29 06:08:10,189 - persistent_tts_service - INFO - üîä [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] Comfort noise loop started
2025-12-29T06:08:10.200541377Z [err]  2025-12-29 06:08:10,189 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 2072ms
2025-12-29T06:08:10.200549498Z [err]  2025-12-29 06:08:10,189 - core_calling_service - INFO - üì§ Streamed sentence: [N] Hey Kendrick,...
2025-12-29T06:08:10.200556103Z [err]  2025-12-29 06:08:10,190 - persistent_tts_service - INFO - üéµ [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] Playback consumer started
2025-12-29T06:08:10.201766591Z [err]  2025-12-29 06:08:10,190 - persistent_tts_service - INFO - üéß [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] Audio Receiver Loop STARTED
2025-12-29T06:08:10.201777612Z [err]  2025-12-29 06:08:10,191 - persistent_tts_service - INFO - üíì [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] Starting TTS keep-alive loop (every 15s)
2025-12-29T06:08:10.201786130Z [err]  2025-12-29 06:08:10,191 - persistent_tts_service - INFO - üîä [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] Starting comfort noise loop
2025-12-29T06:08:10.201793317Z [err]  2025-12-29 06:08:10,191 - persistent_tts_service - INFO - üé§ [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] Streaming sentence #1: [N] Hey Kendrick,...
2025-12-29T06:08:10.201801070Z [err]  2025-12-29 06:08:10,191 - persistent_tts_service - INFO - üöÄ [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-29T06:08:10.201808989Z [err]  2025-12-29 06:08:10,191 - persistent_tts_service - INFO - üìä [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-29T06:08:10.203649896Z [err]  2025-12-29 06:08:10,201 - persistent_tts_service - INFO - üéß [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] Receiver processing sentence #1: '[N] Hey Kendrick,...'
2025-12-29T06:08:10.203658093Z [err]  2025-12-29 06:08:10,201 - persistent_tts_service - INFO - üìä [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] DIAGNOSTIC: queue_latency=9ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-29T06:08:10.203665219Z [err]  2025-12-29 06:08:10,201 - server - INFO - üì§ Sentence arrived from LLM: yeah it's me - is now a good time to chat quick ab...
2025-12-29T06:08:10.203671779Z [err]  2025-12-29 06:08:10,202 - server - INFO - üîç Persistent TTS lookup: call_id=v3:ruRl2vbN8WHfwKC_L..., session=FOUND
2025-12-29T06:08:10.203678229Z [err]  2025-12-29 06:08:10,202 - server - INFO - üöÄ Streaming sentence #2 via persistent WebSocket
2025-12-29T06:08:10.203684498Z [err]  2025-12-29 06:08:10,202 - server - INFO - üéµ TTS task #2 started at +458ms
2025-12-29T06:08:10.203690480Z [err]  2025-12-29 06:08:10,202 - core_calling_service - INFO - üì§ Streamed final fragment: yeah it's me - is now a good time to chat quick ab...
2025-12-29T06:08:10.203699181Z [err]  2025-12-29 06:08:10,202 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] LLM_TOTAL: 1238ms for 111 chars (grok grok-4-1-fast-non-reasoning)
2025-12-29T06:08:10.203706081Z [err]  2025-12-29 06:08:10,202 - core_calling_service - INFO - üîä Silence tracking reset for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ (user responded)
2025-12-29T06:08:10.203712926Z [err]  2025-12-29 06:08:10,202 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-29T06:08:10.203721125Z [err]  2025-12-29 06:08:10,202 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-29T06:08:10.203728165Z [err]  2025-12-29 06:08:10,202 - core_calling_service - INFO - LLM response (1.99s): [N] Hey Kendrick, yeah it's me - is now a good time to chat quick about that Google Leads thing you clicked on?
2025-12-29T06:08:10.205533725Z [err]  2025-12-29 06:08:10,202 - core_calling_service - INFO - Total latency: 1.99s
2025-12-29T06:08:10.207767835Z [err]  2025-12-29 06:08:10,205 - server - INFO - ‚úÖ LLM finished in 2087ms, TTS tasks already running in background
2025-12-29T06:08:10.207777379Z [err]  2025-12-29 06:08:10,205 - server - INFO - üéµ Streaming 2 TTS chunks as they complete...
2025-12-29T06:08:10.207783467Z [err]  2025-12-29 06:08:10,205 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-29T06:08:10.207789067Z [err]  2025-12-29 06:08:10,205 - server - INFO -    2 sentences queued and playing seamlessly
2025-12-29T06:08:10.207795411Z [err]  2025-12-29 06:08:10,206 - persistent_tts_service - INFO - üé§ [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] Streaming sentence #2: yeah it's me - is now a good time to chat quick ab...
2025-12-29T06:08:10.207801193Z [err]  2025-12-29 06:08:10,206 - persistent_tts_service - INFO - üöÄ [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] Sent sentence #2 (NON-BLOCKING) in 0ms
2025-12-29T06:08:10.207807258Z [err]  2025-12-29 06:08:10,206 - persistent_tts_service - INFO - üìä [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=False, is_last=False
2025-12-29T06:08:10.207813098Z [err]  2025-12-29 06:08:10,206 - server - INFO - ‚úÖ All 2 persistent TTS streams completed
2025-12-29T06:08:10.207818422Z [err]  2025-12-29 06:08:10,206 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-29T06:08:10.207829691Z [err]  2025-12-29 06:08:10,206 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 2089ms from user stop üöÄ
2025-12-29T06:08:10.207834622Z [err]  2025-12-29 06:08:10,206 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:10.207840057Z [err]  2025-12-29 06:08:10,206 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-29T06:08:10.207845368Z [err]  2025-12-29 06:08:10,206 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-29T06:08:10.209496671Z [err]  2025-12-29 06:08:10,206 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-29T06:08:10.209507625Z [err]  2025-12-29 06:08:10,207 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 9ms (provider: soniox, model: stt-rt-v3)
2025-12-29T06:08:10.209517946Z [err]  2025-12-29 06:08:10,207 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 2087ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-29T06:08:10.209526123Z [err]  2025-12-29 06:08:10,207 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 462ms (provider: elevenlabs, websocket: False)
2025-12-29T06:08:10.209535070Z [err]  2025-12-29 06:08:10,207 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 2089ms (user stopped ‚Üí play_audio_url called)
2025-12-29T06:08:10.209542891Z [err]  2025-12-29 06:08:10,207 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-29T06:08:10.209550895Z [err]  2025-12-29 06:08:10,207 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-29T06:08:10.209557976Z [err]  2025-12-29 06:08:10,207 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-29T06:08:10.209565391Z [err]  2025-12-29 06:08:10,207 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-29T06:08:10.209573134Z [err]  2025-12-29 06:08:10,207 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-29T06:08:10.209581015Z [err]  2025-12-29 06:08:10,207 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 2389ms estimated
2025-12-29T06:08:10.209587931Z [err]  2025-12-29 06:08:10,207 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 111 chars, 2 sentences
2025-12-29T06:08:10.209595377Z [err]  2025-12-29 06:08:10,207 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Hello?...'
2025-12-29T06:08:10.209603357Z [err]  2025-12-29 06:08:10,207 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: '[N] Hey Kendrick, yeah it's me - is now a good time to chat ...'
2025-12-29T06:08:10.211023377Z [err]  2025-12-29 06:08:10,207 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-29T06:08:10.211029279Z [err]  2025-12-29 06:08:10,207 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-29T06:08:10.475434850Z [err]  2025-12-29 06:08:10,396 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-29T06:08:10.475575766Z [err]  2025-12-29 06:08:10,396 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 2558ms)
2025-12-29T06:08:10.475586689Z [err]  2025-12-29 06:08:10,396 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-29T06:08:10.480929036Z [err]  2025-12-29 06:08:10,477 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 285ms
2025-12-29T06:08:10.480938733Z [err]  2025-12-29 06:08:10,477 - persistent_tts_service - INFO - üì§ Sending 9643 bytes of audio (61 chunks, 1.2s duration) via WebSocket
2025-12-29T06:08:10.480958288Z [err]  2025-12-29 06:08:10,477 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T06:08:10.480967849Z [err]  2025-12-29 06:08:10,477 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.2s (total: 1.2s from now)
2025-12-29T06:08:10.480976969Z [err]  2025-12-29 06:08:10,478 - persistent_tts_service - INFO - ‚úÖ Sent 61 audio chunks via WebSocket
2025-12-29T06:08:10.596108213Z [err]  2025-12-29 06:08:10,582 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (1.1s left)
2025-12-29T06:08:10.683537581Z [err]  2025-12-29 06:08:10,682 - persistent_tts_service - INFO - üì§ Sending 13793 bytes of audio (87 chunks, 1.7s duration) via WebSocket
2025-12-29T06:08:10.683550428Z [err]  2025-12-29 06:08:10,682 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T06:08:10.683561484Z [err]  2025-12-29 06:08:10,682 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.7s (total: 2.7s from now)
2025-12-29T06:08:10.685038953Z [err]  2025-12-29 06:08:10,684 - persistent_tts_service - INFO - ‚úÖ Sent 87 audio chunks via WebSocket
2025-12-29T06:08:10.686802806Z [err]  2025-12-29 06:08:10,685 - persistent_tts_service - INFO - üì§ Sending 325 bytes of audio (3 chunks, 0.0s duration) via WebSocket
2025-12-29T06:08:10.686812071Z [err]  2025-12-29 06:08:10,685 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T06:08:10.686820116Z [err]  2025-12-29 06:08:10,685 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +0.0s (total: 2.8s from now)
2025-12-29T06:08:10.686827299Z [err]  2025-12-29 06:08:10,685 - persistent_tts_service - INFO - ‚úÖ Sent 3 audio chunks via WebSocket
2025-12-29T06:08:10.875130958Z [err]  2025-12-29 06:08:10,871 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T06:08:10.875143016Z [err]  2025-12-29 06:08:10,871 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '0bfdbadd-3263-40f2-99b6-b5f0737a08c7', 'occurred_at': '2025-12-29T06:08:10.395972Z', 'payload': {'call_control_id': 'v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ', 'call_leg_id': 'ba13de32-e47c-11f0-9d95-02420aef96a0', 'call_session_id': 'ba116a62-e47c-11f0-b0c4-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'r6AtryJMhQ'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T06:08:10.875151939Z [err]  2025-12-29 06:08:10,871 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:10.875161399Z [err]  2025-12-29 06:08:10,871 - server - INFO - üì® ================================================
2025-12-29T06:08:10.875169810Z [inf]  100.64.0.11:16280 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T06:08:10.886672517Z [err]  2025-12-29 06:08:10,881 - persistent_tts_service - INFO - üì§ Sending 13375 bytes of audio (84 chunks, 1.7s duration) via WebSocket
2025-12-29T06:08:10.886679506Z [err]  2025-12-29 06:08:10,881 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T06:08:10.886687307Z [err]  2025-12-29 06:08:10,881 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.7s (total: 4.2s from now)
2025-12-29T06:08:10.886692320Z [err]  2025-12-29 06:08:10,882 - persistent_tts_service - INFO - ‚úÖ Sent 84 audio chunks via WebSocket
2025-12-29T06:08:11.035822589Z [err]  2025-12-29 06:08:11,034 - persistent_tts_service - INFO - üì§ Sending 10031 bytes of audio (63 chunks, 1.3s duration) via WebSocket
2025-12-29T06:08:11.035829818Z [err]  2025-12-29 06:08:11,034 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T06:08:11.035835229Z [err]  2025-12-29 06:08:11,034 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.3s (total: 5.3s from now)
2025-12-29T06:08:11.037285954Z [err]  2025-12-29 06:08:11,036 - persistent_tts_service - INFO - ‚úÖ Sent 63 audio chunks via WebSocket
2025-12-29T06:08:11.513315035Z [err]  2025-12-29 06:08:11,467 - server - INFO - ‚è±Ô∏è CLEARED playback_expected_end_time - agent is definitely done speaking
2025-12-29T06:08:11.513431050Z [err]  2025-12-29 06:08:11,322 - server - INFO - üì§ Audio flowing: 395 packets sent to Soniox (5s update)
2025-12-29T06:08:11.513439330Z [err]  2025-12-29 06:08:11,456 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T06:08:11.513448105Z [err]  2025-12-29 06:08:11,456 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '4ae74232-564b-4118-a435-5d09e165c0fd', 'occurred_at': '2025-12-29T06:08:11.235964Z', 'payload': {'call_control_id': 'v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ', 'call_leg_id': 'ba13de32-e47c-11f0-9d95-02420aef96a0', 'call_session_id': 'ba116a62-e47c-11f0-b0c4-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'r6AtryJMhQ', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T06:08:11.513456540Z [err]  2025-12-29 06:08:11,456 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:11.513465797Z [err]  2025-12-29 06:08:11,456 - server - INFO - üì® ================================================
2025-12-29T06:08:11.513487330Z [err]  2025-12-29 06:08:11,467 - redis_service - INFO - ‚ûñ Removed playback r6AtryJMhQ, 0 remaining for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:11.513496834Z [err]  2025-12-29 06:08:11,467 - server - INFO - üîä Redis: Removed playback r6AtryJMhQ, 0 remaining
2025-12-29T06:08:11.513505096Z [err]  2025-12-29 06:08:11,467 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T06:08:11.513865759Z [err]  2025-12-29 06:08:11,472 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T06:08:11.513876930Z [err]  2025-12-29 06:08:11,472 - server - INFO - ‚úÖ Found session locally: agent_speaking=True, user_speaking=False
2025-12-29T06:08:11.513886292Z [err]  2025-12-29 06:08:11,472 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766988491.472981 for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:11.513896460Z [err]  2025-12-29 06:08:11,473 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:11.513904869Z [err]  2025-12-29 06:08:11,473 - server - INFO - ‚è±Ô∏è Agent done speaking, silence timer STARTED (local)
2025-12-29T06:08:11.513913362Z [inf]  100.64.0.11:16280 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T06:08:11.513920663Z [err]  2025-12-29 06:08:11,479 - persistent_tts_service - INFO - üîá [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] FLOOR RELEASED (is_holding_floor=False)
2025-12-29T06:08:13.037426318Z [err]  2025-12-29 06:08:13,034 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-29T06:08:13.037432976Z [err]  2025-12-29 06:08:13,035 - persistent_tts_service - INFO - ‚úÖ [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] Receiver finished sentence #1: 5 chunks in 2843ms
2025-12-29T06:08:13.037438298Z [err]  2025-12-29 06:08:13,035 - persistent_tts_service - INFO - üéß [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] Receiver processing sentence #2: 'yeah it's me - is now a good t...'
2025-12-29T06:08:13.037443192Z [err]  2025-12-29 06:08:13,035 - persistent_tts_service - INFO - üìä [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] DIAGNOSTIC: queue_latency=2828ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-29T06:08:15.616813934Z [err]  2025-12-29 06:08:15,535 - elevenlabs_ws_service - WARNING - ‚ö†Ô∏è  [TIMING] ElevenLabs timeout waiting for first chunk (2.5s) - No audio received!
2025-12-29T06:08:15.616820391Z [err]  2025-12-29 06:08:15,535 - persistent_tts_service - WARNING - ‚ö†Ô∏è [Call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ] Receiver got 0 chunks for sentence #2! interrupted=False
2025-12-29T06:08:16.325901801Z [err]  2025-12-29 06:08:16,322 - server - INFO - üì§ Audio flowing: 641 packets sent to Soniox (5s update)
2025-12-29T06:08:16.684876793Z [err]  2025-12-29 06:08:16,682 - server - INFO - üé§ Soniox receiver alive - 13 messages received in last 10s
2025-12-29T06:08:18.683440132Z [err]  2025-12-29 06:08:18,681 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.2s silence (threshold: 7s)
2025-12-29T06:08:18.690170272Z [err]  2025-12-29 06:08:18,687 - core_calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-29T06:08:18.690183824Z [err]  2025-12-29 06:08:18,687 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.2s silence: Are you still there?
2025-12-29T06:08:18.690194299Z [err]  2025-12-29 06:08:18,687 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:18.690204144Z [err]  2025-12-29 06:08:18,688 - telnyx_service - INFO - üîä Speaking text on call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ: Are you still there?...
2025-12-29T06:08:18.690212421Z [err]  2025-12-29 06:08:18,688 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-29T06:08:18.690222460Z [err]  2025-12-29 06:08:18,688 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-29T06:08:18.690231016Z [err]  2025-12-29 06:08:18,688 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-29T06:08:18.690240331Z [err]  2025-12-29 06:08:18,688 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-29T06:08:18.690247931Z [err]  2025-12-29 06:08:18,688 - server - INFO - ‚è±Ô∏è [06:08:18.688] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-29T06:08:18.690257519Z [err]  2025-12-29 06:08:18,688 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-29T06:08:18.690266579Z [err]  2025-12-29 06:08:18,688 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-29T06:08:18.782930832Z [err]  2025-12-29 06:08:18,777 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T06:08:18.782936601Z [err]  2025-12-29 06:08:18,777 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-29T06:08:18.782943193Z [err]  2025-12-29 06:08:18,777 - server - INFO -    Text length: 20 chars
2025-12-29T06:08:18.782948888Z [err]  2025-12-29 06:08:18,777 - server - INFO -    Text content: 'Are you still there?'
2025-12-29T06:08:18.782954345Z [err]  2025-12-29 06:08:18,777 - server - INFO -    Text bytes: b'Are you still there?'
2025-12-29T06:08:18.782960710Z [err]  2025-12-29 06:08:18,777 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-29T06:08:18.782965645Z [err]  2025-12-29 06:08:18,777 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-29T06:08:18.782970882Z [err]  2025-12-29 06:08:18,777 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-29T06:08:18.782976094Z [err]  2025-12-29 06:08:18,777 - server - INFO -    Full data: {'text': 'Are you still there?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-29T06:08:18.782981491Z [err]  2025-12-29 06:08:18,777 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-29T06:08:18.782987502Z [err]  2025-12-29 06:08:18,777 - server - INFO -    Timeout: 10.0s
2025-12-29T06:08:18.789621937Z [err]  2025-12-29 06:08:18,788 - server - INFO -    ‚úì HTTP client created (0.011s)
2025-12-29T06:08:18.789627825Z [err]  2025-12-29 06:08:18,788 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-29T06:08:18.932131334Z [err]  2025-12-29 06:08:18,928 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 763 total packets
2025-12-29T06:08:18.932136738Z [err]  [2025-12-29 06:08:18 +0000] [4] [INFO] connection closed
2025-12-29T06:08:19.086803504Z [err]  2025-12-29 06:08:19,081 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T06:08:19.086814057Z [err]  2025-12-29 06:08:19,081 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '586f01f6-dde7-4937-82d7-bfbcaedc7bcd', 'occurred_at': '2025-12-29T06:08:18.715969Z', 'payload': {'call_control_id': 'v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ', 'call_leg_id': 'ba13de32-e47c-11f0-9d95-02420aef96a0', 'call_session_id': 'ba116a62-e47c-11f0-b0c4-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T06:08:18.715969Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'xLTk1Pn2vg', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T06:08:19.086819838Z [err]  2025-12-29 06:08:19,081 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:19.086826122Z [err]  2025-12-29 06:08:19,081 - server - INFO - üì® ================================================
2025-12-29T06:08:19.086831695Z [err]  2025-12-29 06:08:19,085 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T06:08:19.086836543Z [err]  2025-12-29 06:08:19,085 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': '4f72a716-2a4a-4fab-bb45-73c3bf3f5770', 'occurred_at': '2025-12-29T06:08:18.675966Z', 'payload': {'call_control_id': 'v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ', 'call_leg_id': 'ba13de32-e47c-11f0-9d95-02420aef96a0', 'call_quality_stats': {'inbound': {'jitter_max_variance': '26.28', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '793', 'skip_packet_count': '19'}, 'outbound': {'packet_count': '764', 'skip_packet_count': '0'}}, 'call_session_id': 'ba116a62-e47c-11f0-b0c4-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T06:08:18.675966Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-29T06:07:59.976152Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T06:08:19.088105328Z [err]  2025-12-29 06:08:19,085 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:19.088112861Z [err]  2025-12-29 06:08:19,086 - server - INFO - üì® ================================================
2025-12-29T06:08:19.088118095Z [err]  2025-12-29 06:08:19,086 - server - INFO - üìû Call ended: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:19.088123284Z [err]  2025-12-29 06:08:19,086 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-29T06:08:19.100006613Z [err]  2025-12-29 06:08:19,098 - redis_service - INFO - ‚ûñ Removed playback xLTk1Pn2vg, 0 remaining for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:19.100013676Z [err]  2025-12-29 06:08:19,098 - server - INFO - üîä Redis: Removed playback xLTk1Pn2vg, 0 remaining
2025-12-29T06:08:19.100019946Z [err]  2025-12-29 06:08:19,098 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T06:08:19.106125814Z [err]  2025-12-29 06:08:19,103 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T06:08:19.106132076Z [err]  2025-12-29 06:08:19,103 - server - INFO - üí° Session not on this worker - Redis flag set for WebSocket worker to handle
2025-12-29T06:08:19.106136807Z [inf]  100.64.0.8:33548 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T06:08:19.112664241Z [err]  2025-12-29 06:08:19,109 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T06:08:19.112669141Z [err]  2025-12-29 06:08:19,109 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': '883a4f0f-d9af-47a3-8553-3b339aafe408', 'occurred_at': '2025-12-29T06:08:18.857588Z', 'payload': {'call_control_id': 'v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ', 'call_leg_id': 'ba13de32-e47c-11f0-9d95-02420aef96a0', 'call_session_id': 'ba116a62-e47c-11f0-b0c4-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '0b7831a1-e0aa-4cca-9238-ca4b8ef8c49e', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T06:08:19.112674455Z [err]  2025-12-29 06:08:19,109 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:19.112681110Z [err]  2025-12-29 06:08:19,109 - server - INFO - üì® ================================================
2025-12-29T06:08:19.112686115Z [inf]  100.64.0.11:40312 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T06:08:19.202925559Z [err]  2025-12-29 06:08:19,200 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-29T06:08:19.202931177Z [err]  2025-12-29 06:08:19,200 - server - INFO -    ‚úì Connection established (0.423s) [TARGET: <200ms]
2025-12-29T06:08:19.202936893Z [err]  2025-12-29 06:08:19,200 - server - INFO -    ‚úì Response status: 200
2025-12-29T06:08:19.202941166Z [err]  2025-12-29 06:08:19,200 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-29T06:08:19.216599194Z [err]  2025-12-29 06:08:19,208 - server - INFO -    ‚úì FIRST CHUNK received (0.431s, 999 bytes) [TARGET: <300ms]
2025-12-29T06:08:19.216607294Z [err]  2025-12-29 06:08:19,211 - server - INFO -    ‚úì ALL CHUNKS received: 42 chunks (0.434s)
2025-12-29T06:08:19.216613215Z [err]  2025-12-29 06:08:19,211 - server - INFO -    ‚úì Total audio size: 17599 bytes
2025-12-29T06:08:19.216618954Z [err]  2025-12-29 06:08:19,212 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-29T06:08:19.216623852Z [err]  2025-12-29 06:08:19,212 - server - INFO -       - Connection: 423ms
2025-12-29T06:08:19.216629124Z [err]  2025-12-29 06:08:19,212 - server - INFO -       - First chunk: 431ms
2025-12-29T06:08:19.216633932Z [err]  2025-12-29 06:08:19,212 - server - INFO -       - All chunks: 434ms
2025-12-29T06:08:19.216639268Z [err]  2025-12-29 06:08:19,212 - server - INFO -       - Audio generation only: 8ms
2025-12-29T06:08:19.216644308Z [err]  2025-12-29 06:08:19,212 - server - INFO - ‚è±Ô∏è [06:08:19.212] üîä TTS COMPLETE: 523ms, audio_size=17599 bytes
2025-12-29T06:08:19.216649134Z [err]  2025-12-29 06:08:19,212 - server - INFO - üíæ TTS CACHED: elevenlabs:Are you still there?... (17599 bytes)
2025-12-29T06:08:19.216653837Z [err]  2025-12-29 06:08:19,212 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.52s
2025-12-29T06:08:19.216658307Z [err]  2025-12-29 06:08:19,212 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T06:08:19.216663037Z [err]  2025-12-29 06:08:19,212 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T06:08:19.274448744Z [err]  2025-12-29 06:08:19,273 - server - INFO - üìù Updated call log: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:19.582857593Z [err]  2025-12-29 06:08:19,367 - server - INFO - ‚úÖ Finalized call log: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ (duration=16s, status=completed)
2025-12-29T06:08:19.582863487Z [err]  2025-12-29 06:08:19,461 - server - INFO - üì¶ Saved 10 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email']
2025-12-29T06:08:19.582871790Z [err]  2025-12-29 06:08:19,503 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T06:08:19.582877676Z [err]  2025-12-29 06:08:19,504 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.29s
2025-12-29T06:08:19.582883700Z [err]  2025-12-29 06:08:19,504 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-29T06:08:19.582889721Z [err]    "errors": [
2025-12-29T06:08:19.582895905Z [err]      {
2025-12-29T06:08:19.582902415Z [err]        "code": "90018",
2025-12-29T06:08:19.582907479Z [err]        "title": "Call has already ended",
2025-12-29T06:08:19.582912600Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T06:08:19.582917710Z [err]      }
2025-12-29T06:08:19.582922850Z [err]    ]
2025-12-29T06:08:19.582928393Z [err]  }
2025-12-29T06:08:19.582933982Z [err]  2025-12-29 06:08:19,505 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-29T06:08:19.971752086Z [err]  2025-12-29 06:08:19,970 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T06:08:19.973070226Z [err]  2025-12-29 06:08:19,971 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T06:08:19.973080896Z [err]  2025-12-29 06:08:19,971 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-29T06:08:20.317522861Z [err]  2025-12-29 06:08:20,309 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T06:08:20.317539259Z [err]  2025-12-29 06:08:20,309 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '2c9a8ece-2996-4b5c-a24f-ac780a61f79f', 'occurred_at': '2025-12-29T06:08:20.183978Z', 'payload': {'call_control_id': 'v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ', 'call_leg_id': 'ba13de32-e47c-11f0-9d95-02420aef96a0', 'call_session_id': 'ba116a62-e47c-11f0-b0c4-02420aef96a0', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T06:08:18.776911Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-29T06:08:18.776911Z', 'recording_id': 'f12dd3e0-150a-40b9-811a-33fea3878354', 'recording_started_at': '2025-12-29T06:08:04.825752Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/ba13de32-e47c-11f0-9d95-02420aef96a0-1766988483920457.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T060820Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=7bf703224224f00a99e1a18366e15c037bc0e23d24ee2f927638cb2fd252235f'}, 'start_time': '2025-12-29T06:08:04.825752Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T06:08:20.317549191Z [err]  2025-12-29 06:08:20,309 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:20.317558131Z [err]  2025-12-29 06:08:20,309 - server - INFO - üì® ================================================
2025-12-29T06:08:20.317569384Z [err]  2025-12-29 06:08:20,309 - server - INFO - üéôÔ∏è Recording saved for call: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:20.317579419Z [err]  2025-12-29 06:08:20,315 - redis_service - INFO - üì• Retrieved call data from Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:20.318501815Z [err]  2025-12-29 06:08:20,315 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=f12dd3e0-150a-40b9-811a-33fea3878354, call_data=True
2025-12-29T06:08:20.578842905Z [err]  2025-12-29 06:08:20,411 - server - INFO - üíæ Saved recording URL and ID to database: f12dd3e0-150a-40b9-811a-33fea3878354
2025-12-29T06:08:20.578851775Z [err]  2025-12-29 06:08:20,411 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-29T06:08:20.578860309Z [err]  2025-12-29 06:08:20,411 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-29T06:08:20.578868500Z [err]  2025-12-29 06:08:20,478 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-29T06:08:20.578877762Z [err]  2025-12-29 06:08:20,479 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766988500.479093 for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:20.578885604Z [err]  2025-12-29 06:08:20,479 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:20.578895290Z [err]  2025-12-29 06:08:20,486 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=1/2
2025-12-29T06:08:20.596928793Z [err]  2025-12-29 06:08:20,595 - server - INFO - üìä Auto-added call v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-29T06:08:20.783018219Z [err]  2025-12-29 06:08:20,779 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T06:08:20.795376265Z [err]  2025-12-29 06:08:20,785 - redis_service - INFO - üì• Retrieved call data from Redis: v3:ruRl2vbN8WHfwKC_L49FJDaDN9V-AsigSq75jm7OLwnk1TbJLE6HdQ
2025-12-29T06:08:20.795406605Z [err]  2025-12-29 06:08:20,785 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-29T06:08:20.795415076Z [err]  2025-12-29 06:08:20,785 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-29T06:08:20.809235556Z [err]  2025-12-29 06:08:20,802 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/ba13de32-e47c-11f0-9d95-02420aef96a0-1766988483920457.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T060820Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=7bf703224224f00a99e1a18366e15c037bc0e23d24ee2f927638cb2fd252235f "HTTP/1.1 200 OK"