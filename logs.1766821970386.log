2025-12-27T07:18:56.000000000Z [inf]  Starting Container
2025-12-27T07:18:57.646466108Z [inf]  =========================================
2025-12-27T07:18:57.646676992Z [inf]  =========================================
2025-12-27T07:18:57.646683739Z [inf]  üìç Working directory: /app/backend
2025-12-27T07:18:57.646687960Z [inf]  =========================================
2025-12-27T07:18:57.646692102Z [inf]  üîç Python path: /app/backend
2025-12-27T07:18:57.646697279Z [inf]  üöÄ START.SH SCRIPT IS EXECUTING
2025-12-27T07:18:57.646700768Z [inf]  üåê Starting Gunicorn on 0.0.0.0:8080...
2025-12-27T07:18:57.846502626Z [err]  [2025-12-27 07:18:57 +0000] [1] [INFO] Starting gunicorn 22.0.0
2025-12-27T07:18:57.846508805Z [err]  [2025-12-27 07:18:57 +0000] [1] [INFO] Listening at: http://0.0.0.0:8080 (1)
2025-12-27T07:18:57.846515135Z [err]  [2025-12-27 07:18:57 +0000] [1] [INFO] Using worker: uvicorn.workers.UvicornWorker
2025-12-27T07:18:57.851702531Z [err]  [2025-12-27 07:18:57 +0000] [3] [INFO] Booting worker with pid: 3
2025-12-27T07:18:57.946843973Z [err]  [2025-12-27 07:18:57 +0000] [4] [INFO] Booting worker with pid: 4
2025-12-27T07:18:58.002740923Z [err]  [2025-12-27 07:18:57 +0000] [5] [INFO] Booting worker with pid: 5
2025-12-27T07:18:58.738657718Z [err]  [2025-12-27 07:18:58 +0000] [6] [INFO] Booting worker with pid: 6
2025-12-27T07:19:18.073798616Z [err]  2025-12-27 07:19:13,351 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-27T07:19:18.073804312Z [err]  2025-12-27 07:19:13,351 - server - INFO - üî• Pre-warming connection libraries...
2025-12-27T07:19:18.073808860Z [err]  2025-12-27 07:19:13,351 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-27T07:19:18.073815485Z [err]  2025-12-27 07:19:13,351 - server - INFO - üî• Pre-warming connection libraries...
2025-12-27T07:19:18.073820082Z [err]  2025-12-27 07:19:13,353 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-27T07:19:18.073824589Z [err]  2025-12-27 07:19:13,353 - server - INFO - üî• Pre-warming connection libraries...
2025-12-27T07:19:18.073828494Z [err]  2025-12-27 07:19:13,353 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-27T07:19:18.073832635Z [err]  2025-12-27 07:19:13,354 - server - INFO - üî• Pre-warming connection libraries...
2025-12-27T07:19:18.073836581Z [err]  2025-12-27 07:19:13,388 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-27T07:19:18.073841387Z [err]  2025-12-27 07:19:13,388 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-27T07:19:18.073845748Z [err]  2025-12-27 07:19:13,391 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-27T07:19:18.073850025Z [err]  2025-12-27 07:19:13,394 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-27T07:19:18.073854266Z [err]  2025-12-27 07:19:13,541 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-27T07:19:18.073858186Z [err]  2025-12-27 07:19:13,542 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-27T07:19:18.080829259Z [err]  2025-12-27 07:19:13,543 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-27T07:19:18.080835576Z [err]  2025-12-27 07:19:13,549 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-27T07:19:18.080844668Z [err]  2025-12-27 07:19:13,679 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-27T07:19:18.080850940Z [err]  2025-12-27 07:19:13,683 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-27T07:19:18.080857231Z [err]  2025-12-27 07:19:13,687 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-27T07:19:18.080862869Z [err]  2025-12-27 07:19:13,702 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-27T07:19:18.080868862Z [err]  2025-12-27 07:19:13,743 - server - INFO - ‚úÖ QC agent router loaded
2025-12-27T07:19:18.080874504Z [err]  2025-12-27 07:19:13,744 - server - INFO - ‚úÖ QC agent router loaded
2025-12-27T07:19:18.080881679Z [err]  2025-12-27 07:19:13,750 - server - INFO - ‚úÖ QC agent router loaded
2025-12-27T07:19:18.080888835Z [err]  2025-12-27 07:19:13,773 - server - INFO - ‚úÖ QC agent router loaded
2025-12-27T07:19:18.080895574Z [err]  2025-12-27 07:19:13,778 - server - INFO - ‚úÖ QC learning router loaded
2025-12-27T07:19:18.080904744Z [err]  2025-12-27 07:19:13,785 - server - INFO - ‚úÖ QC learning router loaded
2025-12-27T07:19:18.080911306Z [err]  2025-12-27 07:19:13,788 - server - INFO - ‚úÖ QC learning router loaded
2025-12-27T07:19:18.080917917Z [err]  2025-12-27 07:19:13,801 - server - INFO - ‚úÖ QC learning router loaded
2025-12-27T07:19:18.080926053Z [err]  2025-12-27 07:19:13,947 - server - INFO - ‚úÖ CRM router loaded
2025-12-27T07:19:18.080932752Z [err]  2025-12-27 07:19:13,951 - server - INFO - ‚úÖ CRM router loaded
2025-12-27T07:19:18.080940864Z [err]  2025-12-27 07:19:13,956 - server - INFO - ‚úÖ CRM router loaded
2025-12-27T07:19:18.080947877Z [err]  2025-12-27 07:19:13,964 - server - INFO - ‚úÖ CRM router loaded
2025-12-27T07:19:18.085911313Z [err]  2025-12-27 07:19:14,013 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-27T07:19:18.085931279Z [err]  2025-12-27 07:19:14,014 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-27T07:19:18.085942788Z [err]  2025-12-27 07:19:14,017 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-27T07:19:18.085953820Z [err]  2025-12-27 07:19:14,017 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-27T07:19:18.085964489Z [err]  [2025-12-27 07:19:14 +0000] [5] [INFO] Started server process [5]
2025-12-27T07:19:18.085991984Z [err]  [2025-12-27 07:19:14 +0000] [5] [INFO] Waiting for application startup.
2025-12-27T07:19:18.085992094Z [err]  2025-12-27 07:19:13,967 - server - INFO - ‚úÖ QC test router loaded
2025-12-27T07:19:18.086003391Z [err]  2025-12-27 07:19:13,968 - server - INFO - ‚úÖ QC test router loaded
2025-12-27T07:19:18.086012232Z [err]  2025-12-27 07:19:13,969 - server - INFO - ‚úÖ QC test router loaded
2025-12-27T07:19:18.086020313Z [err]  2025-12-27 07:19:13,970 - server - INFO - ‚úÖ QC test router loaded
2025-12-27T07:19:18.086027847Z [err]  2025-12-27 07:19:13,995 - server - INFO - ‚úÖ Agent test router loaded
2025-12-27T07:19:18.086036043Z [err]  2025-12-27 07:19:13,996 - server - INFO - ‚úÖ Agent test router loaded
2025-12-27T07:19:18.086043990Z [err]  2025-12-27 07:19:13,999 - server - INFO - ‚úÖ Agent test router loaded
2025-12-27T07:19:18.086052075Z [err]  2025-12-27 07:19:14,003 - server - INFO - ‚úÖ Agent test router loaded
2025-12-27T07:19:18.086060060Z [err]  2025-12-27 07:19:14,012 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-27T07:19:18.086066947Z [err]  2025-12-27 07:19:14,012 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-27T07:19:18.086074407Z [err]  2025-12-27 07:19:14,013 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-27T07:19:18.086082603Z [err]  2025-12-27 07:19:14,013 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-27T07:19:18.092995174Z [err]  [2025-12-27 07:19:14 +0000] [3] [INFO] Started server process [3]
2025-12-27T07:19:18.093001004Z [err]  [2025-12-27 07:19:14 +0000] [3] [INFO] Waiting for application startup.
2025-12-27T07:19:18.093008964Z [err]  [2025-12-27 07:19:14 +0000] [6] [INFO] Started server process [6]
2025-12-27T07:19:18.093015655Z [err]  [2025-12-27 07:19:14 +0000] [6] [INFO] Waiting for application startup.
2025-12-27T07:19:18.093023411Z [err]  [2025-12-27 07:19:14 +0000] [4] [INFO] Started server process [4]
2025-12-27T07:19:18.093033008Z [err]  [2025-12-27 07:19:14 +0000] [4] [INFO] Waiting for application startup.
2025-12-27T07:19:18.093039162Z [err]  2025-12-27 07:19:14,051 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-27T07:19:18.093109779Z [err]  2025-12-27 07:19:14,051 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-27T07:19:18.093116714Z [err]  2025-12-27 07:19:14,053 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-27T07:19:18.093122642Z [err]  2025-12-27 07:19:14,053 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-27T07:19:23.023515935Z [err]  2025-12-27 07:19:23,013 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-27T07:19:23.023525768Z [err]  2025-12-27 07:19:23,013 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-27T07:19:23.026840071Z [err]  2025-12-27 07:19:23,024 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-27T07:19:23.026848906Z [err]  2025-12-27 07:19:23,024 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-27T07:19:23.026856212Z [err]  2025-12-27 07:19:23,024 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-27T07:19:23.053621111Z [err]  2025-12-27 07:19:23,036 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-27T07:19:23.053627934Z [err]  2025-12-27 07:19:23,036 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-27T07:19:23.053634087Z [err]  2025-12-27 07:19:23,036 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-27T07:19:23.568509702Z [err]  2025-12-27 07:19:23,341 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-27T07:19:23.568514221Z [err]  2025-12-27 07:19:23,351 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-27T07:19:23.568518758Z [err]  2025-12-27 07:19:23,351 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-27T07:19:23.568522845Z [err]  2025-12-27 07:19:23,351 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-27T07:19:23.838607265Z [err]  2025-12-27 07:19:23,834 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-27T07:19:23.946960649Z [err]  2025-12-27 07:19:23,942 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-27T07:19:23.949810463Z [err]  2025-12-27 07:19:23,944 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-27T07:19:23.949816953Z [err]  2025-12-27 07:19:23,945 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-27T07:19:23.949823295Z [err]  2025-12-27 07:19:23,945 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-27T07:19:23.949828979Z [err]  [2025-12-27 07:19:23 +0000] [3] [INFO] Application startup complete.
2025-12-27T07:19:23.956013098Z [err]  2025-12-27 07:19:23,953 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-27T07:19:23.956021571Z [err]  2025-12-27 07:19:23,953 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-27T07:19:23.956033340Z [err]  2025-12-27 07:19:23,953 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-27T07:19:24.082499659Z [err]  2025-12-27 07:19:24,077 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-27T07:19:24.082507912Z [err]  2025-12-27 07:19:24,079 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-27T07:19:24.082516236Z [err]  [2025-12-27 07:19:24 +0000] [6] [INFO] Application startup complete.
2025-12-27T07:19:24.724448264Z [err]  2025-12-27 07:19:24,181 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-27T07:19:24.724454083Z [err]  2025-12-27 07:19:24,284 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-27T07:19:24.724458720Z [err]  2025-12-27 07:19:24,285 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-27T07:19:24.724463457Z [err]  [2025-12-27 07:19:24 +0000] [5] [INFO] Application startup complete.
2025-12-27T07:19:24.724471257Z [err]  2025-12-27 07:19:24,676 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-27T07:19:24.785837621Z [err]  2025-12-27 07:19:24,777 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-27T07:19:24.785843748Z [err]  2025-12-27 07:19:24,778 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-27T07:19:24.785850082Z [err]  [2025-12-27 07:19:24 +0000] [4] [INFO] Application startup complete.
2025-12-27T07:51:52.115545909Z [inf]  100.64.0.2:30280 - "POST /api/auth/logout HTTP/1.1" 401
2025-12-27T07:51:52.115560944Z [inf]  100.64.0.3:15854 - "OPTIONS /api/auth/login HTTP/1.1" 200
2025-12-27T07:51:53.930735375Z [inf]  100.64.0.4:47168 - "POST /api/auth/login HTTP/1.1" 200
2025-12-27T07:51:54.968822796Z [inf]  100.64.0.4:47168 - "GET /api/agents HTTP/1.1" 200
2025-12-27T07:51:59.951764128Z [inf]  100.64.0.5:43308 - "GET /api/agents HTTP/1.1" 200
2025-12-27T07:52:19.948303718Z [inf]  100.64.0.2:30280 - "OPTIONS /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-27T07:52:19.948311852Z [err]  2025-12-27 07:52:15,149 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-27T07:52:19.948325968Z [err]  2025-12-27 07:52:15,236 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T07:52:19.948333160Z [err]  2025-12-27 07:52:15,320 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T07:52:19.948340099Z [err]  2025-12-27 07:52:15,345 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-27T07:52:19.948346389Z [err]  2025-12-27 07:52:15,345 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-27T07:52:19.948354338Z [err]  2025-12-27 07:52:15,345 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-27T07:52:19.948360637Z [err]  2025-12-27 07:52:15,345 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-27T07:52:19.948366004Z [err]  2025-12-27 07:52:15,929 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-27T07:52:19.948372089Z [err]  2025-12-27 07:52:15,932 - telnyx_service - INFO - ‚úÖ Call initiated: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:19.948379336Z [err]  2025-12-27 07:52:16,032 - server - INFO - üìù Created call log: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:19.948386138Z [err]  2025-12-27 07:52:16,032 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-27T07:52:19.948393342Z [err]  2025-12-27 07:52:16,032 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-27T07:52:19.950069366Z [err]  2025-12-27 07:52:16,032 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-27T07:52:19.950076935Z [err]  2025-12-27 07:52:16,032 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-27T07:52:19.950083193Z [err]  2025-12-27 07:52:16,039 - redis_service - INFO - üì¶ Stored call data in Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA (TTL: 3600s)
2025-12-27T07:52:19.950089218Z [err]  2025-12-27 07:52:16,039 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-27T07:52:19.950095261Z [err]  2025-12-27 07:52:16,039 - server - INFO - üìû Outbound call initiated: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:19.950102539Z [inf]  100.64.0.2:30280 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-27T07:52:19.950108848Z [err]  2025-12-27 07:52:16,267 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-27T07:52:19.950114950Z [err]  2025-12-27 07:52:16,267 - server - INFO -    Client: Address(host='100.64.0.6', port=32416)
2025-12-27T07:52:19.950121366Z [err]  2025-12-27 07:52:16,267 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'e1rHvp5TlzPRIT4rSRFxww==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': '-LlF--8YSNGxZspQn6XIxQ', 'x-real-ip': '192.76.120.151', 'x-request-start': '1766821936042', 'accept-encoding': 'gzip'}
2025-12-27T07:52:19.950127790Z [err]  2025-12-27 07:52:16,267 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-27T07:52:19.950134432Z [err]  2025-12-27 07:52:16,267 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-27T07:52:19.952624191Z [err]  [2025-12-27 07:52:16 +0000] [5] [INFO] ('100.64.0.6', 32416) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-27T07:52:19.952636107Z [err]  2025-12-27 07:52:16,267 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-27T07:52:19.952643099Z [err]  [2025-12-27 07:52:16 +0000] [5] [INFO] connection open
2025-12-27T07:52:19.952649625Z [err]  2025-12-27 07:52:16,298 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T07:52:19.952656667Z [err]  2025-12-27 07:52:16,298 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': 'ebb6707c-79b8-4902-9ce3-47a153d32857', 'occurred_at': '2025-12-27T07:52:15.824000Z', 'payload': {'call_control_id': 'v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA', 'call_leg_id': 'f620e0c6-e2f8-11f0-ae80-02420aef991f', 'call_session_id': 'f61df910-e2f8-11f0-8a96-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T07:52:19.952663131Z [err]  2025-12-27 07:52:16,298 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:19.952670332Z [err]  2025-12-27 07:52:16,299 - server - INFO - üì® ================================================
2025-12-27T07:52:19.952676477Z [err]  2025-12-27 07:52:16,299 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-27T07:52:19.952682499Z [inf]  100.64.0.6:32428 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T07:52:19.952690223Z [err]  2025-12-27 07:52:16,423 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-27T07:52:19.952697112Z [err]  2025-12-27 07:52:16,423 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-27T07:52:19.954517021Z [err]  2025-12-27 07:52:16,478 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-27T07:52:19.954527748Z [err]  2025-12-27 07:52:16,479 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-27T07:52:22.082763291Z [err]  2025-12-27 07:52:21,864 - redis_service - INFO - üì• Retrieved call data from Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:22.082771956Z [err]  2025-12-27 07:52:21,865 - server - INFO - üìù Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-27T07:52:22.082778914Z [err]  2025-12-27 07:52:21,865 - calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-27T07:52:22.082788189Z [err]  2025-12-27 07:52:21,933 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T07:52:22.082797220Z [err]  2025-12-27 07:52:21,933 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': 'a6018c01-fd6e-4ab5-887e-4c452a2f1a08', 'occurred_at': '2025-12-27T07:52:21.503983Z', 'payload': {'call_control_id': 'v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA', 'call_leg_id': 'f620e0c6-e2f8-11f0-ae80-02420aef991f', 'call_session_id': 'f61df910-e2f8-11f0-8a96-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '07c2fd5e-6378-4738-995c-f06a9489a152', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T07:52:22.082909968Z [err]  2025-12-27 07:52:21,351 - server - INFO - üì¨ Received Telnyx event: start
2025-12-27T07:52:22.082917440Z [err]  2025-12-27 07:52:21,351 - server - INFO - üé¨ Stream started for call: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:22.082924292Z [err]  2025-12-27 07:52:21,356 - redis_service - INFO - üì• Retrieved call data from Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:22.082934399Z [err]  2025-12-27 07:52:21,358 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-27T07:52:22.082944234Z [err]  2025-12-27 07:52:21,358 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-27T07:52:22.082950824Z [err]  2025-12-27 07:52:21,504 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T07:52:22.082963060Z [err]  2025-12-27 07:52:21,504 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': 'a360cf9d-ee33-40eb-ac49-f0f54bc73bbe', 'occurred_at': '2025-12-27T07:52:21.223967Z', 'payload': {'call_control_id': 'v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA', 'call_leg_id': 'f620e0c6-e2f8-11f0-ae80-02420aef991f', 'call_session_id': 'f61df910-e2f8-11f0-8a96-02420aef991f', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-27T07:52:15.824000Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T07:52:22.082971345Z [err]  2025-12-27 07:52:21,504 - server - INFO - üéØ Event type: call.answered, Call ID: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:22.082978284Z [err]  2025-12-27 07:52:21,504 - server - INFO - üì® ================================================
2025-12-27T07:52:22.082986879Z [err]  2025-12-27 07:52:21,504 - server - INFO - ‚úÖ Call answered: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:22.083132012Z [err]  2025-12-27 07:52:21,509 - redis_service - INFO - üì• Retrieved call data from Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:22.083141825Z [err]  2025-12-27 07:52:21,511 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-27T07:52:22.083150175Z [err]  2025-12-27 07:52:21,511 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-27T07:52:22.083159200Z [err]  2025-12-27 07:52:21,858 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-27T07:52:22.083173783Z [err]  2025-12-27 07:52:21,859 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-27T07:52:22.087013347Z [err]  2025-12-27 07:52:21,933 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:22.087021626Z [err]  2025-12-27 07:52:21,933 - server - INFO - üì® ================================================
2025-12-27T07:52:22.087029671Z [inf]  100.64.0.7:10112 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T07:52:22.087036813Z [err]  2025-12-27 07:52:21,964 - calling_service - INFO - üîç KB count query completed: 4 items
2025-12-27T07:52:22.087043830Z [err]  2025-12-27 07:52:21,964 - calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-27T07:52:22.087050957Z [err]  2025-12-27 07:52:21,979 - calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-27T07:52:22.087057882Z [err]  2025-12-27 07:52:21,979 - calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-27T07:52:22.087064033Z [err]  2025-12-27 07:52:21,981 - calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-27T07:52:22.087069558Z [err]  2025-12-27 07:52:22,064 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T07:52:22.087075410Z [err]  2025-12-27 07:52:22,075 - calling_service - INFO - ‚úÖ LLM client pre-warmed in 93ms
2025-12-27T07:52:22.087082230Z [err]  2025-12-27 07:52:22,075 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-27T07:52:22.087089181Z [err]  2025-12-27 07:52:22,075 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-27T07:52:22.087095623Z [err]  2025-12-27 07:52:22,075 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-27T07:52:22.087101133Z [err]  2025-12-27 07:52:22,075 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-27T07:52:22.088964460Z [err]  2025-12-27 07:52:22,077 - server - INFO - ‚úÖ Initialized call_states for v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA with session reference
2025-12-27T07:52:22.088974822Z [err]  2025-12-27 07:52:22,077 - server - INFO - ‚úÖ Stored Telnyx WebSocket in call_data for audio streaming
2025-12-27T07:52:22.088981625Z [err]  2025-12-27 07:52:22,078 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found to update for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:22.088988539Z [err]  2025-12-27 07:52:22,080 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-27T07:52:22.169987506Z [err]  2025-12-27 07:52:22,167 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-27T07:52:23.121071277Z [err]  2025-12-27 07:52:22,440 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-27T07:52:23.121078969Z [err]  2025-12-27 07:52:22,440 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-27T07:52:23.121086118Z [err]  2025-12-27 07:52:22,536 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T07:52:23.121091537Z [err]  2025-12-27 07:52:22,629 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-27T07:52:23.121096261Z [err]  2025-12-27 07:52:22,628 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T07:52:23.121102234Z [err]  2025-12-27 07:52:22,662 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-27T07:52:23.121109355Z [err]  2025-12-27 07:52:22,671 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-27T07:52:23.121116106Z [err]  2025-12-27 07:52:22,672 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-27T07:52:23.121123008Z [err]  2025-12-27 07:52:22,672 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-27T07:52:23.121130286Z [err]  2025-12-27 07:52:22,700 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-27T07:52:23.121138274Z [err]  2025-12-27 07:52:22,700 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:23.121183389Z [err]  2025-12-27 07:52:22,440 - server - INFO - ‚úÖ Call log updated
2025-12-27T07:52:23.121190073Z [err]  2025-12-27 07:52:22,440 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-27T07:52:23.126613438Z [err]  2025-12-27 07:52:22,702 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:qLsOBlYP56huORwio... (active sessions: [])
2025-12-27T07:52:23.126627905Z [err]  2025-12-27 07:52:22,702 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-27T07:52:23.126634039Z [err]  2025-12-27 07:52:22,826 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-27T07:52:23.126639738Z [err]  2025-12-27 07:52:22,827 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-27T07:52:23.126645770Z [err]  2025-12-27 07:52:22,956 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-27T07:52:23.126651785Z [err]  2025-12-27 07:52:22,956 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: g5QECFxRZA (loop=True, overlay=True)
2025-12-27T07:52:23.126660570Z [err]  2025-12-27 07:52:22,956 - server - WARNING - ‚ö†Ô∏è Failed to start comfort noise: 'v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA'
2025-12-27T07:52:23.126670701Z [err]  2025-12-27 07:52:22,957 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:23.206591872Z [err]  2025-12-27 07:52:23,204 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:qLsOBlYP56huORwio... (active sessions: [])
2025-12-27T07:52:23.346054910Z [err]  2025-12-27 07:52:23,342 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA/actions/record_start "HTTP/1.1 200 OK"
2025-12-27T07:52:23.346062808Z [err]  2025-12-27 07:52:23,344 - server - INFO - üéôÔ∏è Call recording started for v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:23.901705623Z [err]  2025-12-27 07:52:23,381 - server - INFO - üì® ================================================
2025-12-27T07:52:23.901717358Z [err]  2025-12-27 07:52:23,437 - calling_service - INFO - üîç KB count query completed: 4 items
2025-12-27T07:52:23.901742356Z [err]  2025-12-27 07:52:23,381 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:23.901742394Z [err]  2025-12-27 07:52:23,345 - calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-27T07:52:23.901750513Z [inf]  100.64.0.8:36228 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T07:52:23.901754172Z [err]  2025-12-27 07:52:23,381 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T07:52:23.901761535Z [err]  2025-12-27 07:52:23,381 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '2065b941-28fc-42db-b3c6-e61c6215ba65', 'occurred_at': '2025-12-27T07:52:22.943969Z', 'payload': {'call_control_id': 'v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA', 'call_leg_id': 'f620e0c6-e2f8-11f0-ae80-02420aef991f', 'call_session_id': 'f61df910-e2f8-11f0-8a96-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'g5QECFxRZA', 'start_time': '2025-12-27T07:52:22.943969Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T07:52:23.901774146Z [err]  2025-12-27 07:52:23,344 - server - INFO - üîß Creating call session for v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA...
2025-12-27T07:52:23.901779780Z [err]  2025-12-27 07:52:23,344 - server - INFO - üîç Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-27T07:52:23.901785118Z [err]  2025-12-27 07:52:23,345 - server - INFO - üîß Calling create_call_session() - START
2025-12-27T07:52:23.905397386Z [err]  2025-12-27 07:52:23,437 - calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-27T07:52:23.905402567Z [err]  2025-12-27 07:52:23,450 - calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-27T07:52:23.905407657Z [err]  2025-12-27 07:52:23,450 - calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-27T07:52:23.905411634Z [err]  2025-12-27 07:52:23,450 - calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-27T07:52:23.905415975Z [err]  2025-12-27 07:52:23,542 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T07:52:23.905420764Z [err]  2025-12-27 07:52:23,551 - calling_service - INFO - ‚úÖ LLM client pre-warmed in 100ms
2025-12-27T07:52:23.905425499Z [err]  2025-12-27 07:52:23,551 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-27T07:52:23.905429570Z [err]  2025-12-27 07:52:23,551 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-27T07:52:23.905437254Z [err]  2025-12-27 07:52:23,557 - redis_service - INFO - üì¶ Stored call data in Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA (TTL: 3600s)
2025-12-27T07:52:23.905441207Z [err]  2025-12-27 07:52:23,557 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-27T07:52:23.905445734Z [err]  2025-12-27 07:52:23,557 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-27T07:52:23.905449623Z [err]  2025-12-27 07:52:23,558 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:23.905456456Z [err]  2025-12-27 07:52:23,558 - server - INFO - ü§ñ AI session created for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:23.906570863Z [err]  2025-12-27 07:52:23,558 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-27T07:52:23.906580221Z [err]  2025-12-27 07:52:23,558 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-27T07:52:23.906586297Z [err]  2025-12-27 07:52:23,558 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-27T07:52:23.906591526Z [err]  2025-12-27 07:52:23,558 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-27T07:52:23.906599230Z [err]  2025-12-27 07:52:23,558 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-27T07:52:23.906605316Z [err]  2025-12-27 07:52:23,558 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-27T07:52:23.906610766Z [err]  2025-12-27 07:52:23,558 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-27T07:52:23.906617119Z [err]  2025-12-27 07:52:23,562 - redis_service - INFO - üì• Retrieved call data from Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:23.906622024Z [err]  2025-12-27 07:52:23,564 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-27T07:52:23.906627665Z [err]  2025-12-27 07:52:23,564 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-27T07:52:23.906634397Z [inf]  100.64.0.6:14068 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T07:52:23.906639104Z [err]  2025-12-27 07:52:23,706 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:qLsOBlYP56huORwio... (active sessions: [])
2025-12-27T07:52:24.088174128Z [err]  2025-12-27 07:52:24,085 - redis_service - INFO - üì• Retrieved call data from Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:24.091865501Z [err]  2025-12-27 07:52:24,089 - redis_service - INFO - üì• Retrieved call data from Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:24.099729338Z [err]  2025-12-27 07:52:24,097 - redis_service - INFO - üì¶ Stored call data in Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA (TTL: 3600s)
2025-12-27T07:52:24.099735715Z [err]  2025-12-27 07:52:24,097 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-27T07:52:24.099745828Z [err]  2025-12-27 07:52:24,097 - calling_service - INFO - ‚è±Ô∏è [07:52:24.097] üì• process_user_input() ENTRY - text: '...'
2025-12-27T07:52:24.107387016Z [err]  2025-12-27 07:52:24,101 - redis_service - INFO - üì• Retrieved call data from Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:24.107397194Z [err]  2025-12-27 07:52:24,103 - calling_service - INFO - ‚è±Ô∏è [07:52:24.103] ‚è© About to call _process_call_flow_streaming()
2025-12-27T07:52:24.107402187Z [err]  2025-12-27 07:52:24,103 - calling_service - INFO - ‚è±Ô∏è [07:52:24.103] üîÄ Agent type: call_flow, calling flow processor...
2025-12-27T07:52:24.107407292Z [err]  2025-12-27 07:52:24,103 - calling_service - INFO - ‚è±Ô∏è [07:52:24.103] üîÄ _process_call_flow_streaming() ENTRY
2025-12-27T07:52:24.107413140Z [err]  2025-12-27 07:52:24,103 - calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-27T07:52:24.107418633Z [err]  2025-12-27 07:52:24,103 - calling_service - INFO - ‚è±Ô∏è [07:52:24.103] ‚úÖ Node selected, about to process content...
2025-12-27T07:52:24.107424674Z [err]  2025-12-27 07:52:24,103 - calling_service - INFO - üîß Replaced {{now}} with Saturday, December 27, 2025 at 2:52 AM EST in content
2025-12-27T07:52:24.107428656Z [err]  2025-12-27 07:52:24,103 - calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-27T07:52:24.107433521Z [err]  2025-12-27 07:52:24,103 - calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-27T07:52:24.107439491Z [err]  2025-12-27 07:52:24,103 - calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-27T07:52:24.107443820Z [err]  2025-12-27 07:52:24,103 - calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-27T07:52:24.107447947Z [err]  2025-12-27 07:52:24,103 - calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-27T07:52:24.107453953Z [err]  2025-12-27 07:52:24,103 - calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-27T07:52:24.112601972Z [err]  2025-12-27 07:52:24,103 - calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-27T07:52:24.112609083Z [err]  2025-12-27 07:52:24,103 - calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-27T07:52:24.112615505Z [err]  2025-12-27 07:52:24,104 - calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-27T07:52:24.112624080Z [err]  2025-12-27 07:52:24,104 - calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-27T07:52:24.112630465Z [err]  2025-12-27 07:52:24,104 - calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-27T07:52:24.112636376Z [err]  2025-12-27 07:52:24,104 - calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-27T07:52:24.112643206Z [err]  2025-12-27 07:52:24,104 - calling_service - INFO - ‚è±Ô∏è [07:52:24.104] üìÑ About to process content (mode=script, length=9)
2025-12-27T07:52:24.112650253Z [err]  2025-12-27 07:52:24,104 - calling_service - INFO - üîä Silence tracking reset for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA (user responded)
2025-12-27T07:52:24.112657083Z [err]  2025-12-27 07:52:24,104 - calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-27T07:52:24.112663485Z [err]  2025-12-27 07:52:24,104 - calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-27T07:52:24.112669575Z [err]  2025-12-27 07:52:24,104 - calling_service - INFO - LLM response (0.01s): Kendrick?
2025-12-27T07:52:24.112675386Z [err]  2025-12-27 07:52:24,104 - calling_service - INFO - Total latency: 0.01s
2025-12-27T07:52:24.112680389Z [err]  2025-12-27 07:52:24,104 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-27T07:52:24.203209515Z [err]  2025-12-27 07:52:24,197 - redis_service - INFO - üì• Retrieved call data from Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:24.203218648Z [err]  2025-12-27 07:52:24,199 - telnyx_service - INFO - üîä Speaking text on call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA: Kendrick?...
2025-12-27T07:52:24.203225414Z [err]  2025-12-27 07:52:24,199 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-27T07:52:24.203231198Z [err]  2025-12-27 07:52:24,199 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-27T07:52:24.203239016Z [err]  2025-12-27 07:52:24,199 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-27T07:52:24.203245320Z [err]  2025-12-27 07:52:24,199 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-27T07:52:24.203251861Z [err]  2025-12-27 07:52:24,199 - server - INFO - ‚è±Ô∏è [07:52:24.199] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-27T07:52:24.203257944Z [err]  2025-12-27 07:52:24,199 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-27T07:52:24.203265385Z [err]  2025-12-27 07:52:24,199 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-27T07:52:24.210674700Z [err]  2025-12-27 07:52:24,208 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:qLsOBlYP56huORwio... (active sessions: [])
2025-12-27T07:52:24.287516509Z [err]  2025-12-27 07:52:24,282 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T07:52:24.287529753Z [err]  2025-12-27 07:52:24,282 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-27T07:52:24.287537277Z [err]  2025-12-27 07:52:24,282 - server - INFO -    Text length: 9 chars
2025-12-27T07:52:24.287545559Z [err]  2025-12-27 07:52:24,282 - server - INFO -    Text content: 'Kendrick?'
2025-12-27T07:52:24.287556950Z [err]  2025-12-27 07:52:24,282 - server - INFO -    Text bytes: b'Kendrick?'
2025-12-27T07:52:24.287565460Z [err]  2025-12-27 07:52:24,282 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-27T07:52:24.287577065Z [err]  2025-12-27 07:52:24,282 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-27T07:52:24.287584677Z [err]  2025-12-27 07:52:24,283 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-27T07:52:24.287592330Z [err]  2025-12-27 07:52:24,283 - server - INFO -    Full data: {'text': 'Kendrick?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-27T07:52:24.287599531Z [err]  2025-12-27 07:52:24,283 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-27T07:52:24.287606418Z [err]  2025-12-27 07:52:24,283 - server - INFO -    Timeout: 10.0s
2025-12-27T07:52:24.299649723Z [err]  2025-12-27 07:52:24,291 - server - INFO -    ‚úì HTTP client created (0.008s)
2025-12-27T07:52:24.299661817Z [err]  2025-12-27 07:52:24,291 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-27T07:52:24.831052479Z [err]  2025-12-27 07:52:24,611 - calling_service - INFO - üë§ User started speaking for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:24.831066131Z [err]  2025-12-27 07:52:24,611 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-27T07:52:24.831072757Z [err]  2025-12-27 07:52:24,611 - server - INFO - üîç PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-27T07:52:24.831078349Z [err]  2025-12-27 07:52:24,635 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-27T07:52:24.831084292Z [err]  2025-12-27 07:52:24,635 - server - INFO -    ‚úì Connection established (0.353s) [TARGET: <200ms]
2025-12-27T07:52:24.831094400Z [err]  2025-12-27 07:52:24,635 - server - INFO -    ‚úì Response status: 200
2025-12-27T07:52:24.831103665Z [err]  2025-12-27 07:52:24,635 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-27T07:52:24.831109833Z [err]  2025-12-27 07:52:24,644 - server - INFO -    ‚úì FIRST CHUNK received (0.361s, 1062 bytes) [TARGET: <300ms]
2025-12-27T07:52:24.831115543Z [err]  2025-12-27 07:52:24,647 - server - INFO -    ‚úì ALL CHUNKS received: 74 chunks (0.364s)
2025-12-27T07:52:24.831121677Z [err]  2025-12-27 07:52:24,607 - server - INFO - üî§ RAW TOKENS: ["H"?]
2025-12-27T07:52:24.831124645Z [err]  2025-12-27 07:52:24,647 - server - INFO -    ‚úì Total audio size: 12583 bytes
2025-12-27T07:52:24.831130368Z [err]  2025-12-27 07:52:24,611 - calling_service - INFO - üîä Silence timer reset for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA (user started speaking)
2025-12-27T07:52:24.831132843Z [err]  2025-12-27 07:52:24,647 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-27T07:52:24.831140308Z [err]  2025-12-27 07:52:24,647 - server - INFO -       - Connection: 353ms
2025-12-27T07:52:24.957167906Z [err]  2025-12-27 07:52:24,647 - server - INFO -       - First chunk: 361ms
2025-12-27T07:52:24.957174082Z [err]  2025-12-27 07:52:24,647 - server - INFO -       - All chunks: 364ms
2025-12-27T07:52:24.957180632Z [err]  2025-12-27 07:52:24,647 - server - INFO -       - Audio generation only: 9ms
2025-12-27T07:52:24.957186988Z [err]  2025-12-27 07:52:24,647 - server - INFO - ‚è±Ô∏è [07:52:24.647] üîä TTS COMPLETE: 448ms, audio_size=12583 bytes
2025-12-27T07:52:24.957194557Z [err]  2025-12-27 07:52:24,647 - server - INFO - üíæ TTS CACHED: elevenlabs:Kendrick?... (12583 bytes)
2025-12-27T07:52:24.957205271Z [err]  2025-12-27 07:52:24,647 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.45s
2025-12-27T07:52:24.957210657Z [err]  2025-12-27 07:52:24,648 - telnyx_service - INFO - ‚úÖ Generated 12583 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-27T07:52:24.957215690Z [err]  2025-12-27 07:52:24,648 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-27T07:52:24.957221699Z [err]  2025-12-27 07:52:24,710 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:qLsOBlYP56huORwio... (active sessions: [])
2025-12-27T07:52:24.957226783Z [err]  2025-12-27 07:52:24,737 - server - INFO - üî§ RAW TOKENS: ["H"?, "ello"?]
2025-12-27T07:52:24.957231802Z [err]  2025-12-27 07:52:24,738 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Hello' | Generating: False
2025-12-27T07:52:24.959875062Z [err]  2025-12-27 07:52:24,889 - calling_service - INFO - üë§ User stopped speaking for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:24.959928101Z [err]  2025-12-27 07:52:24,889 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-27T07:52:24.959931255Z [err]  2025-12-27 07:52:24,889 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-27T07:52:24.959939677Z [err]  2025-12-27 07:52:24,889 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+9ms
2025-12-27T07:52:24.959945894Z [err]  2025-12-27 07:52:24,889 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 9ms (Soniox model: stt-rt-v3)
2025-12-27T07:52:24.959953006Z [err]  2025-12-27 07:52:24,889 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-27T07:52:24.959959988Z [err]  2025-12-27 07:52:24,889 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-27T07:52:24.959966500Z [err]  2025-12-27 07:52:24,889 - calling_service - INFO - ü§ñ Agent started speaking for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:24.960022122Z [err]  2025-12-27 07:52:24,875 - server - INFO - üî§ RAW TOKENS: ["H"‚úì, "ello"‚úì, "?"‚úì, "<end>"‚úì]
2025-12-27T07:52:24.960026428Z [err]  2025-12-27 07:52:24,876 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-27T07:52:24.960032505Z [err]  2025-12-27 07:52:24,876 - server - INFO - üßπ Cleaned transcript: 'H ello ?' -> 'Hello?'
2025-12-27T07:52:24.960038200Z [err]  2025-12-27 07:52:24,876 - server - INFO - üì• FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-27T07:52:24.960043586Z [err]  2025-12-27 07:52:24,876 - server - INFO - üé§ Soniox final transcript: 'Hello?'
2025-12-27T07:52:24.960132528Z [err]  2025-12-27 07:52:24,876 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:qLsOBlYP56huORwio... (active sessions: [])
2025-12-27T07:52:24.960136427Z [err]  2025-12-27 07:52:24,876 - server - INFO - üîç FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-27T07:52:24.960177869Z [err]  2025-12-27 07:52:24,877 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:qLsOBlYP56huORwio... (active sessions: [])
2025-12-27T07:52:24.960183691Z [err]  2025-12-27 07:52:24,877 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-27T07:52:24.960188023Z [err]  2025-12-27 07:52:24,877 - server - INFO - ‚è±Ô∏è [07:52:24.877] üìù FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-27T07:52:24.960192568Z [err]  2025-12-27 07:52:24,877 - server - INFO - ‚è±Ô∏è [07:52:24.877] STT endpoint detection latency: 16ms
2025-12-27T07:52:24.960197194Z [err]  2025-12-27 07:52:24,877 - server - INFO - ‚è±Ô∏è [07:52:24.877] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-27T07:52:24.960203457Z [err]  2025-12-27 07:52:24,878 - redis_service - INFO - üì¶ Stored call data in Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA (TTL: 3600s)
2025-12-27T07:52:24.960209542Z [err]  2025-12-27 07:52:24,878 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-27T07:52:24.960214357Z [err]  2025-12-27 07:52:24,933 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-27T07:52:24.960214462Z [err]  2025-12-27 07:52:24,878 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:qLsOBlYP56huORwio... (active sessions: [])
2025-12-27T07:52:24.960219508Z [err]  2025-12-27 07:52:24,878 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-27T07:52:24.960229513Z [err]  2025-12-27 07:52:24,932 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-27T07:52:24.960237852Z [err]  2025-12-27 07:52:24,932 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.28s
2025-12-27T07:52:24.960244683Z [err]  2025-12-27 07:52:24,933 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 0.73s
2025-12-27T07:52:24.960283610Z [err]  2025-12-27 07:52:24,933 - telnyx_service - INFO - üé¨ Playback ID: BlyhCqOvUw
2025-12-27T07:52:24.960291155Z [err]  2025-12-27 07:52:24,933 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-27T07:52:24.960297535Z [err]  2025-12-27 07:52:24,933 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-27T07:52:24.981884551Z [err]  2025-12-27 07:52:24,978 - server - INFO - üìù Saved user transcript to database
2025-12-27T07:52:24.981893952Z [err]  2025-12-27 07:52:24,978 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:qLsOBlYP56huORwio... (active sessions: [])
2025-12-27T07:52:24.981901063Z [err]  2025-12-27 07:52:24,979 - calling_service - INFO - ‚è±Ô∏è [07:52:24.978] üì• process_user_input() ENTRY - text: 'Hello?...'
2025-12-27T07:52:24.981906949Z [err]  2025-12-27 07:52:24,979 - redis_service - INFO - üì• Retrieved call data from Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:24.981913751Z [err]  2025-12-27 07:52:24,980 - calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA: User spoke while Silence Greeting was triggering
2025-12-27T07:52:25.016161832Z [err]  2025-12-27 07:52:25,010 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-27T07:52:25.016171950Z [err]  2025-12-27 07:52:25,010 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:25.016175800Z [err]  2025-12-27 07:52:25,013 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 124ms
2025-12-27T07:52:25.016180050Z [err]  2025-12-27 07:52:25,011 - telnyx_service - ERROR - ‚ùå Error stopping audio playback: 'ActionsResource' object has no attribute 'playback_stop'
2025-12-27T07:52:25.016188287Z [err]  2025-12-27 07:52:25,011 - calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-27T07:52:25.016190090Z [err]  2025-12-27 07:52:25,013 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-27T07:52:25.016196109Z [err]  2025-12-27 07:52:25,011 - calling_service - INFO - ‚úÖ BARGE-IN: Removed silence greeting from history: 'Kendrick?'
2025-12-27T07:52:25.016198598Z [err]  2025-12-27 07:52:25,013 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:qLsOBlYP56huORwio... (active sessions: [])
2025-12-27T07:52:25.016204400Z [err]  2025-12-27 07:52:25,012 - redis_service - INFO - üì• Retrieved call data from Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:25.016210451Z [err]  2025-12-27 07:52:25,013 - redis_service - INFO - üì¶ Stored call data in Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA (TTL: 3600s)
2025-12-27T07:52:25.016215712Z [err]  2025-12-27 07:52:25,013 - calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-27T07:52:25.016228094Z [err]  2025-12-27 07:52:25,013 - calling_service - INFO - ‚úÖ BARGE-IN: Returning greeting script: 'Kendrick?'
2025-12-27T07:52:25.016237036Z [err]  2025-12-27 07:52:25,013 - server - INFO - üì§ Sentence arrived from LLM: Kendrick?...
2025-12-27T07:52:25.019417779Z [err]  2025-12-27 07:52:25,013 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-27T07:52:25.098434083Z [err]  2025-12-27 07:52:25,097 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T07:52:25.182697844Z [err]  2025-12-27 07:52:25,180 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T07:52:25.216185224Z [err]  2025-12-27 07:52:25,212 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:qLsOBlYP56huORwio... (active sessions: [])
2025-12-27T07:52:25.216194391Z [err]  2025-12-27 07:52:25,213 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:qLsOBlYP56huORwio... (active sessions: [])
2025-12-27T07:52:25.269444193Z [err]  2025-12-27 07:52:25,263 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T07:52:25.286667662Z [err]  2025-12-27 07:52:25,284 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-27T07:52:25.286676380Z [err]  2025-12-27 07:52:25,284 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-27T07:52:25.286682880Z [err]  2025-12-27 07:52:25,284 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-27T07:52:25.286689042Z [err]  2025-12-27 07:52:25,285 - persistent_tts_service - INFO - üîå [Call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA] Establishing persistent TTS WebSocket...
2025-12-27T07:52:25.286696070Z [err]  2025-12-27 07:52:25,285 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-27T07:52:25.286702811Z [err]  2025-12-27 07:52:25,285 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-27T07:52:25.286709292Z [err]  2025-12-27 07:52:25,285 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-27T07:52:25.321800127Z [err]  2025-12-27 07:52:25,319 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T07:52:25.321812081Z [err]  2025-12-27 07:52:25,319 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': '1abe01e0-d65b-4bf1-9cc1-70bf3d57c28c', 'occurred_at': '2025-12-27T07:52:25.183965Z', 'payload': {'call_control_id': 'v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA', 'call_leg_id': 'f620e0c6-e2f8-11f0-ae80-02420aef991f', 'call_session_id': 'f61df910-e2f8-11f0-8a96-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T07:52:25.321820452Z [err]  2025-12-27 07:52:25,319 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:25.321827041Z [err]  2025-12-27 07:52:25,319 - server - INFO - üì® ================================================
2025-12-27T07:52:25.321833894Z [inf]  100.64.0.8:36228 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T07:52:25.937162479Z [err]  2025-12-27 07:52:25,418 - server - INFO - üîç Persistent TTS lookup: call_id=v3:qLsOBlYP56huORwio..., session=FOUND
2025-12-27T07:52:25.937172488Z [err]  2025-12-27 07:52:25,418 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-27T07:52:25.937188234Z [err]  2025-12-27 07:52:25,418 - server - INFO - üéµ TTS task #1 started at +405ms
2025-12-27T07:52:25.937195237Z [err]  2025-12-27 07:52:25,418 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 529ms
2025-12-27T07:52:25.937213063Z [err]  2025-12-27 07:52:25,418 - persistent_tts_service - INFO - ‚úÖ [Call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA] Persistent TTS WebSocket established
2025-12-27T07:52:25.937220829Z [err]  2025-12-27 07:52:25,418 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-27T07:52:25.937224673Z [err]  2025-12-27 07:52:25,418 - persistent_tts_service - INFO - üéß [Call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA] Audio receiver loop started
2025-12-27T07:52:25.937229580Z [err]  2025-12-27 07:52:25,418 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-27T07:52:25.937233178Z [err]  2025-12-27 07:52:25,418 - persistent_tts_service - INFO - üîä [Call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA] Comfort noise loop started
2025-12-27T07:52:25.937238877Z [err]  2025-12-27 07:52:25,418 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:25.937244803Z [err]  2025-12-27 07:52:25,418 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-27T07:52:25.937256138Z [err]  2025-12-27 07:52:25,420 - server - INFO - ‚úÖ LLM finished in 531ms, TTS tasks already running in background
2025-12-27T07:52:25.937262576Z [err]  2025-12-27 07:52:25,421 - server - INFO - üéµ Streaming 1 TTS chunks as they complete...
2025-12-27T07:52:25.941500812Z [err]  2025-12-27 07:52:25,421 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-27T07:52:25.941510147Z [err]  2025-12-27 07:52:25,421 - server - INFO -    1 sentences queued and playing seamlessly
2025-12-27T07:52:25.941516444Z [err]  2025-12-27 07:52:25,421 - persistent_tts_service - INFO - üéµ [Call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA] Playback consumer started
2025-12-27T07:52:25.941521385Z [err]  2025-12-27 07:52:25,421 - persistent_tts_service - INFO - üéß [Call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA] Audio Receiver Loop STARTED
2025-12-27T07:52:25.941526569Z [err]  2025-12-27 07:52:25,421 - persistent_tts_service - INFO - üíì [Call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA] Starting TTS keep-alive loop (every 15s)
2025-12-27T07:52:25.941532649Z [err]  2025-12-27 07:52:25,421 - persistent_tts_service - INFO - üîä [Call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA] Starting comfort noise loop
2025-12-27T07:52:25.941538128Z [err]  2025-12-27 07:52:25,421 - persistent_tts_service - INFO - üé§ [Call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA] Streaming sentence #1: Kendrick?...
2025-12-27T07:52:25.941548532Z [err]  2025-12-27 07:52:25,422 - persistent_tts_service - INFO - üöÄ [Call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-27T07:52:25.941554790Z [err]  2025-12-27 07:52:25,422 - persistent_tts_service - INFO - üìä [Call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-27T07:52:25.941560460Z [err]  2025-12-27 07:52:25,422 - persistent_tts_service - INFO - üéß [Call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA] Receiver processing sentence #1: 'Kendrick?...'
2025-12-27T07:52:25.941565247Z [err]  2025-12-27 07:52:25,422 - persistent_tts_service - INFO - üìä [Call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA] DIAGNOSTIC: queue_latency=0ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-27T07:52:25.941645168Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚úÖ All 1 persistent TTS streams completed
2025-12-27T07:52:25.941649505Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-27T07:52:25.941653907Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 532ms from user stop üöÄ
2025-12-27T07:52:25.941658914Z [err]  2025-12-27 07:52:25,422 - calling_service - INFO - ü§ñ Agent started speaking for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:25.941663439Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-27T07:52:25.941668218Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-27T07:52:25.941672371Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-27T07:52:25.941676694Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 9ms (provider: soniox, model: stt-rt-v3)
2025-12-27T07:52:25.941681288Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 531ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-27T07:52:25.941687118Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 408ms (provider: elevenlabs, websocket: False)
2025-12-27T07:52:25.941691730Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 532ms (user stopped ‚Üí play_audio_url called)
2025-12-27T07:52:25.941696084Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-27T07:52:25.941700500Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-27T07:52:25.943987644Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-27T07:52:25.943997075Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-27T07:52:25.944004538Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-27T07:52:25.944010738Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 832ms estimated
2025-12-27T07:52:25.944016096Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 9 chars, 1 sentences
2025-12-27T07:52:25.944021851Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Hello?...'
2025-12-27T07:52:25.944027899Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: 'Kendrick?...'
2025-12-27T07:52:25.944032135Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-27T07:52:25.944036695Z [err]  2025-12-27 07:52:25,422 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-27T07:52:25.944041943Z [err]  2025-12-27 07:52:25,422 - server - ERROR - ‚ùå Error processing transcript: 'str' object has no attribute 'get'
2025-12-27T07:52:25.944046069Z [err]  2025-12-27 07:52:25,443 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T07:52:25.944050659Z [err]  2025-12-27 07:52:25,443 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '7c92f8ad-284d-41f1-8e6e-4e94935ad72b', 'occurred_at': '2025-12-27T07:52:25.003967Z', 'payload': {'call_control_id': 'v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA', 'call_leg_id': 'f620e0c6-e2f8-11f0-ae80-02420aef991f', 'call_session_id': 'f61df910-e2f8-11f0-8a96-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'BlyhCqOvUw'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T07:52:25.947269094Z [err]  2025-12-27 07:52:25,443 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:25.947280842Z [err]  2025-12-27 07:52:25,443 - server - INFO - üì® ================================================
2025-12-27T07:52:25.947295582Z [inf]  100.64.0.9:11768 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T07:52:25.947308701Z [err]  2025-12-27 07:52:25,663 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 241ms
2025-12-27T07:52:25.947315973Z [err]  2025-12-27 07:52:25,663 - persistent_tts_service - INFO - üì§ Sending 7043 bytes of audio (45 chunks, 0.9s duration) via WebSocket
2025-12-27T07:52:25.947326756Z [err]  2025-12-27 07:52:25,663 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-27T07:52:25.947336810Z [err]  2025-12-27 07:52:25,663 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +0.9s (total: 0.9s from now)
2025-12-27T07:52:25.947343897Z [err]  2025-12-27 07:52:25,664 - persistent_tts_service - INFO - ‚úÖ Sent 45 audio chunks via WebSocket
2025-12-27T07:52:25.947351016Z [err]  2025-12-27 07:52:25,715 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (0.8s left)
2025-12-27T07:52:26.057362593Z [err]  2025-12-27 07:52:26,054 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T07:52:26.057376576Z [err]  2025-12-27 07:52:26,054 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '8ccb1990-0f12-4aaa-8cc9-5b27ff6cb254', 'occurred_at': '2025-12-27T07:52:25.923968Z', 'payload': {'call_control_id': 'v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA', 'call_leg_id': 'f620e0c6-e2f8-11f0-ae80-02420aef991f', 'call_session_id': 'f61df910-e2f8-11f0-8a96-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'BlyhCqOvUw', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T07:52:26.057385892Z [err]  2025-12-27 07:52:26,054 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:26.057394565Z [err]  2025-12-27 07:52:26,054 - server - INFO - üì® ================================================
2025-12-27T07:52:26.060295719Z [err]  2025-12-27 07:52:26,057 - redis_service - INFO - ‚ûñ Removed playback BlyhCqOvUw, 0 remaining for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:26.060304305Z [err]  2025-12-27 07:52:26,057 - server - INFO - üîä Redis: Removed playback BlyhCqOvUw, 0 remaining
2025-12-27T07:52:26.060310052Z [err]  2025-12-27 07:52:26,057 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-27T07:52:26.060318020Z [err]  2025-12-27 07:52:26,057 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-27T07:52:26.060325159Z [err]  2025-12-27 07:52:26,057 - server - INFO - üí° Session not on this worker - Redis flag set for WebSocket worker to handle
2025-12-27T07:52:26.060331733Z [inf]  100.64.0.8:36228 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T07:52:26.219116249Z [err]  2025-12-27 07:52:26,216 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-27T07:52:26.219127549Z [err]  2025-12-27 07:52:26,217 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766821946.2171066 for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:26.219137264Z [err]  2025-12-27 07:52:26,217 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:27.060192565Z [err]  2025-12-27 07:52:26,667 - persistent_tts_service - INFO - üîá [Call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA] FLOOR RELEASED (is_holding_floor=False)
2025-12-27T07:52:28.117209600Z [err]  2025-12-27 07:52:27,664 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-27T07:52:28.117217874Z [err]  2025-12-27 07:52:27,664 - persistent_tts_service - INFO - ‚úÖ [Call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA] Receiver finished sentence #1: 1 chunks in 2242ms
2025-12-27T07:52:28.117226473Z [err]  2025-12-27 07:52:27,721 - server - INFO - üì§ Audio flowing: 299 packets sent to Soniox (5s update)
2025-12-27T07:52:28.989632762Z [err]  2025-12-27 07:52:28,396 - server - INFO - üì® ================================================
2025-12-27T07:52:28.989645325Z [err]  2025-12-27 07:52:28,396 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 325 total packets
2025-12-27T07:52:28.989652514Z [err]  [2025-12-27 07:52:28 +0000] [5] [INFO] connection closed
2025-12-27T07:52:28.989659781Z [err]  2025-12-27 07:52:28,396 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T07:52:28.989660566Z [err]  2025-12-27 07:52:28,402 - redis_service - INFO - ‚ûñ Removed playback g5QECFxRZA, 0 remaining for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:28.989667351Z [err]  2025-12-27 07:52:28,396 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '6d29ee59-69ee-4d6d-beff-986105a7c5e0', 'occurred_at': '2025-12-27T07:52:28.263967Z', 'payload': {'call_control_id': 'v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA', 'call_leg_id': 'f620e0c6-e2f8-11f0-ae80-02420aef991f', 'call_session_id': 'f61df910-e2f8-11f0-8a96-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-27T07:52:28.263967Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'g5QECFxRZA', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T07:52:28.989669627Z [err]  2025-12-27 07:52:28,402 - server - INFO - üîä Redis: Removed playback g5QECFxRZA, 0 remaining
2025-12-27T07:52:28.989675332Z [err]  2025-12-27 07:52:28,396 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:28.989677391Z [err]  2025-12-27 07:52:28,402 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-27T07:52:28.993925661Z [err]  2025-12-27 07:52:28,403 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-27T07:52:28.993932935Z [err]  2025-12-27 07:52:28,403 - server - INFO - üí° Session not on this worker - Redis flag set for WebSocket worker to handle
2025-12-27T07:52:28.993939685Z [inf]  100.64.0.8:36228 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T07:52:28.993947451Z [err]  2025-12-27 07:52:28,422 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T07:52:28.993956360Z [err]  2025-12-27 07:52:28,422 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': 'f4b55b42-5941-4ceb-b060-a983a8a35754', 'occurred_at': '2025-12-27T07:52:28.183966Z', 'payload': {'call_control_id': 'v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA', 'call_leg_id': 'f620e0c6-e2f8-11f0-ae80-02420aef991f', 'call_quality_stats': {'inbound': {'jitter_max_variance': '0.04', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '379', 'skip_packet_count': '16'}, 'outbound': {'packet_count': '324', 'skip_packet_count': '0'}}, 'call_session_id': 'f61df910-e2f8-11f0-8a96-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-27T07:52:28.183966Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-27T07:52:15.824000Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T07:52:28.993964451Z [err]  2025-12-27 07:52:28,422 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:28.993972110Z [err]  2025-12-27 07:52:28,422 - server - INFO - üì® ================================================
2025-12-27T07:52:28.993980019Z [err]  2025-12-27 07:52:28,422 - server - INFO - üìû Call ended: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:28.994086673Z [err]  2025-12-27 07:52:28,422 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-27T07:52:28.994093480Z [err]  2025-12-27 07:52:28,559 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T07:52:28.994100035Z [err]  2025-12-27 07:52:28,559 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': '7bba7ba7-abd2-46e6-90d3-f35a13f7ea9a', 'occurred_at': '2025-12-27T07:52:28.328712Z', 'payload': {'call_control_id': 'v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA', 'call_leg_id': 'f620e0c6-e2f8-11f0-ae80-02420aef991f', 'call_session_id': 'f61df910-e2f8-11f0-8a96-02420aef991f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '07c2fd5e-6378-4738-995c-f06a9489a152', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T07:52:28.994107431Z [err]  2025-12-27 07:52:28,559 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:28.994113046Z [err]  2025-12-27 07:52:28,559 - server - INFO - üì® ================================================
2025-12-27T07:52:28.994120318Z [inf]  100.64.0.6:14080 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T07:52:28.994127136Z [err]  2025-12-27 07:52:28,616 - server - INFO - üìù Updated call log: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:28.994134279Z [err]  2025-12-27 07:52:28,714 - server - INFO - ‚úÖ Finalized call log: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA (duration=7s, status=completed)
2025-12-27T07:52:30.003382296Z [err]  2025-12-27 07:52:29,458 - server - INFO - üìä Auto-added call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-27T07:52:30.003388950Z [err]  2025-12-27 07:52:29,649 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-27T07:52:30.003395742Z [err]  2025-12-27 07:52:29,650 - redis_service - INFO - üì• Retrieved call data from Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:30.003402386Z [err]  2025-12-27 07:52:29,650 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=No
2025-12-27T07:52:30.003417431Z [err]  2025-12-27 07:52:29,650 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-27T07:52:30.003424702Z [err]  2025-12-27 07:52:29,747 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-27T07:52:30.003431176Z [err]  2025-12-27 07:52:29,840 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-27T07:52:30.003438021Z [err]  2025-12-27 07:52:29,840 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-27T07:52:30.003444370Z [err]  2025-12-27 07:52:29,840 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-27T07:52:30.003450562Z [err]  2025-12-27 07:52:29,840 - server - INFO - üöÄ Triggered QC analysis for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:30.003467799Z [err]  2025-12-27 07:52:29,840 - server - INFO - üìä Triggered Campaign QC for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:30.004581153Z [err]  2025-12-27 07:52:29,840 - server - INFO - üìá Triggered CRM update for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:30.004587109Z [err]  2025-12-27 07:52:29,841 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:30.004594736Z [err]  2025-12-27 07:52:29,842 - redis_service - INFO - üßπ Deleted call data from Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:30.004601089Z [err]  2025-12-27 07:52:29,842 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:30.004607414Z [inf]  100.64.0.9:11768 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T07:52:30.004613047Z [err]  2025-12-27 07:52:29,842 - server - INFO - üîç Starting QC analysis for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:30.004618907Z [err]  2025-12-27 07:52:29,842 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-27T07:52:30.004625047Z [err]  2025-12-27 07:52:29,844 - server - INFO - üìá CRM update starting for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-27T07:52:30.004632471Z [err]  2025-12-27 07:52:29,844 - server - INFO - üìá Normalized phone: +17708336397
2025-12-27T07:52:30.004638543Z [err]  2025-12-27 07:52:29,938 - server - INFO - üìù Converted transcript from 2 messages to 33 characters
2025-12-27T07:52:30.041165166Z [err]  2025-12-27 07:52:30,030 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-27T07:52:30.041175705Z [err]  2025-12-27 07:52:30,030 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-27T07:52:30.041182913Z [err]  2025-12-27 07:52:30,033 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T07:52:30.186109926Z [err]  2025-12-27 07:52:30,128 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-27T07:52:30.225061176Z [err]  2025-12-27 07:52:30,220 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-27T07:52:30.225080390Z [err]  2025-12-27 07:52:30,221 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-27T07:52:30.225088158Z [err]  2025-12-27 07:52:30,221 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:30.234528885Z [err]  2025-12-27 07:52:30,228 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=4.0s, checkin_count=0/2
2025-12-27T07:52:31.134252012Z [err]  2025-12-27 07:52:30,394 - server - INFO - üìá CRM: Total variables collected: []
2025-12-27T07:52:31.134262162Z [err]  2025-12-27 07:52:30,457 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=2, logs_count=2, status=completed
2025-12-27T07:52:31.134269819Z [err]  2025-12-27 07:52:30,571 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name']
2025-12-27T07:52:31.134278841Z [err]  2025-12-27 07:52:30,667 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T07:52:31.134288286Z [err]  2025-12-27 07:52:30,667 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '8f241cd8-dbc5-4d5b-9b76-756dced3e5bb', 'occurred_at': '2025-12-27T07:52:30.050020Z', 'payload': {'call_control_id': 'v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA', 'call_leg_id': 'f620e0c6-e2f8-11f0-ae80-02420aef991f', 'call_session_id': 'f61df910-e2f8-11f0-8a96-02420aef991f', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-27T07:52:28.283274Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-27T07:52:28.283274Z', 'recording_id': 'fced7b71-12d8-434f-8f44-ee4591842c2a', 'recording_started_at': '2025-12-27T07:52:23.241144Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-27/f620e0c6-e2f8-11f0-ae80-02420aef991f-1766821943175387.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251227%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251227T075230Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=b0135650f9f041fc7f9d94645101782b716fb6ecd838c6bf004b88a9c1347917'}, 'start_time': '2025-12-27T07:52:23.241144Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T07:52:31.148346932Z [err]  2025-12-27 07:52:30,667 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:31.148358846Z [err]  2025-12-27 07:52:30,667 - server - INFO - üì® ================================================
2025-12-27T07:52:31.148368595Z [err]  2025-12-27 07:52:30,667 - server - INFO - üéôÔ∏è Recording saved for call: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:31.148378262Z [err]  2025-12-27 07:52:30,668 - redis_service - WARNING - ‚ö†Ô∏è Call data not found in Redis: v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:31.148387601Z [err]  2025-12-27 07:52:30,668 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=fced7b71-12d8-434f-8f44-ee4591842c2a, call_data=True
2025-12-27T07:52:31.148396519Z [err]  2025-12-27 07:52:30,729 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=4.5s, checkin_count=0/2
2025-12-27T07:52:31.148405362Z [err]  2025-12-27 07:52:30,766 - server - INFO - üíæ Saved recording URL and ID to database: fced7b71-12d8-434f-8f44-ee4591842c2a
2025-12-27T07:52:31.148413992Z [err]  2025-12-27 07:52:30,766 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-27T07:52:31.148426488Z [err]  2025-12-27 07:52:30,766 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-27T07:52:31.148435249Z [err]  2025-12-27 07:52:30,934 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-27T07:52:31.148446391Z [err]  2025-12-27 07:52:31,033 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-27T07:52:31.148457116Z [err]  2025-12-27 07:52:31,033 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-27T07:52:31.149404391Z [err]  2025-12-27 07:52:31,033 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-27T07:52:31.149410761Z [err]  2025-12-27 07:52:31,034 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-27T07:52:31.149420637Z [err]    File "/app/backend/server.py", line 9758, in trigger_campaign_qc_for_call
2025-12-27T07:52:31.149427167Z [err]      await run_full_qc_analysis(
2025-12-27T07:52:31.149433826Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-27T07:52:31.149440543Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-27T07:52:31.149451758Z [err]  
2025-12-27T07:52:31.149462346Z [err]  2025-12-27 07:52:31,066 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-27/f620e0c6-e2f8-11f0-ae80-02420aef991f-1766821943175387.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251227%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251227T075230Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=b0135650f9f041fc7f9d94645101782b716fb6ecd838c6bf004b88a9c1347917 "HTTP/1.1 200 OK"
2025-12-27T07:52:31.149468065Z [err]  2025-12-27 07:52:31,073 - server - INFO - ‚úÖ Downloaded 20523 bytes
2025-12-27T07:52:31.995922316Z [err]    File "/app/backend/server.py", line 6024, in transcribe_audio_soniox_file
2025-12-27T07:52:31.995925214Z [err]    File "/usr/local/lib/python3.11/subprocess.py", line 1026, in __init__
2025-12-27T07:52:31.995933289Z [err]      result = subprocess.run(curl_cmd, capture_output=True, text=True, timeout=300)
2025-12-27T07:52:31.995937892Z [err]      self._execute_child(args, executable, preexec_fn, close_fds,
2025-12-27T07:52:31.995941098Z [err]               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-27T07:52:31.995946591Z [err]    File "/usr/local/lib/python3.11/subprocess.py", line 1955, in _execute_child
2025-12-27T07:52:31.995949477Z [err]    File "/usr/local/lib/python3.11/subprocess.py", line 548, in run
2025-12-27T07:52:31.995956151Z [err]      with Popen(*popenargs, **kwargs) as process:
2025-12-27T07:52:31.995963003Z [err]           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-27T07:52:31.996000515Z [err]  2025-12-27 07:52:31,356 - server - INFO - ‚úÖ Split into 2 channels
2025-12-27T07:52:31.996002279Z [err]  2025-12-27 07:52:31,450 - server - INFO - Soniox: Using user's DB API key (first 10 chars): b999f22d7b...
2025-12-27T07:52:31.996010550Z [err]  2025-12-27 07:52:31,450 - server - INFO - Soniox: Uploading audio file (0.10 MB)...
2025-12-27T07:52:31.996011231Z [err]  2025-12-27 07:52:31,356 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-27T07:52:31.996019034Z [err]  2025-12-27 07:52:31,356 - server - INFO - üìä Channel 0: 109164 bytes
2025-12-27T07:52:31.996022653Z [err]  2025-12-27 07:52:31,451 - server - INFO - Soniox: Running curl upload command (HTTP/1.1)...
2025-12-27T07:52:31.996029492Z [err]  2025-12-27 07:52:31,451 - server - ERROR - Error transcribing audio file with Soniox: [Errno 2] No such file or directory: 'curl'
2025-12-27T07:52:31.996035804Z [err]  2025-12-27 07:52:31,453 - server - ERROR - Traceback (most recent call last):
2025-12-27T07:52:32.001135471Z [err]      raise child_exception_type(errno_num, err_msg, err_filename)
2025-12-27T07:52:32.001142937Z [err]  FileNotFoundError: [Errno 2] No such file or directory: 'curl'
2025-12-27T07:52:32.001148528Z [err]  
2025-12-27T07:52:32.001154084Z [err]  2025-12-27 07:52:31,454 - server - INFO - ‚ùå Channel 0: No speech
2025-12-27T07:52:32.001160116Z [err]  2025-12-27 07:52:31,454 - server - INFO - üìä Channel 1: 109164 bytes
2025-12-27T07:52:32.001166216Z [err]  2025-12-27 07:52:31,547 - server - INFO - Soniox: Using user's DB API key (first 10 chars): b999f22d7b...
2025-12-27T07:52:32.001172341Z [err]  2025-12-27 07:52:31,547 - server - INFO - Soniox: Uploading audio file (0.10 MB)...
2025-12-27T07:52:32.001178233Z [err]  2025-12-27 07:52:31,547 - server - INFO - Soniox: Running curl upload command (HTTP/1.1)...
2025-12-27T07:52:32.001184602Z [err]  2025-12-27 07:52:31,548 - server - ERROR - Error transcribing audio file with Soniox: [Errno 2] No such file or directory: 'curl'
2025-12-27T07:52:32.001190380Z [err]  2025-12-27 07:52:31,549 - server - ERROR - Traceback (most recent call last):
2025-12-27T07:52:32.001197077Z [err]    File "/app/backend/server.py", line 6024, in transcribe_audio_soniox_file
2025-12-27T07:52:32.001208852Z [err]      result = subprocess.run(curl_cmd, capture_output=True, text=True, timeout=300)
2025-12-27T07:52:32.001214869Z [err]               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-27T07:52:32.001220725Z [err]    File "/usr/local/lib/python3.11/subprocess.py", line 548, in run
2025-12-27T07:52:32.001226467Z [err]      with Popen(*popenargs, **kwargs) as process:
2025-12-27T07:52:32.001232507Z [err]           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-27T07:52:32.001238146Z [err]    File "/usr/local/lib/python3.11/subprocess.py", line 1026, in __init__
2025-12-27T07:52:32.001243961Z [err]      self._execute_child(args, executable, preexec_fn, close_fds,
2025-12-27T07:52:32.003208950Z [err]    File "/usr/local/lib/python3.11/subprocess.py", line 1955, in _execute_child
2025-12-27T07:52:32.003215941Z [err]      raise child_exception_type(errno_num, err_msg, err_filename)
2025-12-27T07:52:32.003222861Z [err]  FileNotFoundError: [Errno 2] No such file or directory: 'curl'
2025-12-27T07:52:32.003230140Z [err]  
2025-12-27T07:52:32.003236952Z [err]  2025-12-27 07:52:31,549 - server - INFO - ‚ùå Channel 1: No speech
2025-12-27T07:52:32.003248379Z [err]  2025-12-27 07:52:31,549 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-27T07:52:32.003256142Z [inf]  100.64.0.10:28898 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T07:52:33.128210499Z [err]  2025-12-27 07:52:32,735 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-27T07:52:33.128217538Z [err]  2025-12-27 07:52:32,738 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-27T07:52:33.128224120Z [err]  2025-12-27 07:52:32,740 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:33.239145306Z [err]  2025-12-27 07:52:33,234 - calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-27T07:52:33.239159637Z [err]  2025-12-27 07:52:33,235 - calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-27T07:52:33.239168929Z [err]  2025-12-27 07:52:33,235 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-27T07:52:33.239176397Z [err]  2025-12-27 07:52:33,235 - calling_service - INFO - ü§ñ Agent started speaking for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:33.239190168Z [err]  2025-12-27 07:52:33,235 - telnyx_service - INFO - üîä Speaking text on call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA: Are you still there?...
2025-12-27T07:52:33.239199723Z [err]  2025-12-27 07:52:33,235 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-27T07:52:33.239207921Z [err]  2025-12-27 07:52:33,235 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-27T07:52:33.239218349Z [err]  2025-12-27 07:52:33,235 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-27T07:52:33.239225208Z [err]  2025-12-27 07:52:33,235 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-27T07:52:33.239234146Z [err]  2025-12-27 07:52:33,235 - server - INFO - ‚è±Ô∏è [07:52:33.235] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-27T07:52:33.239257634Z [err]  2025-12-27 07:52:33,235 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-27T07:52:33.239265838Z [err]  2025-12-27 07:52:33,235 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-27T07:52:33.323648466Z [err]  2025-12-27 07:52:33,319 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T07:52:33.323665123Z [err]  2025-12-27 07:52:33,319 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-27T07:52:33.323674030Z [err]  2025-12-27 07:52:33,319 - server - INFO -    Text length: 20 chars
2025-12-27T07:52:33.323681963Z [err]  2025-12-27 07:52:33,319 - server - INFO -    Text content: 'Are you still there?'
2025-12-27T07:52:33.323691010Z [err]  2025-12-27 07:52:33,319 - server - INFO -    Text bytes: b'Are you still there?'
2025-12-27T07:52:33.323699634Z [err]  2025-12-27 07:52:33,319 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-27T07:52:33.323714072Z [err]  2025-12-27 07:52:33,319 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-27T07:52:33.323726591Z [err]  2025-12-27 07:52:33,319 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-27T07:52:33.323734556Z [err]  2025-12-27 07:52:33,319 - server - INFO -    Full data: {'text': 'Are you still there?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-27T07:52:33.323742122Z [err]  2025-12-27 07:52:33,319 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-27T07:52:33.323750403Z [err]  2025-12-27 07:52:33,319 - server - INFO -    Timeout: 10.0s
2025-12-27T07:52:33.337705045Z [err]  2025-12-27 07:52:33,332 - server - INFO -    ‚úì HTTP client created (0.012s)
2025-12-27T07:52:33.337718927Z [err]  2025-12-27 07:52:33,332 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-27T07:52:34.167701392Z [err]  2025-12-27 07:52:33,667 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-27T07:52:34.167712436Z [err]  2025-12-27 07:52:33,667 - server - INFO -    ‚úì Connection established (0.348s) [TARGET: <200ms]
2025-12-27T07:52:34.167712461Z [err]  2025-12-27 07:52:33,667 - server - INFO -    ‚úì Response status: 200
2025-12-27T07:52:34.167731206Z [err]  2025-12-27 07:52:33,682 - server - INFO - üíæ TTS CACHED: elevenlabs:Are you still there?... (17599 bytes)
2025-12-27T07:52:34.167739170Z [err]  2025-12-27 07:52:33,682 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.45s
2025-12-27T07:52:34.167746547Z [err]  2025-12-27 07:52:33,667 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-27T07:52:34.167753117Z [err]  2025-12-27 07:52:33,678 - server - INFO -    ‚úì FIRST CHUNK received (0.359s, 1110 bytes) [TARGET: <300ms]
2025-12-27T07:52:34.167758278Z [err]  2025-12-27 07:52:33,682 - server - INFO -    ‚úì Total audio size: 17599 bytes
2025-12-27T07:52:34.167760470Z [err]  2025-12-27 07:52:33,682 - server - INFO -    ‚úì ALL CHUNKS received: 39 chunks (0.362s)
2025-12-27T07:52:34.167765627Z [err]  2025-12-27 07:52:33,682 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-27T07:52:34.167776902Z [err]  2025-12-27 07:52:33,682 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-27T07:52:34.167785506Z [err]  2025-12-27 07:52:33,682 - server - INFO -       - Connection: 348ms
2025-12-27T07:52:34.167793764Z [err]  2025-12-27 07:52:33,682 - server - INFO -       - First chunk: 359ms
2025-12-27T07:52:34.167803458Z [err]  2025-12-27 07:52:33,682 - server - INFO -       - All chunks: 362ms
2025-12-27T07:52:34.167811110Z [err]  2025-12-27 07:52:33,682 - server - INFO -       - Audio generation only: 11ms
2025-12-27T07:52:34.167818372Z [err]  2025-12-27 07:52:33,682 - server - INFO - ‚è±Ô∏è [07:52:33.682] üîä TTS COMPLETE: 447ms, audio_size=17599 bytes
2025-12-27T07:52:34.172398423Z [err]  2025-12-27 07:52:33,683 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-27T07:52:34.172407013Z [err]  2025-12-27 07:52:33,968 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-27T07:52:34.172415375Z [err]  2025-12-27 07:52:33,969 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.29s
2025-12-27T07:52:34.172422785Z [err]  2025-12-27 07:52:33,969 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-27T07:52:34.172431941Z [err]    "errors": [
2025-12-27T07:52:34.172438800Z [err]      {
2025-12-27T07:52:34.172445545Z [err]        "code": "90018",
2025-12-27T07:52:34.172453486Z [err]        "title": "Call has already ended",
2025-12-27T07:52:34.172463081Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-27T07:52:34.172474594Z [err]      }
2025-12-27T07:52:34.172513881Z [err]    ]
2025-12-27T07:52:34.172524694Z [err]  }
2025-12-27T07:52:34.172531949Z [err]  2025-12-27 07:52:33,969 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-27T07:52:34.241997397Z [err]  2025-12-27 07:52:34,235 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-27T07:52:34.242006900Z [err]  2025-12-27 07:52:34,236 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-27T07:52:34.242017409Z [err]  2025-12-27 07:52:34,236 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-27T07:52:35.135106154Z [err]  2025-12-27 07:52:34,738 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-27T07:52:35.135111743Z [err]  2025-12-27 07:52:34,738 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766821954.738585 for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:35.135116236Z [err]  2025-12-27 07:52:34,738 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:35.135121597Z [err]  2025-12-27 07:52:34,926 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-27T07:52:35.135126281Z [err]  2025-12-27 07:52:34,930 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-27T07:52:35.135131544Z [err]  2025-12-27 07:52:34,931 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:37.133548519Z [err]  2025-12-27 07:52:37,127 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-27T07:52:37.133554662Z [err]  2025-12-27 07:52:37,128 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Expecting value: line 1 column 1 (char 0)
2025-12-27T07:52:37.237352089Z [err]  2025-12-27 07:52:37,232 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:37.237368644Z [err]  2025-12-27 07:52:37,232 - server - INFO - ‚úÖ QC analysis completed for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:37.237378776Z [err]  2025-12-27 07:52:37,232 - server - INFO - üìä Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-27T07:52:38.138129234Z [err]  2025-12-27 07:52:37,435 - server - INFO - üìä Updated campaign_calls with QC scores for v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:38.138139186Z [err]  2025-12-27 07:52:37,629 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-27T07:52:38.138146562Z [err]  2025-12-27 07:52:37,726 - server - INFO - üè∑Ô∏è Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-27T07:52:38.138153180Z [err]  2025-12-27 07:52:37,726 - server - ERROR - ‚ùå Error in auto appointment detection for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA: 'str' object has no attribute 'get'
2025-12-27T07:52:40.258179041Z [err]  2025-12-27 07:52:40,254 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=5.5s, checkin_count=1/2
2025-12-27T07:52:41.006051553Z [err]  2025-12-27 07:52:40,756 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=6.0s, checkin_count=1/2
2025-12-27T07:52:42.108454960Z [err]  2025-12-27 07:52:41,759 - calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-27T07:52:42.108461421Z [err]  2025-12-27 07:52:41,760 - calling_service - INFO - üí¨ Sending FINAL check-in #2/2: Are you still there?
2025-12-27T07:52:42.108468311Z [err]  2025-12-27 07:52:41,760 - calling_service - INFO - ‚ö†Ô∏è Will end call if no response after next silence timeout
2025-12-27T07:52:42.108478927Z [err]  2025-12-27 07:52:41,760 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-27T07:52:42.108486571Z [err]  2025-12-27 07:52:41,760 - calling_service - INFO - ü§ñ Agent started speaking for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:42.108502742Z [err]  2025-12-27 07:52:41,760 - telnyx_service - INFO - üîä Speaking text on call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA: Are you still there?...
2025-12-27T07:52:42.108508817Z [err]  2025-12-27 07:52:41,760 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-27T07:52:42.108518419Z [err]  2025-12-27 07:52:41,760 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-27T07:52:42.108527518Z [err]  2025-12-27 07:52:41,760 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-27T07:52:42.108534398Z [err]  2025-12-27 07:52:41,760 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-27T07:52:42.108539908Z [err]  2025-12-27 07:52:41,760 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-27T07:52:42.108547774Z [err]  2025-12-27 07:52:41,760 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-27T07:52:42.108552515Z [err]  2025-12-27 07:52:41,760 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-27T07:52:42.108556762Z [err]  2025-12-27 07:52:41,760 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-27T07:52:42.115073854Z [err]  2025-12-27 07:52:42,061 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-27T07:52:42.115079711Z [err]  2025-12-27 07:52:42,062 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.30s
2025-12-27T07:52:42.115085700Z [err]  2025-12-27 07:52:42,062 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-27T07:52:42.115092125Z [err]    "errors": [
2025-12-27T07:52:42.115099520Z [err]      {
2025-12-27T07:52:42.115107805Z [err]        "code": "90018",
2025-12-27T07:52:42.115114726Z [err]        "title": "Call has already ended",
2025-12-27T07:52:42.115120942Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-27T07:52:42.115128124Z [err]      }
2025-12-27T07:52:42.115134172Z [err]    ]
2025-12-27T07:52:42.115140986Z [err]  }
2025-12-27T07:52:42.115147352Z [err]  2025-12-27 07:52:42,062 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-27T07:52:42.319650910Z [err]  2025-12-27 07:52:42,312 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-27T07:52:42.319661416Z [err]  2025-12-27 07:52:42,312 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-27T07:52:42.319668788Z [err]  2025-12-27 07:52:42,312 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-27T07:52:43.172827254Z [err]  2025-12-27 07:52:42,814 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (16.3s ago), marking agent as done speaking
2025-12-27T07:52:43.172835070Z [err]  2025-12-27 07:52:42,814 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766821962.8142495 for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA
2025-12-27T07:52:43.172840312Z [err]  2025-12-27 07:52:42,814 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:qLsOBlYP56huORwioOH5uqrCrIxjlkriBJUAr4DUle3m2F1X3KXJOA