2025-12-19T11:07:21.000000000Z [inf]  Starting Container
2025-12-19T11:07:22.079319269Z [inf]  =========================================
2025-12-19T11:07:22.079323375Z [inf]  üöÄ START.SH SCRIPT IS EXECUTING
2025-12-19T11:07:22.079327170Z [inf]  =========================================
2025-12-19T11:07:22.079332496Z [inf]  üìç Working directory: /app/backend
2025-12-19T11:07:22.079336251Z [inf]  üîç Python path: /app/backend
2025-12-19T11:07:22.079340067Z [inf]  üåê Starting Gunicorn on 0.0.0.0:8080...
2025-12-19T11:07:22.079345086Z [inf]  =========================================
2025-12-19T11:07:22.090543031Z [err]  [2025-12-19 11:07:22 +0000] [1] [INFO] Starting gunicorn 22.0.0
2025-12-19T11:07:22.090550488Z [err]  [2025-12-19 11:07:22 +0000] [1] [INFO] Listening at: http://0.0.0.0:8080 (1)
2025-12-19T11:07:22.090558341Z [err]  [2025-12-19 11:07:22 +0000] [1] [INFO] Using worker: uvicorn.workers.UvicornWorker
2025-12-19T11:07:22.096588502Z [err]  [2025-12-19 11:07:22 +0000] [3] [INFO] Booting worker with pid: 3
2025-12-19T11:07:22.122419490Z [err]  [2025-12-19 11:07:22 +0000] [4] [INFO] Booting worker with pid: 4
2025-12-19T11:07:22.189831873Z [err]  [2025-12-19 11:07:22 +0000] [5] [INFO] Booting worker with pid: 5
2025-12-19T11:07:22.189841362Z [err]  [2025-12-19 11:07:22 +0000] [6] [INFO] Booting worker with pid: 6
2025-12-19T11:07:42.192737241Z [err]  2025-12-19 11:07:36,704 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-19T11:07:42.192744239Z [err]  2025-12-19 11:07:36,704 - server - INFO - üî• Pre-warming connection libraries...
2025-12-19T11:07:42.192751453Z [err]  2025-12-19 11:07:36,744 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-19T11:07:42.195574447Z [err]  2025-12-19 11:07:36,744 - server - INFO - üî• Pre-warming connection libraries...
2025-12-19T11:07:42.195581394Z [err]  2025-12-19 11:07:36,750 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-19T11:07:42.195588959Z [err]  2025-12-19 11:07:36,772 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-19T11:07:42.195595551Z [err]  2025-12-19 11:07:36,828 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-19T11:07:42.195615038Z [err]  2025-12-19 11:07:36,828 - server - INFO - üî• Pre-warming connection libraries...
2025-12-19T11:07:42.195621328Z [err]  2025-12-19 11:07:36,853 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-19T11:07:42.195627933Z [err]  2025-12-19 11:07:36,853 - server - INFO - üî• Pre-warming connection libraries...
2025-12-19T11:07:42.195633488Z [err]  2025-12-19 11:07:36,863 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-19T11:07:42.195639522Z [err]  2025-12-19 11:07:36,881 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-19T11:07:42.195645283Z [err]  2025-12-19 11:07:36,909 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-19T11:07:42.195651406Z [err]  2025-12-19 11:07:36,946 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-19T11:07:42.196631621Z [err]  2025-12-19 11:07:37,010 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-19T11:07:42.196639326Z [err]  2025-12-19 11:07:37,023 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-19T11:07:42.196645235Z [err]  2025-12-19 11:07:37,037 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-19T11:07:42.196651481Z [err]  2025-12-19 11:07:37,073 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-19T11:07:42.196657730Z [err]  2025-12-19 11:07:37,085 - server - INFO - ‚úÖ QC agent router loaded
2025-12-19T11:07:42.196663598Z [err]  2025-12-19 11:07:37,101 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-19T11:07:42.196669465Z [err]  2025-12-19 11:07:37,112 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-19T11:07:42.196675225Z [err]  2025-12-19 11:07:37,116 - server - INFO - ‚úÖ QC learning router loaded
2025-12-19T11:07:42.196681211Z [err]  2025-12-19 11:07:37,119 - server - INFO - ‚úÖ QC agent router loaded
2025-12-19T11:07:42.196687850Z [err]  2025-12-19 11:07:37,141 - server - INFO - ‚úÖ QC learning router loaded
2025-12-19T11:07:42.196693903Z [err]  2025-12-19 11:07:37,158 - server - INFO - ‚úÖ QC agent router loaded
2025-12-19T11:07:42.196700456Z [err]  2025-12-19 11:07:37,162 - server - INFO - ‚úÖ QC agent router loaded
2025-12-19T11:07:42.196706698Z [err]  2025-12-19 11:07:37,186 - server - INFO - ‚úÖ QC learning router loaded
2025-12-19T11:07:42.196712282Z [err]  2025-12-19 11:07:37,186 - server - INFO - ‚úÖ QC learning router loaded
2025-12-19T11:07:42.196718454Z [err]  2025-12-19 11:07:37,252 - server - INFO - ‚úÖ CRM router loaded
2025-12-19T11:07:42.196725482Z [err]  2025-12-19 11:07:37,282 - server - INFO - ‚úÖ CRM router loaded
2025-12-19T11:07:42.196731198Z [err]  2025-12-19 11:07:37,309 - server - INFO - ‚úÖ QC test router loaded
2025-12-19T11:07:42.196743262Z [err]  2025-12-19 11:07:37,310 - server - INFO - ‚úÖ QC test router loaded
2025-12-19T11:07:42.202274984Z [err]  2025-12-19 11:07:37,336 - server - INFO - ‚úÖ Agent test router loaded
2025-12-19T11:07:42.202280867Z [err]  2025-12-19 11:07:37,337 - server - INFO - ‚úÖ CRM router loaded
2025-12-19T11:07:42.202286653Z [err]  2025-12-19 11:07:37,342 - server - INFO - ‚úÖ QC test router loaded
2025-12-19T11:07:42.202292240Z [err]  2025-12-19 11:07:37,342 - server - INFO - ‚úÖ Agent test router loaded
2025-12-19T11:07:42.202297909Z [err]  2025-12-19 11:07:37,352 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-19T11:07:42.202303106Z [err]  2025-12-19 11:07:37,352 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-19T11:07:42.202307725Z [err]  2025-12-19 11:07:37,359 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-19T11:07:42.202312534Z [err]  2025-12-19 11:07:37,359 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-19T11:07:42.202317718Z [err]  2025-12-19 11:07:37,360 - server - INFO - ‚úÖ Agent test router loaded
2025-12-19T11:07:42.202322992Z [err]  2025-12-19 11:07:37,368 - server - INFO - ‚úÖ CRM router loaded
2025-12-19T11:07:42.202327861Z [err]  2025-12-19 11:07:37,370 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-19T11:07:42.202334406Z [err]  2025-12-19 11:07:37,370 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-19T11:07:42.202339695Z [err]  [2025-12-19 11:07:37 +0000] [3] [INFO] Started server process [3]
2025-12-19T11:07:42.202344371Z [err]  [2025-12-19 11:07:37 +0000] [3] [INFO] Waiting for application startup.
2025-12-19T11:07:42.202350765Z [err]  [2025-12-19 11:07:37 +0000] [4] [INFO] Started server process [4]
2025-12-19T11:07:42.202355668Z [err]  [2025-12-19 11:07:37 +0000] [4] [INFO] Waiting for application startup.
2025-12-19T11:07:42.202360997Z [err]  2025-12-19 11:07:37,384 - server - INFO - ‚úÖ QC test router loaded
2025-12-19T11:07:42.202372833Z [err]  [2025-12-19 11:07:37 +0000] [5] [INFO] Started server process [5]
2025-12-19T11:07:42.202811256Z [err]  [2025-12-19 11:07:37 +0000] [5] [INFO] Waiting for application startup.
2025-12-19T11:07:42.202815343Z [err]  2025-12-19 11:07:37,403 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-19T11:07:42.202819705Z [err]  2025-12-19 11:07:37,416 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-19T11:07:42.202824973Z [err]  2025-12-19 11:07:37,426 - server - INFO - ‚úÖ Agent test router loaded
2025-12-19T11:07:42.202830812Z [err]  2025-12-19 11:07:37,432 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-19T11:07:42.202836180Z [err]  2025-12-19 11:07:37,436 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-19T11:07:42.202841102Z [err]  2025-12-19 11:07:37,436 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-19T11:07:42.202846679Z [err]  [2025-12-19 11:07:37 +0000] [6] [INFO] Started server process [6]
2025-12-19T11:07:42.202854491Z [err]  [2025-12-19 11:07:37 +0000] [6] [INFO] Waiting for application startup.
2025-12-19T11:07:42.202860234Z [err]  2025-12-19 11:07:37,467 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-19T11:07:46.235787996Z [err]  2025-12-19 11:07:45,739 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-19T11:07:46.235792558Z [err]  2025-12-19 11:07:45,744 - server - INFO - ‚úÖ Comfort noise file ready for immediate use
2025-12-19T11:07:46.235796354Z [err]  [2025-12-19 11:07:45 +0000] [3] [INFO] Application startup complete.
2025-12-19T11:07:46.235801603Z [err]  2025-12-19 11:07:45,771 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-19T11:07:46.235805517Z [err]  2025-12-19 11:07:45,779 - server - INFO - ‚úÖ Comfort noise file ready for immediate use
2025-12-19T11:07:46.235809295Z [err]  [2025-12-19 11:07:45 +0000] [5] [INFO] Application startup complete.
2025-12-19T11:07:46.235813534Z [err]  2025-12-19 11:07:45,974 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-19T11:07:46.235821290Z [err]  2025-12-19 11:07:45,974 - server - INFO - ‚úÖ Comfort noise file ready for immediate use
2025-12-19T11:07:46.235825438Z [err]  [2025-12-19 11:07:45 +0000] [6] [INFO] Application startup complete.
2025-12-19T11:07:46.235839691Z [err]  2025-12-19 11:07:46,000 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-19T11:07:46.235844301Z [err]  2025-12-19 11:07:46,004 - server - INFO - ‚úÖ Comfort noise file ready for immediate use
2025-12-19T11:07:46.235847922Z [err]  [2025-12-19 11:07:46 +0000] [4] [INFO] Application startup complete.
2025-12-19T12:16:55.888922835Z [inf]  100.64.0.2:50504 - "POST /api/auth/logout HTTP/1.1" 401
2025-12-19T12:16:58.010048405Z [inf]  100.64.0.3:33828 - "OPTIONS /api/auth/login HTTP/1.1" 200
2025-12-19T12:16:58.976315479Z [inf]  100.64.0.2:50504 - "POST /api/auth/login HTTP/1.1" 200
2025-12-19T12:16:59.930763443Z [inf]  100.64.0.2:50504 - "GET /api/agents HTTP/1.1" 200
2025-12-19T12:17:19.343531782Z [inf]  100.64.0.2:50504 - "OPTIONS /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-19T12:17:19.343538973Z [err]  2025-12-19 12:17:12,400 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-19T12:17:19.343547324Z [err]  2025-12-19 12:17:12,494 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:19.343552738Z [err]  2025-12-19 12:17:12,581 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:19.343578472Z [err]  2025-12-19 12:17:12,613 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-19T12:17:19.343584578Z [err]  2025-12-19 12:17:12,613 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-19T12:17:19.343592293Z [err]  2025-12-19 12:17:12,613 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-19T12:17:19.343597923Z [err]  2025-12-19 12:17:12,613 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-19T12:17:19.343603230Z [err]  2025-12-19 12:17:13,463 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-19T12:17:19.343607735Z [err]  2025-12-19 12:17:13,466 - telnyx_service - INFO - ‚úÖ Call initiated: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.343615034Z [err]  2025-12-19 12:17:13,562 - server - INFO - üìù Created call log: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.343623253Z [err]  2025-12-19 12:17:13,562 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-19T12:17:19.343628604Z [err]  2025-12-19 12:17:13,562 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-19T12:17:19.346833363Z [err]  2025-12-19 12:17:13,562 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-19T12:17:19.346839674Z [err]  2025-12-19 12:17:13,562 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-19T12:17:19.346845542Z [err]  2025-12-19 12:17:13,572 - redis_service - INFO - üì¶ Stored call data in Redis: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw (TTL: 3600s)
2025-12-19T12:17:19.346851970Z [err]  2025-12-19 12:17:13,572 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-19T12:17:19.346857853Z [err]  2025-12-19 12:17:13,572 - server - INFO - üìû Outbound call initiated: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.346864038Z [inf]  100.64.0.4:21698 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-19T12:17:19.346869623Z [err]  2025-12-19 12:17:13,785 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-19T12:17:19.346875275Z [err]  2025-12-19 12:17:13,785 - server - INFO -    Client: Address(host='100.64.0.5', port=38206)
2025-12-19T12:17:19.346881094Z [err]  2025-12-19 12:17:13,785 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'nzY3D2KNqpiN7npHlzmf8g==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'x9iKwpOmRYm6SUxx2prcFg', 'x-real-ip': '192.76.120.151', 'x-request-start': '1766146633510', 'accept-encoding': 'gzip'}
2025-12-19T12:17:19.346886800Z [err]  2025-12-19 12:17:13,785 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-19T12:17:19.346892650Z [err]  2025-12-19 12:17:13,785 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-19T12:17:19.350166624Z [err]  [2025-12-19 12:17:13 +0000] [4] [INFO] ('100.64.0.5', 38206) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-19T12:17:19.350179709Z [err]  2025-12-19 12:17:13,785 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-19T12:17:19.350187067Z [err]  [2025-12-19 12:17:13 +0000] [4] [INFO] connection open
2025-12-19T12:17:19.350193621Z [err]  2025-12-19 12:17:13,831 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:19.350200240Z [err]  2025-12-19 12:17:13,832 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': 'f87ef9a8-6105-47cb-9c8b-2e9f638f9ebc', 'occurred_at': '2025-12-19T12:17:13.303968Z', 'payload': {'call_control_id': 'v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw', 'call_leg_id': 'a65ffa4c-dcd4-11f0-a8de-02420aef971f', 'call_session_id': 'a65d397e-dcd4-11f0-be1a-02420aef971f', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:19.350208991Z [err]  2025-12-19 12:17:13,832 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.350215604Z [err]  2025-12-19 12:17:13,832 - server - INFO - üì® ================================================
2025-12-19T12:17:19.350221828Z [err]  2025-12-19 12:17:13,832 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-19T12:17:19.350227703Z [inf]  100.64.0.6:21936 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:19.350234065Z [err]  2025-12-19 12:17:13,937 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-19T12:17:19.350240570Z [err]  2025-12-19 12:17:13,938 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-19T12:17:19.353287408Z [err]  2025-12-19 12:17:14,189 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-19T12:17:19.353293669Z [err]  2025-12-19 12:17:14,190 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-19T12:17:19.353298183Z [err]  2025-12-19 12:17:17,352 - server - INFO - üì¨ Received Telnyx event: start
2025-12-19T12:17:19.353302700Z [err]  2025-12-19 12:17:17,352 - server - INFO - üé¨ Stream started for call: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.353306934Z [err]  2025-12-19 12:17:17,363 - redis_service - INFO - üì• Retrieved call data from Redis: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.353311038Z [err]  2025-12-19 12:17:17,366 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-19T12:17:19.353315765Z [err]  2025-12-19 12:17:17,366 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-19T12:17:19.353322105Z [err]  2025-12-19 12:17:17,670 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:19.353327765Z [err]  2025-12-19 12:17:17,670 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': '5c459d29-8a3e-4caa-abaa-fc6ded5c0197', 'occurred_at': '2025-12-19T12:17:17.063969Z', 'payload': {'call_control_id': 'v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw', 'call_leg_id': 'a65ffa4c-dcd4-11f0-a8de-02420aef971f', 'call_session_id': 'a65d397e-dcd4-11f0-be1a-02420aef971f', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-19T12:17:13.303968Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:19.353331854Z [err]  2025-12-19 12:17:17,670 - server - INFO - üéØ Event type: call.answered, Call ID: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.357654654Z [err]  2025-12-19 12:17:17,670 - server - INFO - üì® ================================================
2025-12-19T12:17:19.357663820Z [err]  2025-12-19 12:17:17,670 - server - INFO - ‚úÖ Call answered: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.357669643Z [err]  2025-12-19 12:17:17,675 - redis_service - INFO - üì• Retrieved call data from Redis: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.357674333Z [err]  2025-12-19 12:17:17,677 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-19T12:17:19.357678758Z [err]  2025-12-19 12:17:17,677 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-19T12:17:19.357683742Z [err]  2025-12-19 12:17:17,867 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-19T12:17:19.357688906Z [err]  2025-12-19 12:17:17,867 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-19T12:17:19.357693861Z [err]  2025-12-19 12:17:17,872 - redis_service - INFO - üì• Retrieved call data from Redis: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.357701116Z [err]  2025-12-19 12:17:17,874 - server - INFO - üìù Creating session with agent_id=6944df147eadbccc46887cdf, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:17:19.357705828Z [err]  2025-12-19 12:17:17,874 - calling_service - INFO - üîç Checking KB for agent 6944df147eadbccc46887cdf...
2025-12-19T12:17:19.357710928Z [err]  2025-12-19 12:17:17,937 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:19.357716131Z [err]  2025-12-19 12:17:17,938 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': '59300353-d54e-455e-8ce2-b74440ffb86a', 'occurred_at': '2025-12-19T12:17:17.463964Z', 'payload': {'call_control_id': 'v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw', 'call_leg_id': 'a65ffa4c-dcd4-11f0-a8de-02420aef971f', 'call_session_id': 'a65d397e-dcd4-11f0-be1a-02420aef971f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '1c289781-c959-455a-a055-814e7b24c296', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:19.361247594Z [err]  2025-12-19 12:17:17,938 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.361254197Z [err]  2025-12-19 12:17:17,938 - server - INFO - üì® ================================================
2025-12-19T12:17:19.361259531Z [inf]  100.64.0.8:46680 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:19.361263755Z [err]  2025-12-19 12:17:17,973 - calling_service - INFO - üîç KB count query completed: 0 items
2025-12-19T12:17:19.361268489Z [err]  2025-12-19 12:17:17,992 - calling_service - INFO - üìã Built cached system prompt: 5480 chars (global) + 1402 chars (technical)
2025-12-19T12:17:19.361272756Z [err]  2025-12-19 12:17:17,994 - calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-19T12:17:19.361277188Z [err]  2025-12-19 12:17:18,081 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:19.361280963Z [err]  2025-12-19 12:17:18,091 - calling_service - INFO - ‚úÖ LLM client pre-warmed in 97ms
2025-12-19T12:17:19.361285340Z [err]  2025-12-19 12:17:18,091 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-19T12:17:19.361289959Z [err]  2025-12-19 12:17:18,091 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-19T12:17:19.361294322Z [err]  2025-12-19 12:17:18,091 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-19T12:17:19.361298332Z [err]  2025-12-19 12:17:18,091 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-19T12:17:19.361302526Z [err]  2025-12-19 12:17:18,094 - server - INFO - ‚úÖ Initialized call_states for v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw with session reference
2025-12-19T12:17:19.361307034Z [err]  2025-12-19 12:17:18,099 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-19T12:17:19.365086867Z [err]  2025-12-19 12:17:18,189 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-19T12:17:19.365094533Z [err]  2025-12-19 12:17:18,525 - server - INFO - ‚úÖ Call log updated
2025-12-19T12:17:19.365100536Z [err]  2025-12-19 12:17:18,525 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-19T12:17:19.365107334Z [err]  2025-12-19 12:17:18,525 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-19T12:17:19.365113662Z [err]  2025-12-19 12:17:18,525 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:17:19.365118641Z [err]  2025-12-19 12:17:18,614 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:19.365122924Z [err]  2025-12-19 12:17:18,696 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-19T12:17:19.365128503Z [err]  2025-12-19 12:17:18,697 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-19T12:17:19.365132693Z [err]  2025-12-19 12:17:18,697 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-19T12:17:19.365139059Z [err]  2025-12-19 12:17:18,700 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:19.365143606Z [err]  2025-12-19 12:17:18,700 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-19T12:17:19.365148014Z [err]  2025-12-19 12:17:18,722 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-19T12:17:19.365152506Z [err]  2025-12-19 12:17:18,722 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.368782437Z [err]  2025-12-19 12:17:18,723 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:19.368791700Z [err]  2025-12-19 12:17:18,724 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-19T12:17:19.368797782Z [err]  2025-12-19 12:17:18,724 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-19T12:17:19.368803626Z [err]  2025-12-19 12:17:18,938 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-19T12:17:19.368820134Z [err]  2025-12-19 12:17:18,939 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-19T12:17:19.368825325Z [err]  2025-12-19 12:17:18,983 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw/actions/playback_start "HTTP/1.1 200 OK"
2025-12-19T12:17:19.368830263Z [err]  2025-12-19 12:17:18,984 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: 7_bQ28TY6A (loop=True, overlay=True)
2025-12-19T12:17:19.368842916Z [err]  2025-12-19 12:17:18,984 - server - WARNING - ‚ö†Ô∏è Failed to start comfort noise: 'v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw'
2025-12-19T12:17:19.368849021Z [err]  2025-12-19 12:17:18,984 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.368854470Z [err]  2025-12-19 12:17:19,225 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:19.368861665Z [err]  2025-12-19 12:17:19,334 - server - INFO - üî§ RAW TOKENS: ["H"?]
2025-12-19T12:17:19.368867027Z [err]  2025-12-19 12:17:19,337 - calling_service - INFO - üîä Silence timer reset for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw (user started speaking)
2025-12-19T12:17:19.372990839Z [err]  2025-12-19 12:17:19,337 - calling_service - INFO - üë§ User started speaking for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.373002459Z [err]  2025-12-19 12:17:19,337 - server - INFO - üîç PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-19T12:17:19.373009220Z [inf]  100.64.0.9:43590 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-19T12:17:19.373016043Z [err]  2025-12-19 12:17:19,361 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw/actions/record_start "HTTP/1.1 200 OK"
2025-12-19T12:17:19.373021165Z [err]  2025-12-19 12:17:19,364 - server - INFO - üéôÔ∏è Call recording started for v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.373028018Z [err]  2025-12-19 12:17:19,364 - server - INFO - üîß Creating call session for v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw...
2025-12-19T12:17:19.373035762Z [err]  2025-12-19 12:17:19,364 - server - INFO - üîç Agent ID: 6944df147eadbccc46887cdf, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:17:19.373041536Z [err]  2025-12-19 12:17:19,364 - server - INFO - üîß Calling create_call_session() - START
2025-12-19T12:17:19.373047061Z [err]  2025-12-19 12:17:19,364 - calling_service - INFO - üîç Checking KB for agent 6944df147eadbccc46887cdf...
2025-12-19T12:17:19.987869909Z [err]  2025-12-19 12:17:19,479 - server - INFO - ‚è±Ô∏è [12:17:19.479] üìù FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-19T12:17:19.987878013Z [err]  2025-12-19 12:17:19,479 - server - INFO - ‚è±Ô∏è [12:17:19.479] STT endpoint detection latency: 6ms
2025-12-19T12:17:19.987883101Z [err]  2025-12-19 12:17:19,427 - server - INFO - üî§ RAW TOKENS: ["H"?, "ello"?]
2025-12-19T12:17:19.987886767Z [err]  2025-12-19 12:17:19,479 - server - INFO - ‚è±Ô∏è [12:17:19.479] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-19T12:17:19.987895389Z [err]  2025-12-19 12:17:19,427 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Hello' | Generating: False
2025-12-19T12:17:19.987896097Z [err]  2025-12-19 12:17:19,480 - redis_service - INFO - üì¶ Stored call data in Redis: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw (TTL: 3600s)
2025-12-19T12:17:19.987899310Z [err]  2025-12-19 12:17:19,490 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-19T12:17:19.987903289Z [err]  2025-12-19 12:17:19,450 - calling_service - INFO - üîç KB count query completed: 0 items
2025-12-19T12:17:19.987905992Z [err]  2025-12-19 12:17:19,480 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-19T12:17:19.987911210Z [err]  2025-12-19 12:17:19,461 - calling_service - INFO - üìã Built cached system prompt: 5480 chars (global) + 1402 chars (technical)
2025-12-19T12:17:19.987913780Z [err]  2025-12-19 12:17:19,491 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+17ms
2025-12-19T12:17:19.987917297Z [err]  2025-12-19 12:17:19,480 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:19.987921417Z [err]  2025-12-19 12:17:19,462 - calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-19T12:17:19.987924479Z [err]  2025-12-19 12:17:19,491 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 17ms (Soniox model: stt-rt-v3)
2025-12-19T12:17:19.987927080Z [err]  2025-12-19 12:17:19,480 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-19T12:17:19.987932761Z [err]  2025-12-19 12:17:19,478 - server - INFO - üî§ RAW TOKENS: ["H"‚úì, "ello"‚úì, "?"‚úì, "<end>"‚úì]
2025-12-19T12:17:19.987935537Z [err]  2025-12-19 12:17:19,491 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-19T12:17:19.987937046Z [err]  2025-12-19 12:17:19,490 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-19T12:17:19.987939063Z [err]  2025-12-19 12:17:19,478 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-19T12:17:19.987946338Z [err]  2025-12-19 12:17:19,490 - calling_service - INFO - üë§ User stopped speaking for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.987948403Z [err]  2025-12-19 12:17:19,478 - server - INFO - üßπ Cleaned transcript: 'H ello ?' -> 'Hello?'
2025-12-19T12:17:19.987952586Z [err]  2025-12-19 12:17:19,478 - server - INFO - üì• FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-19T12:17:19.987958527Z [err]  2025-12-19 12:17:19,478 - server - INFO - üé§ Soniox final transcript: 'Hello?'
2025-12-19T12:17:19.987965691Z [err]  2025-12-19 12:17:19,479 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:19.987970074Z [err]  2025-12-19 12:17:19,479 - server - INFO - üîç FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-19T12:17:19.987973978Z [err]  2025-12-19 12:17:19,479 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:19.987980327Z [err]  2025-12-19 12:17:19,479 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-19T12:17:19.991420678Z [err]  2025-12-19 12:17:19,491 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-19T12:17:19.991424953Z [err]  2025-12-19 12:17:19,491 - calling_service - INFO - ü§ñ Agent started speaking for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.991428567Z [err]  2025-12-19 12:17:19,548 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:19.991433472Z [err]  2025-12-19 12:17:19,558 - calling_service - INFO - ‚úÖ LLM client pre-warmed in 95ms
2025-12-19T12:17:19.991437804Z [err]  2025-12-19 12:17:19,558 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-19T12:17:19.991442194Z [err]  2025-12-19 12:17:19,558 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-19T12:17:19.991446468Z [err]  2025-12-19 12:17:19,566 - redis_service - INFO - üì¶ Stored call data in Redis: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw (TTL: 3600s)
2025-12-19T12:17:19.991451040Z [err]  2025-12-19 12:17:19,566 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-19T12:17:19.991455752Z [err]  2025-12-19 12:17:19,566 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-19T12:17:19.991460225Z [err]  2025-12-19 12:17:19,567 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.991464514Z [err]  2025-12-19 12:17:19,567 - server - INFO - ü§ñ AI session created for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:19.991476238Z [err]  2025-12-19 12:17:19,567 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-19T12:17:19.993586141Z [err]  2025-12-19 12:17:19,567 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-19T12:17:19.993597565Z [err]  2025-12-19 12:17:19,567 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-19T12:17:19.993604098Z [err]  2025-12-19 12:17:19,567 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-19T12:17:19.993611690Z [err]  2025-12-19 12:17:19,567 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-19T12:17:19.993619002Z [err]  2025-12-19 12:17:19,567 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-19T12:17:19.993625284Z [err]  2025-12-19 12:17:19,567 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-19T12:17:19.993631784Z [err]  2025-12-19 12:17:19,567 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-19T12:17:19.993638643Z [err]  2025-12-19 12:17:19,567 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-19T12:17:19.993646363Z [inf]  100.64.0.7:57388 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:19.993652831Z [err]  2025-12-19 12:17:19,580 - server - INFO - üìù Saved user transcript to database
2025-12-19T12:17:19.993657990Z [err]  2025-12-19 12:17:19,580 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:19.993662570Z [err]  2025-12-19 12:17:19,580 - calling_service - INFO - ‚è±Ô∏è [12:17:19.580] üì• process_user_input() ENTRY - text: 'Hello?...'
2025-12-19T12:17:19.993667985Z [err]  2025-12-19 12:17:19,580 - calling_service - INFO - ‚è±Ô∏è [12:17:19.580] ‚è© About to call _process_call_flow_streaming()
2025-12-19T12:17:19.993673794Z [err]  2025-12-19 12:17:19,580 - calling_service - INFO - ‚è±Ô∏è [12:17:19.580] üîÄ Agent type: call_flow, calling flow processor...
2025-12-19T12:17:19.996191821Z [err]  2025-12-19 12:17:19,580 - calling_service - INFO - ‚è±Ô∏è [12:17:19.580] üîÄ _process_call_flow_streaming() ENTRY
2025-12-19T12:17:19.996203853Z [err]  2025-12-19 12:17:19,580 - calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-19T12:17:19.996212159Z [err]  2025-12-19 12:17:19,580 - calling_service - INFO - ‚è±Ô∏è [12:17:19.580] ‚úÖ Node selected, about to process content...
2025-12-19T12:17:19.996220117Z [err]  2025-12-19 12:17:19,580 - calling_service - INFO - üîß Replaced {{now}} with Friday, December 19, 2025 at 7:17 AM EST in content
2025-12-19T12:17:19.996231214Z [err]  2025-12-19 12:17:19,580 - calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-19T12:17:19.996237668Z [err]  2025-12-19 12:17:19,580 - calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-19T12:17:19.996244623Z [err]  2025-12-19 12:17:19,580 - calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-19T12:17:19.996251371Z [err]  2025-12-19 12:17:19,580 - calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-19T12:17:19.996257987Z [err]  2025-12-19 12:17:19,580 - calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-19T12:17:19.996264442Z [err]  2025-12-19 12:17:19,581 - calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-19T12:17:19.996271401Z [err]  2025-12-19 12:17:19,581 - calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-19T12:17:19.996277550Z [err]  2025-12-19 12:17:19,581 - calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-19T12:17:19.996285328Z [err]  2025-12-19 12:17:19,581 - calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-19T12:17:19.996291057Z [err]  2025-12-19 12:17:19,581 - calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-19T12:17:19.999060239Z [err]  2025-12-19 12:17:19,581 - calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-19T12:17:19.999074609Z [err]  2025-12-19 12:17:19,581 - calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-19T12:17:19.999080726Z [err]  2025-12-19 12:17:19,581 - calling_service - INFO - ‚è±Ô∏è [12:17:19.581] üìÑ About to process content (mode=script, length=9)
2025-12-19T12:17:19.999088113Z [err]  2025-12-19 12:17:19,581 - calling_service - INFO - üì§ Streaming script as 1 sentence(s)
2025-12-19T12:17:19.999093083Z [err]  2025-12-19 12:17:19,581 - server - INFO - üì§ Sentence arrived from LLM: Kendrick?...
2025-12-19T12:17:19.999098879Z [err]  2025-12-19 12:17:19,581 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 90ms
2025-12-19T12:17:19.999105035Z [err]  2025-12-19 12:17:19,581 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-19T12:17:19.999110108Z [err]  2025-12-19 12:17:19,581 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:19.999116207Z [err]  2025-12-19 12:17:19,581 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-19T12:17:19.999121551Z [err]  2025-12-19 12:17:19,668 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:19.999127004Z [err]  2025-12-19 12:17:19,727 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:19.999131740Z [err]  2025-12-19 12:17:19,727 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:19.999138908Z [err]  2025-12-19 12:17:19,754 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:20.001414730Z [err]  2025-12-19 12:17:19,840 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:20.001422603Z [err]  2025-12-19 12:17:19,866 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-19T12:17:20.001441599Z [err]  2025-12-19 12:17:19,866 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-19T12:17:20.001448532Z [err]  2025-12-19 12:17:19,866 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-19T12:17:20.001454404Z [err]  2025-12-19 12:17:19,867 - persistent_tts_service - INFO - üîå [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Establishing persistent TTS WebSocket...
2025-12-19T12:17:20.001460663Z [err]  2025-12-19 12:17:19,867 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-19T12:17:20.001466422Z [err]  2025-12-19 12:17:19,867 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-19T12:17:20.001471693Z [err]  2025-12-19 12:17:19,867 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-19T12:17:20.009052976Z [err]  2025-12-19 12:17:20,003 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-19T12:17:20.009068540Z [err]  2025-12-19 12:17:20,004 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-19T12:17:20.009077781Z [err]  2025-12-19 12:17:20,004 - persistent_tts_service - INFO - ‚úÖ [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Persistent TTS WebSocket established
2025-12-19T12:17:20.009085708Z [err]  2025-12-19 12:17:20,004 - persistent_tts_service - INFO - üéß [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Audio receiver loop started
2025-12-19T12:17:20.009094019Z [err]  2025-12-19 12:17:20,004 - persistent_tts_service - INFO - üîä [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Comfort noise loop started
2025-12-19T12:17:20.009102225Z [err]  2025-12-19 12:17:20,004 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:20.009109883Z [err]  2025-12-19 12:17:20,004 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-19T12:17:20.009117233Z [err]  2025-12-19 12:17:20,004 - server - INFO - üîç Persistent TTS lookup: call_id=v3:JfW00dj0CYnk2SRNr..., session=FOUND
2025-12-19T12:17:20.009129188Z [err]  2025-12-19 12:17:20,004 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-19T12:17:20.009141055Z [err]  2025-12-19 12:17:20,004 - server - INFO - üéµ TTS task #1 started at +423ms
2025-12-19T12:17:20.009149839Z [err]  2025-12-19 12:17:20,004 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 513ms
2025-12-19T12:17:20.009157057Z [err]  2025-12-19 12:17:20,004 - calling_service - INFO - üì§ Streamed script sentence 1/1: Kendrick?...
2025-12-19T12:17:20.009164617Z [err]  2025-12-19 12:17:20,004 - calling_service - INFO - üîä Silence tracking reset for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw (user responded)
2025-12-19T12:17:20.014009905Z [err]  2025-12-19 12:17:20,005 - persistent_tts_service - INFO - üîä [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Starting comfort noise loop
2025-12-19T12:17:20.014019709Z [err]  2025-12-19 12:17:20,005 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-19T12:17:20.014036776Z [err]  2025-12-19 12:17:20,004 - calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-19T12:17:20.014043818Z [err]  2025-12-19 12:17:20,004 - calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-19T12:17:20.014051237Z [err]  2025-12-19 12:17:20,004 - calling_service - INFO - LLM response (0.42s): Kendrick?
2025-12-19T12:17:20.014058410Z [err]  2025-12-19 12:17:20,005 - calling_service - INFO - Total latency: 0.42s
2025-12-19T12:17:20.014066492Z [err]  2025-12-19 12:17:20,005 - server - INFO - ‚úÖ LLM finished in 513ms, TTS tasks already running in background
2025-12-19T12:17:20.014074389Z [err]  2025-12-19 12:17:20,005 - server - INFO - üéµ Streaming 1 TTS chunks as they complete...
2025-12-19T12:17:20.014085195Z [err]  2025-12-19 12:17:20,005 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-19T12:17:20.014092544Z [err]  2025-12-19 12:17:20,005 - server - INFO -    1 sentences queued and playing seamlessly
2025-12-19T12:17:20.014100370Z [err]  2025-12-19 12:17:20,005 - persistent_tts_service - INFO - üéµ [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Playback consumer started
2025-12-19T12:17:20.014110801Z [err]  2025-12-19 12:17:20,005 - persistent_tts_service - INFO - üéß [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Audio Receiver Loop STARTED
2025-12-19T12:17:20.014119141Z [err]  2025-12-19 12:17:20,005 - persistent_tts_service - INFO - üíì [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Starting TTS keep-alive loop (every 15s)
2025-12-19T12:17:20.898511257Z [err]  2025-12-19 12:17:20,726 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-19T12:17:21.136228652Z [err]  2025-12-19 12:17:21,134 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-19T12:17:21.139001010Z [err]  2025-12-19 12:17:21,135 - persistent_tts_service - INFO - üé§ [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Streaming sentence #1: Kendrick?...
2025-12-19T12:17:21.139007681Z [err]  2025-12-19 12:17:21,135 - persistent_tts_service - INFO - üöÄ [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-19T12:17:21.139011881Z [err]  2025-12-19 12:17:21,135 - persistent_tts_service - INFO - üìä [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-19T12:17:21.139016251Z [err]  2025-12-19 12:17:21,137 - persistent_tts_service - INFO - üéß [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Receiver processing sentence #1: 'Kendrick?...'
2025-12-19T12:17:21.139023061Z [err]  2025-12-19 12:17:21,137 - persistent_tts_service - INFO - üìä [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] DIAGNOSTIC: queue_latency=1ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-19T12:17:21.143437395Z [err]  2025-12-19 12:17:21,138 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:21.143444853Z [err]  2025-12-19 12:17:21,138 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': '176c64ab-b5dd-42d9-b3ab-4ac2311846dd', 'occurred_at': '2025-12-19T12:17:20.503966Z', 'payload': {'call_control_id': 'v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw', 'call_leg_id': 'a65ffa4c-dcd4-11f0-a8de-02420aef971f', 'call_session_id': 'a65d397e-dcd4-11f0-be1a-02420aef971f', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:21.143449812Z [err]  2025-12-19 12:17:21,138 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:21.143456887Z [err]  2025-12-19 12:17:21,138 - server - INFO - üì® ================================================
2025-12-19T12:17:21.143464507Z [inf]  100.64.0.8:46680 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:21.145993743Z [err]  2025-12-19 12:17:21,143 - redis_service - INFO - üì• Retrieved call data from Redis: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:21.149308636Z [err]  2025-12-19 12:17:21,145 - redis_service - INFO - üì¶ Stored call data in Redis: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw (TTL: 3600s)
2025-12-19T12:17:21.149316728Z [err]  2025-12-19 12:17:21,145 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-19T12:17:21.149323962Z [err]  2025-12-19 12:17:21,145 - calling_service - INFO - ‚è±Ô∏è [12:17:21.145] üì• process_user_input() ENTRY - text: '...'
2025-12-19T12:17:21.149331888Z [err]  2025-12-19 12:17:21,145 - calling_service - INFO - ‚è±Ô∏è [12:17:21.145] ‚è© About to call _process_call_flow_streaming()
2025-12-19T12:17:21.149341085Z [err]  2025-12-19 12:17:21,145 - calling_service - INFO - ‚è±Ô∏è [12:17:21.145] üîÄ Agent type: call_flow, calling flow processor...
2025-12-19T12:17:21.149348266Z [err]  2025-12-19 12:17:21,145 - calling_service - INFO - ‚è±Ô∏è [12:17:21.145] üîÄ _process_call_flow_streaming() ENTRY
2025-12-19T12:17:21.149355179Z [err]  2025-12-19 12:17:21,145 - calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-19T12:17:21.149361898Z [err]  2025-12-19 12:17:21,145 - calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-19T12:17:21.149368657Z [err]  2025-12-19 12:17:21,145 - calling_service - INFO - ‚è±Ô∏è [12:17:21.145] üîÄ About to call _follow_transition() for: ...
2025-12-19T12:17:21.149373645Z [err]  2025-12-19 12:17:21,145 - calling_service - INFO - Evaluating transitions from Greeting for message: 
2025-12-19T12:17:21.160942652Z [err]  2025-12-19 12:17:21,154 - calling_service - INFO - ‚è±Ô∏è [12:17:21.154] üîÄ TRANSITION EVALUATION START - Calling LLM for 4 options
2025-12-19T12:17:21.160954619Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚úÖ All 1 persistent TTS streams completed
2025-12-19T12:17:21.160961451Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-19T12:17:21.160967047Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 1666ms from user stop üöÄ
2025-12-19T12:17:21.160972452Z [err]  2025-12-19 12:17:21,157 - calling_service - INFO - ü§ñ Agent started speaking for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:21.160981137Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-19T12:17:21.160986314Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-19T12:17:21.160991111Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-19T12:17:21.160996128Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 17ms (provider: soniox, model: stt-rt-v3)
2025-12-19T12:17:21.161002048Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 513ms (provider: grok, model: grok-4-fast-non-reasoning)
2025-12-19T12:17:21.161007719Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 1575ms (provider: elevenlabs, websocket: False)
2025-12-19T12:17:21.161014383Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 1666ms (user stopped ‚Üí play_audio_url called)
2025-12-19T12:17:21.161019217Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-19T12:17:21.163448600Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-19T12:17:21.163462322Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-19T12:17:21.163468768Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-19T12:17:21.163474031Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-19T12:17:21.163479083Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 1966ms estimated
2025-12-19T12:17:21.163487586Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 9 chars, 1 sentences
2025-12-19T12:17:21.163493425Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Hello?...'
2025-12-19T12:17:21.163498148Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: 'Kendrick?...'
2025-12-19T12:17:21.163503188Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-19T12:17:21.163508367Z [err]  2025-12-19 12:17:21,157 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-19T12:17:21.873130354Z [err]  2025-12-19 12:17:21,417 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 282ms
2025-12-19T12:17:21.873138014Z [err]  2025-12-19 12:17:21,417 - persistent_tts_service - INFO - üì§ Sending 6671 bytes of audio (42 chunks, 0.8s duration) via WebSocket
2025-12-19T12:17:21.873157428Z [err]  2025-12-19 12:17:21,417 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-19T12:17:21.873165750Z [err]  2025-12-19 12:17:21,417 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +0.8s (total: 0.8s from now)
2025-12-19T12:17:21.873173834Z [err]  2025-12-19 12:17:21,418 - persistent_tts_service - INFO - ‚úÖ Sent 42 audio chunks via WebSocket
2025-12-19T12:17:21.873187693Z [err]  2025-12-19 12:17:21,504 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 1030ms)
2025-12-19T12:17:21.873187903Z [err]  2025-12-19 12:17:21,683 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '0f78dbcc-0583-4b0a-be9c-9fe8f7857936', 'occurred_at': '2025-12-19T12:17:21.523970Z', 'payload': {'call_control_id': 'v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw', 'call_leg_id': 'a65ffa4c-dcd4-11f0-a8de-02420aef971f', 'call_session_id': 'a65d397e-dcd4-11f0-be1a-02420aef971f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': '7_bQ28TY6A', 'start_time': '2025-12-19T12:17:21.523970Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:21.873194912Z [err]  2025-12-19 12:17:21,505 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-19T12:17:21.873201361Z [err]  2025-12-19 12:17:21,504 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-19T12:17:21.873209138Z [inf]  100.64.0.7:57388 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:21.873217806Z [err]  2025-12-19 12:17:21,683 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:21.877414924Z [err]  2025-12-19 12:17:21,683 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:21.877420237Z [err]  2025-12-19 12:17:21,683 - server - INFO - üì® ================================================
2025-12-19T12:17:22.143607202Z [err]  2025-12-19 12:17:22,138 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-19T12:17:22.151355797Z [err]  2025-12-19 12:17:22,148 - calling_service - INFO - ‚è±Ô∏è [12:17:22.148] üîÄ TRANSITION EVALUATION COMPLETE - took 994ms
2025-12-19T12:17:22.151361155Z [err]  2025-12-19 12:17:22,148 - calling_service - INFO - ü§ñ AI transition decision: '-1'
2025-12-19T12:17:22.151366691Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - ‚è±Ô∏è [12:17:22.149] ‚úÖ Node selected, about to process content...
2025-12-19T12:17:22.151366941Z [err]  2025-12-19 12:17:22,148 - calling_service - INFO - üìä Available transitions: ['Confirms name (Yes|Speaking|This is he/she|etc)...', 'Wrong number (No John here|Wrong number|etc) - don...', "The customer says let's set an appointment....", "Let's talk about my inances..."]
2025-12-19T12:17:22.151372806Z [err]  2025-12-19 12:17:22,148 - calling_service - INFO - Selected transition index: -1
2025-12-19T12:17:22.151377039Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - üîß Replaced {{now}} with Friday, December 19, 2025 at 7:17 AM EST in content
2025-12-19T12:17:22.151379424Z [err]  2025-12-19 12:17:22,148 - calling_service - INFO - No specific condition matched, looking for default transition...
2025-12-19T12:17:22.151387592Z [err]  2025-12-19 12:17:22,148 - calling_service - INFO - ‚ö†Ô∏è No transition matched, but node has GOAL. Staying on current node to continue with goal-based guidance.
2025-12-19T12:17:22.151388475Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-19T12:17:22.151394722Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - üéØ Goal: Say the customer's name...
2025-12-19T12:17:22.151394753Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-19T12:17:22.151401164Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 1003ms
2025-12-19T12:17:22.151401359Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-19T12:17:22.155328832Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-19T12:17:22.155339648Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-19T12:17:22.155346897Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-19T12:17:22.155356212Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-19T12:17:22.155361963Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-19T12:17:22.155367575Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-19T12:17:22.155373322Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-19T12:17:22.155378187Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-19T12:17:22.155382665Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-19T12:17:22.155388230Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - ‚è±Ô∏è [12:17:22.149] üìÑ About to process content (mode=script, length=9)
2025-12-19T12:17:22.155392835Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - ‚è≠Ô∏è Staying on same script node without dynamic_rephrase - NOT re-speaking content
2025-12-19T12:17:22.155397419Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - üîä Silence tracking reset for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw (user responded)
2025-12-19T12:17:22.155402116Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-19T12:17:22.158017574Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-19T12:17:22.158028318Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - LLM response (1.00s): 
2025-12-19T12:17:22.158032971Z [err]  2025-12-19 12:17:22,149 - calling_service - INFO - Total latency: 1.00s
2025-12-19T12:17:22.158037837Z [err]  2025-12-19 12:17:22,149 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: 
2025-12-19T12:17:22.243198276Z [err]  2025-12-19 12:17:22,240 - redis_service - INFO - üì• Retrieved call data from Redis: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:22.243205682Z [err]  2025-12-19 12:17:22,240 - telnyx_service - WARNING - ‚ö†Ô∏è  Text is empty after SSML cleaning, skipping TTS
2025-12-19T12:17:22.243210966Z [err]  2025-12-19 12:17:22,240 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-19T12:17:22.243215470Z [err]  2025-12-19 12:17:22,240 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-19T12:17:23.077977348Z [err]  2025-12-19 12:17:22,419 - persistent_tts_service - INFO - üîá [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] FLOOR RELEASED (is_holding_floor=False)
2025-12-19T12:17:23.077984299Z [err]  2025-12-19 12:17:22,660 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (0.4s ago), marking agent as done speaking
2025-12-19T12:17:23.077988626Z [err]  2025-12-19 12:17:22,660 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146642.660325 for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:23.077993226Z [err]  2025-12-19 12:17:22,660 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:24.033099071Z [err]  2025-12-19 12:17:23,418 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-19T12:17:24.033104893Z [err]  2025-12-19 12:17:23,418 - persistent_tts_service - INFO - ‚úÖ [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Receiver finished sentence #1: 1 chunks in 2282ms
2025-12-19T12:17:24.033111184Z [err]  2025-12-19 12:17:23,732 - server - INFO - üì§ Audio flowing: 303 packets sent to Soniox (5s update)
2025-12-19T12:17:25.149081989Z [err]  2025-12-19 12:17:25,147 - server - INFO - üî§ RAW TOKENS: [" Ye"?]
2025-12-19T12:17:25.149088456Z [err]  2025-12-19 12:17:25,147 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user started speaking) for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:25.149093436Z [err]  2025-12-19 12:17:25,147 - calling_service - INFO - üîä Silence timer reset for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw (user started speaking)
2025-12-19T12:17:25.149097855Z [err]  2025-12-19 12:17:25,147 - calling_service - INFO - üë§ User started speaking for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:25.149102548Z [err]  2025-12-19 12:17:25,147 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Ye' | Generating: False
2025-12-19T12:17:25.264287545Z [err]  2025-12-19 12:17:25,258 - server - INFO - üî§ RAW TOKENS: [" Ye"‚úì, "ah."‚úì, "<end>"‚úì]
2025-12-19T12:17:25.264302572Z [err]  2025-12-19 12:17:25,258 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-19T12:17:25.264311947Z [err]  2025-12-19 12:17:25,259 - server - INFO - üßπ Cleaned transcript: ' Ye ah.' -> 'Yeah.'
2025-12-19T12:17:25.264320242Z [err]  2025-12-19 12:17:25,259 - server - INFO - üì• FINAL TOKENS: 'Yeah.' (2 tokens)
2025-12-19T12:17:25.264328033Z [err]  2025-12-19 12:17:25,259 - server - INFO - üé§ Soniox final transcript: 'Yeah.'
2025-12-19T12:17:25.264336712Z [err]  2025-12-19 12:17:25,259 - server - INFO - üîç FILTER CHECK: words=1, is_filler=True, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-19T12:17:25.264344972Z [err]  2025-12-19 12:17:25,259 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-19T12:17:25.264352011Z [err]  2025-12-19 12:17:25,259 - server - INFO - ‚è±Ô∏è [12:17:25.259] üìù FINAL TRANSCRIPT RECEIVED: 'Yeah.'
2025-12-19T12:17:25.264363605Z [err]  2025-12-19 12:17:25,259 - server - INFO - ‚è±Ô∏è [12:17:25.259] STT endpoint detection latency: 2ms
2025-12-19T12:17:25.264372154Z [err]  2025-12-19 12:17:25,259 - server - INFO - ‚è±Ô∏è [12:17:25.259] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-19T12:17:25.264379838Z [err]  2025-12-19 12:17:25,260 - redis_service - INFO - üì¶ Stored call data in Redis: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw (TTL: 3600s)
2025-12-19T12:17:25.264388511Z [err]  2025-12-19 12:17:25,260 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-19T12:17:25.264395251Z [err]  2025-12-19 12:17:25,260 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Yeah.' - Processing...
2025-12-19T12:17:25.273699089Z [err]  2025-12-19 12:17:25,270 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Yeah.
2025-12-19T12:17:25.273772611Z [err]  2025-12-19 12:17:25,270 - calling_service - INFO - üë§ User stopped speaking for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:25.277793665Z [err]  2025-12-19 12:17:25,273 - server - INFO - ‚úÖ User starting new turn - resetting agent speaking flag
2025-12-19T12:17:25.277802844Z [err]  2025-12-19 12:17:25,273 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-19T12:17:25.277810272Z [err]  2025-12-19 12:17:25,273 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+16ms
2025-12-19T12:17:25.277818149Z [err]  2025-12-19 12:17:25,273 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 16ms (Soniox model: stt-rt-v3)
2025-12-19T12:17:25.277825922Z [err]  2025-12-19 12:17:25,273 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-19T12:17:25.277843008Z [err]  2025-12-19 12:17:25,273 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-19T12:17:25.277856240Z [err]  2025-12-19 12:17:25,273 - calling_service - INFO - ü§ñ Agent started speaking for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:25.367108077Z [err]  2025-12-19 12:17:25,363 - server - INFO - üìù Saved user transcript to database
2025-12-19T12:17:25.367135162Z [err]  2025-12-19 12:17:25,363 - calling_service - INFO - ‚è±Ô∏è [12:17:25.363] üì• process_user_input() ENTRY - text: 'Yeah....'
2025-12-19T12:17:25.367143099Z [err]  2025-12-19 12:17:25,363 - calling_service - INFO - ‚è±Ô∏è [12:17:25.363] ‚è© About to call _process_call_flow_streaming()
2025-12-19T12:17:25.367149273Z [err]  2025-12-19 12:17:25,363 - calling_service - INFO - ‚è±Ô∏è [12:17:25.363] üîÄ Agent type: call_flow, calling flow processor...
2025-12-19T12:17:25.367154828Z [err]  2025-12-19 12:17:25,363 - calling_service - INFO - ‚è±Ô∏è [12:17:25.363] üîÄ _process_call_flow_streaming() ENTRY
2025-12-19T12:17:25.367160827Z [err]  2025-12-19 12:17:25,363 - calling_service - INFO - Flow processing - History length: 5, Is first: False
2025-12-19T12:17:25.367167681Z [err]  2025-12-19 12:17:25,363 - calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-19T12:17:25.367173890Z [err]  2025-12-19 12:17:25,363 - calling_service - INFO - ‚è±Ô∏è [12:17:25.363] üîÄ About to call _follow_transition() for: Yeah....
2025-12-19T12:17:25.367179389Z [err]  2025-12-19 12:17:25,363 - calling_service - INFO - Evaluating transitions from Greeting for message: Yeah.
2025-12-19T12:17:25.373568846Z [err]  2025-12-19 12:17:25,372 - calling_service - INFO - ‚è±Ô∏è [12:17:25.372] üîÄ TRANSITION EVALUATION START - Calling LLM for 4 options
2025-12-19T12:17:25.910798622Z [err]  2025-12-19 12:17:25,801 - calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-19T12:17:25.910807591Z [err]  2025-12-19 12:17:25,801 - calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-19T12:17:25.910808074Z [err]  2025-12-19 12:17:25,801 - calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-19T12:17:25.910817519Z [err]  2025-12-19 12:17:25,801 - calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-19T12:17:25.910821929Z [err]  2025-12-19 12:17:25,802 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 528ms
2025-12-19T12:17:25.910825672Z [err]  2025-12-19 12:17:25,801 - calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-19T12:17:25.910831005Z [err]  2025-12-19 12:17:25,802 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-19T12:17:25.910835210Z [err]  2025-12-19 12:17:25,802 - calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-19T12:17:25.910839094Z [err]  2025-12-19 12:17:25,802 - server - INFO - üîç Persistent TTS lookup: call_id=v3:JfW00dj0CYnk2SRNr..., session=FOUND
2025-12-19T12:17:25.910845053Z [err]  2025-12-19 12:17:25,802 - calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 89 chars) - will return text instantly
2025-12-19T12:17:25.910855783Z [err]  2025-12-19 12:17:25,802 - calling_service - INFO - Using flow node: Node Prompt: N001B_IntroAndHelpRequest_Only (V3 - Follows Name Confirmation) (type: conversation, mode: script)
2025-12-19T12:17:25.910865070Z [err]  2025-12-19 12:17:25,802 - calling_service - INFO - ‚è±Ô∏è [12:17:25.802] üìÑ About to process content (mode=script, length=89)
2025-12-19T12:17:25.910903937Z [err]  2025-12-19 12:17:25,802 - calling_service - INFO - üì§ Streaming script as 2 sentence(s)
2025-12-19T12:17:25.910914291Z [err]  2025-12-19 12:17:25,802 - server - INFO - üì§ Sentence arrived from LLM: This is Jake......
2025-12-19T12:17:25.910932153Z [err]  2025-12-19 12:17:25,668 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - response generation still in progress
2025-12-19T12:17:25.910936887Z [err]  2025-12-19 12:17:25,800 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-19T12:17:25.910941323Z [err]  2025-12-19 12:17:25,801 - calling_service - INFO - ‚è±Ô∏è [12:17:25.801] üîÄ TRANSITION EVALUATION COMPLETE - took 429ms
2025-12-19T12:17:25.910945604Z [err]  2025-12-19 12:17:25,801 - calling_service - INFO - ü§ñ AI transition decision: '0'
2025-12-19T12:17:25.910949803Z [err]  2025-12-19 12:17:25,801 - calling_service - INFO - üìä Available transitions: ['Confirms name (Yes|Speaking|This is he/she|etc)...', 'Wrong number (No John here|Wrong number|etc) - don...', "The customer says let's set an appointment....", "Let's talk about my inances..."]
2025-12-19T12:17:25.910954586Z [err]  2025-12-19 12:17:25,801 - calling_service - INFO - Selected transition index: 0
2025-12-19T12:17:25.910959251Z [err]  2025-12-19 12:17:25,801 - calling_service - INFO - Transition: Greeting -> Node Prompt: N001B_IntroAndHelpRequest_Only (V3 - Follows Name Confirmation)
2025-12-19T12:17:25.910963841Z [err]  2025-12-19 12:17:25,801 - calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 438ms
2025-12-19T12:17:25.910968175Z [err]  2025-12-19 12:17:25,801 - calling_service - INFO - ‚è±Ô∏è [12:17:25.801] ‚úÖ Node selected, about to process content...
2025-12-19T12:17:25.910972183Z [err]  2025-12-19 12:17:25,801 - calling_service - INFO - üîß Replaced {{now}} with Friday, December 19, 2025 at 7:17 AM EST in content
2025-12-19T12:17:25.910977274Z [err]  2025-12-19 12:17:25,801 - calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-19T12:17:25.910981305Z [err]  2025-12-19 12:17:25,801 - calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-19T12:17:25.910985476Z [err]  2025-12-19 12:17:25,801 - calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-19T12:17:25.913398565Z [err]  2025-12-19 12:17:25,802 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-19T12:17:25.913409265Z [err]  2025-12-19 12:17:25,802 - server - INFO - üéµ TTS task #1 started at +0ms
2025-12-19T12:17:25.913426247Z [err]  2025-12-19 12:17:25,802 - calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-19T12:17:25.913427099Z [err]  2025-12-19 12:17:25,802 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 528ms
2025-12-19T12:17:25.913462531Z [err]  2025-12-19 12:17:25,802 - calling_service - INFO - üì§ Streamed script sentence 2/2: I was just, um, wondering if you could possibly he...
2025-12-19T12:17:25.913471052Z [err]  2025-12-19 12:17:25,802 - calling_service - INFO - üíæ Storing node ID 1763159750250 in conversation history
2025-12-19T12:17:25.913475830Z [err]  2025-12-19 12:17:25,802 - calling_service - INFO - üì§ Streamed script sentence 1/2: This is Jake......
2025-12-19T12:17:25.913479165Z [err]  2025-12-19 12:17:25,802 - calling_service - INFO - LLM response (0.44s): This is Jake... I was just, um, wondering if you could possibly help me out for a moment?
2025-12-19T12:17:25.913484613Z [err]  2025-12-19 12:17:25,802 - server - INFO - üì§ Sentence arrived from LLM: I was just, um, wondering if you could possibly he...
2025-12-19T12:17:25.913491760Z [err]  2025-12-19 12:17:25,802 - calling_service - INFO - üîä Silence tracking reset for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw (user responded)
2025-12-19T12:17:25.913497716Z [err]  2025-12-19 12:17:25,802 - calling_service - INFO - Total latency: 0.44s
2025-12-19T12:17:25.913519761Z [err]  2025-12-19 12:17:25,802 - server - INFO - üîç Persistent TTS lookup: call_id=v3:JfW00dj0CYnk2SRNr..., session=FOUND
2025-12-19T12:17:25.913530905Z [err]  2025-12-19 12:17:25,802 - server - INFO - üöÄ Streaming sentence #2 via persistent WebSocket
2025-12-19T12:17:25.913538537Z [err]  2025-12-19 12:17:25,802 - server - INFO - üéµ TTS task #2 started at +0ms
2025-12-19T12:17:25.915417020Z [err]  2025-12-19 12:17:25,802 - server - INFO -    2 sentences queued and playing seamlessly
2025-12-19T12:17:25.915424955Z [err]  2025-12-19 12:17:25,802 - persistent_tts_service - INFO - üé§ [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Streaming sentence #2: This is Jake......
2025-12-19T12:17:25.915431118Z [err]  2025-12-19 12:17:25,802 - persistent_tts_service - INFO - üöÄ [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Sent sentence #2 (NON-BLOCKING) in 0ms
2025-12-19T12:17:25.915437779Z [err]  2025-12-19 12:17:25,802 - persistent_tts_service - INFO - üìä [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-19T12:17:25.915443624Z [err]  2025-12-19 12:17:25,802 - persistent_tts_service - INFO - üé§ [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Streaming sentence #3: I was just, um, wondering if you could possibly he...
2025-12-19T12:17:25.915451291Z [err]  2025-12-19 12:17:25,803 - persistent_tts_service - INFO - üöÄ [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Sent sentence #3 (NON-BLOCKING) in 0ms
2025-12-19T12:17:25.915458365Z [err]  2025-12-19 12:17:25,803 - persistent_tts_service - INFO - üìä [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] DIAGNOSTIC: pending_sentences=2, audio_queue=0, is_first=False, is_last=False
2025-12-19T12:17:25.915464382Z [err]  2025-12-19 12:17:25,803 - persistent_tts_service - INFO - üéß [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Receiver processing sentence #2: 'This is Jake......'
2025-12-19T12:17:25.915508314Z [err]  2025-12-19 12:17:25,802 - server - INFO - ‚úÖ LLM finished in 528ms, TTS tasks already running in background
2025-12-19T12:17:25.915515156Z [err]  2025-12-19 12:17:25,802 - server - INFO - üéµ Streaming 2 TTS chunks as they complete...
2025-12-19T12:17:25.915520518Z [err]  2025-12-19 12:17:25,802 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-19T12:17:25.917557206Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 1ms (provider: elevenlabs, websocket: False)
2025-12-19T12:17:25.917591424Z [err]  2025-12-19 12:17:25,803 - persistent_tts_service - INFO - üìä [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] DIAGNOSTIC: queue_latency=0ms, pending_sentences=1, audio_queue=0, interrupted=False
2025-12-19T12:17:25.917602733Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚úÖ All 2 persistent TTS streams completed
2025-12-19T12:17:25.917611418Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-19T12:17:25.917618967Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 529ms from user stop üöÄ
2025-12-19T12:17:25.917626052Z [err]  2025-12-19 12:17:25,803 - calling_service - INFO - ü§ñ Agent started speaking for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:25.917633013Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-19T12:17:25.917644911Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-19T12:17:25.917652302Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-19T12:17:25.917659861Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 16ms (provider: soniox, model: stt-rt-v3)
2025-12-19T12:17:25.917666381Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 528ms (provider: grok, model: grok-4-fast-non-reasoning)
2025-12-19T12:17:25.917932483Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 529ms (user stopped ‚Üí play_audio_url called)
2025-12-19T12:17:25.917942452Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-19T12:17:25.919415058Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-19T12:17:25.919426069Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-19T12:17:25.919433728Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-19T12:17:25.919442409Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-19T12:17:25.919450784Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 829ms estimated
2025-12-19T12:17:25.919458699Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 89 chars, 2 sentences
2025-12-19T12:17:25.919467659Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Yeah....'
2025-12-19T12:17:25.919478302Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: 'This is Jake... I was just, um, wondering if you could possi...'
2025-12-19T12:17:25.919486110Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-19T12:17:25.919494709Z [err]  2025-12-19 12:17:25,803 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-19T12:17:25.987188942Z [err]  2025-12-19 12:17:25,982 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Node Prompt: N001B_IntroAndHelpRequest_Only (V3 - Follows Name Confirmation), Dead Air: 545ms)
2025-12-19T12:17:25.987199887Z [err]  2025-12-19 12:17:25,982 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-19T12:17:25.987206881Z [err]  2025-12-19 12:17:25,982 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-19T12:17:26.089635713Z [err]  2025-12-19 12:17:26,078 - persistent_tts_service - INFO - üì§ Sending 8174 bytes of audio (52 chunks, 1.0s duration) via WebSocket
2025-12-19T12:17:26.089642871Z [err]  2025-12-19 12:17:26,078 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-19T12:17:26.089647191Z [err]  2025-12-19 12:17:26,078 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.0s (total: 1.0s from now)
2025-12-19T12:17:26.089651386Z [err]  2025-12-19 12:17:26,079 - persistent_tts_service - INFO - ‚úÖ Sent 52 audio chunks via WebSocket
2025-12-19T12:17:26.346038653Z [err]  2025-12-19 12:17:26,342 - persistent_tts_service - INFO - üì§ Sending 13792 bytes of audio (87 chunks, 1.7s duration) via WebSocket
2025-12-19T12:17:26.346045724Z [err]  2025-12-19 12:17:26,342 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-19T12:17:26.346050764Z [err]  2025-12-19 12:17:26,342 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.7s (total: 2.5s from now)
2025-12-19T12:17:26.346056618Z [err]  2025-12-19 12:17:26,344 - persistent_tts_service - INFO - ‚úÖ Sent 87 audio chunks via WebSocket
2025-12-19T12:17:26.348826809Z [err]  2025-12-19 12:17:26,345 - persistent_tts_service - INFO - üì§ Sending 2555 bytes of audio (16 chunks, 0.3s duration) via WebSocket
2025-12-19T12:17:26.348834693Z [err]  2025-12-19 12:17:26,345 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-19T12:17:26.348839611Z [err]  2025-12-19 12:17:26,345 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +0.3s (total: 2.8s from now)
2025-12-19T12:17:26.348844425Z [err]  2025-12-19 12:17:26,345 - persistent_tts_service - INFO - ‚úÖ Sent 16 audio chunks via WebSocket
2025-12-19T12:17:26.935367824Z [err]  2025-12-19 12:17:26,527 - persistent_tts_service - INFO - üì§ Sending 20433 bytes of audio (128 chunks, 2.6s duration) via WebSocket
2025-12-19T12:17:26.935375101Z [err]  2025-12-19 12:17:26,527 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-19T12:17:26.935382216Z [err]  2025-12-19 12:17:26,527 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +2.6s (total: 5.2s from now)
2025-12-19T12:17:26.935390001Z [err]  2025-12-19 12:17:26,529 - persistent_tts_service - INFO - ‚úÖ Sent 128 audio chunks via WebSocket
2025-12-19T12:17:28.042330319Z [err]  2025-12-19 12:17:27,894 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 503 total packets
2025-12-19T12:17:28.042336611Z [err]  [2025-12-19 12:17:27 +0000] [4] [INFO] connection closed
2025-12-19T12:17:28.117912111Z [err]  2025-12-19 12:17:28,115 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:28.117922344Z [err]  2025-12-19 12:17:28,115 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': 'c89a3f34-ce77-4897-81a9-3f6174d2251a', 'occurred_at': '2025-12-19T12:17:27.783790Z', 'payload': {'call_control_id': 'v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw', 'call_leg_id': 'a65ffa4c-dcd4-11f0-a8de-02420aef971f', 'call_session_id': 'a65d397e-dcd4-11f0-be1a-02420aef971f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '1c289781-c959-455a-a055-814e7b24c296', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:28.117928543Z [err]  2025-12-19 12:17:28,115 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:28.117934172Z [err]  2025-12-19 12:17:28,115 - server - INFO - üì® ================================================
2025-12-19T12:17:28.117942577Z [inf]  100.64.0.7:57388 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:28.263776418Z [err]  2025-12-19 12:17:28,250 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:28.263789976Z [err]  2025-12-19 12:17:28,250 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': '3d4555d8-3a0b-4b91-8c57-1524ac037d43', 'occurred_at': '2025-12-19T12:17:27.643968Z', 'payload': {'call_control_id': 'v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw', 'call_leg_id': 'a65ffa4c-dcd4-11f0-a8de-02420aef971f', 'call_quality_stats': {'inbound': {'jitter_max_variance': '0.01', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '561', 'skip_packet_count': '12'}, 'outbound': {'packet_count': '504', 'skip_packet_count': '0'}}, 'call_session_id': 'a65d397e-dcd4-11f0-be1a-02420aef971f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-19T12:17:27.643968Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-19T12:17:13.303968Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:28.263803901Z [err]  2025-12-19 12:17:28,250 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:28.263810438Z [err]  2025-12-19 12:17:28,250 - server - INFO - üì® ================================================
2025-12-19T12:17:28.263817354Z [err]  2025-12-19 12:17:28,250 - server - INFO - üìû Call ended: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:28.263923955Z [err]  2025-12-19 12:17:28,251 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-19T12:17:28.268654022Z [err]  2025-12-19 12:17:28,263 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:28.268667585Z [err]  2025-12-19 12:17:28,263 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '6c4184b0-fb65-4a54-ac77-e6c332b3eea4', 'occurred_at': '2025-12-19T12:17:27.723967Z', 'payload': {'call_control_id': 'v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw', 'call_leg_id': 'a65ffa4c-dcd4-11f0-a8de-02420aef971f', 'call_session_id': 'a65d397e-dcd4-11f0-be1a-02420aef971f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-19T12:17:27.723967Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': '7_bQ28TY6A', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:28.268674087Z [err]  2025-12-19 12:17:28,263 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:28.268680176Z [err]  2025-12-19 12:17:28,264 - server - INFO - üì® ================================================
2025-12-19T12:17:28.272045709Z [err]  2025-12-19 12:17:28,267 - redis_service - INFO - ‚ûñ Removed playback 7_bQ28TY6A, 0 remaining for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:28.272051407Z [err]  2025-12-19 12:17:28,268 - server - INFO - üîä Redis: Removed playback 7_bQ28TY6A, 0 remaining
2025-12-19T12:17:28.272056827Z [err]  2025-12-19 12:17:28,268 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-19T12:17:28.272063026Z [err]  2025-12-19 12:17:28,269 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-19T12:17:28.272068508Z [err]  2025-12-19 12:17:28,269 - server - INFO - ‚úÖ Found session in active_telnyx_calls (local worker)
2025-12-19T12:17:28.272073510Z [err]  2025-12-19 12:17:28,269 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146648.2696013 for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:28.272078617Z [err]  2025-12-19 12:17:28,269 - server - INFO - ‚è±Ô∏è Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-19T12:17:28.272083698Z [inf]  100.64.0.7:57388 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:29.152044351Z [err]  2025-12-19 12:17:28,528 - persistent_tts_service - INFO - üéß [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Receiver processing sentence #3: 'I was just, um, wondering if y...'
2025-12-19T12:17:29.152059009Z [err]  2025-12-19 12:17:28,528 - persistent_tts_service - INFO - üìä [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] DIAGNOSTIC: queue_latency=2725ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-19T12:17:29.152066634Z [err]  2025-12-19 12:17:28,606 - server - INFO - üì¶ Saved 10 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email']
2025-12-19T12:17:29.152072552Z [err]  2025-12-19 12:17:28,682 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-19T12:17:29.152077788Z [err]  2025-12-19 12:17:28,683 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146648.6830556 for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:29.152083408Z [err]  2025-12-19 12:17:28,683 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:29.152086397Z [err]  2025-12-19 12:17:28,427 - server - INFO - üìù Updated call log: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:29.152093156Z [err]  2025-12-19 12:17:28,517 - server - INFO - ‚úÖ Finalized call log: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw (duration=10s, status=completed)
2025-12-19T12:17:29.152100798Z [err]  2025-12-19 12:17:28,527 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-19T12:17:29.152107693Z [err]  2025-12-19 12:17:28,528 - persistent_tts_service - INFO - ‚úÖ [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Receiver finished sentence #2: 4 chunks in 2725ms
2025-12-19T12:17:29.317099928Z [err]  2025-12-19 12:17:29,312 - server - INFO - üìä Auto-added call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-19T12:17:30.139570250Z [err]  2025-12-19 12:17:29,579 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-19T12:17:30.139576542Z [err]  2025-12-19 12:17:29,666 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=6944df147eadbccc46887cdf, to_number=+17708336397
2025-12-19T12:17:30.139581879Z [err]  2025-12-19 12:17:29,667 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=6944df147eadbccc46887cdf, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3-antigrav
2025-12-19T12:17:30.139589041Z [err]  2025-12-19 12:17:29,667 - server - INFO - üöÄ Triggered QC analysis for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:30.139590340Z [err]  2025-12-19 12:17:29,667 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-19T12:17:30.139602982Z [err]  2025-12-19 12:17:29,524 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:30.139608698Z [err]  2025-12-19 12:17:29,524 - server - INFO - üì® ================================================
2025-12-19T12:17:30.139613948Z [err]  2025-12-19 12:17:29,525 - server - INFO - üéôÔ∏è Recording saved for call: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:30.139622863Z [err]  2025-12-19 12:17:29,526 - redis_service - INFO - üì• Retrieved call data from Redis: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:30.139627785Z [err]  2025-12-19 12:17:29,526 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=88f6af19-0530-4772-bf78-572561f3ddfe, call_data=True
2025-12-19T12:17:30.139642305Z [err]  2025-12-19 12:17:29,667 - server - INFO - üìä Triggered Campaign QC for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:30.139693424Z [err]  2025-12-19 12:17:29,489 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-19T12:17:30.139697017Z [err]  2025-12-19 12:17:29,491 - redis_service - INFO - üì• Retrieved call data from Redis: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:30.139702189Z [err]  2025-12-19 12:17:29,491 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=No
2025-12-19T12:17:30.139706409Z [err]  2025-12-19 12:17:29,491 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-19T12:17:30.139710849Z [err]  2025-12-19 12:17:29,524 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:30.139714783Z [err]  2025-12-19 12:17:29,524 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '93d6eff0-6fcf-4710-ad03-d8d3bb95e815', 'occurred_at': '2025-12-19T12:17:28.986361Z', 'payload': {'call_control_id': 'v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw', 'call_leg_id': 'a65ffa4c-dcd4-11f0-a8de-02420aef971f', 'call_session_id': 'a65d397e-dcd4-11f0-be1a-02420aef971f', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-19T12:17:27.735881Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-19T12:17:27.735881Z', 'recording_id': '88f6af19-0530-4772-bf78-572561f3ddfe', 'recording_started_at': '2025-12-19T12:17:19.226082Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-19/a65ffa4c-dcd4-11f0-a8de-02420aef971f-1766146639160198.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251219%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251219T121728Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=6f6848bf546e647c57e7f5a3ba644e402495828c93f888901228bfbf7c44d5cd'}, 'start_time': '2025-12-19T12:17:19.226082Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:30.143049362Z [err]  2025-12-19 12:17:29,940 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-19T12:17:30.143159320Z [err]  2025-12-19 12:17:29,667 - server - INFO - üìá Triggered CRM update for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:30.143164989Z [err]  2025-12-19 12:17:29,667 - persistent_tts_service - INFO - üîå [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Closing persistent TTS WebSocket...
2025-12-19T12:17:30.143170692Z [err]  2025-12-19 12:17:29,667 - server - INFO - üîç Starting QC analysis for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:30.143177908Z [err]  2025-12-19 12:17:29,995 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-19T12:17:30.143178190Z [err]  2025-12-19 12:17:29,667 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=6944df147eadbccc46887cdf
2025-12-19T12:17:30.143184486Z [err]  2025-12-19 12:17:29,668 - server - INFO - üìá CRM update starting for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:17:30.143190900Z [err]  2025-12-19 12:17:29,997 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-19T12:17:30.143191580Z [err]  2025-12-19 12:17:29,668 - server - INFO - üìá Normalized phone: +17708336397
2025-12-19T12:17:30.143199353Z [err]  2025-12-19 12:17:30,020 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:30.143202076Z [err]  2025-12-19 12:17:29,668 - server - INFO - üìá CRM: Got 10 variables from active session
2025-12-19T12:17:30.143207300Z [err]  2025-12-19 12:17:30,027 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-19T12:17:30.143209817Z [err]  2025-12-19 12:17:29,669 - persistent_tts_service - INFO - üõë [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Audio Receiver Loop CANCELLED
2025-12-19T12:17:30.143215428Z [err]  2025-12-19 12:17:29,670 - persistent_tts_service - INFO - üëã [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Audio Receiver Loop STOPPED
2025-12-19T12:17:30.143222052Z [err]  2025-12-19 12:17:30,027 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:17:30.143228990Z [err]  2025-12-19 12:17:30,027 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:30.143235623Z [err]  2025-12-19 12:17:30,108 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:30.143262835Z [err]  2025-12-19 12:17:29,670 - persistent_tts_service - INFO - üõë [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Playback consumer shutting down
2025-12-19T12:17:30.143269606Z [err]  2025-12-19 12:17:29,755 - server - INFO - üìù Converted transcript from 5 messages to 158 characters
2025-12-19T12:17:30.143805182Z [err]  2025-12-19 12:17:29,853 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:30.143810755Z [err]  2025-12-19 12:17:29,933 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-19T12:17:30.997279251Z [err]  2025-12-19 12:17:30,416 - server - INFO - üíæ Saved recording URL and ID to database: 88f6af19-0530-4772-bf78-572561f3ddfe
2025-12-19T12:17:30.997287486Z [err]  2025-12-19 12:17:30,416 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-19T12:17:30.997295150Z [err]  2025-12-19 12:17:30,416 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-19T12:17:30.997303758Z [err]  2025-12-19 12:17:30,524 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-19T12:17:30.997310762Z [err]  2025-12-19 12:17:30,524 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-19T12:17:30.997317084Z [err]  2025-12-19 12:17:30,524 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-19T12:17:30.997420146Z [err]  2025-12-19 12:17:30,524 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-19T12:17:30.997426969Z [err]  2025-12-19 12:17:30,807 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-19/a65ffa4c-dcd4-11f0-a8de-02420aef971f-1766146639160198.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251219%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251219T121728Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=6f6848bf546e647c57e7f5a3ba644e402495828c93f888901228bfbf7c44d5cd "HTTP/1.1 200 OK"
2025-12-19T12:17:30.997463219Z [err]  2025-12-19 12:17:30,891 - server - INFO - ‚úÖ Downloaded 34315 bytes
2025-12-19T12:17:31.107115453Z [err]  2025-12-19 12:17:31,102 - server - INFO - ‚úÖ Split into 2 channels
2025-12-19T12:17:31.107126090Z [err]  2025-12-19 12:17:31,102 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-19T12:17:31.107132775Z [err]  2025-12-19 12:17:31,103 - server - INFO - üìä Channel 0: 184844 bytes
2025-12-19T12:17:31.107139255Z [err]  2025-12-19 12:17:31,103 - server - ERROR - ‚ùå No Soniox API key available
2025-12-19T12:17:31.107147355Z [err]  2025-12-19 12:17:31,103 - server - INFO - ‚ùå Channel 0: No speech
2025-12-19T12:17:31.107155963Z [err]  2025-12-19 12:17:31,103 - server - INFO - üìä Channel 1: 184844 bytes
2025-12-19T12:17:31.107162916Z [err]  2025-12-19 12:17:31,103 - server - ERROR - ‚ùå No Soniox API key available
2025-12-19T12:17:31.107168985Z [err]  2025-12-19 12:17:31,103 - server - INFO - ‚ùå Channel 1: No speech
2025-12-19T12:17:31.107175323Z [err]  2025-12-19 12:17:31,103 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-19T12:17:31.107181867Z [inf]  100.64.0.11:62122 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:31.216295904Z [err]  2025-12-19 12:17:31,212 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-19T12:17:31.219715307Z [err]  2025-12-19 12:17:31,215 - telnyx_service - INFO - ‚úÖ Call initiated: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:31.223320006Z [err]  2025-12-19 12:17:31,220 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=5, logs_count=6, status=completed
2025-12-19T12:17:31.223325874Z [err]  2025-12-19 12:17:31,220 - server - INFO - üìá CRM: Got 10 extracted variables
2025-12-19T12:17:31.223332164Z [err]  2025-12-19 12:17:31,220 - server - INFO - üìá CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email']
2025-12-19T12:17:31.223340260Z [err]  2025-12-19 12:17:31,220 - elevenlabs_ws_service - INFO - üîå Closed ElevenLabs WebSocket connection
2025-12-19T12:17:31.223346563Z [err]  2025-12-19 12:17:31,221 - persistent_tts_service - INFO - ‚úÖ [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] Persistent TTS WebSocket closed
2025-12-19T12:17:31.223354367Z [err]  2025-12-19 12:17:31,221 - persistent_tts_service - INFO - ‚úÖ Closed persistent TTS session for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:31.223359603Z [err]  2025-12-19 12:17:31,221 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:31.226049550Z [err]  2025-12-19 12:17:31,222 - redis_service - INFO - üßπ Deleted call data from Redis: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:31.226060732Z [err]  2025-12-19 12:17:31,222 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:31.226072103Z [inf]  100.64.0.5:42070 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:31.308568686Z [err]  2025-12-19 12:17:31,305 - server - INFO - üìù Created call log: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:31.308576766Z [err]  2025-12-19 12:17:31,305 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-19T12:17:31.308583485Z [err]  2025-12-19 12:17:31,305 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-19T12:17:31.311878804Z [err]  2025-12-19 12:17:31,305 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-19T12:17:31.311887000Z [err]  2025-12-19 12:17:31,305 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-19T12:17:31.321880981Z [err]  2025-12-19 12:17:31,315 - redis_service - INFO - üì¶ Stored call data in Redis: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA (TTL: 3600s)
2025-12-19T12:17:31.321885792Z [err]  2025-12-19 12:17:31,317 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-19T12:17:31.321890754Z [err]  2025-12-19 12:17:31,317 - server - INFO - üìû Outbound call initiated: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:31.321896140Z [inf]  100.64.0.10:38204 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-19T12:17:31.977488138Z [err]  [2025-12-19 12:17:31 +0000] [3] [INFO] connection open
2025-12-19T12:17:31.977499557Z [err]  2025-12-19 12:17:31,471 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:31.977507127Z [err]  2025-12-19 12:17:31,471 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': '73e7fe36-c0fb-48d5-8328-9b2cd1c9e0db', 'occurred_at': '2025-12-19T12:17:30.976124Z', 'payload': {'call_control_id': 'v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA', 'call_leg_id': 'b0f7bbe8-dcd4-11f0-867c-02420aef96a0', 'call_session_id': 'b0f429a6-dcd4-11f0-b3cc-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:31.977595059Z [err]  2025-12-19 12:17:31,422 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-19T12:17:31.977598248Z [err]  2025-12-19 12:17:31,452 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'VxwlLCOJjp53ZPPMxFu7VQ==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'on9MVgQ5RCmBCnaZxtoGcA', 'x-real-ip': '192.76.120.151', 'x-request-start': '1766146651187', 'accept-encoding': 'gzip'}
2025-12-19T12:17:31.977602810Z [err]  2025-12-19 12:17:31,451 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-19T12:17:31.977608979Z [err]  2025-12-19 12:17:31,452 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-19T12:17:31.977611503Z [err]  2025-12-19 12:17:31,451 - server - INFO -    Client: Address(host='100.64.0.12', port=51472)
2025-12-19T12:17:31.977617056Z [err]  2025-12-19 12:17:31,452 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-19T12:17:31.977625811Z [err]  [2025-12-19 12:17:31 +0000] [3] [INFO] ('100.64.0.12', 51472) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-19T12:17:31.977632580Z [err]  2025-12-19 12:17:31,452 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-19T12:17:31.981716407Z [err]  2025-12-19 12:17:31,471 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:31.981720852Z [err]  2025-12-19 12:17:31,471 - server - INFO - üì® ================================================
2025-12-19T12:17:31.981725406Z [err]  2025-12-19 12:17:31,471 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-19T12:17:31.981729404Z [inf]  100.64.0.13:21782 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:31.981733419Z [err]  2025-12-19 12:17:31,606 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-19T12:17:31.981737740Z [err]  2025-12-19 12:17:31,606 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-19T12:17:31.981742323Z [err]  2025-12-19 12:17:31,645 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3-antigrav, has_auto_qc_settings=True
2025-12-19T12:17:31.981746001Z [err]  2025-12-19 12:17:31,720 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:31.981749807Z [err]  2025-12-19 12:17:31,720 - persistent_tts_service - INFO - üîá [Call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw] FLOOR RELEASED (is_holding_floor=False)
2025-12-19T12:17:31.981753573Z [err]  2025-12-19 12:17:31,731 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-19T12:17:31.981757394Z [err]  2025-12-19 12:17:31,731 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-19T12:17:31.981779405Z [err]  2025-12-19 12:17:31,731 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-19T12:17:31.983359973Z [err]  2025-12-19 12:17:31,732 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-19T12:17:31.983367061Z [err]    File "/app/backend/server.py", line 9698, in trigger_campaign_qc_for_call
2025-12-19T12:17:31.983372733Z [err]      await run_full_qc_analysis(
2025-12-19T12:17:31.983383890Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-19T12:17:31.983389392Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-19T12:17:31.983395306Z [err]  
2025-12-19T12:17:31.983403304Z [err]  2025-12-19 12:17:31,958 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-19T12:17:31.983410286Z [err]  2025-12-19 12:17:31,959 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-19T12:17:32.224411168Z [err]  2025-12-19 12:17:32,222 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:32.942655065Z [err]  2025-12-19 12:17:32,723 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:33.227218654Z [err]  2025-12-19 12:17:33,225 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:33.977080193Z [err]  2025-12-19 12:17:33,869 - server - INFO - üé¨ Stream started for call: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:33.977099212Z [err]  2025-12-19 12:17:33,874 - redis_service - INFO - üì• Retrieved call data from Redis: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:33.977109239Z [err]  2025-12-19 12:17:33,875 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-19T12:17:33.977123734Z [err]  2025-12-19 12:17:33,726 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:33.977142640Z [err]  2025-12-19 12:17:33,869 - server - INFO - üì¨ Received Telnyx event: start
2025-12-19T12:17:33.977161698Z [err]  2025-12-19 12:17:33,875 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-19T12:17:34.018035683Z [err]  2025-12-19 12:17:34,011 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:34.018042596Z [err]  2025-12-19 12:17:34,011 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': '0cd17013-a93f-4da4-aa54-16e7e9064905', 'occurred_at': '2025-12-19T12:17:33.555967Z', 'payload': {'call_control_id': 'v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA', 'call_leg_id': 'b0f7bbe8-dcd4-11f0-867c-02420aef96a0', 'call_session_id': 'b0f429a6-dcd4-11f0-b3cc-02420aef96a0', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-19T12:17:30.976124Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:34.018047846Z [err]  2025-12-19 12:17:34,011 - server - INFO - üéØ Event type: call.answered, Call ID: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:34.018052438Z [err]  2025-12-19 12:17:34,011 - server - INFO - üì® ================================================
2025-12-19T12:17:34.018057608Z [err]  2025-12-19 12:17:34,011 - server - INFO - ‚úÖ Call answered: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:34.023452920Z [err]  2025-12-19 12:17:34,016 - redis_service - INFO - üì• Retrieved call data from Redis: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:34.023458648Z [err]  2025-12-19 12:17:34,017 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-19T12:17:34.023463903Z [err]  2025-12-19 12:17:34,017 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-19T12:17:34.110747232Z [err]  2025-12-19 12:17:34,107 - server - INFO - ‚úÖ Call log updated
2025-12-19T12:17:34.110752082Z [err]  2025-12-19 12:17:34,107 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-19T12:17:34.110756182Z [err]  2025-12-19 12:17:34,107 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-19T12:17:34.110760556Z [err]  2025-12-19 12:17:34,107 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:17:34.206286134Z [err]  2025-12-19 12:17:34,199 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:34.229061128Z [err]  2025-12-19 12:17:34,228 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:34.289216135Z [err]  2025-12-19 12:17:34,285 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:34.289225073Z [err]  2025-12-19 12:17:34,286 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-19T12:17:34.322237604Z [err]  2025-12-19 12:17:34,319 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-19T12:17:34.379768492Z [err]  2025-12-19 12:17:34,376 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-19T12:17:34.379774491Z [err]  2025-12-19 12:17:34,376 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-19T12:17:34.386030303Z [err]  2025-12-19 12:17:34,382 - redis_service - INFO - üì• Retrieved call data from Redis: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:34.387756866Z [err]  2025-12-19 12:17:34,386 - server - INFO - üìù Creating session with agent_id=6944df147eadbccc46887cdf, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:17:34.387764608Z [err]  2025-12-19 12:17:34,386 - calling_service - INFO - üîç Checking KB for agent 6944df147eadbccc46887cdf...
2025-12-19T12:17:34.951828854Z [err]  2025-12-19 12:17:34,559 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:34.951834646Z [err]  2025-12-19 12:17:34,569 - calling_service - INFO - ‚úÖ LLM client pre-warmed in 95ms
2025-12-19T12:17:34.951839713Z [err]  2025-12-19 12:17:34,569 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-19T12:17:34.951844941Z [err]  2025-12-19 12:17:34,569 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-19T12:17:34.951874226Z [err]  2025-12-19 12:17:34,569 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-19T12:17:34.951884317Z [err]  2025-12-19 12:17:34,569 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-19T12:17:34.951892703Z [err]  2025-12-19 12:17:34,569 - server - INFO - ‚úÖ Initialized call_states for v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA with session reference
2025-12-19T12:17:34.951901264Z [err]  2025-12-19 12:17:34,571 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-19T12:17:34.951910217Z [err]  2025-12-19 12:17:34,571 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-19T12:17:34.951919367Z [err]  2025-12-19 12:17:34,572 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: pt0P_jSG4w (loop=True, overlay=True)
2025-12-19T12:17:34.951926531Z [err]  2025-12-19 12:17:34,572 - server - WARNING - ‚ö†Ô∏è Failed to start comfort noise: 'v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'
2025-12-19T12:17:34.951940954Z [err]  2025-12-19 12:17:34,572 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:34.951947984Z [err]  2025-12-19 12:17:34,662 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-19T12:17:34.952315637Z [err]  2025-12-19 12:17:34,453 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:34.952321762Z [err]  2025-12-19 12:17:34,453 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': '82b196c1-32e0-42a7-9b9f-eb8b015bb13d', 'occurred_at': '2025-12-19T12:17:34.055976Z', 'payload': {'call_control_id': 'v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA', 'call_leg_id': 'b0f7bbe8-dcd4-11f0-867c-02420aef96a0', 'call_session_id': 'b0f429a6-dcd4-11f0-b3cc-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': 'f0502258-91e2-4747-a809-480d43d36614', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:34.952328693Z [err]  2025-12-19 12:17:34,453 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:34.952334606Z [err]  2025-12-19 12:17:34,453 - server - INFO - üì® ================================================
2025-12-19T12:17:34.952340702Z [inf]  100.64.0.9:43590 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:34.952346716Z [err]  2025-12-19 12:17:34,471 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-19T12:17:34.952352509Z [err]  2025-12-19 12:17:34,472 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-19T12:17:34.952359104Z [err]  2025-12-19 12:17:34,472 - calling_service - INFO - üîç KB count query completed: 0 items
2025-12-19T12:17:34.952365192Z [err]  2025-12-19 12:17:34,473 - calling_service - INFO - üìã Built cached system prompt: 5480 chars (global) + 1402 chars (technical)
2025-12-19T12:17:34.952371757Z [err]  2025-12-19 12:17:34,473 - calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-19T12:17:35.144859288Z [err]  2025-12-19 12:17:35,139 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-19T12:17:35.144870276Z [err]  2025-12-19 12:17:35,140 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-19T12:17:35.144878626Z [err]  2025-12-19 12:17:35,140 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-19T12:17:35.171494420Z [err]  2025-12-19 12:17:35,168 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-19T12:17:35.171501368Z [err]  2025-12-19 12:17:35,169 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:35.175291789Z [err]  2025-12-19 12:17:35,170 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:35.175301743Z [err]  2025-12-19 12:17:35,171 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-19T12:17:35.999037691Z [err]  2025-12-19 12:17:35,673 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:35.999306196Z [inf]  100.64.0.7:57388 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-19T12:17:36.040865097Z [err]  2025-12-19 12:17:36,035 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA/actions/record_start "HTTP/1.1 200 OK"
2025-12-19T12:17:36.040877854Z [err]  2025-12-19 12:17:36,038 - server - INFO - üéôÔ∏è Call recording started for v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:36.040886746Z [err]  2025-12-19 12:17:36,038 - server - INFO - üîß Creating call session for v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA...
2025-12-19T12:17:36.040895270Z [err]  2025-12-19 12:17:36,038 - server - INFO - üîç Agent ID: 6944df147eadbccc46887cdf, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:17:36.040902437Z [err]  2025-12-19 12:17:36,038 - server - INFO - üîß Calling create_call_session() - START
2025-12-19T12:17:36.040910335Z [err]  2025-12-19 12:17:36,038 - calling_service - INFO - üîç Checking KB for agent 6944df147eadbccc46887cdf...
2025-12-19T12:17:36.045168722Z [err]  2025-12-19 12:17:36,039 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:36.045174742Z [err]  2025-12-19 12:17:36,039 - calling_service - INFO - ‚è∞ Check-in triggered after 7.4s silence (threshold: 7s)
2025-12-19T12:17:36.045182247Z [err]  2025-12-19 12:17:36,040 - calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-19T12:17:36.045187617Z [err]  2025-12-19 12:17:36,040 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.4s silence: Are you still there?
2025-12-19T12:17:36.045192408Z [err]  2025-12-19 12:17:36,040 - calling_service - INFO - ü§ñ Agent started speaking for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:36.045196693Z [err]  2025-12-19 12:17:36,040 - telnyx_service - INFO - üîä Speaking text on call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw: Are you still there?...
2025-12-19T12:17:36.045200977Z [err]  2025-12-19 12:17:36,040 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-19T12:17:36.045206215Z [err]  2025-12-19 12:17:36,040 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-19T12:17:36.045210058Z [err]  2025-12-19 12:17:36,040 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-19T12:17:36.045213831Z [err]  2025-12-19 12:17:36,040 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-19T12:17:36.045217784Z [err]  2025-12-19 12:17:36,040 - server - INFO - ‚è±Ô∏è [12:17:36.040] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-19T12:17:36.045221439Z [err]  2025-12-19 12:17:36,041 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-19T12:17:36.045225325Z [err]  2025-12-19 12:17:36,041 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-19T12:17:36.127152371Z [err]  2025-12-19 12:17:36,125 - calling_service - INFO - üîç KB count query completed: 0 items
2025-12-19T12:17:36.127164040Z [err]  2025-12-19 12:17:36,125 - calling_service - INFO - üìã Built cached system prompt: 5480 chars (global) + 1402 chars (technical)
2025-12-19T12:17:36.127171579Z [err]  2025-12-19 12:17:36,125 - calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-19T12:17:36.132178418Z [err]  2025-12-19 12:17:36,128 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:36.132191866Z [err]  2025-12-19 12:17:36,128 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-19T12:17:36.132201975Z [err]  2025-12-19 12:17:36,128 - server - INFO -    Text length: 20 chars
2025-12-19T12:17:36.132209769Z [err]  2025-12-19 12:17:36,128 - server - INFO -    Text content: 'Are you still there?'
2025-12-19T12:17:36.132217733Z [err]  2025-12-19 12:17:36,128 - server - INFO -    Text bytes: b'Are you still there?'
2025-12-19T12:17:36.132225688Z [err]  2025-12-19 12:17:36,128 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-19T12:17:36.132232887Z [err]  2025-12-19 12:17:36,128 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-19T12:17:36.132240308Z [err]  2025-12-19 12:17:36,128 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-19T12:17:36.132247696Z [err]  2025-12-19 12:17:36,128 - server - INFO -    Full data: {'text': 'Are you still there?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-19T12:17:36.132255981Z [err]  2025-12-19 12:17:36,128 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-19T12:17:36.132265886Z [err]  2025-12-19 12:17:36,128 - server - INFO -    Timeout: 10.0s
2025-12-19T12:17:36.143370600Z [err]  2025-12-19 12:17:36,140 - server - INFO -    ‚úì HTTP client created (0.012s)
2025-12-19T12:17:36.143379157Z [err]  2025-12-19 12:17:36,141 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-19T12:17:36.177167956Z [err]  2025-12-19 12:17:36,174 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:36.214640115Z [err]  2025-12-19 12:17:36,211 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:36.224882115Z [err]  2025-12-19 12:17:36,220 - calling_service - INFO - ‚úÖ LLM client pre-warmed in 94ms
2025-12-19T12:17:36.224893588Z [err]  2025-12-19 12:17:36,220 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-19T12:17:36.224899773Z [err]  2025-12-19 12:17:36,220 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-19T12:17:36.233931220Z [err]  2025-12-19 12:17:36,227 - redis_service - INFO - üì¶ Stored call data in Redis: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA (TTL: 3600s)
2025-12-19T12:17:36.233943781Z [err]  2025-12-19 12:17:36,228 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-19T12:17:36.233950097Z [err]  2025-12-19 12:17:36,228 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-19T12:17:36.233955306Z [err]  2025-12-19 12:17:36,228 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:36.233966400Z [err]  2025-12-19 12:17:36,229 - server - INFO - ü§ñ AI session created for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:36.233977165Z [err]  2025-12-19 12:17:36,229 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-19T12:17:36.233983742Z [err]  2025-12-19 12:17:36,229 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-19T12:17:36.233989378Z [err]  2025-12-19 12:17:36,229 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-19T12:17:36.233995079Z [err]  2025-12-19 12:17:36,229 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-19T12:17:36.234002225Z [err]  2025-12-19 12:17:36,229 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-19T12:17:36.234011065Z [err]  2025-12-19 12:17:36,229 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-19T12:17:36.234016649Z [err]  2025-12-19 12:17:36,229 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-19T12:17:36.236689572Z [err]  2025-12-19 12:17:36,229 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-19T12:17:36.236696402Z [err]  2025-12-19 12:17:36,229 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-19T12:17:36.236704250Z [inf]  100.64.0.5:42070 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:36.972057813Z [err]  2025-12-19 12:17:36,486 - server - INFO -    ‚úì FIRST CHUNK received (0.357s, 1174 bytes) [TARGET: <300ms]
2025-12-19T12:17:36.972067439Z [err]  2025-12-19 12:17:36,488 - server - INFO -    ‚úì ALL CHUNKS received: 50 chunks (0.360s)
2025-12-19T12:17:36.972073471Z [err]  2025-12-19 12:17:36,488 - server - INFO -    ‚úì Total audio size: 17599 bytes
2025-12-19T12:17:36.972078638Z [err]  2025-12-19 12:17:36,488 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-19T12:17:36.972083342Z [err]  2025-12-19 12:17:36,488 - server - INFO -       - Connection: 347ms
2025-12-19T12:17:36.972107280Z [err]  2025-12-19 12:17:36,488 - server - INFO - ‚è±Ô∏è [12:17:36.488] üîä TTS COMPLETE: 447ms, audio_size=17599 bytes
2025-12-19T12:17:36.972111188Z [err]  2025-12-19 12:17:36,489 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:17:36.972114749Z [err]  2025-12-19 12:17:36,475 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-19T12:17:36.972118138Z [err]  2025-12-19 12:17:36,488 - server - INFO - üíæ TTS CACHED: elevenlabs:Are you still there?... (17599 bytes)
2025-12-19T12:17:36.972126609Z [err]  2025-12-19 12:17:36,488 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.45s
2025-12-19T12:17:36.972129471Z [err]  2025-12-19 12:17:36,475 - server - INFO -    ‚úì Connection established (0.347s) [TARGET: <200ms]
2025-12-19T12:17:36.972130485Z [err]  2025-12-19 12:17:36,488 - server - INFO -       - First chunk: 357ms
2025-12-19T12:17:36.972141336Z [err]  2025-12-19 12:17:36,475 - server - INFO -    ‚úì Response status: 200
2025-12-19T12:17:36.972141571Z [err]  2025-12-19 12:17:36,488 - server - INFO -       - All chunks: 360ms
2025-12-19T12:17:36.972152671Z [err]  2025-12-19 12:17:36,475 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-19T12:17:36.972152897Z [err]  2025-12-19 12:17:36,488 - server - INFO -       - Audio generation only: 10ms
2025-12-19T12:17:36.975929075Z [err]  2025-12-19 12:17:36,489 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:17:36.975934385Z [err]  2025-12-19 12:17:36,576 - redis_service - INFO - üì• Retrieved call data from Redis: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:36.975940230Z [err]  2025-12-19 12:17:36,579 - redis_service - INFO - üì¶ Stored call data in Redis: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA (TTL: 3600s)
2025-12-19T12:17:36.975944516Z [err]  2025-12-19 12:17:36,579 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-19T12:17:36.975949028Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - ‚è±Ô∏è [12:17:36.579] üì• process_user_input() ENTRY - text: '...'
2025-12-19T12:17:36.975953830Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - ‚è±Ô∏è [12:17:36.579] ‚è© About to call _process_call_flow_streaming()
2025-12-19T12:17:36.975958002Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - ‚è±Ô∏è [12:17:36.579] üîÄ Agent type: call_flow, calling flow processor...
2025-12-19T12:17:36.975962414Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - ‚è±Ô∏è [12:17:36.579] üîÄ _process_call_flow_streaming() ENTRY
2025-12-19T12:17:36.975966912Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-19T12:17:36.975971733Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - ‚è±Ô∏è [12:17:36.579] ‚úÖ Node selected, about to process content...
2025-12-19T12:17:36.975976498Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - üîß Replaced {{now}} with Friday, December 19, 2025 at 7:17 AM EST in content
2025-12-19T12:17:36.975980831Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-19T12:17:36.975985340Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-19T12:17:36.977584422Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-19T12:17:36.977591261Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-19T12:17:36.977597338Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-19T12:17:36.977601937Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-19T12:17:36.977606620Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-19T12:17:36.977611011Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-19T12:17:36.977615783Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-19T12:17:36.977621510Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-19T12:17:36.977626388Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-19T12:17:36.977630575Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-19T12:17:36.977635318Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - ‚è±Ô∏è [12:17:36.579] üìÑ About to process content (mode=script, length=9)
2025-12-19T12:17:36.977639452Z [err]  2025-12-19 12:17:36,579 - calling_service - INFO - üîä Silence tracking reset for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA (user responded)
2025-12-19T12:17:36.977643269Z [err]  2025-12-19 12:17:36,580 - calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-19T12:17:36.979956047Z [err]  2025-12-19 12:17:36,580 - calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-19T12:17:36.979989276Z [err]  2025-12-19 12:17:36,580 - calling_service - INFO - LLM response (0.00s): Kendrick?
2025-12-19T12:17:36.979996045Z [err]  2025-12-19 12:17:36,580 - calling_service - INFO - Total latency: 0.00s
2025-12-19T12:17:36.980000916Z [err]  2025-12-19 12:17:36,580 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-19T12:17:36.980006031Z [err]  2025-12-19 12:17:36,669 - redis_service - INFO - üì• Retrieved call data from Redis: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:36.980018459Z [err]  2025-12-19 12:17:36,669 - telnyx_service - INFO - üîä Speaking text on call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA: Kendrick?...
2025-12-19T12:17:36.980024898Z [err]  2025-12-19 12:17:36,669 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-19T12:17:36.980030372Z [err]  2025-12-19 12:17:36,669 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-19T12:17:36.980035847Z [err]  2025-12-19 12:17:36,669 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-19T12:17:36.980041022Z [err]  2025-12-19 12:17:36,669 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-19T12:17:36.980046179Z [err]  2025-12-19 12:17:36,669 - server - INFO - ‚è±Ô∏è [12:17:36.669] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-19T12:17:36.980051254Z [err]  2025-12-19 12:17:36,669 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-19T12:17:36.980056980Z [err]  2025-12-19 12:17:36,669 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-19T12:17:36.980062268Z [err]  2025-12-19 12:17:36,676 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:36.982789361Z [err]  2025-12-19 12:17:36,753 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:17:36.982817241Z [err]  2025-12-19 12:17:36,753 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.26s
2025-12-19T12:17:36.982825177Z [err]  2025-12-19 12:17:36,754 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-19T12:17:36.982833458Z [err]    "errors": [
2025-12-19T12:17:36.982835197Z [err]  2025-12-19 12:17:36,756 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-19T12:17:36.982840616Z [err]      {
2025-12-19T12:17:36.982847347Z [err]  2025-12-19 12:17:36,756 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-19T12:17:36.982849635Z [err]        "code": "90018",
2025-12-19T12:17:36.982855462Z [err]        "title": "Call has already ended",
2025-12-19T12:17:36.982861880Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-19T12:17:36.982870409Z [err]  2025-12-19 12:17:36,756 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-19T12:17:36.982870903Z [err]      }
2025-12-19T12:17:36.982877985Z [err]    ]
2025-12-19T12:17:36.982884046Z [err]  }
2025-12-19T12:17:36.982890580Z [err]  2025-12-19 12:17:36,754 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-19T12:17:36.982896767Z [err]  2025-12-19 12:17:36,755 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:36.982902719Z [err]  2025-12-19 12:17:36,755 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-19T12:17:36.982910239Z [err]  2025-12-19 12:17:36,755 - server - INFO -    Text length: 9 chars
2025-12-19T12:17:36.982916419Z [err]  2025-12-19 12:17:36,756 - server - INFO -    Text content: 'Kendrick?'
2025-12-19T12:17:36.982921838Z [err]  2025-12-19 12:17:36,756 - server - INFO -    Text bytes: b'Kendrick?'
2025-12-19T12:17:36.985648021Z [err]  2025-12-19 12:17:36,756 - server - INFO -    Full data: {'text': 'Kendrick?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-19T12:17:36.985659291Z [err]  2025-12-19 12:17:36,756 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-19T12:17:36.985666971Z [err]  2025-12-19 12:17:36,756 - server - INFO -    Timeout: 10.0s
2025-12-19T12:17:36.985677624Z [err]  2025-12-19 12:17:36,765 - server - INFO -    ‚úì HTTP client created (0.010s)
2025-12-19T12:17:36.985696277Z [err]  2025-12-19 12:17:36,765 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-19T12:17:37.005202209Z [err]  2025-12-19 12:17:37,002 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:17:37.005220626Z [err]  2025-12-19 12:17:37,003 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-19T12:17:37.005235932Z [err]  2025-12-19 12:17:37,003 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-19T12:17:37.085553195Z [err]  2025-12-19 12:17:37,083 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-19T12:17:37.085562384Z [err]  2025-12-19 12:17:37,084 - server - INFO -    ‚úì Connection established (0.328s) [TARGET: <200ms]
2025-12-19T12:17:37.085569479Z [err]  2025-12-19 12:17:37,084 - server - INFO -    ‚úì Response status: 200
2025-12-19T12:17:37.085576237Z [err]  2025-12-19 12:17:37,084 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-19T12:17:37.102259642Z [err]  2025-12-19 12:17:37,092 - server - INFO -    ‚úì FIRST CHUNK received (0.336s, 1116 bytes) [TARGET: <300ms]
2025-12-19T12:17:37.102266500Z [err]  2025-12-19 12:17:37,093 - server - INFO -    ‚úì ALL CHUNKS received: 11 chunks (0.338s)
2025-12-19T12:17:37.102270918Z [err]  2025-12-19 12:17:37,093 - server - INFO -    ‚úì Total audio size: 13419 bytes
2025-12-19T12:17:37.102275040Z [err]  2025-12-19 12:17:37,093 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-19T12:17:37.102279299Z [err]  2025-12-19 12:17:37,093 - server - INFO -       - Connection: 328ms
2025-12-19T12:17:37.102283642Z [err]  2025-12-19 12:17:37,093 - server - INFO -       - First chunk: 336ms
2025-12-19T12:17:37.102287395Z [err]  2025-12-19 12:17:37,094 - server - INFO -       - All chunks: 338ms
2025-12-19T12:17:37.102292059Z [err]  2025-12-19 12:17:37,094 - server - INFO -       - Audio generation only: 8ms
2025-12-19T12:17:37.102295961Z [err]  2025-12-19 12:17:37,094 - server - INFO - ‚è±Ô∏è [12:17:37.094] üîä TTS COMPLETE: 424ms, audio_size=13419 bytes
2025-12-19T12:17:37.102299948Z [err]  2025-12-19 12:17:37,094 - server - INFO - üíæ TTS CACHED: elevenlabs:Kendrick?... (13419 bytes)
2025-12-19T12:17:37.102304327Z [err]  2025-12-19 12:17:37,094 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.42s
2025-12-19T12:17:37.102308587Z [err]  2025-12-19 12:17:37,094 - telnyx_service - INFO - ‚úÖ Generated 13419 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-19T12:17:37.102313088Z [err]  2025-12-19 12:17:37,094 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-19T12:17:37.180950858Z [err]  2025-12-19 12:17:37,177 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:37.235628848Z [err]  2025-12-19 12:17:37,232 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:37.235632365Z [err]  2025-12-19 12:17:37,232 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': 'b36d44bb-5fce-47b9-80e8-ef4dbaf80c87', 'occurred_at': '2025-12-19T12:17:36.855962Z', 'payload': {'call_control_id': 'v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA', 'call_leg_id': 'b0f7bbe8-dcd4-11f0-867c-02420aef96a0', 'call_session_id': 'b0f429a6-dcd4-11f0-b3cc-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'pt0P_jSG4w', 'start_time': '2025-12-19T12:17:36.855962Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:37.235636622Z [err]  2025-12-19 12:17:37,232 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:37.235646089Z [err]  2025-12-19 12:17:37,232 - server - INFO - üì® ================================================
2025-12-19T12:17:37.235650364Z [inf]  100.64.0.11:62122 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:37.373586780Z [err]  2025-12-19 12:17:37,369 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-19T12:17:37.373598676Z [err]  2025-12-19 12:17:37,371 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.28s
2025-12-19T12:17:37.373607812Z [err]  2025-12-19 12:17:37,371 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 0.70s
2025-12-19T12:17:37.373624203Z [err]  2025-12-19 12:17:37,371 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-19T12:17:37.373630841Z [err]  2025-12-19 12:17:37,371 - telnyx_service - INFO - üé¨ Playback ID: Dj4zro4j0g
2025-12-19T12:17:37.373637939Z [err]  2025-12-19 12:17:37,371 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-19T12:17:37.373644186Z [err]  2025-12-19 12:17:37,371 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146657.371704 for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:37.373652932Z [err]  2025-12-19 12:17:37,371 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-19T12:17:37.952550381Z [err]  2025-12-19 12:17:37,505 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:37.952556591Z [err]  2025-12-19 12:17:37,505 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (5.8s ago), marking agent as done speaking
2025-12-19T12:17:37.952562600Z [err]  2025-12-19 12:17:37,505 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146657.5058522 for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:37.952572392Z [err]  2025-12-19 12:17:37,505 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:37.952579090Z [err]  2025-12-19 12:17:37,505 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:37.952587747Z [inf]  100.64.0.8:46680 - "GET /api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3 HTTP/1.1" 200
2025-12-19T12:17:37.952595507Z [err]  2025-12-19 12:17:37,679 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:38.010009218Z [err]  2025-12-19 12:17:38,007 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:38.152171671Z [err]  2025-12-19 12:17:38,149 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:38.152178273Z [err]  2025-12-19 12:17:38,150 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '0a3af827-e710-4fce-b562-ea73472a7b48', 'occurred_at': '2025-12-19T12:17:37.895970Z', 'payload': {'call_control_id': 'v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA', 'call_leg_id': 'b0f7bbe8-dcd4-11f0-867c-02420aef96a0', 'call_session_id': 'b0f429a6-dcd4-11f0-b3cc-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'Dj4zro4j0g'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:38.152185072Z [err]  2025-12-19 12:17:38,150 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:38.152191196Z [err]  2025-12-19 12:17:38,150 - server - INFO - üì® ================================================
2025-12-19T12:17:38.152197476Z [inf]  100.64.0.7:57388 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:38.184698809Z [err]  2025-12-19 12:17:38,180 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:38.964878923Z [err]  2025-12-19 12:17:38,508 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:38.964883040Z [err]  2025-12-19 12:17:38,682 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:38.996871642Z [err]  2025-12-19 12:17:38,995 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:38.996879762Z [err]  2025-12-19 12:17:38,995 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '331750ca-1089-47cf-affe-f5fb2a91717b', 'occurred_at': '2025-12-19T12:17:38.735961Z', 'payload': {'call_control_id': 'v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA', 'call_leg_id': 'b0f7bbe8-dcd4-11f0-867c-02420aef96a0', 'call_session_id': 'b0f429a6-dcd4-11f0-b3cc-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'Dj4zro4j0g', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:38.996886826Z [err]  2025-12-19 12:17:38,995 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:38.996892673Z [err]  2025-12-19 12:17:38,995 - server - INFO - üì® ================================================
2025-12-19T12:17:38.999112461Z [err]  2025-12-19 12:17:38,996 - redis_service - INFO - ‚ûñ Removed playback Dj4zro4j0g, 0 remaining for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:38.999124045Z [err]  2025-12-19 12:17:38,996 - server - INFO - üîä Redis: Removed playback Dj4zro4j0g, 0 remaining
2025-12-19T12:17:38.999132224Z [err]  2025-12-19 12:17:38,996 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-19T12:17:38.999139586Z [err]  2025-12-19 12:17:38,997 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-19T12:17:38.999145514Z [err]  2025-12-19 12:17:38,997 - server - INFO - ‚úÖ Found session in active_telnyx_calls (local worker)
2025-12-19T12:17:38.999150785Z [err]  2025-12-19 12:17:38,997 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146658.9973242 for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:38.999155796Z [err]  2025-12-19 12:17:38,997 - server - INFO - ‚è±Ô∏è Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-19T12:17:38.999161400Z [inf]  100.64.0.9:43590 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:39.012472578Z [err]  2025-12-19 12:17:39,009 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:39.059122784Z [err]  2025-12-19 12:17:39,054 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:39.059133088Z [err]  2025-12-19 12:17:39,054 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': 'bc0c2e23-68c9-4c64-9af1-0af43187ee1e', 'occurred_at': '2025-12-19T12:17:38.775962Z', 'payload': {'call_control_id': 'v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA', 'call_leg_id': 'b0f7bbe8-dcd4-11f0-867c-02420aef96a0', 'call_session_id': 'b0f429a6-dcd4-11f0-b3cc-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'silence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:39.059140475Z [err]  2025-12-19 12:17:39,054 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:39.059147140Z [err]  2025-12-19 12:17:39,054 - server - INFO - üì® ================================================
2025-12-19T12:17:39.059155482Z [inf]  100.64.0.5:42070 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:39.187991356Z [err]  2025-12-19 12:17:39,184 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:39.978093868Z [err]  2025-12-19 12:17:39,511 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:39.978098724Z [err]  2025-12-19 12:17:39,559 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-19T12:17:39.978103341Z [err]  2025-12-19 12:17:39,564 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-19T12:17:39.978111706Z [err]  2025-12-19 12:17:39,566 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:39.978116628Z [err]  2025-12-19 12:17:39,686 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:40.015582766Z [err]  2025-12-19 12:17:40,012 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:40.015589748Z [err]  2025-12-19 12:17:40,012 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=2.5s, checkin_count=1/2
2025-12-19T12:17:40.177931589Z [err]  2025-12-19 12:17:40,175 - server - INFO - üì§ Audio flowing: 289 packets sent to Soniox (5s update)
2025-12-19T12:17:40.190164247Z [err]  2025-12-19 12:17:40,188 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:40.190170297Z [err]  2025-12-19 12:17:40,188 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=2.8s, checkin_count=0/2
2025-12-19T12:17:40.966893569Z [err]  2025-12-19 12:17:40,514 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:40.966900158Z [err]  2025-12-19 12:17:40,514 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=3.0s, checkin_count=1/2
2025-12-19T12:17:40.966904198Z [err]  2025-12-19 12:17:40,689 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:40.966908211Z [err]  2025-12-19 12:17:40,689 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=3.3s, checkin_count=0/2
2025-12-19T12:17:41.018159310Z [err]  2025-12-19 12:17:41,014 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:41.074956442Z [err]  2025-12-19 12:17:41,073 - server - INFO - üî§ RAW TOKENS: ["Ye"?]
2025-12-19T12:17:41.080361399Z [err]  2025-12-19 12:17:41,077 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user started speaking) for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:41.080368913Z [err]  2025-12-19 12:17:41,077 - calling_service - INFO - üîä Silence timer reset for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA (user started speaking)
2025-12-19T12:17:41.080374933Z [err]  2025-12-19 12:17:41,077 - calling_service - INFO - üë§ User started speaking for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:41.080380424Z [err]  2025-12-19 12:17:41,077 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Ye' | Generating: False
2025-12-19T12:17:41.198991559Z [err]  2025-12-19 12:17:41,191 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:41.218427288Z [err]  2025-12-19 12:17:41,216 - server - INFO - üî§ RAW TOKENS: ["Ye"‚úì, "ah."‚úì, "<end>"‚úì]
2025-12-19T12:17:41.218431808Z [err]  2025-12-19 12:17:41,216 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-19T12:17:41.218436278Z [err]  2025-12-19 12:17:41,216 - server - INFO - üßπ Cleaned transcript: 'Ye ah.' -> 'Yeah.'
2025-12-19T12:17:41.218442501Z [err]  2025-12-19 12:17:41,216 - server - INFO - üì• FINAL TOKENS: 'Yeah.' (2 tokens)
2025-12-19T12:17:41.218447100Z [err]  2025-12-19 12:17:41,216 - server - INFO - üé§ Soniox final transcript: 'Yeah.'
2025-12-19T12:17:41.221457610Z [err]  2025-12-19 12:17:41,219 - redis_service - INFO - üì¶ Stored call data in Redis: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA (TTL: 3600s)
2025-12-19T12:17:41.221462831Z [err]  2025-12-19 12:17:41,219 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-19T12:17:41.221467472Z [err]  2025-12-19 12:17:41,219 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:41.221471442Z [err]  2025-12-19 12:17:41,219 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Yeah.' - Processing...
2025-12-19T12:17:41.221493286Z [err]  2025-12-19 12:17:41,217 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:41.221501380Z [err]  2025-12-19 12:17:41,217 - server - INFO - üîç FILTER CHECK: words=1, is_filler=True, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-19T12:17:41.221507289Z [err]  2025-12-19 12:17:41,217 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:41.221514715Z [err]  2025-12-19 12:17:41,217 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-19T12:17:41.221600613Z [err]  2025-12-19 12:17:41,217 - server - INFO - ‚è±Ô∏è [12:17:41.217] üìù FINAL TRANSCRIPT RECEIVED: 'Yeah.'
2025-12-19T12:17:41.221607748Z [err]  2025-12-19 12:17:41,217 - server - INFO - ‚è±Ô∏è [12:17:41.217] STT endpoint detection latency: 13ms
2025-12-19T12:17:41.221614023Z [err]  2025-12-19 12:17:41,217 - server - INFO - ‚è±Ô∏è [12:17:41.217] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-19T12:17:41.236984049Z [err]  2025-12-19 12:17:41,230 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Yeah.
2025-12-19T12:17:41.236999390Z [err]  2025-12-19 12:17:41,230 - calling_service - INFO - üë§ User stopped speaking for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:41.237006741Z [err]  2025-12-19 12:17:41,230 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-19T12:17:41.237013823Z [err]  2025-12-19 12:17:41,230 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+6ms
2025-12-19T12:17:41.237020590Z [err]  2025-12-19 12:17:41,230 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 6ms (Soniox model: stt-rt-v3)
2025-12-19T12:17:41.237041786Z [err]  2025-12-19 12:17:41,231 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-19T12:17:41.237048045Z [err]  2025-12-19 12:17:41,231 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-19T12:17:41.237054201Z [err]  2025-12-19 12:17:41,231 - calling_service - INFO - ü§ñ Agent started speaking for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:41.325215650Z [err]  2025-12-19 12:17:41,321 - server - INFO - üìù Saved user transcript to database
2025-12-19T12:17:41.325224847Z [err]  2025-12-19 12:17:41,321 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:41.325231291Z [err]  2025-12-19 12:17:41,321 - calling_service - INFO - ‚è±Ô∏è [12:17:41.321] üì• process_user_input() ENTRY - text: 'Yeah....'
2025-12-19T12:17:41.325238391Z [err]  2025-12-19 12:17:41,321 - calling_service - INFO - ‚è±Ô∏è [12:17:41.321] ‚è© About to call _process_call_flow_streaming()
2025-12-19T12:17:41.325245867Z [err]  2025-12-19 12:17:41,321 - calling_service - INFO - ‚è±Ô∏è [12:17:41.321] üîÄ Agent type: call_flow, calling flow processor...
2025-12-19T12:17:41.325252465Z [err]  2025-12-19 12:17:41,321 - calling_service - INFO - ‚è±Ô∏è [12:17:41.321] üîÄ _process_call_flow_streaming() ENTRY
2025-12-19T12:17:41.325259667Z [err]  2025-12-19 12:17:41,321 - calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-19T12:17:41.325265840Z [err]  2025-12-19 12:17:41,321 - calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-19T12:17:41.325271907Z [err]  2025-12-19 12:17:41,321 - calling_service - INFO - ‚è±Ô∏è [12:17:41.321] üîÄ About to call _follow_transition() for: Yeah....
2025-12-19T12:17:41.325278694Z [err]  2025-12-19 12:17:41,321 - calling_service - INFO - Evaluating transitions from Greeting for message: Yeah.
2025-12-19T12:17:41.333605628Z [err]  2025-12-19 12:17:41,330 - calling_service - INFO - ‚è±Ô∏è [12:17:41.330] üîÄ TRANSITION EVALUATION START - Calling LLM for 4 options
2025-12-19T12:17:41.975637720Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - ü§ñ AI transition decision: '0'
2025-12-19T12:17:41.975655128Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - üìä Available transitions: ['Confirms name (Yes|Speaking|This is he/she|etc)...', 'Wrong number (No John here|Wrong number|etc) - don...', "The customer says let's set an appointment....", "Let's talk about my inances..."]
2025-12-19T12:17:41.975662340Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - Selected transition index: 0
2025-12-19T12:17:41.975688091Z [err]  2025-12-19 12:17:41,515 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:41.975695050Z [err]  2025-12-19 12:17:41,693 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-19T12:17:41.975714943Z [err]  2025-12-19 12:17:41,693 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146661.693748 for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:41.975716455Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - Transition: Greeting -> Node Prompt: N001B_IntroAndHelpRequest_Only (V3 - Follows Name Confirmation)
2025-12-19T12:17:41.975722779Z [err]  2025-12-19 12:17:41,693 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:41.975729214Z [err]  2025-12-19 12:17:41,694 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:41.975734699Z [err]  2025-12-19 12:17:41,954 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-19T12:17:41.975740657Z [err]  2025-12-19 12:17:41,961 - calling_service - INFO - ‚è±Ô∏è [12:17:41.961] üîÄ TRANSITION EVALUATION COMPLETE - took 631ms
2025-12-19T12:17:41.979788621Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 640ms
2025-12-19T12:17:41.979795163Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - ‚è±Ô∏è [12:17:41.962] ‚úÖ Node selected, about to process content...
2025-12-19T12:17:41.979801536Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - üîß Replaced {{now}} with Friday, December 19, 2025 at 7:17 AM EST in content
2025-12-19T12:17:41.979807542Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-19T12:17:41.979814679Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-19T12:17:41.979820700Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-19T12:17:41.979826811Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-19T12:17:41.979832590Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-19T12:17:41.979839019Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-19T12:17:41.979844900Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-19T12:17:41.979849492Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-19T12:17:41.979855285Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-19T12:17:41.979860316Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 89 chars) - will return text instantly
2025-12-19T12:17:41.979864463Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - Using flow node: Node Prompt: N001B_IntroAndHelpRequest_Only (V3 - Follows Name Confirmation) (type: conversation, mode: script)
2025-12-19T12:17:41.980697497Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - ‚è±Ô∏è [12:17:41.962] üìÑ About to process content (mode=script, length=89)
2025-12-19T12:17:41.980704648Z [err]  2025-12-19 12:17:41,962 - calling_service - INFO - üì§ Streaming script as 2 sentence(s)
2025-12-19T12:17:41.980710144Z [err]  2025-12-19 12:17:41,962 - server - INFO - üì§ Sentence arrived from LLM: This is Jake......
2025-12-19T12:17:41.980714903Z [err]  2025-12-19 12:17:41,962 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 731ms
2025-12-19T12:17:41.980719917Z [err]  2025-12-19 12:17:41,962 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-19T12:17:41.980725648Z [err]  2025-12-19 12:17:41,962 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:41.980736939Z [err]  2025-12-19 12:17:41,962 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-19T12:17:42.021077742Z [err]  2025-12-19 12:17:42,016 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:42.051250479Z [err]  2025-12-19 12:17:42,049 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:42.138554700Z [err]  2025-12-19 12:17:42,135 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:42.199135927Z [err]  2025-12-19 12:17:42,196 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:WY8VkMmef-iploqyw... (active sessions: [])
2025-12-19T12:17:42.223362110Z [err]  2025-12-19 12:17:42,221 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:42.247515370Z [err]  2025-12-19 12:17:42,245 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-19T12:17:42.247523408Z [err]  2025-12-19 12:17:42,246 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-19T12:17:42.247529058Z [err]  2025-12-19 12:17:42,246 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-19T12:17:42.247535857Z [err]  2025-12-19 12:17:42,246 - persistent_tts_service - INFO - üîå [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] Establishing persistent TTS WebSocket...
2025-12-19T12:17:42.247540797Z [err]  2025-12-19 12:17:42,246 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-19T12:17:42.247546064Z [err]  2025-12-19 12:17:42,246 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-19T12:17:42.247552086Z [err]  2025-12-19 12:17:42,246 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-19T12:17:42.385890832Z [err]  2025-12-19 12:17:42,379 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-19T12:17:42.385896153Z [err]  2025-12-19 12:17:42,380 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-19T12:17:42.385901239Z [err]  2025-12-19 12:17:42,380 - persistent_tts_service - INFO - ‚úÖ [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] Persistent TTS WebSocket established
2025-12-19T12:17:42.385906209Z [err]  2025-12-19 12:17:42,380 - persistent_tts_service - INFO - üéß [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] Audio receiver loop started
2025-12-19T12:17:42.385910661Z [err]  2025-12-19 12:17:42,380 - persistent_tts_service - INFO - üîä [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] Comfort noise loop started
2025-12-19T12:17:42.385916285Z [err]  2025-12-19 12:17:42,380 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:42.385921314Z [err]  2025-12-19 12:17:42,380 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-19T12:17:42.385927144Z [err]  2025-12-19 12:17:42,380 - server - INFO - üîç Persistent TTS lookup: call_id=v3:WY8VkMmef-iploqyw..., session=FOUND
2025-12-19T12:17:42.385932131Z [err]  2025-12-19 12:17:42,380 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-19T12:17:42.385936897Z [err]  2025-12-19 12:17:42,380 - server - INFO - üéµ TTS task #1 started at +417ms
2025-12-19T12:17:42.385942653Z [err]  2025-12-19 12:17:42,380 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 1149ms
2025-12-19T12:17:42.385948000Z [err]  2025-12-19 12:17:42,380 - calling_service - INFO - üì§ Streamed script sentence 1/2: This is Jake......
2025-12-19T12:17:42.385952069Z [err]  2025-12-19 12:17:42,380 - server - INFO - üì§ Sentence arrived from LLM: I was just, um, wondering if you could possibly he...
2025-12-19T12:17:42.388323467Z [err]  2025-12-19 12:17:42,380 - server - INFO - üîç Persistent TTS lookup: call_id=v3:WY8VkMmef-iploqyw..., session=FOUND
2025-12-19T12:17:42.388330966Z [err]  2025-12-19 12:17:42,380 - server - INFO - üöÄ Streaming sentence #2 via persistent WebSocket
2025-12-19T12:17:42.388336089Z [err]  2025-12-19 12:17:42,380 - server - INFO - üéµ TTS task #2 started at +417ms
2025-12-19T12:17:42.388340286Z [err]  2025-12-19 12:17:42,380 - calling_service - INFO - üì§ Streamed script sentence 2/2: I was just, um, wondering if you could possibly he...
2025-12-19T12:17:42.388344914Z [err]  2025-12-19 12:17:42,380 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user gave meaningful response) for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:42.388349497Z [err]  2025-12-19 12:17:42,380 - calling_service - INFO - üîä Silence tracking reset for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA (user responded)
2025-12-19T12:17:42.388353659Z [err]  2025-12-19 12:17:42,380 - calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-19T12:17:42.388357637Z [err]  2025-12-19 12:17:42,380 - calling_service - INFO - üíæ Storing node ID 1763159750250 in conversation history
2025-12-19T12:17:42.388361869Z [err]  2025-12-19 12:17:42,380 - calling_service - INFO - LLM response (1.06s): This is Jake... I was just, um, wondering if you could possibly help me out for a moment?
2025-12-19T12:17:42.388366205Z [err]  2025-12-19 12:17:42,380 - calling_service - INFO - Total latency: 1.06s
2025-12-19T12:17:42.388370442Z [err]  2025-12-19 12:17:42,380 - server - INFO - ‚úÖ LLM finished in 1149ms, TTS tasks already running in background
2025-12-19T12:17:42.388374489Z [err]  2025-12-19 12:17:42,380 - server - INFO - üéµ Streaming 2 TTS chunks as they complete...
2025-12-19T12:17:42.388378405Z [err]  2025-12-19 12:17:42,380 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-19T12:17:42.391595650Z [err]  2025-12-19 12:17:42,380 - server - INFO -    2 sentences queued and playing seamlessly
2025-12-19T12:17:42.391606476Z [err]  2025-12-19 12:17:42,381 - persistent_tts_service - INFO - üéµ [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] Playback consumer started
2025-12-19T12:17:42.391612873Z [err]  2025-12-19 12:17:42,381 - persistent_tts_service - INFO - üéß [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] Audio Receiver Loop STARTED
2025-12-19T12:17:42.391618466Z [err]  2025-12-19 12:17:42,381 - persistent_tts_service - INFO - üíì [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] Starting TTS keep-alive loop (every 15s)
2025-12-19T12:17:42.391623482Z [err]  2025-12-19 12:17:42,381 - persistent_tts_service - INFO - üîä [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] Starting comfort noise loop
2025-12-19T12:17:42.391629408Z [err]  2025-12-19 12:17:42,381 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-19T12:17:43.062545316Z [err]  2025-12-19 12:17:42,518 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:43.062551746Z [err]  2025-12-19 12:17:43,018 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:43.246026520Z [err]  2025-12-19 12:17:43,242 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-19T12:17:43.355748091Z [err]  2025-12-19 12:17:43,353 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-19T12:17:43.357039601Z [err]  2025-12-19 12:17:43,354 - persistent_tts_service - INFO - üé§ [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] Streaming sentence #1: This is Jake......
2025-12-19T12:17:43.357056258Z [err]  2025-12-19 12:17:43,354 - persistent_tts_service - INFO - üöÄ [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-19T12:17:43.357068057Z [err]  2025-12-19 12:17:43,354 - persistent_tts_service - INFO - üìä [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-19T12:17:43.357075590Z [err]  2025-12-19 12:17:43,354 - persistent_tts_service - INFO - üé§ [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] Streaming sentence #2: I was just, um, wondering if you could possibly he...
2025-12-19T12:17:43.357082752Z [err]  2025-12-19 12:17:43,354 - persistent_tts_service - INFO - üöÄ [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] Sent sentence #2 (NON-BLOCKING) in 0ms
2025-12-19T12:17:43.357091075Z [err]  2025-12-19 12:17:43,354 - persistent_tts_service - INFO - üìä [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] DIAGNOSTIC: pending_sentences=2, audio_queue=0, is_first=False, is_last=False
2025-12-19T12:17:43.357099948Z [err]  2025-12-19 12:17:43,354 - persistent_tts_service - INFO - üéß [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] Receiver processing sentence #1: 'This is Jake......'
2025-12-19T12:17:43.357107257Z [err]  2025-12-19 12:17:43,354 - persistent_tts_service - INFO - üìä [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] DIAGNOSTIC: queue_latency=0ms, pending_sentences=1, audio_queue=0, interrupted=False
2025-12-19T12:17:43.360216765Z [err]  2025-12-19 12:17:43,356 - server - INFO - ‚úÖ All 2 persistent TTS streams completed
2025-12-19T12:17:43.360227732Z [err]  2025-12-19 12:17:43,356 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-19T12:17:43.360646293Z [err]  2025-12-19 12:17:43,356 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 2125ms from user stop üöÄ
2025-12-19T12:17:43.360664903Z [err]  2025-12-19 12:17:43,356 - calling_service - INFO - ü§ñ Agent started speaking for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:43.360671851Z [err]  2025-12-19 12:17:43,356 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-19T12:17:43.360680584Z [err]  2025-12-19 12:17:43,356 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-19T12:17:43.360688296Z [err]  2025-12-19 12:17:43,356 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-19T12:17:43.360695321Z [err]  2025-12-19 12:17:43,356 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 6ms (provider: soniox, model: stt-rt-v3)
2025-12-19T12:17:43.360701163Z [err]  2025-12-19 12:17:43,356 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 1149ms (provider: grok, model: grok-4-fast-non-reasoning)
2025-12-19T12:17:43.360723054Z [err]  2025-12-19 12:17:43,356 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 1393ms (provider: elevenlabs, websocket: False)
2025-12-19T12:17:43.360730387Z [err]  2025-12-19 12:17:43,356 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 2125ms (user stopped ‚Üí play_audio_url called)
2025-12-19T12:17:43.360736997Z [err]  2025-12-19 12:17:43,356 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-19T12:17:43.360743822Z [err]  2025-12-19 12:17:43,356 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-19T12:17:43.365966395Z [err]  2025-12-19 12:17:43,356 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-19T12:17:43.365980808Z [err]  2025-12-19 12:17:43,356 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-19T12:17:43.365987412Z [err]  2025-12-19 12:17:43,356 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-19T12:17:43.365995702Z [err]  2025-12-19 12:17:43,356 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 2425ms estimated
2025-12-19T12:17:43.366002930Z [err]  2025-12-19 12:17:43,357 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 89 chars, 2 sentences
2025-12-19T12:17:43.366010084Z [err]  2025-12-19 12:17:43,357 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Yeah....'
2025-12-19T12:17:43.366017092Z [err]  2025-12-19 12:17:43,357 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: 'This is Jake... I was just, um, wondering if you could possi...'
2025-12-19T12:17:43.366023451Z [err]  2025-12-19 12:17:43,357 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-19T12:17:43.366029015Z [err]  2025-12-19 12:17:43,357 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-19T12:17:44.067650102Z [err]  2025-12-19 12:17:43,614 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-19T12:17:44.067660164Z [err]  2025-12-19 12:17:43,614 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.2s (total: 1.2s from now)
2025-12-19T12:17:44.067670862Z [err]  2025-12-19 12:17:43,615 - persistent_tts_service - INFO - ‚úÖ Sent 61 audio chunks via WebSocket
2025-12-19T12:17:44.067673901Z [err]  2025-12-19 12:17:43,519 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:44.067674287Z [err]  2025-12-19 12:17:43,677 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-19T12:17:44.067681671Z [err]  2025-12-19 12:17:43,534 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Node Prompt: N001B_IntroAndHelpRequest_Only (V3 - Follows Name Confirmation), Dead Air: 1655ms)
2025-12-19T12:17:44.067690496Z [err]  2025-12-19 12:17:43,681 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-19T12:17:44.067690537Z [err]  2025-12-19 12:17:43,534 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-19T12:17:44.067698580Z [err]  2025-12-19 12:17:43,534 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-19T12:17:44.067706303Z [err]  2025-12-19 12:17:43,614 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 259ms
2025-12-19T12:17:44.067712002Z [err]  2025-12-19 12:17:43,614 - persistent_tts_service - INFO - üì§ Sending 9643 bytes of audio (61 chunks, 1.2s duration) via WebSocket
2025-12-19T12:17:44.072784842Z [err]  2025-12-19 12:17:43,682 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:44.072790803Z [err]  2025-12-19 12:17:43,815 - persistent_tts_service - INFO - üì§ Sending 13375 bytes of audio (84 chunks, 1.7s duration) via WebSocket
2025-12-19T12:17:44.072796790Z [err]  2025-12-19 12:17:43,815 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-19T12:17:44.072814113Z [err]  2025-12-19 12:17:43,815 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.7s (total: 2.7s from now)
2025-12-19T12:17:44.072820745Z [err]  2025-12-19 12:17:43,816 - persistent_tts_service - INFO - ‚úÖ Sent 84 audio chunks via WebSocket
2025-12-19T12:17:44.072827350Z [err]  2025-12-19 12:17:44,000 - persistent_tts_service - INFO - üì§ Sending 17833 bytes of audio (112 chunks, 2.2s duration) via WebSocket
2025-12-19T12:17:44.072834919Z [err]  2025-12-19 12:17:44,000 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-19T12:17:44.072896135Z [err]  2025-12-19 12:17:44,000 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +2.2s (total: 4.7s from now)
2025-12-19T12:17:44.072907368Z [err]  2025-12-19 12:17:44,002 - persistent_tts_service - INFO - ‚úÖ Sent 112 audio chunks via WebSocket
2025-12-19T12:17:44.072915370Z [err]  2025-12-19 12:17:44,021 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:45.094597203Z [err]  2025-12-19 12:17:44,524 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-19T12:17:45.094608836Z [err]  2025-12-19 12:17:44,524 - calling_service - INFO - ü§ñ Agent started speaking for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:45.094620362Z [err]  2025-12-19 12:17:44,524 - telnyx_service - INFO - üîä Speaking text on call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw: Are you still there?...
2025-12-19T12:17:45.094630560Z [err]  2025-12-19 12:17:44,524 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-19T12:17:45.094684608Z [err]  2025-12-19 12:17:44,524 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-19T12:17:45.094694484Z [err]  2025-12-19 12:17:44,524 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-19T12:17:45.094704151Z [err]  2025-12-19 12:17:44,525 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-19T12:17:45.094712345Z [err]  2025-12-19 12:17:44,525 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-19T12:17:45.094794065Z [err]  2025-12-19 12:17:44,523 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:45.094806215Z [err]  2025-12-19 12:17:44,523 - calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-19T12:17:45.094809050Z [err]  2025-12-19 12:17:44,525 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-19T12:17:45.094819213Z [err]  2025-12-19 12:17:44,524 - calling_service - INFO - üí¨ Sending FINAL check-in #2/2: Are you still there?
2025-12-19T12:17:45.094822023Z [err]  2025-12-19 12:17:44,525 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:17:45.094830277Z [err]  2025-12-19 12:17:44,524 - calling_service - INFO - ‚ö†Ô∏è Will end call if no response after next silence timeout
2025-12-19T12:17:45.100416123Z [err]  2025-12-19 12:17:44,525 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:17:45.100422472Z [err]  2025-12-19 12:17:44,803 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:17:45.100427732Z [err]  2025-12-19 12:17:44,804 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.28s
2025-12-19T12:17:45.100432903Z [err]  2025-12-19 12:17:44,804 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-19T12:17:45.100439113Z [err]    "errors": [
2025-12-19T12:17:45.100444833Z [err]      {
2025-12-19T12:17:45.100450260Z [err]        "code": "90018",
2025-12-19T12:17:45.100454875Z [err]        "title": "Call has already ended",
2025-12-19T12:17:45.100459428Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-19T12:17:45.100463940Z [err]      }
2025-12-19T12:17:45.100469089Z [err]    ]
2025-12-19T12:17:45.100473855Z [err]  }
2025-12-19T12:17:45.100478340Z [err]  2025-12-19 12:17:44,804 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-19T12:17:45.100487049Z [err]  2025-12-19 12:17:45,060 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:17:45.100491847Z [err]  2025-12-19 12:17:45,061 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-19T12:17:45.100496861Z [err]  2025-12-19 12:17:45,061 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-19T12:17:45.187396487Z [err]  2025-12-19 12:17:45,184 - server - INFO - üì§ Audio flowing: 540 packets sent to Soniox (5s update)
2025-12-19T12:17:45.371506888Z [err]  2025-12-19 12:17:45,365 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (3.4s left)
2025-12-19T12:17:46.264243369Z [err]  2025-12-19 12:17:45,563 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:46.264249986Z [err]  2025-12-19 12:17:45,564 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:46.264254978Z [err]  2025-12-19 12:17:45,625 - server - INFO - üé§ Soniox receiver alive - 12 messages received in last 10s
2025-12-19T12:17:46.264259768Z [err]  2025-12-19 12:17:45,867 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (2.9s left)
2025-12-19T12:17:46.264264565Z [err]  2025-12-19 12:17:46,000 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-19T12:17:46.264269503Z [err]  2025-12-19 12:17:46,000 - persistent_tts_service - INFO - ‚úÖ [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] Receiver finished sentence #1: 3 chunks in 2646ms
2025-12-19T12:17:46.264274671Z [err]  2025-12-19 12:17:46,000 - persistent_tts_service - INFO - üéß [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] Receiver processing sentence #2: 'I was just, um, wondering if y...'
2025-12-19T12:17:46.264279540Z [err]  2025-12-19 12:17:46,000 - persistent_tts_service - INFO - üìä [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] DIAGNOSTIC: queue_latency=2646ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-19T12:17:46.264284838Z [err]  2025-12-19 12:17:46,066 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:46.264290022Z [err]  2025-12-19 12:17:46,067 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:47.100888878Z [err]  2025-12-19 12:17:46,568 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:47.100895008Z [err]  2025-12-19 12:17:46,568 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:47.100902382Z [err]  2025-12-19 12:17:47,071 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:47.100908421Z [err]  2025-12-19 12:17:47,071 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:47.171900739Z [err]  2025-12-19 12:17:47,166 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:47.171906633Z [err]  2025-12-19 12:17:47,166 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'cf428bf9-3a87-4049-bd90-a50e3fbac62e', 'occurred_at': '2025-12-19T12:17:46.915979Z', 'payload': {'call_control_id': 'v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA', 'call_leg_id': 'b0f7bbe8-dcd4-11f0-867c-02420aef96a0', 'call_session_id': 'b0f429a6-dcd4-11f0-b3cc-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-19T12:17:46.915979Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'pt0P_jSG4w', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:47.171911314Z [err]  2025-12-19 12:17:47,166 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:47.171915743Z [err]  2025-12-19 12:17:47,166 - server - INFO - üì® ================================================
2025-12-19T12:17:47.171922493Z [err]  2025-12-19 12:17:47,167 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 628 total packets
2025-12-19T12:17:47.171927412Z [err]  [2025-12-19 12:17:47 +0000] [3] [INFO] connection closed
2025-12-19T12:17:47.171931975Z [err]  2025-12-19 12:17:47,168 - redis_service - INFO - ‚ûñ Removed playback pt0P_jSG4w, 0 remaining for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:47.171936494Z [err]  2025-12-19 12:17:47,168 - server - INFO - üîä Redis: Removed playback pt0P_jSG4w, 0 remaining
2025-12-19T12:17:47.171943294Z [err]  2025-12-19 12:17:47,168 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-19T12:17:47.176065878Z [inf]  100.64.0.9:43590 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:47.176072192Z [err]  2025-12-19 12:17:47,168 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-19T12:17:47.176076801Z [err]  2025-12-19 12:17:47,168 - server - INFO - ‚úÖ Found session in active_telnyx_calls (local worker)
2025-12-19T12:17:47.176081126Z [err]  2025-12-19 12:17:47,168 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146667.168899 for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:47.176085507Z [err]  2025-12-19 12:17:47,168 - server - INFO - ‚è±Ô∏è Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-19T12:17:47.191665588Z [err]  2025-12-19 12:17:47,186 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:47.191679146Z [err]  2025-12-19 12:17:47,186 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': '36be9ff5-8328-45eb-86ca-023ddcd24259', 'occurred_at': '2025-12-19T12:17:46.835969Z', 'payload': {'call_control_id': 'v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA', 'call_leg_id': 'b0f7bbe8-dcd4-11f0-867c-02420aef96a0', 'call_quality_stats': {'inbound': {'jitter_max_variance': '408.33', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '653', 'skip_packet_count': '21'}, 'outbound': {'packet_count': '633', 'skip_packet_count': '0'}}, 'call_session_id': 'b0f429a6-dcd4-11f0-b3cc-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-19T12:17:46.835969Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-19T12:17:30.976124Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:47.191685168Z [err]  2025-12-19 12:17:47,186 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:47.191691136Z [err]  2025-12-19 12:17:47,186 - server - INFO - üì® ================================================
2025-12-19T12:17:47.191698006Z [err]  2025-12-19 12:17:47,186 - server - INFO - üìû Call ended: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:47.191703845Z [err]  2025-12-19 12:17:47,186 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-19T12:17:47.373931223Z [err]  2025-12-19 12:17:47,371 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-19T12:17:47.373943618Z [err]  2025-12-19 12:17:47,371 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146667.3714828 for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:47.373957457Z [err]  2025-12-19 12:17:47,371 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:47.379766639Z [err]  2025-12-19 12:17:47,375 - server - INFO - üìù Updated call log: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:48.008929770Z [err]  2025-12-19 12:17:47,447 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:48.008941973Z [err]  2025-12-19 12:17:47,448 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': '38324a13-4499-47dc-bd1e-0c00266ee4a1', 'occurred_at': '2025-12-19T12:17:47.093632Z', 'payload': {'call_control_id': 'v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA', 'call_leg_id': 'b0f7bbe8-dcd4-11f0-867c-02420aef96a0', 'call_session_id': 'b0f429a6-dcd4-11f0-b3cc-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': 'f0502258-91e2-4747-a809-480d43d36614', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:48.008953680Z [err]  2025-12-19 12:17:47,448 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:48.008969896Z [err]  2025-12-19 12:17:47,448 - server - INFO - üì® ================================================
2025-12-19T12:17:48.008978404Z [inf]  100.64.0.7:57388 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:48.008989586Z [err]  2025-12-19 12:17:47,472 - server - INFO - ‚úÖ Finalized call log: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA (duration=13s, status=completed)
2025-12-19T12:17:48.009002501Z [err]  2025-12-19 12:17:47,573 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:48.009011760Z [err]  2025-12-19 12:17:47,573 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:JfW00dj0CYnk2SRNr... (active sessions: [])
2025-12-19T12:17:48.009020019Z [err]  2025-12-19 12:17:47,949 - server - INFO - üé§ Soniox receiver alive - 13 messages received in last 10s
2025-12-19T12:17:48.013107273Z [err]  2025-12-19 12:17:47,949 - server - ERROR - ‚ùå Soniox error: {'tokens': [], 'final_audio_proc_ms': 7320, 'total_audio_proc_ms': 9480, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-19T12:17:48.013112629Z [err]  2025-12-19 12:17:47,949 - server - INFO - ‚úÖ Soniox receive loop ended normally
2025-12-19T12:17:48.013117135Z [err]  2025-12-19 12:17:47,950 - dead_air_monitor - INFO - üîá Dead air monitoring cancelled for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:48.013122041Z [err]  2025-12-19 12:17:47,951 - dead_air_monitor - INFO - üîá Dead air monitoring stopped for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:48.013127397Z [err]  2025-12-19 12:17:47,951 - server - INFO - üîá Dead air monitoring task cancelled
2025-12-19T12:17:48.222070509Z [err]  2025-12-19 12:17:48,218 - server - INFO - üìä Auto-added call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-19T12:17:48.380298389Z [err]  2025-12-19 12:17:48,378 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-19T12:17:48.383637075Z [err]  2025-12-19 12:17:48,381 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Expecting value: line 1 column 1 (char 0)
2025-12-19T12:17:48.410014644Z [err]  2025-12-19 12:17:48,407 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-19T12:17:48.410025012Z [err]  2025-12-19 12:17:48,408 - redis_service - INFO - üì• Retrieved call data from Redis: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:48.413053967Z [err]  2025-12-19 12:17:48,408 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=No
2025-12-19T12:17:48.413061780Z [err]  2025-12-19 12:17:48,409 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-19T12:17:49.012391872Z [err]  2025-12-19 12:17:48,597 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-19T12:17:49.012402449Z [err]  2025-12-19 12:17:48,597 - server - INFO - üöÄ Triggered QC analysis for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:49.012419200Z [err]  2025-12-19 12:17:48,503 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-19T12:17:49.012427463Z [err]  2025-12-19 12:17:48,588 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:49.012432989Z [err]  2025-12-19 12:17:48,596 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=6944df147eadbccc46887cdf, to_number=+17708336397
2025-12-19T12:17:49.012438757Z [err]  2025-12-19 12:17:48,596 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=6944df147eadbccc46887cdf, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3-antigrav
2025-12-19T12:17:49.012467954Z [err]  2025-12-19 12:17:48,473 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:49.012474956Z [err]  2025-12-19 12:17:48,473 - server - INFO - ‚úÖ QC analysis completed for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:49.012481596Z [err]  2025-12-19 12:17:48,473 - server - INFO - üìä Scores: Commitment=50, Conversion=20, Excellence=50
2025-12-19T12:17:49.012488600Z [err]  2025-12-19 12:17:48,501 - elevenlabs_ws_service - WARNING - ‚ö†Ô∏è  [TIMING] ElevenLabs timeout waiting for first chunk (2.5s) - No audio received!
2025-12-19T12:17:49.012494348Z [err]  2025-12-19 12:17:48,501 - persistent_tts_service - WARNING - ‚ö†Ô∏è [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] Receiver got 0 chunks for sentence #2! interrupted=False
2025-12-19T12:17:49.012499787Z [err]  2025-12-19 12:17:48,502 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-19T12:17:49.015391908Z [err]  2025-12-19 12:17:48,600 - server - INFO - üìá Normalized phone: +17708336397
2025-12-19T12:17:49.015398631Z [err]  2025-12-19 12:17:48,597 - server - INFO - üìä Triggered Campaign QC for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:49.015400534Z [err]  2025-12-19 12:17:48,648 - server - INFO - üìä Updated campaign_calls with QC scores for v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw
2025-12-19T12:17:49.015407161Z [err]  2025-12-19 12:17:48,597 - server - INFO - üìá Triggered CRM update for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:49.015407328Z [err]  2025-12-19 12:17:48,674 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:49.015414523Z [err]  2025-12-19 12:17:48,597 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:49.015421870Z [err]  2025-12-19 12:17:48,598 - redis_service - INFO - üßπ Deleted call data from Redis: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:49.015428582Z [err]  2025-12-19 12:17:48,598 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:49.015436446Z [inf]  100.64.0.11:62122 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:49.015443445Z [err]  2025-12-19 12:17:48,599 - server - INFO - üîç Starting QC analysis for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:49.015448704Z [err]  2025-12-19 12:17:48,599 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=6944df147eadbccc46887cdf
2025-12-19T12:17:49.015453417Z [err]  2025-12-19 12:17:48,600 - server - INFO - üìá CRM update starting for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:17:49.017720286Z [err]  2025-12-19 12:17:48,693 - server - INFO - üìù Converted transcript from 3 messages to 133 characters
2025-12-19T12:17:49.017727433Z [err]  2025-12-19 12:17:48,706 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-19T12:17:49.017734118Z [err]  2025-12-19 12:17:48,706 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-19T12:17:49.017740959Z [err]  2025-12-19 12:17:48,706 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-19T12:17:49.017747817Z [err]  2025-12-19 12:17:48,706 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-19T12:17:49.017754473Z [err]  2025-12-19 12:17:48,746 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:49.017761676Z [err]  2025-12-19 12:17:48,746 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '1f227794-7ca0-4c20-a411-62baaa96a835', 'occurred_at': '2025-12-19T12:17:48.227021Z', 'payload': {'call_control_id': 'v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA', 'call_leg_id': 'b0f7bbe8-dcd4-11f0-867c-02420aef96a0', 'call_session_id': 'b0f429a6-dcd4-11f0-b3cc-02420aef96a0', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-19T12:17:46.974483Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-19T12:17:46.974483Z', 'recording_id': '713e7473-42ce-4d90-8003-947e2acca460', 'recording_started_at': '2025-12-19T12:17:35.756258Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-19/b0f7bbe8-dcd4-11f0-867c-02420aef96a0-1766146654852735.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251219%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251219T121748Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=484791efcd92d322c69af97c01f8f36a3474fe9fb2390cd074e8ed507e562f4a'}, 'start_time': '2025-12-19T12:17:35.756258Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:49.020850502Z [err]  2025-12-19 12:17:48,746 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:49.020859232Z [err]  2025-12-19 12:17:48,746 - server - INFO - üì® ================================================
2025-12-19T12:17:49.020866051Z [err]  2025-12-19 12:17:48,746 - server - INFO - üéôÔ∏è Recording saved for call: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:49.020872550Z [err]  2025-12-19 12:17:48,747 - redis_service - WARNING - ‚ö†Ô∏è Call data not found in Redis: v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:49.020879431Z [err]  2025-12-19 12:17:48,747 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=713e7473-42ce-4d90-8003-947e2acca460, call_data=False
2025-12-19T12:17:49.020886058Z [err]  2025-12-19 12:17:48,788 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:49.020893363Z [err]  2025-12-19 12:17:48,822 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-19T12:17:49.020900635Z [err]  2025-12-19 12:17:48,833 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-19T12:17:49.020907147Z [err]  2025-12-19 12:17:48,834 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-19T12:17:49.020914391Z [err]  2025-12-19 12:17:48,884 - server - INFO - üíæ Saved recording URL and ID to database: 713e7473-42ce-4d90-8003-947e2acca460
2025-12-19T12:17:49.020920358Z [err]  2025-12-19 12:17:48,884 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-19T12:17:49.020927107Z [err]  2025-12-19 12:17:48,884 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-19T12:17:49.020933487Z [err]  2025-12-19 12:17:48,908 - server - INFO - üè∑Ô∏è Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-19T12:17:49.024380516Z [err]  2025-12-19 12:17:48,908 - server - ERROR - ‚ùå Error in auto appointment detection for call v3:JfW00dj0CYnk2SRNrsMDLCNRrT9p2NyfHa4j2kKoqUysNxaa9XKNsw: 'str' object has no attribute 'get'
2025-12-19T12:17:49.024393760Z [err]  2025-12-19 12:17:48,976 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-19T12:17:49.073596538Z [err]  2025-12-19 12:17:49,069 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-19T12:17:49.073604825Z [err]  2025-12-19 12:17:49,069 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:17:49.073609873Z [err]  2025-12-19 12:17:49,069 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:49.155615649Z [err]  2025-12-19 12:17:49,149 - server - INFO - üìá CRM: Total variables collected: []
2025-12-19T12:17:49.175139140Z [err]  2025-12-19 12:17:49,165 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=3, logs_count=4, status=completed
2025-12-19T12:17:49.280323677Z [err]  2025-12-19 12:17:49,277 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-19/b0f7bbe8-dcd4-11f0-867c-02420aef96a0-1766146654852735.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251219%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251219T121748Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=484791efcd92d322c69af97c01f8f36a3474fe9fb2390cd074e8ed507e562f4a "HTTP/1.1 200 OK"
2025-12-19T12:17:49.327782145Z [err]  2025-12-19 12:17:49,325 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name']
2025-12-19T12:17:49.372340222Z [err]  2025-12-19 12:17:49,368 - server - INFO - ‚úÖ Downloaded 44973 bytes
2025-12-19T12:17:50.027177852Z [err]  2025-12-19 12:17:49,565 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-19T12:17:50.027182541Z [err]  2025-12-19 12:17:49,569 - telnyx_service - INFO - ‚úÖ Call initiated: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:50.027187567Z [err]  2025-12-19 12:17:49,570 - server - INFO - ‚úÖ Split into 2 channels
2025-12-19T12:17:50.027192141Z [err]  2025-12-19 12:17:49,570 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-19T12:17:50.027429573Z [err]  2025-12-19 12:17:49,571 - server - INFO - üìä Channel 0: 243804 bytes
2025-12-19T12:17:50.027434056Z [err]  2025-12-19 12:17:49,571 - server - ERROR - ‚ùå No Soniox API key available
2025-12-19T12:17:50.027438187Z [err]  2025-12-19 12:17:49,571 - server - INFO - ‚ùå Channel 0: No speech
2025-12-19T12:17:50.027442127Z [err]  2025-12-19 12:17:49,571 - server - INFO - üìä Channel 1: 243804 bytes
2025-12-19T12:17:50.027446480Z [err]  2025-12-19 12:17:49,571 - server - ERROR - ‚ùå No Soniox API key available
2025-12-19T12:17:50.027451146Z [err]  2025-12-19 12:17:49,571 - server - INFO - ‚ùå Channel 1: No speech
2025-12-19T12:17:50.027455934Z [err]  2025-12-19 12:17:49,571 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-19T12:17:50.027460551Z [inf]  100.64.0.11:62122 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:50.027466072Z [err]  2025-12-19 12:17:49,572 - persistent_tts_service - INFO - üîá [Call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA] FLOOR RELEASED (is_holding_floor=False)
2025-12-19T12:17:50.027470521Z [err]  2025-12-19 12:17:49,596 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3-antigrav, has_auto_qc_settings=True
2025-12-19T12:17:50.027475647Z [err]  2025-12-19 12:17:49,657 - server - INFO - üìù Created call log: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:50.027810002Z [err]  2025-12-19 12:17:49,657 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-19T12:17:50.027816083Z [err]  2025-12-19 12:17:49,657 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-19T12:17:50.028071757Z [err]  2025-12-19 12:17:49,657 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-19T12:17:50.028077974Z [err]  2025-12-19 12:17:49,657 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-19T12:17:50.030296478Z [err]  2025-12-19 12:17:49,664 - redis_service - INFO - üì¶ Stored call data in Redis: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw (TTL: 3600s)
2025-12-19T12:17:50.030304461Z [err]  2025-12-19 12:17:49,664 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-19T12:17:50.030310049Z [err]  2025-12-19 12:17:49,664 - server - INFO - üìû Outbound call initiated: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:50.030315543Z [inf]  100.64.0.14:62626 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-19T12:17:50.030319413Z [err]  2025-12-19 12:17:49,683 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-19T12:17:50.030323638Z [err]  2025-12-19 12:17:49,683 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-19T12:17:50.030327645Z [err]  2025-12-19 12:17:49,683 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-19T12:17:50.030331497Z [err]  2025-12-19 12:17:49,684 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-19T12:17:50.030335298Z [err]    File "/app/backend/server.py", line 9698, in trigger_campaign_qc_for_call
2025-12-19T12:17:50.030339912Z [err]      await run_full_qc_analysis(
2025-12-19T12:17:50.032148321Z [err]  2025-12-19 12:17:49,776 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'aH0TP6jSDYy0H7CD+2H+lw==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'nSgehQCkSJa-QIUe2prcFg', 'x-real-ip': '192.76.120.151', 'x-request-start': '1766146669515', 'accept-encoding': 'gzip'}
2025-12-19T12:17:50.032161011Z [err]  2025-12-19 12:17:49,777 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-19T12:17:50.032170400Z [err]  2025-12-19 12:17:49,777 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-19T12:17:50.032174470Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-19T12:17:50.032178094Z [err]  [2025-12-19 12:17:49 +0000] [6] [INFO] ('100.64.0.5', 22920) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-19T12:17:50.032180844Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-19T12:17:50.032186539Z [err]  2025-12-19 12:17:49,777 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-19T12:17:50.032188784Z [err]  
2025-12-19T12:17:50.032194258Z [err]  [2025-12-19 12:17:49 +0000] [6] [INFO] connection open
2025-12-19T12:17:50.032196615Z [err]  2025-12-19 12:17:49,776 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-19T12:17:50.032202855Z [err]  2025-12-19 12:17:49,776 - server - INFO -    Client: Address(host='100.64.0.5', port=22920)
2025-12-19T12:17:50.032203904Z [err]  2025-12-19 12:17:49,819 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:50.032210950Z [err]  2025-12-19 12:17:49,819 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': 'd77c29a3-3918-4a0d-81b0-af6a76867dd7', 'occurred_at': '2025-12-19T12:17:49.329215Z', 'payload': {'call_control_id': 'v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw', 'call_leg_id': 'bbcc78f6-dcd4-11f0-abed-02420aef951f', 'call_session_id': 'bbc9f4fa-dcd4-11f0-80d5-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:50.032831606Z [err]  2025-12-19 12:17:49,819 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:50.032837643Z [err]  2025-12-19 12:17:49,819 - server - INFO - üì® ================================================
2025-12-19T12:17:50.032843437Z [err]  2025-12-19 12:17:49,819 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-19T12:17:50.032849353Z [inf]  100.64.0.12:10068 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:50.032855240Z [err]  2025-12-19 12:17:49,928 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-19T12:17:50.032860856Z [err]  2025-12-19 12:17:49,928 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-19T12:17:50.032867240Z [err]  2025-12-19 12:17:49,951 - soniox_service - ERROR - ‚ùå Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-19T12:17:50.032873867Z [err]  2025-12-19 12:17:49,951 - server - INFO - üîå Telnyx WebSocket disconnected
2025-12-19T12:17:50.032880488Z [err]  2025-12-19 12:17:49,993 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-19T12:17:50.032888405Z [err]  2025-12-19 12:17:49,994 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-19T12:17:50.079260430Z [err]  2025-12-19 12:17:50,073 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=2.7s, checkin_count=0/2
2025-12-19T12:17:51.050826174Z [err]  2025-12-19 12:17:50,573 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=3.2s, checkin_count=0/2
2025-12-19T12:17:52.032225285Z [err]  2025-12-19 12:17:52,028 - server - INFO - üì¨ Received Telnyx event: start
2025-12-19T12:17:52.032231739Z [err]  2025-12-19 12:17:52,028 - server - INFO - üé¨ Stream started for call: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:52.034146668Z [err]  2025-12-19 12:17:52,032 - redis_service - INFO - üì• Retrieved call data from Redis: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:52.041724587Z [err]  2025-12-19 12:17:52,035 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:52.041736976Z [err]  2025-12-19 12:17:52,035 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': 'b5005074-ffc0-46bb-a281-0fa6c27a0799', 'occurred_at': '2025-12-19T12:17:51.749220Z', 'payload': {'call_control_id': 'v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw', 'call_leg_id': 'bbcc78f6-dcd4-11f0-abed-02420aef951f', 'call_session_id': 'bbc9f4fa-dcd4-11f0-80d5-02420aef951f', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-19T12:17:49.329215Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:52.041745370Z [err]  2025-12-19 12:17:52,035 - server - INFO - üéØ Event type: call.answered, Call ID: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:52.041755762Z [err]  2025-12-19 12:17:52,035 - server - INFO - üì® ================================================
2025-12-19T12:17:52.041762668Z [err]  2025-12-19 12:17:52,036 - server - INFO - ‚úÖ Call answered: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:52.041771600Z [err]  2025-12-19 12:17:52,036 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-19T12:17:52.041778105Z [err]  2025-12-19 12:17:52,036 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-19T12:17:52.044591623Z [err]  2025-12-19 12:17:52,041 - redis_service - INFO - üì• Retrieved call data from Redis: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:52.046716044Z [err]  2025-12-19 12:17:52,043 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-19T12:17:52.046723445Z [err]  2025-12-19 12:17:52,043 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-19T12:17:52.134272394Z [err]  2025-12-19 12:17:52,132 - server - INFO - ‚úÖ Call log updated
2025-12-19T12:17:52.134282040Z [err]  2025-12-19 12:17:52,132 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-19T12:17:52.134289834Z [err]  2025-12-19 12:17:52,132 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-19T12:17:52.134296567Z [err]  2025-12-19 12:17:52,132 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:17:52.221486579Z [err]  2025-12-19 12:17:52,218 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:52.308682022Z [err]  2025-12-19 12:17:52,304 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:52.308688224Z [err]  2025-12-19 12:17:52,305 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-19T12:17:52.341910946Z [err]  2025-12-19 12:17:52,340 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-19T12:17:52.345821443Z [err]  2025-12-19 12:17:52,342 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-19T12:17:52.345825356Z [err]  2025-12-19 12:17:52,342 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-19T12:17:53.018277968Z [err]  2025-12-19 12:17:52,536 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-19T12:17:53.018285128Z [err]  2025-12-19 12:17:52,536 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-19T12:17:53.018306206Z [err]  2025-12-19 12:17:52,540 - redis_service - INFO - üì• Retrieved call data from Redis: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:53.018313481Z [err]  2025-12-19 12:17:52,542 - server - INFO - üìù Creating session with agent_id=6944df147eadbccc46887cdf, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:17:53.018319781Z [err]  2025-12-19 12:17:52,542 - calling_service - INFO - üîç Checking KB for agent 6944df147eadbccc46887cdf...
2025-12-19T12:17:53.018326277Z [err]  2025-12-19 12:17:52,602 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:53.018332755Z [inf]  100.64.0.5:42070 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:53.018339719Z [err]  2025-12-19 12:17:52,603 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': 'cbec7708-ec0c-444f-a2a2-90960aa6b3db', 'occurred_at': '2025-12-19T12:17:52.149222Z', 'payload': {'call_control_id': 'v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw', 'call_leg_id': 'bbcc78f6-dcd4-11f0-abed-02420aef951f', 'call_session_id': 'bbc9f4fa-dcd4-11f0-80d5-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': 'ed00cf9d-dc7c-4abb-932c-935d54f58089', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:53.018348983Z [err]  2025-12-19 12:17:52,603 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:53.021592996Z [err]  2025-12-19 12:17:52,603 - server - INFO - üì® ================================================
2025-12-19T12:17:53.021598954Z [err]  2025-12-19 12:17:52,607 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw/actions/playback_start "HTTP/1.1 200 OK"
2025-12-19T12:17:53.021604707Z [err]  2025-12-19 12:17:52,608 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: 9DHK5lucag (loop=True, overlay=True)
2025-12-19T12:17:53.021611589Z [err]  2025-12-19 12:17:52,608 - server - WARNING - ‚ö†Ô∏è Failed to start comfort noise: 'v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw'
2025-12-19T12:17:53.021616076Z [err]  2025-12-19 12:17:52,608 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:53.021619961Z [err]  2025-12-19 12:17:52,641 - calling_service - INFO - üîç KB count query completed: 0 items
2025-12-19T12:17:53.021623895Z [err]  2025-12-19 12:17:52,652 - calling_service - INFO - üìã Built cached system prompt: 5480 chars (global) + 1402 chars (technical)
2025-12-19T12:17:53.021627758Z [err]  2025-12-19 12:17:52,653 - calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-19T12:17:53.021631710Z [err]  2025-12-19 12:17:52,740 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:53.021636312Z [err]  2025-12-19 12:17:52,748 - calling_service - INFO - ‚úÖ LLM client pre-warmed in 95ms
2025-12-19T12:17:53.021640215Z [err]  2025-12-19 12:17:52,748 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-19T12:17:53.021644471Z [err]  2025-12-19 12:17:52,748 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-19T12:17:53.021648669Z [err]  2025-12-19 12:17:52,748 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-19T12:17:53.021652658Z [err]  2025-12-19 12:17:52,748 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-19T12:17:53.023265450Z [err]  2025-12-19 12:17:52,749 - server - INFO - ‚úÖ Initialized call_states for v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw with session reference
2025-12-19T12:17:53.023273590Z [err]  2025-12-19 12:17:52,751 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-19T12:17:53.023281673Z [err]  2025-12-19 12:17:52,838 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-19T12:17:53.322556621Z [err]  2025-12-19 12:17:53,320 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-19T12:17:53.322564953Z [err]  2025-12-19 12:17:53,321 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-19T12:17:53.322571212Z [err]  2025-12-19 12:17:53,321 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-19T12:17:53.357123175Z [err]  2025-12-19 12:17:53,349 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-19T12:17:53.357135566Z [err]  2025-12-19 12:17:53,349 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:53.357142268Z [err]  2025-12-19 12:17:53,350 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:cOxrt5tLBpdjIWGff... (active sessions: [])
2025-12-19T12:17:53.357148264Z [err]  2025-12-19 12:17:53,351 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-19T12:17:54.096851444Z [inf]  100.64.0.7:57388 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-19T12:17:54.096864593Z [err]  2025-12-19 12:17:53,852 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:cOxrt5tLBpdjIWGff... (active sessions: [])
2025-12-19T12:17:54.096873342Z [err]  2025-12-19 12:17:54,075 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw/actions/record_start "HTTP/1.1 200 OK"
2025-12-19T12:17:54.099723813Z [err]  2025-12-19 12:17:54,076 - server - INFO - üéôÔ∏è Call recording started for v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:54.099734173Z [err]  2025-12-19 12:17:54,076 - server - INFO - üîß Creating call session for v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw...
2025-12-19T12:17:54.099742127Z [err]  2025-12-19 12:17:54,076 - server - INFO - üîç Agent ID: 6944df147eadbccc46887cdf, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:17:54.099749303Z [err]  2025-12-19 12:17:54,076 - server - INFO - üîß Calling create_call_session() - START
2025-12-19T12:17:54.099754719Z [err]  2025-12-19 12:17:54,076 - calling_service - INFO - üîç Checking KB for agent 6944df147eadbccc46887cdf...
2025-12-19T12:17:54.166916162Z [err]  2025-12-19 12:17:54,162 - calling_service - INFO - üîç KB count query completed: 0 items
2025-12-19T12:17:54.166924791Z [err]  2025-12-19 12:17:54,163 - calling_service - INFO - üìã Built cached system prompt: 5480 chars (global) + 1402 chars (technical)
2025-12-19T12:17:54.166930797Z [err]  2025-12-19 12:17:54,163 - calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-19T12:17:54.252091794Z [err]  2025-12-19 12:17:54,249 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:54.264764161Z [err]  2025-12-19 12:17:54,263 - calling_service - INFO - ‚úÖ LLM client pre-warmed in 99ms
2025-12-19T12:17:54.264773718Z [err]  2025-12-19 12:17:54,263 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-19T12:17:54.264779333Z [err]  2025-12-19 12:17:54,263 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-19T12:17:54.276848967Z [err]  2025-12-19 12:17:54,269 - redis_service - INFO - üì¶ Stored call data in Redis: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw (TTL: 3600s)
2025-12-19T12:17:54.276860135Z [err]  2025-12-19 12:17:54,270 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-19T12:17:54.276869167Z [err]  2025-12-19 12:17:54,270 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-19T12:17:54.276875672Z [err]  2025-12-19 12:17:54,270 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:54.276894373Z [err]  2025-12-19 12:17:54,270 - server - INFO - ü§ñ AI session created for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:54.276900875Z [err]  2025-12-19 12:17:54,270 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-19T12:17:54.276907196Z [err]  2025-12-19 12:17:54,270 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-19T12:17:54.276913466Z [err]  2025-12-19 12:17:54,270 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-19T12:17:54.276919622Z [err]  2025-12-19 12:17:54,271 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-19T12:17:54.276927818Z [err]  2025-12-19 12:17:54,271 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-19T12:17:54.276932903Z [err]  2025-12-19 12:17:54,271 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-19T12:17:54.276939476Z [err]  2025-12-19 12:17:54,271 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-19T12:17:54.279905933Z [err]  2025-12-19 12:17:54,271 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-19T12:17:54.279914497Z [err]  2025-12-19 12:17:54,271 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-19T12:17:54.279920479Z [inf]  100.64.0.8:46680 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:54.352485760Z [err]  2025-12-19 12:17:54,349 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-19T12:17:54.354861770Z [err]  2025-12-19 12:17:54,352 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-19T12:17:54.356926697Z [err]  2025-12-19 12:17:54,354 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:54.356936455Z [err]  2025-12-19 12:17:54,354 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:cOxrt5tLBpdjIWGff... (active sessions: [])
2025-12-19T12:17:55.033230708Z [err]  2025-12-19 12:17:54,585 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-19T12:17:55.033241942Z [err]  2025-12-19 12:17:54,586 - server - INFO - ‚è±Ô∏è [12:17:54.586] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-19T12:17:55.033250889Z [err]  2025-12-19 12:17:54,586 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-19T12:17:55.033255907Z [err]  2025-12-19 12:17:54,585 - calling_service - INFO - ü§ñ Agent started speaking for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:55.033262290Z [err]  2025-12-19 12:17:54,586 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-19T12:17:55.033267398Z [err]  2025-12-19 12:17:54,585 - telnyx_service - INFO - üîä Speaking text on call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA: Are you still there?...
2025-12-19T12:17:55.033273499Z [err]  2025-12-19 12:17:54,584 - calling_service - INFO - ‚è∞ Check-in triggered after 7.2s silence (threshold: 7s)
2025-12-19T12:17:55.033276417Z [err]  2025-12-19 12:17:54,672 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:55.033281377Z [err]  2025-12-19 12:17:54,585 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-19T12:17:55.033284498Z [err]  2025-12-19 12:17:54,585 - calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-19T12:17:55.033289116Z [err]  2025-12-19 12:17:54,672 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-19T12:17:55.033295127Z [err]  2025-12-19 12:17:54,585 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-19T12:17:55.033299386Z [err]  2025-12-19 12:17:54,585 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.2s silence: Are you still there?
2025-12-19T12:17:55.033304943Z [err]  2025-12-19 12:17:54,585 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-19T12:17:55.037870385Z [err]  2025-12-19 12:17:54,672 - server - INFO -    Text length: 20 chars
2025-12-19T12:17:55.037877281Z [err]  2025-12-19 12:17:54,673 - server - INFO -    Text content: 'Are you still there?'
2025-12-19T12:17:55.037884377Z [err]  2025-12-19 12:17:54,673 - server - INFO -    Text bytes: b'Are you still there?'
2025-12-19T12:17:55.037890897Z [err]  2025-12-19 12:17:54,673 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-19T12:17:55.037897313Z [err]  2025-12-19 12:17:54,673 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-19T12:17:55.037903675Z [err]  2025-12-19 12:17:54,673 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-19T12:17:55.037910067Z [err]  2025-12-19 12:17:54,673 - server - INFO -    Full data: {'text': 'Are you still there?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-19T12:17:55.037916245Z [err]  2025-12-19 12:17:54,673 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-19T12:17:55.037923119Z [err]  2025-12-19 12:17:54,673 - server - INFO -    Timeout: 10.0s
2025-12-19T12:17:55.037929280Z [err]  2025-12-19 12:17:54,682 - server - INFO -    ‚úì HTTP client created (0.009s)
2025-12-19T12:17:55.037935708Z [err]  2025-12-19 12:17:54,682 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-19T12:17:55.037941989Z [err]  2025-12-19 12:17:54,755 - redis_service - INFO - üì• Retrieved call data from Redis: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:55.037948323Z [err]  2025-12-19 12:17:54,758 - redis_service - INFO - üì¶ Stored call data in Redis: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw (TTL: 3600s)
2025-12-19T12:17:55.037954354Z [err]  2025-12-19 12:17:54,758 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-19T12:17:55.042060000Z [err]  2025-12-19 12:17:54,758 - calling_service - INFO - ‚è±Ô∏è [12:17:54.758] üì• process_user_input() ENTRY - text: '...'
2025-12-19T12:17:55.042066703Z [err]  2025-12-19 12:17:54,758 - calling_service - INFO - ‚è±Ô∏è [12:17:54.758] ‚è© About to call _process_call_flow_streaming()
2025-12-19T12:17:55.042073256Z [err]  2025-12-19 12:17:54,758 - calling_service - INFO - ‚è±Ô∏è [12:17:54.758] üîÄ Agent type: call_flow, calling flow processor...
2025-12-19T12:17:55.042080286Z [err]  2025-12-19 12:17:54,758 - calling_service - INFO - ‚è±Ô∏è [12:17:54.758] üîÄ _process_call_flow_streaming() ENTRY
2025-12-19T12:17:55.042087479Z [err]  2025-12-19 12:17:54,758 - calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-19T12:17:55.042093992Z [err]  2025-12-19 12:17:54,758 - calling_service - INFO - ‚è±Ô∏è [12:17:54.758] ‚úÖ Node selected, about to process content...
2025-12-19T12:17:55.042100670Z [err]  2025-12-19 12:17:54,758 - calling_service - INFO - üîß Replaced {{now}} with Friday, December 19, 2025 at 7:17 AM EST in content
2025-12-19T12:17:55.042107202Z [err]  2025-12-19 12:17:54,758 - calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-19T12:17:55.042113475Z [err]  2025-12-19 12:17:54,758 - calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-19T12:17:55.042120127Z [err]  2025-12-19 12:17:54,758 - calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-19T12:17:55.042126760Z [err]  2025-12-19 12:17:54,758 - calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-19T12:17:55.042133259Z [err]  2025-12-19 12:17:54,758 - calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-19T12:17:55.042140296Z [err]  2025-12-19 12:17:54,759 - calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-19T12:17:55.042146866Z [err]  2025-12-19 12:17:54,759 - calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-19T12:17:55.044768018Z [err]  2025-12-19 12:17:54,759 - calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-19T12:17:55.044774644Z [err]  2025-12-19 12:17:54,759 - calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-19T12:17:55.044779880Z [err]  2025-12-19 12:17:54,759 - calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-19T12:17:55.044785298Z [err]  2025-12-19 12:17:54,759 - calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-19T12:17:55.044791850Z [err]  2025-12-19 12:17:54,759 - calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-19T12:17:55.044797202Z [err]  2025-12-19 12:17:54,759 - calling_service - INFO - ‚è±Ô∏è [12:17:54.759] üìÑ About to process content (mode=script, length=9)
2025-12-19T12:17:55.044803440Z [err]  2025-12-19 12:17:54,759 - calling_service - INFO - üîä Silence tracking reset for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw (user responded)
2025-12-19T12:17:55.044810531Z [err]  2025-12-19 12:17:54,759 - calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-19T12:17:55.044816112Z [err]  2025-12-19 12:17:54,759 - calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-19T12:17:55.044822030Z [err]  2025-12-19 12:17:54,759 - calling_service - INFO - LLM response (0.00s): Kendrick?
2025-12-19T12:17:55.044826809Z [err]  2025-12-19 12:17:54,759 - calling_service - INFO - Total latency: 0.00s
2025-12-19T12:17:55.044832529Z [err]  2025-12-19 12:17:54,759 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-19T12:17:55.044837447Z [err]  2025-12-19 12:17:54,849 - redis_service - INFO - üì• Retrieved call data from Redis: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:55.046408699Z [err]  2025-12-19 12:17:54,850 - telnyx_service - INFO - üîä Speaking text on call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw: Kendrick?...
2025-12-19T12:17:55.046422766Z [err]  2025-12-19 12:17:54,850 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-19T12:17:55.046429003Z [err]  2025-12-19 12:17:54,850 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-19T12:17:55.046434485Z [err]  2025-12-19 12:17:54,850 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-19T12:17:55.046440206Z [err]  2025-12-19 12:17:54,850 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-19T12:17:55.046446062Z [err]  2025-12-19 12:17:54,850 - server - INFO - ‚è±Ô∏è [12:17:54.850] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-19T12:17:55.046451508Z [err]  2025-12-19 12:17:54,850 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-19T12:17:55.046455698Z [err]  2025-12-19 12:17:54,856 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:cOxrt5tLBpdjIWGff... (active sessions: [])
2025-12-19T12:17:55.046457878Z [err]  2025-12-19 12:17:54,850 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-19T12:17:55.046467522Z [err]  2025-12-19 12:17:54,936 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:55.046475353Z [err]  2025-12-19 12:17:54,936 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-19T12:17:55.046481773Z [err]  2025-12-19 12:17:54,936 - server - INFO -    Text length: 9 chars
2025-12-19T12:17:55.046488621Z [err]  2025-12-19 12:17:54,937 - server - INFO -    Text content: 'Kendrick?'
2025-12-19T12:17:55.046495844Z [err]  2025-12-19 12:17:54,937 - server - INFO -    Text bytes: b'Kendrick?'
2025-12-19T12:17:55.046502361Z [err]  2025-12-19 12:17:54,937 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-19T12:17:55.050108851Z [err]  2025-12-19 12:17:54,937 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-19T12:17:55.050122342Z [err]  2025-12-19 12:17:54,937 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-19T12:17:55.050131450Z [err]  2025-12-19 12:17:54,937 - server - INFO -    Full data: {'text': 'Kendrick?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-19T12:17:55.050143311Z [err]  2025-12-19 12:17:54,937 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-19T12:17:55.050151262Z [err]  2025-12-19 12:17:54,937 - server - INFO -    Timeout: 10.0s
2025-12-19T12:17:55.050161350Z [err]  2025-12-19 12:17:54,946 - server - INFO -    ‚úì HTTP client created (0.009s)
2025-12-19T12:17:55.050172166Z [err]  2025-12-19 12:17:54,946 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-19T12:17:55.050180960Z [err]  2025-12-19 12:17:55,039 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-19T12:17:55.050191314Z [err]  2025-12-19 12:17:55,039 - server - INFO -    ‚úì Connection established (0.366s) [TARGET: <200ms]
2025-12-19T12:17:55.050199051Z [err]  2025-12-19 12:17:55,039 - server - INFO -    ‚úì Response status: 200
2025-12-19T12:17:55.050205201Z [err]  2025-12-19 12:17:55,039 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-19T12:17:55.054125424Z [err]  2025-12-19 12:17:55,047 - server - INFO -    ‚úì FIRST CHUNK received (0.374s, 1143 bytes) [TARGET: <300ms]
2025-12-19T12:17:55.057635257Z [err]  2025-12-19 12:17:55,051 - server - INFO -    ‚úì ALL CHUNKS received: 49 chunks (0.378s)
2025-12-19T12:17:55.057647480Z [err]  2025-12-19 12:17:55,051 - server - INFO -    ‚úì Total audio size: 17599 bytes
2025-12-19T12:17:55.057656395Z [err]  2025-12-19 12:17:55,051 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-19T12:17:55.057666299Z [err]  2025-12-19 12:17:55,051 - server - INFO -       - Connection: 366ms
2025-12-19T12:17:55.057672621Z [err]  2025-12-19 12:17:55,051 - server - INFO -       - First chunk: 374ms
2025-12-19T12:17:55.057679108Z [err]  2025-12-19 12:17:55,051 - server - INFO -       - All chunks: 378ms
2025-12-19T12:17:55.057685150Z [err]  2025-12-19 12:17:55,051 - server - INFO -       - Audio generation only: 8ms
2025-12-19T12:17:55.057691636Z [err]  2025-12-19 12:17:55,051 - server - INFO - ‚è±Ô∏è [12:17:55.051] üîä TTS COMPLETE: 465ms, audio_size=17599 bytes
2025-12-19T12:17:55.057698020Z [err]  2025-12-19 12:17:55,051 - server - INFO - üíæ TTS CACHED: elevenlabs:Are you still there?... (17599 bytes)
2025-12-19T12:17:55.057703996Z [err]  2025-12-19 12:17:55,051 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.47s
2025-12-19T12:17:55.057710259Z [err]  2025-12-19 12:17:55,051 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:17:55.057717099Z [err]  2025-12-19 12:17:55,052 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:17:55.201458387Z [err]  2025-12-19 12:17:55,197 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:55.201467253Z [err]  2025-12-19 12:17:55,197 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '2aa47e58-7234-4fa7-96ed-5dbaaf19b146', 'occurred_at': '2025-12-19T12:17:54.809216Z', 'payload': {'call_control_id': 'v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw', 'call_leg_id': 'bbcc78f6-dcd4-11f0-abed-02420aef951f', 'call_session_id': 'bbc9f4fa-dcd4-11f0-80d5-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': '9DHK5lucag', 'start_time': '2025-12-19T12:17:54.809216Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:55.201476696Z [err]  2025-12-19 12:17:55,197 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:55.201482688Z [err]  2025-12-19 12:17:55,197 - server - INFO - üì® ================================================
2025-12-19T12:17:55.201488540Z [inf]  100.64.0.13:21782 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:55.292429770Z [err]  2025-12-19 12:17:55,289 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-19T12:17:55.292436141Z [err]  2025-12-19 12:17:55,289 - server - INFO -    ‚úì Connection established (0.352s) [TARGET: <200ms]
2025-12-19T12:17:55.292440659Z [err]  2025-12-19 12:17:55,289 - server - INFO -    ‚úì Response status: 200
2025-12-19T12:17:55.292448334Z [err]  2025-12-19 12:17:55,289 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-19T12:17:55.308322390Z [err]  2025-12-19 12:17:55,299 - server - INFO -    ‚úì FIRST CHUNK received (0.363s, 293 bytes) [TARGET: <300ms]
2025-12-19T12:17:55.308333217Z [err]  2025-12-19 12:17:55,303 - server - INFO -    ‚úì ALL CHUNKS received: 97 chunks (0.366s)
2025-12-19T12:17:55.308338848Z [err]  2025-12-19 12:17:55,303 - server - INFO -    ‚úì Total audio size: 13419 bytes
2025-12-19T12:17:55.308344328Z [err]  2025-12-19 12:17:55,303 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-19T12:17:55.308349799Z [err]  2025-12-19 12:17:55,303 - server - INFO -       - Connection: 352ms
2025-12-19T12:17:55.308355598Z [err]  2025-12-19 12:17:55,303 - server - INFO -       - First chunk: 363ms
2025-12-19T12:17:55.308360889Z [err]  2025-12-19 12:17:55,303 - server - INFO -       - All chunks: 366ms
2025-12-19T12:17:55.308365898Z [err]  2025-12-19 12:17:55,303 - server - INFO -       - Audio generation only: 10ms
2025-12-19T12:17:55.308371166Z [err]  2025-12-19 12:17:55,303 - server - INFO - ‚è±Ô∏è [12:17:55.303] üîä TTS COMPLETE: 453ms, audio_size=13419 bytes
2025-12-19T12:17:55.308376662Z [err]  2025-12-19 12:17:55,303 - server - INFO - üíæ TTS CACHED: elevenlabs:Kendrick?... (13419 bytes)
2025-12-19T12:17:55.308382639Z [err]  2025-12-19 12:17:55,303 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.45s
2025-12-19T12:17:55.308391322Z [err]  2025-12-19 12:17:55,304 - telnyx_service - INFO - ‚úÖ Generated 13419 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-19T12:17:55.308396771Z [err]  2025-12-19 12:17:55,304 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-19T12:17:55.331224376Z [err]  2025-12-19 12:17:55,328 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:17:55.331226886Z [err]  }
2025-12-19T12:17:55.331235106Z [err]  2025-12-19 12:17:55,329 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.28s
2025-12-19T12:17:55.331238205Z [err]  2025-12-19 12:17:55,329 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-19T12:17:55.331242580Z [err]  2025-12-19 12:17:55,329 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-19T12:17:55.331248796Z [err]    "errors": [
2025-12-19T12:17:55.331255551Z [err]      {
2025-12-19T12:17:55.331262167Z [err]        "code": "90018",
2025-12-19T12:17:55.331267893Z [err]        "title": "Call has already ended",
2025-12-19T12:17:55.331273343Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-19T12:17:55.331279221Z [err]      }
2025-12-19T12:17:55.331285178Z [err]    ]
2025-12-19T12:17:55.359089500Z [err]  2025-12-19 12:17:55,356 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:cOxrt5tLBpdjIWGff... (active sessions: [])
2025-12-19T12:17:56.089006641Z [err]  2025-12-19 12:17:55,570 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.27s
2025-12-19T12:17:56.089013394Z [err]  2025-12-19 12:17:55,570 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 0.72s
2025-12-19T12:17:56.089020107Z [err]  2025-12-19 12:17:55,570 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-19T12:17:56.089026970Z [err]  2025-12-19 12:17:55,570 - telnyx_service - INFO - üé¨ Playback ID: 3sk6Nif1bA
2025-12-19T12:17:56.089128939Z [err]  2025-12-19 12:17:55,527 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:17:56.089135819Z [err]  2025-12-19 12:17:55,528 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-19T12:17:56.089143185Z [err]  2025-12-19 12:17:55,528 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-19T12:17:56.089149633Z [err]  2025-12-19 12:17:55,569 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw/actions/playback_start "HTTP/1.1 200 OK"
2025-12-19T12:17:56.089264842Z [err]  2025-12-19 12:17:55,571 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-19T12:17:56.089276068Z [err]  2025-12-19 12:17:55,571 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146675.571074 for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:56.089284804Z [err]  2025-12-19 12:17:55,571 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-19T12:17:56.089291488Z [inf]  100.64.0.7:57388 - "GET /api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3 HTTP/1.1" 200
2025-12-19T12:17:56.094148392Z [err]  2025-12-19 12:17:55,859 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:cOxrt5tLBpdjIWGff... (active sessions: [])
2025-12-19T12:17:56.094153942Z [err]  2025-12-19 12:17:56,031 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (7.3s ago), marking agent as done speaking
2025-12-19T12:17:56.094159889Z [err]  2025-12-19 12:17:56,031 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146676.0314918 for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:56.094165998Z [err]  2025-12-19 12:17:56,031 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:17:56.366885329Z [err]  2025-12-19 12:17:56,360 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:cOxrt5tLBpdjIWGff... (active sessions: [])
2025-12-19T12:17:57.047339320Z [err]  2025-12-19 12:17:56,642 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Ye' | Generating: False
2025-12-19T12:17:57.047346165Z [err]  2025-12-19 12:17:56,753 - server - INFO - üî§ RAW TOKENS: ["Ye"?]
2025-12-19T12:17:57.047354515Z [err]  2025-12-19 12:17:56,753 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Ye' | Generating: False
2025-12-19T12:17:57.047361840Z [err]  2025-12-19 12:17:56,862 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:cOxrt5tLBpdjIWGff... (active sessions: [])
2025-12-19T12:17:57.047367420Z [err]  2025-12-19 12:17:56,905 - server - INFO - üî§ RAW TOKENS: ["Ye"‚úì, "ah."‚úì, "<end>"‚úì]
2025-12-19T12:17:57.047373340Z [err]  2025-12-19 12:17:56,905 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-19T12:17:57.047381483Z [err]  2025-12-19 12:17:56,905 - server - INFO - üßπ Cleaned transcript: 'Ye ah.' -> 'Yeah.'
2025-12-19T12:17:57.047384862Z [err]  2025-12-19 12:17:56,540 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:57.047390549Z [err]  2025-12-19 12:17:56,905 - server - INFO - üì• FINAL TOKENS: 'Yeah.' (2 tokens)
2025-12-19T12:17:57.047397366Z [err]  2025-12-19 12:17:56,540 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': 'a2ba72fc-7f31-4d8e-ad5d-aec7ff18765e', 'occurred_at': '2025-12-19T12:17:56.149215Z', 'payload': {'call_control_id': 'v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw', 'call_leg_id': 'bbcc78f6-dcd4-11f0-abed-02420aef951f', 'call_session_id': 'bbc9f4fa-dcd4-11f0-80d5-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': '3sk6Nif1bA'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:57.047400669Z [err]  2025-12-19 12:17:56,905 - server - INFO - üé§ Soniox final transcript: 'Yeah.'
2025-12-19T12:17:57.047409127Z [err]  2025-12-19 12:17:56,540 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:57.047414033Z [err]  2025-12-19 12:17:56,906 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:cOxrt5tLBpdjIWGff... (active sessions: [])
2025-12-19T12:17:57.047421098Z [err]  2025-12-19 12:17:56,541 - server - INFO - üì® ================================================
2025-12-19T12:17:57.047422934Z [err]  2025-12-19 12:17:56,906 - server - INFO - üîç FILTER CHECK: words=1, is_filler=True, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-19T12:17:57.047427800Z [err]  2025-12-19 12:17:56,906 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:cOxrt5tLBpdjIWGff... (active sessions: [])
2025-12-19T12:17:57.047434028Z [err]  2025-12-19 12:17:56,906 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-19T12:17:57.047439037Z [err]  2025-12-19 12:17:56,907 - server - INFO - ‚è±Ô∏è [12:17:56.907] üìù FINAL TRANSCRIPT RECEIVED: 'Yeah.'
2025-12-19T12:17:57.047748608Z [inf]  100.64.0.12:10068 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:57.047754713Z [err]  2025-12-19 12:17:56,638 - server - INFO - üî§ RAW TOKENS: ["Ye"?]
2025-12-19T12:17:57.047761594Z [err]  2025-12-19 12:17:56,642 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user started speaking) for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:57.047768231Z [err]  2025-12-19 12:17:56,642 - calling_service - INFO - üîä Silence timer reset for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw (user started speaking)
2025-12-19T12:17:57.047775574Z [err]  2025-12-19 12:17:56,642 - calling_service - INFO - üë§ User started speaking for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:57.051204813Z [err]  2025-12-19 12:17:56,907 - server - INFO - ‚è±Ô∏è [12:17:56.907] STT endpoint detection latency: 19ms
2025-12-19T12:17:57.051210231Z [err]  2025-12-19 12:17:56,907 - server - INFO - ‚è±Ô∏è [12:17:56.907] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-19T12:17:57.051215712Z [err]  2025-12-19 12:17:56,907 - redis_service - INFO - üì¶ Stored call data in Redis: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw (TTL: 3600s)
2025-12-19T12:17:57.051220837Z [err]  2025-12-19 12:17:56,907 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-19T12:17:57.051226066Z [err]  2025-12-19 12:17:56,908 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:cOxrt5tLBpdjIWGff... (active sessions: [])
2025-12-19T12:17:57.051231561Z [err]  2025-12-19 12:17:56,908 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Yeah.' - Processing...
2025-12-19T12:17:57.051237617Z [err]  2025-12-19 12:17:56,918 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Yeah.
2025-12-19T12:17:57.051243104Z [err]  2025-12-19 12:17:56,918 - calling_service - INFO - üë§ User stopped speaking for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:57.051248982Z [err]  2025-12-19 12:17:56,918 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-19T12:17:57.051254475Z [err]  2025-12-19 12:17:56,918 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+10ms
2025-12-19T12:17:57.051260806Z [err]  2025-12-19 12:17:56,918 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 10ms (Soniox model: stt-rt-v3)
2025-12-19T12:17:57.051266428Z [err]  2025-12-19 12:17:56,919 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-19T12:17:57.051272075Z [err]  2025-12-19 12:17:56,919 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-19T12:17:57.053807523Z [err]  2025-12-19 12:17:56,919 - calling_service - INFO - ü§ñ Agent started speaking for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:57.053818494Z [err]  2025-12-19 12:17:57,009 - server - INFO - üìù Saved user transcript to database
2025-12-19T12:17:57.053832577Z [err]  2025-12-19 12:17:57,009 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:cOxrt5tLBpdjIWGff... (active sessions: [])
2025-12-19T12:17:57.053838963Z [err]  2025-12-19 12:17:57,009 - calling_service - INFO - ‚è±Ô∏è [12:17:57.009] üì• process_user_input() ENTRY - text: 'Yeah....'
2025-12-19T12:17:57.053844555Z [err]  2025-12-19 12:17:57,009 - calling_service - INFO - ‚è±Ô∏è [12:17:57.009] ‚è© About to call _process_call_flow_streaming()
2025-12-19T12:17:57.053851840Z [err]  2025-12-19 12:17:57,009 - calling_service - INFO - ‚è±Ô∏è [12:17:57.009] üîÄ Agent type: call_flow, calling flow processor...
2025-12-19T12:17:57.053857875Z [err]  2025-12-19 12:17:57,009 - calling_service - INFO - ‚è±Ô∏è [12:17:57.009] üîÄ _process_call_flow_streaming() ENTRY
2025-12-19T12:17:57.053863617Z [err]  2025-12-19 12:17:57,009 - calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-19T12:17:57.053869359Z [err]  2025-12-19 12:17:57,009 - calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-19T12:17:57.053878390Z [err]  2025-12-19 12:17:57,009 - calling_service - INFO - ‚è±Ô∏è [12:17:57.009] üîÄ About to call _follow_transition() for: Yeah....
2025-12-19T12:17:57.053884579Z [err]  2025-12-19 12:17:57,009 - calling_service - INFO - Evaluating transitions from Greeting for message: Yeah.
2025-12-19T12:17:57.053891411Z [err]  2025-12-19 12:17:57,026 - calling_service - INFO - ‚è±Ô∏è [12:17:57.026] üîÄ TRANSITION EVALUATION START - Calling LLM for 4 options
2025-12-19T12:17:57.367574478Z [err]  2025-12-19 12:17:57,364 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:cOxrt5tLBpdjIWGff... (active sessions: [])
2025-12-19T12:17:57.367581122Z [err]  2025-12-19 12:17:57,364 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:cOxrt5tLBpdjIWGff... (active sessions: [])
2025-12-19T12:17:57.385028107Z [err]  2025-12-19 12:17:57,379 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:57.385038886Z [err]  2025-12-19 12:17:57,379 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'f56651f4-6522-4bb9-893b-08d457fb7b42', 'occurred_at': '2025-12-19T12:17:56.989216Z', 'payload': {'call_control_id': 'v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw', 'call_leg_id': 'bbcc78f6-dcd4-11f0-abed-02420aef951f', 'call_session_id': 'bbc9f4fa-dcd4-11f0-80d5-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': '3sk6Nif1bA', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:57.385046671Z [err]  2025-12-19 12:17:57,379 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:57.385053712Z [err]  2025-12-19 12:17:57,380 - server - INFO - üì® ================================================
2025-12-19T12:17:57.385060082Z [err]  2025-12-19 12:17:57,381 - redis_service - INFO - ‚ûñ Removed playback 3sk6Nif1bA, 0 remaining for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:57.385067791Z [err]  2025-12-19 12:17:57,381 - server - INFO - üîä Redis: Removed playback 3sk6Nif1bA, 0 remaining
2025-12-19T12:17:57.385073654Z [err]  2025-12-19 12:17:57,381 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-19T12:17:57.385081864Z [err]  2025-12-19 12:17:57,383 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-19T12:17:57.385088195Z [err]  2025-12-19 12:17:57,383 - server - INFO - ‚úÖ Found session in active_telnyx_calls (local worker)
2025-12-19T12:17:57.389041396Z [err]  2025-12-19 12:17:57,383 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146677.383211 for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:57.389047821Z [err]  2025-12-19 12:17:57,383 - server - INFO - ‚è±Ô∏è Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-19T12:17:57.389056134Z [inf]  100.64.0.9:43590 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:57.461409260Z [err]  2025-12-19 12:17:57,459 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:17:57.461415885Z [err]  2025-12-19 12:17:57,459 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': '52922751-b404-48a7-8ad3-06eddcfd0f01', 'occurred_at': '2025-12-19T12:17:57.209218Z', 'payload': {'call_control_id': 'v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw', 'call_leg_id': 'bbcc78f6-dcd4-11f0-abed-02420aef951f', 'call_session_id': 'bbc9f4fa-dcd4-11f0-80d5-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:17:57.461420700Z [err]  2025-12-19 12:17:57,459 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:57.461425446Z [err]  2025-12-19 12:17:57,459 - server - INFO - üì® ================================================
2025-12-19T12:17:57.461449955Z [inf]  100.64.0.11:62122 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:17:58.237355101Z [err]  2025-12-19 12:17:57,730 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-19T12:17:58.237363187Z [err]  2025-12-19 12:17:57,740 - calling_service - INFO - ‚è±Ô∏è [12:17:57.740] üîÄ TRANSITION EVALUATION COMPLETE - took 713ms
2025-12-19T12:17:58.237370588Z [err]  2025-12-19 12:17:57,740 - calling_service - INFO - ü§ñ AI transition decision: '0'
2025-12-19T12:17:58.237377130Z [err]  2025-12-19 12:17:57,740 - calling_service - INFO - üìä Available transitions: ['Confirms name (Yes|Speaking|This is he/she|etc)...', 'Wrong number (No John here|Wrong number|etc) - don...', "The customer says let's set an appointment....", "Let's talk about my inances..."]
2025-12-19T12:17:58.237383419Z [err]  2025-12-19 12:17:57,740 - calling_service - INFO - Selected transition index: 0
2025-12-19T12:17:58.237389828Z [err]  2025-12-19 12:17:57,740 - calling_service - INFO - Transition: Greeting -> Node Prompt: N001B_IntroAndHelpRequest_Only (V3 - Follows Name Confirmation)
2025-12-19T12:17:58.237396265Z [err]  2025-12-19 12:17:57,740 - calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 731ms
2025-12-19T12:17:58.237402527Z [err]  2025-12-19 12:17:57,740 - calling_service - INFO - ‚è±Ô∏è [12:17:57.740] ‚úÖ Node selected, about to process content...
2025-12-19T12:17:58.237410030Z [err]  2025-12-19 12:17:57,740 - calling_service - INFO - üîß Replaced {{now}} with Friday, December 19, 2025 at 7:17 AM EST in content
2025-12-19T12:17:58.237416255Z [err]  2025-12-19 12:17:57,740 - calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-19T12:17:58.237423340Z [err]  2025-12-19 12:17:57,740 - calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-19T12:17:58.237592749Z [err]  2025-12-19 12:17:57,741 - calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-19T12:17:58.237602586Z [err]  2025-12-19 12:17:57,741 - calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-19T12:17:58.242798431Z [err]  2025-12-19 12:17:58,035 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-19T12:17:58.242832417Z [err]  2025-12-19 12:17:58,036 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-19T12:17:58.242843714Z [err]  2025-12-19 12:17:58,036 - persistent_tts_service - INFO - üîå [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] Establishing persistent TTS WebSocket...
2025-12-19T12:17:58.242894484Z [err]  2025-12-19 12:17:58,036 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-19T12:17:58.242968997Z [err]  2025-12-19 12:17:57,741 - calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-19T12:17:58.242979547Z [err]  2025-12-19 12:17:57,741 - calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-19T12:17:58.242986540Z [err]  2025-12-19 12:17:57,741 - calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-19T12:17:58.242997764Z [err]  2025-12-19 12:17:57,741 - calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-19T12:17:58.243005323Z [err]  2025-12-19 12:17:57,741 - calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-19T12:17:58.243011908Z [err]  2025-12-19 12:17:57,741 - calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 89 chars) - will return text instantly
2025-12-19T12:17:58.243018970Z [err]  2025-12-19 12:17:57,741 - calling_service - INFO - Using flow node: Node Prompt: N001B_IntroAndHelpRequest_Only (V3 - Follows Name Confirmation) (type: conversation, mode: script)
2025-12-19T12:17:58.243025375Z [err]  2025-12-19 12:17:57,741 - calling_service - INFO - ‚è±Ô∏è [12:17:57.741] üìÑ About to process content (mode=script, length=89)
2025-12-19T12:17:58.243033431Z [err]  2025-12-19 12:17:57,741 - calling_service - INFO - üì§ Streaming script as 2 sentence(s)
2025-12-19T12:17:58.243040083Z [err]  2025-12-19 12:17:57,741 - server - INFO - üì§ Sentence arrived from LLM: This is Jake......
2025-12-19T12:17:58.243046897Z [err]  2025-12-19 12:17:57,741 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 822ms
2025-12-19T12:17:58.243057844Z [err]  2025-12-19 12:17:57,741 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-19T12:17:58.243063901Z [err]  2025-12-19 12:17:57,741 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:cOxrt5tLBpdjIWGff... (active sessions: [])
2025-12-19T12:17:58.243695972Z [err]  2025-12-19 12:17:57,741 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-19T12:17:58.243703202Z [err]  2025-12-19 12:17:57,829 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:58.243713011Z [err]  2025-12-19 12:17:57,866 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-19T12:17:58.243719535Z [err]  2025-12-19 12:17:57,866 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146677.8662965 for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:58.243726086Z [err]  2025-12-19 12:17:57,866 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:58.243732114Z [err]  2025-12-19 12:17:57,867 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:cOxrt5tLBpdjIWGff... (active sessions: [])
2025-12-19T12:17:58.243738354Z [err]  2025-12-19 12:17:57,916 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:58.243744248Z [err]  2025-12-19 12:17:58,003 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:17:58.247754917Z [err]  2025-12-19 12:17:58,036 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-19T12:17:58.247763846Z [err]  2025-12-19 12:17:58,036 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-19T12:17:58.247772338Z [err]  2025-12-19 12:17:58,036 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-19T12:17:58.247781334Z [err]  2025-12-19 12:17:58,181 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-19T12:17:58.247789722Z [err]  2025-12-19 12:17:58,182 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-19T12:17:58.247797648Z [err]  2025-12-19 12:17:58,182 - persistent_tts_service - INFO - ‚úÖ [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] Persistent TTS WebSocket established
2025-12-19T12:17:58.247805256Z [err]  2025-12-19 12:17:58,182 - persistent_tts_service - INFO - üéß [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] Audio receiver loop started
2025-12-19T12:17:58.247812891Z [err]  2025-12-19 12:17:58,182 - persistent_tts_service - INFO - üîä [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] Comfort noise loop started
2025-12-19T12:17:58.247820973Z [err]  2025-12-19 12:17:58,182 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:58.247828445Z [err]  2025-12-19 12:17:58,182 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-19T12:17:58.247835322Z [err]  2025-12-19 12:17:58,182 - server - INFO - üîç Persistent TTS lookup: call_id=v3:cOxrt5tLBpdjIWGff..., session=FOUND
2025-12-19T12:17:58.247842590Z [err]  2025-12-19 12:17:58,182 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-19T12:17:58.251900934Z [err]  2025-12-19 12:17:58,182 - server - INFO - üéµ TTS task #1 started at +441ms
2025-12-19T12:17:58.251906867Z [err]  2025-12-19 12:17:58,182 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 1263ms
2025-12-19T12:17:58.251913138Z [err]  2025-12-19 12:17:58,182 - calling_service - INFO - üì§ Streamed script sentence 1/2: This is Jake......
2025-12-19T12:17:58.251919876Z [err]  2025-12-19 12:17:58,182 - server - INFO - üì§ Sentence arrived from LLM: I was just, um, wondering if you could possibly he...
2025-12-19T12:17:58.251926317Z [err]  2025-12-19 12:17:58,182 - server - INFO - üîç Persistent TTS lookup: call_id=v3:cOxrt5tLBpdjIWGff..., session=FOUND
2025-12-19T12:17:58.251932131Z [err]  2025-12-19 12:17:58,182 - server - INFO - üöÄ Streaming sentence #2 via persistent WebSocket
2025-12-19T12:17:58.251939658Z [err]  2025-12-19 12:17:58,182 - server - INFO - üéµ TTS task #2 started at +441ms
2025-12-19T12:17:58.251947162Z [err]  2025-12-19 12:17:58,182 - calling_service - INFO - üì§ Streamed script sentence 2/2: I was just, um, wondering if you could possibly he...
2025-12-19T12:17:58.251953295Z [err]  2025-12-19 12:17:58,182 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user gave meaningful response) for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:58.251958433Z [err]  2025-12-19 12:17:58,182 - calling_service - INFO - üîä Silence tracking reset for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw (user responded)
2025-12-19T12:17:58.251964203Z [err]  2025-12-19 12:17:58,182 - calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-19T12:17:58.251969564Z [err]  2025-12-19 12:17:58,182 - calling_service - INFO - üíæ Storing node ID 1763159750250 in conversation history
2025-12-19T12:17:58.251976132Z [err]  2025-12-19 12:17:58,182 - calling_service - INFO - LLM response (1.17s): This is Jake... I was just, um, wondering if you could possibly help me out for a moment?
2025-12-19T12:17:58.256562819Z [err]  2025-12-19 12:17:58,182 - calling_service - INFO - Total latency: 1.17s
2025-12-19T12:17:58.256574591Z [err]  2025-12-19 12:17:58,182 - server - INFO - ‚úÖ LLM finished in 1263ms, TTS tasks already running in background
2025-12-19T12:17:58.256590265Z [err]  2025-12-19 12:17:58,182 - server - INFO - üéµ Streaming 2 TTS chunks as they complete...
2025-12-19T12:17:58.256598726Z [err]  2025-12-19 12:17:58,182 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-19T12:17:58.256603625Z [err]  2025-12-19 12:17:58,182 - server - INFO -    2 sentences queued and playing seamlessly
2025-12-19T12:17:58.256609356Z [err]  2025-12-19 12:17:58,183 - persistent_tts_service - INFO - üéµ [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] Playback consumer started
2025-12-19T12:17:58.256617007Z [err]  2025-12-19 12:17:58,183 - persistent_tts_service - INFO - üéß [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] Audio Receiver Loop STARTED
2025-12-19T12:17:58.256621380Z [err]  2025-12-19 12:17:58,183 - persistent_tts_service - INFO - üíì [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] Starting TTS keep-alive loop (every 15s)
2025-12-19T12:17:58.256626255Z [err]  2025-12-19 12:17:58,183 - persistent_tts_service - INFO - üîä [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] Starting comfort noise loop
2025-12-19T12:17:58.256630815Z [err]  2025-12-19 12:17:58,183 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-19T12:17:59.066568398Z [err]  2025-12-19 12:17:59,000 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-19T12:17:59.107171243Z [err]  2025-12-19 12:17:59,102 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-19T12:17:59.107183358Z [err]  2025-12-19 12:17:59,103 - persistent_tts_service - INFO - üé§ [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] Streaming sentence #1: This is Jake......
2025-12-19T12:17:59.107195319Z [err]  2025-12-19 12:17:59,103 - persistent_tts_service - INFO - üöÄ [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-19T12:17:59.107204485Z [err]  2025-12-19 12:17:59,104 - persistent_tts_service - INFO - üéß [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] Receiver processing sentence #1: 'This is Jake......'
2025-12-19T12:17:59.107205198Z [err]  2025-12-19 12:17:59,103 - persistent_tts_service - INFO - üìä [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-19T12:17:59.107214847Z [err]  2025-12-19 12:17:59,103 - persistent_tts_service - INFO - üé§ [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] Streaming sentence #2: I was just, um, wondering if you could possibly he...
2025-12-19T12:17:59.107226012Z [err]  2025-12-19 12:17:59,104 - persistent_tts_service - INFO - üìä [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] DIAGNOSTIC: queue_latency=0ms, pending_sentences=1, audio_queue=0, interrupted=False
2025-12-19T12:17:59.107226558Z [err]  2025-12-19 12:17:59,103 - persistent_tts_service - INFO - üöÄ [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] Sent sentence #2 (NON-BLOCKING) in 0ms
2025-12-19T12:17:59.107235335Z [err]  2025-12-19 12:17:59,103 - persistent_tts_service - INFO - üìä [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] DIAGNOSTIC: pending_sentences=2, audio_queue=0, is_first=False, is_last=False
2025-12-19T12:17:59.111430333Z [err]  2025-12-19 12:17:59,105 - server - INFO - ‚úÖ All 2 persistent TTS streams completed
2025-12-19T12:17:59.111445214Z [err]  2025-12-19 12:17:59,105 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-19T12:17:59.111450952Z [err]  2025-12-19 12:17:59,105 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 2186ms from user stop üöÄ
2025-12-19T12:17:59.111456643Z [err]  2025-12-19 12:17:59,105 - calling_service - INFO - ü§ñ Agent started speaking for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:17:59.111463496Z [err]  2025-12-19 12:17:59,105 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-19T12:17:59.111470488Z [err]  2025-12-19 12:17:59,106 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-19T12:17:59.111476443Z [err]  2025-12-19 12:17:59,106 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-19T12:17:59.111481717Z [err]  2025-12-19 12:17:59,106 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 10ms (provider: soniox, model: stt-rt-v3)
2025-12-19T12:17:59.111486854Z [err]  2025-12-19 12:17:59,106 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 1263ms (provider: grok, model: grok-4-fast-non-reasoning)
2025-12-19T12:17:59.111491588Z [err]  2025-12-19 12:17:59,106 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 1364ms (provider: elevenlabs, websocket: False)
2025-12-19T12:17:59.111502302Z [err]  2025-12-19 12:17:59,106 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 2187ms (user stopped ‚Üí play_audio_url called)
2025-12-19T12:17:59.111509326Z [err]  2025-12-19 12:17:59,106 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-19T12:17:59.111517423Z [err]  2025-12-19 12:17:59,106 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-19T12:17:59.114789764Z [err]  2025-12-19 12:17:59,106 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-19T12:17:59.114797581Z [err]  2025-12-19 12:17:59,106 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-19T12:17:59.114802696Z [err]  2025-12-19 12:17:59,106 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-19T12:17:59.114807378Z [err]  2025-12-19 12:17:59,106 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 2487ms estimated
2025-12-19T12:17:59.114812882Z [err]  2025-12-19 12:17:59,106 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 89 chars, 2 sentences
2025-12-19T12:17:59.114817908Z [err]  2025-12-19 12:17:59,106 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Yeah....'
2025-12-19T12:17:59.114823947Z [err]  2025-12-19 12:17:59,106 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: 'This is Jake... I was just, um, wondering if you could possi...'
2025-12-19T12:17:59.114830160Z [err]  2025-12-19 12:17:59,106 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-19T12:17:59.114835754Z [err]  2025-12-19 12:17:59,106 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-19T12:17:59.114841992Z [err]  2025-12-19 12:17:59,107 - server - INFO - üì§ Audio flowing: 287 packets sent to Soniox (5s update)
2025-12-19T12:17:59.288598280Z [err]  2025-12-19 12:17:59,285 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Node Prompt: N001B_IntroAndHelpRequest_Only (V3 - Follows Name Confirmation), Dead Air: 1773ms)
2025-12-19T12:17:59.288604900Z [err]  2025-12-19 12:17:59,285 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-19T12:17:59.288611127Z [err]  2025-12-19 12:17:59,285 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-19T12:17:59.375940911Z [err]  2025-12-19 12:17:59,370 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 267ms
2025-12-19T12:17:59.375952003Z [err]  2025-12-19 12:17:59,370 - persistent_tts_service - INFO - üì§ Sending 8900 bytes of audio (56 chunks, 1.1s duration) via WebSocket
2025-12-19T12:17:59.375958595Z [err]  2025-12-19 12:17:59,370 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-19T12:17:59.375963683Z [err]  2025-12-19 12:17:59,370 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.1s (total: 1.1s from now)
2025-12-19T12:17:59.375969262Z [err]  2025-12-19 12:17:59,371 - persistent_tts_service - INFO - ‚úÖ Sent 56 audio chunks via WebSocket
2025-12-19T12:18:00.332891775Z [err]  2025-12-19 12:17:59,615 - server - INFO - üö¶ BARGE-IN CHECK during audio playback (2.6s left): 1 words - 'Wh'
2025-12-19T12:18:00.332905650Z [err]  2025-12-19 12:17:59,671 - server - INFO - üî§ RAW TOKENS: [" Wh"?, "at"?]
2025-12-19T12:18:00.332913161Z [err]  2025-12-19 12:17:59,671 - server - INFO - üîç PARTIAL TRANSCRIPT: 'what' | Generating: False
2025-12-19T12:18:00.332920058Z [err]  2025-12-19 12:17:59,671 - server - INFO - üö¶ BARGE-IN CHECK during audio playback (2.5s left): 1 words - 'what'
2025-12-19T12:18:00.332930629Z [err]  2025-12-19 12:17:59,719 - server - INFO - üî§ RAW TOKENS: [" Wh"?, "at"?, "'s"?, " that"?]
2025-12-19T12:18:00.333028502Z [err]  2025-12-19 12:17:59,575 - persistent_tts_service - INFO - üì§ Sending 13747 bytes of audio (86 chunks, 1.7s duration) via WebSocket
2025-12-19T12:18:00.333039123Z [err]  2025-12-19 12:17:59,575 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-19T12:18:00.333045795Z [err]  2025-12-19 12:17:59,575 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.7s (total: 2.6s from now)
2025-12-19T12:18:00.333053968Z [err]  2025-12-19 12:17:59,577 - persistent_tts_service - INFO - ‚úÖ Sent 86 audio chunks via WebSocket
2025-12-19T12:18:00.333064455Z [err]  2025-12-19 12:17:59,614 - server - INFO - üî§ RAW TOKENS: [" Wh"?]
2025-12-19T12:18:00.333073963Z [err]  2025-12-19 12:17:59,615 - calling_service - INFO - üîä Silence timer reset for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw (user started speaking)
2025-12-19T12:18:00.333086198Z [err]  2025-12-19 12:17:59,615 - calling_service - INFO - üë§ User started speaking for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:00.333092585Z [err]  2025-12-19 12:17:59,615 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Wh' | Generating: False
2025-12-19T12:18:00.335803800Z [err]  2025-12-19 12:17:59,719 - server - INFO - üîç PARTIAL TRANSCRIPT: 'what'sthat' | Generating: False
2025-12-19T12:18:00.335809751Z [err]  2025-12-19 12:17:59,719 - server - INFO - üö¶ BARGE-IN CHECK during audio playback (2.5s left): 1 words - 'what'sthat'
2025-12-19T12:18:00.335817008Z [err]  2025-12-19 12:17:59,782 - persistent_tts_service - INFO - üì§ Sending 20062 bytes of audio (126 chunks, 2.5s duration) via WebSocket
2025-12-19T12:18:00.335822789Z [err]  2025-12-19 12:17:59,782 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-19T12:18:00.335831961Z [err]  2025-12-19 12:17:59,782 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +2.5s (total: 4.9s from now)
2025-12-19T12:18:00.335837775Z [err]  2025-12-19 12:17:59,784 - persistent_tts_service - INFO - ‚úÖ Sent 126 audio chunks via WebSocket
2025-12-19T12:18:00.335843426Z [err]  2025-12-19 12:17:59,814 - server - INFO - üî§ RAW TOKENS: [" Wh"‚úì, "at"‚úì, "'s"‚úì, " that"‚úì, "?"‚úì, "<end>"‚úì]
2025-12-19T12:18:00.335849292Z [err]  2025-12-19 12:17:59,814 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-19T12:18:00.335854776Z [err]  2025-12-19 12:17:59,814 - server - INFO - üßπ Cleaned transcript: ' Wh at 's  that ?' -> 'what'sthat?'
2025-12-19T12:18:00.335860437Z [err]  2025-12-19 12:17:59,814 - server - INFO - üì• FINAL TOKENS: 'what'sthat?' (5 tokens)
2025-12-19T12:18:00.335866645Z [err]  2025-12-19 12:17:59,814 - server - INFO - üé§ Soniox final transcript: 'what'sthat?'
2025-12-19T12:18:00.335872085Z [err]  2025-12-19 12:17:59,814 - server - INFO - üéØ User speaking while TTS is_speaking=True - INTERRUPTION POSSIBLE
2025-12-19T12:18:00.335879010Z [err]  2025-12-19 12:17:59,814 - server - INFO - üîç FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=True, time_until_done=4.9s, generating=False, playbacks=0, is_active=True
2025-12-19T12:18:00.336262671Z [err]  2025-12-19 12:17:59,814 - server - INFO - üîï FILTERING 1-word/filler 'what'sthat?' - NOT calling on_final_transcript
2025-12-19T12:18:00.336270820Z [err]  2025-12-19 12:17:59,814 - server - INFO - üîï SKIPPING endpoint for 1-word/filler 'what'sthat?' (tts_speaking=True, is_active=True)
2025-12-19T12:18:00.336278507Z [err]  2025-12-19 12:17:59,814 - calling_service - INFO - üë§ User stopped speaking for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:00.336285516Z [err]  2025-12-19 12:17:59,814 - server - INFO - üë§ Marked user stopped speaking (filtered utterance)
2025-12-19T12:18:00.336358040Z [err]  2025-12-19 12:18:00,064 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=4.0s, checkin_count=1/2
2025-12-19T12:18:00.336647839Z [err]  2025-12-19 12:18:00,109 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (4.6s left)
2025-12-19T12:18:01.184327424Z [err]  2025-12-19 12:18:00,566 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=4.5s, checkin_count=1/2
2025-12-19T12:18:01.184333569Z [err]  2025-12-19 12:18:00,613 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (4.1s left)
2025-12-19T12:18:02.199254415Z [err]  2025-12-19 12:18:01,782 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-19T12:18:02.199259569Z [err]  2025-12-19 12:18:01,782 - persistent_tts_service - INFO - ‚úÖ [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] Receiver finished sentence #1: 3 chunks in 2678ms
2025-12-19T12:18:02.199264539Z [err]  2025-12-19 12:18:01,782 - persistent_tts_service - INFO - üéß [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] Receiver processing sentence #2: 'I was just, um, wondering if y...'
2025-12-19T12:18:02.199270068Z [err]  2025-12-19 12:18:01,782 - persistent_tts_service - INFO - üìä [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] DIAGNOSTIC: queue_latency=2678ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-19T12:18:03.111543999Z [err]  2025-12-19 12:18:02,811 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 509 total packets
2025-12-19T12:18:03.111548241Z [err]  [2025-12-19 12:18:02 +0000] [6] [INFO] connection closed
2025-12-19T12:18:03.111553920Z [err]  2025-12-19 12:18:02,871 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:18:03.111558293Z [err]  2025-12-19 12:18:02,871 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': '3394c623-8f4e-41ac-a512-83a48ded717b', 'occurred_at': '2025-12-19T12:18:02.529224Z', 'payload': {'call_control_id': 'v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw', 'call_leg_id': 'bbcc78f6-dcd4-11f0-abed-02420aef951f', 'call_quality_stats': {'inbound': {'jitter_max_variance': '60.07', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '531', 'skip_packet_count': '17'}, 'outbound': {'packet_count': '509', 'skip_packet_count': '0'}}, 'call_session_id': 'bbc9f4fa-dcd4-11f0-80d5-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-19T12:18:02.529224Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-19T12:17:49.329215Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:18:03.111679440Z [err]  2025-12-19 12:18:02,871 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:03.111685346Z [err]  2025-12-19 12:18:02,871 - server - INFO - üì® ================================================
2025-12-19T12:18:03.111689792Z [err]  2025-12-19 12:18:02,872 - server - INFO - üìû Call ended: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:03.111695064Z [err]  2025-12-19 12:18:02,872 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-19T12:18:03.115582847Z [err]  2025-12-19 12:18:02,875 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:18:03.115587211Z [err]  2025-12-19 12:18:02,875 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '40992a8d-10bb-4423-aa6e-b268f023c7cc', 'occurred_at': '2025-12-19T12:18:02.569375Z', 'payload': {'call_control_id': 'v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw', 'call_leg_id': 'bbcc78f6-dcd4-11f0-abed-02420aef951f', 'call_session_id': 'bbc9f4fa-dcd4-11f0-80d5-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-19T12:18:02.569375Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': '9DHK5lucag', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:18:03.115591076Z [err]  2025-12-19 12:18:02,875 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:03.115594920Z [err]  2025-12-19 12:18:02,875 - server - INFO - üì® ================================================
2025-12-19T12:18:03.115598630Z [err]  2025-12-19 12:18:02,876 - redis_service - INFO - ‚ûñ Removed playback 9DHK5lucag, 0 remaining for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:03.115603468Z [err]  2025-12-19 12:18:02,876 - server - INFO - üîä Redis: Removed playback 9DHK5lucag, 0 remaining
2025-12-19T12:18:03.115607393Z [err]  2025-12-19 12:18:02,876 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-19T12:18:03.115611238Z [err]  2025-12-19 12:18:02,877 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-19T12:18:03.115616294Z [err]  2025-12-19 12:18:02,877 - server - INFO - ‚úÖ Found session in active_telnyx_calls (local worker)
2025-12-19T12:18:03.118251237Z [err]  2025-12-19 12:18:02,978 - server - INFO - üì® ================================================
2025-12-19T12:18:03.118271374Z [inf]  100.64.0.6:21936 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:18:03.118288779Z [err]  2025-12-19 12:18:03,049 - server - INFO - üìù Updated call log: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:03.118295112Z [err]  2025-12-19 12:18:02,877 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146682.877754 for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:03.118303304Z [err]  2025-12-19 12:18:03,073 - calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-19T12:18:03.118309573Z [inf]  100.64.0.5:42070 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:18:03.118319565Z [err]  2025-12-19 12:18:02,878 - server - INFO - ‚è±Ô∏è Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-19T12:18:03.118325985Z [err]  2025-12-19 12:18:02,978 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:18:03.118331671Z [err]  2025-12-19 12:18:02,978 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': '3c8581ef-9886-49f1-ad18-c6781ad9f3c7', 'occurred_at': '2025-12-19T12:18:02.704412Z', 'payload': {'call_control_id': 'v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw', 'call_leg_id': 'bbcc78f6-dcd4-11f0-abed-02420aef951f', 'call_session_id': 'bbc9f4fa-dcd4-11f0-80d5-02420aef951f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': 'ed00cf9d-dc7c-4abb-932c-935d54f58089', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:18:03.118337578Z [err]  2025-12-19 12:18:02,978 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:03.121780009Z [err]  2025-12-19 12:18:03,074 - calling_service - INFO - üí¨ Sending FINAL check-in #2/2: Are you still there?
2025-12-19T12:18:03.121785721Z [err]  2025-12-19 12:18:03,074 - calling_service - INFO - ‚ö†Ô∏è Will end call if no response after next silence timeout
2025-12-19T12:18:03.121790739Z [err]  2025-12-19 12:18:03,074 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-19T12:18:03.121796075Z [err]  2025-12-19 12:18:03,074 - calling_service - INFO - ü§ñ Agent started speaking for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:18:03.121801439Z [err]  2025-12-19 12:18:03,074 - telnyx_service - INFO - üîä Speaking text on call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA: Are you still there?...
2025-12-19T12:18:03.121806459Z [err]  2025-12-19 12:18:03,074 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-19T12:18:03.121811754Z [err]  2025-12-19 12:18:03,074 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-19T12:18:03.121817523Z [err]  2025-12-19 12:18:03,074 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-19T12:18:03.121823215Z [err]  2025-12-19 12:18:03,074 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-19T12:18:03.121828466Z [err]  2025-12-19 12:18:03,074 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-19T12:18:03.121834497Z [err]  2025-12-19 12:18:03,074 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-19T12:18:03.121840323Z [err]  2025-12-19 12:18:03,074 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:18:03.121845501Z [err]  2025-12-19 12:18:03,074 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:18:03.121850653Z [err]  2025-12-19 12:18:03,079 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-19T12:18:03.124731751Z [err]  2025-12-19 12:18:03,083 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-19T12:18:03.124736016Z [err]  2025-12-19 12:18:03,084 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:18:03.137509380Z [err]  2025-12-19 12:18:03,127 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-19T12:18:03.137522814Z [err]  2025-12-19 12:18:03,127 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146683.1274302 for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:03.137531637Z [err]  2025-12-19 12:18:03,127 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:03.144708931Z [err]  2025-12-19 12:18:03,139 - server - INFO - ‚úÖ Finalized call log: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw (duration=10s, status=completed)
2025-12-19T12:18:03.233806247Z [err]  2025-12-19 12:18:03,227 - server - INFO - üì¶ Saved 11 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-19T12:18:03.342881323Z [err]  2025-12-19 12:18:03,338 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:18:03.342896300Z [err]  2025-12-19 12:18:03,339 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.26s
2025-12-19T12:18:03.342903587Z [err]  2025-12-19 12:18:03,339 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-19T12:18:03.342912132Z [err]    "errors": [
2025-12-19T12:18:03.342922567Z [err]      {
2025-12-19T12:18:03.342929692Z [err]        "code": "90018",
2025-12-19T12:18:03.342936086Z [err]        "title": "Call has already ended",
2025-12-19T12:18:03.342942125Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-19T12:18:03.342948806Z [err]      }
2025-12-19T12:18:03.342954957Z [err]    ]
2025-12-19T12:18:03.342961344Z [err]  }
2025-12-19T12:18:03.343060689Z [err]  2025-12-19 12:18:03,339 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-19T12:18:04.238446964Z [err]  2025-12-19 12:18:03,597 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:18:04.238455501Z [err]  2025-12-19 12:18:03,598 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-19T12:18:04.238463406Z [err]  2025-12-19 12:18:03,598 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-19T12:18:04.238470544Z [err]  2025-12-19 12:18:03,919 - server - INFO - üìä Auto-added call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-19T12:18:04.238477866Z [err]  2025-12-19 12:18:03,964 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:18:04.238486974Z [err]  2025-12-19 12:18:03,965 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '595ff1de-ee1f-4770-bfde-579833627055', 'occurred_at': '2025-12-19T12:18:03.723106Z', 'payload': {'call_control_id': 'v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw', 'call_leg_id': 'bbcc78f6-dcd4-11f0-abed-02420aef951f', 'call_session_id': 'bbc9f4fa-dcd4-11f0-80d5-02420aef951f', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-19T12:18:02.624043Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-19T12:18:02.624043Z', 'recording_id': 'a4fb4554-087b-4d6f-ab63-ae03a7ee3e29', 'recording_started_at': '2025-12-19T12:17:53.869881Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-19/bbcc78f6-dcd4-11f0-abed-02420aef951f-1766146672968517.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251219%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251219T121803Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=46841baca4746d6c59823ad79cbbba5a92904850a78fe22a85e12afeb237e66d'}, 'start_time': '2025-12-19T12:17:53.869881Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:18:04.242638724Z [err]  2025-12-19 12:18:03,965 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:04.242645539Z [err]  2025-12-19 12:18:03,965 - server - INFO - üì® ================================================
2025-12-19T12:18:04.242651086Z [err]  2025-12-19 12:18:03,965 - server - INFO - üéôÔ∏è Recording saved for call: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:04.242656886Z [err]  2025-12-19 12:18:03,966 - redis_service - INFO - üì• Retrieved call data from Redis: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:04.242662864Z [err]  2025-12-19 12:18:03,966 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=a4fb4554-087b-4d6f-ab63-ae03a7ee3e29, call_data=True
2025-12-19T12:18:04.242668313Z [err]  2025-12-19 12:18:04,057 - server - INFO - üíæ Saved recording URL and ID to database: a4fb4554-087b-4d6f-ab63-ae03a7ee3e29
2025-12-19T12:18:04.242673886Z [err]  2025-12-19 12:18:04,057 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-19T12:18:04.242679865Z [err]  2025-12-19 12:18:04,057 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-19T12:18:04.242685889Z [err]  2025-12-19 12:18:04,098 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-19T12:18:04.242692934Z [err]  2025-12-19 12:18:04,101 - redis_service - INFO - üì• Retrieved call data from Redis: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:04.242698538Z [err]  2025-12-19 12:18:04,101 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-19T12:18:04.242705723Z [err]  2025-12-19 12:18:04,101 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-19T12:18:04.242712105Z [err]  2025-12-19 12:18:04,192 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-19T12:18:04.283304322Z [err]  2025-12-19 12:18:04,279 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=6944df147eadbccc46887cdf, to_number=+17708336397
2025-12-19T12:18:04.283317684Z [err]  2025-12-19 12:18:04,279 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=6944df147eadbccc46887cdf, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3-antigrav
2025-12-19T12:18:04.283328484Z [err]  2025-12-19 12:18:04,279 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-19T12:18:04.283340300Z [err]  2025-12-19 12:18:04,279 - server - INFO - üöÄ Triggered QC analysis for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:04.283348099Z [err]  2025-12-19 12:18:04,279 - server - INFO - üìä Triggered Campaign QC for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:04.283363046Z [err]  2025-12-19 12:18:04,279 - server - INFO - üìá Triggered CRM update for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:04.283371130Z [err]  2025-12-19 12:18:04,279 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:04.283379774Z [err]  2025-12-19 12:18:04,280 - redis_service - INFO - üßπ Deleted call data from Redis: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:04.283387184Z [err]  2025-12-19 12:18:04,280 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:04.283394998Z [inf]  100.64.0.8:46680 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:18:04.283404330Z [err]  2025-12-19 12:18:04,281 - server - INFO - üîç Starting QC analysis for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:04.283411811Z [err]  2025-12-19 12:18:04,281 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=6944df147eadbccc46887cdf
2025-12-19T12:18:04.287429674Z [err]  2025-12-19 12:18:04,281 - server - INFO - üìá CRM update starting for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:18:04.287437198Z [err]  2025-12-19 12:18:04,281 - server - INFO - üìá Normalized phone: +17708336397
2025-12-19T12:18:04.287445221Z [err]  2025-12-19 12:18:04,282 - server - INFO - üìá CRM: Got 11 variables from active session
2025-12-19T12:18:04.287452577Z [err]  2025-12-19 12:18:04,282 - elevenlabs_ws_service - WARNING - ‚ö†Ô∏è  [TIMING] ElevenLabs timeout waiting for first chunk (2.5s) - No audio received!
2025-12-19T12:18:04.287460539Z [err]  2025-12-19 12:18:04,282 - persistent_tts_service - WARNING - ‚ö†Ô∏è [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] Receiver got 0 chunks for sentence #2! interrupted=False
2025-12-19T12:18:04.374078065Z [err]  2025-12-19 12:18:04,368 - server - INFO - üìù Converted transcript from 3 messages to 133 characters
2025-12-19T12:18:04.374099725Z [err]  2025-12-19 12:18:04,370 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=3, logs_count=4, status=completed
2025-12-19T12:18:04.374106688Z [err]  2025-12-19 12:18:04,371 - server - INFO - üìá CRM: Got 11 extracted variables
2025-12-19T12:18:04.374112831Z [err]  2025-12-19 12:18:04,371 - server - INFO - üìá CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-19T12:18:04.461886358Z [err]  2025-12-19 12:18:04,457 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:18:04.479246243Z [err]  2025-12-19 12:18:04,476 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-19/bbcc78f6-dcd4-11f0-abed-02420aef951f-1766146672968517.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251219%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251219T121803Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=46841baca4746d6c59823ad79cbbba5a92904850a78fe22a85e12afeb237e66d "HTTP/1.1 200 OK"
2025-12-19T12:18:05.165888018Z [err]  2025-12-19 12:18:04,547 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-19T12:18:05.165897751Z [err]  2025-12-19 12:18:04,568 - server - INFO - ‚úÖ Downloaded 35151 bytes
2025-12-19T12:18:05.165905156Z [err]  2025-12-19 12:18:04,592 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-19T12:18:05.165910610Z [err]  2025-12-19 12:18:04,593 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-19T12:18:05.165917344Z [err]  2025-12-19 12:18:04,629 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-19T12:18:05.165918107Z [err]  2025-12-19 12:18:04,543 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-19T12:18:05.165923859Z [err]  2025-12-19 12:18:04,629 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:18:05.165928824Z [err]  2025-12-19 12:18:04,629 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:05.165933821Z [err]  2025-12-19 12:18:04,800 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3-antigrav, has_auto_qc_settings=True
2025-12-19T12:18:05.165938576Z [err]  2025-12-19 12:18:04,807 - server - INFO - ‚úÖ Split into 2 channels
2025-12-19T12:18:05.165947613Z [err]  2025-12-19 12:18:04,807 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-19T12:18:05.165953962Z [err]  2025-12-19 12:18:04,807 - server - INFO - üìä Channel 0: 189244 bytes
2025-12-19T12:18:05.165960084Z [err]  2025-12-19 12:18:04,808 - server - ERROR - ‚ùå No Soniox API key available
2025-12-19T12:18:05.165970455Z [err]  2025-12-19 12:18:04,808 - server - INFO - ‚ùå Channel 0: No speech
2025-12-19T12:18:05.168376072Z [err]  2025-12-19 12:18:04,903 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-19T12:18:05.168383555Z [err]  2025-12-19 12:18:04,991 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:18:05.168394494Z [err]  2025-12-19 12:18:05,078 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:18:05.168402310Z [err]  2025-12-19 12:18:05,110 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-19T12:18:05.168409093Z [err]  2025-12-19 12:18:05,110 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-19T12:18:05.168424558Z [err]  2025-12-19 12:18:05,110 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-19T12:18:05.168435478Z [err]  2025-12-19 12:18:05,110 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-19T12:18:05.168507162Z [err]  2025-12-19 12:18:04,808 - server - INFO - üìä Channel 1: 189244 bytes
2025-12-19T12:18:05.168514175Z [err]  2025-12-19 12:18:04,808 - server - ERROR - ‚ùå No Soniox API key available
2025-12-19T12:18:05.168520843Z [err]  2025-12-19 12:18:04,808 - server - INFO - ‚ùå Channel 1: No speech
2025-12-19T12:18:05.168527019Z [err]  2025-12-19 12:18:04,808 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-19T12:18:05.168532823Z [inf]  100.64.0.6:21936 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:18:05.168539445Z [err]  2025-12-19 12:18:04,877 - persistent_tts_service - INFO - üîá [Call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw] FLOOR RELEASED (is_holding_floor=False)
2025-12-19T12:18:05.168545979Z [err]  2025-12-19 12:18:04,888 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-19T12:18:05.168552224Z [err]  2025-12-19 12:18:04,888 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-19T12:18:05.168557851Z [err]  2025-12-19 12:18:04,888 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-19T12:18:05.168563535Z [err]  2025-12-19 12:18:04,888 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-19T12:18:05.168569420Z [err]    File "/app/backend/server.py", line 9698, in trigger_campaign_qc_for_call
2025-12-19T12:18:05.168575131Z [err]      await run_full_qc_analysis(
2025-12-19T12:18:05.168581335Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-19T12:18:05.168587585Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-19T12:18:05.168594155Z [err]  
2025-12-19T12:18:06.050117937Z [err]  2025-12-19 12:18:05,924 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-19T12:18:06.050124199Z [err]  2025-12-19 12:18:05,925 - telnyx_service - INFO - ‚úÖ Call initiated: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:06.050130718Z [err]  2025-12-19 12:18:06,011 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:18:06.050137002Z [err]  2025-12-19 12:18:06,011 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': '06ef7357-8193-4629-a8ab-acb3a3d6dfb2', 'occurred_at': '2025-12-19T12:18:05.689212Z', 'payload': {'call_control_id': 'v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA', 'call_leg_id': 'c5933f14-dcd4-11f0-816a-02420aef96a0', 'call_session_id': 'c5903864-dcd4-11f0-b86c-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:18:06.050144771Z [err]  2025-12-19 12:18:06,011 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:06.050225115Z [err]  2025-12-19 12:18:06,011 - server - INFO - üì® ================================================
2025-12-19T12:18:06.050232234Z [err]  2025-12-19 12:18:06,011 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-19T12:18:06.050244528Z [inf]  100.64.0.6:21936 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:18:06.050251206Z [err]  2025-12-19 12:18:06,015 - server - INFO - üìù Created call log: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:06.050257056Z [err]  2025-12-19 12:18:06,015 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-19T12:18:06.051714786Z [err]  2025-12-19 12:18:06,016 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-19T12:18:06.053779843Z [err]  2025-12-19 12:18:06,016 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-19T12:18:06.053785569Z [err]  2025-12-19 12:18:06,016 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-19T12:18:06.053790452Z [err]  2025-12-19 12:18:06,022 - redis_service - INFO - üì¶ Stored call data in Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA (TTL: 3600s)
2025-12-19T12:18:06.053795323Z [err]  2025-12-19 12:18:06,023 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-19T12:18:06.053800500Z [err]  2025-12-19 12:18:06,023 - server - INFO - üìû Outbound call initiated: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:06.053808605Z [inf]  100.64.0.3:33828 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-19T12:18:06.136760637Z [err]  2025-12-19 12:18:06,134 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-19T12:18:06.136770015Z [err]  2025-12-19 12:18:06,134 - server - INFO -    Client: Address(host='100.64.0.9', port=14056)
2025-12-19T12:18:06.136779705Z [err]  2025-12-19 12:18:06,134 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'lt0DfhPP9EJAg9dBJbqwJA==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'RX1_Xq7hSEirSlD20_TJvA', 'x-real-ip': '192.76.120.151', 'x-request-start': '1766146685872', 'accept-encoding': 'gzip'}
2025-12-19T12:18:06.136785917Z [err]  2025-12-19 12:18:06,134 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-19T12:18:06.136792043Z [err]  2025-12-19 12:18:06,134 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-19T12:18:06.136798003Z [err]  [2025-12-19 12:18:06 +0000] [4] [INFO] ('100.64.0.9', 14056) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-19T12:18:06.136803772Z [err]  2025-12-19 12:18:06,135 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-19T12:18:06.136809498Z [err]  [2025-12-19 12:18:06 +0000] [4] [INFO] connection open
2025-12-19T12:18:06.289163189Z [err]  2025-12-19 12:18:06,286 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-19T12:18:06.289169240Z [err]  2025-12-19 12:18:06,286 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-19T12:18:06.397416238Z [err]  2025-12-19 12:18:06,390 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-19T12:18:06.397455300Z [err]  2025-12-19 12:18:06,391 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-19T12:18:07.166861276Z [err]  2025-12-19 12:18:07,162 - server - INFO - üé§ Soniox receiver alive - 2 messages received in last 10s
2025-12-19T12:18:07.166868955Z [err]  2025-12-19 12:18:07,162 - server - ERROR - ‚ùå Soniox error: {'tokens': [], 'final_audio_proc_ms': 6480, 'total_audio_proc_ms': 12000, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-19T12:18:07.166874239Z [err]  2025-12-19 12:18:07,162 - server - INFO - ‚úÖ Soniox receive loop ended normally
2025-12-19T12:18:07.166879659Z [err]  2025-12-19 12:18:07,162 - dead_air_monitor - INFO - üîá Dead air monitoring cancelled for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:18:07.166886067Z [err]  2025-12-19 12:18:07,162 - dead_air_monitor - INFO - üîá Dead air monitoring stopped for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:18:07.166891846Z [err]  2025-12-19 12:18:07,162 - server - INFO - üîá Dead air monitoring task cancelled
2025-12-19T12:18:08.468167248Z [err]  2025-12-19 12:18:08,464 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:18:08.468179367Z [err]  2025-12-19 12:18:08,464 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': '0b567549-60bb-437a-a334-4a9f8d8eea1e', 'occurred_at': '2025-12-19T12:18:08.069217Z', 'payload': {'call_control_id': 'v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA', 'call_leg_id': 'c5933f14-dcd4-11f0-816a-02420aef96a0', 'call_session_id': 'c5903864-dcd4-11f0-b86c-02420aef96a0', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-19T12:18:05.689212Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:18:08.468186903Z [err]  2025-12-19 12:18:08,464 - server - INFO - üéØ Event type: call.answered, Call ID: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:08.468193300Z [err]  2025-12-19 12:18:08,464 - server - INFO - üì® ================================================
2025-12-19T12:18:08.468199085Z [err]  2025-12-19 12:18:08,464 - server - INFO - ‚úÖ Call answered: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:08.472365383Z [err]  2025-12-19 12:18:08,470 - redis_service - INFO - üì• Retrieved call data from Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:08.484186648Z [err]  2025-12-19 12:18:08,479 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-19T12:18:08.484198118Z [err]  2025-12-19 12:18:08,479 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-19T12:18:09.118566746Z [err]  [2025-12-19 12:18:08 +0000] [4] [INFO] connection open
2025-12-19T12:18:09.118579736Z [err]  2025-12-19 12:18:08,570 - server - INFO - ‚úÖ Call log updated
2025-12-19T12:18:09.118589901Z [err]  2025-12-19 12:18:08,570 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-19T12:18:09.118597930Z [err]  2025-12-19 12:18:08,570 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-19T12:18:09.118606801Z [err]  2025-12-19 12:18:08,571 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:18:09.118619743Z [err]  2025-12-19 12:18:08,525 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-19T12:18:09.118627303Z [err]  2025-12-19 12:18:08,525 - server - INFO -    Client: Address(host='100.64.0.9', port=14060)
2025-12-19T12:18:09.118632797Z [err]  2025-12-19 12:18:08,525 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'Ql5Ge3AYOGoKHGO5oxmAhQ==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'vuibeWQMSJqJxumO0_TJvA', 'x-real-ip': '192.76.120.151', 'x-request-start': '1766146688264', 'accept-encoding': 'gzip'}
2025-12-19T12:18:09.118638232Z [err]  2025-12-19 12:18:08,525 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-19T12:18:09.118644232Z [err]  2025-12-19 12:18:08,525 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-19T12:18:09.118649960Z [err]  [2025-12-19 12:18:08 +0000] [4] [INFO] ('100.64.0.9', 14060) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-19T12:18:09.118658455Z [err]  2025-12-19 12:18:08,526 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-19T12:18:09.123115565Z [err]  2025-12-19 12:18:08,686 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-19T12:18:09.123126944Z [err]  2025-12-19 12:18:08,686 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-19T12:18:09.123133074Z [err]  2025-12-19 12:18:08,746 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:18:09.123144151Z [err]  2025-12-19 12:18:08,682 - redis_service - INFO - üì• Retrieved call data from Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:09.123171226Z [err]  2025-12-19 12:18:08,885 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': '52e3c8d2-0424-4dff-99a6-66be2908ef9c', 'occurred_at': '2025-12-19T12:18:08.509212Z', 'payload': {'call_control_id': 'v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA', 'call_leg_id': 'c5933f14-dcd4-11f0-816a-02420aef96a0', 'call_session_id': 'c5903864-dcd4-11f0-b86c-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '7a630811-e1ef-49ff-b9db-bb6ba228532b', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:18:09.123220432Z [err]  2025-12-19 12:18:08,746 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-19T12:18:09.123226855Z [err]  2025-12-19 12:18:08,778 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-19T12:18:09.123232439Z [err]  2025-12-19 12:18:08,885 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:18:09.123683616Z [err]  2025-12-19 12:18:08,658 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:18:09.123688758Z [err]  2025-12-19 12:18:08,677 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-19T12:18:09.123693851Z [err]  2025-12-19 12:18:08,677 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-19T12:18:09.123698656Z [err]  2025-12-19 12:18:08,678 - server - INFO - üì¨ Received Telnyx event: start
2025-12-19T12:18:09.123704617Z [err]  2025-12-19 12:18:08,678 - server - INFO - üé¨ Stream started for call: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:09.128383637Z [err]  2025-12-19 12:18:08,889 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-19T12:18:09.128395976Z [err]  [2025-12-19 12:18:08 +0000] [3] [INFO] ('100.64.0.8', 36800) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-19T12:18:09.128405310Z [err]  2025-12-19 12:18:08,890 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-19T12:18:09.128415285Z [err]  [2025-12-19 12:18:08 +0000] [3] [INFO] connection open
2025-12-19T12:18:09.128424356Z [err]  2025-12-19 12:18:08,959 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-19T12:18:09.128701012Z [err]  2025-12-19 12:18:08,885 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:09.128708299Z [err]  2025-12-19 12:18:08,885 - server - INFO - üì® ================================================
2025-12-19T12:18:09.128716364Z [inf]  100.64.0.6:21936 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:18:09.128723035Z [err]  2025-12-19 12:18:08,889 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-19T12:18:09.128730276Z [err]  2025-12-19 12:18:08,889 - server - INFO -    Client: Address(host='100.64.0.8', port=36800)
2025-12-19T12:18:09.128737120Z [err]  2025-12-19 12:18:08,889 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': '5rUEeW5FepA6qGledPAzXw==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'kJxvFIZdRrKYB3UnLPU1MQ', 'x-real-ip': '192.76.120.151', 'x-request-start': '1766146688622', 'accept-encoding': 'gzip'}
2025-12-19T12:18:09.128743322Z [err]  2025-12-19 12:18:08,889 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-19T12:18:09.165481993Z [err]  2025-12-19 12:18:08,960 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-19T12:18:09.165487887Z [err]  2025-12-19 12:18:09,043 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-19T12:18:09.165492893Z [err]  2025-12-19 12:18:09,044 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: ldTlvnTpzQ (loop=True, overlay=True)
2025-12-19T12:18:09.165497947Z [err]  2025-12-19 12:18:09,044 - server - WARNING - ‚ö†Ô∏è Failed to start comfort noise: 'v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA'
2025-12-19T12:18:09.165503085Z [err]  2025-12-19 12:18:09,044 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:09.165507907Z [err]  2025-12-19 12:18:09,050 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-19T12:18:09.165512632Z [err]  2025-12-19 12:18:09,051 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-19T12:18:09.165517527Z [err]  2025-12-19 12:18:09,051 - server - INFO - üì¨ Received Telnyx event: start
2025-12-19T12:18:09.165522765Z [err]  2025-12-19 12:18:09,051 - server - INFO - üé¨ Stream started for call: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:09.165528589Z [err]  2025-12-19 12:18:09,055 - redis_service - INFO - üì• Retrieved call data from Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:09.165534613Z [err]  2025-12-19 12:18:09,057 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-19T12:18:09.165541373Z [err]  2025-12-19 12:18:09,057 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-19T12:18:09.165547247Z [err]  2025-12-19 12:18:09,162 - soniox_service - ERROR - ‚ùå Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-19T12:18:09.168802626Z [err]  2025-12-19 12:18:09,162 - server - INFO - üîå Telnyx WebSocket disconnected
2025-12-19T12:18:09.190025362Z [err]  2025-12-19 12:18:09,186 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-19T12:18:09.190032830Z [err]  2025-12-19 12:18:09,186 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-19T12:18:09.193693663Z [err]  2025-12-19 12:18:09,191 - redis_service - INFO - üì• Retrieved call data from Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:09.196924787Z [err]  2025-12-19 12:18:09,192 - server - INFO - üìù Creating session with agent_id=6944df147eadbccc46887cdf, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:18:09.196932124Z [err]  2025-12-19 12:18:09,192 - calling_service - INFO - üîç Checking KB for agent 6944df147eadbccc46887cdf...
2025-12-19T12:18:09.281130319Z [err]  2025-12-19 12:18:09,280 - calling_service - INFO - üîç KB count query completed: 0 items
2025-12-19T12:18:09.281137679Z [err]  2025-12-19 12:18:09,280 - calling_service - INFO - üìã Built cached system prompt: 5480 chars (global) + 1402 chars (technical)
2025-12-19T12:18:09.284809757Z [err]  2025-12-19 12:18:09,280 - calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-19T12:18:09.370000035Z [err]  2025-12-19 12:18:09,367 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:18:09.388046035Z [err]  2025-12-19 12:18:09,380 - calling_service - INFO - ‚úÖ LLM client pre-warmed in 100ms
2025-12-19T12:18:09.388051255Z [err]  2025-12-19 12:18:09,380 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-19T12:18:09.388057086Z [err]  2025-12-19 12:18:09,381 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-19T12:18:09.388062148Z [err]  2025-12-19 12:18:09,381 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-19T12:18:09.388070353Z [err]  2025-12-19 12:18:09,381 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-19T12:18:09.388076827Z [err]  2025-12-19 12:18:09,381 - server - INFO - ‚úÖ Initialized call_states for v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA with session reference
2025-12-19T12:18:09.388084355Z [err]  2025-12-19 12:18:09,382 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-19T12:18:09.479876192Z [err]  2025-12-19 12:18:09,472 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-19T12:18:10.070373812Z [err]  2025-12-19 12:18:09,556 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-19T12:18:10.070378757Z [err]  2025-12-19 12:18:09,556 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-19T12:18:10.070383634Z [err]  2025-12-19 12:18:09,560 - redis_service - INFO - üì• Retrieved call data from Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:10.070388801Z [err]  2025-12-19 12:18:09,562 - server - INFO - üìù Creating session with agent_id=6944df147eadbccc46887cdf, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:18:10.070393906Z [err]  2025-12-19 12:18:09,562 - calling_service - INFO - üîç Checking KB for agent 6944df147eadbccc46887cdf...
2025-12-19T12:18:10.070399867Z [err]  2025-12-19 12:18:09,572 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:18:10.070405301Z [err]  2025-12-19 12:18:09,572 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': 'c7540ee3-a1c6-4ab7-a4b5-1fff6866fe36', 'occurred_at': '2025-12-19T12:18:09.189211Z', 'payload': {'call_control_id': 'v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA', 'call_leg_id': 'c5933f14-dcd4-11f0-816a-02420aef96a0', 'call_session_id': 'c5903864-dcd4-11f0-b86c-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'ldTlvnTpzQ', 'start_time': '2025-12-19T12:18:09.189211Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:18:10.070410853Z [err]  2025-12-19 12:18:09,572 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:10.070416575Z [err]  2025-12-19 12:18:09,572 - server - INFO - üì® ================================================
2025-12-19T12:18:10.070603745Z [err]  2025-12-19 12:18:09,745 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-19T12:18:10.070622155Z [err]  2025-12-19 12:18:09,745 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-19T12:18:10.070632251Z [err]  2025-12-19 12:18:09,745 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-19T12:18:10.070640479Z [err]  2025-12-19 12:18:09,745 - server - INFO - ‚úÖ Initialized call_states for v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA with session reference
2025-12-19T12:18:10.070647251Z [err]  2025-12-19 12:18:09,747 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-19T12:18:10.070657185Z [err]  2025-12-19 12:18:09,831 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-19T12:18:10.070657429Z [inf]  100.64.0.9:43590 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:18:10.070665462Z [err]  2025-12-19 12:18:09,949 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-19T12:18:10.070669083Z [err]  2025-12-19 12:18:09,648 - calling_service - INFO - üîç KB count query completed: 0 items
2025-12-19T12:18:10.070673567Z [err]  2025-12-19 12:18:09,949 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-19T12:18:10.070675289Z [err]  2025-12-19 12:18:09,648 - calling_service - INFO - üìã Built cached system prompt: 5480 chars (global) + 1402 chars (technical)
2025-12-19T12:18:10.070682531Z [err]  2025-12-19 12:18:09,648 - calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-19T12:18:10.070688795Z [err]  2025-12-19 12:18:09,735 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:18:10.070694562Z [err]  2025-12-19 12:18:09,745 - calling_service - INFO - ‚úÖ LLM client pre-warmed in 96ms
2025-12-19T12:18:10.070700187Z [err]  2025-12-19 12:18:09,745 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-19T12:18:10.072415655Z [err]  2025-12-19 12:18:09,949 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-19T12:18:10.072422692Z [err]  2025-12-19 12:18:09,950 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:10.072429092Z [err]  2025-12-19 12:18:09,950 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:10.331834127Z [err]  2025-12-19 12:18:10,319 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-19T12:18:10.331839333Z [err]  2025-12-19 12:18:10,319 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-19T12:18:10.331844311Z [err]  2025-12-19 12:18:10,319 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-19T12:18:10.331849572Z [err]  2025-12-19 12:18:10,319 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:10.331857125Z [err]  2025-12-19 12:18:10,321 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:10.331862421Z [err]  2025-12-19 12:18:10,321 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-19T12:18:10.331868271Z [err]  2025-12-19 12:18:10,321 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-19T12:18:10.460313006Z [err]  2025-12-19 12:18:10,452 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:10.460319347Z [err]  2025-12-19 12:18:10,452 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-19T12:18:10.460325989Z [err]  2025-12-19 12:18:10,452 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=7.3s, checkin_count=0/2
2025-12-19T12:18:10.460332637Z [err]  2025-12-19 12:18:10,453 - calling_service - INFO - ‚è∞ Check-in triggered after 7.3s silence (threshold: 7s)
2025-12-19T12:18:10.460339270Z [err]  2025-12-19 12:18:10,454 - calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-19T12:18:10.460345829Z [err]  2025-12-19 12:18:10,454 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.3s silence: Are you still there?
2025-12-19T12:18:10.460352042Z [err]  2025-12-19 12:18:10,454 - calling_service - INFO - ü§ñ Agent started speaking for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:10.460358865Z [err]  2025-12-19 12:18:10,454 - telnyx_service - INFO - üîä Speaking text on call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw: Are you still there?...
2025-12-19T12:18:10.460365505Z [err]  2025-12-19 12:18:10,454 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-19T12:18:10.460371655Z [err]  2025-12-19 12:18:10,454 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-19T12:18:10.460377506Z [err]  2025-12-19 12:18:10,454 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-19T12:18:10.460386718Z [err]  2025-12-19 12:18:10,454 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-19T12:18:10.460393280Z [err]  2025-12-19 12:18:10,454 - server - INFO - ‚è±Ô∏è [12:18:10.454] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-19T12:18:10.464220258Z [err]  2025-12-19 12:18:10,454 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-19T12:18:10.464227361Z [err]  2025-12-19 12:18:10,454 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-19T12:18:11.084775927Z [err]  2025-12-19 12:18:10,513 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA/actions/record_start "HTTP/1.1 200 OK"
2025-12-19T12:18:11.084782826Z [err]  2025-12-19 12:18:10,516 - server - INFO - üéôÔ∏è Call recording started for v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:11.084788739Z [err]  2025-12-19 12:18:10,516 - server - INFO - üîß Creating call session for v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA...
2025-12-19T12:18:11.084794526Z [err]  2025-12-19 12:18:10,516 - server - INFO - üîç Agent ID: 6944df147eadbccc46887cdf, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:18:11.084800454Z [err]  2025-12-19 12:18:10,516 - server - INFO - üîß Calling create_call_session() - START
2025-12-19T12:18:11.084806574Z [err]  2025-12-19 12:18:10,516 - calling_service - INFO - üîç Checking KB for agent 6944df147eadbccc46887cdf...
2025-12-19T12:18:11.084812765Z [err]  2025-12-19 12:18:10,520 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-19T12:18:11.084820052Z [err]  2025-12-19 12:18:10,521 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Expecting value: line 1 column 1 (char 0)
2025-12-19T12:18:11.084826882Z [err]  2025-12-19 12:18:10,543 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:18:11.084833685Z [err]  2025-12-19 12:18:10,543 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-19T12:18:11.084839666Z [err]  2025-12-19 12:18:10,543 - server - INFO -    Text length: 20 chars
2025-12-19T12:18:11.084846956Z [err]  2025-12-19 12:18:10,543 - server - INFO -    Text content: 'Are you still there?'
2025-12-19T12:18:11.084853473Z [err]  2025-12-19 12:18:10,543 - server - INFO -    Text bytes: b'Are you still there?'
2025-12-19T12:18:11.084860096Z [err]  2025-12-19 12:18:10,543 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-19T12:18:11.089109684Z [err]  2025-12-19 12:18:10,543 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-19T12:18:11.089115236Z [err]  2025-12-19 12:18:10,555 - server - INFO -    ‚úì HTTP client created (0.012s)
2025-12-19T12:18:11.089138890Z [err]  2025-12-19 12:18:10,543 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-19T12:18:11.089141334Z [err]  2025-12-19 12:18:10,555 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-19T12:18:11.089150326Z [err]  2025-12-19 12:18:10,621 - server - INFO - üìä Scores: Commitment=50, Conversion=20, Excellence=50
2025-12-19T12:18:11.089157187Z [err]  2025-12-19 12:18:10,543 - server - INFO -    Full data: {'text': 'Are you still there?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-19T12:18:11.089159357Z [err]  2025-12-19 12:18:10,605 - calling_service - INFO - üîç KB count query completed: 0 items
2025-12-19T12:18:11.089166269Z [err]  2025-12-19 12:18:10,543 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-19T12:18:11.089172619Z [err]  2025-12-19 12:18:10,543 - server - INFO -    Timeout: 10.0s
2025-12-19T12:18:11.089176834Z [err]  2025-12-19 12:18:10,620 - calling_service - INFO - üìã Built cached system prompt: 5480 chars (global) + 1402 chars (technical)
2025-12-19T12:18:11.089181940Z [err]  2025-12-19 12:18:10,621 - calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-19T12:18:11.089187440Z [err]  2025-12-19 12:18:10,621 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:18:11.089192789Z [err]  2025-12-19 12:18:10,621 - server - INFO - ‚úÖ QC analysis completed for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:18:11.094252240Z [err]  2025-12-19 12:18:10,709 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:18:11.094256911Z [err]  2025-12-19 12:18:10,721 - calling_service - INFO - ‚úÖ LLM client pre-warmed in 99ms
2025-12-19T12:18:11.094261862Z [err]  2025-12-19 12:18:10,721 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-19T12:18:11.094265635Z [err]  2025-12-19 12:18:10,721 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-19T12:18:11.094272276Z [err]  2025-12-19 12:18:10,729 - redis_service - INFO - üì¶ Stored call data in Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA (TTL: 3600s)
2025-12-19T12:18:11.094276873Z [err]  2025-12-19 12:18:10,729 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-19T12:18:11.094282143Z [err]  2025-12-19 12:18:10,729 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-19T12:18:11.094287027Z [err]  2025-12-19 12:18:10,730 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:11.094291828Z [err]  2025-12-19 12:18:10,730 - server - INFO - ü§ñ AI session created for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:11.094296409Z [err]  2025-12-19 12:18:10,730 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-19T12:18:11.094301188Z [err]  2025-12-19 12:18:10,730 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-19T12:18:11.094305947Z [err]  2025-12-19 12:18:10,730 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-19T12:18:11.095345699Z [err]  2025-12-19 12:18:10,730 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-19T12:18:11.095364559Z [err]  2025-12-19 12:18:10,730 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-19T12:18:11.095375000Z [err]  2025-12-19 12:18:10,730 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-19T12:18:11.095385759Z [err]  2025-12-19 12:18:10,821 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-19T12:18:11.095386145Z [err]  2025-12-19 12:18:10,730 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-19T12:18:11.095392931Z [err]  2025-12-19 12:18:10,880 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-19T12:18:11.095404015Z [err]  2025-12-19 12:18:10,822 - server - INFO - üìä Updated campaign_calls with QC scores for v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA
2025-12-19T12:18:11.095409937Z [inf]  100.64.0.12:10068 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:18:11.095417927Z [err]  2025-12-19 12:18:10,880 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-19T12:18:11.095423416Z [err]  2025-12-19 12:18:10,821 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:11.095428016Z [err]  2025-12-19 12:18:10,880 - server - INFO -    ‚úì Connection established (0.337s) [TARGET: <200ms]
2025-12-19T12:18:11.095434723Z [err]  2025-12-19 12:18:10,880 - server - INFO -    ‚úì Response status: 200
2025-12-19T12:18:11.095456228Z [err]  2025-12-19 12:18:10,730 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-19T12:18:11.095462514Z [err]  2025-12-19 12:18:10,730 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-19T12:18:11.097176519Z [err]  2025-12-19 12:18:10,892 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-19T12:18:11.097182572Z [err]  2025-12-19 12:18:10,892 - server - INFO -       - Connection: 337ms
2025-12-19T12:18:11.097187353Z [err]  2025-12-19 12:18:10,892 - server - INFO -       - First chunk: 347ms
2025-12-19T12:18:11.097191823Z [err]  2025-12-19 12:18:10,892 - server - INFO -       - All chunks: 349ms
2025-12-19T12:18:11.097196177Z [err]  2025-12-19 12:18:10,892 - server - INFO -       - Audio generation only: 10ms
2025-12-19T12:18:11.097200265Z [err]  2025-12-19 12:18:10,893 - server - INFO - ‚è±Ô∏è [12:18:10.893] üîä TTS COMPLETE: 438ms, audio_size=17599 bytes
2025-12-19T12:18:11.097204229Z [err]  2025-12-19 12:18:10,893 - server - INFO - üíæ TTS CACHED: elevenlabs:Are you still there?... (17599 bytes)
2025-12-19T12:18:11.097208633Z [err]  2025-12-19 12:18:10,893 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.44s
2025-12-19T12:18:11.097212904Z [err]  2025-12-19 12:18:10,893 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:18:11.097217213Z [err]  2025-12-19 12:18:10,893 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:18:11.097221093Z [err]  2025-12-19 12:18:10,954 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:11.097224488Z [err]  2025-12-19 12:18:10,954 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-19T12:18:11.097268341Z [err]  2025-12-19 12:18:10,890 - server - INFO -    ‚úì FIRST CHUNK received (0.347s, 1075 bytes) [TARGET: <300ms]
2025-12-19T12:18:11.097275580Z [err]  2025-12-19 12:18:10,892 - server - INFO -    ‚úì ALL CHUNKS received: 52 chunks (0.349s)
2025-12-19T12:18:11.097281057Z [err]  2025-12-19 12:18:10,892 - server - INFO -    ‚úì Total audio size: 17599 bytes
2025-12-19T12:18:11.099960196Z [err]  2025-12-19 12:18:11,087 - server - INFO - üè∑Ô∏è Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-19T12:18:11.099966791Z [err]  2025-12-19 12:18:11,087 - server - ERROR - ‚ùå Error in auto appointment detection for call v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA: 'str' object has no attribute 'get'
2025-12-19T12:18:11.100050870Z [err]  2025-12-19 12:18:10,999 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-19T12:18:11.155082465Z [err]  2025-12-19 12:18:11,150 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:18:11.155101231Z [err]  2025-12-19 12:18:11,151 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.26s
2025-12-19T12:18:11.155106989Z [err]  2025-12-19 12:18:11,151 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-19T12:18:11.155119104Z [err]    "errors": [
2025-12-19T12:18:11.155127593Z [err]      {
2025-12-19T12:18:11.155134191Z [err]        "code": "90018",
2025-12-19T12:18:11.155139690Z [err]        "title": "Call has already ended",
2025-12-19T12:18:11.155145596Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-19T12:18:11.155150784Z [err]      }
2025-12-19T12:18:11.155156318Z [err]    ]
2025-12-19T12:18:11.155162179Z [err]  }
2025-12-19T12:18:11.155169046Z [err]  2025-12-19 12:18:11,151 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-19T12:18:11.329662758Z [err]  2025-12-19 12:18:11,326 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:11.390076986Z [err]  2025-12-19 12:18:11,388 - redis_service - INFO - üì• Retrieved call data from Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:11.394146928Z [err]  2025-12-19 12:18:11,390 - redis_service - INFO - üì¶ Stored call data in Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA (TTL: 3600s)
2025-12-19T12:18:11.394153138Z [err]  2025-12-19 12:18:11,391 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-19T12:18:11.394157353Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - ‚è±Ô∏è [12:18:11.391] üì• process_user_input() ENTRY - text: '...'
2025-12-19T12:18:11.394161472Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - ‚è±Ô∏è [12:18:11.391] ‚è© About to call _process_call_flow_streaming()
2025-12-19T12:18:11.394165268Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - ‚è±Ô∏è [12:18:11.391] üîÄ Agent type: call_flow, calling flow processor...
2025-12-19T12:18:11.394169200Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - ‚è±Ô∏è [12:18:11.391] üîÄ _process_call_flow_streaming() ENTRY
2025-12-19T12:18:11.394173293Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-19T12:18:11.394177505Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - ‚è±Ô∏è [12:18:11.391] ‚úÖ Node selected, about to process content...
2025-12-19T12:18:11.394181369Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - üîß Replaced {{now}} with Friday, December 19, 2025 at 7:18 AM EST in content
2025-12-19T12:18:11.394185239Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-19T12:18:11.394190369Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-19T12:18:11.394195062Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-19T12:18:11.394199928Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-19T12:18:11.399525938Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-19T12:18:11.399550149Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-19T12:18:11.399555958Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-19T12:18:11.399561389Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-19T12:18:11.399568637Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-19T12:18:11.399577078Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-19T12:18:11.399582638Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-19T12:18:11.399588470Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-19T12:18:11.399593777Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - ‚è±Ô∏è [12:18:11.391] üìÑ About to process content (mode=script, length=9)
2025-12-19T12:18:11.399599021Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - üîä Silence tracking reset for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA (user responded)
2025-12-19T12:18:11.399604361Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-19T12:18:11.399610183Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-19T12:18:11.399616595Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - LLM response (0.00s): Kendrick?
2025-12-19T12:18:11.400757789Z [err]  2025-12-19 12:18:11,391 - calling_service - INFO - Total latency: 0.00s
2025-12-19T12:18:11.400766112Z [err]  2025-12-19 12:18:11,391 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-19T12:18:11.404628356Z [err]  2025-12-19 12:18:11,400 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:18:11.404639909Z [err]  2025-12-19 12:18:11,401 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-19T12:18:11.404647013Z [err]  2025-12-19 12:18:11,401 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-19T12:18:11.457255140Z [err]  2025-12-19 12:18:11,455 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:11.486940425Z [err]  2025-12-19 12:18:11,482 - redis_service - INFO - üì• Retrieved call data from Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:11.486949416Z [err]  2025-12-19 12:18:11,482 - telnyx_service - INFO - üîä Speaking text on call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA: Kendrick?...
2025-12-19T12:18:11.486956913Z [err]  2025-12-19 12:18:11,482 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-19T12:18:11.486963481Z [err]  2025-12-19 12:18:11,482 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-19T12:18:11.486970610Z [err]  2025-12-19 12:18:11,482 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-19T12:18:11.486976867Z [err]  2025-12-19 12:18:11,482 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-19T12:18:11.486983373Z [err]  2025-12-19 12:18:11,482 - server - INFO - ‚è±Ô∏è [12:18:11.482] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-19T12:18:11.486989467Z [err]  2025-12-19 12:18:11,482 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-19T12:18:11.486996520Z [err]  2025-12-19 12:18:11,482 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-19T12:18:12.183965900Z [err]  2025-12-19 12:18:11,580 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-19T12:18:12.183973026Z [err]  2025-12-19 12:18:11,748 - redis_service - INFO - üì• Retrieved call data from Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:12.184072281Z [err]  2025-12-19 12:18:11,570 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-19T12:18:12.184072440Z [err]  2025-12-19 12:18:11,570 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:18:12.184081549Z [err]  2025-12-19 12:18:11,570 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-19T12:18:12.184084860Z [err]  2025-12-19 12:18:11,570 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-19T12:18:12.184091243Z [err]  2025-12-19 12:18:11,570 - server - INFO -    Text length: 9 chars
2025-12-19T12:18:12.184093465Z [err]  2025-12-19 12:18:11,570 - server - INFO -    Full data: {'text': 'Kendrick?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-19T12:18:12.184099814Z [err]  2025-12-19 12:18:11,570 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-19T12:18:12.184105006Z [err]  2025-12-19 12:18:11,570 - server - INFO -    Text content: 'Kendrick?'
2025-12-19T12:18:12.184107114Z [err]  2025-12-19 12:18:11,570 - server - INFO -    Timeout: 10.0s
2025-12-19T12:18:12.184114740Z [err]  2025-12-19 12:18:11,570 - server - INFO -    Text bytes: b'Kendrick?'
2025-12-19T12:18:12.184120936Z [err]  2025-12-19 12:18:11,580 - server - INFO -    ‚úì HTTP client created (0.010s)
2025-12-19T12:18:12.184130453Z [err]  2025-12-19 12:18:11,570 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-19T12:18:12.190299194Z [err]  2025-12-19 12:18:11,749 - calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-19T12:18:12.190304641Z [err]  2025-12-19 12:18:11,749 - redis_service - INFO - üì¶ Stored call data in Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA (TTL: 3600s)
2025-12-19T12:18:12.190309865Z [err]  2025-12-19 12:18:11,749 - calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-19T12:18:12.190317581Z [err]  2025-12-19 12:18:11,749 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-19T12:18:12.190318861Z [err]  2025-12-19 12:18:11,749 - calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-19T12:18:12.190329394Z [err]  2025-12-19 12:18:11,749 - calling_service - INFO - ‚è±Ô∏è [12:18:11.749] üì• process_user_input() ENTRY - text: '...'
2025-12-19T12:18:12.190335425Z [err]  2025-12-19 12:18:11,749 - calling_service - INFO - ‚è±Ô∏è [12:18:11.749] ‚è© About to call _process_call_flow_streaming()
2025-12-19T12:18:12.190341662Z [err]  2025-12-19 12:18:11,750 - calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-19T12:18:12.190342332Z [err]  2025-12-19 12:18:11,749 - calling_service - INFO - ‚è±Ô∏è [12:18:11.749] üîÄ Agent type: call_flow, calling flow processor...
2025-12-19T12:18:12.190349041Z [err]  2025-12-19 12:18:11,749 - calling_service - INFO - ‚è±Ô∏è [12:18:11.749] üîÄ _process_call_flow_streaming() ENTRY
2025-12-19T12:18:12.190355364Z [err]  2025-12-19 12:18:11,749 - calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-19T12:18:12.190363827Z [err]  2025-12-19 12:18:11,749 - calling_service - INFO - ‚è±Ô∏è [12:18:11.749] ‚úÖ Node selected, about to process content...
2025-12-19T12:18:12.190372961Z [err]  2025-12-19 12:18:11,749 - calling_service - INFO - üîß Replaced {{now}} with Friday, December 19, 2025 at 7:18 AM EST in content
2025-12-19T12:18:12.192579557Z [err]  2025-12-19 12:18:11,750 - calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-19T12:18:12.192589115Z [err]  2025-12-19 12:18:11,750 - calling_service - INFO - LLM response (0.00s): Kendrick?
2025-12-19T12:18:12.192601424Z [err]  2025-12-19 12:18:11,750 - calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-19T12:18:12.192610644Z [err]  2025-12-19 12:18:11,750 - calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-19T12:18:12.192617334Z [err]  2025-12-19 12:18:11,750 - calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-19T12:18:12.192623647Z [err]  2025-12-19 12:18:11,750 - calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-19T12:18:12.192629656Z [err]  2025-12-19 12:18:11,750 - calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-19T12:18:12.192635447Z [err]  2025-12-19 12:18:11,750 - calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-19T12:18:12.192640596Z [err]  2025-12-19 12:18:11,750 - calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-19T12:18:12.192646995Z [err]  2025-12-19 12:18:11,750 - calling_service - INFO - ‚è±Ô∏è [12:18:11.750] üìÑ About to process content (mode=script, length=9)
2025-12-19T12:18:12.192648864Z [err]  2025-12-19 12:18:11,750 - calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-19T12:18:12.192653733Z [err]  2025-12-19 12:18:11,750 - calling_service - INFO - üîä Silence tracking reset for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA (user responded)
2025-12-19T12:18:12.192662090Z [err]  2025-12-19 12:18:11,750 - calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-19T12:18:12.195688682Z [err]  2025-12-19 12:18:11,750 - calling_service - INFO - Total latency: 0.00s
2025-12-19T12:18:12.195695942Z [err]  2025-12-19 12:18:11,750 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-19T12:18:12.195702845Z [err]  2025-12-19 12:18:11,827 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:12.195708907Z [err]  2025-12-19 12:18:11,839 - redis_service - INFO - üì• Retrieved call data from Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:12.195716516Z [err]  2025-12-19 12:18:11,840 - telnyx_service - INFO - üîä Speaking text on call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA: Kendrick?...
2025-12-19T12:18:12.195720817Z [err]  2025-12-19 12:18:11,840 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-19T12:18:12.195724814Z [err]  2025-12-19 12:18:11,840 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-19T12:18:12.195730017Z [err]  2025-12-19 12:18:11,840 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-19T12:18:12.195735188Z [err]  2025-12-19 12:18:11,840 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-19T12:18:12.195740168Z [err]  2025-12-19 12:18:11,840 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-19T12:18:12.195744933Z [err]  2025-12-19 12:18:11,840 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (13419 bytes)
2025-12-19T12:18:12.195750224Z [err]  2025-12-19 12:18:11,840 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-19T12:18:12.195761433Z [err]  2025-12-19 12:18:11,840 - telnyx_service - INFO - ‚úÖ Generated 13419 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-19T12:18:12.199874934Z [err]  2025-12-19 12:18:11,902 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (7.2s ago), marking agent as done speaking
2025-12-19T12:18:12.199882605Z [err]  2025-12-19 12:18:11,903 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146691.9029891 for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:12.199887716Z [err]  2025-12-19 12:18:11,903 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:12.199892993Z [err]  2025-12-19 12:18:11,926 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-19T12:18:12.199910255Z [err]  2025-12-19 12:18:11,927 - server - INFO -    ‚úì Connection established (0.356s) [TARGET: <200ms]
2025-12-19T12:18:12.199915764Z [err]  2025-12-19 12:18:11,927 - server - INFO -    ‚úì Response status: 200
2025-12-19T12:18:12.199921627Z [err]  2025-12-19 12:18:11,927 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-19T12:18:12.199927159Z [err]  2025-12-19 12:18:11,936 - server - INFO -    ‚úì FIRST CHUNK received (0.366s, 923 bytes) [TARGET: <300ms]
2025-12-19T12:18:12.199933058Z [err]  2025-12-19 12:18:11,938 - server - INFO -    ‚úì ALL CHUNKS received: 37 chunks (0.368s)
2025-12-19T12:18:12.199939889Z [err]  2025-12-19 12:18:11,938 - server - INFO -    ‚úì Total audio size: 13837 bytes
2025-12-19T12:18:12.199944843Z [err]  2025-12-19 12:18:11,938 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-19T12:18:12.199951290Z [err]  2025-12-19 12:18:11,938 - server - INFO -       - Connection: 356ms
2025-12-19T12:18:12.199956818Z [err]  2025-12-19 12:18:11,938 - server - INFO -       - First chunk: 366ms
2025-12-19T12:18:12.199965460Z [err]  2025-12-19 12:18:11,938 - server - INFO -       - All chunks: 368ms
2025-12-19T12:18:12.199971425Z [err]  2025-12-19 12:18:11,938 - server - INFO -       - Audio generation only: 10ms
2025-12-19T12:18:12.203449934Z [err]  2025-12-19 12:18:11,938 - server - INFO - ‚è±Ô∏è [12:18:11.938] üîä TTS COMPLETE: 455ms, audio_size=13837 bytes
2025-12-19T12:18:12.203461973Z [err]  2025-12-19 12:18:11,938 - server - INFO - üíæ TTS CACHED: elevenlabs:Kendrick?... (13837 bytes)
2025-12-19T12:18:12.203469666Z [err]  2025-12-19 12:18:11,938 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.46s
2025-12-19T12:18:12.203475014Z [err]  2025-12-19 12:18:11,939 - telnyx_service - INFO - ‚úÖ Generated 13837 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-19T12:18:12.203479678Z [err]  2025-12-19 12:18:11,939 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-19T12:18:12.203491416Z [err]  2025-12-19 12:18:11,956 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:12.203496651Z [err]  2025-12-19 12:18:12,117 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-19T12:18:12.203502116Z [err]  2025-12-19 12:18:12,118 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.28s
2025-12-19T12:18:12.203507586Z [err]  2025-12-19 12:18:12,118 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 0.28s
2025-12-19T12:18:12.203514016Z [err]  2025-12-19 12:18:12,118 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-19T12:18:12.203518568Z [err]  2025-12-19 12:18:12,118 - telnyx_service - INFO - üé¨ Playback ID: 9RWZuP_BJA
2025-12-19T12:18:12.203526597Z [err]  2025-12-19 12:18:12,118 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-19T12:18:12.203531403Z [err]  2025-12-19 12:18:12,118 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146692.1189477 for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:12.208066839Z [err]  2025-12-19 12:18:12,118 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-19T12:18:12.208072131Z [err]  2025-12-19 12:18:12,198 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-19T12:18:12.208077028Z [err]  2025-12-19 12:18:12,199 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.26s
2025-12-19T12:18:12.208081276Z [err]  2025-12-19 12:18:12,199 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 0.72s
2025-12-19T12:18:12.208086015Z [err]  2025-12-19 12:18:12,199 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-19T12:18:12.208090971Z [err]  2025-12-19 12:18:12,199 - telnyx_service - INFO - üé¨ Playback ID: YEJU4lp-FQ
2025-12-19T12:18:12.208097730Z [err]  2025-12-19 12:18:12,199 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-19T12:18:12.208102523Z [err]  2025-12-19 12:18:12,199 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146692.1997714 for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:12.208106673Z [err]  2025-12-19 12:18:12,199 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-19T12:18:12.333189366Z [err]  2025-12-19 12:18:12,328 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:12.465680313Z [err]  2025-12-19 12:18:12,458 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:13.153978103Z [err]  2025-12-19 12:18:12,928 - calling_service - INFO - üë§ User started speaking for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:13.154007339Z [err]  2025-12-19 12:18:12,928 - server - INFO - üîç PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-19T12:18:13.154029022Z [err]  2025-12-19 12:18:12,958 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:13.154088508Z [err]  2025-12-19 12:18:12,551 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:18:13.154093339Z [err]  2025-12-19 12:18:12,551 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '5f0640bb-2ffa-45e4-b58e-78ea1893cd7d', 'occurred_at': '2025-12-19T12:18:12.289211Z', 'payload': {'call_control_id': 'v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA', 'call_leg_id': 'c5933f14-dcd4-11f0-816a-02420aef96a0', 'call_session_id': 'c5903864-dcd4-11f0-b86c-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': '9RWZuP_BJA'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:18:13.154099225Z [err]  2025-12-19 12:18:12,551 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:13.154104594Z [err]  2025-12-19 12:18:12,551 - server - INFO - üì® ================================================
2025-12-19T12:18:13.154113889Z [inf]  100.64.0.6:21936 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:18:13.154118784Z [err]  2025-12-19 12:18:12,829 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:13.154126705Z [err]  2025-12-19 12:18:12,927 - server - INFO - üî§ RAW TOKENS: ["H"?]
2025-12-19T12:18:13.154131588Z [err]  2025-12-19 12:18:12,928 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user started speaking) for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:13.154136193Z [err]  2025-12-19 12:18:12,928 - calling_service - INFO - üîä Silence timer reset for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA (user started speaking)
2025-12-19T12:18:13.215797893Z [err]  2025-12-19 12:18:13,209 - server - INFO - üî§ RAW TOKENS: ["H"‚úì, "ello"‚úì, "?"‚úì, "<end>"‚úì]
2025-12-19T12:18:13.215807405Z [err]  2025-12-19 12:18:13,209 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-19T12:18:13.215813083Z [err]  2025-12-19 12:18:13,210 - server - INFO - üßπ Cleaned transcript: 'H ello ?' -> 'Hello?'
2025-12-19T12:18:13.215818763Z [err]  2025-12-19 12:18:13,210 - server - INFO - üì• FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-19T12:18:13.215824116Z [err]  2025-12-19 12:18:13,210 - server - INFO - üé§ Soniox final transcript: 'Hello?'
2025-12-19T12:18:13.215829885Z [err]  2025-12-19 12:18:13,210 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:13.215835093Z [err]  2025-12-19 12:18:13,210 - server - INFO - üîç FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-19T12:18:13.215840120Z [err]  2025-12-19 12:18:13,210 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:13.215844812Z [err]  2025-12-19 12:18:13,210 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-19T12:18:13.215850414Z [err]  2025-12-19 12:18:13,210 - server - INFO - ‚è±Ô∏è [12:18:13.210] üìù FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-19T12:18:13.215855692Z [err]  2025-12-19 12:18:13,210 - server - INFO - ‚è±Ô∏è [12:18:13.210] STT endpoint detection latency: 29ms
2025-12-19T12:18:13.215861155Z [err]  2025-12-19 12:18:13,210 - server - INFO - ‚è±Ô∏è [12:18:13.210] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-19T12:18:13.215866488Z [err]  2025-12-19 12:18:13,211 - redis_service - INFO - üì¶ Stored call data in Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA (TTL: 3600s)
2025-12-19T12:18:13.218954557Z [err]  2025-12-19 12:18:13,211 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-19T12:18:13.218966202Z [err]  2025-12-19 12:18:13,211 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:13.218975155Z [err]  2025-12-19 12:18:13,211 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-19T12:18:13.227400927Z [err]  2025-12-19 12:18:13,223 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-19T12:18:13.227407302Z [err]  2025-12-19 12:18:13,223 - calling_service - INFO - üë§ User stopped speaking for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:13.227411994Z [err]  2025-12-19 12:18:13,223 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-19T12:18:13.227416624Z [err]  2025-12-19 12:18:13,223 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+2ms
2025-12-19T12:18:13.227421324Z [err]  2025-12-19 12:18:13,223 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 2ms (Soniox model: stt-rt-v3)
2025-12-19T12:18:13.227425921Z [err]  2025-12-19 12:18:13,224 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-19T12:18:13.227431173Z [err]  2025-12-19 12:18:13,224 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-19T12:18:13.227437074Z [err]  2025-12-19 12:18:13,224 - calling_service - INFO - ü§ñ Agent started speaking for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:13.319163802Z [err]  2025-12-19 12:18:13,313 - calling_service - INFO - ‚è±Ô∏è [12:18:13.313] üîÄ About to call _follow_transition() for: Hello?...
2025-12-19T12:18:13.319173754Z [err]  2025-12-19 12:18:13,313 - calling_service - INFO - Evaluating transitions from Greeting for message: Hello?
2025-12-19T12:18:13.319197957Z [err]  2025-12-19 12:18:13,312 - server - INFO - üìù Saved user transcript to database
2025-12-19T12:18:13.319204727Z [err]  2025-12-19 12:18:13,313 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:13.319211538Z [err]  2025-12-19 12:18:13,313 - calling_service - INFO - ‚è±Ô∏è [12:18:13.313] üì• process_user_input() ENTRY - text: 'Hello?...'
2025-12-19T12:18:13.319217906Z [err]  2025-12-19 12:18:13,313 - calling_service - INFO - ‚è±Ô∏è [12:18:13.313] ‚è© About to call _process_call_flow_streaming()
2025-12-19T12:18:13.319224713Z [err]  2025-12-19 12:18:13,313 - calling_service - INFO - ‚è±Ô∏è [12:18:13.313] üîÄ Agent type: call_flow, calling flow processor...
2025-12-19T12:18:13.319230727Z [err]  2025-12-19 12:18:13,313 - calling_service - INFO - ‚è±Ô∏è [12:18:13.313] üîÄ _process_call_flow_streaming() ENTRY
2025-12-19T12:18:13.319236491Z [err]  2025-12-19 12:18:13,313 - calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-19T12:18:13.319243203Z [err]  2025-12-19 12:18:13,313 - calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-19T12:18:13.337010424Z [err]  2025-12-19 12:18:13,329 - calling_service - INFO - ‚è±Ô∏è [12:18:13.329] üîÄ TRANSITION EVALUATION START - Calling LLM for 4 options
2025-12-19T12:18:13.337022749Z [err]  2025-12-19 12:18:13,334 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:13.337029864Z [err]  2025-12-19 12:18:13,335 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:13.464265931Z [err]  2025-12-19 12:18:13,460 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:14.074077861Z [err]  2025-12-19 12:18:13,514 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:18:14.074083693Z [err]  2025-12-19 12:18:13,514 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '6212112e-adcd-44bf-b9bd-0733ebb36959', 'occurred_at': '2025-12-19T12:18:13.129213Z', 'payload': {'call_control_id': 'v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA', 'call_leg_id': 'c5933f14-dcd4-11f0-816a-02420aef96a0', 'call_session_id': 'c5903864-dcd4-11f0-b86c-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': '9RWZuP_BJA', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:18:14.074089961Z [err]  2025-12-19 12:18:13,514 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:14.074095319Z [err]  2025-12-19 12:18:13,514 - server - INFO - üì® ================================================
2025-12-19T12:18:14.074101230Z [err]  2025-12-19 12:18:13,516 - redis_service - INFO - ‚ûñ Removed playback 9RWZuP_BJA, 0 remaining for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:14.074106974Z [err]  2025-12-19 12:18:13,516 - server - INFO - üîä Redis: Removed playback 9RWZuP_BJA, 0 remaining
2025-12-19T12:18:14.074112903Z [err]  2025-12-19 12:18:13,516 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-19T12:18:14.074135554Z [err]  2025-12-19 12:18:13,516 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-19T12:18:14.074141426Z [err]  2025-12-19 12:18:13,517 - server - INFO - ‚úÖ Found session in active_telnyx_calls (local worker)
2025-12-19T12:18:14.074465459Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - ‚ö†Ô∏è No transition matched, but node has GOAL. Staying on current node to continue with goal-based guidance.
2025-12-19T12:18:14.074469953Z [err]  2025-12-19 12:18:13,517 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146693.5170946 for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:14.074474045Z [inf]  100.64.0.11:62122 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:18:14.074476004Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - üéØ Goal: Say the customer's name...
2025-12-19T12:18:14.074478028Z [err]  2025-12-19 12:18:13,517 - server - INFO - ‚è±Ô∏è Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-19T12:18:14.074499458Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 452ms
2025-12-19T12:18:14.074506124Z [err]  2025-12-19 12:18:13,764 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-19T12:18:14.074507905Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - ‚è±Ô∏è [12:18:13.766] ‚úÖ Node selected, about to process content...
2025-12-19T12:18:14.074515640Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - ‚è±Ô∏è [12:18:13.766] üîÄ TRANSITION EVALUATION COMPLETE - took 436ms
2025-12-19T12:18:14.074521933Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - ü§ñ AI transition decision: '-1'
2025-12-19T12:18:14.074529021Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - üìä Available transitions: ['Confirms name (Yes|Speaking|This is he/she|etc)...', 'Wrong number (No John here|Wrong number|etc) - don...', "The customer says let's set an appointment....", "Let's talk about my inances..."]
2025-12-19T12:18:14.074535909Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - Selected transition index: -1
2025-12-19T12:18:14.074542118Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - No specific condition matched, looking for default transition...
2025-12-19T12:18:14.077743423Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-19T12:18:14.077749281Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-19T12:18:14.077753966Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-19T12:18:14.077760848Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-19T12:18:14.077766357Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - üîß Replaced {{now}} with Friday, December 19, 2025 at 7:18 AM EST in content
2025-12-19T12:18:14.077767110Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-19T12:18:14.077774216Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-19T12:18:14.077774887Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-19T12:18:14.077781557Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-19T12:18:14.077782764Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-19T12:18:14.077789636Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-19T12:18:14.077794961Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-19T12:18:14.077796333Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-19T12:18:14.077801661Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - ‚è±Ô∏è [12:18:13.766] üìÑ About to process content (mode=script, length=9)
2025-12-19T12:18:14.079574176Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - ‚è≠Ô∏è Staying on same script node without dynamic_rephrase - NOT re-speaking content
2025-12-19T12:18:14.079580946Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - üîä Silence tracking reset for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA (user responded)
2025-12-19T12:18:14.079589540Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-19T12:18:14.079595533Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-19T12:18:14.079602157Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - LLM response (0.45s): 
2025-12-19T12:18:14.079608879Z [err]  2025-12-19 12:18:13,766 - calling_service - INFO - Total latency: 0.45s
2025-12-19T12:18:14.079616997Z [err]  2025-12-19 12:18:13,766 - server - INFO - ‚úÖ LLM finished in 542ms, TTS tasks already running in background
2025-12-19T12:18:14.079622965Z [err]  2025-12-19 12:18:13,766 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-19T12:18:14.079628977Z [err]  2025-12-19 12:18:13,766 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-19T12:18:14.079635228Z [err]  2025-12-19 12:18:13,766 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-19T12:18:14.079641313Z [err]  2025-12-19 12:18:13,766 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 2ms (provider: soniox, model: stt-rt-v3)
2025-12-19T12:18:14.079647191Z [err]  2025-12-19 12:18:13,766 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 542ms (provider: grok, model: grok-4-fast-non-reasoning)
2025-12-19T12:18:14.079652748Z [err]  2025-12-19 12:18:13,767 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 0ms (provider: elevenlabs, websocket: False)
2025-12-19T12:18:14.081031317Z [err]  2025-12-19 12:18:13,767 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 543ms (user stopped ‚Üí play_audio_url called)
2025-12-19T12:18:14.081044794Z [err]  2025-12-19 12:18:13,767 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-19T12:18:14.081051705Z [err]  2025-12-19 12:18:13,767 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-19T12:18:14.081058234Z [err]  2025-12-19 12:18:13,767 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-19T12:18:14.081064626Z [err]  2025-12-19 12:18:13,767 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-19T12:18:14.081070948Z [err]  2025-12-19 12:18:13,767 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-19T12:18:14.081077337Z [err]  2025-12-19 12:18:13,767 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 843ms estimated
2025-12-19T12:18:14.081083489Z [err]  2025-12-19 12:18:13,767 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 0 chars, 0 sentences
2025-12-19T12:18:14.081090040Z [err]  2025-12-19 12:18:13,767 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Hello?...'
2025-12-19T12:18:14.081096348Z [err]  2025-12-19 12:18:13,767 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: '...'
2025-12-19T12:18:14.081102129Z [err]  2025-12-19 12:18:13,767 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-19T12:18:14.081108153Z [err]  2025-12-19 12:18:13,767 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-19T12:18:14.081114081Z [err]  2025-12-19 12:18:13,788 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:18:14.081120206Z [err]  2025-12-19 12:18:13,788 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': 'fc7531a0-8ce2-43e8-baba-f0d8b91e60cc', 'occurred_at': '2025-12-19T12:18:13.549210Z', 'payload': {'call_control_id': 'v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA', 'call_leg_id': 'c5933f14-dcd4-11f0-816a-02420aef96a0', 'call_session_id': 'c5903864-dcd4-11f0-b86c-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'YEJU4lp-FQ'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:18:14.084742722Z [err]  2025-12-19 12:18:13,788 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:14.084752282Z [err]  2025-12-19 12:18:13,788 - server - INFO - üì® ================================================
2025-12-19T12:18:14.084758834Z [inf]  100.64.0.11:62122 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:18:14.084765601Z [err]  2025-12-19 12:18:13,835 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-19T12:18:14.084775879Z [err]  2025-12-19 12:18:13,836 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146693.8360724 for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:14.084788088Z [err]  2025-12-19 12:18:13,836 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:14.084794574Z [err]  2025-12-19 12:18:13,836 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:14.084801273Z [err]  2025-12-19 12:18:13,944 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 544ms)
2025-12-19T12:18:14.084806580Z [err]  2025-12-19 12:18:13,944 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-19T12:18:14.084815590Z [err]  2025-12-19 12:18:13,944 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-19T12:18:14.084822216Z [err]  2025-12-19 12:18:13,962 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:14.084828095Z [err]  2025-12-19 12:18:14,017 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:18:14.087323027Z [err]  2025-12-19 12:18:14,017 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': '65f29dfa-e7e4-4f5b-9b95-ec36882a7a11', 'occurred_at': '2025-12-19T12:18:13.629211Z', 'payload': {'call_control_id': 'v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA', 'call_leg_id': 'c5933f14-dcd4-11f0-816a-02420aef96a0', 'call_session_id': 'c5903864-dcd4-11f0-b86c-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:18:14.087332164Z [err]  2025-12-19 12:18:14,017 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:14.087341063Z [err]  2025-12-19 12:18:14,017 - server - INFO - üì® ================================================
2025-12-19T12:18:14.087347454Z [inf]  100.64.0.11:62122 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:18:14.339869046Z [err]  2025-12-19 12:18:14,338 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:14.467840055Z [err]  2025-12-19 12:18:14,464 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:15.046547229Z [err]  2025-12-19 12:18:14,651 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:18:15.046553237Z [err]  2025-12-19 12:18:14,651 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '056c2634-5498-4fc1-be46-5b146354bf8c', 'occurred_at': '2025-12-19T12:18:14.389210Z', 'payload': {'call_control_id': 'v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA', 'call_leg_id': 'c5933f14-dcd4-11f0-816a-02420aef96a0', 'call_session_id': 'c5903864-dcd4-11f0-b86c-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'YEJU4lp-FQ', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 2, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:18:15.046560065Z [err]  2025-12-19 12:18:14,651 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:15.046565892Z [err]  2025-12-19 12:18:14,651 - server - INFO - üì® ================================================
2025-12-19T12:18:15.046571472Z [err]  2025-12-19 12:18:14,655 - redis_service - INFO - ‚ûñ Removed playback YEJU4lp-FQ, 0 remaining for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:15.046577254Z [err]  2025-12-19 12:18:14,655 - server - INFO - üîä Redis: Removed playback YEJU4lp-FQ, 0 remaining
2025-12-19T12:18:15.046613796Z [err]  2025-12-19 12:18:14,655 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-19T12:18:15.046619644Z [err]  2025-12-19 12:18:14,656 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-19T12:18:15.046625607Z [err]  2025-12-19 12:18:14,656 - server - INFO - ‚úÖ Found session in active_telnyx_calls (local worker)
2025-12-19T12:18:15.049779730Z [err]  2025-12-19 12:18:14,656 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146694.6567152 for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:15.049784607Z [err]  2025-12-19 12:18:14,656 - server - INFO - ‚è±Ô∏è Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-19T12:18:15.049789313Z [inf]  100.64.0.11:62122 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:18:15.049794494Z [err]  2025-12-19 12:18:14,839 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:15.049799357Z [err]  2025-12-19 12:18:14,967 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:15.334126946Z [err]  2025-12-19 12:18:15,331 - server - INFO - üì§ Audio flowing: 323 packets sent to Soniox (5s update)
2025-12-19T12:18:15.345017983Z [err]  2025-12-19 12:18:15,340 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:15.471891173Z [err]  2025-12-19 12:18:15,469 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:16.071818308Z [err]  2025-12-19 12:18:15,692 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 333 total packets
2025-12-19T12:18:16.071823148Z [err]  [2025-12-19 12:18:15 +0000] [3] [INFO] connection closed
2025-12-19T12:18:16.071832316Z [err]  2025-12-19 12:18:15,695 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 0 total packets
2025-12-19T12:18:16.071838426Z [err]  [2025-12-19 12:18:15 +0000] [4] [INFO] connection closed
2025-12-19T12:18:16.071844136Z [err]  2025-12-19 12:18:15,697 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:18:16.071849181Z [err]  2025-12-19 12:18:15,697 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': '33be54b6-0611-44f2-bd5a-be1d0e40e4dc', 'occurred_at': '2025-12-19T12:18:15.409211Z', 'payload': {'call_control_id': 'v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA', 'call_leg_id': 'c5933f14-dcd4-11f0-816a-02420aef96a0', 'call_quality_stats': {'inbound': {'jitter_max_variance': '98.22', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '355', 'skip_packet_count': '22'}, 'outbound': {'packet_count': '333', 'skip_packet_count': '0'}}, 'call_session_id': 'c5903864-dcd4-11f0-b86c-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-19T12:18:15.409211Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-19T12:18:05.689212Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:18:16.071855108Z [err]  2025-12-19 12:18:15,697 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:16.071861522Z [err]  2025-12-19 12:18:15,697 - server - INFO - üì® ================================================
2025-12-19T12:18:16.071867976Z [err]  2025-12-19 12:18:15,697 - server - INFO - üìû Call ended: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:16.076262100Z [err]  2025-12-19 12:18:15,697 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-19T12:18:16.076346646Z [err]  2025-12-19 12:18:15,737 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:18:16.076354068Z [err]  2025-12-19 12:18:15,737 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': '532d630b-70a9-424d-88cd-9e9187aaa72a', 'occurred_at': '2025-12-19T12:18:15.587207Z', 'payload': {'call_control_id': 'v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA', 'call_leg_id': 'c5933f14-dcd4-11f0-816a-02420aef96a0', 'call_session_id': 'c5903864-dcd4-11f0-b86c-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '7a630811-e1ef-49ff-b9db-bb6ba228532b', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 2, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:18:16.076359961Z [err]  2025-12-19 12:18:15,737 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:16.076365683Z [err]  2025-12-19 12:18:15,737 - server - INFO - üì® ================================================
2025-12-19T12:18:16.076371878Z [inf]  100.64.0.8:46680 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:18:16.076377162Z [err]  2025-12-19 12:18:15,741 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:18:16.076383557Z [err]  2025-12-19 12:18:15,741 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'b7cdd99e-4fd8-42cd-85db-8814c950738d', 'occurred_at': '2025-12-19T12:18:15.429208Z', 'payload': {'call_control_id': 'v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA', 'call_leg_id': 'c5933f14-dcd4-11f0-816a-02420aef96a0', 'call_session_id': 'c5903864-dcd4-11f0-b86c-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-19T12:18:15.429208Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'ldTlvnTpzQ', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:18:16.077131582Z [err]  2025-12-19 12:18:15,741 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:16.077138303Z [err]  2025-12-19 12:18:15,741 - server - INFO - üì® ================================================
2025-12-19T12:18:16.077145352Z [err]  2025-12-19 12:18:15,743 - redis_service - INFO - ‚ûñ Removed playback ldTlvnTpzQ, 0 remaining for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:16.077151882Z [err]  2025-12-19 12:18:15,743 - server - INFO - üîä Redis: Removed playback ldTlvnTpzQ, 0 remaining
2025-12-19T12:18:16.077161663Z [err]  2025-12-19 12:18:15,743 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-19T12:18:16.077167818Z [err]  2025-12-19 12:18:15,744 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-19T12:18:16.077173309Z [err]  2025-12-19 12:18:15,744 - server - INFO - ‚úÖ Found session in active_telnyx_calls (local worker)
2025-12-19T12:18:16.077179151Z [err]  2025-12-19 12:18:15,744 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146695.7441256 for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:16.077188399Z [err]  2025-12-19 12:18:15,744 - server - INFO - ‚è±Ô∏è Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-19T12:18:16.077194140Z [inf]  100.64.0.11:62122 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:18:16.077203544Z [err]  2025-12-19 12:18:15,842 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:16.077209695Z [err]  2025-12-19 12:18:15,876 - server - INFO - üìù Updated call log: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:16.077215390Z [err]  2025-12-19 12:18:15,967 - server - INFO - ‚úÖ Finalized call log: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA (duration=7s, status=completed)
2025-12-19T12:18:16.078917819Z [err]  2025-12-19 12:18:15,970 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:16.078932834Z [err]  2025-12-19 12:18:15,971 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-19T12:18:16.078942030Z [err]  2025-12-19 12:18:15,974 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-19T12:18:16.078952599Z [err]  2025-12-19 12:18:15,975 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:16.345953032Z [err]  2025-12-19 12:18:16,342 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:16.472475571Z [err]  2025-12-19 12:18:16,471 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:17.107196809Z [err]  2025-12-19 12:18:16,840 - server - INFO - üéôÔ∏è Recording saved for call: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:17.107204082Z [err]  2025-12-19 12:18:16,844 - redis_service - INFO - üì• Retrieved call data from Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:17.107211109Z [err]  2025-12-19 12:18:16,844 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=3cdb5c30-6de2-4241-8862-2d634ef96332, call_data=True
2025-12-19T12:18:17.107251261Z [err]  2025-12-19 12:18:16,852 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-19T12:18:17.107261703Z [err]  2025-12-19 12:18:16,852 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-19T12:18:17.107262552Z [err]  2025-12-19 12:18:16,670 - server - INFO - üìä Auto-added call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-19T12:18:17.107266251Z [err]  2025-12-19 12:18:16,844 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:17.107271580Z [err]  2025-12-19 12:18:16,840 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-19T12:18:17.107274824Z [err]  2025-12-19 12:18:16,934 - server - INFO - üíæ Saved recording URL and ID to database: 3cdb5c30-6de2-4241-8862-2d634ef96332
2025-12-19T12:18:17.107279908Z [err]  2025-12-19 12:18:16,851 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-19T12:18:17.107282106Z [err]  2025-12-19 12:18:16,934 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-19T12:18:17.107284255Z [err]  2025-12-19 12:18:16,840 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '4fe7d572-ef8e-401e-9da5-bb6f82fc9644', 'occurred_at': '2025-12-19T12:18:16.476328Z', 'payload': {'call_control_id': 'v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA', 'call_leg_id': 'c5933f14-dcd4-11f0-816a-02420aef96a0', 'call_session_id': 'c5903864-dcd4-11f0-b86c-02420aef96a0', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-19T12:18:15.498425Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-19T12:18:15.498425Z', 'recording_id': '3cdb5c30-6de2-4241-8862-2d634ef96332', 'recording_started_at': '2025-12-19T12:18:10.233537Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-19/c5933f14-dcd4-11f0-816a-02420aef96a0-1766146689330406.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251219%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251219T121816Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=ea9e5a893de2304dd8244ac407b2450bb08ea3ec2b824b84854b32f91b20c9ec'}, 'start_time': '2025-12-19T12:18:10.233537Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-19T12:18:17.107292085Z [err]  2025-12-19 12:18:16,851 - redis_service - INFO - üì• Retrieved call data from Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:17.107296803Z [err]  2025-12-19 12:18:16,840 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:17.107298551Z [err]  2025-12-19 12:18:16,934 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-19T12:18:17.107303569Z [err]  2025-12-19 12:18:16,840 - server - INFO - üì® ================================================
2025-12-19T12:18:17.107309509Z [err]  2025-12-19 12:18:16,941 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-19T12:18:17.107867946Z [err]  2025-12-19 12:18:16,973 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:17.107874904Z [err]  2025-12-19 12:18:17,028 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=6944df147eadbccc46887cdf, to_number=+17708336397
2025-12-19T12:18:17.107898076Z [err]  2025-12-19 12:18:17,028 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=6944df147eadbccc46887cdf, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3-antigrav
2025-12-19T12:18:17.107905925Z [err]  2025-12-19 12:18:17,028 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-19T12:18:17.107913130Z [err]  2025-12-19 12:18:17,028 - server - INFO - üöÄ Triggered QC analysis for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:17.107920438Z [err]  2025-12-19 12:18:17,028 - server - INFO - üìä Triggered Campaign QC for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:17.107928729Z [err]  2025-12-19 12:18:17,028 - server - INFO - üìá Triggered CRM update for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:17.107935872Z [err]  2025-12-19 12:18:17,029 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:17.107942327Z [err]  2025-12-19 12:18:17,029 - redis_service - INFO - üßπ Deleted call data from Redis: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:17.107949530Z [err]  2025-12-19 12:18:17,029 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:17.110995451Z [inf]  100.64.0.6:21936 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:18:17.111203643Z [err]  2025-12-19 12:18:17,030 - server - INFO - üîç Starting QC analysis for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:17.111216090Z [err]  2025-12-19 12:18:17,030 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=6944df147eadbccc46887cdf
2025-12-19T12:18:17.111225264Z [err]  2025-12-19 12:18:17,030 - server - INFO - üìá CRM update starting for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:18:17.111233039Z [err]  2025-12-19 12:18:17,030 - server - INFO - üìá Normalized phone: +17708336397
2025-12-19T12:18:17.123191903Z [err]  2025-12-19 12:18:17,118 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=4, logs_count=4, status=completed
2025-12-19T12:18:17.123203798Z [err]  2025-12-19 12:18:17,119 - server - INFO - üìù Converted transcript from 4 messages to 66 characters
2025-12-19T12:18:17.219384783Z [err]  2025-12-19 12:18:17,216 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-19T12:18:17.223406029Z [err]  2025-12-19 12:18:17,220 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3-antigrav, has_auto_qc_settings=True
2025-12-19T12:18:17.258780912Z [err]  2025-12-19 12:18:17,246 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-19T12:18:17.258788488Z [err]  2025-12-19 12:18:17,247 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-19T12:18:17.305898672Z [err]  2025-12-19 12:18:17,302 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-19T12:18:17.316267561Z [err]  2025-12-19 12:18:17,308 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-19T12:18:17.316280971Z [err]  2025-12-19 12:18:17,308 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-19T12:18:17.316290465Z [err]  2025-12-19 12:18:17,308 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-19T12:18:17.316297679Z [err]  2025-12-19 12:18:17,309 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-19T12:18:17.316303432Z [err]    File "/app/backend/server.py", line 9698, in trigger_campaign_qc_for_call
2025-12-19T12:18:17.316312008Z [err]      await run_full_qc_analysis(
2025-12-19T12:18:17.316318485Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-19T12:18:17.316324400Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-19T12:18:17.316331630Z [err]  
2025-12-19T12:18:17.333280899Z [err]  2025-12-19 12:18:17,329 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-19/c5933f14-dcd4-11f0-816a-02420aef96a0-1766146689330406.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251219%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251219T121816Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=ea9e5a893de2304dd8244ac407b2450bb08ea3ec2b824b84854b32f91b20c9ec "HTTP/1.1 200 OK"
2025-12-19T12:18:17.333295026Z [err]  2025-12-19 12:18:17,330 - server - INFO - ‚úÖ Downloaded 21149 bytes
2025-12-19T12:18:17.355167349Z [err]  2025-12-19 12:18:17,346 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:17.396914296Z [err]  2025-12-19 12:18:17,389 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-19T12:18:17.396921606Z [err]  2025-12-19 12:18:17,389 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:18:17.396928567Z [err]  2025-12-19 12:18:17,389 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:18.102265829Z [err]  2025-12-19 12:18:17,515 - server - INFO - ‚úÖ Split into 2 channels
2025-12-19T12:18:18.102272089Z [err]  2025-12-19 12:18:17,515 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-19T12:18:18.102277586Z [err]  2025-12-19 12:18:17,516 - server - INFO - üìä Channel 0: 112684 bytes
2025-12-19T12:18:18.102283597Z [err]  2025-12-19 12:18:17,516 - server - ERROR - ‚ùå No Soniox API key available
2025-12-19T12:18:18.102288448Z [err]  2025-12-19 12:18:17,516 - server - INFO - ‚ùå Channel 0: No speech
2025-12-19T12:18:18.102294946Z [err]  2025-12-19 12:18:17,516 - server - INFO - üìä Channel 1: 112684 bytes
2025-12-19T12:18:18.102306755Z [err]  2025-12-19 12:18:17,516 - server - ERROR - ‚ùå No Soniox API key available
2025-12-19T12:18:18.102312192Z [err]  2025-12-19 12:18:17,516 - server - INFO - ‚ùå Channel 1: No speech
2025-12-19T12:18:18.102320933Z [err]  2025-12-19 12:18:17,516 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-19T12:18:18.102329703Z [inf]  100.64.0.8:46680 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-19T12:18:18.102335848Z [err]  2025-12-19 12:18:17,517 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:18.102340913Z [err]  2025-12-19 12:18:17,575 - server - INFO - üìá CRM: Total variables collected: []
2025-12-19T12:18:18.102346532Z [err]  2025-12-19 12:18:17,748 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name']
2025-12-19T12:18:18.102352723Z [err]  2025-12-19 12:18:17,846 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:18.102358485Z [err]  2025-12-19 12:18:18,018 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:18.355872880Z [err]  2025-12-19 12:18:18,348 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:19.047970645Z [err]  2025-12-19 12:18:19,021 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:19.048103955Z [err]  2025-12-19 12:18:18,520 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:19.048110428Z [err]  2025-12-19 12:18:18,849 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:19.048116281Z [err]  2025-12-19 12:18:18,922 - calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-19T12:18:19.048122994Z [err]  2025-12-19 12:18:18,923 - calling_service - INFO - üí¨ Sending FINAL check-in #2/2: Are you still there?
2025-12-19T12:18:19.048128976Z [err]  2025-12-19 12:18:18,923 - calling_service - INFO - ‚ö†Ô∏è Will end call if no response after next silence timeout
2025-12-19T12:18:19.048133826Z [err]  2025-12-19 12:18:18,923 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-19T12:18:19.048139990Z [err]  2025-12-19 12:18:18,923 - calling_service - INFO - ü§ñ Agent started speaking for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:19.048145323Z [err]  2025-12-19 12:18:18,923 - telnyx_service - INFO - üîä Speaking text on call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw: Are you still there?...
2025-12-19T12:18:19.048150504Z [err]  2025-12-19 12:18:18,923 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-19T12:18:19.048156219Z [err]  2025-12-19 12:18:18,923 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-19T12:18:19.048161886Z [err]  2025-12-19 12:18:18,923 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-19T12:18:19.048171566Z [err]  2025-12-19 12:18:18,923 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-19T12:18:19.048177725Z [err]  2025-12-19 12:18:18,923 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-19T12:18:19.048621289Z [err]  2025-12-19 12:18:18,923 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-19T12:18:19.048631072Z [err]  2025-12-19 12:18:18,923 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:18:19.048637350Z [err]  2025-12-19 12:18:18,923 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:18:19.195279482Z [err]  2025-12-19 12:18:19,189 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:18:19.195291412Z [err]  2025-12-19 12:18:19,190 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.27s
2025-12-19T12:18:19.195297751Z [err]  2025-12-19 12:18:19,190 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-19T12:18:19.195303929Z [err]    "errors": [
2025-12-19T12:18:19.195310402Z [err]      {
2025-12-19T12:18:19.195315621Z [err]        "code": "90018",
2025-12-19T12:18:19.195325317Z [err]        "title": "Call has already ended",
2025-12-19T12:18:19.195347934Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-19T12:18:19.195355145Z [err]      }
2025-12-19T12:18:19.195361444Z [err]    ]
2025-12-19T12:18:19.195367427Z [err]  }
2025-12-19T12:18:19.195374001Z [err]  2025-12-19 12:18:19,190 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-19T12:18:19.354802364Z [err]  2025-12-19 12:18:19,350 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:19.383986736Z [err]  2025-12-19 12:18:19,380 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:18:19.388822698Z [err]  2025-12-19 12:18:19,382 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-19T12:18:19.388832811Z [err]  2025-12-19 12:18:19,382 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-19T12:18:20.088875764Z [err]  2025-12-19 12:18:19,523 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.3s silence: Are you still there?
2025-12-19T12:18:20.088887697Z [err]  2025-12-19 12:18:19,523 - calling_service - INFO - ü§ñ Agent started speaking for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:20.088902307Z [err]  2025-12-19 12:18:19,523 - telnyx_service - INFO - üîä Speaking text on call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA: Are you still there?...
2025-12-19T12:18:20.088910179Z [err]  2025-12-19 12:18:19,523 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-19T12:18:20.088926076Z [err]  2025-12-19 12:18:19,523 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-19T12:18:20.088936056Z [err]  2025-12-19 12:18:19,523 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-19T12:18:20.088947564Z [err]  2025-12-19 12:18:19,523 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-19T12:18:20.088954244Z [err]  2025-12-19 12:18:19,523 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-19T12:18:20.088960518Z [err]  2025-12-19 12:18:19,523 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-19T12:18:20.088967370Z [err]  2025-12-19 12:18:19,523 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:18:20.088979469Z [err]  2025-12-19 12:18:19,523 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:18:20.089124117Z [err]  2025-12-19 12:18:19,522 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:20.089129558Z [err]  2025-12-19 12:18:19,522 - calling_service - INFO - ‚è∞ Check-in triggered after 7.3s silence (threshold: 7s)
2025-12-19T12:18:20.089136466Z [err]  2025-12-19 12:18:19,523 - calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-19T12:18:20.093231296Z [err]  2025-12-19 12:18:19,723 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:18:20.093236970Z [err]  2025-12-19 12:18:19,723 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.20s
2025-12-19T12:18:20.093243816Z [err]  2025-12-19 12:18:19,724 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-19T12:18:20.093250589Z [err]    "errors": [
2025-12-19T12:18:20.093256236Z [err]      {
2025-12-19T12:18:20.093261900Z [err]        "code": "90018",
2025-12-19T12:18:20.093267291Z [err]        "title": "Call has already ended",
2025-12-19T12:18:20.093272586Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-19T12:18:20.093278922Z [err]      }
2025-12-19T12:18:20.093285206Z [err]    ]
2025-12-19T12:18:20.093291105Z [err]  }
2025-12-19T12:18:20.093296861Z [err]  2025-12-19 12:18:19,724 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-19T12:18:20.093302408Z [err]  2025-12-19 12:18:19,852 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:20.093308085Z [err]  2025-12-19 12:18:19,910 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:18:20.093314341Z [err]  2025-12-19 12:18:19,910 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-19T12:18:20.093320780Z [err]  2025-12-19 12:18:19,910 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-19T12:18:20.093515382Z [err]  2025-12-19 12:18:19,914 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-19T12:18:20.093522509Z [err]  2025-12-19 12:18:19,916 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-19T12:18:20.093529501Z [err]  2025-12-19 12:18:19,918 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:20.355261864Z [err]  2025-12-19 12:18:20,352 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:20.355269817Z [err]  2025-12-19 12:18:20,352 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=6.5s, checkin_count=0/2
2025-12-19T12:18:20.390112670Z [err]  2025-12-19 12:18:20,386 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=2/2
2025-12-19T12:18:20.414100338Z [err]  2025-12-19 12:18:20,411 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-19T12:18:20.414112876Z [err]  2025-12-19 12:18:20,412 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766146700.4120793 for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:20.414122463Z [err]  2025-12-19 12:18:20,412 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:20.414130446Z [err]  2025-12-19 12:18:20,412 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:20.414138224Z [err]  2025-12-19 12:18:20,413 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=1/2
2025-12-19T12:18:20.450417838Z [err]  2025-12-19 12:18:20,447 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-19T12:18:20.450461514Z [err]  2025-12-19 12:18:20,448 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-19T12:18:20.450469949Z [err]  2025-12-19 12:18:20,448 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:21.029165517Z [err]  2025-12-19 12:18:20,855 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:18:21.029180179Z [err]  2025-12-19 12:18:20,855 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:18:21.029188433Z [err]  2025-12-19 12:18:20,887 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=2/2
2025-12-19T12:18:21.029194209Z [err]  2025-12-19 12:18:20,914 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:21.029200162Z [err]  2025-12-19 12:18:20,914 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.5s, checkin_count=1/2
2025-12-19T12:18:21.029494688Z [err]  2025-12-19 12:18:20,853 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:21.029500892Z [err]  2025-12-19 12:18:20,853 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=7.0s, checkin_count=0/2
2025-12-19T12:18:21.029506611Z [err]  2025-12-19 12:18:20,854 - calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-19T12:18:21.029511827Z [err]  2025-12-19 12:18:20,854 - calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-19T12:18:21.029516847Z [err]  2025-12-19 12:18:20,854 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-19T12:18:21.029535946Z [err]  2025-12-19 12:18:20,854 - calling_service - INFO - ü§ñ Agent started speaking for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:21.029544160Z [err]  2025-12-19 12:18:20,854 - telnyx_service - INFO - üîä Speaking text on call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA: Are you still there?...
2025-12-19T12:18:21.029557503Z [err]  2025-12-19 12:18:20,854 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-19T12:18:21.029566124Z [err]  2025-12-19 12:18:20,854 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-19T12:18:21.029575257Z [err]  2025-12-19 12:18:20,854 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-19T12:18:21.029580936Z [err]  2025-12-19 12:18:20,854 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-19T12:18:21.029586282Z [err]  2025-12-19 12:18:20,855 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-19T12:18:21.029591519Z [err]  2025-12-19 12:18:20,855 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-19T12:18:21.121559631Z [err]  2025-12-19 12:18:21,115 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:18:21.121568265Z [err]  2025-12-19 12:18:21,116 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.26s
2025-12-19T12:18:21.121585522Z [err]  2025-12-19 12:18:21,116 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-19T12:18:21.121593048Z [err]    "errors": [
2025-12-19T12:18:21.121600885Z [err]      {
2025-12-19T12:18:21.121606474Z [err]      }
2025-12-19T12:18:21.121609855Z [err]        "code": "90018",
2025-12-19T12:18:21.121617927Z [err]        "title": "Call has already ended",
2025-12-19T12:18:21.121624821Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-19T12:18:21.121631590Z [err]    ]
2025-12-19T12:18:21.121644535Z [err]  }
2025-12-19T12:18:21.121653363Z [err]  2025-12-19 12:18:21,118 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-19T12:18:21.372634779Z [err]  2025-12-19 12:18:21,370 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:18:21.372655767Z [err]  2025-12-19 12:18:21,370 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-19T12:18:21.375823776Z [err]  2025-12-19 12:18:21,371 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-19T12:18:21.425012431Z [err]  2025-12-19 12:18:21,416 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:22.045907922Z [err]  2025-12-19 12:18:21,872 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:22.045926401Z [err]  2025-12-19 12:18:21,916 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:22.046002476Z [err]  2025-12-19 12:18:21,872 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:22.375593050Z [err]  2025-12-19 12:18:22,374 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:22.375600035Z [err]  2025-12-19 12:18:22,374 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:22.420595289Z [err]  2025-12-19 12:18:22,418 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:23.012402593Z [err]  2025-12-19 12:18:22,844 - server - INFO - üé§ Soniox receiver alive - 15 messages received in last 10s
2025-12-19T12:18:23.012407293Z [err]  2025-12-19 12:18:22,844 - server - ERROR - ‚ùå Soniox error: {'tokens': [], 'final_audio_proc_ms': 6960, 'total_audio_proc_ms': 9240, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-19T12:18:23.012411951Z [err]  2025-12-19 12:18:22,844 - server - INFO - ‚úÖ Soniox receive loop ended normally
2025-12-19T12:18:23.012415838Z [err]  2025-12-19 12:18:22,844 - dead_air_monitor - INFO - üîá Dead air monitoring cancelled for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:23.012422014Z [err]  2025-12-19 12:18:22,844 - dead_air_monitor - INFO - üîá Dead air monitoring stopped for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:23.012425877Z [err]  2025-12-19 12:18:22,844 - server - INFO - üîá Dead air monitoring task cancelled
2025-12-19T12:18:23.012429569Z [err]  2025-12-19 12:18:22,876 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:23.012434624Z [err]  2025-12-19 12:18:22,876 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:23.012438888Z [err]  2025-12-19 12:18:22,918 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:23.381135040Z [err]  2025-12-19 12:18:23,378 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:23.381140823Z [err]  2025-12-19 12:18:23,378 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:23.422461196Z [err]  2025-12-19 12:18:23,419 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:24.070071720Z [err]  2025-12-19 12:18:23,879 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:24.070077888Z [err]  2025-12-19 12:18:23,879 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:24.070083290Z [err]  2025-12-19 12:18:23,921 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:24.383988675Z [err]  2025-12-19 12:18:24,380 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:24.384001206Z [err]  2025-12-19 12:18:24,380 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:24.426784768Z [err]  2025-12-19 12:18:24,423 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:25.043055106Z [err]  2025-12-19 12:18:24,959 - server - INFO - üìû Call history request - user_id: dcafa642-6136-4096-b77d-a4cb99a62651, limit: 50, offset: 0
2025-12-19T12:18:25.043068210Z [err]  2025-12-19 12:18:24,959 - server - INFO - üìû Query: {'user_id': 'dcafa642-6136-4096-b77d-a4cb99a62651'}
2025-12-19T12:18:25.043177675Z [err]  2025-12-19 12:18:24,846 - soniox_service - ERROR - ‚ùå Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-19T12:18:25.043187575Z [err]  2025-12-19 12:18:24,846 - server - INFO - üîå Telnyx WebSocket disconnected
2025-12-19T12:18:25.043193208Z [err]  2025-12-19 12:18:24,882 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:25.043202137Z [err]  2025-12-19 12:18:24,882 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:25.043207806Z [err]  2025-12-19 12:18:24,925 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:25.387180769Z [err]  2025-12-19 12:18:25,384 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:25.387185591Z [err]  2025-12-19 12:18:25,385 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:25.429249475Z [err]  2025-12-19 12:18:25,426 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:26.061863237Z [err]  2025-12-19 12:18:25,583 - server - INFO - üìû Found 50 calls for user (Total: 849)
2025-12-19T12:18:26.061870688Z [inf]  100.64.0.2:50504 - "GET /api/call-history?limit=50&offset=0 HTTP/1.1" 200
2025-12-19T12:18:26.061878822Z [err]  2025-12-19 12:18:25,886 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:26.061885949Z [err]  2025-12-19 12:18:25,886 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:26.061896215Z [err]  2025-12-19 12:18:25,928 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:26.061902176Z [err]  2025-12-19 12:18:25,967 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-19T12:18:26.061907757Z [err]  2025-12-19 12:18:25,971 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Expecting value: line 1 column 1 (char 0)
2025-12-19T12:18:26.061914039Z [err]  2025-12-19 12:18:25,978 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-19T12:18:26.061919669Z [err]  2025-12-19 12:18:25,981 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-19T12:18:26.061938167Z [err]  2025-12-19 12:18:25,981 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:26.065780402Z [err]  2025-12-19 12:18:26,061 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:26.065786630Z [err]  2025-12-19 12:18:26,061 - server - INFO - ‚úÖ QC analysis completed for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:26.065792391Z [err]  2025-12-19 12:18:26,061 - server - INFO - üìä Scores: Commitment=50, Conversion=20, Excellence=50
2025-12-19T12:18:26.137267847Z [inf]  100.64.0.2:62978 - "GET /api/call-analytics HTTP/1.1" 200
2025-12-19T12:18:26.240288944Z [err]  2025-12-19 12:18:26,238 - server - INFO - üìä Updated campaign_calls with QC scores for v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw
2025-12-19T12:18:26.391688101Z [err]  2025-12-19 12:18:26,388 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:26.391695568Z [err]  2025-12-19 12:18:26,388 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:26.418395211Z [err]  2025-12-19 12:18:26,414 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-19T12:18:26.451288652Z [err]  2025-12-19 12:18:26,446 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:26.504968723Z [err]  2025-12-19 12:18:26,502 - server - INFO - üè∑Ô∏è Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-19T12:18:26.504976304Z [err]  2025-12-19 12:18:26,502 - server - ERROR - ‚ùå Error in auto appointment detection for call v3:cOxrt5tLBpdjIWGffUlBc9j7nHekVsaKCNV8q6m2fPqyRCvdGhZQFw: 'str' object has no attribute 'get'
2025-12-19T12:18:27.039143972Z [err]  2025-12-19 12:18:26,890 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:27.039150557Z [err]  2025-12-19 12:18:26,891 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:27.039165885Z [err]  2025-12-19 12:18:26,946 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:27.306131830Z [inf]  100.64.0.2:62978 - "GET /api/agents HTTP/1.1" 200
2025-12-19T12:18:27.393533643Z [err]  2025-12-19 12:18:27,392 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:27.393544413Z [err]  2025-12-19 12:18:27,392 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:27.451480775Z [err]  2025-12-19 12:18:27,448 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:27.451490912Z [err]  2025-12-19 12:18:27,448 - calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-19T12:18:27.451498915Z [err]  2025-12-19 12:18:27,448 - calling_service - INFO - üí¨ Sending FINAL check-in #2/2: Are you still there?
2025-12-19T12:18:27.451505375Z [err]  2025-12-19 12:18:27,448 - calling_service - INFO - ‚ö†Ô∏è Will end call if no response after next silence timeout
2025-12-19T12:18:27.451512645Z [err]  2025-12-19 12:18:27,448 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-19T12:18:27.451520362Z [err]  2025-12-19 12:18:27,448 - calling_service - INFO - ü§ñ Agent started speaking for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:27.451526982Z [err]  2025-12-19 12:18:27,448 - telnyx_service - INFO - üîä Speaking text on call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA: Are you still there?...
2025-12-19T12:18:27.451533408Z [err]  2025-12-19 12:18:27,449 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-19T12:18:27.451541575Z [err]  2025-12-19 12:18:27,449 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-19T12:18:27.451548555Z [err]  2025-12-19 12:18:27,449 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-19T12:18:27.451554582Z [err]  2025-12-19 12:18:27,449 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-19T12:18:27.451560589Z [err]  2025-12-19 12:18:27,449 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-19T12:18:27.451567322Z [err]  2025-12-19 12:18:27,449 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-19T12:18:27.451574587Z [err]  2025-12-19 12:18:27,449 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:18:27.453867912Z [err]  2025-12-19 12:18:27,449 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-19T12:18:28.302222129Z [err]  2025-12-19 12:18:27,900 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-19T12:18:28.302765154Z [err]  2025-12-19 12:18:27,647 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:18:28.302769123Z [err]  2025-12-19 12:18:27,648 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.20s
2025-12-19T12:18:28.302773324Z [err]  2025-12-19 12:18:27,648 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-19T12:18:28.302778423Z [err]    "errors": [
2025-12-19T12:18:28.302782385Z [err]      {
2025-12-19T12:18:28.302786613Z [err]        "code": "90018",
2025-12-19T12:18:28.302790407Z [err]        "title": "Call has already ended",
2025-12-19T12:18:28.302794494Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-19T12:18:28.302798684Z [err]      }
2025-12-19T12:18:28.302802669Z [err]    ]
2025-12-19T12:18:28.302806462Z [err]  }
2025-12-19T12:18:28.302810475Z [err]  2025-12-19 12:18:27,649 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-19T12:18:28.302814802Z [err]  2025-12-19 12:18:27,894 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:28.302818714Z [err]  2025-12-19 12:18:27,894 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:28.302822552Z [err]  2025-12-19 12:18:27,899 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-19T12:18:28.302826675Z [err]  2025-12-19 12:18:27,900 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-19T12:18:28.398334684Z [err]  2025-12-19 12:18:28,395 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:28.398340096Z [err]  2025-12-19 12:18:28,395 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:28.403818258Z [err]  2025-12-19 12:18:28,402 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:28.403829324Z [err]  2025-12-19 12:18:28,402 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:29.101885471Z [err]  2025-12-19 12:18:28,896 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:29.101889943Z [err]  2025-12-19 12:18:28,896 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:29.101893563Z [err]  2025-12-19 12:18:28,904 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:29.101897373Z [err]  2025-12-19 12:18:28,904 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:29.402470916Z [err]  2025-12-19 12:18:29,399 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:29.402479406Z [err]  2025-12-19 12:18:29,399 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:29.410841183Z [err]  2025-12-19 12:18:29,406 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:29.410847041Z [err]  2025-12-19 12:18:29,406 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:30.031953002Z [err]  2025-12-19 12:18:29,900 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:30.031959967Z [err]  2025-12-19 12:18:29,900 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:30.031967629Z [err]  2025-12-19 12:18:29,907 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:30.031975047Z [err]  2025-12-19 12:18:29,908 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: [])
2025-12-19T12:18:30.273832810Z [err]  2025-12-19 12:18:30,269 - server - INFO - üé§ Soniox receiver alive - 2 messages received in last 10s
2025-12-19T12:18:30.273843081Z [err]  2025-12-19 12:18:30,269 - server - ERROR - ‚ùå Soniox error: {'tokens': [], 'final_audio_proc_ms': 0, 'total_audio_proc_ms': 0, 'error_code': 408, 'error_message': 'Audio data decode timeout'}
2025-12-19T12:18:30.273849924Z [err]  2025-12-19 12:18:30,269 - server - INFO - ‚úÖ Soniox receive loop ended normally
2025-12-19T12:18:30.273856436Z [err]  2025-12-19 12:18:30,269 - dead_air_monitor - INFO - üîá Dead air monitoring cancelled for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:30.273863179Z [err]  2025-12-19 12:18:30,269 - dead_air_monitor - INFO - üîá Dead air monitoring stopped for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:30.273869719Z [err]  2025-12-19 12:18:30,269 - server - INFO - üîá Dead air monitoring task cancelled
2025-12-19T12:18:30.404750456Z [err]  2025-12-19 12:18:30,402 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:30.404755115Z [err]  2025-12-19 12:18:30,402 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:30.404759765Z [err]  2025-12-19 12:18:30,402 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=1/2
2025-12-19T12:18:31.050041569Z [err]  2025-12-19 12:18:30,905 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:31.050046732Z [err]  2025-12-19 12:18:30,905 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:31.050051301Z [err]  2025-12-19 12:18:30,905 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=1/2
2025-12-19T12:18:31.050056822Z [err]  2025-12-19 12:18:30,945 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-19T12:18:31.050061539Z [err]  2025-12-19 12:18:30,948 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Expecting value: line 1 column 1 (char 0)
2025-12-19T12:18:31.050065512Z [err]  2025-12-19 12:18:31,037 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:31.050069311Z [err]  2025-12-19 12:18:31,037 - server - INFO - ‚úÖ QC analysis completed for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:31.050073777Z [err]  2025-12-19 12:18:31,037 - server - INFO - üìä Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-19T12:18:31.215592176Z [err]  2025-12-19 12:18:31,212 - server - INFO - üìä Updated campaign_calls with QC scores for v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:31.393149551Z [err]  2025-12-19 12:18:31,387 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-19T12:18:31.409328424Z [err]  2025-12-19 12:18:31,407 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:31.409334231Z [err]  2025-12-19 12:18:31,407 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:31.475522608Z [err]  2025-12-19 12:18:31,473 - server - INFO - üè∑Ô∏è Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-19T12:18:31.475529096Z [err]  2025-12-19 12:18:31,473 - server - ERROR - ‚ùå Error in auto appointment detection for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA: 'str' object has no attribute 'get'
2025-12-19T12:18:32.070640675Z [err]  2025-12-19 12:18:31,908 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:32.070651916Z [err]  2025-12-19 12:18:31,909 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:32.277062865Z [err]  2025-12-19 12:18:32,271 - soniox_service - ERROR - ‚ùå Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-19T12:18:32.277072143Z [err]  2025-12-19 12:18:32,271 - server - INFO - üîå Telnyx WebSocket disconnected
2025-12-19T12:18:32.412222468Z [err]  2025-12-19 12:18:32,410 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:32.412230400Z [err]  2025-12-19 12:18:32,410 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:33.130892499Z [inf]  100.64.0.2:62978 - "GET /api/agents/6944df147eadbccc46887cdf HTTP/1.1" 200
2025-12-19T12:18:33.130897094Z [inf]  100.64.0.2:50504 - "GET /api/agents/6944df147eadbccc46887cdf/kb HTTP/1.1" 200
2025-12-19T12:18:33.130900644Z [err]  2025-12-19 12:18:32,912 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:33.130904318Z [err]  2025-12-19 12:18:32,912 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:33.420948660Z [err]  2025-12-19 12:18:33,414 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:33.420964564Z [err]  2025-12-19 12:18:33,414 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:33.464380182Z [inf]  100.64.0.2:50504 - "GET /api/qc/enhanced/agents/6944df147eadbccc46887cdf/auto-qc-settings HTTP/1.1" 200
2025-12-19T12:18:34.091035687Z [err]  2025-12-19 12:18:33,548 - qc_enhanced_router - INFO - Listed 1 campaigns for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-19T12:18:34.091042037Z [inf]  100.64.0.2:62978 - "GET /api/qc/enhanced/campaigns HTTP/1.1" 200
2025-12-19T12:18:34.091047971Z [err]  2025-12-19 12:18:33,916 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:34.091055653Z [err]  2025-12-19 12:18:33,916 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:34.422479219Z [err]  2025-12-19 12:18:34,417 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:34.422490797Z [err]  2025-12-19 12:18:34,418 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:35.060709872Z [err]  2025-12-19 12:18:34,919 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:35.060716204Z [err]  2025-12-19 12:18:34,919 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:35.425050625Z [err]  2025-12-19 12:18:35,421 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:35.425060111Z [err]  2025-12-19 12:18:35,421 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:DjlgJvrdgXFUOWF9M... (active sessions: ['v3:WY8VkMmef-iploqywZZJaWqsFLpak7-gLoxG9om40wABIQE75icpBA'])
2025-12-19T12:18:36.064869020Z [err]  2025-12-19 12:18:35,745 - server - INFO - üé§ Soniox receiver alive - 8 messages received in last 10s
2025-12-19T12:18:36.064876767Z [err]  2025-12-19 12:18:35,745 - server - ERROR - ‚ùå Soniox error: {'tokens': [], 'final_audio_proc_ms': 4080, 'total_audio_proc_ms': 6000, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-19T12:18:36.064883903Z [err]  2025-12-19 12:18:35,745 - server - INFO - ‚úÖ Soniox receive loop ended normally
2025-12-19T12:18:36.064890790Z [err]  2025-12-19 12:18:35,745 - dead_air_monitor - INFO - üîá Dead air monitoring cancelled for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:36.064898167Z [err]  2025-12-19 12:18:35,745 - dead_air_monitor - INFO - üîá Dead air monitoring stopped for call v3:DjlgJvrdgXFUOWF9MGOQzZQliIwzJC9Xhvit9NkMy0qMl2SW2dx3qA
2025-12-19T12:18:36.064905574Z [err]  2025-12-19 12:18:35,745 - server - INFO - üîá Dead air monitoring task cancelled
2025-12-19T12:18:36.448028162Z [inf]  100.64.0.2:62978 - "GET /api/agents/6944df147eadbccc46887cdf HTTP/1.1" 200
2025-12-19T12:18:36.457476839Z [inf]  100.64.0.2:50504 - "GET /api/agents/6944df147eadbccc46887cdf/flow HTTP/1.1" 200
2025-12-19T12:18:38.025254536Z [err]  2025-12-19 12:18:37,747 - soniox_service - ERROR - ‚ùå Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-19T12:18:38.025262934Z [err]  2025-12-19 12:18:37,747 - server - INFO - üîå Telnyx WebSocket disconnected
2025-12-19T12:18:40.096530482Z [err]  [2025-12-19 12:18:39 +0000] [4] [INFO] connection closed
2025-12-19T12:18:40.096537086Z [err]  2025-12-19 12:18:39,810 - server - ERROR - ‚ùå Error in WebSocket handler: (<CloseCode.ABNORMAL_CLOSURE: 1006>, None)
2025-12-19T12:18:40.096543874Z [err]  Traceback (most recent call last):
2025-12-19T12:18:40.096550058Z [err]    File "/app/backend/server.py", line 5108, in telnyx_audio_stream_generic
2025-12-19T12:18:40.096557094Z [err]      message = await asyncio.wait_for(websocket.receive_text(), timeout=60)
2025-12-19T12:18:40.096564246Z [err]                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-12-19T12:18:40.096570950Z [err]    File "/usr/local/lib/python3.11/asyncio/tasks.py", line 489, in wait_for
2025-12-19T12:18:40.096580004Z [err]      return fut.result()
2025-12-19T12:18:40.096588106Z [err]             ^^^^^^^^^^^^
2025-12-19T12:18:40.096594841Z [err]    File "/root/.local/lib/python3.11/site-packages/starlette/websockets.py", line 138, in receive_text
2025-12-19T12:18:40.096601172Z [err]      self._raise_on_disconnect(message)
2025-12-19T12:18:40.096607716Z [err]    File "/root/.local/lib/python3.11/site-packages/starlette/websockets.py", line 130, in _raise_on_disconnect
2025-12-19T12:18:40.096613706Z [err]      raise WebSocketDisconnect(message["code"], message.get("reason"))
2025-12-19T12:18:40.096619645Z [err]  starlette.websockets.WebSocketDisconnect: (<CloseCode.ABNORMAL_CLOSURE: 1006>, None)
2025-12-19T12:18:40.096626079Z [err]  2025-12-19 12:18:39,811 - server - INFO - üîå Telnyx WebSocket disconnected