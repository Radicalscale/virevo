2025-12-29T21:39:12.110383408Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - ğŸ”§ Replaced {{callerName}} with  in content
2025-12-29T21:39:12.110415547Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - Selected transition index: -1
2025-12-29T21:39:12.110424847Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - No specific condition matched, looking for default transition...
2025-12-29T21:39:12.110432308Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - âš ï¸ No transition matched, but node has GOAL. Staying on current node to continue with goal-based guidance.
2025-12-29T21:39:12.110438065Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - ğŸ¯ Goal: Say the customer's name...
2025-12-29T21:39:12.110444972Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - â±ï¸ [TIMING] TRANSITION_EVAL: 825ms
2025-12-29T21:39:12.110452022Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - â±ï¸ [21:39:11.892] âœ… Node selected, about to process content...
2025-12-29T21:39:12.110458399Z [err]  2025-12-29 21:39:11,892 - core_calling_service - INFO - ğŸ”§ Replaced {{now}} with Monday, December 29, 2025 at 4:39 PM EST in content
2025-12-29T21:39:12.115542440Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - ğŸ”§ Replaced {{lead_id}} with None in content
2025-12-29T21:39:12.115548194Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - ğŸ”§ Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T21:39:12.115553635Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - ğŸ”§ Replaced {{track_keywords}} with  in content
2025-12-29T21:39:12.115561034Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - ğŸ”§ Replaced {{expected_commitment}} with not_specified in content
2025-12-29T21:39:12.115567091Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - ğŸ”§ Replaced {{to_number}} with +17708336397 in content
2025-12-29T21:39:12.115571705Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - ğŸ”§ Replaced {{phone_number}} with +17708336397 in content
2025-12-29T21:39:12.115576542Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - ğŸ”§ Replaced {{email}} with None in content
2025-12-29T21:39:12.115581290Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - âœ… Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-29T21:39:12.115585464Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-29T21:39:12.115590184Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - ğŸ“š skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-29T21:39:12.115594955Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - â±ï¸ [21:39:11.893] ğŸ“„ About to process content (mode=script, length=9)
2025-12-29T21:39:12.115600318Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - ğŸ›¡ï¸ Preventing Dead Air: User stayed on script node 'Greeting' without transition
2025-12-29T21:39:12.115604690Z [err]  2025-12-29 21:39:11,893 - core_calling_service - INFO - ğŸ¤– Generating sticky-prevention response...
2025-12-29T21:39:12.115810332Z [err]  2025-12-29 21:39:11,903 - core_calling_service - INFO - âš¡ PARALLEL MODE: Running KB + analysis simultaneously
2025-12-29T21:39:12.115815904Z [err]  2025-12-29 21:39:11,906 - kb_router - INFO - ğŸš¦ KB Router: SKIP (simple chat pattern matched)
2025-12-29T21:39:12.115821714Z [err]  2025-12-29 21:39:11,906 - core_calling_service - INFO - âš¡ Skipping KB (reason: simple_chat)
2025-12-29T21:39:12.115827039Z [err]  2025-12-29 21:39:11,906 - core_calling_service - INFO - âš¡ Parallel operations completed in 0ms
2025-12-29T21:39:12.115832810Z [err]  2025-12-29 21:39:11,906 - core_calling_service - INFO - ğŸ” Node 'Greeting': use_parallel_llm=True
2025-12-29T21:39:12.115838860Z [err]  2025-12-29 21:39:11,910 - core_calling_service - INFO - âš¡ Parallel mode: Using condensed history (3/3 messages)
2025-12-29T21:39:12.115846357Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - â±ï¸ [21:39:11.910] ğŸ’¬ LLM REQUEST START: 3 conversation turns, 7881 system chars (KB cached)
2025-12-29T21:39:12.115851890Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - ğŸ“ â•â•â•â•â•â•â•â•â•â•â• LLM PROMPT BREAKDOWN â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:39:12.115858653Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - ğŸ“ [SYSTEM MSG 1 - GLOBAL PROMPT] (6467 chars):
2025-12-29T21:39:12.115865809Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - ğŸ“   Preview: # Global Prompt: Direct Drive Engine (V4.2 - Acknowledging & Fluid)
2025-12-29T21:39:12.115873471Z [err]  
2025-12-29T21:39:12.115880375Z [err]  When user states income, convert/update as [yearly_income] variable for logic splits.
2025-12-29T21:39:12.115886992Z [err]  
2025-12-29T21:39:12.115893775Z [err]  If user says a name, don't assume it's theirsâ€”wait for explicit correction.
2025-12-29T21:39:12.115900950Z [err]  
2025-12-29T21:39:12.115907388Z [err]  If user asks to repeat info, rephrase naturallyâ€”never exact repeat.
2025-12-29T21:39:12.116644634Z [err]  
2025-12-29T21:39:12.116651540Z [err]  If asked your state: "Atlanta, GA. Been in Midtown 10 years."
2025-12-29T21:39:12.116657288Z [err]  
2025-12-29T21:39:12.116662068Z [err]  If asked about call number: "Company number."
2025-12-29T21:39:12.116668150Z [err]  
2025-12-29T21:39:12.116673003Z [err]  User email: {customer_email} (for them: {{customer_email}}).
2025-12-29T21:39:12.116678086Z [err]  
2025-12-29T21:39:12.116682789Z [err]  If explaining ends in peri...
2025-12-29T21:39:12.116688183Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - ğŸ“ [SYSTEM MSG 2 - DYNAMIC CONTEXT] (1414 chars):
2025-12-29T21:39:12.116697193Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - ğŸ“   Preview: 
2025-12-29T21:39:12.116702280Z [err]  
2025-12-29T21:39:12.116707314Z [err]  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-29T21:39:12.116713940Z [err]  PREPROCESSED CONTEXT (to help you prioritize and focus):
2025-12-29T21:39:12.116720922Z [err]  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-29T21:39:12.116724780Z [err]  
2025-12-29T21:39:12.116728560Z [err]  USER COMMUNICATION STYLE: C type - adjust your response accordingly
2025-12-29T21:39:12.116732304Z [err]  CONVERSATION STATUS: Turn 2, objection handling phase
2025-12-29T21:39:12.116736532Z [err]  
2025-12-29T21:39:12.116740247Z [err]  This context is provided to help you focus. You still need to:
2025-12-29T21:39:12.116743974Z [err]  1. Generate a natural, contextual response
2025-12-29T21:39:12.116747499Z [err]  2. Evaluate transitions per your node instructions
2025-12-29T21:39:12.118841573Z [err]  
2025-12-29T21:39:12.118847491Z [err]  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-29T21:39:12.118852403Z [err]  
2025-12-29T21:39:12.118856780Z [err]  # CURRENT CONTEXT
2025-12-29T21:39:12.118861497Z [err]  Customer: Kendrick
2025-12-29T21:39:12.118867441Z [err]  Variables: {"now": "Monday, December 29, 2025 at 4:39 PM EST", "customer_name": "Kendrick", "callerName": "", "lead_id": null, "qc_tracking_enabled": false, "track_keywords": "", "expected_commitment": ...
2025-12-29T21:39:12.118872468Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - ğŸ“ [CONVERSATION HISTORY] (3 messages)
2025-12-29T21:39:12.118877510Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - ğŸ“   assistant: Kendrick?...
2025-12-29T21:39:12.118882109Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - ğŸ“   user: Hello?...
2025-12-29T21:39:12.118891934Z [err]  2025-12-29 21:39:11,911 - core_calling_service - INFO - ğŸ“ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:39:12.118897726Z [err]  2025-12-29 21:39:12,036 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:12.346099523Z [err]  2025-12-29 21:39:12,340 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-29T21:39:12.544006834Z [err]  2025-12-29 21:39:12,538 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:13.216330713Z [err]  2025-12-29 21:39:12,661 - core_calling_service - INFO - â±ï¸ [21:39:12.661] ğŸ’¬ LLM FIRST TOKEN: 750ms (grok grok-4-1-fast-non-reasoning)
2025-12-29T21:39:13.216337281Z [err]  2025-12-29 21:39:12,742 - server - INFO - ğŸ“¤ Sentence arrived from LLM: [N] Hey Kendrick,...
2025-12-29T21:39:13.216343704Z [err]  2025-12-29 21:39:12,742 - server - INFO - â±ï¸ [TIMING] TTFS (Time To First Sentence): 2070ms
2025-12-29T21:39:13.216349195Z [err]  2025-12-29 21:39:12,742 - server - INFO - âš¡ Starting REAL-TIME TTS for first sentence
2025-12-29T21:39:13.216355332Z [err]  2025-12-29 21:39:12,742 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:13.216360882Z [err]  2025-12-29 21:39:12,742 - server - INFO - âš¡ ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-29T21:39:13.219029804Z [err]  2025-12-29 21:39:12,828 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:13.219039009Z [err]  2025-12-29 21:39:12,913 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:13.219046018Z [err]  2025-12-29 21:39:12,998 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:13.219053208Z [err]  2025-12-29 21:39:13,022 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:13.219063806Z [err]  2025-12-29 21:39:13,022 - server - INFO - âœ… ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-29T21:39:13.219071102Z [err]  2025-12-29 21:39:13,022 - persistent_tts_service - INFO - ğŸ™ï¸ Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:39:13.219078542Z [err]  2025-12-29 21:39:13,022 - persistent_tts_service - INFO - ğŸ”Œ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Establishing persistent TTS WebSocket...
2025-12-29T21:39:13.219162150Z [err]  2025-12-29 21:39:13,022 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:39:13.219169017Z [err]  2025-12-29 21:39:13,022 - elevenlabs_ws_service - INFO - ğŸ”Œ Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-29T21:39:13.219176027Z [err]  2025-12-29 21:39:13,022 - elevenlabs_ws_service - INFO - ğŸ™ï¸ Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-29T21:39:13.219201836Z [err]  2025-12-29 21:39:13,030 - server - INFO - ğŸ“¤ Audio flowing: 293 packets sent to Soniox (5s update)
2025-12-29T21:39:13.219208609Z [err]  2025-12-29 21:39:13,039 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:tsihRGQZxbPBg2zqu... (active sessions: [])
2025-12-29T21:39:13.219219316Z [err]  2025-12-29 21:39:13,156 - elevenlabs_ws_service - INFO - âœ… Connected to ElevenLabs WebSocket
2025-12-29T21:39:13.219229433Z [err]  2025-12-29 21:39:13,156 - elevenlabs_ws_service - INFO - ğŸ“¤ Sent BOS message with voice settings
2025-12-29T21:39:13.219252436Z [err]  2025-12-29 21:39:13,156 - persistent_tts_service - INFO - âœ… [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Persistent TTS WebSocket established
2025-12-29T21:39:13.219260465Z [err]  2025-12-29 21:39:13,157 - persistent_tts_service - INFO - ğŸ§ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Audio receiver loop started
2025-12-29T21:39:13.219267608Z [err]  2025-12-29 21:39:13,157 - persistent_tts_service - INFO - ğŸ”Š [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Comfort noise loop started
2025-12-29T21:39:13.219277850Z [err]  2025-12-29 21:39:13,157 - persistent_tts_service - INFO - âœ… Created persistent TTS session for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:13.219491544Z [err]  2025-12-29 21:39:13,157 - server - INFO - âœ… ON-DEMAND: Persistent TTS session created successfully!
2025-12-29T21:39:13.219498000Z [err]  2025-12-29 21:39:13,157 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:tsihRGQZxbPBg2zqu..., session=FOUND
2025-12-29T21:39:13.219504985Z [err]  2025-12-29 21:39:13,157 - server - INFO - ğŸš€ Streaming sentence #1 via persistent WebSocket
2025-12-29T21:39:13.219553567Z [err]  2025-12-29 21:39:13,157 - server - INFO - ğŸµ TTS task #1 started at +414ms
2025-12-29T21:39:13.219560386Z [err]  2025-12-29 21:39:13,157 - server - INFO - â±ï¸ [TIMING] TTFT_TTS (First TTS Task Started): 2484ms
2025-12-29T21:39:13.219568015Z [err]  2025-12-29 21:39:13,157 - core_calling_service - INFO - ğŸ“¤ Streamed sentence: [N] Hey Kendrick,...
2025-12-29T21:39:13.219575078Z [err]  2025-12-29 21:39:13,158 - persistent_tts_service - INFO - ğŸµ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Playback consumer started
2025-12-29T21:39:13.219582273Z [err]  2025-12-29 21:39:13,158 - persistent_tts_service - INFO - ğŸ§ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Audio Receiver Loop STARTED
2025-12-29T21:39:13.219589032Z [err]  2025-12-29 21:39:13,158 - persistent_tts_service - INFO - ğŸ’“ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Starting TTS keep-alive loop (every 15s)
2025-12-29T21:39:13.219595751Z [err]  2025-12-29 21:39:13,158 - persistent_tts_service - INFO - ğŸ”Š [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Starting comfort noise loop
2025-12-29T21:39:13.219604532Z [err]  2025-12-29 21:39:13,158 - persistent_tts_service - INFO - ğŸ¤ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Streaming sentence #1: [N] Hey Kendrick,...
2025-12-29T21:39:13.219611089Z [err]  2025-12-29 21:39:13,158 - persistent_tts_service - INFO - ğŸš€ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-29T21:39:13.223541621Z [err]  2025-12-29 21:39:13,158 - persistent_tts_service - INFO - ğŸ“Š [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-29T21:39:13.223560498Z [err]  2025-12-29 21:39:13,160 - server - INFO - ğŸ“¤ Sentence arrived from LLM: it's Jake here from JK....
2025-12-29T21:39:13.223568800Z [err]  2025-12-29 21:39:13,160 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:tsihRGQZxbPBg2zqu..., session=FOUND
2025-12-29T21:39:13.223604701Z [err]  2025-12-29 21:39:13,160 - server - INFO - ğŸš€ Streaming sentence #2 via persistent WebSocket
2025-12-29T21:39:13.223612316Z [err]  2025-12-29 21:39:13,160 - server - INFO - ğŸµ TTS task #2 started at +417ms
2025-12-29T21:39:13.223619315Z [err]  2025-12-29 21:39:13,160 - core_calling_service - INFO - ğŸ“¤ Streamed sentence: it's Jake here from JK....
2025-12-29T21:39:13.223625100Z [err]  2025-12-29 21:39:13,162 - persistent_tts_service - INFO - ğŸ§ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Receiver processing sentence #1: '[N] Hey Kendrick,...'
2025-12-29T21:39:13.223631165Z [err]  2025-12-29 21:39:13,162 - persistent_tts_service - INFO - ğŸ“Š [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] DIAGNOSTIC: queue_latency=3ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-29T21:39:13.223636718Z [err]  2025-12-29 21:39:13,162 - persistent_tts_service - INFO - ğŸ¤ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Streaming sentence #2: it's Jake here from JK....
2025-12-29T21:39:13.223644130Z [err]  2025-12-29 21:39:13,162 - persistent_tts_service - INFO - ğŸš€ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Sent sentence #2 (NON-BLOCKING) in 0ms
2025-12-29T21:39:13.223651640Z [err]  2025-12-29 21:39:13,162 - persistent_tts_service - INFO - ğŸ“Š [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=False, is_last=False
2025-12-29T21:39:13.225290613Z [err]  2025-12-29 21:39:13,163 - server - INFO - ğŸ“¤ Sentence arrived from LLM: You there?...
2025-12-29T21:39:13.225301412Z [err]  2025-12-29 21:39:13,163 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:tsihRGQZxbPBg2zqu..., session=FOUND
2025-12-29T21:39:13.225309361Z [err]  2025-12-29 21:39:13,163 - server - INFO - ğŸš€ Streaming sentence #3 via persistent WebSocket
2025-12-29T21:39:13.225316431Z [err]  2025-12-29 21:39:13,163 - server - INFO - ğŸµ TTS task #3 started at +420ms
2025-12-29T21:39:13.225327257Z [err]  2025-12-29 21:39:13,163 - core_calling_service - INFO - ğŸ“¤ Streamed final fragment: You there?...
2025-12-29T21:39:13.225334632Z [err]  2025-12-29 21:39:13,163 - core_calling_service - INFO - â±ï¸ [TIMING] LLM_TOTAL: 1252ms for 52 chars (grok grok-4-1-fast-non-reasoning)
2025-12-29T21:39:13.225341602Z [err]  2025-12-29 21:39:13,163 - core_calling_service - INFO - â±ï¸ SILENCE TIMER RESET (user gave meaningful response) for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:13.225348314Z [err]  2025-12-29 21:39:13,163 - core_calling_service - INFO - ğŸ”Š Silence tracking reset for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ (user responded)
2025-12-29T21:39:13.225357801Z [err]  2025-12-29 21:39:13,163 - core_calling_service - INFO - âœ… User responded to regular message, resetting counter
2025-12-29T21:39:13.225365317Z [err]  2025-12-29 21:39:13,163 - core_calling_service - INFO - ğŸ’¾ Storing node ID 2 in conversation history
2025-12-29T21:39:13.225375386Z [err]  2025-12-29 21:39:13,163 - core_calling_service - INFO - LLM response (2.40s): [N] Hey Kendrick, it's Jake here from JK. You there?
2025-12-29T21:39:13.225381906Z [err]  2025-12-29 21:39:13,163 - core_calling_service - INFO - Total latency: 2.40s
2025-12-29T21:39:13.225388146Z [err]  2025-12-29 21:39:13,165 - server - INFO - âœ… LLM finished in 2492ms, TTS tasks already running in background
2025-12-29T21:39:13.226814683Z [err]  2025-12-29 21:39:13,165 - server - INFO - ğŸµ Streaming 3 TTS chunks as they complete...
2025-12-29T21:39:13.226820922Z [err]  2025-12-29 21:39:13,165 - server - INFO - ğŸš€ Persistent TTS: Audio already streaming in background!
2025-12-29T21:39:13.226826819Z [err]  2025-12-29 21:39:13,165 - server - INFO -    3 sentences queued and playing seamlessly
2025-12-29T21:39:13.226836246Z [err]  2025-12-29 21:39:13,166 - persistent_tts_service - INFO - ğŸ¤ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Streaming sentence #3: You there?...
2025-12-29T21:39:13.226841603Z [err]  2025-12-29 21:39:13,166 - persistent_tts_service - INFO - ğŸš€ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Sent sentence #3 (NON-BLOCKING) in 0ms
2025-12-29T21:39:13.226854373Z [err]  2025-12-29 21:39:13,166 - persistent_tts_service - INFO - ğŸ“Š [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] DIAGNOSTIC: pending_sentences=2, audio_queue=0, is_first=False, is_last=False
2025-12-29T21:39:13.226859777Z [err]  2025-12-29 21:39:13,166 - server - INFO - âœ… All 3 persistent TTS streams completed
2025-12-29T21:39:13.226864989Z [err]  2025-12-29 21:39:13,166 - server - INFO - âœ… Agent generation complete (persistent TTS) - response window closed
2025-12-29T21:39:13.226871768Z [err]  2025-12-29 21:39:13,166 - server - INFO - â±ï¸  FIRST AUDIO STARTED: 2494ms from user stop ğŸš€
2025-12-29T21:39:13.226880759Z [err]  2025-12-29 21:39:13,166 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:13.226891115Z [err]  2025-12-29 21:39:13,166 - server - INFO - âœ… Agent generation complete - response window closed
2025-12-29T21:39:13.226897157Z [err]  2025-12-29 21:39:13,166 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:39:13.229350542Z [err]  2025-12-29 21:39:13,166 - server - INFO - â±ï¸  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-29T21:39:13.229358373Z [err]  2025-12-29 21:39:13,166 - server - INFO - â±ï¸  [TIMING] STT: 20ms (provider: soniox, model: stt-rt-v3)
2025-12-29T21:39:13.229362888Z [err]  2025-12-29 21:39:13,166 - server - INFO - â±ï¸  [TIMING] LLM_TOTAL: 2492ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-29T21:39:13.229368181Z [err]  2025-12-29 21:39:13,166 - server - INFO - â±ï¸  [TIMING] TTS_TOTAL: 424ms (provider: elevenlabs, websocket: False)
2025-12-29T21:39:13.229374491Z [err]  2025-12-29 21:39:13,167 - server - INFO - â±ï¸  [TIMING] E2E_TOTAL: 2494ms (user stopped â†’ play_audio_url called)
2025-12-29T21:39:13.229382744Z [err]  2025-12-29 21:39:13,167 - server - INFO - â±ï¸  [TIMING] âš ï¸ NOTE: E2E_TOTAL does not include:
2025-12-29T21:39:13.229389779Z [err]  2025-12-29 21:39:13,167 - server - INFO - â±ï¸  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-29T21:39:13.229397877Z [err]  2025-12-29 21:39:13,167 - server - INFO - â±ï¸  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-29T21:39:13.229408788Z [err]  2025-12-29 21:39:13,167 - server - INFO - â±ï¸  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-29T21:39:13.229415593Z [err]  2025-12-29 21:39:13,167 - server - INFO - â±ï¸  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-29T21:39:13.229422147Z [err]  2025-12-29 21:39:13,167 - server - INFO - â±ï¸  [TIMING]   - REAL USER LATENCY: 2794ms estimated
2025-12-29T21:39:13.229443343Z [err]  2025-12-29 21:39:13,167 - server - INFO - â±ï¸  [TIMING] RESPONSE_TEXT: 52 chars, 3 sentences
2025-12-29T21:39:13.229450475Z [err]  2025-12-29 21:39:13,167 - server - INFO - â±ï¸  [TIMING] USER_INPUT: 'Hello?...'
2025-12-29T21:39:13.229455116Z [err]  2025-12-29 21:39:13,167 - server - INFO - â±ï¸  [TIMING] AI_RESPONSE: '[N] Hey Kendrick, it's Jake here from JK. You there?...'
2025-12-29T21:39:13.231829577Z [err]  2025-12-29 21:39:13,167 - server - INFO - â±ï¸  [TIMING] ==========================
2025-12-29T21:39:13.231840693Z [err]  2025-12-29 21:39:13,167 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:39:13.355640078Z [err]  2025-12-29 21:39:13,352 - server - INFO - ğŸ“ Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 2936ms)
2025-12-29T21:39:13.355650741Z [err]  2025-12-29 21:39:13,353 - server - INFO - ğŸ”Š Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-29T21:39:13.355657935Z [err]  2025-12-29 21:39:13,353 - server - INFO - ğŸ” END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-29T21:39:13.411415610Z [err]  2025-12-29 21:39:13,409 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTFA (Time To First Audio Playback): 250ms
2025-12-29T21:39:13.411423933Z [err]  2025-12-29 21:39:13,409 - persistent_tts_service - INFO - ğŸ“¤ Sending 10387 bytes of audio (65 chunks, 1.3s duration) via WebSocket
2025-12-29T21:39:13.411429568Z [err]  2025-12-29 21:39:13,409 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:39:13.411435657Z [err]  2025-12-29 21:39:13,409 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +1.3s (total: 1.3s from now)
2025-12-29T21:39:13.414216085Z [err]  2025-12-29 21:39:13,410 - persistent_tts_service - INFO - âœ… Sent 65 audio chunks via WebSocket
2025-12-29T21:39:14.079443937Z [err]  2025-12-29 21:39:13,599 - persistent_tts_service - INFO - ğŸ“¤ Sending 13746 bytes of audio (86 chunks, 1.7s duration) via WebSocket
2025-12-29T21:39:14.079450245Z [err]  2025-12-29 21:39:13,599 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:39:14.079455313Z [err]  2025-12-29 21:39:13,599 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +1.7s (total: 2.8s from now)
2025-12-29T21:39:14.079460788Z [err]  2025-12-29 21:39:13,601 - persistent_tts_service - INFO - âœ… Sent 86 audio chunks via WebSocket
2025-12-29T21:39:14.079464992Z [err]  2025-12-29 21:39:13,808 - persistent_tts_service - INFO - ğŸ“¤ Sending 5944 bytes of audio (38 chunks, 0.7s duration) via WebSocket
2025-12-29T21:39:14.079470575Z [err]  2025-12-29 21:39:13,808 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:39:14.079476455Z [err]  2025-12-29 21:39:13,808 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +0.7s (total: 3.4s from now)
2025-12-29T21:39:14.079482235Z [err]  2025-12-29 21:39:13,809 - persistent_tts_service - INFO - âœ… Sent 38 audio chunks via WebSocket
2025-12-29T21:39:15.094953896Z [err]  2025-12-29 21:39:15,049 - dead_air_monitor - INFO - ğŸ”‡ MONITOR: Skipping silence check - audio playing (2.1s left)
2025-12-29T21:39:15.558288673Z [err]  2025-12-29 21:39:15,551 - dead_air_monitor - INFO - ğŸ”‡ MONITOR: Skipping silence check - audio playing (1.6s left)
2025-12-29T21:39:16.199827519Z [err]  2025-12-29 21:39:15,809 - elevenlabs_ws_service - INFO - â±ï¸  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-29T21:39:16.199832658Z [err]  2025-12-29 21:39:15,809 - persistent_tts_service - INFO - âœ… [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Receiver finished sentence #1: 3 chunks in 2650ms
2025-12-29T21:39:16.199838380Z [err]  2025-12-29 21:39:15,809 - persistent_tts_service - INFO - ğŸ§ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Receiver processing sentence #2: 'it's Jake here from JK....'
2025-12-29T21:39:16.199844865Z [err]  2025-12-29 21:39:15,809 - persistent_tts_service - INFO - ğŸ“Š [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] DIAGNOSTIC: queue_latency=2646ms, pending_sentences=1, audio_queue=0, interrupted=False
2025-12-29T21:39:16.366969963Z [err]  2025-12-29 21:39:16,363 - core_calling_service - INFO - â° Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-29T21:39:16.371421873Z [err]  2025-12-29 21:39:16,365 - core_calling_service - INFO - ğŸ’¬ Sending FINAL check-in #2/2: Are you still there?
2025-12-29T21:39:16.371436754Z [err]  2025-12-29 21:39:16,365 - core_calling_service - INFO - âš ï¸ Will end call if no response after next silence timeout
2025-12-29T21:39:16.371446163Z [err]  2025-12-29 21:39:16,365 - dead_air_monitor - INFO - ğŸ’¬ Sending check-in after 7.0s silence: Are you still there?
2025-12-29T21:39:16.371453778Z [err]  2025-12-29 21:39:16,365 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:16.371459402Z [err]  2025-12-29 21:39:16,365 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg: Are you still there?...
2025-12-29T21:39:16.371465472Z [err]  2025-12-29 21:39:16,365 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-29T21:39:16.371471169Z [err]  2025-12-29 21:39:16,365 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-29T21:39:16.371477312Z [err]  2025-12-29 21:39:16,365 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-29T21:39:16.371483327Z [err]  2025-12-29 21:39:16,365 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-29T21:39:16.371489439Z [err]  2025-12-29 21:39:16,365 - server - INFO - ğŸ’¾ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-29T21:39:16.371495044Z [err]  2025-12-29 21:39:16,365 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.00s
2025-12-29T21:39:16.371502013Z [err]  2025-12-29 21:39:16,366 - telnyx_service - INFO - âœ… Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:16.371507160Z [err]  2025-12-29 21:39:16,366 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:17.149242216Z [err]  2025-12-29 21:39:16,951 - dead_air_monitor - INFO - âœ… Check-in message sent
2025-12-29T21:39:17.149284601Z [err]  2025-12-29 21:39:16,694 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:17.149290884Z [err]  2025-12-29 21:39:16,694 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.33s
2025-12-29T21:39:17.149298414Z [err]  2025-12-29 21:39:16,694 - telnyx_service - ERROR - âŒ Telnyx playback failed: 422 - {
2025-12-29T21:39:17.149304608Z [err]    "errors": [
2025-12-29T21:39:17.149313982Z [err]      {
2025-12-29T21:39:17.149319855Z [err]        "code": "90018",
2025-12-29T21:39:17.149326892Z [err]        "title": "Call has already ended",
2025-12-29T21:39:17.149332145Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:39:17.149337745Z [err]      }
2025-12-29T21:39:17.149344761Z [err]    ]
2025-12-29T21:39:17.149350583Z [err]  }
2025-12-29T21:39:17.149356378Z [err]  2025-12-29 21:39:16,695 - telnyx_service - INFO - ğŸ“¢ Using Telnyx built-in TTS
2025-12-29T21:39:17.149362199Z [err]  2025-12-29 21:39:16,950 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:17.149367932Z [err]  2025-12-29 21:39:16,950 - telnyx_service - ERROR - âŒ Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:39:17.416542523Z [err]  2025-12-29 21:39:17,411 - persistent_tts_service - INFO - ğŸ”‡ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] FLOOR RELEASED (is_holding_floor=False)
2025-12-29T21:39:17.562748068Z [err]  2025-12-29 21:39:17,559 - dead_air_monitor - INFO - â±ï¸ Playback expected end time passed (0.4s ago), marking agent as done speaking
2025-12-29T21:39:17.562754467Z [err]  2025-12-29 21:39:17,559 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044357.5596902 for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:17.562759907Z [err]  2025-12-29 21:39:17,559 - core_calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:18.136412037Z [err]  2025-12-29 21:39:18,031 - server - INFO - ğŸ“¤ Audio flowing: 544 packets sent to Soniox (5s update)
2025-12-29T21:39:18.314379061Z [err]  2025-12-29 21:39:18,310 - elevenlabs_ws_service - WARNING - âš ï¸  [TIMING] ElevenLabs timeout waiting for first chunk (2.5s) - No audio received!
2025-12-29T21:39:18.314387666Z [err]  2025-12-29 21:39:18,310 - persistent_tts_service - WARNING - âš ï¸ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Receiver got 0 chunks for sentence #2! interrupted=False
2025-12-29T21:39:18.314394123Z [err]  2025-12-29 21:39:18,310 - persistent_tts_service - INFO - ğŸ§ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Receiver processing sentence #3: 'You there?...'
2025-12-29T21:39:18.314401688Z [err]  2025-12-29 21:39:18,310 - persistent_tts_service - INFO - ğŸ“Š [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] DIAGNOSTIC: queue_latency=5143ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-29T21:39:19.097170855Z [err]  2025-12-29 21:39:18,819 - server - INFO - ğŸ¤ Soniox receiver alive - 13 messages received in last 10s
2025-12-29T21:39:19.097179470Z [err]  2025-12-29 21:39:18,963 - server - INFO - ğŸ“ Telnyx WebSocket disconnected. Sent 580 total packets
2025-12-29T21:39:19.097193729Z [err]  [2025-12-29 21:39:18 +0000] [5] [INFO] connection closed
2025-12-29T21:39:19.139716580Z [err]  2025-12-29 21:39:19,130 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:19.139723809Z [err]  2025-12-29 21:39:19,130 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'streaming.stopped', 'id': 'fdf17a0a-a69a-4b37-8b09-49c82455a3d9', 'occurred_at': '2025-12-29T21:39:18.834915Z', 'payload': {'call_control_id': 'v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'call_leg_id': 'cafa9c68-e4fe-11f0-a9ae-02420aef98a0', 'call_session_id': 'caf76912-e4fe-11f0-a394-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': 'b31af26b-88ce-42a8-9374-168b54ce870e', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:19.139731501Z [err]  2025-12-29 21:39:19,131 - server - INFO - ğŸ¯ Event type: streaming.stopped, Call ID: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:19.139739549Z [err]  2025-12-29 21:39:19,131 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:19.139747399Z [inf]  100.64.0.15:12706 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:19.223667843Z [err]  2025-12-29 21:39:19,221 - server - INFO - âœ… Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T21:39:19.223671249Z [err]  2025-12-29 21:39:19,218 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:19.223680576Z [err]  2025-12-29 21:39:19,218 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'b56816bb-1215-4541-8db1-6f95f52f935d', 'occurred_at': '2025-12-29T21:39:18.723971Z', 'payload': {'call_control_id': 'v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'call_leg_id': 'cafa9c68-e4fe-11f0-a9ae-02420aef98a0', 'call_session_id': 'caf76912-e4fe-11f0-a394-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:18.723971Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'Wc5eOpK9Xg', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:19.223687336Z [err]  2025-12-29 21:39:19,218 - server - INFO - ğŸ¯ Event type: call.playback.ended, Call ID: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:19.223694168Z [err]  2025-12-29 21:39:19,218 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:19.223700736Z [err]  2025-12-29 21:39:19,220 - redis_service - INFO - â– Removed playback Wc5eOpK9Xg, 0 remaining for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:19.223706449Z [err]  2025-12-29 21:39:19,220 - server - INFO - ğŸ”Š Redis: Removed playback Wc5eOpK9Xg, 0 remaining
2025-12-29T21:39:19.223712585Z [err]  2025-12-29 21:39:19,220 - server - INFO - ğŸ”Š ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T21:39:19.223720260Z [err]  2025-12-29 21:39:19,220 - server - INFO - â±ï¸ CLEARED playback_expected_end_time - agent is definitely done speaking
2025-12-29T21:39:19.225945879Z [err]  2025-12-29 21:39:19,221 - server - INFO - âœ… Found session locally: agent_speaking=False, user_speaking=False
2025-12-29T21:39:19.225952015Z [err]  2025-12-29 21:39:19,221 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044359.2217927 for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:19.225957234Z [err]  2025-12-29 21:39:19,221 - server - INFO - â±ï¸ Silence timer STARTED (local, agent wasn't marked as speaking)
2025-12-29T21:39:19.225966972Z [inf]  100.64.0.16:48750 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:19.283049129Z [err]  2025-12-29 21:39:19,278 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:19.283058811Z [err]  2025-12-29 21:39:19,278 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.hangup', 'id': '21c73cb3-e29e-48ff-a2b2-8f63bbd5e485', 'occurred_at': '2025-12-29T21:39:18.643964Z', 'payload': {'call_control_id': 'v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'call_leg_id': 'cafa9c68-e4fe-11f0-a9ae-02420aef98a0', 'call_quality_stats': {'inbound': {'jitter_max_variance': '11.49', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '609', 'skip_packet_count': '20'}, 'outbound': {'packet_count': '583', 'skip_packet_count': '0'}}, 'call_session_id': 'caf76912-e4fe-11f0-a394-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:18.643964Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-29T21:39:02.963973Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:19.283065198Z [err]  2025-12-29 21:39:19,278 - server - INFO - ğŸ¯ Event type: call.hangup, Call ID: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:19.283075482Z [err]  2025-12-29 21:39:19,278 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:19.283079584Z [err]  2025-12-29 21:39:19,278 - server - INFO - ğŸ“ Call ended: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:19.283084106Z [err]  2025-12-29 21:39:19,278 - server - INFO - ğŸ“ Hangup cause: normal_clearing
2025-12-29T21:39:19.463490533Z [err]  2025-12-29 21:39:19,461 - server - INFO - ğŸ“ Updated call log: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:19.559708519Z [err]  2025-12-29 21:39:19,553 - server - INFO - âœ… Finalized call log: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ (duration=12s, status=completed)
2025-12-29T21:39:20.089678937Z [err]  2025-12-29 21:39:19,645 - server - INFO - ğŸ“¦ Saved 11 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-29T21:39:20.089684005Z [err]  2025-12-29 21:39:19,750 - server - INFO - ğŸ¤ Soniox receiver alive - 1 messages received in last 10s
2025-12-29T21:39:20.089691040Z [err]  2025-12-29 21:39:19,750 - server - ERROR - âŒ Soniox error: {'tokens': [], 'final_audio_proc_ms': 5520, 'total_audio_proc_ms': 11040, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-29T21:39:20.089696806Z [err]  2025-12-29 21:39:19,750 - server - INFO - âœ… Soniox receive loop ended normally
2025-12-29T21:39:20.089705320Z [err]  2025-12-29 21:39:19,750 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring cancelled for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:20.089711619Z [err]  2025-12-29 21:39:19,750 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring stopped for call v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg
2025-12-29T21:39:20.089717275Z [err]  2025-12-29 21:39:19,750 - server - INFO - ğŸ”‡ Dead air monitoring task cancelled
2025-12-29T21:39:20.089722144Z [err]  2025-12-29 21:39:20,064 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=0.8s, checkin_count=0/2
2025-12-29T21:39:20.345031136Z [err]  2025-12-29 21:39:20,341 - server - INFO - ğŸ“Š Auto-added call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-29T21:39:20.569025023Z [err]  2025-12-29 21:39:20,566 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=1.3s, checkin_count=0/2
2025-12-29T21:39:20.610817460Z [err]  2025-12-29 21:39:20,604 - server - INFO - ğŸ“¤ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:39:20.610825070Z [err]  2025-12-29 21:39:20,605 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:20.610830075Z [err]  2025-12-29 21:39:20,606 - server - INFO - ğŸ“‡ [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-29T21:39:20.610835702Z [err]  2025-12-29 21:39:20,606 - server - INFO - ğŸ“‡ [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-29T21:39:21.184879369Z [err]  2025-12-29 21:39:20,699 - server - INFO - ğŸ“‡ [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-29T21:39:21.184880733Z [err]  2025-12-29 21:39:20,786 - server - INFO - ğŸ§¹ Cleaned up call session from Redis and memory: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.184885675Z [err]  2025-12-29 21:39:20,785 - server - INFO - ğŸ“‡ [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-29T21:39:21.184890788Z [inf]  100.64.0.15:12706 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:21.184891594Z [err]  2025-12-29 21:39:20,785 - server - INFO - ğŸ“‡ [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-29T21:39:21.184897665Z [err]  2025-12-29 21:39:20,785 - server - INFO - ğŸ“‡ [HANGUP] Agent info keys: None
2025-12-29T21:39:21.184899739Z [err]  2025-12-29 21:39:20,787 - server - INFO - ğŸ” Starting QC analysis for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.184903042Z [err]  2025-12-29 21:39:20,785 - server - INFO - ğŸš€ Triggered QC analysis for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.184908334Z [err]  2025-12-29 21:39:20,785 - server - INFO - ğŸ“Š Triggered Campaign QC for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.184913846Z [err]  2025-12-29 21:39:20,785 - server - INFO - ğŸ“‡ Triggered CRM update for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.184918706Z [err]  2025-12-29 21:39:20,785 - server - INFO - âœ… Closed persistent TTS session for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.184923222Z [err]  2025-12-29 21:39:20,786 - redis_service - INFO - ğŸ§¹ Deleted call data from Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.187259262Z [err]  2025-12-29 21:39:20,787 - server - INFO - ğŸ” [AUTO-QC] Starting campaign QC check for call=v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-29T21:39:21.187268918Z [err]  2025-12-29 21:39:20,787 - server - INFO - ğŸ“‡ CRM update starting for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:21.187277235Z [err]  2025-12-29 21:39:20,787 - server - INFO - ğŸ“‡ Normalized phone: +17708336397
2025-12-29T21:39:21.187286683Z [err]  2025-12-29 21:39:20,787 - server - INFO - ğŸ“‡ CRM: Got 11 variables from active session
2025-12-29T21:39:21.187299580Z [err]  2025-12-29 21:39:20,795 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:21.187309013Z [err]  2025-12-29 21:39:20,795 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '9fff5c2c-a172-44eb-857b-9c62273349e9', 'occurred_at': '2025-12-29T21:39:20.276817Z', 'payload': {'call_control_id': 'v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'call_leg_id': 'cafa9c68-e4fe-11f0-a9ae-02420aef98a0', 'call_session_id': 'caf76912-e4fe-11f0-a394-02420aef98a0', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:18.734745Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-29T21:39:18.734745Z', 'recording_id': '37490784-2204-4c50-992a-1a159ff78fb8', 'recording_started_at': '2025-12-29T21:39:07.749997Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/cafa9c68-e4fe-11f0-a9ae-02420aef98a0-1767044347724393.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T213920Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=0fd5717981d65c42b3d4cb57cb3cbc8cfa8cd419e11f3c54267a9a83480d5cb3'}, 'start_time': '2025-12-29T21:39:07.749997Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:21.187453720Z [err]  2025-12-29 21:39:20,976 - server - INFO - ğŸ” [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-29T21:39:21.187461101Z [err]  2025-12-29 21:39:21,002 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:39:21.187467903Z [err]  2025-12-29 21:39:20,795 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:21.187474349Z [err]  2025-12-29 21:39:20,796 - server - INFO - ğŸ” Recording check: download_url=True, channels=dual, recording_id=37490784-2204-4c50-992a-1a159ff78fb8, call_data=False
2025-12-29T21:39:21.187480009Z [err]  2025-12-29 21:39:20,795 - server - INFO - ğŸ™ï¸ Recording saved for call: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.187489215Z [err]  2025-12-29 21:39:20,810 - elevenlabs_ws_service - WARNING - âš ï¸  [TIMING] ElevenLabs timeout waiting for first chunk (2.5s) - No audio received!
2025-12-29T21:39:21.187497429Z [err]  2025-12-29 21:39:20,796 - redis_service - WARNING - âš ï¸ Call data not found in Redis: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.187498708Z [err]  2025-12-29 21:39:20,795 - server - INFO - ğŸ¯ Event type: call.recording.saved, Call ID: v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.187504992Z [err]  2025-12-29 21:39:20,811 - persistent_tts_service - WARNING - âš ï¸ [Call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ] Receiver got 0 chunks for sentence #3! interrupted=False
2025-12-29T21:39:21.187518571Z [err]  2025-12-29 21:39:20,877 - server - INFO - ğŸ“ Converted transcript from 3 messages to 97 characters
2025-12-29T21:39:21.187528303Z [err]  2025-12-29 21:39:20,878 - server - INFO - ğŸ” [AUTO-QC] Call log found: transcript_turns=3, logs_count=4, status=completed
2025-12-29T21:39:21.187535634Z [err]  2025-12-29 21:39:20,972 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:21.191744280Z [err]  2025-12-29 21:39:21,003 - server - INFO - âœ… Post-call webhook sent successfully (status=200)
2025-12-29T21:39:21.191755184Z [err]  2025-12-29 21:39:21,057 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-29T21:39:21.191763336Z [err]  2025-12-29 21:39:21,063 - server - INFO - ğŸ“Š [AUTO-QC] Running full QC analysis: call=v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ â†’ campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-29T21:39:21.191771880Z [err]  2025-12-29 21:39:21,063 - server - INFO - ğŸ“Š [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-29T21:39:21.191778872Z [err]  2025-12-29 21:39:21,063 - server - ERROR - âŒ [AUTO-QC] Error in campaign QC for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:39:21.191785845Z [err]  2025-12-29 21:39:21,063 - server - ERROR - âŒ [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-29T21:39:21.191792958Z [err]    File "/app/backend/server.py", line 9773, in trigger_campaign_qc_for_call
2025-12-29T21:39:21.191798360Z [err]      await run_full_qc_analysis(
2025-12-29T21:39:21.191804675Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-29T21:39:21.191810298Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:39:21.191815206Z [err]  
2025-12-29T21:39:21.191820386Z [err]  2025-12-29 21:39:21,142 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-29T21:39:21.191826789Z [err]  2025-12-29 21:39:21,143 - qc_agents.orchestrator - INFO - âœ… Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:21.191831907Z [err]  2025-12-29 21:39:21,143 - qc_agents.orchestrator - INFO - ğŸ” Running Commitment Detector on call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.330092076Z [err]  2025-12-29 21:39:21,328 - server - INFO - ğŸŒ Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T21:39:21.337847629Z [err]  2025-12-29 21:39:21,335 - server - INFO - ğŸ“‡ CRM: Got 11 extracted variables
2025-12-29T21:39:21.337864340Z [err]  2025-12-29 21:39:21,336 - server - INFO - ğŸ“‡ CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-29T21:39:21.345333708Z [err]  2025-12-29 21:39:21,342 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:39:21.345340960Z [err]  2025-12-29 21:39:21,343 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:21.345346102Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:21.345350637Z [err]  2025-12-29 21:39:21,343 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:21.345354879Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:39:21.348124722Z [err]  2025-12-29 21:39:21,345 - qc_agents.orchestrator - INFO - ğŸ—ºï¸  Running Conversion Pathfinder on call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:21.363945027Z [err]  2025-12-29 21:39:21,356 - server - INFO - ğŸ’¾ Saved recording URL and ID to database: 37490784-2204-4c50-992a-1a159ff78fb8
2025-12-29T21:39:21.363960238Z [err]  2025-12-29 21:39:21,356 - server - INFO - âœ… Entering dual-channel processing
2025-12-29T21:39:21.363968688Z [err]  2025-12-29 21:39:21,356 - server - INFO - ğŸ“¥ Downloading DUAL-CHANNEL recording...
2025-12-29T21:39:21.418086242Z [err]  2025-12-29 21:39:21,414 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:21.502866007Z [err]  2025-12-29 21:39:21,500 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:21.512981995Z [err]  2025-12-29 21:39:21,510 - server - INFO - ğŸ“‡ CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-29T21:39:21.530720246Z [err]  2025-12-29 21:39:21,526 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:21.530726710Z [err]  2025-12-29 21:39:21,527 - telnyx_service - INFO - ğŸ“ Initiating outbound call from +14048000152 to +17708336397
2025-12-29T21:39:21.530737829Z [err]  2025-12-29 21:39:21,527 - telnyx_service - INFO - ğŸ¤– Enabling AMD (premium mode)
2025-12-29T21:39:21.530741843Z [err]  2025-12-29 21:39:21,527 - telnyx_service - INFO - ğŸŒ Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T21:39:22.111465386Z [err]  2025-12-29 21:39:21,654 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/cafa9c68-e4fe-11f0-a9ae-02420aef98a0-1767044347724393.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T213920Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=0fd5717981d65c42b3d4cb57cb3cbc8cfa8cd419e11f3c54267a9a83480d5cb3 "HTTP/1.1 200 OK"
2025-12-29T21:39:22.111469676Z [err]  2025-12-29 21:39:21,740 - server - INFO - âœ… Downloaded 44346 bytes
2025-12-29T21:39:22.111474172Z [err]  2025-12-29 21:39:21,935 - server - INFO - âœ… Split into 2 channels
2025-12-29T21:39:22.111478142Z [err]  2025-12-29 21:39:21,935 - server - INFO - ğŸ¤ Using STT provider: soniox for interruption detection
2025-12-29T21:39:22.111482460Z [err]  2025-12-29 21:39:21,935 - server - INFO - ğŸ“Š Channel 0: 240284 bytes
2025-12-29T21:39:22.111486563Z [err]  2025-12-29 21:39:21,936 - server - ERROR - âŒ No Soniox API key available
2025-12-29T21:39:22.111490349Z [err]  2025-12-29 21:39:21,936 - server - INFO - âŒ Channel 0: No speech
2025-12-29T21:39:22.111494425Z [err]  2025-12-29 21:39:21,936 - server - INFO - ğŸ“Š Channel 1: 240284 bytes
2025-12-29T21:39:22.111498802Z [err]  2025-12-29 21:39:21,936 - server - ERROR - âŒ No Soniox API key available
2025-12-29T21:39:22.111503308Z [err]  2025-12-29 21:39:21,936 - server - INFO - âŒ Channel 1: No speech
2025-12-29T21:39:22.111508190Z [err]  2025-12-29 21:39:21,936 - server - WARNING - âš ï¸ No speech in any channel
2025-12-29T21:39:22.111512077Z [inf]  100.64.0.5:37176 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:22.111516909Z [err]  2025-12-29 21:39:21,936 - soniox_service - ERROR - âŒ Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-29T21:39:22.111526162Z [err]  2025-12-29 21:39:21,936 - server - INFO - ğŸ”Œ Telnyx WebSocket disconnected
2025-12-29T21:39:22.218124545Z [err]  2025-12-29 21:39:22,214 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:22.218132095Z [err]  2025-12-29 21:39:22,214 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.initiated', 'id': '3dc7ab80-7388-490d-bc57-8e7262a4c78e', 'occurred_at': '2025-12-29T21:39:22.015963Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:22.218137355Z [err]  2025-12-29 21:39:22,214 - server - INFO - ğŸ¯ Event type: call.initiated, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:22.218143607Z [err]  2025-12-29 21:39:22,214 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:22.218148566Z [err]  2025-12-29 21:39:22,214 - server - INFO - ğŸ“ Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-29T21:39:22.218153169Z [inf]  100.64.0.15:12706 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:22.273495581Z [err]  2025-12-29 21:39:22,269 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-29T21:39:22.276511728Z [err]  2025-12-29 21:39:22,273 - telnyx_service - INFO - âœ… Call initiated: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:22.290234859Z [err]  2025-12-29 21:39:22,284 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:39:22.290248026Z [err]  2025-12-29 21:39:22,284 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:22.290254205Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:22.290259531Z [err]  2025-12-29 21:39:22,284 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:22.290264488Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:39:22.290270229Z [err]  2025-12-29 21:39:22,285 - qc_agents.orchestrator - INFO - â­ Running Excellence Replicator on call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:22.363855206Z [err]  2025-12-29 21:39:22,361 - server - INFO - ğŸ“ Created call log: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:22.363862582Z [err]  2025-12-29 21:39:22,361 - server - INFO - ğŸ” DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:39:22.363867375Z [err]  2025-12-29 21:39:22,361 - server - INFO - ğŸ” DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-29T21:39:22.365271643Z [err]  2025-12-29 21:39:22,361 - server - INFO - ğŸ” DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:39:22.365277719Z [err]  2025-12-29 21:39:22,362 - server - INFO - ğŸ“¤ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:39:22.375243603Z [err]  2025-12-29 21:39:22,369 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (TTL: 3600s)
2025-12-29T21:39:22.375250362Z [err]  2025-12-29 21:39:22,369 - server - INFO - ğŸ“¦ Call data stored in Redis and memory
2025-12-29T21:39:22.375254424Z [err]  2025-12-29 21:39:22,369 - server - INFO - ğŸ“ Outbound call initiated: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:22.375258243Z [inf]  100.64.0.6:14798 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-29T21:39:22.482610853Z [err]  2025-12-29 21:39:22,475 - server - INFO - ğŸ”ŒğŸ”ŒğŸ”Œ WEBSOCKET CONNECTION ATTEMPT
2025-12-29T21:39:22.482622067Z [err]  2025-12-29 21:39:22,475 - server - INFO -    Client: Address(host='100.64.0.16', port=48758)
2025-12-29T21:39:22.482629626Z [err]  2025-12-29 21:39:22,475 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'j+DCQTUpn+zyFCcAoGebVA==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'D8B1DpP9QGuHBakH-_9nXA', 'x-real-ip': '192.76.120.151', 'x-request-start': '1767044362193', 'accept-encoding': 'gzip'}
2025-12-29T21:39:22.482636532Z [err]  2025-12-29 21:39:22,475 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-29T21:39:22.482643575Z [err]  2025-12-29 21:39:22,475 - server - INFO - ğŸ”Œ Incoming Telnyx WebSocket connection
2025-12-29T21:39:22.482652786Z [err]  [2025-12-29 21:39:22 +0000] [5] [INFO] ('100.64.0.16', 48758) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-29T21:39:22.482658924Z [err]  2025-12-29 21:39:22,476 - server - INFO - âœ… WebSocket accepted, waiting for Telnyx events
2025-12-29T21:39:22.482665075Z [err]  [2025-12-29 21:39:22 +0000] [5] [INFO] connection open
2025-12-29T21:39:22.543868611Z [err]  2025-12-29 21:39:22,537 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:39:22.543879580Z [err]  2025-12-29 21:39:22,538 - server - INFO - âœ… Call-initiated webhook sent successfully (status=200)
2025-12-29T21:39:23.124705203Z [err]  2025-12-29 21:39:22,627 - server - INFO - ğŸ“¬ Received Telnyx event: connected
2025-12-29T21:39:23.124715334Z [err]  2025-12-29 21:39:22,627 - server - INFO - ğŸ“ Telnyx connected event received, waiting for 'start'...
2025-12-29T21:39:23.124734589Z [err]  2025-12-29 21:39:22,974 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:39:23.124742054Z [err]  2025-12-29 21:39:22,974 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:23.124750697Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:23.124758595Z [err]  2025-12-29 21:39:22,974 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:23.124789280Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:23.124798405Z [err]  2025-12-29 21:39:23,063 - qc_agents.orchestrator - INFO - âœ… QC analysis stored for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:23.124804833Z [err]  2025-12-29 21:39:23,063 - server - INFO - âœ… QC analysis completed for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:23.124811905Z [err]  2025-12-29 21:39:23,063 - server - INFO - ğŸ“Š Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-29T21:39:23.252079988Z [err]  2025-12-29 21:39:23,243 - server - INFO - ğŸ“Š Updated campaign_calls with QC scores for v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:23.424173178Z [err]  2025-12-29 21:39:23,417 - server - INFO - ğŸ“ˆ Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-29T21:39:23.505557449Z [err]  2025-12-29 21:39:23,503 - server - INFO - ğŸ·ï¸ Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-29T21:39:23.505568446Z [err]  2025-12-29 21:39:23,503 - server - ERROR - âŒ Error in auto appointment detection for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ: 'str' object has no attribute 'get'
2025-12-29T21:39:25.186474685Z [err]  2025-12-29 21:39:25,181 - server - INFO - ğŸ“¬ Received Telnyx event: start
2025-12-29T21:39:25.186484261Z [err]  2025-12-29 21:39:25,181 - server - INFO - ğŸ¬ Stream started for call: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:25.190102337Z [err]  2025-12-29 21:39:25,185 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:25.190111406Z [err]  2025-12-29 21:39:25,187 - server - INFO - âœ… Call data found after 0s wait
2025-12-29T21:39:25.190116465Z [err]  2025-12-29 21:39:25,187 - server - INFO - â³ Session not found locally, waiting briefly for webhook...
2025-12-29T21:39:25.348356306Z [err]  2025-12-29 21:39:25,344 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:25.348368142Z [err]  2025-12-29 21:39:25,344 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.answered', 'id': 'aacc225d-a70b-4c95-8422-8e06ee283abd', 'occurred_at': '2025-12-29T21:39:24.795970Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-29T21:39:22.015963Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:25.348377013Z [err]  2025-12-29 21:39:25,344 - server - INFO - ğŸ¯ Event type: call.answered, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:25.348383665Z [err]  2025-12-29 21:39:25,344 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:25.348389369Z [err]  2025-12-29 21:39:25,344 - server - INFO - âœ… Call answered: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:25.351924309Z [err]  2025-12-29 21:39:25,349 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:25.354714318Z [err]  2025-12-29 21:39:25,350 - server - INFO - âœ… Found call in Redis (multi-worker state sharing working)
2025-12-29T21:39:25.354730984Z [err]  2025-12-29 21:39:25,350 - server - INFO - ğŸ“ Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-29T21:39:25.455965023Z [err]  2025-12-29 21:39:25,452 - server - INFO - âœ… Call log updated
2025-12-29T21:39:25.455976017Z [err]  2025-12-29 21:39:25,452 - server - INFO - ğŸ” DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:39:25.455982940Z [err]  2025-12-29 21:39:25,452 - server - INFO - ğŸ“¤ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:39:25.455988100Z [err]  2025-12-29 21:39:25,453 - server - INFO - ğŸ”§ Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:25.543187042Z [err]  2025-12-29 21:39:25,539 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:26.171810775Z [err]  2025-12-29 21:39:25,625 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:26.171865840Z [err]  2025-12-29 21:39:25,692 - server - INFO - ğŸ“ Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:26.171878537Z [err]  2025-12-29 21:39:25,692 - core_calling_service - INFO - ğŸ” Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T21:39:26.171886134Z [err]  2025-12-29 21:39:25,779 - core_calling_service - INFO - ğŸ” KB count query completed: 4 items
2025-12-29T21:39:26.171913374Z [err]  2025-12-29 21:39:25,625 - server - INFO - ğŸ”§ Creating Telnyx service with user's keys...
2025-12-29T21:39:26.171924703Z [err]  2025-12-29 21:39:25,655 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:26.171927420Z [err]  2025-12-29 21:39:25,780 - core_calling_service - INFO - ğŸ“š Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T21:39:26.171936064Z [err]  2025-12-29 21:39:25,688 - server - INFO - âš ï¸ Session still not found after wait, will create in worker
2025-12-29T21:39:26.171937587Z [err]  2025-12-29 21:39:25,780 - core_calling_service - INFO - ğŸ“‹ Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T21:39:26.171948314Z [err]  2025-12-29 21:39:25,688 - server - WARNING - âš ï¸ Session not found after waiting, creating in WebSocket worker...
2025-12-29T21:39:26.171949742Z [err]  2025-12-29 21:39:25,780 - core_calling_service - INFO - ğŸ“š KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T21:39:26.171958707Z [err]  2025-12-29 21:39:25,691 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:26.171982327Z [err]  2025-12-29 21:39:25,780 - core_calling_service - INFO - ğŸ”¥ Pre-warming LLM client (grok)...
2025-12-29T21:39:26.175082119Z [err]  2025-12-29 21:39:25,839 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:39:26.175086430Z [err]  2025-12-29 21:39:25,839 - server - INFO - âœ… Call-started webhook sent successfully (status=200)
2025-12-29T21:39:26.175090605Z [err]  2025-12-29 21:39:25,859 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-29T21:39:26.175094186Z [err]  2025-12-29 21:39:25,860 - telnyx_service - INFO - âœ… Playing audio from URL, playback_id: 2r9zR7I2TQ (loop=True, overlay=True)
2025-12-29T21:39:26.175098024Z [err]  2025-12-29 21:39:25,860 - server - WARNING - âš ï¸ Failed to start comfort noise: 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'
2025-12-29T21:39:26.175101630Z [err]  2025-12-29 21:39:25,860 - telnyx_service - INFO - ğŸ™ï¸ Starting recording: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:26.175106874Z [err]  2025-12-29 21:39:25,866 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:26.175111416Z [err]  2025-12-29 21:39:25,876 - core_calling_service - INFO - âœ… LLM client pre-warmed in 95ms
2025-12-29T21:39:26.175115190Z [err]  2025-12-29 21:39:25,876 - server - INFO - âœ… Session created in WebSocket worker
2025-12-29T21:39:26.175119288Z [err]  2025-12-29 21:39:25,876 - server - INFO - â±ï¸ [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-29T21:39:26.175123164Z [err]  2025-12-29 21:39:25,876 - server - INFO - â±ï¸ [WebSocket Worker] Silence timeout task scheduled!
2025-12-29T21:39:26.175128216Z [err]  2025-12-29 21:39:25,876 - server - INFO - ğŸ“ Call data loaded, starting SONIOX connection...
2025-12-29T21:39:26.175134056Z [err]  2025-12-29 21:39:25,876 - server - INFO - âœ… Initialized call_states for v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA with session reference
2025-12-29T21:39:26.176871112Z [err]  2025-12-29 21:39:25,876 - server - INFO - âœ… Stored Telnyx WebSocket in call_data for audio streaming
2025-12-29T21:39:26.176886564Z [err]  2025-12-29 21:39:25,876 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found to update for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:26.176895933Z [err]  2025-12-29 21:39:25,878 - server - INFO - â±ï¸ [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-29T21:39:26.176908247Z [err]  2025-12-29 21:39:25,925 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:26.176917747Z [err]  2025-12-29 21:39:25,925 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'streaming.started', 'id': 'df3e64d7-7280-4d3c-b13c-ed0970d7520d', 'occurred_at': '2025-12-29T21:39:25.355972Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '7559e05e-7071-4515-aa1e-73d3ce291eb2', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:26.176928512Z [err]  2025-12-29 21:39:25,925 - server - INFO - ğŸ¯ Event type: streaming.started, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:26.176937797Z [err]  2025-12-29 21:39:25,925 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:26.176947334Z [inf]  100.64.0.18:37270 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:26.176962068Z [err]  2025-12-29 21:39:25,964 - server - INFO - ğŸ”‘ Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-29T21:39:26.292330993Z [err]  2025-12-29 21:39:26,290 - core_calling_service - INFO - â° Check-in triggered after 7.1s silence (threshold: 7s)
2025-12-29T21:39:26.295343544Z [err]  2025-12-29 21:39:26,291 - core_calling_service - INFO - ğŸ’¬ Sending check-in #1/2: Are you still there?
2025-12-29T21:39:26.295353665Z [err]  2025-12-29 21:39:26,291 - dead_air_monitor - INFO - ğŸ’¬ Sending check-in after 7.1s silence: Are you still there?
2025-12-29T21:39:26.295360331Z [err]  2025-12-29 21:39:26,291 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:26.295367804Z [err]  2025-12-29 21:39:26,291 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ: Are you still there?...
2025-12-29T21:39:26.295373955Z [err]  2025-12-29 21:39:26,291 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-29T21:39:26.295383265Z [err]  2025-12-29 21:39:26,291 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-29T21:39:26.295390108Z [err]  2025-12-29 21:39:26,291 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-29T21:39:26.295396976Z [err]  2025-12-29 21:39:26,291 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-29T21:39:26.295403261Z [err]  2025-12-29 21:39:26,291 - server - INFO - â±ï¸ [21:39:26.291] ğŸ”Š TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-29T21:39:26.295409728Z [err]  2025-12-29 21:39:26,291 - server - INFO - âš¡ Using Turbo v2.5 (high quality)
2025-12-29T21:39:26.295416267Z [err]  2025-12-29 21:39:26,291 - server - INFO - ğŸ™ï¸ ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-29T21:39:26.379863080Z [err]  2025-12-29 21:39:26,376 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:26.379877732Z [err]  2025-12-29 21:39:26,377 - server - INFO - ğŸ“¦ ElevenLabs Request Payload:
2025-12-29T21:39:26.379886428Z [err]  2025-12-29 21:39:26,377 - server - INFO -    Text length: 20 chars
2025-12-29T21:39:26.379897825Z [err]  2025-12-29 21:39:26,377 - server - INFO -    Text content: 'Are you still there?'
2025-12-29T21:39:26.379906020Z [err]  2025-12-29 21:39:26,377 - server - INFO -    Text bytes: b'Are you still there?'
2025-12-29T21:39:26.379913614Z [err]  2025-12-29 21:39:26,377 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-29T21:39:26.379921915Z [err]  2025-12-29 21:39:26,377 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-29T21:39:26.379928237Z [err]  2025-12-29 21:39:26,377 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-29T21:39:26.379935161Z [err]  2025-12-29 21:39:26,377 - server - INFO -    Full data: {'text': 'Are you still there?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-29T21:39:26.379943260Z [err]  2025-12-29 21:39:26,377 - server - INFO - ğŸ”Œ Attempting ElevenLabs connection (attempt 1/2)
2025-12-29T21:39:26.379949730Z [err]  2025-12-29 21:39:26,377 - server - INFO -    Timeout: 10.0s
2025-12-29T21:39:26.388235524Z [err]  2025-12-29 21:39:26,385 - server - INFO -    âœ“ HTTP client created (0.008s)
2025-12-29T21:39:26.388245429Z [err]  2025-12-29 21:39:26,385 - server - INFO -    â†’ Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-29T21:39:26.435499040Z [err]  2025-12-29 21:39:26,432 - soniox_service - INFO - âœ… Connected to Soniox Real-Time STT
2025-12-29T21:39:26.435509832Z [err]  2025-12-29 21:39:26,432 - soniox_service - INFO - âš™ï¸  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-29T21:39:26.435517481Z [err]  2025-12-29 21:39:26,432 - soniox_service - INFO - âš™ï¸  Endpoint detection: True, Speaker diarization: False
2025-12-29T21:39:26.435524427Z [err]  2025-12-29 21:39:26,433 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring started for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:26.438432990Z [err]  2025-12-29 21:39:26,434 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:26.438441454Z [err]  2025-12-29 21:39:26,434 - server - INFO - âœ… Started forwarding audio (8kHz mulaw â†’ Soniox, NO BUFFERING)
2025-12-29T21:39:27.213153800Z [err]  2025-12-29 21:39:26,750 - server - INFO - ğŸ’¾ TTS CACHED: elevenlabs:Are you still there?... (17599 bytes)
2025-12-29T21:39:27.213163917Z [err]  2025-12-29 21:39:26,750 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.46s
2025-12-29T21:39:27.213175192Z [err]  2025-12-29 21:39:26,750 - telnyx_service - INFO - âœ… Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:27.213316865Z [err]  2025-12-29 21:39:26,735 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-29T21:39:27.213327428Z [err]  2025-12-29 21:39:26,735 - server - INFO -    âœ“ Connection established (0.359s) [TARGET: <200ms]
2025-12-29T21:39:27.213335041Z [err]  2025-12-29 21:39:26,735 - server - INFO -    âœ“ Response status: 200
2025-12-29T21:39:27.213343422Z [err]  2025-12-29 21:39:26,735 - server - INFO -    â†’ Streaming audio chunks...
2025-12-29T21:39:27.213354320Z [err]  2025-12-29 21:39:26,747 - server - INFO -    âœ“ FIRST CHUNK received (0.370s, 927 bytes) [TARGET: <300ms]
2025-12-29T21:39:27.213361460Z [err]  2025-12-29 21:39:26,749 - server - INFO -    âœ“ ALL CHUNKS received: 59 chunks (0.373s)
2025-12-29T21:39:27.213369206Z [err]  2025-12-29 21:39:26,749 - server - INFO -    âœ“ Total audio size: 17599 bytes
2025-12-29T21:39:27.213376785Z [err]  2025-12-29 21:39:26,749 - server - INFO -    ğŸ“Š TTS API TIMING BREAKDOWN:
2025-12-29T21:39:27.213385318Z [err]  2025-12-29 21:39:26,749 - server - INFO -       - Connection: 359ms
2025-12-29T21:39:27.213393390Z [err]  2025-12-29 21:39:26,750 - server - INFO -       - First chunk: 370ms
2025-12-29T21:39:27.213400412Z [err]  2025-12-29 21:39:26,750 - server - INFO -       - All chunks: 373ms
2025-12-29T21:39:27.213406288Z [err]  2025-12-29 21:39:26,750 - server - INFO -       - Audio generation only: 11ms
2025-12-29T21:39:27.213411583Z [err]  2025-12-29 21:39:26,750 - server - INFO - â±ï¸ [21:39:26.750] ğŸ”Š TTS COMPLETE: 458ms, audio_size=17599 bytes
2025-12-29T21:39:27.219045966Z [err]  2025-12-29 21:39:26,750 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:27.219063255Z [inf]  100.64.0.13:23294 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-29T21:39:27.219071299Z [err]  2025-12-29 21:39:26,935 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:27.219078977Z [err]  2025-12-29 21:39:27,030 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:27.219085506Z [err]  2025-12-29 21:39:27,031 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.28s
2025-12-29T21:39:27.219199647Z [err]  2025-12-29 21:39:27,031 - telnyx_service - ERROR - âŒ Telnyx playback failed: 422 - {
2025-12-29T21:39:27.219208310Z [err]    "errors": [
2025-12-29T21:39:27.219215631Z [err]      {
2025-12-29T21:39:27.219223847Z [err]        "code": "90018",
2025-12-29T21:39:27.219230349Z [err]        "title": "Call has already ended",
2025-12-29T21:39:27.219236114Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:39:27.219241691Z [err]      }
2025-12-29T21:39:27.219259537Z [err]    ]
2025-12-29T21:39:27.219266026Z [err]  }
2025-12-29T21:39:27.219271576Z [err]  2025-12-29 21:39:27,031 - telnyx_service - INFO - ğŸ“¢ Using Telnyx built-in TTS
2025-12-29T21:39:27.227984789Z [err]  2025-12-29 21:39:27,225 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:27.230631276Z [err]  2025-12-29 21:39:27,226 - telnyx_service - ERROR - âŒ Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:39:27.230638891Z [err]  2025-12-29 21:39:27,226 - dead_air_monitor - INFO - âœ… Check-in message sent
2025-12-29T21:39:27.257461365Z [err]  2025-12-29 21:39:27,253 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA/actions/record_start "HTTP/1.1 200 OK"
2025-12-29T21:39:27.257467562Z [err]  2025-12-29 21:39:27,254 - server - INFO - ğŸ™ï¸ Call recording started for v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:27.257473327Z [err]  2025-12-29 21:39:27,254 - server - INFO - ğŸ”§ Creating call session for v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA...
2025-12-29T21:39:27.257480348Z [err]  2025-12-29 21:39:27,254 - server - INFO - ğŸ” Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:27.257485105Z [err]  2025-12-29 21:39:27,254 - server - INFO - ğŸ”§ Calling create_call_session() - START
2025-12-29T21:39:27.257491119Z [err]  2025-12-29 21:39:27,254 - core_calling_service - INFO - ğŸ” Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T21:39:27.344780122Z [err]  2025-12-29 21:39:27,341 - core_calling_service - INFO - ğŸ” KB count query completed: 4 items
2025-12-29T21:39:27.344805569Z [err]  2025-12-29 21:39:27,341 - core_calling_service - INFO - ğŸ“š Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T21:39:27.344822022Z [err]  2025-12-29 21:39:27,341 - core_calling_service - INFO - ğŸ“‹ Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T21:39:27.344830138Z [err]  2025-12-29 21:39:27,341 - core_calling_service - INFO - ğŸ“š KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T21:39:27.344837349Z [err]  2025-12-29 21:39:27,341 - core_calling_service - INFO - ğŸ”¥ Pre-warming LLM client (grok)...
2025-12-29T21:39:27.431338557Z [err]  2025-12-29 21:39:27,427 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:27.441598558Z [err]  2025-12-29 21:39:27,437 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:27.444675699Z [err]  2025-12-29 21:39:27,438 - core_calling_service - INFO - âœ… LLM client pre-warmed in 97ms
2025-12-29T21:39:27.444683222Z [err]  2025-12-29 21:39:27,438 - server - INFO - ğŸ”§ Calling create_call_session() - COMPLETE
2025-12-29T21:39:27.444688452Z [err]  2025-12-29 21:39:27,438 - server - INFO - âœ… Session object created: CallSession
2025-12-29T21:39:27.447183119Z [err]  2025-12-29 21:39:27,444 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (TTL: 3600s)
2025-12-29T21:39:27.447193169Z [err]  2025-12-29 21:39:27,445 - server - INFO - âœ… Serializable call_data synced to Redis (agent_id, user_id)
2025-12-29T21:39:27.447198699Z [err]  2025-12-29 21:39:27,445 - server - INFO - âœ… Session stored in worker memory (not Redis)
2025-12-29T21:39:27.449839373Z [err]  2025-12-29 21:39:27,445 - redis_service - INFO - âœ… Marked session ready in Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:27.449859376Z [err]  2025-12-29 21:39:27,445 - server - INFO - ğŸ¤– AI session created for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:27.449866285Z [err]  2025-12-29 21:39:27,445 - server - INFO - ğŸ“¦ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-29T21:39:27.449871604Z [err]  2025-12-29 21:39:27,445 - server - INFO - â­ï¸ Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-29T21:39:27.449877417Z [err]  2025-12-29 21:39:27,445 - server - INFO - ğŸ‘¤ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-29T21:39:27.449884063Z [err]  2025-12-29 21:39:27,445 - server - INFO - ğŸ‘‚ User speaks first - waiting for user input...
2025-12-29T21:39:27.449893779Z [err]  2025-12-29 21:39:27,446 - server - INFO - ğŸ›¡ï¸ Voicemail timeout protection started (15000ms)
2025-12-29T21:39:27.449899125Z [err]  2025-12-29 21:39:27,446 - server - INFO - â±ï¸ AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-29T21:39:27.449903841Z [err]  2025-12-29 21:39:27,446 - server - INFO - ğŸ¤ Voice flow - streaming started via dial command
2025-12-29T21:39:27.456815156Z [err]  2025-12-29 21:39:27,450 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:27.456829317Z [err]  2025-12-29 21:39:27,452 - server - INFO - ğŸ¤ No greeting - waiting for user to speak first
2025-12-29T21:39:27.456837213Z [err]  2025-12-29 21:39:27,452 - server - INFO - ğŸ¤ Voice flow - WebSocket streaming already initiated
2025-12-29T21:39:27.456842255Z [inf]  100.64.0.5:37176 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:28.250619882Z [err]  2025-12-29 21:39:27,727 - dead_air_monitor - INFO - ğŸš© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-29T21:39:28.250628445Z [err]  2025-12-29 21:39:27,727 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044367.7273884 for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:28.250633764Z [err]  2025-12-29 21:39:27,727 - core_calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:28.250641575Z [err]  2025-12-29 21:39:27,883 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:28.250647641Z [err]  2025-12-29 21:39:27,895 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:28.250653654Z [err]  2025-12-29 21:39:27,907 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (TTL: 3600s)
2025-12-29T21:39:28.250659956Z [err]  2025-12-29 21:39:27,907 - server - INFO - â±ï¸ [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-29T21:39:28.250667808Z [err]  2025-12-29 21:39:27,907 - core_calling_service - INFO - â±ï¸ [21:39:27.907] ğŸ“¥ process_user_input() ENTRY - text: '...'
2025-12-29T21:39:28.250707621Z [err]  2025-12-29 21:39:27,915 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:28.250718411Z [err]  2025-12-29 21:39:27,916 - core_calling_service - INFO - â±ï¸ [21:39:27.916] â© About to call _process_call_flow_streaming()
2025-12-29T21:39:28.250725638Z [err]  2025-12-29 21:39:27,916 - core_calling_service - INFO - â±ï¸ [21:39:27.916] ğŸ”€ Agent type: call_flow, calling flow processor...
2025-12-29T21:39:28.250731908Z [err]  2025-12-29 21:39:27,916 - core_calling_service - INFO - â±ï¸ [21:39:27.916] ğŸ”€ _process_call_flow_streaming() ENTRY
2025-12-29T21:39:28.255884489Z [err]  2025-12-29 21:39:27,916 - core_calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-29T21:39:28.255892503Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - â±ï¸ [21:39:27.917] âœ… Node selected, about to process content...
2025-12-29T21:39:28.255900062Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - ğŸ”§ Replaced {{now}} with Monday, December 29, 2025 at 4:39 PM EST in content
2025-12-29T21:39:28.255907577Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - ğŸ”§ Replaced {{customer_name}} with Kendrick in content
2025-12-29T21:39:28.255914585Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - ğŸ”§ Replaced {{callerName}} with  in content
2025-12-29T21:39:28.255921090Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - ğŸ”§ Replaced {{lead_id}} with None in content
2025-12-29T21:39:28.255928307Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - ğŸ”§ Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T21:39:28.255936092Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - ğŸ”§ Replaced {{track_keywords}} with  in content
2025-12-29T21:39:28.255942999Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - ğŸ”§ Replaced {{expected_commitment}} with not_specified in content
2025-12-29T21:39:28.255968219Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - ğŸ”§ Replaced {{to_number}} with +17708336397 in content
2025-12-29T21:39:28.255975188Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - ğŸ”§ Replaced {{phone_number}} with +17708336397 in content
2025-12-29T21:39:28.255981700Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - ğŸ”§ Replaced {{email}} with None in content
2025-12-29T21:39:28.255989267Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - âœ… Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-29T21:39:28.256329185Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-29T21:39:28.256334002Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - ğŸ“š skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-29T21:39:28.256338245Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - â±ï¸ [21:39:27.917] ğŸ“„ About to process content (mode=script, length=9)
2025-12-29T21:39:28.256342046Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - ğŸ”Š Silence tracking reset for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (user responded)
2025-12-29T21:39:28.256345835Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - âœ… User responded to regular message, resetting counter
2025-12-29T21:39:28.256349859Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - ğŸ’¾ Storing node ID 2 in conversation history
2025-12-29T21:39:28.256354546Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - LLM response (0.01s): Kendrick?
2025-12-29T21:39:28.256358668Z [err]  2025-12-29 21:39:27,917 - core_calling_service - INFO - Total latency: 0.01s
2025-12-29T21:39:28.256362458Z [err]  2025-12-29 21:39:27,917 - server - INFO - ğŸ’¬ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-29T21:39:28.256367239Z [err]  2025-12-29 21:39:27,938 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:28.256371417Z [err]  2025-12-29 21:39:28,013 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:28.256377925Z [err]  2025-12-29 21:39:28,015 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA: Kendrick?...
2025-12-29T21:39:28.259663479Z [err]  2025-12-29 21:39:28,015 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-29T21:39:28.259672997Z [err]  2025-12-29 21:39:28,015 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-29T21:39:28.259679289Z [err]  2025-12-29 21:39:28,015 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-29T21:39:28.259684382Z [err]  2025-12-29 21:39:28,015 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-29T21:39:28.259705310Z [err]  2025-12-29 21:39:28,015 - server - INFO - ğŸ’¾ TTS CACHE HIT: Returning cached audio (13419 bytes)
2025-12-29T21:39:28.259711929Z [err]  2025-12-29 21:39:28,015 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.00s
2025-12-29T21:39:28.259716903Z [err]  2025-12-29 21:39:28,016 - telnyx_service - INFO - âœ… Generated 13419 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-29T21:39:28.259721882Z [err]  2025-12-29 21:39:28,016 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-29T21:39:28.278406344Z [err]  2025-12-29 21:39:28,274 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-29T21:39:28.278416416Z [err]  2025-12-29 21:39:28,275 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.26s
2025-12-29T21:39:28.278423503Z [err]  2025-12-29 21:39:28,275 - telnyx_service - INFO - â±ï¸  Total TTS latency: 0.26s
2025-12-29T21:39:28.278431069Z [err]  2025-12-29 21:39:28,275 - telnyx_service - INFO - âœ… Playing elevenlabs audio via Telnyx playback
2025-12-29T21:39:28.278437618Z [err]  2025-12-29 21:39:28,275 - telnyx_service - INFO - ğŸ¬ Playback ID: wuJo4IVVgw
2025-12-29T21:39:28.282502411Z [err]  2025-12-29 21:39:28,275 - server - INFO - ğŸ”Š [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-29T21:39:28.282513927Z [err]  2025-12-29 21:39:28,275 - server - INFO - â±ï¸ [WebSocket Worker] Greeting playback started at 1767044368.2754192
2025-12-29T21:39:28.282523302Z [err]  2025-12-29 21:39:28,275 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044368.275456 for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:28.282530239Z [err]  2025-12-29 21:39:28,275 - server - INFO - â±ï¸ [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-29T21:39:28.402782646Z [err]  2025-12-29 21:39:28,399 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:28.402794027Z [err]  2025-12-29 21:39:28,399 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.started', 'id': 'b7231169-32b1-4c22-80c7-9feac5413f32', 'occurred_at': '2025-12-29T21:39:27.976106Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': '2r9zR7I2TQ', 'start_time': '2025-12-29T21:39:27.976106Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:28.402801350Z [err]  2025-12-29 21:39:28,400 - server - INFO - ğŸ¯ Event type: call.playback.started, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:28.402807752Z [err]  2025-12-29 21:39:28,400 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:28.402814636Z [inf]  100.64.0.16:37566 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:28.442494488Z [err]  2025-12-29 21:39:28,439 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:28.594527971Z [inf]  100.64.0.8:57616 - "GET /api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3 HTTP/1.1" 200
2025-12-29T21:39:29.257490552Z [err]  2025-12-29 21:39:28,940 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:29.448479597Z [err]  2025-12-29 21:39:29,442 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:29.451055447Z [err]  2025-12-29 21:39:29,448 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:29.451063328Z [err]  2025-12-29 21:39:29,448 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.started', 'id': '56908055-05dc-45d4-992e-8b28aabc1764', 'occurred_at': '2025-12-29T21:39:29.035966Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'wuJo4IVVgw'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:29.451069336Z [err]  2025-12-29 21:39:29,448 - server - INFO - ğŸ¯ Event type: call.playback.started, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:29.451074610Z [err]  2025-12-29 21:39:29,448 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:29.451079444Z [inf]  100.64.0.15:50120 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:30.193073074Z [err]  2025-12-29 21:39:29,944 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:30.237791458Z [err]  2025-12-29 21:39:30,235 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=2.5s, checkin_count=1/2
2025-12-29T21:39:30.361296509Z [err]  2025-12-29 21:39:30,358 - server - INFO - ğŸ”¤ RAW TOKENS: ["H"?]
2025-12-29T21:39:30.361304736Z [err]  2025-12-29 21:39:30,358 - core_calling_service - INFO - â±ï¸ SILENCE TIMER RESET (user started speaking) for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:30.361309350Z [err]  2025-12-29 21:39:30,359 - core_calling_service - INFO - ğŸ”Š Silence timer reset for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (user started speaking)
2025-12-29T21:39:30.361313224Z [err]  2025-12-29 21:39:30,359 - core_calling_service - INFO - ğŸ‘¤ User started speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:30.361317059Z [err]  2025-12-29 21:39:30,359 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-29T21:39:30.361322615Z [err]  2025-12-29 21:39:30,359 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-29T21:39:30.448790455Z [err]  2025-12-29 21:39:30,446 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:30.448808583Z [err]  2025-12-29 21:39:30,446 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=True, silence=0.0s, checkin_count=0/2
2025-12-29T21:39:30.459273112Z [err]  2025-12-29 21:39:30,452 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:30.459283359Z [err]  2025-12-29 21:39:30,452 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'd6debbb1-60b3-45c1-990c-5e589fd1f770', 'occurred_at': '2025-12-29T21:39:29.875963Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'wuJo4IVVgw', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:30.459289349Z [err]  2025-12-29 21:39:30,452 - server - INFO - ğŸ¯ Event type: call.playback.ended, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:30.459294418Z [err]  2025-12-29 21:39:30,452 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:30.459300441Z [err]  2025-12-29 21:39:30,454 - redis_service - INFO - â– Removed playback wuJo4IVVgw, 0 remaining for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:30.459305498Z [err]  2025-12-29 21:39:30,454 - server - INFO - ğŸ”Š Redis: Removed playback wuJo4IVVgw, 0 remaining
2025-12-29T21:39:30.459310311Z [err]  2025-12-29 21:39:30,454 - server - INFO - ğŸ”Š ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T21:39:30.459314860Z [err]  2025-12-29 21:39:30,455 - server - INFO - âœ… Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T21:39:30.459319436Z [err]  2025-12-29 21:39:30,455 - server - INFO - ğŸ’¡ Session not on this worker - Redis flag set for WebSocket worker to handle
2025-12-29T21:39:30.461322210Z [inf]  100.64.0.9:42186 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:30.606172299Z [err]  2025-12-29 21:39:30,584 - server - INFO - ğŸ”¤ RAW TOKENS: ["H"?, "ello"?]
2025-12-29T21:39:30.606178076Z [err]  2025-12-29 21:39:30,584 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'Hello' | Generating: False
2025-12-29T21:39:31.208604963Z [err]  2025-12-29 21:39:30,719 - server - INFO - ğŸ”¤ RAW TOKENS: ["H"âœ“, "ello"âœ“, "?"âœ“, "<end>"âœ“]
2025-12-29T21:39:31.208610909Z [err]  2025-12-29 21:39:30,719 - server - INFO - ğŸ¯ Endpoint detected: <end> token received
2025-12-29T21:39:31.208616071Z [err]  2025-12-29 21:39:30,719 - server - INFO - ğŸ§¹ Cleaned transcript: 'H ello ?' -> 'Hello?'
2025-12-29T21:39:31.208621375Z [err]  2025-12-29 21:39:30,719 - server - INFO - ğŸ“¥ FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-29T21:39:31.208627024Z [err]  2025-12-29 21:39:30,719 - server - INFO - ğŸ¤ Soniox final transcript: 'Hello?'
2025-12-29T21:39:31.208632630Z [err]  2025-12-29 21:39:30,719 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:31.208638459Z [err]  2025-12-29 21:39:30,719 - server - INFO - ğŸ” FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-29T21:39:31.208644230Z [err]  2025-12-29 21:39:30,719 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:31.208650727Z [err]  2025-12-29 21:39:30,719 - server - INFO - ğŸš€ Spawned tracked background task for endpoint processing
2025-12-29T21:39:31.208656838Z [err]  2025-12-29 21:39:30,719 - server - INFO - â±ï¸ [21:39:30.719] ğŸ“ FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-29T21:39:31.208662750Z [err]  2025-12-29 21:39:30,719 - server - INFO - â±ï¸ [21:39:30.719] STT endpoint detection latency: 1ms
2025-12-29T21:39:31.208668000Z [err]  2025-12-29 21:39:30,719 - server - INFO - â±ï¸ [21:39:30.719] ğŸ¤ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-29T21:39:31.208673628Z [err]  2025-12-29 21:39:30,719 - server - INFO - â±ï¸ User spoke at 1767044370.719977
2025-12-29T21:39:31.212729301Z [err]  2025-12-29 21:39:30,720 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (TTL: 3600s)
2025-12-29T21:39:31.212737274Z [err]  2025-12-29 21:39:30,720 - server - INFO - ğŸ‘¤ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-29T21:39:31.212743869Z [err]  2025-12-29 21:39:30,721 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:31.212749530Z [err]  2025-12-29 21:39:30,721 - server - INFO - âœ… Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-29T21:39:31.212755970Z [err]  2025-12-29 21:39:30,730 - server - INFO - ğŸ¤ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-29T21:39:31.212761886Z [err]  2025-12-29 21:39:30,730 - core_calling_service - INFO - ğŸ‘¤ User stopped speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:31.212768751Z [err]  2025-12-29 21:39:30,731 - server - INFO - â±ï¸ [TIMING] STT_START: User last audio packet received
2025-12-29T21:39:31.212775570Z [err]  2025-12-29 21:39:30,731 - server - INFO - â±ï¸ [TIMING] STT_END: Endpoint detected at T+13ms
2025-12-29T21:39:31.212781252Z [err]  2025-12-29 21:39:30,823 - server - INFO - ğŸ“ Saved user transcript to database
2025-12-29T21:39:31.212782509Z [err]  2025-12-29 21:39:30,731 - server - INFO - â±ï¸ [TIMING] STT_LATENCY: 13ms (Soniox model: stt-rt-v3)
2025-12-29T21:39:31.212789654Z [err]  2025-12-29 21:39:30,823 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:31.212790132Z [err]  2025-12-29 21:39:30,731 - server - INFO - â±ï¸  USER STOPPED SPEAKING at T=0ms
2025-12-29T21:39:31.212795880Z [err]  2025-12-29 21:39:30,823 - core_calling_service - INFO - â±ï¸ [21:39:30.823] ğŸ“¥ process_user_input() ENTRY - text: 'Hello?...'
2025-12-29T21:39:31.212798286Z [err]  2025-12-29 21:39:30,731 - server - INFO - ğŸ™ï¸ Agent generating response - interruption detection active
2025-12-29T21:39:31.212801659Z [err]  2025-12-29 21:39:30,824 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:31.212806243Z [err]  2025-12-29 21:39:30,731 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:31.212812437Z [err]  2025-12-29 21:39:30,737 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=3.0s, checkin_count=1/2
2025-12-29T21:39:31.213592696Z [err]  2025-12-29 21:39:30,825 - core_calling_service - WARNING - ğŸš¨ BARGE-IN DETECTED for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA: User spoke while Silence Greeting was triggering
2025-12-29T21:39:31.213603545Z [err]  2025-12-29 21:39:30,846 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:31.213611007Z [err]  2025-12-29 21:39:30,846 - telnyx_service - INFO - ğŸ›‘ Stopping audio playback on call: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:31.213618411Z [err]  2025-12-29 21:39:30,948 - dead_air_monitor - INFO - ğŸš© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-29T21:39:31.214820608Z [err]  2025-12-29 21:39:30,948 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044370.9486556 for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:31.214826298Z [err]  2025-12-29 21:39:30,948 - core_calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:31.214830250Z [err]  2025-12-29 21:39:30,950 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:31.216534943Z [err]  2025-12-29 21:39:30,950 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-29T21:39:31.279068444Z [err]  2025-12-29 21:39:31,275 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA/actions/playback_stop "HTTP/1.1 200 OK"
2025-12-29T21:39:31.279081053Z [err]  2025-12-29 21:39:31,276 - telnyx_service - INFO - âœ… Successfully stopped audio playback
2025-12-29T21:39:31.282054030Z [err]  2025-12-29 21:39:31,277 - core_calling_service - INFO - âœ… BARGE-IN: Audio playback STOPPED
2025-12-29T21:39:31.282065511Z [err]  2025-12-29 21:39:31,277 - core_calling_service - INFO - âœ… BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-29T21:39:31.282074909Z [err]  2025-12-29 21:39:31,278 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:31.282080762Z [err]  2025-12-29 21:39:31,279 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (TTL: 3600s)
2025-12-29T21:39:31.282087106Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - âœ… BARGE-IN: Reset silence_greeting_triggered flag
2025-12-29T21:39:31.282093604Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - â±ï¸ [21:39:31.279] â© About to call _process_call_flow_streaming()
2025-12-29T21:39:31.282098900Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - â±ï¸ [21:39:31.279] ğŸ”€ Agent type: call_flow, calling flow processor...
2025-12-29T21:39:31.282105289Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - â±ï¸ [21:39:31.279] ğŸ”€ _process_call_flow_streaming() ENTRY
2025-12-29T21:39:31.282110796Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-29T21:39:31.282117282Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - ğŸ” Using explicitly set current_node_id: 2
2025-12-29T21:39:31.282122943Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - â±ï¸ [21:39:31.279] ğŸ”€ About to call _follow_transition() for: Hello?...
2025-12-29T21:39:31.282128418Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Hello?
2025-12-29T21:39:31.282133443Z [err]  2025-12-29 21:39:31,279 - core_calling_service - INFO - ğŸ” Checking 'Hello=Yes' override [DEPLOYMENT VERIFIED] for msg='hello' on node='Greeting'
2025-12-29T21:39:31.284989695Z [err]  2025-12-29 21:39:31,279 - core_calling_service - WARNING - âš ï¸ Auto-transition after response target not found: None, falling back to normal evaluation
2025-12-29T21:39:31.291974962Z [err]  2025-12-29 21:39:31,288 - core_calling_service - INFO - â±ï¸ [21:39:31.288] ğŸ”€ TRANSITION EVALUATION START - Calling LLM for 2 options
2025-12-29T21:39:31.445503416Z [err]  2025-12-29 21:39:31,438 - server - INFO - ğŸ“¤ Audio flowing: 284 packets sent to Soniox (5s update)
2025-12-29T21:39:31.457728091Z [err]  2025-12-29 21:39:31,452 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:32.133880673Z [err]  2025-12-29 21:39:31,704 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-29T21:39:32.133884931Z [err]  2025-12-29 21:39:31,705 - core_calling_service - INFO - â±ï¸ [21:39:31.705] ğŸ”€ TRANSITION EVALUATION COMPLETE - took 417ms
2025-12-29T21:39:32.133891712Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ğŸ¤– AI transition decision: '-1'
2025-12-29T21:39:32.133896283Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ğŸ“Š Available transitions: ['Confirms name (Yes|Speaking|This is he/she) OR Ask...', 'Wrong number (No John here|Wrong number|etc) - don...']
2025-12-29T21:39:32.133902296Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - Selected transition index: -1
2025-12-29T21:39:32.133906789Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - No specific condition matched, looking for default transition...
2025-12-29T21:39:32.133911603Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - âš ï¸ No transition matched, but node has GOAL. Staying on current node to continue with goal-based guidance.
2025-12-29T21:39:32.133916714Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ğŸ¯ Goal: Say the customer's name...
2025-12-29T21:39:32.133922422Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - â±ï¸ [TIMING] TRANSITION_EVAL: 426ms
2025-12-29T21:39:32.133927653Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - â±ï¸ [21:39:31.706] âœ… Node selected, about to process content...
2025-12-29T21:39:32.133932563Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ğŸ”§ Replaced {{now}} with Monday, December 29, 2025 at 4:39 PM EST in content
2025-12-29T21:39:32.133938421Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ğŸ”§ Replaced {{customer_name}} with Kendrick in content
2025-12-29T21:39:32.133944251Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ğŸ”§ Replaced {{callerName}} with  in content
2025-12-29T21:39:32.137743421Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ğŸ”§ Replaced {{lead_id}} with None in content
2025-12-29T21:39:32.137748676Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ğŸ”§ Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T21:39:32.137753949Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ğŸ”§ Replaced {{track_keywords}} with  in content
2025-12-29T21:39:32.137759666Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ğŸ”§ Replaced {{expected_commitment}} with not_specified in content
2025-12-29T21:39:32.137764689Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ğŸ”§ Replaced {{to_number}} with +17708336397 in content
2025-12-29T21:39:32.137769720Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ğŸ”§ Replaced {{phone_number}} with +17708336397 in content
2025-12-29T21:39:32.137775926Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ğŸ”§ Replaced {{email}} with None in content
2025-12-29T21:39:32.137781012Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - âœ… Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-29T21:39:32.137788888Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-29T21:39:32.137793854Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ğŸ“š skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-29T21:39:32.137798487Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - â±ï¸ [21:39:31.706] ğŸ“„ About to process content (mode=script, length=9)
2025-12-29T21:39:32.137803190Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ğŸ›¡ï¸ Preventing Dead Air: User stayed on script node 'Greeting' without transition
2025-12-29T21:39:32.137808379Z [err]  2025-12-29 21:39:31,706 - core_calling_service - INFO - ğŸ¤– Generating sticky-prevention response...
2025-12-29T21:39:32.140370994Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - âš¡ PARALLEL MODE: Running KB + analysis simultaneously
2025-12-29T21:39:32.140381165Z [err]  2025-12-29 21:39:31,715 - kb_router - INFO - ğŸš¦ KB Router: SKIP (simple chat pattern matched)
2025-12-29T21:39:32.140385192Z [err]  If user says a name, don't assume it's theirsâ€”wait for explicit correction.
2025-12-29T21:39:32.140390622Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - âš¡ Skipping KB (reason: simple_chat)
2025-12-29T21:39:32.140398471Z [err]  
2025-12-29T21:39:32.140398994Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - âš¡ Parallel operations completed in 0ms
2025-12-29T21:39:32.140408678Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - ğŸ” Node 'Greeting': use_parallel_llm=True
2025-12-29T21:39:32.140409145Z [err]  If user asks to repeat info, rephrase naturallyâ€”never exact repeat.
2025-12-29T21:39:32.140415574Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - âš¡ Parallel mode: Using condensed history (3/3 messages)
2025-12-29T21:39:32.140421073Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - â±ï¸ [21:39:31.715] ğŸ’¬ LLM REQUEST START: 3 conversation turns, 7881 system chars (KB cached)
2025-12-29T21:39:32.140425466Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - ğŸ“ â•â•â•â•â•â•â•â•â•â•â• LLM PROMPT BREAKDOWN â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:39:32.140430366Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - ğŸ“ [SYSTEM MSG 1 - GLOBAL PROMPT] (6467 chars):
2025-12-29T21:39:32.140435007Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - ğŸ“   Preview: # Global Prompt: Direct Drive Engine (V4.2 - Acknowledging & Fluid)
2025-12-29T21:39:32.140439598Z [err]  
2025-12-29T21:39:32.140445297Z [err]  When user states income, convert/update as [yearly_income] variable for logic splits.
2025-12-29T21:39:32.140450937Z [err]  
2025-12-29T21:39:32.142218713Z [err]  
2025-12-29T21:39:32.142224880Z [err]  If asked your state: "Atlanta, GA. Been in Midtown 10 years."
2025-12-29T21:39:32.142230558Z [err]  
2025-12-29T21:39:32.142238005Z [err]  If asked about call number: "Company number."
2025-12-29T21:39:32.142244434Z [err]  
2025-12-29T21:39:32.142250068Z [err]  
2025-12-29T21:39:32.142251806Z [err]  User email: {customer_email} (for them: {{customer_email}}).
2025-12-29T21:39:32.142263209Z [err]  
2025-12-29T21:39:32.142265317Z [err]  1. Generate a natural, contextual response
2025-12-29T21:39:32.142265321Z [err]  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-29T21:39:32.142268006Z [err]  USER COMMUNICATION STYLE: C type - adjust your response accordingly
2025-12-29T21:39:32.142271999Z [err]  If explaining ends in peri...
2025-12-29T21:39:32.142276541Z [err]  PREPROCESSED CONTEXT (to help you prioritize and focus):
2025-12-29T21:39:32.142282577Z [err]  2. Evaluate transitions per your node instructions
2025-12-29T21:39:32.142282789Z [err]  2025-12-29 21:39:31,715 - core_calling_service - INFO - ğŸ“ [SYSTEM MSG 2 - DYNAMIC CONTEXT] (1414 chars):
2025-12-29T21:39:32.142284313Z [err]  CONVERSATION STATUS: Turn 2, objection handling phase
2025-12-29T21:39:32.142288100Z [err]  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-29T21:39:32.142293560Z [err]  2025-12-29 21:39:31,716 - core_calling_service - INFO - ğŸ“   Preview: 
2025-12-29T21:39:32.142297625Z [err]  
2025-12-29T21:39:32.142298147Z [err]  
2025-12-29T21:39:32.142308648Z [err]  This context is provided to help you focus. You still need to:
2025-12-29T21:39:32.146121602Z [err]  
2025-12-29T21:39:32.146133076Z [err]  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-29T21:39:32.146140571Z [err]  
2025-12-29T21:39:32.146147298Z [err]  # CURRENT CONTEXT
2025-12-29T21:39:32.146153071Z [err]  Customer: Kendrick
2025-12-29T21:39:32.146160607Z [err]  Variables: {"now": "Monday, December 29, 2025 at 4:39 PM EST", "customer_name": "Kendrick", "callerName": "", "lead_id": null, "qc_tracking_enabled": false, "track_keywords": "", "expected_commitment": ...
2025-12-29T21:39:32.146166629Z [err]  2025-12-29 21:39:31,716 - core_calling_service - INFO - ğŸ“ [CONVERSATION HISTORY] (3 messages)
2025-12-29T21:39:32.146173839Z [err]  2025-12-29 21:39:31,716 - core_calling_service - INFO - ğŸ“   assistant: Kendrick?...
2025-12-29T21:39:32.146179828Z [err]  2025-12-29 21:39:31,716 - core_calling_service - INFO - ğŸ“   user: Hello?...
2025-12-29T21:39:32.146185462Z [err]  2025-12-29 21:39:31,716 - core_calling_service - INFO - ğŸ“ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:39:32.146191422Z [err]  2025-12-29 21:39:31,764 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:32.146197486Z [err]  2025-12-29 21:39:31,764 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': 'ba40002c-5507-434b-9596-b699dc86bc48', 'occurred_at': '2025-12-29T21:39:31.095971Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:32.150370767Z [err]  2025-12-29 21:39:31,764 - server - INFO - ğŸ¯ Event type: call.machine.premium.detection.ended, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:32.150379402Z [err]  2025-12-29 21:39:31,765 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:32.150389116Z [inf]  100.64.0.14:16928 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:32.150396184Z [err]  2025-12-29 21:39:31,864 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-29T21:39:32.150402785Z [err]  2025-12-29 21:39:31,955 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:32.150410690Z [err]  2025-12-29 21:39:32,140 - core_calling_service - INFO - â±ï¸ [21:39:32.140] ğŸ’¬ LLM FIRST TOKEN: 424ms (grok grok-4-1-fast-non-reasoning)
2025-12-29T21:39:32.219907977Z [err]  2025-12-29 21:39:32,214 - server - INFO - ğŸ“¤ Sentence arrived from LLM: [N] Hey Kendrick,...
2025-12-29T21:39:32.219919582Z [err]  2025-12-29 21:39:32,214 - server - INFO - â±ï¸ [TIMING] TTFS (Time To First Sentence): 1482ms
2025-12-29T21:39:32.219926564Z [err]  2025-12-29 21:39:32,214 - server - INFO - âš¡ Starting REAL-TIME TTS for first sentence
2025-12-29T21:39:32.219932366Z [err]  2025-12-29 21:39:32,214 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:32.219940812Z [err]  2025-12-29 21:39:32,214 - server - INFO - âš¡ ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-29T21:39:32.306384446Z [err]  2025-12-29 21:39:32,301 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:32.390289037Z [err]  2025-12-29 21:39:32,386 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:32.458571161Z [err]  2025-12-29 21:39:32,456 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:QiUB4hXB0fhw8r7RO... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ'])
2025-12-29T21:39:32.475041949Z [err]  2025-12-29 21:39:32,471 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:32.495687963Z [err]  2025-12-29 21:39:32,491 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:32.495702337Z [err]  2025-12-29 21:39:32,491 - server - INFO - âœ… ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-29T21:39:32.495718159Z [err]  2025-12-29 21:39:32,492 - persistent_tts_service - INFO - ğŸ™ï¸ Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:39:32.495725882Z [err]  2025-12-29 21:39:32,492 - persistent_tts_service - INFO - ğŸ”Œ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Establishing persistent TTS WebSocket...
2025-12-29T21:39:32.495733451Z [err]  2025-12-29 21:39:32,492 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:39:32.495741210Z [err]  2025-12-29 21:39:32,492 - elevenlabs_ws_service - INFO - ğŸ”Œ Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-29T21:39:32.495748661Z [err]  2025-12-29 21:39:32,492 - elevenlabs_ws_service - INFO - ğŸ™ï¸ Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-29T21:39:32.636203324Z [err]  2025-12-29 21:39:32,630 - elevenlabs_ws_service - INFO - âœ… Connected to ElevenLabs WebSocket
2025-12-29T21:39:32.636213840Z [err]  2025-12-29 21:39:32,630 - elevenlabs_ws_service - INFO - ğŸ“¤ Sent BOS message with voice settings
2025-12-29T21:39:32.636219654Z [err]  2025-12-29 21:39:32,630 - persistent_tts_service - INFO - âœ… [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Persistent TTS WebSocket established
2025-12-29T21:39:32.636224612Z [err]  2025-12-29 21:39:32,630 - persistent_tts_service - INFO - ğŸ§ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Audio receiver loop started
2025-12-29T21:39:32.636228887Z [err]  2025-12-29 21:39:32,630 - persistent_tts_service - INFO - ğŸ”Š [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Comfort noise loop started
2025-12-29T21:39:32.636233596Z [err]  2025-12-29 21:39:32,630 - persistent_tts_service - INFO - âœ… Created persistent TTS session for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:32.636238213Z [err]  2025-12-29 21:39:32,630 - server - INFO - âœ… ON-DEMAND: Persistent TTS session created successfully!
2025-12-29T21:39:32.636242676Z [err]  2025-12-29 21:39:32,630 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:QiUB4hXB0fhw8r7RO..., session=FOUND
2025-12-29T21:39:32.636247656Z [err]  2025-12-29 21:39:32,630 - server - INFO - ğŸš€ Streaming sentence #1 via persistent WebSocket
2025-12-29T21:39:32.636254278Z [err]  2025-12-29 21:39:32,630 - server - INFO - ğŸµ TTS task #1 started at +416ms
2025-12-29T21:39:32.636258673Z [err]  2025-12-29 21:39:32,630 - server - INFO - â±ï¸ [TIMING] TTFT_TTS (First TTS Task Started): 1899ms
2025-12-29T21:39:32.636263792Z [err]  2025-12-29 21:39:32,630 - core_calling_service - INFO - ğŸ“¤ Streamed sentence: [N] Hey Kendrick,...
2025-12-29T21:39:32.636268133Z [err]  2025-12-29 21:39:32,631 - persistent_tts_service - INFO - ğŸµ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Playback consumer started
2025-12-29T21:39:32.639212536Z [err]  2025-12-29 21:39:32,631 - persistent_tts_service - INFO - ğŸ§ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Audio Receiver Loop STARTED
2025-12-29T21:39:32.639220292Z [err]  2025-12-29 21:39:32,631 - persistent_tts_service - INFO - ğŸ’“ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Starting TTS keep-alive loop (every 15s)
2025-12-29T21:39:32.639225737Z [err]  2025-12-29 21:39:32,631 - persistent_tts_service - INFO - ğŸ”Š [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Starting comfort noise loop
2025-12-29T21:39:32.639230070Z [err]  2025-12-29 21:39:32,631 - persistent_tts_service - INFO - ğŸ¤ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Streaming sentence #1: [N] Hey Kendrick,...
2025-12-29T21:39:32.639234131Z [err]  2025-12-29 21:39:32,631 - persistent_tts_service - INFO - ğŸš€ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-29T21:39:32.639239592Z [err]  2025-12-29 21:39:32,631 - persistent_tts_service - INFO - ğŸ“Š [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-29T21:39:32.639243964Z [err]  2025-12-29 21:39:32,633 - persistent_tts_service - INFO - ğŸ§ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Receiver processing sentence #1: '[N] Hey Kendrick,...'
2025-12-29T21:39:32.639249144Z [err]  2025-12-29 21:39:32,633 - persistent_tts_service - INFO - ğŸ“Š [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] DIAGNOSTIC: queue_latency=2ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-29T21:39:32.639255298Z [err]  2025-12-29 21:39:32,634 - server - INFO - ğŸ“¤ Sentence arrived from LLM: yeah it's me - you there?...
2025-12-29T21:39:32.639262531Z [err]  2025-12-29 21:39:32,634 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:QiUB4hXB0fhw8r7RO..., session=FOUND
2025-12-29T21:39:33.228150802Z [err]  2025-12-29 21:39:32,634 - server - INFO - ğŸš€ Streaming sentence #2 via persistent WebSocket
2025-12-29T21:39:33.228157638Z [err]  2025-12-29 21:39:32,634 - server - INFO - ğŸµ TTS task #2 started at +419ms
2025-12-29T21:39:33.228164543Z [err]  2025-12-29 21:39:32,634 - core_calling_service - INFO - ğŸ“¤ Streamed final fragment: yeah it's me - you there?...
2025-12-29T21:39:33.228173053Z [err]  2025-12-29 21:39:32,634 - core_calling_service - INFO - â±ï¸ [TIMING] LLM_TOTAL: 918ms for 43 chars (grok grok-4-1-fast-non-reasoning)
2025-12-29T21:39:33.228178760Z [err]  2025-12-29 21:39:32,634 - core_calling_service - INFO - â±ï¸ SILENCE TIMER RESET (user gave meaningful response) for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:33.228184152Z [err]  2025-12-29 21:39:32,634 - core_calling_service - INFO - ğŸ”Š Silence tracking reset for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (user responded)
2025-12-29T21:39:33.228189554Z [err]  2025-12-29 21:39:32,634 - core_calling_service - INFO - âœ… User responded to regular message, resetting counter
2025-12-29T21:39:33.228196076Z [err]  2025-12-29 21:39:32,634 - core_calling_service - INFO - ğŸ’¾ Storing node ID 2 in conversation history
2025-12-29T21:39:33.228201675Z [err]  2025-12-29 21:39:32,634 - core_calling_service - INFO - LLM response (1.81s): [N] Hey Kendrick, yeah it's me - you there?
2025-12-29T21:39:33.228210535Z [err]  2025-12-29 21:39:32,634 - core_calling_service - INFO - Total latency: 1.81s
2025-12-29T21:39:33.228215844Z [err]  2025-12-29 21:39:32,636 - server - INFO - âœ… LLM finished in 1904ms, TTS tasks already running in background
2025-12-29T21:39:33.228223976Z [err]  2025-12-29 21:39:32,637 - server - INFO - ğŸµ Streaming 2 TTS chunks as they complete...
2025-12-29T21:39:33.228228932Z [err]  2025-12-29 21:39:32,637 - server - INFO - ğŸš€ Persistent TTS: Audio already streaming in background!
2025-12-29T21:39:33.232466818Z [err]  2025-12-29 21:39:32,638 - server - INFO - â±ï¸  [TIMING] âš ï¸ NOTE: E2E_TOTAL does not include:
2025-12-29T21:39:33.232473872Z [err]  2025-12-29 21:39:32,638 - server - INFO - â±ï¸  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-29T21:39:33.232481069Z [err]  2025-12-29 21:39:32,638 - server - INFO - â±ï¸  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-29T21:39:33.232485716Z [err]  2025-12-29 21:39:32,638 - server - INFO - â±ï¸  [TIMING] LLM_TOTAL: 1904ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-29T21:39:33.232493789Z [err]  2025-12-29 21:39:32,638 - server - INFO - â±ï¸  [TIMING] TTS_TOTAL: 423ms (provider: elevenlabs, websocket: False)
2025-12-29T21:39:33.232494527Z [err]  2025-12-29 21:39:32,639 - server - INFO - â±ï¸  [TIMING] RESPONSE_TEXT: 43 chars, 2 sentences
2025-12-29T21:39:33.232495663Z [err]  2025-12-29 21:39:32,638 - server - INFO - â±ï¸  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-29T21:39:33.232502772Z [err]  2025-12-29 21:39:32,638 - server - INFO - â±ï¸  [TIMING] E2E_TOTAL: 1906ms (user stopped â†’ play_audio_url called)
2025-12-29T21:39:33.232503778Z [err]  2025-12-29 21:39:32,639 - server - INFO - â±ï¸  [TIMING] USER_INPUT: 'Hello?...'
2025-12-29T21:39:33.232505097Z [err]  2025-12-29 21:39:32,639 - server - INFO - â±ï¸  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-29T21:39:33.232513532Z [err]  2025-12-29 21:39:32,639 - server - INFO - â±ï¸  [TIMING]   - REAL USER LATENCY: 2206ms estimated
2025-12-29T21:39:33.232515362Z [err]  2025-12-29 21:39:32,639 - server - INFO - â±ï¸  [TIMING] AI_RESPONSE: '[N] Hey Kendrick, yeah it's me - you there?...'
2025-12-29T21:39:33.232521784Z [err]  2025-12-29 21:39:32,639 - server - INFO - â±ï¸  [TIMING] ==========================
2025-12-29T21:39:33.232526463Z [err]  2025-12-29 21:39:32,639 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:39:33.232838145Z [err]  2025-12-29 21:39:32,637 - server - INFO -    2 sentences queued and playing seamlessly
2025-12-29T21:39:33.232843081Z [err]  2025-12-29 21:39:32,637 - persistent_tts_service - INFO - ğŸ¤ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Streaming sentence #2: yeah it's me - you there?...
2025-12-29T21:39:33.232849054Z [err]  2025-12-29 21:39:32,637 - persistent_tts_service - INFO - ğŸš€ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Sent sentence #2 (NON-BLOCKING) in 0ms
2025-12-29T21:39:33.232854614Z [err]  2025-12-29 21:39:32,638 - persistent_tts_service - INFO - ğŸ“Š [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=False, is_last=False
2025-12-29T21:39:33.232861030Z [err]  2025-12-29 21:39:32,638 - server - INFO - âœ… All 2 persistent TTS streams completed
2025-12-29T21:39:33.232866224Z [err]  2025-12-29 21:39:32,638 - server - INFO - âœ… Agent generation complete (persistent TTS) - response window closed
2025-12-29T21:39:33.232871134Z [err]  2025-12-29 21:39:32,638 - server - INFO - â±ï¸  FIRST AUDIO STARTED: 1906ms from user stop ğŸš€
2025-12-29T21:39:33.232875720Z [err]  2025-12-29 21:39:32,638 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:33.232880498Z [err]  2025-12-29 21:39:32,638 - server - INFO - âœ… Agent generation complete - response window closed
2025-12-29T21:39:33.232886621Z [err]  2025-12-29 21:39:32,638 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:39:33.232891531Z [err]  2025-12-29 21:39:32,638 - server - INFO - â±ï¸  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-29T21:39:33.232898895Z [err]  2025-12-29 21:39:32,638 - server - INFO - â±ï¸  [TIMING] STT: 13ms (provider: soniox, model: stt-rt-v3)
2025-12-29T21:39:33.238154815Z [err]  2025-12-29 21:39:32,824 - server - INFO - ğŸ“ Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 2340ms)
2025-12-29T21:39:33.238161820Z [err]  2025-12-29 21:39:32,824 - server - INFO - ğŸ”Š Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-29T21:39:33.238168680Z [err]  2025-12-29 21:39:32,824 - server - INFO - ğŸ” END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-29T21:39:33.238174591Z [err]  2025-12-29 21:39:32,886 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTFA (Time To First Audio Playback): 255ms
2025-12-29T21:39:33.238182064Z [err]  2025-12-29 21:39:32,887 - persistent_tts_service - INFO - ğŸ“¤ Sending 9643 bytes of audio (61 chunks, 1.2s duration) via WebSocket
2025-12-29T21:39:33.238189382Z [err]  2025-12-29 21:39:32,887 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:39:33.238195747Z [err]  2025-12-29 21:39:32,887 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +1.2s (total: 1.2s from now)
2025-12-29T21:39:33.238201460Z [err]  2025-12-29 21:39:32,888 - persistent_tts_service - INFO - âœ… Sent 61 audio chunks via WebSocket
2025-12-29T21:39:33.238207240Z [err]  2025-12-29 21:39:33,069 - persistent_tts_service - INFO - ğŸ“¤ Sending 10775 bytes of audio (68 chunks, 1.3s duration) via WebSocket
2025-12-29T21:39:33.238213254Z [err]  2025-12-29 21:39:33,069 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:39:33.238219657Z [err]  2025-12-29 21:39:33,069 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +1.3s (total: 2.4s from now)
2025-12-29T21:39:33.238225981Z [err]  2025-12-29 21:39:33,070 - persistent_tts_service - INFO - âœ… Sent 68 audio chunks via WebSocket
2025-12-29T21:39:35.130535128Z [err]  2025-12-29 21:39:34,749 - core_calling_service - INFO - â° Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-29T21:39:35.130544377Z [err]  2025-12-29 21:39:34,750 - core_calling_service - INFO - ğŸ’¬ Sending FINAL check-in #2/2: Are you still there?
2025-12-29T21:39:35.130552431Z [err]  2025-12-29 21:39:34,750 - core_calling_service - INFO - âš ï¸ Will end call if no response after next silence timeout
2025-12-29T21:39:35.130560230Z [err]  2025-12-29 21:39:34,750 - dead_air_monitor - INFO - ğŸ’¬ Sending check-in after 7.0s silence: Are you still there?
2025-12-29T21:39:35.130571557Z [err]  2025-12-29 21:39:34,750 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:35.130581524Z [err]  2025-12-29 21:39:34,750 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ: Are you still there?...
2025-12-29T21:39:35.130588519Z [err]  2025-12-29 21:39:34,750 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-29T21:39:35.130596452Z [err]  2025-12-29 21:39:34,750 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-29T21:39:35.130603768Z [err]  2025-12-29 21:39:34,750 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-29T21:39:35.130614111Z [err]  2025-12-29 21:39:34,750 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-29T21:39:35.130622159Z [err]  2025-12-29 21:39:34,750 - server - INFO - ğŸ’¾ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-29T21:39:35.130629514Z [err]  2025-12-29 21:39:34,750 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.00s
2025-12-29T21:39:35.130637905Z [err]  2025-12-29 21:39:34,750 - telnyx_service - INFO - âœ… Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:35.130648782Z [err]  2025-12-29 21:39:34,750 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:35.133303877Z [err]  2025-12-29 21:39:35,026 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.28s
2025-12-29T21:39:35.133303895Z [err]  2025-12-29 21:39:35,026 - telnyx_service - ERROR - âŒ Telnyx playback failed: 422 - {
2025-12-29T21:39:35.133314819Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:39:35.133319952Z [err]    "errors": [
2025-12-29T21:39:35.133330365Z [err]      {
2025-12-29T21:39:35.133340543Z [err]      }
2025-12-29T21:39:35.133344034Z [err]        "code": "90018",
2025-12-29T21:39:35.133351101Z [err]        "title": "Call has already ended",
2025-12-29T21:39:35.133354120Z [err]  2025-12-29 21:39:35,027 - telnyx_service - INFO - ğŸ“¢ Using Telnyx built-in TTS
2025-12-29T21:39:35.133368724Z [err]    ]
2025-12-29T21:39:35.133382693Z [err]  }
2025-12-29T21:39:35.134241620Z [err]  2025-12-29 21:39:35,026 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:35.229021817Z [err]  2025-12-29 21:39:35,222 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:35.229031622Z [err]  2025-12-29 21:39:35,222 - telnyx_service - ERROR - âŒ Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:39:35.229042955Z [err]  2025-12-29 21:39:35,222 - dead_air_monitor - INFO - âœ… Check-in message sent
2025-12-29T21:39:35.229048863Z [err]  2025-12-29 21:39:35,223 - elevenlabs_ws_service - INFO - â±ï¸  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-29T21:39:35.229055839Z [err]  2025-12-29 21:39:35,223 - persistent_tts_service - INFO - âœ… [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Receiver finished sentence #1: 2 chunks in 2592ms
2025-12-29T21:39:35.229061594Z [err]  2025-12-29 21:39:35,223 - persistent_tts_service - INFO - ğŸ§ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Receiver processing sentence #2: 'yeah it's me - you there?...'
2025-12-29T21:39:35.229067810Z [err]  2025-12-29 21:39:35,223 - persistent_tts_service - INFO - ğŸ“Š [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] DIAGNOSTIC: queue_latency=2585ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-29T21:39:35.479741716Z [err]  2025-12-29 21:39:35,469 - dead_air_monitor - INFO - â±ï¸ Playback expected end time passed (0.0s ago), marking agent as done speaking
2025-12-29T21:39:35.479762466Z [err]  2025-12-29 21:39:35,469 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044375.4696348 for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:35.479768380Z [err]  2025-12-29 21:39:35,469 - core_calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:36.175456116Z [err]  2025-12-29 21:39:35,740 - persistent_tts_service - INFO - ğŸ”‡ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] FLOOR RELEASED (is_holding_floor=False)
2025-12-29T21:39:36.447797747Z [err]  2025-12-29 21:39:36,443 - server - INFO - ğŸ“¤ Audio flowing: 534 packets sent to Soniox (5s update)
2025-12-29T21:39:37.236437439Z [err]  2025-12-29 21:39:37,186 - server - INFO - ğŸ¤ Soniox receiver alive - 13 messages received in last 10s
2025-12-29T21:39:38.183645622Z [err]  2025-12-29 21:39:37,724 - elevenlabs_ws_service - WARNING - âš ï¸  [TIMING] ElevenLabs timeout waiting for first chunk (2.5s) - No audio received!
2025-12-29T21:39:38.183650802Z [err]  2025-12-29 21:39:37,724 - persistent_tts_service - WARNING - âš ï¸ [Call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA] Receiver got 0 chunks for sentence #2! interrupted=False
2025-12-29T21:39:39.177261594Z [err]  2025-12-29 21:39:38,972 - server - INFO - ğŸ¤ Soniox receiver alive - 1 messages received in last 10s
2025-12-29T21:39:39.177265925Z [err]  2025-12-29 21:39:38,972 - server - ERROR - âŒ Soniox error: {'tokens': [], 'final_audio_proc_ms': 5280, 'total_audio_proc_ms': 11280, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-29T21:39:39.177270250Z [err]  2025-12-29 21:39:38,973 - server - INFO - âœ… Soniox receive loop ended normally
2025-12-29T21:39:39.177274668Z [err]  2025-12-29 21:39:38,973 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring cancelled for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:39.177278867Z [err]  2025-12-29 21:39:38,973 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring stopped for call v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ
2025-12-29T21:39:39.177282679Z [err]  2025-12-29 21:39:38,973 - server - INFO - ğŸ”‡ Dead air monitoring task cancelled
2025-12-29T21:39:39.230317101Z [err]  2025-12-29 21:39:39,220 - server - INFO - ğŸ“ Telnyx WebSocket disconnected. Sent 665 total packets
2025-12-29T21:39:39.230322126Z [err]  [2025-12-29 21:39:39 +0000] [5] [INFO] connection closed
2025-12-29T21:39:39.376843317Z [err]  2025-12-29 21:39:39,370 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:39.376851013Z [err]  2025-12-29 21:39:39,370 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.hangup', 'id': '64e99236-3e2e-4a0d-a95f-f79f5f0eb789', 'occurred_at': '2025-12-29T21:39:38.915967Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_quality_stats': {'inbound': {'jitter_max_variance': '40.21', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '691', 'skip_packet_count': '22'}, 'outbound': {'packet_count': '672', 'skip_packet_count': '0'}}, 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:38.915967Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-29T21:39:22.015963Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:39.376856177Z [err]  2025-12-29 21:39:39,370 - server - INFO - ğŸ¯ Event type: call.hangup, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:39.376860763Z [err]  2025-12-29 21:39:39,370 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:39.376865270Z [err]  2025-12-29 21:39:39,370 - server - INFO - ğŸ“ Call ended: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:39.376869870Z [err]  2025-12-29 21:39:39,370 - server - INFO - ğŸ“ Hangup cause: normal_clearing
2025-12-29T21:39:39.412607770Z [err]  2025-12-29 21:39:39,409 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:39.412617839Z [err]  2025-12-29 21:39:39,409 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'streaming.stopped', 'id': '0caf8aed-a012-4847-83a8-c5658a7082db', 'occurred_at': '2025-12-29T21:39:39.111745Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '7559e05e-7071-4515-aa1e-73d3ce291eb2', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:39.412623354Z [err]  2025-12-29 21:39:39,410 - server - INFO - ğŸ¯ Event type: streaming.stopped, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:39.412635067Z [err]  2025-12-29 21:39:39,410 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:39.412641010Z [inf]  100.64.0.15:19184 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:39.445502470Z [err]  2025-12-29 21:39:39,443 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '73e8efd8-8d05-4706-8594-7ec6f957fb11', 'occurred_at': '2025-12-29T21:39:38.955988Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:38.955988Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': '2r9zR7I2TQ', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:39.445509528Z [err]  2025-12-29 21:39:39,442 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:39.445516655Z [err]  2025-12-29 21:39:39,443 - server - INFO - ğŸ¯ Event type: call.playback.ended, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:39.445525031Z [err]  2025-12-29 21:39:39,443 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:39.448463075Z [err]  2025-12-29 21:39:39,444 - redis_service - INFO - â– Removed playback 2r9zR7I2TQ, 0 remaining for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:39.448470447Z [err]  2025-12-29 21:39:39,444 - server - INFO - ğŸ”Š Redis: Removed playback 2r9zR7I2TQ, 0 remaining
2025-12-29T21:39:39.448477752Z [err]  2025-12-29 21:39:39,444 - server - INFO - ğŸ”Š ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T21:39:39.448482381Z [err]  2025-12-29 21:39:39,445 - server - INFO - âœ… Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T21:39:39.448488046Z [err]  2025-12-29 21:39:39,445 - server - INFO - âœ… Found session in active_telnyx_calls (local worker)
2025-12-29T21:39:39.448493564Z [err]  2025-12-29 21:39:39,445 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044379.4453008 for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:39.448498047Z [err]  2025-12-29 21:39:39,445 - server - INFO - â±ï¸ Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-29T21:39:39.448502987Z [inf]  100.64.0.9:33454 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:39.560439116Z [err]  2025-12-29 21:39:39,553 - server - INFO - ğŸ“ Updated call log: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:39.650196710Z [err]  2025-12-29 21:39:39,645 - server - INFO - âœ… Finalized call log: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA (duration=14s, status=completed)
2025-12-29T21:39:40.164860602Z [err]  2025-12-29 21:39:39,738 - server - INFO - ğŸ“¦ Saved 11 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-29T21:39:40.430011897Z [err]  2025-12-29 21:39:40,427 - server - INFO - ğŸ“Š Auto-added call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-29T21:39:40.489590625Z [err]  2025-12-29 21:39:40,482 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=5.0s, checkin_count=0/2
2025-12-29T21:39:40.614640481Z [err]  2025-12-29 21:39:40,611 - server - INFO - ğŸ“¤ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:39:40.614647226Z [err]  2025-12-29 21:39:40,612 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:40.614652029Z [err]  2025-12-29 21:39:40,612 - server - INFO - ğŸ“‡ [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-29T21:39:40.614656483Z [err]  2025-12-29 21:39:40,612 - server - INFO - ğŸ“‡ [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-29T21:39:41.139151433Z [err]  2025-12-29 21:39:40,683 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:41.139162871Z [err]  2025-12-29 21:39:40,683 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '805b0037-e8c7-482c-adb6-f4004c6ac375', 'occurred_at': '2025-12-29T21:39:40.383439Z', 'payload': {'call_control_id': 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA', 'call_leg_id': 'd667d23c-e4fe-11f0-ac10-02420aef97a0', 'call_session_id': 'd6656902-e4fe-11f0-b91d-02420aef97a0', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:39.012085Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-29T21:39:39.012085Z', 'recording_id': 'd445d263-f759-444d-9c45-b9fc37ad437b', 'recording_started_at': '2025-12-29T21:39:26.948768Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/d667d23c-e4fe-11f0-ac10-02420aef97a0-1767044366061007.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T213940Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=896c7d566ef50ddd3be97f6725c92ea276bd0f73eb6bbb151a09ce8a955e001f'}, 'start_time': '2025-12-29T21:39:26.948768Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:41.139168728Z [err]  2025-12-29 21:39:40,683 - server - INFO - ğŸ¯ Event type: call.recording.saved, Call ID: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.139175400Z [err]  2025-12-29 21:39:40,683 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:41.139183739Z [err]  2025-12-29 21:39:40,684 - server - INFO - ğŸ™ï¸ Recording saved for call: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.139189346Z [err]  2025-12-29 21:39:40,684 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.142054594Z [err]  2025-12-29 21:39:40,685 - server - INFO - ğŸ” Recording check: download_url=True, channels=dual, recording_id=d445d263-f759-444d-9c45-b9fc37ad437b, call_data=True
2025-12-29T21:39:41.142066742Z [err]  2025-12-29 21:39:40,704 - server - INFO - ğŸ“‡ [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-29T21:39:41.142068904Z [err]  2025-12-29 21:39:40,777 - server - INFO - ğŸ’¾ Saved recording URL and ID to database: d445d263-f759-444d-9c45-b9fc37ad437b
2025-12-29T21:39:41.142084863Z [err]  2025-12-29 21:39:40,791 - server - INFO - ğŸ“Š Triggered Campaign QC for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.142088200Z [err]  2025-12-29 21:39:40,778 - server - INFO - âœ… Entering dual-channel processing
2025-12-29T21:39:41.142092924Z [err]  2025-12-29 21:39:40,791 - server - INFO - ğŸ“‡ Triggered CRM update for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.142093312Z [err]  2025-12-29 21:39:40,790 - server - INFO - ğŸ“‡ [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-29T21:39:41.142098758Z [err]  2025-12-29 21:39:40,778 - server - INFO - ğŸ“¥ Downloading DUAL-CHANNEL recording...
2025-12-29T21:39:41.142099839Z [err]  2025-12-29 21:39:40,791 - server - INFO - âœ… Closed persistent TTS session for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.142104896Z [err]  2025-12-29 21:39:40,791 - server - INFO - ğŸ“‡ [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-29T21:39:41.142116439Z [err]  2025-12-29 21:39:40,791 - server - INFO - ğŸ“‡ [HANGUP] Agent info keys: None
2025-12-29T21:39:41.142125294Z [err]  2025-12-29 21:39:40,791 - server - INFO - ğŸš€ Triggered QC analysis for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.143605328Z [err]  2025-12-29 21:39:40,792 - redis_service - INFO - ğŸ§¹ Deleted call data from Redis: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.143613161Z [err]  2025-12-29 21:39:40,792 - server - INFO - ğŸ§¹ Cleaned up call session from Redis and memory: v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.143623662Z [inf]  100.64.0.5:32276 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:41.143633213Z [err]  2025-12-29 21:39:40,793 - server - INFO - ğŸ” Starting QC analysis for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.143640205Z [err]  2025-12-29 21:39:40,793 - server - INFO - ğŸ” [AUTO-QC] Starting campaign QC check for call=v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-29T21:39:41.143648490Z [err]  2025-12-29 21:39:40,793 - server - INFO - ğŸ“‡ CRM update starting for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:41.143657106Z [err]  2025-12-29 21:39:40,793 - server - INFO - ğŸ“‡ Normalized phone: +17708336397
2025-12-29T21:39:41.143664706Z [err]  2025-12-29 21:39:40,793 - server - INFO - ğŸ“‡ CRM: Got 11 variables from active session
2025-12-29T21:39:41.143672651Z [err]  2025-12-29 21:39:40,883 - server - INFO - ğŸ“‡ CRM: Got 11 extracted variables
2025-12-29T21:39:41.143680173Z [err]  2025-12-29 21:39:40,883 - server - INFO - ğŸ“‡ CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-29T21:39:41.143687400Z [err]  2025-12-29 21:39:40,884 - server - INFO - ğŸ“ Converted transcript from 3 messages to 88 characters
2025-12-29T21:39:41.143695454Z [err]  2025-12-29 21:39:40,885 - server - INFO - ğŸ” [AUTO-QC] Call log found: transcript_turns=3, logs_count=4, status=completed
2025-12-29T21:39:41.145717957Z [err]  2025-12-29 21:39:40,970 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:41.145725576Z [err]  2025-12-29 21:39:40,975 - soniox_service - ERROR - âŒ Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-29T21:39:41.145730420Z [err]  2025-12-29 21:39:40,975 - server - INFO - ğŸ”Œ Telnyx WebSocket disconnected
2025-12-29T21:39:41.145734876Z [err]  2025-12-29 21:39:40,982 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=5.5s, checkin_count=0/2
2025-12-29T21:39:41.145739234Z [err]  2025-12-29 21:39:41,008 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:39:41.145746050Z [err]  2025-12-29 21:39:41,009 - server - INFO - âœ… Post-call webhook sent successfully (status=200)
2025-12-29T21:39:41.145750256Z [err]  2025-12-29 21:39:41,055 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-29T21:39:41.145754950Z [err]  2025-12-29 21:39:41,057 - server - INFO - ğŸ“‡ CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-29T21:39:41.145759590Z [err]  2025-12-29 21:39:41,085 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/d667d23c-e4fe-11f0-ac10-02420aef97a0-1767044366061007.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T213940Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=896c7d566ef50ddd3be97f6725c92ea276bd0f73eb6bbb151a09ce8a955e001f "HTTP/1.1 200 OK"
2025-12-29T21:39:41.146410070Z [err]  2025-12-29 21:39:41,142 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-29T21:39:41.146415120Z [err]  2025-12-29 21:39:41,142 - qc_agents.orchestrator - INFO - âœ… Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:41.146419708Z [err]  2025-12-29 21:39:41,142 - qc_agents.orchestrator - INFO - ğŸ” Running Commitment Detector on call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.175123087Z [err]  2025-12-29 21:39:41,173 - server - INFO - âœ… Downloaded 48526 bytes
2025-12-29T21:39:41.355429602Z [err]  2025-12-29 21:39:41,349 - server - INFO - âœ… Split into 2 channels
2025-12-29T21:39:41.355442804Z [err]  2025-12-29 21:39:41,349 - server - INFO - ğŸ¤ Using STT provider: soniox for interruption detection
2025-12-29T21:39:41.355447263Z [err]  2025-12-29 21:39:41,353 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:41.355448111Z [err]  2025-12-29 21:39:41,349 - server - INFO - ğŸ“Š Channel 0: 263164 bytes
2025-12-29T21:39:41.355453415Z [err]  2025-12-29 21:39:41,349 - server - ERROR - âŒ No Soniox API key available
2025-12-29T21:39:41.355458373Z [err]  2025-12-29 21:39:41,349 - server - INFO - âŒ Channel 0: No speech
2025-12-29T21:39:41.355463165Z [err]  2025-12-29 21:39:41,349 - server - INFO - ğŸ“Š Channel 1: 263164 bytes
2025-12-29T21:39:41.355467641Z [err]  2025-12-29 21:39:41,349 - server - ERROR - âŒ No Soniox API key available
2025-12-29T21:39:41.355471581Z [err]  2025-12-29 21:39:41,350 - server - INFO - âŒ Channel 1: No speech
2025-12-29T21:39:41.355479517Z [err]  2025-12-29 21:39:41,350 - server - WARNING - âš ï¸ No speech in any channel
2025-12-29T21:39:41.355483780Z [inf]  100.64.0.14:53582 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:41.355488117Z [err]  2025-12-29 21:39:41,351 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:39:41.355493510Z [err]  2025-12-29 21:39:41,351 - server - INFO - ğŸ” [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-29T21:39:41.355498209Z [err]  2025-12-29 21:39:41,353 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:41.355502698Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:41.357015940Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:39:41.357021789Z [err]  2025-12-29 21:39:41,353 - qc_agents.orchestrator - INFO - ğŸ—ºï¸  Running Conversion Pathfinder on call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:41.441381868Z [err]  2025-12-29 21:39:41,438 - server - INFO - ğŸ“Š [AUTO-QC] Running full QC analysis: call=v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA â†’ campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-29T21:39:41.441390013Z [err]  2025-12-29 21:39:41,438 - server - INFO - ğŸ“Š [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-29T21:39:41.441396437Z [err]  2025-12-29 21:39:41,438 - server - ERROR - âŒ [AUTO-QC] Error in campaign QC for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:39:41.441403082Z [err]  2025-12-29 21:39:41,438 - server - ERROR - âŒ [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-29T21:39:41.441410316Z [err]    File "/app/backend/server.py", line 9773, in trigger_campaign_qc_for_call
2025-12-29T21:39:41.441417119Z [err]      await run_full_qc_analysis(
2025-12-29T21:39:41.441423242Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-29T21:39:41.441524944Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:39:41.441532805Z [err]  
2025-12-29T21:39:41.518796223Z [err]  2025-12-29 21:39:41,515 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:39:41.518809984Z [err]  2025-12-29 21:39:41,516 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:41.518819729Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:41.518825565Z [err]  2025-12-29 21:39:41,516 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:41.518831405Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:39:41.518837204Z [err]  2025-12-29 21:39:41,516 - qc_agents.orchestrator - INFO - â­ Running Excellence Replicator on call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:42.213299443Z [err]  2025-12-29 21:39:41,925 - server - INFO - ğŸŒ Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T21:39:42.213305221Z [err]  2025-12-29 21:39:42,011 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:42.213310980Z [err]  2025-12-29 21:39:42,097 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:42.213317234Z [err]  2025-12-29 21:39:42,125 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:42.213323941Z [err]  2025-12-29 21:39:42,126 - telnyx_service - INFO - ğŸ“ Initiating outbound call from +14048000152 to +17708336397
2025-12-29T21:39:42.213328946Z [err]  2025-12-29 21:39:42,126 - telnyx_service - INFO - ğŸ¤– Enabling AMD (premium mode)
2025-12-29T21:39:42.213334093Z [err]  2025-12-29 21:39:42,126 - telnyx_service - INFO - ğŸŒ Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T21:39:42.487597874Z [err]  2025-12-29 21:39:42,485 - core_calling_service - INFO - â° Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-29T21:39:42.490322382Z [err]  2025-12-29 21:39:42,486 - core_calling_service - INFO - ğŸ’¬ Sending check-in #1/2: Are you still there?
2025-12-29T21:39:42.490334125Z [err]  2025-12-29 21:39:42,486 - dead_air_monitor - INFO - ğŸ’¬ Sending check-in after 7.0s silence: Are you still there?
2025-12-29T21:39:42.490343126Z [err]  2025-12-29 21:39:42,486 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:42.490350933Z [err]  2025-12-29 21:39:42,486 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA: Are you still there?...
2025-12-29T21:39:42.490357887Z [err]  2025-12-29 21:39:42,486 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-29T21:39:42.490365215Z [err]  2025-12-29 21:39:42,486 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-29T21:39:42.490371566Z [err]  2025-12-29 21:39:42,486 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-29T21:39:42.490381333Z [err]  2025-12-29 21:39:42,486 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-29T21:39:42.490387936Z [err]  2025-12-29 21:39:42,487 - server - INFO - ğŸ’¾ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-29T21:39:42.490394837Z [err]  2025-12-29 21:39:42,487 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.00s
2025-12-29T21:39:42.490402848Z [err]  2025-12-29 21:39:42,487 - telnyx_service - INFO - âœ… Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:42.490410729Z [err]  2025-12-29 21:39:42,487 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:43.156568271Z [err]  2025-12-29 21:39:42,754 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.27s
2025-12-29T21:39:43.156569801Z [err]  2025-12-29 21:39:42,839 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:43.156578397Z [err]  2025-12-29 21:39:42,754 - telnyx_service - ERROR - âŒ Telnyx playback failed: 422 - {
2025-12-29T21:39:43.156585163Z [err]    "errors": [
2025-12-29T21:39:43.156592591Z [err]      {
2025-12-29T21:39:43.156598312Z [err]        "code": "90018",
2025-12-29T21:39:43.156604918Z [err]        "title": "Call has already ended",
2025-12-29T21:39:43.156610543Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:39:43.156616822Z [err]      }
2025-12-29T21:39:43.156623158Z [err]    ]
2025-12-29T21:39:43.156630139Z [err]  }
2025-12-29T21:39:43.156636875Z [err]  2025-12-29 21:39:42,755 - telnyx_service - INFO - ğŸ“¢ Using Telnyx built-in TTS
2025-12-29T21:39:43.156643719Z [err]  2025-12-29 21:39:42,836 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-29T21:39:43.156645973Z [err]  2025-12-29 21:39:42,754 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:43.156651622Z [err]  2025-12-29 21:39:42,837 - telnyx_service - INFO - âœ… Call initiated: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:43.156657892Z [err]  2025-12-29 21:39:42,838 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:39:43.156663742Z [err]  2025-12-29 21:39:42,839 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:39:43.156670173Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:43.159988576Z [err]  2025-12-29 21:39:42,925 - server - INFO - ğŸ” DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-29T21:39:43.160023539Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:39:43.160028751Z [err]  2025-12-29 21:39:42,925 - server - INFO - ğŸ“ Created call log: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:43.160035274Z [err]  2025-12-29 21:39:42,925 - server - INFO - ğŸ” DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:39:43.160076523Z [inf]  100.64.0.12:25232 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-29T21:39:43.160078344Z [err]  2025-12-29 21:39:42,925 - server - INFO - ğŸ“¤ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:39:43.160085997Z [err]  2025-12-29 21:39:42,944 - qc_agents.orchestrator - INFO - âœ… QC analysis stored for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:43.160087880Z [err]  2025-12-29 21:39:42,931 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (TTL: 3600s)
2025-12-29T21:39:43.160091836Z [err]  2025-12-29 21:39:42,944 - server - INFO - âœ… QC analysis completed for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:43.160101246Z [err]  2025-12-29 21:39:42,932 - server - INFO - ğŸ“¦ Call data stored in Redis and memory
2025-12-29T21:39:43.160135297Z [err]  2025-12-29 21:39:42,944 - server - INFO - ğŸ“Š Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-29T21:39:43.160142850Z [err]  2025-12-29 21:39:43,021 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:43.160149494Z [err]  2025-12-29 21:39:43,022 - telnyx_service - ERROR - âŒ Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:39:43.160157369Z [err]  2025-12-29 21:39:42,932 - server - INFO - ğŸ“ Outbound call initiated: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:43.160173634Z [err]  2025-12-29 21:39:42,925 - server - INFO - ğŸ” DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:39:43.162323525Z [err]  2025-12-29 21:39:43,022 - dead_air_monitor - INFO - âœ… Check-in message sent
2025-12-29T21:39:43.162328458Z [err]  2025-12-29 21:39:43,105 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:39:43.162333677Z [err]  2025-12-29 21:39:43,106 - server - INFO - âœ… Call-initiated webhook sent successfully (status=200)
2025-12-29T21:39:43.162338163Z [err]  2025-12-29 21:39:43,133 - server - INFO - ğŸ”ŒğŸ”ŒğŸ”Œ WEBSOCKET CONNECTION ATTEMPT
2025-12-29T21:39:43.162343022Z [err]  2025-12-29 21:39:43,133 - server - INFO -    Client: Address(host='100.64.0.14', port=53586)
2025-12-29T21:39:43.162350380Z [err]  2025-12-29 21:39:43,133 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'SwnTGJ7azzLEQjPRAGvkMw==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'W7uJ108gRwCMGz7GxtoGcA', 'x-real-ip': '192.76.120.151', 'x-request-start': '1767044382843', 'accept-encoding': 'gzip'}
2025-12-29T21:39:43.162355820Z [err]  2025-12-29 21:39:43,133 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-29T21:39:43.162360563Z [err]  2025-12-29 21:39:43,133 - server - INFO - ğŸ”Œ Incoming Telnyx WebSocket connection
2025-12-29T21:39:43.162365157Z [err]  [2025-12-29 21:39:43 +0000] [6] [INFO] ('100.64.0.14', 53586) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-29T21:39:43.162370282Z [err]  2025-12-29 21:39:43,133 - server - INFO - âœ… WebSocket accepted, waiting for Telnyx events
2025-12-29T21:39:43.162374692Z [err]  [2025-12-29 21:39:43 +0000] [6] [INFO] connection open
2025-12-29T21:39:43.162379065Z [err]  2025-12-29 21:39:43,137 - server - INFO - ğŸ“Š Updated campaign_calls with QC scores for v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:43.204524451Z [err]  2025-12-29 21:39:43,199 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:43.204534805Z [err]  2025-12-29 21:39:43,199 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.initiated', 'id': '7a845211-7201-4ddb-a533-b205d0bc35d4', 'occurred_at': '2025-12-29T21:39:42.663963Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:43.204542386Z [err]  2025-12-29 21:39:43,199 - server - INFO - ğŸ¯ Event type: call.initiated, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:43.204549230Z [err]  2025-12-29 21:39:43,199 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:43.204559409Z [err]  2025-12-29 21:39:43,199 - server - INFO - ğŸ“ Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-29T21:39:43.204567192Z [inf]  100.64.0.9:33454 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:43.291328699Z [err]  2025-12-29 21:39:43,288 - server - INFO - ğŸ“¬ Received Telnyx event: connected
2025-12-29T21:39:43.291334942Z [err]  2025-12-29 21:39:43,288 - server - INFO - ğŸ“ Telnyx connected event received, waiting for 'start'...
2025-12-29T21:39:43.315938564Z [err]  2025-12-29 21:39:43,311 - server - INFO - ğŸ“ˆ Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-29T21:39:43.406930401Z [err]  2025-12-29 21:39:43,400 - server - INFO - ğŸ·ï¸ Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-29T21:39:43.406941025Z [err]  2025-12-29 21:39:43,400 - server - ERROR - âŒ Error in auto appointment detection for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA: 'str' object has no attribute 'get'
2025-12-29T21:39:43.527717927Z [err]  2025-12-29 21:39:43,524 - dead_air_monitor - INFO - ğŸš© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-29T21:39:43.527723224Z [err]  2025-12-29 21:39:43,524 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044383.524147 for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:43.527730577Z [err]  2025-12-29 21:39:43,524 - core_calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:46.196297870Z [err]  2025-12-29 21:39:45,740 - server - INFO - ğŸ“¬ Received Telnyx event: start
2025-12-29T21:39:46.196304714Z [err]  2025-12-29 21:39:45,740 - server - INFO - ğŸ¬ Stream started for call: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.196309886Z [err]  2025-12-29 21:39:45,747 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.196315426Z [err]  2025-12-29 21:39:45,748 - server - INFO - âœ… Call data found after 0s wait
2025-12-29T21:39:46.196321531Z [err]  2025-12-29 21:39:45,748 - server - INFO - â³ Session not found locally, waiting briefly for webhook...
2025-12-29T21:39:46.196326787Z [err]  2025-12-29 21:39:45,762 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:46.196332060Z [err]  2025-12-29 21:39:45,762 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.answered', 'id': 'aec0fe05-9f84-407f-9f6e-b2756d39b9e2', 'occurred_at': '2025-12-29T21:39:45.483977Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-29T21:39:42.663963Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:46.196337005Z [err]  2025-12-29 21:39:45,762 - server - INFO - ğŸ¯ Event type: call.answered, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.196342266Z [err]  2025-12-29 21:39:45,762 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:46.196349318Z [err]  2025-12-29 21:39:45,762 - server - INFO - âœ… Call answered: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.201700561Z [err]  2025-12-29 21:39:45,767 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.201705101Z [err]  2025-12-29 21:39:45,768 - server - INFO - âœ… Found call in Redis (multi-worker state sharing working)
2025-12-29T21:39:46.201710016Z [err]  2025-12-29 21:39:45,768 - server - INFO - ğŸ“ Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-29T21:39:46.201715103Z [err]  2025-12-29 21:39:45,861 - server - INFO - âœ… Call log updated
2025-12-29T21:39:46.201719658Z [err]  2025-12-29 21:39:45,861 - server - INFO - ğŸ” DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:39:46.201723970Z [err]  2025-12-29 21:39:45,861 - server - INFO - ğŸ“¤ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:39:46.201729257Z [err]  2025-12-29 21:39:45,861 - server - INFO - ğŸ”§ Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:46.201733768Z [err]  2025-12-29 21:39:45,947 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:46.201738300Z [err]  2025-12-29 21:39:46,026 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:39:46.201742996Z [err]  2025-12-29 21:39:46,027 - server - INFO - âœ… Call-started webhook sent successfully (status=200)
2025-12-29T21:39:46.201748157Z [err]  2025-12-29 21:39:46,033 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:46.201753137Z [err]  2025-12-29 21:39:46,033 - server - INFO - ğŸ”§ Creating Telnyx service with user's keys...
2025-12-29T21:39:46.201758125Z [err]  2025-12-29 21:39:46,058 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:46.204447639Z [err]  2025-12-29 21:39:46,163 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:46.204478192Z [err]  2025-12-29 21:39:46,163 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'streaming.started', 'id': '8367fc21-40dd-4852-b974-a6378eab7eb0', 'occurred_at': '2025-12-29T21:39:45.843962Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': 'd484b5a0-988c-4d67-9ec0-a1847f8ba7ac', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:46.204483498Z [err]  2025-12-29 21:39:46,163 - server - INFO - ğŸ¯ Event type: streaming.started, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.204488573Z [err]  2025-12-29 21:39:46,163 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:46.204493561Z [inf]  100.64.0.5:10352 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:46.253663117Z [err]  2025-12-29 21:39:46,249 - server - INFO - âš ï¸ Session still not found after wait, will create in worker
2025-12-29T21:39:46.253673056Z [err]  2025-12-29 21:39:46,249 - server - WARNING - âš ï¸ Session not found after waiting, creating in WebSocket worker...
2025-12-29T21:39:46.259666577Z [err]  2025-12-29 21:39:46,255 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.259673408Z [err]  2025-12-29 21:39:46,257 - server - INFO - ğŸ“ Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:46.259678674Z [err]  2025-12-29 21:39:46,257 - core_calling_service - INFO - ğŸ” Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T21:39:46.347728996Z [err]  2025-12-29 21:39:46,345 - core_calling_service - INFO - ğŸ” KB count query completed: 4 items
2025-12-29T21:39:46.347737838Z [err]  2025-12-29 21:39:46,345 - core_calling_service - INFO - ğŸ“š Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T21:39:46.347744457Z [err]  2025-12-29 21:39:46,345 - core_calling_service - INFO - ğŸ“‹ Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T21:39:46.347757498Z [err]  2025-12-29 21:39:46,345 - core_calling_service - INFO - ğŸ“š KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T21:39:46.347762784Z [err]  2025-12-29 21:39:46,345 - core_calling_service - INFO - ğŸ”¥ Pre-warming LLM client (grok)...
2025-12-29T21:39:46.353953849Z [err]  2025-12-29 21:39:46,351 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw/actions/playback_start "HTTP/1.1 200 OK"
2025-12-29T21:39:46.356430112Z [err]  2025-12-29 21:39:46,352 - telnyx_service - INFO - âœ… Playing audio from URL, playback_id: OQ6dK3i3pw (loop=True, overlay=True)
2025-12-29T21:39:46.356437145Z [err]  2025-12-29 21:39:46,352 - server - WARNING - âš ï¸ Failed to start comfort noise: 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw'
2025-12-29T21:39:46.356442341Z [err]  2025-12-29 21:39:46,352 - telnyx_service - INFO - ğŸ™ï¸ Starting recording: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.436628501Z [err]  2025-12-29 21:39:46,432 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:46.447926510Z [err]  2025-12-29 21:39:46,444 - core_calling_service - INFO - âœ… LLM client pre-warmed in 98ms
2025-12-29T21:39:46.447935255Z [err]  2025-12-29 21:39:46,444 - server - INFO - âœ… Session created in WebSocket worker
2025-12-29T21:39:46.447940863Z [err]  2025-12-29 21:39:46,444 - server - INFO - â±ï¸ [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-29T21:39:46.447946300Z [err]  2025-12-29 21:39:46,444 - server - INFO - â±ï¸ [WebSocket Worker] Silence timeout task scheduled!
2025-12-29T21:39:46.447952235Z [err]  2025-12-29 21:39:46,444 - server - INFO - ğŸ“ Call data loaded, starting SONIOX connection...
2025-12-29T21:39:46.447957769Z [err]  2025-12-29 21:39:46,445 - server - INFO - âœ… Initialized call_states for v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw with session reference
2025-12-29T21:39:46.450854919Z [err]  2025-12-29 21:39:46,446 - server - INFO - â±ï¸ [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-29T21:39:46.540234350Z [err]  2025-12-29 21:39:46,536 - server - INFO - ğŸ”‘ Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-29T21:39:46.599553229Z [err]  2025-12-29 21:39:46,594 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:46.599562173Z [err]  2025-12-29 21:39:46,594 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.started', 'id': '5b79edbe-dc73-4d0b-94aa-aa4acf987d7d', 'occurred_at': '2025-12-29T21:39:46.263969Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'OQ6dK3i3pw', 'start_time': '2025-12-29T21:39:46.263969Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:46.599567960Z [err]  2025-12-29 21:39:46,594 - server - INFO - ğŸ¯ Event type: call.playback.started, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.599572435Z [err]  2025-12-29 21:39:46,594 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:46.599577155Z [inf]  100.64.0.16:36860 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:46.641691671Z [err]  2025-12-29 21:39:46,640 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw/actions/record_start "HTTP/1.1 200 OK"
2025-12-29T21:39:46.643768795Z [err]  2025-12-29 21:39:46,641 - server - INFO - ğŸ™ï¸ Call recording started for v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:46.643775292Z [err]  2025-12-29 21:39:46,641 - server - INFO - ğŸ”§ Creating call session for v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw...
2025-12-29T21:39:46.643780704Z [err]  2025-12-29 21:39:46,641 - server - INFO - ğŸ” Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:39:46.643785959Z [err]  2025-12-29 21:39:46,641 - server - INFO - ğŸ”§ Calling create_call_session() - START
2025-12-29T21:39:46.643790911Z [err]  2025-12-29 21:39:46,641 - core_calling_service - INFO - ğŸ” Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T21:39:47.153794963Z [err]  2025-12-29 21:39:46,727 - core_calling_service - INFO - ğŸ” KB count query completed: 4 items
2025-12-29T21:39:47.153802131Z [err]  2025-12-29 21:39:46,727 - core_calling_service - INFO - ğŸ“š Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T21:39:47.153810151Z [err]  2025-12-29 21:39:46,727 - core_calling_service - INFO - ğŸ“‹ Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T21:39:47.153818009Z [err]  2025-12-29 21:39:46,727 - core_calling_service - INFO - ğŸ“š KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T21:39:47.153829220Z [err]  2025-12-29 21:39:46,727 - core_calling_service - INFO - ğŸ”¥ Pre-warming LLM client (grok)...
2025-12-29T21:39:47.153836137Z [err]  2025-12-29 21:39:46,826 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:47.153843471Z [err]  2025-12-29 21:39:46,835 - core_calling_service - INFO - âœ… LLM client pre-warmed in 107ms
2025-12-29T21:39:47.153850857Z [err]  2025-12-29 21:39:46,835 - server - INFO - ğŸ”§ Calling create_call_session() - COMPLETE
2025-12-29T21:39:47.153858249Z [err]  2025-12-29 21:39:46,835 - server - INFO - âœ… Session object created: CallSession
2025-12-29T21:39:47.153865129Z [err]  2025-12-29 21:39:46,841 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (TTL: 3600s)
2025-12-29T21:39:47.153874876Z [err]  2025-12-29 21:39:46,841 - server - INFO - âœ… Serializable call_data synced to Redis (agent_id, user_id)
2025-12-29T21:39:47.153882208Z [err]  2025-12-29 21:39:46,841 - server - INFO - âœ… Session stored in worker memory (not Redis)
2025-12-29T21:39:47.153890801Z [err]  2025-12-29 21:39:46,842 - redis_service - INFO - âœ… Marked session ready in Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:47.153898367Z [err]  2025-12-29 21:39:46,842 - server - INFO - ğŸ¤– AI session created for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:47.157895734Z [err]  2025-12-29 21:39:46,842 - server - INFO - ğŸ“¦ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-29T21:39:47.157903299Z [err]  2025-12-29 21:39:46,842 - server - INFO - â­ï¸ Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-29T21:39:47.157911865Z [err]  2025-12-29 21:39:46,842 - server - INFO - ğŸ‘¤ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-29T21:39:47.157926359Z [err]  2025-12-29 21:39:46,842 - server - INFO - ğŸ‘‚ User speaks first - waiting for user input...
2025-12-29T21:39:47.157933342Z [err]  2025-12-29 21:39:46,842 - server - INFO - ğŸ›¡ï¸ Voicemail timeout protection started (15000ms)
2025-12-29T21:39:47.157940570Z [err]  2025-12-29 21:39:46,842 - server - INFO - â±ï¸ AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-29T21:39:47.157947794Z [err]  2025-12-29 21:39:46,842 - server - INFO - ğŸ¤ Voice flow - streaming started via dial command
2025-12-29T21:39:47.157954671Z [err]  2025-12-29 21:39:46,847 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:47.157961681Z [err]  2025-12-29 21:39:46,848 - server - INFO - ğŸ¤ No greeting - waiting for user to speak first
2025-12-29T21:39:47.157974879Z [err]  2025-12-29 21:39:46,848 - server - INFO - ğŸ¤ Voice flow - WebSocket streaming already initiated
2025-12-29T21:39:47.157984304Z [inf]  100.64.0.9:33454 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:47.157994245Z [err]  2025-12-29 21:39:47,033 - soniox_service - INFO - âœ… Connected to Soniox Real-Time STT
2025-12-29T21:39:47.158009414Z [err]  2025-12-29 21:39:47,034 - soniox_service - INFO - âš™ï¸  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-29T21:39:47.164471342Z [err]  2025-12-29 21:39:47,034 - soniox_service - INFO - âš™ï¸  Endpoint detection: True, Speaker diarization: False
2025-12-29T21:39:47.164475930Z [err]  2025-12-29 21:39:47,056 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:47.164480603Z [err]  2025-12-29 21:39:47,056 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring started for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:47.164485409Z [err]  2025-12-29 21:39:47,057 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:47.164491879Z [err]  2025-12-29 21:39:47,058 - server - INFO - âœ… Started forwarding audio (8kHz mulaw â†’ Soniox, NO BUFFERING)
2025-12-29T21:39:47.564948081Z [err]  2025-12-29 21:39:47,559 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:48.196734153Z [err]  2025-12-29 21:39:48,061 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:48.454325476Z [err]  2025-12-29 21:39:48,450 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:48.457138719Z [err]  2025-12-29 21:39:48,455 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:48.465890806Z [err]  2025-12-29 21:39:48,463 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (TTL: 3600s)
2025-12-29T21:39:48.465899598Z [err]  2025-12-29 21:39:48,463 - server - INFO - â±ï¸ [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-29T21:39:48.465918595Z [err]  2025-12-29 21:39:48,463 - core_calling_service - INFO - â±ï¸ [21:39:48.463] ğŸ“¥ process_user_input() ENTRY - text: '...'
2025-12-29T21:39:48.471101865Z [err]  2025-12-29 21:39:48,467 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:48.471109438Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - â±ï¸ [21:39:48.467] â© About to call _process_call_flow_streaming()
2025-12-29T21:39:48.471115810Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - â±ï¸ [21:39:48.468] ğŸ”€ Agent type: call_flow, calling flow processor...
2025-12-29T21:39:48.471123656Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - â±ï¸ [21:39:48.468] ğŸ”€ _process_call_flow_streaming() ENTRY
2025-12-29T21:39:48.471131533Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-29T21:39:48.471137761Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - â±ï¸ [21:39:48.468] âœ… Node selected, about to process content...
2025-12-29T21:39:48.471144943Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ğŸ”§ Replaced {{now}} with Monday, December 29, 2025 at 4:39 PM EST in content
2025-12-29T21:39:48.471152124Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ğŸ”§ Replaced {{customer_name}} with Kendrick in content
2025-12-29T21:39:48.471157988Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ğŸ”§ Replaced {{callerName}} with  in content
2025-12-29T21:39:48.471163379Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ğŸ”§ Replaced {{lead_id}} with None in content
2025-12-29T21:39:48.471168679Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ğŸ”§ Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T21:39:48.471174024Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ğŸ”§ Replaced {{track_keywords}} with  in content
2025-12-29T21:39:48.471179707Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ğŸ”§ Replaced {{expected_commitment}} with not_specified in content
2025-12-29T21:39:48.473482175Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ğŸ”§ Replaced {{to_number}} with +17708336397 in content
2025-12-29T21:39:48.473491440Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ğŸ”§ Replaced {{phone_number}} with +17708336397 in content
2025-12-29T21:39:48.473496283Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ğŸ”§ Replaced {{email}} with None in content
2025-12-29T21:39:48.473501297Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - âœ… Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-29T21:39:48.473506317Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-29T21:39:48.473512063Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ğŸ“š skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-29T21:39:48.473518042Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - â±ï¸ [21:39:48.468] ğŸ“„ About to process content (mode=script, length=9)
2025-12-29T21:39:48.473524282Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ğŸ”Š Silence tracking reset for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (user responded)
2025-12-29T21:39:48.473530286Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - âœ… User responded to regular message, resetting counter
2025-12-29T21:39:48.473537873Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - ğŸ’¾ Storing node ID 2 in conversation history
2025-12-29T21:39:48.473543645Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - LLM response (0.00s): Kendrick?
2025-12-29T21:39:48.473549125Z [err]  2025-12-29 21:39:48,468 - core_calling_service - INFO - Total latency: 0.00s
2025-12-29T21:39:48.473554617Z [err]  2025-12-29 21:39:48,468 - server - INFO - ğŸ’¬ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-29T21:39:48.572647587Z [err]  2025-12-29 21:39:48,563 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:48.572666867Z [err]  2025-12-29 21:39:48,567 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:48.572673184Z [err]  2025-12-29 21:39:48,568 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw: Kendrick?...
2025-12-29T21:39:48.572678191Z [err]  2025-12-29 21:39:48,569 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-29T21:39:48.572682982Z [err]  2025-12-29 21:39:48,569 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-29T21:39:48.572688939Z [err]  2025-12-29 21:39:48,569 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-29T21:39:48.572696648Z [err]  2025-12-29 21:39:48,569 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-29T21:39:48.572701595Z [err]  2025-12-29 21:39:48,569 - server - INFO - â±ï¸ [21:39:48.569] ğŸ”Š TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-29T21:39:48.572706878Z [err]  2025-12-29 21:39:48,569 - server - INFO - âš¡ Using Turbo v2.5 (high quality)
2025-12-29T21:39:48.572712028Z [err]  2025-12-29 21:39:48,569 - server - INFO - ğŸ™ï¸ ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-29T21:39:48.660587084Z [err]  2025-12-29 21:39:48,656 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:48.660598341Z [err]  2025-12-29 21:39:48,657 - server - INFO - ğŸ“¦ ElevenLabs Request Payload:
2025-12-29T21:39:48.660605608Z [err]  2025-12-29 21:39:48,657 - server - INFO -    Text length: 9 chars
2025-12-29T21:39:48.660614852Z [err]  2025-12-29 21:39:48,657 - server - INFO -    Text content: 'Kendrick?'
2025-12-29T21:39:48.660620115Z [err]  2025-12-29 21:39:48,657 - server - INFO -    Text bytes: b'Kendrick?'
2025-12-29T21:39:48.660625516Z [err]  2025-12-29 21:39:48,657 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-29T21:39:48.660630056Z [err]  2025-12-29 21:39:48,657 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-29T21:39:48.660635424Z [err]  2025-12-29 21:39:48,657 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-29T21:39:48.660640790Z [err]  2025-12-29 21:39:48,657 - server - INFO -    Full data: {'text': 'Kendrick?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-29T21:39:48.660646871Z [err]  2025-12-29 21:39:48,657 - server - INFO - ğŸ”Œ Attempting ElevenLabs connection (attempt 1/2)
2025-12-29T21:39:48.660651403Z [err]  2025-12-29 21:39:48,657 - server - INFO -    Timeout: 10.0s
2025-12-29T21:39:48.670045648Z [err]  2025-12-29 21:39:48,666 - server - INFO -    âœ“ HTTP client created (0.009s)
2025-12-29T21:39:48.670051746Z [err]  2025-12-29 21:39:48,666 - server - INFO -    â†’ Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-29T21:39:49.296241063Z [err]  2025-12-29 21:39:48,992 - server - INFO -    âœ“ Connection established (0.335s) [TARGET: <200ms]
2025-12-29T21:39:49.296256875Z [err]  2025-12-29 21:39:48,992 - server - INFO -    âœ“ Response status: 200
2025-12-29T21:39:49.296265269Z [err]  2025-12-29 21:39:48,992 - server - INFO -    â†’ Streaming audio chunks...
2025-12-29T21:39:49.296272576Z [err]  2025-12-29 21:39:49,000 - server - INFO -    âœ“ FIRST CHUNK received (0.343s, 1160 bytes) [TARGET: <300ms]
2025-12-29T21:39:49.296280648Z [err]  2025-12-29 21:39:49,002 - server - INFO -    âœ“ ALL CHUNKS received: 46 chunks (0.345s)
2025-12-29T21:39:49.296292474Z [err]  2025-12-29 21:39:49,002 - server - INFO -    âœ“ Total audio size: 12583 bytes
2025-12-29T21:39:49.296352122Z [err]  2025-12-29 21:39:48,991 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-29T21:39:49.296441682Z [err]  2025-12-29 21:39:49,002 - server - INFO -    ğŸ“Š TTS API TIMING BREAKDOWN:
2025-12-29T21:39:49.296453064Z [err]  2025-12-29 21:39:49,002 - server - INFO -       - Connection: 335ms
2025-12-29T21:39:49.296461149Z [err]  2025-12-29 21:39:49,002 - server - INFO -       - First chunk: 343ms
2025-12-29T21:39:49.296468465Z [err]  2025-12-29 21:39:49,002 - server - INFO -       - All chunks: 345ms
2025-12-29T21:39:49.296475174Z [err]  2025-12-29 21:39:49,002 - server - INFO -       - Audio generation only: 8ms
2025-12-29T21:39:49.296482757Z [err]  2025-12-29 21:39:49,002 - server - INFO - â±ï¸ [21:39:49.002] ğŸ”Š TTS COMPLETE: 433ms, audio_size=12583 bytes
2025-12-29T21:39:49.296490372Z [err]  2025-12-29 21:39:49,002 - server - INFO - ğŸ’¾ TTS CACHED: elevenlabs:Kendrick?... (12583 bytes)
2025-12-29T21:39:49.296496952Z [err]  2025-12-29 21:39:49,002 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.43s
2025-12-29T21:39:49.296503824Z [err]  2025-12-29 21:39:49,003 - telnyx_service - INFO - âœ… Generated 12583 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-29T21:39:49.300707397Z [err]  2025-12-29 21:39:49,003 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-29T21:39:49.300717950Z [err]  2025-12-29 21:39:49,065 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:49.320823715Z [err]  2025-12-29 21:39:49,317 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw/actions/playback_start "HTTP/1.1 200 OK"
2025-12-29T21:39:49.324463118Z [err]  2025-12-29 21:39:49,318 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.32s
2025-12-29T21:39:49.324471306Z [err]  2025-12-29 21:39:49,318 - telnyx_service - INFO - â±ï¸  Total TTS latency: 0.75s
2025-12-29T21:39:49.324479712Z [err]  2025-12-29 21:39:49,318 - telnyx_service - INFO - âœ… Playing elevenlabs audio via Telnyx playback
2025-12-29T21:39:49.324484753Z [err]  2025-12-29 21:39:49,318 - telnyx_service - INFO - ğŸ¬ Playback ID: vNxrFPEvqQ
2025-12-29T21:39:49.324492291Z [err]  2025-12-29 21:39:49,318 - server - INFO - ğŸ”Š [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-29T21:39:49.324497455Z [err]  2025-12-29 21:39:49,318 - server - INFO - â±ï¸ [WebSocket Worker] Greeting playback started at 1767044389.3188646
2025-12-29T21:39:49.324502458Z [err]  2025-12-29 21:39:49,318 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044389.3188927 for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:49.324507096Z [err]  2025-12-29 21:39:49,318 - server - INFO - â±ï¸ [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-29T21:39:49.522623997Z [err]  2025-12-29 21:39:49,518 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:49.522631516Z [err]  2025-12-29 21:39:49,518 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.started', 'id': 'c846ca37-6fd8-46ca-ba51-fcf83864fe54', 'occurred_at': '2025-12-29T21:39:49.343965Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'vNxrFPEvqQ'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:49.522636319Z [err]  2025-12-29 21:39:49,518 - server - INFO - ğŸ¯ Event type: call.playback.started, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:49.522640967Z [err]  2025-12-29 21:39:49,518 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:49.522644890Z [inf]  100.64.0.5:10352 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:49.570194441Z [err]  2025-12-29 21:39:49,565 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:50.174211669Z [err]  2025-12-29 21:39:50,041 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=6.5s, checkin_count=1/2
2025-12-29T21:39:50.174222284Z [err]  2025-12-29 21:39:50,067 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:50.174228585Z [err]  2025-12-29 21:39:50,067 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=0.7s, checkin_count=0/2
2025-12-29T21:39:50.366972772Z [err]  2025-12-29 21:39:50,360 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:50.366982238Z [err]  2025-12-29 21:39:50,361 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'e24e05d4-d0ad-45b6-a76b-38102d900c09', 'occurred_at': '2025-12-29T21:39:50.183965Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'vNxrFPEvqQ', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:50.366989249Z [err]  2025-12-29 21:39:50,361 - server - INFO - ğŸ¯ Event type: call.playback.ended, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:50.366994895Z [err]  2025-12-29 21:39:50,361 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:50.367001699Z [err]  2025-12-29 21:39:50,363 - redis_service - INFO - â– Removed playback vNxrFPEvqQ, 0 remaining for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:50.367008952Z [err]  2025-12-29 21:39:50,363 - server - INFO - ğŸ”Š Redis: Removed playback vNxrFPEvqQ, 0 remaining
2025-12-29T21:39:50.367015438Z [err]  2025-12-29 21:39:50,363 - server - INFO - ğŸ”Š ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T21:39:50.367021632Z [err]  2025-12-29 21:39:50,364 - server - INFO - âœ… Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T21:39:50.367027673Z [err]  2025-12-29 21:39:50,364 - server - INFO - ğŸ’¡ Session not on this worker - Redis flag set for WebSocket worker to handle
2025-12-29T21:39:50.369378135Z [inf]  100.64.0.16:36860 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:50.550202257Z [err]  2025-12-29 21:39:50,542 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=7.0s, checkin_count=1/2
2025-12-29T21:39:50.550208217Z [err]  2025-12-29 21:39:50,542 - core_calling_service - INFO - â° Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-29T21:39:50.550214147Z [err]  2025-12-29 21:39:50,543 - core_calling_service - INFO - ğŸ’¬ Sending FINAL check-in #2/2: Are you still there?
2025-12-29T21:39:50.550219985Z [err]  2025-12-29 21:39:50,543 - core_calling_service - INFO - âš ï¸ Will end call if no response after next silence timeout
2025-12-29T21:39:50.550226469Z [err]  2025-12-29 21:39:50,543 - dead_air_monitor - INFO - ğŸ’¬ Sending check-in after 7.0s silence: Are you still there?
2025-12-29T21:39:50.550233379Z [err]  2025-12-29 21:39:50,543 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:50.550238874Z [err]  2025-12-29 21:39:50,543 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA: Are you still there?...
2025-12-29T21:39:50.550244577Z [err]  2025-12-29 21:39:50,543 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-29T21:39:50.550250370Z [err]  2025-12-29 21:39:50,543 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-29T21:39:50.550255970Z [err]  2025-12-29 21:39:50,543 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-29T21:39:50.550266323Z [err]  2025-12-29 21:39:50,543 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-29T21:39:50.550272406Z [err]  2025-12-29 21:39:50,543 - server - INFO - ğŸ’¾ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-29T21:39:50.550278065Z [err]  2025-12-29 21:39:50,543 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.00s
2025-12-29T21:39:50.550283648Z [err]  2025-12-29 21:39:50,543 - telnyx_service - INFO - âœ… Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:50.551720582Z [err]  2025-12-29 21:39:50,543 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:39:50.572337293Z [err]  2025-12-29 21:39:50,569 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:50.572348909Z [err]  2025-12-29 21:39:50,570 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=1.3s, checkin_count=0/2
2025-12-29T21:39:51.272285737Z [err]  2025-12-29 21:39:50,964 - server - INFO - ğŸ¯ Event type: call.machine.premium.detection.ended, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:51.272308110Z [err]  2025-12-29 21:39:50,756 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:51.272317527Z [err]      {
2025-12-29T21:39:51.272318288Z [err]  2025-12-29 21:39:50,757 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.21s
2025-12-29T21:39:51.272331394Z [err]  2025-12-29 21:39:50,757 - telnyx_service - ERROR - âŒ Telnyx playback failed: 422 - {
2025-12-29T21:39:51.272333248Z [err]        "code": "90018",
2025-12-29T21:39:51.272342194Z [err]    "errors": [
2025-12-29T21:39:51.272344781Z [err]        "title": "Call has already ended",
2025-12-29T21:39:51.272350549Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:39:51.272356067Z [err]      }
2025-12-29T21:39:51.272362021Z [err]    ]
2025-12-29T21:39:51.272367800Z [err]  }
2025-12-29T21:39:51.272373218Z [err]  2025-12-29 21:39:50,757 - telnyx_service - INFO - ğŸ“¢ Using Telnyx built-in TTS
2025-12-29T21:39:51.272379853Z [err]  2025-12-29 21:39:50,964 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:51.272387152Z [err]  2025-12-29 21:39:50,964 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': '594f2e44-9c3f-4476-93c8-6c8adfcf4022', 'occurred_at': '2025-12-29T21:39:50.783965Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'silence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:51.277242033Z [err]  2025-12-29 21:39:50,964 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:51.277249300Z [inf]  100.64.0.9:33454 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:51.277256365Z [err]  2025-12-29 21:39:51,032 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:39:51.277262960Z [err]  2025-12-29 21:39:51,033 - telnyx_service - ERROR - âŒ Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:39:51.277269427Z [err]  2025-12-29 21:39:51,033 - dead_air_monitor - INFO - âœ… Check-in message sent
2025-12-29T21:39:51.277279083Z [err]  2025-12-29 21:39:51,071 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:51.575099351Z [err]  2025-12-29 21:39:51,573 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:52.241474231Z [err]  2025-12-29 21:39:52,066 - server - INFO - ğŸ“¤ Audio flowing: 294 packets sent to Soniox (5s update)
2025-12-29T21:39:52.241482526Z [err]  2025-12-29 21:39:52,074 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:52.578810457Z [err]  2025-12-29 21:39:52,575 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:53.254760752Z [err]  2025-12-29 21:39:53,077 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:53.581981067Z [err]  2025-12-29 21:39:53,578 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:54.240414291Z [err]  2025-12-29 21:39:54,079 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:54.428501370Z [err]  2025-12-29 21:39:54,423 - server - INFO - ğŸ”¤ RAW TOKENS: ["Ye"?]
2025-12-29T21:39:54.428507829Z [err]  2025-12-29 21:39:54,426 - core_calling_service - INFO - â±ï¸ SILENCE TIMER RESET (user started speaking) for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:54.428517580Z [err]  2025-12-29 21:39:54,426 - core_calling_service - INFO - ğŸ”Š Silence timer reset for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (user started speaking)
2025-12-29T21:39:54.428521792Z [err]  2025-12-29 21:39:54,426 - core_calling_service - INFO - ğŸ‘¤ User started speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:54.428526399Z [err]  2025-12-29 21:39:54,426 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-29T21:39:54.428531213Z [err]  2025-12-29 21:39:54,426 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'Ye' | Generating: False
2025-12-29T21:39:54.559503147Z [err]  2025-12-29 21:39:54,556 - server - INFO - ğŸ”¤ RAW TOKENS: ["Ye"âœ“, "ah."âœ“, "<end>"âœ“]
2025-12-29T21:39:54.559508472Z [err]  2025-12-29 21:39:54,556 - server - INFO - ğŸ¯ Endpoint detected: <end> token received
2025-12-29T21:39:54.559514302Z [err]  2025-12-29 21:39:54,557 - server - INFO - ğŸ§¹ Cleaned transcript: 'Ye ah.' -> 'Yeah.'
2025-12-29T21:39:54.559520510Z [err]  2025-12-29 21:39:54,557 - server - INFO - ğŸ“¥ FINAL TOKENS: 'Yeah.' (2 tokens)
2025-12-29T21:39:54.559525442Z [err]  2025-12-29 21:39:54,557 - server - INFO - ğŸ¤ Soniox final transcript: 'Yeah.'
2025-12-29T21:39:54.559531261Z [err]  2025-12-29 21:39:54,557 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:54.559537325Z [err]  2025-12-29 21:39:54,557 - server - INFO - ğŸ” FILTER CHECK: words=1, is_filler=True, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-29T21:39:54.561318464Z [err]  2025-12-29 21:39:54,559 - server - INFO - ğŸ‘¤ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-29T21:39:54.561326158Z [err]  2025-12-29 21:39:54,559 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:54.561331934Z [err]  2025-12-29 21:39:54,559 - server - INFO - âœ… Agent SILENT - User said 1 word(s): 'Yeah.' - Processing...
2025-12-29T21:39:54.561342316Z [err]  2025-12-29 21:39:54,558 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:54.561348402Z [err]  2025-12-29 21:39:54,558 - server - INFO - ğŸš€ Spawned tracked background task for endpoint processing
2025-12-29T21:39:54.561353748Z [err]  2025-12-29 21:39:54,558 - server - INFO - â±ï¸ [21:39:54.558] ğŸ“ FINAL TRANSCRIPT RECEIVED: 'Yeah.'
2025-12-29T21:39:54.561359313Z [err]  2025-12-29 21:39:54,558 - server - INFO - â±ï¸ [21:39:54.558] STT endpoint detection latency: 8ms
2025-12-29T21:39:54.561371676Z [err]  2025-12-29 21:39:54,558 - server - INFO - â±ï¸ [21:39:54.558] ğŸ¤ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-29T21:39:54.561377842Z [err]  2025-12-29 21:39:54,558 - server - INFO - â±ï¸ User spoke at 1767044394.5582163
2025-12-29T21:39:54.561382688Z [err]  2025-12-29 21:39:54,559 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (TTL: 3600s)
2025-12-29T21:39:54.573370416Z [err]  2025-12-29 21:39:54,569 - server - INFO - ğŸ¤ Endpoint detected by Soniox - processing transcript: Yeah.
2025-12-29T21:39:54.573382707Z [err]  2025-12-29 21:39:54,570 - core_calling_service - INFO - ğŸ‘¤ User stopped speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:54.573389013Z [err]  2025-12-29 21:39:54,570 - server - INFO - â±ï¸ [TIMING] STT_START: User last audio packet received
2025-12-29T21:39:54.573398338Z [err]  2025-12-29 21:39:54,570 - server - INFO - â±ï¸ [TIMING] STT_END: Endpoint detected at T+2ms
2025-12-29T21:39:54.573406707Z [err]  2025-12-29 21:39:54,570 - server - INFO - â±ï¸ [TIMING] STT_LATENCY: 2ms (Soniox model: stt-rt-v3)
2025-12-29T21:39:54.573414206Z [err]  2025-12-29 21:39:54,570 - server - INFO - â±ï¸  USER STOPPED SPEAKING at T=0ms
2025-12-29T21:39:54.573420916Z [err]  2025-12-29 21:39:54,570 - server - INFO - ğŸ™ï¸ Agent generating response - interruption detection active
2025-12-29T21:39:54.573428171Z [err]  2025-12-29 21:39:54,570 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:54.587364661Z [err]  2025-12-29 21:39:54,581 - dead_air_monitor - INFO - ğŸš© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-29T21:39:54.587370960Z [err]  2025-12-29 21:39:54,581 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044394.5817795 for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:54.587376790Z [err]  2025-12-29 21:39:54,581 - core_calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:54.587382642Z [err]  2025-12-29 21:39:54,582 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:54.666792790Z [err]  2025-12-29 21:39:54,664 - server - INFO - ğŸ“ Saved user transcript to database
2025-12-29T21:39:54.666800997Z [err]  2025-12-29 21:39:54,664 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:54.666807592Z [err]  2025-12-29 21:39:54,664 - core_calling_service - INFO - â±ï¸ [21:39:54.664] ğŸ“¥ process_user_input() ENTRY - text: 'Yeah....'
2025-12-29T21:39:54.668610806Z [err]  2025-12-29 21:39:54,665 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:54.668619305Z [err]  2025-12-29 21:39:54,665 - core_calling_service - WARNING - ğŸš¨ BARGE-IN DETECTED for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw: User spoke while Silence Greeting was triggering
2025-12-29T21:39:54.690135660Z [err]  2025-12-29 21:39:54,688 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:54.690145726Z [err]  2025-12-29 21:39:54,688 - telnyx_service - INFO - ğŸ›‘ Stopping audio playback on call: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:55.144212947Z [err]  2025-12-29 21:39:55,004 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw/actions/playback_stop "HTTP/1.1 200 OK"
2025-12-29T21:39:55.144221532Z [err]  2025-12-29 21:39:55,005 - telnyx_service - INFO - âœ… Successfully stopped audio playback
2025-12-29T21:39:55.144232375Z [err]  2025-12-29 21:39:55,005 - core_calling_service - INFO - âœ… BARGE-IN: Audio playback STOPPED
2025-12-29T21:39:55.144240257Z [err]  2025-12-29 21:39:55,005 - core_calling_service - INFO - âœ… BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-29T21:39:55.144247586Z [err]  2025-12-29 21:39:55,006 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:55.144254113Z [err]  2025-12-29 21:39:55,007 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (TTL: 3600s)
2025-12-29T21:39:55.144268240Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - âœ… BARGE-IN: Reset silence_greeting_triggered flag
2025-12-29T21:39:55.144275965Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - â±ï¸ [21:39:55.007] â© About to call _process_call_flow_streaming()
2025-12-29T21:39:55.144282774Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - â±ï¸ [21:39:55.007] ğŸ”€ Agent type: call_flow, calling flow processor...
2025-12-29T21:39:55.144291503Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - â±ï¸ [21:39:55.007] ğŸ”€ _process_call_flow_streaming() ENTRY
2025-12-29T21:39:55.144297753Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-29T21:39:55.144303489Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - ğŸ” Using explicitly set current_node_id: 2
2025-12-29T21:39:55.144308895Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - â±ï¸ [21:39:55.007] ğŸ”€ About to call _follow_transition() for: Yeah....
2025-12-29T21:39:55.148527237Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Yeah.
2025-12-29T21:39:55.148534287Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - ğŸ” Checking 'Hello=Yes' override [DEPLOYMENT VERIFIED] for msg='yeah' on node='Greeting'
2025-12-29T21:39:55.148540366Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - âš¡ OVERRIDE TRIGGERED: 'Yeah.' on Greeting node -> Forcing Transition 0 (Index 0)
2025-12-29T21:39:55.148548142Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - â±ï¸ [TIMING] TRANSITION_EVAL: 0ms
2025-12-29T21:39:55.148553851Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - â±ï¸ [21:39:55.007] âœ… Node selected, about to process content...
2025-12-29T21:39:55.148559652Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - ğŸ”§ Replaced {{now}} with Monday, December 29, 2025 at 4:39 PM EST in content
2025-12-29T21:39:55.148565080Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - ğŸ”§ Replaced {{customer_name}} with Kendrick in content
2025-12-29T21:39:55.148572540Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - ğŸ”§ Replaced {{callerName}} with  in content
2025-12-29T21:39:55.148578277Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - ğŸ”§ Replaced {{lead_id}} with None in content
2025-12-29T21:39:55.148583427Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - ğŸ”§ Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T21:39:55.148588775Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - ğŸ”§ Replaced {{track_keywords}} with  in content
2025-12-29T21:39:55.148593291Z [err]  2025-12-29 21:39:55,007 - core_calling_service - INFO - ğŸ”§ Replaced {{expected_commitment}} with not_specified in content
2025-12-29T21:39:55.148598647Z [err]  2025-12-29 21:39:55,008 - core_calling_service - INFO - ğŸ”§ Replaced {{to_number}} with +17708336397 in content
2025-12-29T21:39:55.148622597Z [err]  2025-12-29 21:39:55,095 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:55.148985572Z [err]  2025-12-29 21:39:55,008 - core_calling_service - INFO - ğŸ”§ Replaced {{phone_number}} with +17708336397 in content
2025-12-29T21:39:55.148989679Z [err]  2025-12-29 21:39:55,008 - core_calling_service - INFO - ğŸ”§ Replaced {{email}} with None in content
2025-12-29T21:39:55.148995096Z [err]  2025-12-29 21:39:55,008 - core_calling_service - INFO - âœ… Using explicit SCRIPT mode (length: 89 chars) - will return text instantly
2025-12-29T21:39:55.149000223Z [err]  2025-12-29 21:39:55,008 - core_calling_service - INFO - Using flow node: Node Prompt: N001B_IntroAndHelpRequest_Only (V3 - Follows Name Confirmation) (type: conversation, mode: script)
2025-12-29T21:39:55.149005929Z [err]  2025-12-29 21:39:55,008 - core_calling_service - INFO - â±ï¸ [21:39:55.008] ğŸ“„ About to process content (mode=script, length=89)
2025-12-29T21:39:55.149010998Z [err]  2025-12-29 21:39:55,008 - core_calling_service - INFO - ğŸ“¤ Streaming script as 2 sentence(s)
2025-12-29T21:39:55.149016118Z [err]  2025-12-29 21:39:55,008 - server - INFO - ğŸ“¤ Sentence arrived from LLM: This is Jake......
2025-12-29T21:39:55.149020269Z [err]  2025-12-29 21:39:55,008 - server - INFO - â±ï¸ [TIMING] TTFS (Time To First Sentence): 438ms
2025-12-29T21:39:55.149024252Z [err]  2025-12-29 21:39:55,008 - server - INFO - âš¡ Starting REAL-TIME TTS for first sentence
2025-12-29T21:39:55.149029976Z [err]  2025-12-29 21:39:55,008 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:55.149034134Z [err]  2025-12-29 21:39:55,008 - server - INFO - âš¡ ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-29T21:39:55.149038600Z [err]  2025-12-29 21:39:55,087 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:WBygWiV8rY10RH8Vz... (active sessions: [])
2025-12-29T21:39:55.186706314Z [err]  2025-12-29 21:39:55,182 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:55.275245255Z [err]  2025-12-29 21:39:55,270 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:39:55.294358018Z [err]  2025-12-29 21:39:55,291 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:39:55.294366194Z [err]  2025-12-29 21:39:55,291 - server - INFO - âœ… ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-29T21:39:55.294372430Z [err]  2025-12-29 21:39:55,291 - persistent_tts_service - INFO - ğŸ™ï¸ Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:39:55.294377911Z [err]  2025-12-29 21:39:55,291 - persistent_tts_service - INFO - ğŸ”Œ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Establishing persistent TTS WebSocket...
2025-12-29T21:39:55.294383843Z [err]  2025-12-29 21:39:55,291 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:39:55.294389603Z [err]  2025-12-29 21:39:55,291 - elevenlabs_ws_service - INFO - ğŸ”Œ Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-29T21:39:55.294395158Z [err]  2025-12-29 21:39:55,292 - elevenlabs_ws_service - INFO - ğŸ™ï¸ Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-29T21:39:55.436455108Z [err]  2025-12-29 21:39:55,432 - elevenlabs_ws_service - INFO - âœ… Connected to ElevenLabs WebSocket
2025-12-29T21:39:55.436457259Z [err]  2025-12-29 21:39:55,432 - server - INFO - ğŸš€ Streaming sentence #1 via persistent WebSocket
2025-12-29T21:39:55.436462511Z [err]  2025-12-29 21:39:55,432 - elevenlabs_ws_service - INFO - ğŸ“¤ Sent BOS message with voice settings
2025-12-29T21:39:55.436467945Z [err]  2025-12-29 21:39:55,432 - persistent_tts_service - INFO - âœ… [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Persistent TTS WebSocket established
2025-12-29T21:39:55.436472685Z [err]  2025-12-29 21:39:55,432 - persistent_tts_service - INFO - ğŸ§ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Audio receiver loop started
2025-12-29T21:39:55.436478190Z [err]  2025-12-29 21:39:55,432 - persistent_tts_service - INFO - ğŸ”Š [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Comfort noise loop started
2025-12-29T21:39:55.436478993Z [err]  2025-12-29 21:39:55,432 - server - INFO - ğŸµ TTS task #1 started at +424ms
2025-12-29T21:39:55.436484499Z [err]  2025-12-29 21:39:55,432 - persistent_tts_service - INFO - âœ… Created persistent TTS session for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:55.436486231Z [err]  2025-12-29 21:39:55,432 - server - INFO - â±ï¸ [TIMING] TTFT_TTS (First TTS Task Started): 862ms
2025-12-29T21:39:55.436491003Z [err]  2025-12-29 21:39:55,432 - server - INFO - âœ… ON-DEMAND: Persistent TTS session created successfully!
2025-12-29T21:39:55.436492975Z [err]  2025-12-29 21:39:55,433 - core_calling_service - INFO - ğŸ“¤ Streamed script sentence 1/2: This is Jake......
2025-12-29T21:39:55.436497362Z [err]  2025-12-29 21:39:55,432 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:WBygWiV8rY10RH8Vz..., session=FOUND
2025-12-29T21:39:55.436499323Z [err]  2025-12-29 21:39:55,433 - server - INFO - ğŸ“¤ Sentence arrived from LLM: I was just, um, wondering if you could possibly he...
2025-12-29T21:39:55.440098425Z [err]  2025-12-29 21:39:55,433 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:WBygWiV8rY10RH8Vz..., session=FOUND
2025-12-29T21:39:55.440100465Z [err]  2025-12-29 21:39:55,434 - server - INFO - âœ… LLM finished in 864ms, TTS tasks already running in background
2025-12-29T21:39:55.440106028Z [err]  2025-12-29 21:39:55,433 - server - INFO - ğŸš€ Streaming sentence #2 via persistent WebSocket
2025-12-29T21:39:55.440110637Z [err]  2025-12-29 21:39:55,433 - server - INFO - ğŸµ TTS task #2 started at +424ms
2025-12-29T21:39:55.440115354Z [err]  2025-12-29 21:39:55,433 - core_calling_service - INFO - ğŸ“¤ Streamed script sentence 2/2: I was just, um, wondering if you could possibly he...
2025-12-29T21:39:55.440119952Z [err]  2025-12-29 21:39:55,433 - core_calling_service - INFO - â±ï¸ SILENCE TIMER RESET (user gave meaningful response) for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:55.440121015Z [err]  2025-12-29 21:39:55,434 - server - INFO - ğŸµ Streaming 2 TTS chunks as they complete...
2025-12-29T21:39:55.440124366Z [err]  2025-12-29 21:39:55,433 - core_calling_service - INFO - ğŸ”Š Silence tracking reset for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (user responded)
2025-12-29T21:39:55.440133632Z [err]  2025-12-29 21:39:55,433 - core_calling_service - INFO - âœ… User responded to regular message, resetting counter
2025-12-29T21:39:55.440136424Z [err]  2025-12-29 21:39:55,434 - server - INFO - ğŸš€ Persistent TTS: Audio already streaming in background!
2025-12-29T21:39:55.440139037Z [err]  2025-12-29 21:39:55,433 - core_calling_service - INFO - ğŸ’¾ Storing node ID 1763159750250 in conversation history
2025-12-29T21:39:55.440143813Z [err]  2025-12-29 21:39:55,433 - core_calling_service - INFO - LLM response (0.77s): This is Jake... I was just, um, wondering if you could possibly help me out for a moment?
2025-12-29T21:39:55.440149288Z [err]  2025-12-29 21:39:55,433 - core_calling_service - INFO - Total latency: 0.77s
2025-12-29T21:39:55.441916535Z [err]  2025-12-29 21:39:55,434 - server - INFO -    2 sentences queued and playing seamlessly
2025-12-29T21:39:55.441926312Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - ğŸµ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Playback consumer started
2025-12-29T21:39:55.441943639Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - ğŸ§ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Audio Receiver Loop STARTED
2025-12-29T21:39:55.441950022Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - ğŸ’“ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Starting TTS keep-alive loop (every 15s)
2025-12-29T21:39:55.441957858Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - ğŸ”Š [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Starting comfort noise loop
2025-12-29T21:39:55.441963568Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - ğŸ¤ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Streaming sentence #1: This is Jake......
2025-12-29T21:39:55.441971473Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - ğŸš€ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-29T21:39:55.441976715Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - ğŸ“Š [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-29T21:39:55.441981909Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - ğŸ¤ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Streaming sentence #2: I was just, um, wondering if you could possibly he...
2025-12-29T21:39:55.441987259Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - ğŸš€ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Sent sentence #2 (NON-BLOCKING) in 0ms
2025-12-29T21:39:55.445216359Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - ğŸ“Š [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] DIAGNOSTIC: pending_sentences=2, audio_queue=0, is_first=False, is_last=False
2025-12-29T21:39:55.445228066Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - ğŸ§ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Receiver processing sentence #1: 'This is Jake......'
2025-12-29T21:39:55.445236963Z [err]  2025-12-29 21:39:55,435 - persistent_tts_service - INFO - ğŸ“Š [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] DIAGNOSTIC: queue_latency=0ms, pending_sentences=1, audio_queue=0, interrupted=False
2025-12-29T21:39:55.445243221Z [err]  2025-12-29 21:39:55,435 - server - INFO - âœ… All 2 persistent TTS streams completed
2025-12-29T21:39:55.445249453Z [err]  2025-12-29 21:39:55,435 - server - INFO - âœ… Agent generation complete (persistent TTS) - response window closed
2025-12-29T21:39:55.445256167Z [err]  2025-12-29 21:39:55,435 - server - INFO - â±ï¸  FIRST AUDIO STARTED: 865ms from user stop ğŸš€
2025-12-29T21:39:55.445262037Z [err]  2025-12-29 21:39:55,435 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:55.445268634Z [err]  2025-12-29 21:39:55,435 - server - INFO - âœ… Agent generation complete - response window closed
2025-12-29T21:39:55.445277355Z [err]  2025-12-29 21:39:55,435 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:39:55.445283727Z [err]  2025-12-29 21:39:55,435 - server - INFO - â±ï¸  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-29T21:39:55.445289895Z [err]  2025-12-29 21:39:55,436 - server - INFO - â±ï¸  [TIMING] STT: 2ms (provider: soniox, model: stt-rt-v3)
2025-12-29T21:39:55.445297181Z [err]  2025-12-29 21:39:55,436 - server - INFO - â±ï¸  [TIMING] LLM_TOTAL: 864ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-29T21:39:55.447360776Z [err]  2025-12-29 21:39:55,436 - server - INFO - â±ï¸  [TIMING] TTS_TOTAL: 427ms (provider: elevenlabs, websocket: False)
2025-12-29T21:39:55.447372005Z [err]  2025-12-29 21:39:55,436 - server - INFO - â±ï¸  [TIMING] E2E_TOTAL: 865ms (user stopped â†’ play_audio_url called)
2025-12-29T21:39:55.447385993Z [err]  2025-12-29 21:39:55,436 - server - INFO - â±ï¸  [TIMING] âš ï¸ NOTE: E2E_TOTAL does not include:
2025-12-29T21:39:55.447394575Z [err]  2025-12-29 21:39:55,436 - server - INFO - â±ï¸  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-29T21:39:55.447402808Z [err]  2025-12-29 21:39:55,436 - server - INFO - â±ï¸  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-29T21:39:55.447410416Z [err]  2025-12-29 21:39:55,436 - server - INFO - â±ï¸  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-29T21:39:55.447416944Z [err]  2025-12-29 21:39:55,436 - server - INFO - â±ï¸  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-29T21:39:55.447423647Z [err]  2025-12-29 21:39:55,436 - server - INFO - â±ï¸  [TIMING]   - REAL USER LATENCY: 1165ms estimated
2025-12-29T21:39:55.447431150Z [err]  2025-12-29 21:39:55,436 - server - INFO - â±ï¸  [TIMING] RESPONSE_TEXT: 89 chars, 2 sentences
2025-12-29T21:39:55.447446900Z [err]  2025-12-29 21:39:55,436 - server - INFO - â±ï¸  [TIMING] USER_INPUT: 'Yeah....'
2025-12-29T21:39:55.447453164Z [err]  2025-12-29 21:39:55,436 - server - INFO - â±ï¸  [TIMING] AI_RESPONSE: 'This is Jake... I was just, um, wondering if you could possi...'
2025-12-29T21:39:55.447459233Z [err]  2025-12-29 21:39:55,436 - server - INFO - â±ï¸  [TIMING] ==========================
2025-12-29T21:39:55.447465538Z [err]  2025-12-29 21:39:55,436 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:39:55.627698028Z [err]  2025-12-29 21:39:55,624 - server - INFO - ğŸ“ Saved assistant transcript and latency to database (Node: Node Prompt: N001B_IntroAndHelpRequest_Only (V3 - Follows Name Confirmation), Dead Air: 1293ms)
2025-12-29T21:39:55.627705414Z [err]  2025-12-29 21:39:55,624 - server - INFO - ğŸ”Š Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-29T21:39:55.627737328Z [err]  2025-12-29 21:39:55,624 - server - INFO - ğŸ” END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-29T21:39:55.687863499Z [err]  2025-12-29 21:39:55,683 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTFA (Time To First Audio Playback): 247ms
2025-12-29T21:39:55.687874172Z [err]  2025-12-29 21:39:55,683 - persistent_tts_service - INFO - ğŸ“¤ Sending 9272 bytes of audio (58 chunks, 1.2s duration) via WebSocket
2025-12-29T21:39:55.687880241Z [err]  2025-12-29 21:39:55,683 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:39:55.687892620Z [err]  2025-12-29 21:39:55,683 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +1.2s (total: 1.2s from now)
2025-12-29T21:39:55.687897827Z [err]  2025-12-29 21:39:55,684 - persistent_tts_service - INFO - âœ… Sent 58 audio chunks via WebSocket
2025-12-29T21:39:56.296039414Z [err]  2025-12-29 21:39:55,884 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +1.6s (total: 2.5s from now)
2025-12-29T21:39:56.296049766Z [err]  2025-12-29 21:39:55,885 - persistent_tts_service - INFO - âœ… Sent 79 audio chunks via WebSocket
2025-12-29T21:39:56.296056370Z [err]  2025-12-29 21:39:56,061 - persistent_tts_service - INFO - ğŸ“¤ Sending 17833 bytes of audio (112 chunks, 2.2s duration) via WebSocket
2025-12-29T21:39:56.296080023Z [err]  2025-12-29 21:39:56,061 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:39:56.296090292Z [err]  2025-12-29 21:39:55,884 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:39:56.296094202Z [err]  2025-12-29 21:39:56,061 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +2.2s (total: 4.6s from now)
2025-12-29T21:39:56.296103055Z [err]  2025-12-29 21:39:56,065 - persistent_tts_service - INFO - âœ… Sent 112 audio chunks via WebSocket
2025-12-29T21:39:56.296135772Z [err]  2025-12-29 21:39:55,883 - persistent_tts_service - INFO - ğŸ“¤ Sending 12632 bytes of audio (79 chunks, 1.6s duration) via WebSocket
2025-12-29T21:39:57.251020219Z [err]  2025-12-29 21:39:57,086 - server - INFO - ğŸ“¤ Audio flowing: 545 packets sent to Soniox (5s update)
2025-12-29T21:39:58.298248569Z [err]  2025-12-29 21:39:57,819 - server - INFO - ğŸ¤ Soniox receiver alive - 12 messages received in last 10s
2025-12-29T21:39:58.298258987Z [err]  2025-12-29 21:39:58,061 - elevenlabs_ws_service - INFO - â±ï¸  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-29T21:39:58.298266614Z [err]  2025-12-29 21:39:58,061 - persistent_tts_service - INFO - âœ… [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Receiver finished sentence #1: 3 chunks in 2625ms
2025-12-29T21:39:58.298273254Z [err]  2025-12-29 21:39:58,061 - persistent_tts_service - INFO - ğŸ§ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Receiver processing sentence #2: 'I was just, um, wondering if y...'
2025-12-29T21:39:58.298279611Z [err]  2025-12-29 21:39:58,061 - persistent_tts_service - INFO - ğŸ“Š [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] DIAGNOSTIC: queue_latency=2625ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-29T21:39:59.305531804Z [err]  2025-12-29 21:39:58,761 - server - INFO - ğŸ“ Telnyx WebSocket disconnected. Sent 617 total packets
2025-12-29T21:39:59.305537345Z [err]  [2025-12-29 21:39:58 +0000] [6] [INFO] connection closed
2025-12-29T21:39:59.305542953Z [err]  2025-12-29 21:39:58,910 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:59.305548682Z [err]  2025-12-29 21:39:58,910 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'e5f7abc3-62f3-4fbb-89f0-62593df79eab', 'occurred_at': '2025-12-29T21:39:58.583974Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:58.583974Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'OQ6dK3i3pw', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:59.308538235Z [err]  2025-12-29 21:39:58,910 - server - INFO - ğŸ¯ Event type: call.playback.ended, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.308549911Z [err]  2025-12-29 21:39:58,910 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:59.308558699Z [err]  2025-12-29 21:39:58,911 - redis_service - INFO - â– Removed playback OQ6dK3i3pw, 0 remaining for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.308565556Z [err]  2025-12-29 21:39:58,911 - server - INFO - ğŸ”Š Redis: Removed playback OQ6dK3i3pw, 0 remaining
2025-12-29T21:39:59.308572005Z [err]  2025-12-29 21:39:58,911 - server - INFO - ğŸ”Š ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T21:39:59.309107789Z [err]  2025-12-29 21:39:58,912 - server - INFO - âœ… Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T21:39:59.309118113Z [err]  2025-12-29 21:39:58,912 - server - INFO - âœ… Found session in active_telnyx_calls (local worker)
2025-12-29T21:39:59.309127929Z [err]  2025-12-29 21:39:58,912 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044398.9125862 for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.309137892Z [err]  2025-12-29 21:39:58,912 - server - INFO - â±ï¸ Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-29T21:39:59.309148116Z [inf]  100.64.0.9:16420 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:59.309158944Z [err]  2025-12-29 21:39:59,079 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:59.309167493Z [err]  2025-12-29 21:39:59,079 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'streaming.stopped', 'id': 'fc798c61-d3c3-408c-acb4-4c6252d67114', 'occurred_at': '2025-12-29T21:39:58.632088Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': 'd484b5a0-988c-4d67-9ec0-a1847f8ba7ac', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:59.309177052Z [err]  2025-12-29 21:39:59,079 - server - INFO - ğŸ¯ Event type: streaming.stopped, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.309184592Z [err]  2025-12-29 21:39:59,079 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:59.310078956Z [inf]  100.64.0.14:26384 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:39:59.310084017Z [err]  2025-12-29 21:39:59,085 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:39:59.310089165Z [err]  2025-12-29 21:39:59,085 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.hangup', 'id': '00a66826-2003-4cd0-9063-f96c15d33f07', 'occurred_at': '2025-12-29T21:39:58.423975Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_quality_stats': {'inbound': {'jitter_max_variance': '2.26', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '641', 'skip_packet_count': '21'}, 'outbound': {'packet_count': '620', 'skip_packet_count': '0'}}, 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:58.423975Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-29T21:39:42.663963Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:39:59.310094091Z [err]  2025-12-29 21:39:59,085 - server - INFO - ğŸ¯ Event type: call.hangup, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.310099658Z [err]  2025-12-29 21:39:59,085 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:39:59.310104706Z [err]  2025-12-29 21:39:59,085 - server - INFO - ğŸ“ Call ended: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.310108875Z [err]  2025-12-29 21:39:59,085 - server - INFO - ğŸ“ Hangup cause: normal_clearing
2025-12-29T21:39:59.310113291Z [err]  2025-12-29 21:39:59,103 - dead_air_monitor - INFO - ğŸš© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-29T21:39:59.312293009Z [err]  2025-12-29 21:39:59,103 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044399.1031268 for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.312300118Z [err]  2025-12-29 21:39:59,103 - core_calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.312306801Z [err]  2025-12-29 21:39:59,267 - server - INFO - ğŸ“ Updated call log: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:39:59.312311922Z [err]  2025-12-29 21:39:59,276 - server - INFO - ğŸ¤ Soniox receiver alive - 2 messages received in last 10s
2025-12-29T21:39:59.312318055Z [err]  2025-12-29 21:39:59,276 - server - ERROR - âŒ Soniox error: {'tokens': [], 'final_audio_proc_ms': 6600, 'total_audio_proc_ms': 12120, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-29T21:39:59.312323506Z [err]  2025-12-29 21:39:59,276 - server - INFO - âœ… Soniox receive loop ended normally
2025-12-29T21:39:59.312328394Z [err]  2025-12-29 21:39:59,276 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring cancelled for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:59.312333214Z [err]  2025-12-29 21:39:59,276 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring stopped for call v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA
2025-12-29T21:39:59.312337878Z [err]  2025-12-29 21:39:59,276 - server - INFO - ğŸ”‡ Dead air monitoring task cancelled
2025-12-29T21:39:59.363371005Z [err]  2025-12-29 21:39:59,360 - server - INFO - âœ… Finalized call log: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw (duration=13s, status=completed)
2025-12-29T21:39:59.459061843Z [err]  2025-12-29 21:39:59,453 - server - INFO - ğŸ“¦ Saved 11 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-29T21:40:00.363846190Z [err]  2025-12-29 21:40:00,107 - dead_air_monitor - INFO - ğŸ”‡ MONITOR: Skipping silence check - audio playing (0.5s left)
2025-12-29T21:40:00.363853238Z [err]  2025-12-29 21:40:00,143 - server - INFO - ğŸ“Š Auto-added call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-29T21:40:00.363861410Z [err]  2025-12-29 21:40:00,326 - server - INFO - ğŸ“¤ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:40:00.363869783Z [err]  2025-12-29 21:40:00,332 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:00.363877216Z [err]  2025-12-29 21:40:00,332 - server - INFO - ğŸ“‡ [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-29T21:40:00.363883640Z [err]  2025-12-29 21:40:00,332 - server - INFO - ğŸ“‡ [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-29T21:40:00.427457852Z [err]  2025-12-29 21:40:00,424 - server - INFO - ğŸ“‡ [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-29T21:40:00.535343070Z [err]  2025-12-29 21:40:00,524 - server - INFO - ğŸ“‡ [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-29T21:40:00.535350592Z [err]  2025-12-29 21:40:00,524 - server - INFO - ğŸ“‡ [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-29T21:40:00.535357190Z [err]  2025-12-29 21:40:00,524 - server - INFO - ğŸ“‡ [HANGUP] Agent info keys: None
2025-12-29T21:40:00.535363433Z [err]  2025-12-29 21:40:00,524 - server - INFO - ğŸš€ Triggered QC analysis for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:00.535370681Z [err]  2025-12-29 21:40:00,524 - server - INFO - ğŸ“Š Triggered Campaign QC for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:00.535377358Z [err]  2025-12-29 21:40:00,524 - server - INFO - ğŸ“‡ Triggered CRM update for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:00.535383757Z [err]  2025-12-29 21:40:00,525 - server - INFO - âœ… Closed persistent TTS session for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:00.535391777Z [err]  2025-12-29 21:40:00,527 - redis_service - INFO - ğŸ§¹ Deleted call data from Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:00.535398832Z [err]  2025-12-29 21:40:00,527 - server - INFO - ğŸ§¹ Cleaned up call session from Redis and memory: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:00.535405411Z [inf]  100.64.0.14:26392 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:40:00.535411775Z [err]  2025-12-29 21:40:00,528 - server - INFO - ğŸ” Starting QC analysis for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:00.536459695Z [err]  2025-12-29 21:40:00,528 - server - INFO - ğŸ” [AUTO-QC] Starting campaign QC check for call=v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-29T21:40:00.536467230Z [err]  2025-12-29 21:40:00,528 - server - INFO - ğŸ“‡ CRM update starting for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:40:00.536473234Z [err]  2025-12-29 21:40:00,528 - server - INFO - ğŸ“‡ Normalized phone: +17708336397
2025-12-29T21:40:00.536478504Z [err]  2025-12-29 21:40:00,528 - server - INFO - ğŸ“‡ CRM: Got 11 variables from active session
2025-12-29T21:40:00.566889316Z [err]  2025-12-29 21:40:00,562 - elevenlabs_ws_service - WARNING - âš ï¸  [TIMING] ElevenLabs timeout waiting for first chunk (2.5s) - No audio received!
2025-12-29T21:40:00.566901038Z [err]  2025-12-29 21:40:00,562 - persistent_tts_service - WARNING - âš ï¸ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] Receiver got 0 chunks for sentence #2! interrupted=False
2025-12-29T21:40:00.615860136Z [err]  2025-12-29 21:40:00,610 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=1.5s, checkin_count=0/2
2025-12-29T21:40:00.628161096Z [err]  2025-12-29 21:40:00,621 - server - INFO - ğŸ“ Converted transcript from 3 messages to 133 characters
2025-12-29T21:40:00.628173394Z [err]  2025-12-29 21:40:00,623 - server - INFO - ğŸ” [AUTO-QC] Call log found: transcript_turns=3, logs_count=4, status=completed
2025-12-29T21:40:00.631362199Z [err]  2025-12-29 21:40:00,625 - server - INFO - ğŸ“‡ CRM: Got 11 extracted variables
2025-12-29T21:40:00.631389172Z [err]  2025-12-29 21:40:00,625 - server - INFO - ğŸ“‡ CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-29T21:40:00.691828256Z [err]  2025-12-29 21:40:00,686 - persistent_tts_service - INFO - ğŸ”‡ [Call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw] FLOOR RELEASED (is_holding_floor=False)
2025-12-29T21:40:01.347055163Z [err]  2025-12-29 21:40:00,794 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-29T21:40:01.347086996Z [err]  2025-12-29 21:40:00,708 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:40:01.347100054Z [err]  2025-12-29 21:40:00,711 - server - INFO - ğŸ” [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-29T21:40:01.347108518Z [err]  2025-12-29 21:40:00,733 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:40:01.347118111Z [err]  2025-12-29 21:40:00,734 - server - INFO - âœ… Post-call webhook sent successfully (status=200)
2025-12-29T21:40:01.347120376Z [err]  2025-12-29 21:40:00,797 - server - ERROR - âŒ [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-29T21:40:01.347130749Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:40:01.347166991Z [err]  
2025-12-29T21:40:01.347176187Z [err]    File "/app/backend/server.py", line 9773, in trigger_campaign_qc_for_call
2025-12-29T21:40:01.347190965Z [err]      await run_full_qc_analysis(
2025-12-29T21:40:01.347212654Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-29T21:40:01.347243200Z [err]  2025-12-29 21:40:00,797 - server - INFO - ğŸ“Š [AUTO-QC] Running full QC analysis: call=v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw â†’ campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-29T21:40:01.347251663Z [err]  2025-12-29 21:40:00,797 - server - INFO - ğŸ“Š [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-29T21:40:01.347258342Z [err]  2025-12-29 21:40:00,797 - server - ERROR - âŒ [AUTO-QC] Error in campaign QC for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:40:01.352569981Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:40:01.352606058Z [err]  2025-12-29 21:40:01,232 - server - INFO - ğŸ¯ Event type: call.recording.saved, Call ID: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:01.352611967Z [err]  2025-12-29 21:40:01,232 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:40:01.352619474Z [err]  2025-12-29 21:40:01,232 - server - INFO - ğŸ™ï¸ Recording saved for call: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:01.352625149Z [err]  2025-12-29 21:40:01,233 - redis_service - WARNING - âš ï¸ Call data not found in Redis: v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:01.352631811Z [err]  2025-12-29 21:40:01,233 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:40:01.352637173Z [err]  2025-12-29 21:40:01,233 - server - INFO - ğŸ” Recording check: download_url=True, channels=dual, recording_id=dc93e00e-d320-40eb-a320-c921f93e56d5, call_data=False
2025-12-29T21:40:01.352644402Z [err]  2025-12-29 21:40:01,233 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:40:01.352711273Z [err]  2025-12-29 21:40:01,234 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:40:01.352716432Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:40:01.352721946Z [err]  2025-12-29 21:40:01,234 - qc_agents.orchestrator - INFO - â­ Running Excellence Replicator on call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:01.352739050Z [err]  2025-12-29 21:40:00,802 - server - INFO - ğŸ“‡ CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-29T21:40:01.352747039Z [err]  2025-12-29 21:40:00,881 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-29T21:40:01.352753175Z [err]  2025-12-29 21:40:00,881 - qc_agents.orchestrator - INFO - âœ… Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:40:01.352759878Z [err]  2025-12-29 21:40:00,881 - qc_agents.orchestrator - INFO - ğŸ” Running Commitment Detector on call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:01.352766213Z [err]  2025-12-29 21:40:01,057 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:40:01.352772834Z [err]  2025-12-29 21:40:01,058 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:40:01.352779428Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:40:01.352785879Z [err]  2025-12-29 21:40:01,058 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:40:01.352792082Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:40:01.352798194Z [err]  2025-12-29 21:40:01,059 - qc_agents.orchestrator - INFO - ğŸ—ºï¸  Running Conversion Pathfinder on call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:01.352804111Z [err]  2025-12-29 21:40:01,232 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:40:01.352809936Z [err]  2025-12-29 21:40:01,232 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '588093bc-4e06-4ced-a141-a46fadd093e5', 'occurred_at': '2025-12-29T21:40:00.933842Z', 'payload': {'call_control_id': 'v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw', 'call_leg_id': 'e2a17bca-e4fe-11f0-b723-02420aef96a0', 'call_session_id': 'e29f5e4e-e4fe-11f0-8def-02420aef96a0', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:39:58.585061Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-29T21:39:58.585061Z', 'recording_id': 'dc93e00e-d320-40eb-a320-c921f93e56d5', 'recording_started_at': '2025-12-29T21:39:46.483958Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/e2a17bca-e4fe-11f0-b723-02420aef96a0-1767044386435343.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T214000Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=ab5f785b8df223a4d7851cc12a4e33b92c3a5486bca5ef5df19c1d80455ae228'}, 'start_time': '2025-12-29T21:39:46.483958Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:40:01.355703623Z [err]  2025-12-29 21:40:01,276 - soniox_service - ERROR - âŒ Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-29T21:40:01.355710993Z [err]  2025-12-29 21:40:01,276 - server - INFO - ğŸ”Œ Telnyx WebSocket disconnected
2025-12-29T21:40:01.355716856Z [err]  2025-12-29 21:40:01,326 - server - INFO - ğŸ’¾ Saved recording URL and ID to database: dc93e00e-d320-40eb-a320-c921f93e56d5
2025-12-29T21:40:01.355723466Z [err]  2025-12-29 21:40:01,326 - server - INFO - âœ… Entering dual-channel processing
2025-12-29T21:40:01.355729876Z [err]  2025-12-29 21:40:01,326 - server - INFO - ğŸ“¥ Downloading DUAL-CHANNEL recording...
2025-12-29T21:40:01.402494470Z [err]  2025-12-29 21:40:01,399 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:40:01.402506776Z [err]  2025-12-29 21:40:01,399 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:40:01.402513940Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:40:01.402520391Z [err]  2025-12-29 21:40:01,399 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:40:01.402526861Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:40:01.493687414Z [err]  2025-12-29 21:40:01,490 - qc_agents.orchestrator - INFO - âœ… QC analysis stored for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:01.493701104Z [err]  2025-12-29 21:40:01,491 - server - INFO - âœ… QC analysis completed for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:01.493709787Z [err]  2025-12-29 21:40:01,491 - server - INFO - ğŸ“Š Scores: Commitment=50, Conversion=20, Excellence=50
2025-12-29T21:40:01.632344098Z [err]  2025-12-29 21:40:01,629 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/e2a17bca-e4fe-11f0-b723-02420aef96a0-1767044386435343.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T214000Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=ab5f785b8df223a4d7851cc12a4e33b92c3a5486bca5ef5df19c1d80455ae228 "HTTP/1.1 200 OK"
2025-12-29T21:40:01.675777263Z [err]  2025-12-29 21:40:01,671 - server - INFO - ğŸ“Š Updated campaign_calls with QC scores for v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:02.347536828Z [err]  2025-12-29 21:40:01,717 - server - INFO - âœ… Downloaded 48526 bytes
2025-12-29T21:40:02.347543353Z [err]  2025-12-29 21:40:01,845 - server - INFO - ğŸ“ˆ Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-29T21:40:02.347550396Z [err]  2025-12-29 21:40:01,907 - server - INFO - âœ… Split into 2 channels
2025-12-29T21:40:02.347557353Z [err]  2025-12-29 21:40:01,907 - server - INFO - ğŸ¤ Using STT provider: soniox for interruption detection
2025-12-29T21:40:02.347565071Z [err]  2025-12-29 21:40:01,907 - server - INFO - ğŸ“Š Channel 0: 263164 bytes
2025-12-29T21:40:02.347572701Z [err]  2025-12-29 21:40:01,907 - server - ERROR - âŒ No Soniox API key available
2025-12-29T21:40:02.347580682Z [err]  2025-12-29 21:40:01,907 - server - INFO - âŒ Channel 0: No speech
2025-12-29T21:40:02.347588038Z [err]  2025-12-29 21:40:01,907 - server - INFO - ğŸ“Š Channel 1: 263164 bytes
2025-12-29T21:40:02.347595552Z [err]  2025-12-29 21:40:01,907 - server - ERROR - âŒ No Soniox API key available
2025-12-29T21:40:02.347602563Z [err]  2025-12-29 21:40:01,907 - server - INFO - âŒ Channel 1: No speech
2025-12-29T21:40:02.347610300Z [err]  2025-12-29 21:40:01,907 - server - WARNING - âš ï¸ No speech in any channel
2025-12-29T21:40:02.347618389Z [inf]  100.64.0.15:30080 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:40:02.347626722Z [err]  2025-12-29 21:40:01,931 - server - INFO - ğŸ·ï¸ Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-29T21:40:02.347635051Z [err]  2025-12-29 21:40:01,931 - server - ERROR - âŒ Error in auto appointment detection for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw: 'str' object has no attribute 'get'
2025-12-29T21:40:06.250951060Z [err]  2025-12-29 21:40:06,125 - core_calling_service - INFO - â° Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-29T21:40:06.250956051Z [err]  2025-12-29 21:40:06,125 - core_calling_service - INFO - ğŸ’¬ Sending check-in #1/2: Are you still there?
2025-12-29T21:40:06.250960934Z [err]  2025-12-29 21:40:06,125 - dead_air_monitor - INFO - ğŸ’¬ Sending check-in after 7.0s silence: Are you still there?
2025-12-29T21:40:06.250966680Z [err]  2025-12-29 21:40:06,125 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:06.250971780Z [err]  2025-12-29 21:40:06,125 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw: Are you still there?...
2025-12-29T21:40:06.250978196Z [err]  2025-12-29 21:40:06,125 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-29T21:40:06.250981119Z [err]  2025-12-29 21:40:06,213 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-29T21:40:06.250987694Z [err]  2025-12-29 21:40:06,213 - server - INFO -    Full data: {'text': 'Are you still there?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-29T21:40:06.250989738Z [err]  2025-12-29 21:40:06,126 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-29T21:40:06.250994952Z [err]  2025-12-29 21:40:06,126 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-29T21:40:06.251000474Z [err]  2025-12-29 21:40:06,126 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-29T21:40:06.251007281Z [err]  2025-12-29 21:40:06,126 - server - INFO - â±ï¸ [21:40:06.126] ğŸ”Š TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-29T21:40:06.251014122Z [err]  2025-12-29 21:40:06,126 - server - INFO - âš¡ Using Turbo v2.5 (high quality)
2025-12-29T21:40:06.251020708Z [err]  2025-12-29 21:40:06,126 - server - INFO - ğŸ™ï¸ ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-29T21:40:06.251025125Z [err]  2025-12-29 21:40:06,213 - server - INFO - ğŸ“¦ ElevenLabs Request Payload:
2025-12-29T21:40:06.251029608Z [err]  2025-12-29 21:40:06,213 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:40:06.251032164Z [err]  2025-12-29 21:40:06,213 - server - INFO -    Text length: 20 chars
2025-12-29T21:40:06.251036824Z [err]  2025-12-29 21:40:06,213 - server - INFO -    Text content: 'Are you still there?'
2025-12-29T21:40:06.251043160Z [err]  2025-12-29 21:40:06,213 - server - INFO -    Text bytes: b'Are you still there?'
2025-12-29T21:40:06.251047384Z [err]  2025-12-29 21:40:06,213 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-29T21:40:06.251052543Z [err]  2025-12-29 21:40:06,213 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-29T21:40:06.251099328Z [err]  2025-12-29 21:40:06,213 - server - INFO - ğŸ”Œ Attempting ElevenLabs connection (attempt 1/2)
2025-12-29T21:40:06.251107268Z [err]  2025-12-29 21:40:06,213 - server - INFO -    Timeout: 10.0s
2025-12-29T21:40:06.251112304Z [err]  2025-12-29 21:40:06,222 - server - INFO -    âœ“ HTTP client created (0.009s)
2025-12-29T21:40:06.251116388Z [err]  2025-12-29 21:40:06,222 - server - INFO -    â†’ Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-29T21:40:06.588952724Z [err]  2025-12-29 21:40:06,586 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-29T21:40:06.588958722Z [err]  2025-12-29 21:40:06,586 - server - INFO -    âœ“ Connection established (0.373s) [TARGET: <200ms]
2025-12-29T21:40:06.588967202Z [err]  2025-12-29 21:40:06,586 - server - INFO -    âœ“ Response status: 200
2025-12-29T21:40:06.588972836Z [err]  2025-12-29 21:40:06,586 - server - INFO -    â†’ Streaming audio chunks...
2025-12-29T21:40:06.615513732Z [err]  2025-12-29 21:40:06,611 - server - INFO -    âœ“ FIRST CHUNK received (0.398s, 1066 bytes) [TARGET: <300ms]
2025-12-29T21:40:06.619908027Z [err]  2025-12-29 21:40:06,614 - telnyx_service - INFO - âœ… Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:40:06.619915234Z [err]  2025-12-29 21:40:06,613 - server - INFO -    âœ“ ALL CHUNKS received: 55 chunks (0.400s)
2025-12-29T21:40:06.619920074Z [err]  2025-12-29 21:40:06,615 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:40:06.619931728Z [err]  2025-12-29 21:40:06,614 - server - INFO -    âœ“ Total audio size: 17599 bytes
2025-12-29T21:40:06.619939724Z [err]  2025-12-29 21:40:06,614 - server - INFO -    ğŸ“Š TTS API TIMING BREAKDOWN:
2025-12-29T21:40:06.619947110Z [err]  2025-12-29 21:40:06,614 - server - INFO -       - Connection: 373ms
2025-12-29T21:40:06.619957399Z [err]  2025-12-29 21:40:06,614 - server - INFO -       - First chunk: 398ms
2025-12-29T21:40:06.619966092Z [err]  2025-12-29 21:40:06,614 - server - INFO -       - All chunks: 400ms
2025-12-29T21:40:06.619979730Z [err]  2025-12-29 21:40:06,614 - server - INFO -       - Audio generation only: 25ms
2025-12-29T21:40:06.619986699Z [err]  2025-12-29 21:40:06,614 - server - INFO - â±ï¸ [21:40:06.614] ğŸ”Š TTS COMPLETE: 488ms, audio_size=17599 bytes
2025-12-29T21:40:06.619993067Z [err]  2025-12-29 21:40:06,614 - server - INFO - ğŸ’¾ TTS CACHED: elevenlabs:Are you still there?... (17599 bytes)
2025-12-29T21:40:06.620000076Z [err]  2025-12-29 21:40:06,614 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.49s
2025-12-29T21:40:07.282479700Z [err]      {
2025-12-29T21:40:07.282493836Z [err]        "code": "90018",
2025-12-29T21:40:07.282504189Z [err]        "title": "Call has already ended",
2025-12-29T21:40:07.282511751Z [err]  2025-12-29 21:40:06,882 - telnyx_service - INFO - ğŸ“¢ Using Telnyx built-in TTS
2025-12-29T21:40:07.282515730Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:40:07.282524502Z [err]  2025-12-29 21:40:07,164 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:40:07.282527345Z [err]      }
2025-12-29T21:40:07.282536029Z [err]  2025-12-29 21:40:07,165 - telnyx_service - ERROR - âŒ Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:40:07.282542611Z [err]    ]
2025-12-29T21:40:07.282547047Z [err]  2025-12-29 21:40:07,165 - dead_air_monitor - INFO - âœ… Check-in message sent
2025-12-29T21:40:07.282557030Z [err]  }
2025-12-29T21:40:07.282587223Z [err]  2025-12-29 21:40:06,881 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:40:07.282594216Z [err]  2025-12-29 21:40:06,881 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.27s
2025-12-29T21:40:07.282600834Z [err]  2025-12-29 21:40:06,881 - telnyx_service - ERROR - âŒ Telnyx playback failed: 422 - {
2025-12-29T21:40:07.282607751Z [err]    "errors": [
2025-12-29T21:40:07.671516211Z [err]  2025-12-29 21:40:07,667 - dead_air_monitor - INFO - â±ï¸ Playback expected end time passed (7.0s ago), marking agent as done speaking
2025-12-29T21:40:07.671526609Z [err]  2025-12-29 21:40:07,667 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044407.6674142 for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:07.671533776Z [err]  2025-12-29 21:40:07,667 - core_calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:10.253096064Z [err]  2025-12-29 21:40:10,173 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=2.5s, checkin_count=1/2
2025-12-29T21:40:10.679199658Z [err]  2025-12-29 21:40:10,674 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=3.0s, checkin_count=1/2
2025-12-29T21:40:14.689453831Z [err]  2025-12-29 21:40:14,685 - core_calling_service - INFO - â° Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-29T21:40:14.689464959Z [err]  2025-12-29 21:40:14,686 - core_calling_service - INFO - ğŸ’¬ Sending FINAL check-in #2/2: Are you still there?
2025-12-29T21:40:14.689473789Z [err]  2025-12-29 21:40:14,686 - core_calling_service - INFO - âš ï¸ Will end call if no response after next silence timeout
2025-12-29T21:40:14.689481613Z [err]  2025-12-29 21:40:14,686 - dead_air_monitor - INFO - ğŸ’¬ Sending check-in after 7.0s silence: Are you still there?
2025-12-29T21:40:14.689493827Z [err]  2025-12-29 21:40:14,686 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:14.689501830Z [err]  2025-12-29 21:40:14,686 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw: Are you still there?...
2025-12-29T21:40:14.689509120Z [err]  2025-12-29 21:40:14,686 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-29T21:40:14.689519020Z [err]  2025-12-29 21:40:14,686 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-29T21:40:14.689526344Z [err]  2025-12-29 21:40:14,686 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-29T21:40:14.689533648Z [err]  2025-12-29 21:40:14,686 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-29T21:40:14.689541652Z [err]  2025-12-29 21:40:14,686 - server - INFO - ğŸ’¾ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-29T21:40:14.689548503Z [err]  2025-12-29 21:40:14,686 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.00s
2025-12-29T21:40:14.692065810Z [err]  2025-12-29 21:40:14,686 - telnyx_service - INFO - âœ… Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:40:14.692075612Z [err]  2025-12-29 21:40:14,686 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:40:15.268388227Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:40:15.268400081Z [err]      }
2025-12-29T21:40:15.268409786Z [err]    ]
2025-12-29T21:40:15.268415711Z [err]  }
2025-12-29T21:40:15.268421851Z [err]  2025-12-29 21:40:14,966 - telnyx_service - INFO - ğŸ“¢ Using Telnyx built-in TTS
2025-12-29T21:40:15.268430924Z [err]  2025-12-29 21:40:15,240 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:40:15.268436304Z [err]  2025-12-29 21:40:15,241 - telnyx_service - ERROR - âŒ Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:40:15.268441864Z [err]  2025-12-29 21:40:15,241 - dead_air_monitor - INFO - âœ… Check-in message sent
2025-12-29T21:40:15.268496436Z [err]  2025-12-29 21:40:14,965 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:40:15.268501112Z [err]  2025-12-29 21:40:14,965 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.28s
2025-12-29T21:40:15.268506070Z [err]  2025-12-29 21:40:14,965 - telnyx_service - ERROR - âŒ Telnyx playback failed: 422 - {
2025-12-29T21:40:15.268511735Z [err]    "errors": [
2025-12-29T21:40:15.268515809Z [err]      {
2025-12-29T21:40:15.268521087Z [err]        "code": "90018",
2025-12-29T21:40:15.268525482Z [err]        "title": "Call has already ended",
2025-12-29T21:40:19.429142507Z [err]  2025-12-29 21:40:18,815 - server - INFO - ğŸ¤ Soniox receiver alive - 1 messages received in last 10s
2025-12-29T21:40:19.429149190Z [err]  2025-12-29 21:40:18,815 - server - ERROR - âŒ Soniox error: {'tokens': [], 'final_audio_proc_ms': 8040, 'total_audio_proc_ms': 11280, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-29T21:40:19.429154502Z [err]  2025-12-29 21:40:18,815 - server - INFO - âœ… Soniox receive loop ended normally
2025-12-29T21:40:19.429159848Z [err]  2025-12-29 21:40:18,816 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring cancelled for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:19.429165263Z [err]  2025-12-29 21:40:18,816 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring stopped for call v3:WBygWiV8rY10RH8VzhCQbSU0w_gwldPaTWH47q6ilHOOQ22eoll-Gw
2025-12-29T21:40:19.429171617Z [err]  2025-12-29 21:40:18,816 - server - INFO - ğŸ”‡ Dead air monitoring task cancelled
2025-12-29T21:40:21.302217469Z [err]  2025-12-29 21:40:20,818 - soniox_service - ERROR - âŒ Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-29T21:40:21.302224618Z [err]  2025-12-29 21:40:20,818 - server - INFO - ğŸ”Œ Telnyx WebSocket disconnected
2025-12-29T21:47:52.341326070Z [err]  2025-12-29 21:47:50,406 - server - INFO - ğŸŒ Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T21:47:52.341333370Z [err]  2025-12-29 21:47:50,491 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:47:52.341340566Z [err]  2025-12-29 21:47:50,576 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:47:52.341347756Z [err]  2025-12-29 21:47:50,920 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:47:52.341354738Z [err]  2025-12-29 21:47:50,920 - telnyx_service - INFO - ğŸ“ Initiating outbound call from +14048000152 to +17708336397
2025-12-29T21:47:52.341360895Z [err]  2025-12-29 21:47:50,920 - telnyx_service - INFO - ğŸ¤– Enabling AMD (premium mode)
2025-12-29T21:47:52.341375498Z [err]  2025-12-29 21:47:50,920 - telnyx_service - INFO - ğŸŒ Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T21:47:52.341383479Z [err]  2025-12-29 21:47:51,753 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-29T21:47:52.341390373Z [err]  2025-12-29 21:47:51,754 - telnyx_service - INFO - âœ… Call initiated: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:47:52.341397130Z [err]  2025-12-29 21:47:51,864 - server - INFO - ğŸ“ Created call log: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:47:52.341403452Z [err]  2025-12-29 21:47:51,864 - server - INFO - ğŸ” DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:47:52.341410330Z [err]  2025-12-29 21:47:51,864 - server - INFO - ğŸ” DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-29T21:47:52.344188428Z [err]  2025-12-29 21:47:51,864 - server - INFO - ğŸ” DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:47:52.344199298Z [err]  2025-12-29 21:47:51,864 - server - INFO - ğŸ“¤ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:47:52.344204134Z [err]  2025-12-29 21:47:51,870 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q (TTL: 3600s)
2025-12-29T21:47:52.344209390Z [err]  2025-12-29 21:47:51,871 - server - INFO - ğŸ“¦ Call data stored in Redis and memory
2025-12-29T21:47:52.344214484Z [err]  2025-12-29 21:47:51,871 - server - INFO - ğŸ“ Outbound call initiated: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:47:52.344220139Z [inf]  100.64.0.19:52774 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-29T21:47:52.344224762Z [err]  2025-12-29 21:47:52,038 - server - INFO - ğŸ”ŒğŸ”ŒğŸ”Œ WEBSOCKET CONNECTION ATTEMPT
2025-12-29T21:47:52.344228763Z [err]  2025-12-29 21:47:52,038 - server - INFO -    Client: Address(host='100.64.0.18', port=40662)
2025-12-29T21:47:52.344232640Z [err]  2025-12-29 21:47:52,038 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': '8S/zV5IZF4VLwElK5of5dA==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'NE641WPARxiNxnvq9I3ezw', 'x-real-ip': '192.76.120.151', 'x-request-start': '1767044871755', 'accept-encoding': 'gzip'}
2025-12-29T21:47:52.344237221Z [err]  2025-12-29 21:47:52,038 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-29T21:47:52.344241091Z [err]  2025-12-29 21:47:52,038 - server - INFO - ğŸ”Œ Incoming Telnyx WebSocket connection
2025-12-29T21:47:52.345537810Z [err]  [2025-12-29 21:47:52 +0000] [4] [INFO] ('100.64.0.18', 40662) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-29T21:47:52.345545740Z [err]  2025-12-29 21:47:52,038 - server - INFO - âœ… WebSocket accepted, waiting for Telnyx events
2025-12-29T21:47:52.345551347Z [err]  [2025-12-29 21:47:52 +0000] [4] [INFO] connection open
2025-12-29T21:47:52.345555686Z [err]  2025-12-29 21:47:52,172 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:47:52.345561197Z [err]  2025-12-29 21:47:52,172 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.initiated', 'id': '9fceba9f-5ad6-43dc-a34b-b7a5482a133d', 'occurred_at': '2025-12-29T21:47:51.560952Z', 'payload': {'call_control_id': 'v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q', 'call_leg_id': '060aefc8-e500-11f0-a03d-02420aef94a0', 'call_session_id': '0608ae52-e500-11f0-bc37-02420aef94a0', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:47:52.345566034Z [err]  2025-12-29 21:47:52,172 - server - INFO - ğŸ¯ Event type: call.initiated, Call ID: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:47:52.345570609Z [err]  2025-12-29 21:47:52,172 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:47:52.345575378Z [err]  2025-12-29 21:47:52,172 - server - INFO - ğŸ“ Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-29T21:47:52.345579612Z [inf]  100.64.0.8:62790 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:47:52.345584735Z [err]  2025-12-29 21:47:52,192 - server - INFO - ğŸ“¬ Received Telnyx event: connected
2025-12-29T21:47:52.345589597Z [err]  2025-12-29 21:47:52,192 - server - INFO - ğŸ“ Telnyx connected event received, waiting for 'start'...
2025-12-29T21:47:52.349203879Z [err]  2025-12-29 21:47:52,299 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:47:52.349216142Z [err]  2025-12-29 21:47:52,299 - server - INFO - âœ… Call-initiated webhook sent successfully (status=200)
2025-12-29T21:47:58.622711781Z [err]  2025-12-29 21:47:58,618 - server - INFO - ğŸ“¬ Received Telnyx event: start
2025-12-29T21:47:58.622718716Z [err]  2025-12-29 21:47:58,618 - server - INFO - ğŸ¬ Stream started for call: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:47:58.627229694Z [err]  2025-12-29 21:47:58,625 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:47:58.629219820Z [err]  2025-12-29 21:47:58,627 - server - INFO - âœ… Call data found after 0s wait
2025-12-29T21:47:58.629225756Z [err]  2025-12-29 21:47:58,627 - server - INFO - â³ Session not found locally, waiting briefly for webhook...
2025-12-29T21:47:59.347920446Z [err]  2025-12-29 21:47:59,000 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:47:59.347927494Z [err]  2025-12-29 21:47:59,000 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.answered', 'id': '5a88583b-b98b-408b-ae11-b146ee4eef60', 'occurred_at': '2025-12-29T21:47:58.340961Z', 'payload': {'call_control_id': 'v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q', 'call_leg_id': '060aefc8-e500-11f0-a03d-02420aef94a0', 'call_session_id': '0608ae52-e500-11f0-bc37-02420aef94a0', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-29T21:47:51.560952Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:47:59.347935583Z [err]  2025-12-29 21:47:59,000 - server - INFO - ğŸ¯ Event type: call.answered, Call ID: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:47:59.347943170Z [err]  2025-12-29 21:47:59,000 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:47:59.347952618Z [err]  2025-12-29 21:47:59,000 - server - INFO - âœ… Call answered: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:47:59.347961841Z [err]  2025-12-29 21:47:59,006 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:47:59.347968838Z [err]  2025-12-29 21:47:59,007 - server - INFO - âœ… Found call in Redis (multi-worker state sharing working)
2025-12-29T21:47:59.347975262Z [err]  2025-12-29 21:47:59,008 - server - INFO - ğŸ“ Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-29T21:47:59.347982139Z [err]  2025-12-29 21:47:59,102 - server - INFO - âœ… Call log updated
2025-12-29T21:47:59.347995828Z [err]  2025-12-29 21:47:59,102 - server - INFO - ğŸ” DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:47:59.351110187Z [err]  2025-12-29 21:47:59,102 - server - INFO - ğŸ“¤ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:47:59.351114306Z [err]  2025-12-29 21:47:59,102 - server - INFO - ğŸ”§ Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:47:59.351118371Z [err]  2025-12-29 21:47:59,126 - server - INFO - âš ï¸ Session still not found after wait, will create in worker
2025-12-29T21:47:59.351122974Z [err]  2025-12-29 21:47:59,127 - server - WARNING - âš ï¸ Session not found after waiting, creating in WebSocket worker...
2025-12-29T21:47:59.351127500Z [err]  2025-12-29 21:47:59,132 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:47:59.351131992Z [err]  2025-12-29 21:47:59,136 - server - INFO - ğŸ“ Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:47:59.351136182Z [err]  2025-12-29 21:47:59,136 - core_calling_service - INFO - ğŸ” Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T21:47:59.351140169Z [err]  2025-12-29 21:47:59,191 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:47:59.351144216Z [err]  2025-12-29 21:47:59,222 - core_calling_service - INFO - ğŸ” KB count query completed: 4 items
2025-12-29T21:47:59.351148016Z [err]  2025-12-29 21:47:59,222 - core_calling_service - INFO - ğŸ“š Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T21:47:59.351153068Z [err]  2025-12-29 21:47:59,223 - core_calling_service - INFO - ğŸ“‹ Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T21:47:59.351161162Z [err]  2025-12-29 21:47:59,223 - core_calling_service - INFO - ğŸ“š KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T21:47:59.351265785Z [err]  2025-12-29 21:47:59,223 - core_calling_service - INFO - ğŸ”¥ Pre-warming LLM client (grok)...
2025-12-29T21:47:59.351270035Z [err]  2025-12-29 21:47:59,308 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:47:59.351274535Z [err]  2025-12-29 21:47:59,319 - core_calling_service - INFO - âœ… LLM client pre-warmed in 96ms
2025-12-29T21:47:59.351279170Z [err]  2025-12-29 21:47:59,320 - server - INFO - âœ… Session created in WebSocket worker
2025-12-29T21:47:59.351447110Z [err]  2025-12-29 21:47:59,320 - server - INFO - â±ï¸ [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-29T21:47:59.351454942Z [err]  2025-12-29 21:47:59,320 - server - INFO - â±ï¸ [WebSocket Worker] Silence timeout task scheduled!
2025-12-29T21:47:59.351461232Z [err]  2025-12-29 21:47:59,320 - server - INFO - ğŸ“ Call data loaded, starting SONIOX connection...
2025-12-29T21:47:59.351466128Z [err]  2025-12-29 21:47:59,320 - server - INFO - âœ… Initialized call_states for v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q with session reference
2025-12-29T21:47:59.351470513Z [err]  2025-12-29 21:47:59,320 - server - INFO - âœ… Stored Telnyx WebSocket in call_data for audio streaming
2025-12-29T21:47:59.351475825Z [err]  2025-12-29 21:47:59,320 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found to update for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:47:59.351480080Z [err]  2025-12-29 21:47:59,322 - server - INFO - â±ï¸ [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-29T21:47:59.409976835Z [err]  2025-12-29 21:47:59,407 - server - INFO - ğŸ”‘ Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-29T21:47:59.543543405Z [err]  2025-12-29 21:47:59,540 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:47:59.543550163Z [err]  2025-12-29 21:47:59,540 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'streaming.started', 'id': '2f7f742a-8816-4c33-9928-dda1c60d0851', 'occurred_at': '2025-12-29T21:47:58.780956Z', 'payload': {'call_control_id': 'v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q', 'call_leg_id': '060aefc8-e500-11f0-a03d-02420aef94a0', 'call_session_id': '0608ae52-e500-11f0-bc37-02420aef94a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '9b60952f-f176-4468-9764-d2edae2c31e5', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:47:59.543557669Z [err]  2025-12-29 21:47:59,540 - server - INFO - ğŸ¯ Event type: streaming.started, Call ID: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:47:59.543562676Z [err]  2025-12-29 21:47:59,540 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:47:59.543567628Z [inf]  100.64.0.13:22278 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:47:59.543572163Z [err]  2025-12-29 21:47:59,541 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:47:59.546400123Z [err]  2025-12-29 21:47:59,542 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:47:59.546413853Z [err]  2025-12-29 21:47:59,542 - server - INFO - ğŸ”§ Creating Telnyx service with user's keys...
2025-12-29T21:47:59.569835353Z [err]  2025-12-29 21:47:59,564 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:47:59.572330858Z [err]  2025-12-29 21:47:59,570 - server - INFO - âœ… Call-started webhook sent successfully (status=200)
2025-12-29T21:48:00.402522394Z [err]  2025-12-29 21:47:59,843 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q/actions/playback_start "HTTP/1.1 200 OK"
2025-12-29T21:48:00.402526618Z [err]  2025-12-29 21:47:59,844 - telnyx_service - INFO - âœ… Playing audio from URL, playback_id: TSDKW-CTTA (loop=True, overlay=True)
2025-12-29T21:48:00.402533431Z [err]  2025-12-29 21:47:59,844 - server - WARNING - âš ï¸ Failed to start comfort noise: 'v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q'
2025-12-29T21:48:00.402540497Z [err]  2025-12-29 21:47:59,844 - telnyx_service - INFO - ğŸ™ï¸ Starting recording: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:00.402547525Z [err]  2025-12-29 21:47:59,932 - soniox_service - INFO - âœ… Connected to Soniox Real-Time STT
2025-12-29T21:48:00.402553330Z [err]  2025-12-29 21:47:59,932 - soniox_service - INFO - âš™ï¸  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-29T21:48:00.402559217Z [err]  2025-12-29 21:47:59,932 - soniox_service - INFO - âš™ï¸  Endpoint detection: True, Speaker diarization: False
2025-12-29T21:48:00.402564322Z [err]  2025-12-29 21:47:59,932 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring started for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:00.402569743Z [err]  2025-12-29 21:47:59,933 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:00.402575421Z [err]  2025-12-29 21:47:59,933 - server - INFO - âœ… Started forwarding audio (8kHz mulaw â†’ Soniox, NO BUFFERING)
2025-12-29T21:48:00.438958673Z [err]  2025-12-29 21:48:00,435 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:00.438968062Z [err]  2025-12-29 21:48:00,436 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-29T21:48:01.366682099Z [err]  2025-12-29 21:48:01,317 - core_calling_service - INFO - ğŸ” KB count query completed: 4 items
2025-12-29T21:48:01.366695238Z [err]  2025-12-29 21:48:01,317 - core_calling_service - INFO - ğŸ“š Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T21:48:01.366703207Z [err]  2025-12-29 21:48:01,318 - core_calling_service - INFO - ğŸ“‹ Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T21:48:01.366766657Z [err]  2025-12-29 21:48:00,937 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:01.366773056Z [err]  2025-12-29 21:48:00,937 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-29T21:48:01.366781748Z [inf]  100.64.0.16:59308 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-29T21:48:01.366789694Z [err]  2025-12-29 21:48:01,226 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q/actions/record_start "HTTP/1.1 200 OK"
2025-12-29T21:48:01.366797065Z [err]  2025-12-29 21:48:01,228 - server - INFO - ğŸ™ï¸ Call recording started for v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:01.366805081Z [err]  2025-12-29 21:48:01,228 - server - INFO - ğŸ”§ Creating call session for v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q...
2025-12-29T21:48:01.366813533Z [err]  2025-12-29 21:48:01,228 - server - INFO - ğŸ” Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:48:01.366821967Z [err]  2025-12-29 21:48:01,228 - server - INFO - ğŸ”§ Calling create_call_session() - START
2025-12-29T21:48:01.366829429Z [err]  2025-12-29 21:48:01,228 - core_calling_service - INFO - ğŸ” Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T21:48:01.370883386Z [err]  2025-12-29 21:48:01,363 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:01.371293693Z [err]  2025-12-29 21:48:01,318 - core_calling_service - INFO - ğŸ“š KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T21:48:01.371299404Z [err]  2025-12-29 21:48:01,318 - core_calling_service - INFO - ğŸ”¥ Pre-warming LLM client (grok)...
2025-12-29T21:48:01.371305223Z [err]  2025-12-29 21:48:01,330 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:01.371311601Z [err]  2025-12-29 21:48:01,340 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:01.371316046Z [err]  2025-12-29 21:48:01,353 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q (TTL: 3600s)
2025-12-29T21:48:01.371321037Z [err]  2025-12-29 21:48:01,353 - server - INFO - â±ï¸ [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-29T21:48:01.371325759Z [err]  2025-12-29 21:48:01,354 - core_calling_service - INFO - â±ï¸ [21:48:01.354] ğŸ“¥ process_user_input() ENTRY - text: '...'
2025-12-29T21:48:01.373656282Z [err]  2025-12-29 21:48:01,364 - core_calling_service - INFO - â±ï¸ [21:48:01.364] â© About to call _process_call_flow_streaming()
2025-12-29T21:48:01.373667287Z [err]  2025-12-29 21:48:01,364 - core_calling_service - INFO - â±ï¸ [21:48:01.364] ğŸ”€ Agent type: call_flow, calling flow processor...
2025-12-29T21:48:01.373674728Z [err]  2025-12-29 21:48:01,364 - core_calling_service - INFO - â±ï¸ [21:48:01.364] ğŸ”€ _process_call_flow_streaming() ENTRY
2025-12-29T21:48:01.373682167Z [err]  2025-12-29 21:48:01,364 - core_calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-29T21:48:01.373688584Z [err]  2025-12-29 21:48:01,364 - core_calling_service - INFO - â±ï¸ [21:48:01.364] âœ… Node selected, about to process content...
2025-12-29T21:48:01.373694859Z [err]  2025-12-29 21:48:01,364 - core_calling_service - INFO - ğŸ”§ Replaced {{now}} with Monday, December 29, 2025 at 4:48 PM EST in content
2025-12-29T21:48:01.373701684Z [err]  2025-12-29 21:48:01,364 - core_calling_service - INFO - ğŸ”§ Replaced {{customer_name}} with Kendrick in content
2025-12-29T21:48:01.373709026Z [err]  2025-12-29 21:48:01,365 - core_calling_service - INFO - ğŸ”§ Replaced {{callerName}} with  in content
2025-12-29T21:48:01.373715438Z [err]  2025-12-29 21:48:01,365 - core_calling_service - INFO - ğŸ”§ Replaced {{lead_id}} with None in content
2025-12-29T21:48:01.373721143Z [err]  2025-12-29 21:48:01,365 - core_calling_service - INFO - ğŸ”§ Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T21:48:01.373725640Z [err]  2025-12-29 21:48:01,365 - core_calling_service - INFO - ğŸ”§ Replaced {{track_keywords}} with  in content
2025-12-29T21:48:01.373730541Z [err]  2025-12-29 21:48:01,365 - core_calling_service - INFO - ğŸ”§ Replaced {{expected_commitment}} with not_specified in content
2025-12-29T21:48:01.373734999Z [err]  2025-12-29 21:48:01,365 - core_calling_service - INFO - ğŸ”§ Replaced {{to_number}} with +17708336397 in content
2025-12-29T21:48:01.374454150Z [err]  2025-12-29 21:48:01,365 - core_calling_service - INFO - ğŸ”§ Replaced {{phone_number}} with +17708336397 in content
2025-12-29T21:48:01.374461265Z [err]  2025-12-29 21:48:01,365 - core_calling_service - INFO - ğŸ”§ Replaced {{email}} with None in content
2025-12-29T21:48:01.374467132Z [err]  2025-12-29 21:48:01,365 - core_calling_service - INFO - âœ… Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-29T21:48:01.374472832Z [err]  2025-12-29 21:48:01,365 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-29T21:48:01.374478494Z [err]  2025-12-29 21:48:01,365 - core_calling_service - INFO - ğŸ“š skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-29T21:48:01.374484367Z [err]  2025-12-29 21:48:01,365 - core_calling_service - INFO - â±ï¸ [21:48:01.365] ğŸ“„ About to process content (mode=script, length=9)
2025-12-29T21:48:01.374489417Z [err]  2025-12-29 21:48:01,365 - core_calling_service - INFO - ğŸ”Š Silence tracking reset for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q (user responded)
2025-12-29T21:48:01.374495812Z [err]  2025-12-29 21:48:01,365 - core_calling_service - INFO - âœ… User responded to regular message, resetting counter
2025-12-29T21:48:01.374500786Z [err]  2025-12-29 21:48:01,365 - core_calling_service - INFO - ğŸ’¾ Storing node ID 2 in conversation history
2025-12-29T21:48:01.374505879Z [err]  2025-12-29 21:48:01,365 - core_calling_service - INFO - LLM response (0.01s): Kendrick?
2025-12-29T21:48:01.374511538Z [err]  2025-12-29 21:48:01,365 - core_calling_service - INFO - Total latency: 0.01s
2025-12-29T21:48:01.374516565Z [err]  2025-12-29 21:48:01,365 - server - INFO - ğŸ’¬ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-29T21:48:01.411269567Z [err]  2025-12-29 21:48:01,406 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:48:01.413041265Z [err]  2025-12-29 21:48:01,411 - server - INFO - ğŸ”¤ RAW TOKENS: ["H"?]
2025-12-29T21:48:01.415901821Z [err]  2025-12-29 21:48:01,411 - core_calling_service - INFO - ğŸ”Š Silence timer reset for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q (user started speaking)
2025-12-29T21:48:01.415913986Z [err]  2025-12-29 21:48:01,411 - core_calling_service - INFO - ğŸ‘¤ User started speaking for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:01.415921212Z [err]  2025-12-29 21:48:01,411 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-29T21:48:01.415928216Z [err]  2025-12-29 21:48:01,411 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-29T21:48:01.424505063Z [err]  2025-12-29 21:48:01,421 - core_calling_service - INFO - âœ… LLM client pre-warmed in 103ms
2025-12-29T21:48:01.424510681Z [err]  2025-12-29 21:48:01,422 - server - INFO - ğŸ”§ Calling create_call_session() - COMPLETE
2025-12-29T21:48:01.424514546Z [err]  2025-12-29 21:48:01,422 - server - INFO - âœ… Session object created: CallSession
2025-12-29T21:48:01.443604537Z [err]  2025-12-29 21:48:01,437 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q (TTL: 3600s)
2025-12-29T21:48:01.443615740Z [err]  2025-12-29 21:48:01,438 - server - INFO - âœ… Serializable call_data synced to Redis (agent_id, user_id)
2025-12-29T21:48:01.443624497Z [err]  2025-12-29 21:48:01,438 - server - INFO - âœ… Session stored in worker memory (not Redis)
2025-12-29T21:48:01.443631039Z [err]  2025-12-29 21:48:01,438 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:01.443644958Z [err]  2025-12-29 21:48:01,439 - redis_service - INFO - âœ… Marked session ready in Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:01.443655375Z [err]  2025-12-29 21:48:01,439 - server - INFO - ğŸ¤– AI session created for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:01.443660730Z [err]  2025-12-29 21:48:01,439 - server - INFO - ğŸ“¦ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-29T21:48:01.443665904Z [err]  2025-12-29 21:48:01,439 - server - INFO - â­ï¸ Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-29T21:48:01.443672088Z [err]  2025-12-29 21:48:01,439 - server - INFO - ğŸ‘¤ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-29T21:48:01.443677510Z [err]  2025-12-29 21:48:01,439 - server - INFO - ğŸ‘‚ User speaks first - waiting for user input...
2025-12-29T21:48:01.443681992Z [err]  2025-12-29 21:48:01,439 - server - INFO - ğŸ›¡ï¸ Voicemail timeout protection started (15000ms)
2025-12-29T21:48:01.445951221Z [err]  2025-12-29 21:48:01,440 - server - INFO - â±ï¸ AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-29T21:48:01.445961880Z [err]  2025-12-29 21:48:01,440 - server - INFO - ğŸ¤ Voice flow - streaming started via dial command
2025-12-29T21:48:01.448393555Z [err]  2025-12-29 21:48:01,445 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:01.450846421Z [err]  2025-12-29 21:48:01,447 - server - INFO - ğŸ¤ No greeting - waiting for user to speak first
2025-12-29T21:48:01.450858191Z [err]  2025-12-29 21:48:01,447 - server - INFO - ğŸ¤ Voice flow - WebSocket streaming already initiated
2025-12-29T21:48:01.453230492Z [inf]  100.64.0.13:22268 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:48:01.462928917Z [err]  2025-12-29 21:48:01,460 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:01.465300858Z [err]  2025-12-29 21:48:01,461 - server - INFO - â­ï¸ [WebSocket Worker] User spoke during greeting generation - CANCELLING silence greeting
2025-12-29T21:48:01.556069457Z [err]  2025-12-29 21:48:01,553 - server - INFO - ğŸ”¤ RAW TOKENS: ["H"?, "ello"?]
2025-12-29T21:48:01.556079749Z [err]  2025-12-29 21:48:01,553 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'Hello' | Generating: False
2025-12-29T21:48:01.680712846Z [err]  2025-12-29 21:48:01,676 - server - INFO - ğŸ”¤ RAW TOKENS: ["H"âœ“, "ello"âœ“, "?"âœ“, "<end>"âœ“]
2025-12-29T21:48:01.680719523Z [err]  2025-12-29 21:48:01,676 - server - INFO - ğŸ¯ Endpoint detected: <end> token received
2025-12-29T21:48:01.680724045Z [err]  2025-12-29 21:48:01,676 - server - INFO - ğŸ§¹ Cleaned transcript: 'H ello ?' -> 'Hello?'
2025-12-29T21:48:01.680728688Z [err]  2025-12-29 21:48:01,676 - server - INFO - ğŸ“¥ FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-29T21:48:01.680733227Z [err]  2025-12-29 21:48:01,676 - server - INFO - ğŸ¤ Soniox final transcript: 'Hello?'
2025-12-29T21:48:01.680737566Z [err]  2025-12-29 21:48:01,676 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:01.680742047Z [err]  2025-12-29 21:48:01,676 - server - INFO - ğŸ” FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-29T21:48:01.680749388Z [err]  2025-12-29 21:48:01,676 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:01.680754158Z [err]  2025-12-29 21:48:01,676 - server - INFO - ğŸš€ Spawned tracked background task for endpoint processing
2025-12-29T21:48:01.680758223Z [err]  2025-12-29 21:48:01,677 - server - INFO - â±ï¸ [21:48:01.677] ğŸ“ FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-29T21:48:01.680763365Z [err]  2025-12-29 21:48:01,677 - server - INFO - â±ï¸ [21:48:01.677] STT endpoint detection latency: 12ms
2025-12-29T21:48:01.680767827Z [err]  2025-12-29 21:48:01,677 - server - INFO - â±ï¸ [21:48:01.677] ğŸ¤ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-29T21:48:01.680772066Z [err]  2025-12-29 21:48:01,677 - server - INFO - â±ï¸ User spoke at 1767044881.6771474
2025-12-29T21:48:01.682699252Z [err]  2025-12-29 21:48:01,678 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q (TTL: 3600s)
2025-12-29T21:48:01.682709820Z [err]  2025-12-29 21:48:01,678 - server - INFO - ğŸ‘¤ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-29T21:48:01.682715441Z [err]  2025-12-29 21:48:01,678 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:01.682722537Z [err]  2025-12-29 21:48:01,678 - server - INFO - âœ… Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-29T21:48:01.692334944Z [err]  2025-12-29 21:48:01,689 - server - INFO - ğŸ¤ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-29T21:48:01.692347449Z [err]  2025-12-29 21:48:01,690 - core_calling_service - INFO - ğŸ‘¤ User stopped speaking for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:01.692354441Z [err]  2025-12-29 21:48:01,690 - server - INFO - â±ï¸ [TIMING] STT_START: User last audio packet received
2025-12-29T21:48:01.692359673Z [err]  2025-12-29 21:48:01,690 - server - INFO - â±ï¸ [TIMING] STT_END: Endpoint detected at T+4ms
2025-12-29T21:48:01.692364929Z [err]  2025-12-29 21:48:01,690 - server - INFO - â±ï¸ [TIMING] STT_LATENCY: 4ms (Soniox model: stt-rt-v3)
2025-12-29T21:48:01.692371186Z [err]  2025-12-29 21:48:01,690 - server - INFO - â±ï¸  USER STOPPED SPEAKING at T=0ms
2025-12-29T21:48:01.692376471Z [err]  2025-12-29 21:48:01,690 - server - INFO - ğŸ™ï¸ Agent generating response - interruption detection active
2025-12-29T21:48:01.692381667Z [err]  2025-12-29 21:48:01,690 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:01.784813434Z [err]  2025-12-29 21:48:01,782 - server - INFO - ğŸ“ Saved user transcript to database
2025-12-29T21:48:01.784820353Z [err]  2025-12-29 21:48:01,782 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:01.784825292Z [err]  2025-12-29 21:48:01,782 - core_calling_service - INFO - â±ï¸ [21:48:01.782] ğŸ“¥ process_user_input() ENTRY - text: 'Hello?...'
2025-12-29T21:48:01.784829998Z [err]  2025-12-29 21:48:01,783 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:01.784834454Z [err]  2025-12-29 21:48:01,783 - core_calling_service - WARNING - ğŸš¨ BARGE-IN DETECTED for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q: User spoke while Silence Greeting was triggering
2025-12-29T21:48:01.815703302Z [err]  2025-12-29 21:48:01,811 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:48:01.815711702Z [err]  2025-12-29 21:48:01,811 - telnyx_service - INFO - ğŸ›‘ Stopping audio playback on call: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:02.347562170Z [err]  2025-12-29 21:48:02,230 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q (TTL: 3600s)
2025-12-29T21:48:02.347572308Z [err]  2025-12-29 21:48:02,231 - core_calling_service - INFO - âœ… BARGE-IN: Reset silence_greeting_triggered flag
2025-12-29T21:48:02.347579405Z [err]  2025-12-29 21:48:02,231 - core_calling_service - INFO - â±ï¸ [21:48:02.231] â© About to call _process_call_flow_streaming()
2025-12-29T21:48:02.347584815Z [err]  2025-12-29 21:48:02,231 - core_calling_service - INFO - â±ï¸ [21:48:02.231] ğŸ”€ Agent type: call_flow, calling flow processor...
2025-12-29T21:48:02.347598970Z [err]  2025-12-29 21:48:01,941 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:02.347607439Z [err]  2025-12-29 21:48:01,941 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:02.347615286Z [err]  2025-12-29 21:48:02,228 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q/actions/playback_stop "HTTP/1.1 200 OK"
2025-12-29T21:48:02.347627005Z [err]  2025-12-29 21:48:02,229 - telnyx_service - INFO - âœ… Successfully stopped audio playback
2025-12-29T21:48:02.347643980Z [err]  2025-12-29 21:48:02,229 - core_calling_service - INFO - âœ… BARGE-IN: Audio playback STOPPED
2025-12-29T21:48:02.347652638Z [err]  2025-12-29 21:48:02,229 - core_calling_service - INFO - âœ… BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-29T21:48:02.347658198Z [err]  2025-12-29 21:48:02,230 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:02.351227383Z [err]  2025-12-29 21:48:02,231 - core_calling_service - INFO - â±ï¸ [21:48:02.231] ğŸ”€ _process_call_flow_streaming() ENTRY
2025-12-29T21:48:02.351233691Z [err]  2025-12-29 21:48:02,231 - core_calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-29T21:48:02.351238655Z [err]  2025-12-29 21:48:02,231 - core_calling_service - INFO - ğŸ” Using explicitly set current_node_id: 2
2025-12-29T21:48:02.351243080Z [err]  2025-12-29 21:48:02,231 - core_calling_service - INFO - â±ï¸ [21:48:02.231] ğŸ”€ About to call _follow_transition() for: Hello?...
2025-12-29T21:48:02.351247509Z [err]  2025-12-29 21:48:02,231 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Hello?
2025-12-29T21:48:02.351252111Z [err]  2025-12-29 21:48:02,231 - core_calling_service - INFO - ğŸ” Checking 'Hello=Yes' override [DEPLOYMENT VERIFIED] for msg='hello' on node='Greeting'
2025-12-29T21:48:02.351256609Z [err]  2025-12-29 21:48:02,231 - core_calling_service - WARNING - âš ï¸ Auto-transition after response target not found: None, falling back to normal evaluation
2025-12-29T21:48:02.351260887Z [err]  2025-12-29 21:48:02,239 - core_calling_service - INFO - â±ï¸ [21:48:02.239] ğŸ”€ TRANSITION EVALUATION START - Calling LLM for 2 options
2025-12-29T21:48:02.405021628Z [err]  2025-12-29 21:48:02,401 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:48:02.405035269Z [err]  2025-12-29 21:48:02,401 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': 'b6182387-e1f5-4944-a494-208614de188e', 'occurred_at': '2025-12-29T21:48:01.960953Z', 'payload': {'call_control_id': 'v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q', 'call_leg_id': '060aefc8-e500-11f0-a03d-02420aef94a0', 'call_session_id': '0608ae52-e500-11f0-bc37-02420aef94a0', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:48:02.405040756Z [err]  2025-12-29 21:48:02,401 - server - INFO - ğŸ¯ Event type: call.machine.premium.detection.ended, Call ID: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:02.405045935Z [err]  2025-12-29 21:48:02,402 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:48:02.405053330Z [inf]  100.64.0.18:16548 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:48:02.447432473Z [err]  2025-12-29 21:48:02,445 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:02.447441579Z [err]  2025-12-29 21:48:02,445 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:03.276689183Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - Selected transition index: -1
2025-12-29T21:48:03.276698966Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - No specific condition matched, looking for default transition...
2025-12-29T21:48:03.276708850Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - âš ï¸ No transition matched, but node has GOAL. Staying on current node to continue with goal-based guidance.
2025-12-29T21:48:03.276715853Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - ğŸ¯ Goal: Say the customer's name...
2025-12-29T21:48:03.276721282Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - â±ï¸ [TIMING] TRANSITION_EVAL: 597ms
2025-12-29T21:48:03.276727459Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - â±ï¸ [21:48:02.828] âœ… Node selected, about to process content...
2025-12-29T21:48:03.276732545Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - ğŸ”§ Replaced {{now}} with Monday, December 29, 2025 at 4:48 PM EST in content
2025-12-29T21:48:03.276737614Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - ğŸ”§ Replaced {{customer_name}} with Kendrick in content
2025-12-29T21:48:03.276742773Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - ğŸ”§ Replaced {{callerName}} with  in content
2025-12-29T21:48:03.276845858Z [err]  2025-12-29 21:48:02,821 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-29T21:48:03.276853346Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - â±ï¸ [21:48:02.828] ğŸ”€ TRANSITION EVALUATION COMPLETE - took 588ms
2025-12-29T21:48:03.276861417Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - ğŸ¤– AI transition decision: '-1'
2025-12-29T21:48:03.276868863Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - ğŸ“Š Available transitions: ['Confirms name (Yes|Speaking|This is he/she) OR Ask...', 'Wrong number (No John here|Wrong number|etc) - don...']
2025-12-29T21:48:03.280458230Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - ğŸ”§ Replaced {{lead_id}} with None in content
2025-12-29T21:48:03.280467110Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - ğŸ”§ Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T21:48:03.280474619Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - ğŸ”§ Replaced {{track_keywords}} with  in content
2025-12-29T21:48:03.280480744Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - ğŸ”§ Replaced {{expected_commitment}} with not_specified in content
2025-12-29T21:48:03.280486183Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - ğŸ”§ Replaced {{to_number}} with +17708336397 in content
2025-12-29T21:48:03.280493813Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - ğŸ”§ Replaced {{phone_number}} with +17708336397 in content
2025-12-29T21:48:03.280501095Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - ğŸ”§ Replaced {{email}} with None in content
2025-12-29T21:48:03.280507074Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - âœ… Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-29T21:48:03.280513484Z [err]  2025-12-29 21:48:02,828 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-29T21:48:03.280519960Z [err]  2025-12-29 21:48:02,829 - core_calling_service - INFO - ğŸ“š skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-29T21:48:03.280525746Z [err]  2025-12-29 21:48:02,829 - core_calling_service - INFO - â±ï¸ [21:48:02.829] ğŸ“„ About to process content (mode=script, length=9)
2025-12-29T21:48:03.280531812Z [err]  2025-12-29 21:48:02,829 - core_calling_service - INFO - ğŸ›¡ï¸ Preventing Dead Air: User stayed on script node 'Greeting' without transition
2025-12-29T21:48:03.280538722Z [err]  2025-12-29 21:48:02,829 - core_calling_service - INFO - ğŸ¤– Generating sticky-prevention response...
2025-12-29T21:48:03.280700215Z [err]  2025-12-29 21:48:02,836 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:48:03.280709529Z [err]  2025-12-29 21:48:02,836 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.started', 'id': '8ac30149-b8e2-431a-93d4-90fd1de319e1', 'occurred_at': '2025-12-29T21:48:02.320953Z', 'payload': {'call_control_id': 'v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q', 'call_leg_id': '060aefc8-e500-11f0-a03d-02420aef94a0', 'call_session_id': '0608ae52-e500-11f0-bc37-02420aef94a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'TSDKW-CTTA', 'start_time': '2025-12-29T21:48:02.320953Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:48:03.280716919Z [err]  2025-12-29 21:48:02,836 - server - INFO - ğŸ¯ Event type: call.playback.started, Call ID: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:03.280726561Z [err]  2025-12-29 21:48:02,836 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:48:03.280739003Z [inf]  100.64.0.5:42090 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:48:03.280747651Z [err]  2025-12-29 21:48:02,837 - core_calling_service - INFO - âš¡ PARALLEL MODE: Running KB + analysis simultaneously
2025-12-29T21:48:03.280752876Z [err]  2025-12-29 21:48:02,838 - kb_router - INFO - ğŸš¦ KB Router: SKIP (simple chat pattern matched)
2025-12-29T21:48:03.280758005Z [err]  2025-12-29 21:48:02,838 - core_calling_service - INFO - âš¡ Skipping KB (reason: simple_chat)
2025-12-29T21:48:03.280764036Z [err]  2025-12-29 21:48:02,838 - core_calling_service - INFO - âš¡ Parallel operations completed in 0ms
2025-12-29T21:48:03.280771157Z [err]  2025-12-29 21:48:02,839 - core_calling_service - INFO - ğŸ” Node 'Greeting': use_parallel_llm=True
2025-12-29T21:48:03.282054044Z [err]  2025-12-29 21:48:02,840 - core_calling_service - INFO - âš¡ Parallel mode: Using condensed history (3/3 messages)
2025-12-29T21:48:03.282064483Z [err]  2025-12-29 21:48:02,840 - core_calling_service - INFO - â±ï¸ [21:48:02.840] ğŸ’¬ LLM REQUEST START: 3 conversation turns, 7881 system chars (KB cached)
2025-12-29T21:48:03.282070829Z [err]  2025-12-29 21:48:02,840 - core_calling_service - INFO - ğŸ“ â•â•â•â•â•â•â•â•â•â•â• LLM PROMPT BREAKDOWN â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:48:03.282075086Z [err]  2025-12-29 21:48:02,840 - core_calling_service - INFO - ğŸ“ [SYSTEM MSG 1 - GLOBAL PROMPT] (6467 chars):
2025-12-29T21:48:03.282079648Z [err]  2025-12-29 21:48:02,840 - core_calling_service - INFO - ğŸ“   Preview: # Global Prompt: Direct Drive Engine (V4.2 - Acknowledging & Fluid)
2025-12-29T21:48:03.282083904Z [err]  
2025-12-29T21:48:03.282088965Z [err]  When user states income, convert/update as [yearly_income] variable for logic splits.
2025-12-29T21:48:03.282093257Z [err]  
2025-12-29T21:48:03.282097266Z [err]  If user says a name, don't assume it's theirsâ€”wait for explicit correction.
2025-12-29T21:48:03.282101190Z [err]  
2025-12-29T21:48:03.282104981Z [err]  If user asks to repeat info, rephrase naturallyâ€”never exact repeat.
2025-12-29T21:48:03.282122076Z [err]  
2025-12-29T21:48:03.282126824Z [err]  If asked your state: "Atlanta, GA. Been in Midtown 10 years."
2025-12-29T21:48:03.282132836Z [err]  
2025-12-29T21:48:03.282140483Z [err]  If asked about call number: "Company number."
2025-12-29T21:48:03.282146408Z [err]  
2025-12-29T21:48:03.282155327Z [err]  User email: {customer_email} (for them: {{customer_email}}).
2025-12-29T21:48:03.282162438Z [err]  
2025-12-29T21:48:03.282168657Z [err]  If explaining ends in peri...
2025-12-29T21:48:03.282174230Z [err]  2025-12-29 21:48:02,840 - core_calling_service - INFO - ğŸ“ [SYSTEM MSG 2 - DYNAMIC CONTEXT] (1414 chars):
2025-12-29T21:48:03.284228082Z [err]  2025-12-29 21:48:02,840 - core_calling_service - INFO - ğŸ“   Preview: 
2025-12-29T21:48:03.284238478Z [err]  
2025-12-29T21:48:03.284243372Z [err]  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-29T21:48:03.284253176Z [err]  PREPROCESSED CONTEXT (to help you prioritize and focus):
2025-12-29T21:48:03.284258352Z [err]  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-29T21:48:03.284263345Z [err]  
2025-12-29T21:48:03.284267936Z [err]  USER COMMUNICATION STYLE: C type - adjust your response accordingly
2025-12-29T21:48:03.284273547Z [err]  CONVERSATION STATUS: Turn 2, objection handling phase
2025-12-29T21:48:03.284277864Z [err]  
2025-12-29T21:48:03.284282155Z [err]  This context is provided to help you focus. You still need to:
2025-12-29T21:48:03.284285859Z [err]  1. Generate a natural, contextual response
2025-12-29T21:48:03.284289872Z [err]  2. Evaluate transitions per your node instructions
2025-12-29T21:48:03.284293576Z [err]  
2025-12-29T21:48:03.284297748Z [err]  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-29T21:48:03.284302589Z [err]  
2025-12-29T21:48:03.284308048Z [err]  # CURRENT CONTEXT
2025-12-29T21:48:03.284312254Z [err]  Customer: Kendrick
2025-12-29T21:48:03.284316296Z [err]  Variables: {"now": "Monday, December 29, 2025 at 4:48 PM EST", "customer_name": "Kendrick", "callerName": "", "lead_id": null, "qc_tracking_enabled": false, "track_keywords": "", "expected_commitment": ...
2025-12-29T21:48:03.286194043Z [err]  2025-12-29 21:48:02,840 - core_calling_service - INFO - ğŸ“ [CONVERSATION HISTORY] (3 messages)
2025-12-29T21:48:03.286200834Z [err]  2025-12-29 21:48:02,840 - core_calling_service - INFO - ğŸ“   assistant: Kendrick?...
2025-12-29T21:48:03.286205592Z [err]  2025-12-29 21:48:02,840 - core_calling_service - INFO - ğŸ“   user: Hello?...
2025-12-29T21:48:03.286209542Z [err]  2025-12-29 21:48:02,840 - core_calling_service - INFO - ğŸ“ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:48:03.286213715Z [err]  2025-12-29 21:48:02,947 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:03.286218185Z [err]  2025-12-29 21:48:02,947 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:03.373125092Z [err]  2025-12-29 21:48:03,368 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-29T21:48:03.454470842Z [err]  2025-12-29 21:48:03,448 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:03.454479510Z [err]  2025-12-29 21:48:03,448 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:03.639819073Z [err]  2025-12-29 21:48:03,637 - core_calling_service - INFO - â±ï¸ [21:48:03.637] ğŸ’¬ LLM FIRST TOKEN: 796ms (grok grok-4-1-fast-non-reasoning)
2025-12-29T21:48:03.710401718Z [err]  2025-12-29 21:48:03,707 - server - INFO - ğŸ“¤ Sentence arrived from LLM: [N] Hey Kendrick,...
2025-12-29T21:48:03.710410094Z [err]  2025-12-29 21:48:03,707 - server - INFO - â±ï¸ [TIMING] TTFS (Time To First Sentence): 2017ms
2025-12-29T21:48:03.710416092Z [err]  2025-12-29 21:48:03,707 - server - INFO - âš¡ Starting REAL-TIME TTS for first sentence
2025-12-29T21:48:03.710421437Z [err]  2025-12-29 21:48:03,707 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:03.710426436Z [err]  2025-12-29 21:48:03,707 - server - INFO - âš¡ ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-29T21:48:03.798384368Z [err]  2025-12-29 21:48:03,792 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:48:04.362310570Z [err]  2025-12-29 21:48:03,878 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:48:04.362315514Z [err]  2025-12-29 21:48:03,950 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:04.362321056Z [err]  2025-12-29 21:48:03,950 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:nR6TC02pcaq5ZFHTp... (active sessions: ['v3:Y7jef5Qoat0bcBDCG_3BIXar8c3CFZ1AMolAAEqCbAUTKXEdeiDbkg'])
2025-12-29T21:48:04.362328654Z [err]  2025-12-29 21:48:03,963 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:48:04.362333320Z [err]  2025-12-29 21:48:03,984 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:48:04.362337763Z [err]  2025-12-29 21:48:03,984 - server - INFO - âœ… ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-29T21:48:04.362344963Z [err]  2025-12-29 21:48:03,984 - persistent_tts_service - INFO - ğŸ™ï¸ Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:48:04.362349504Z [err]  2025-12-29 21:48:03,984 - persistent_tts_service - INFO - ğŸ”Œ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Establishing persistent TTS WebSocket...
2025-12-29T21:48:04.362355691Z [err]  2025-12-29 21:48:03,984 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:48:04.362360223Z [err]  2025-12-29 21:48:03,984 - elevenlabs_ws_service - INFO - ğŸ”Œ Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-29T21:48:04.362365807Z [err]  2025-12-29 21:48:03,984 - elevenlabs_ws_service - INFO - ğŸ™ï¸ Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-29T21:48:04.365074303Z [err]  2025-12-29 21:48:04,120 - elevenlabs_ws_service - INFO - âœ… Connected to ElevenLabs WebSocket
2025-12-29T21:48:04.365082661Z [err]  2025-12-29 21:48:04,120 - elevenlabs_ws_service - INFO - ğŸ“¤ Sent BOS message with voice settings
2025-12-29T21:48:04.365087453Z [err]  2025-12-29 21:48:04,120 - persistent_tts_service - INFO - âœ… [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Persistent TTS WebSocket established
2025-12-29T21:48:04.365092240Z [err]  2025-12-29 21:48:04,120 - persistent_tts_service - INFO - ğŸ§ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Audio receiver loop started
2025-12-29T21:48:04.365096331Z [err]  2025-12-29 21:48:04,120 - persistent_tts_service - INFO - ğŸ”Š [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Comfort noise loop started
2025-12-29T21:48:04.365101142Z [err]  2025-12-29 21:48:04,120 - persistent_tts_service - INFO - âœ… Created persistent TTS session for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:04.365104961Z [err]  2025-12-29 21:48:04,120 - server - INFO - âœ… ON-DEMAND: Persistent TTS session created successfully!
2025-12-29T21:48:04.365108982Z [err]  2025-12-29 21:48:04,120 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:nR6TC02pcaq5ZFHTp..., session=FOUND
2025-12-29T21:48:04.365112934Z [err]  2025-12-29 21:48:04,120 - server - INFO - ğŸš€ Streaming sentence #1 via persistent WebSocket
2025-12-29T21:48:04.365117178Z [err]  2025-12-29 21:48:04,120 - server - INFO - ğŸµ TTS task #1 started at +413ms
2025-12-29T21:48:04.365121253Z [err]  2025-12-29 21:48:04,120 - server - INFO - â±ï¸ [TIMING] TTFT_TTS (First TTS Task Started): 2430ms
2025-12-29T21:48:04.365125477Z [err]  2025-12-29 21:48:04,120 - core_calling_service - INFO - ğŸ“¤ Streamed sentence: [N] Hey Kendrick,...
2025-12-29T21:48:04.365129328Z [err]  2025-12-29 21:48:04,121 - persistent_tts_service - INFO - ğŸµ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Playback consumer started
2025-12-29T21:48:04.365843170Z [err]  2025-12-29 21:48:04,121 - persistent_tts_service - INFO - ğŸ§ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Audio Receiver Loop STARTED
2025-12-29T21:48:04.365850368Z [err]  2025-12-29 21:48:04,121 - persistent_tts_service - INFO - ğŸ’“ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Starting TTS keep-alive loop (every 15s)
2025-12-29T21:48:04.365855936Z [err]  2025-12-29 21:48:04,121 - persistent_tts_service - INFO - ğŸ”Š [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Starting comfort noise loop
2025-12-29T21:48:04.365860864Z [err]  2025-12-29 21:48:04,122 - persistent_tts_service - INFO - ğŸ¤ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Streaming sentence #1: [N] Hey Kendrick,...
2025-12-29T21:48:04.365865114Z [err]  2025-12-29 21:48:04,122 - persistent_tts_service - INFO - ğŸš€ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-29T21:48:04.365869912Z [err]  2025-12-29 21:48:04,122 - persistent_tts_service - INFO - ğŸ“Š [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-29T21:48:04.365875237Z [err]  2025-12-29 21:48:04,123 - server - INFO - ğŸ“¤ Sentence arrived from LLM: it's Jake here from JK....
2025-12-29T21:48:04.365880085Z [err]  2025-12-29 21:48:04,123 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:nR6TC02pcaq5ZFHTp..., session=FOUND
2025-12-29T21:48:04.365884393Z [err]  2025-12-29 21:48:04,123 - server - INFO - ğŸš€ Streaming sentence #2 via persistent WebSocket
2025-12-29T21:48:04.365888571Z [err]  2025-12-29 21:48:04,123 - server - INFO - ğŸµ TTS task #2 started at +416ms
2025-12-29T21:48:04.365893441Z [err]  2025-12-29 21:48:04,123 - core_calling_service - INFO - ğŸ“¤ Streamed sentence: it's Jake here from JK....
2025-12-29T21:48:04.365897526Z [err]  2025-12-29 21:48:04,124 - persistent_tts_service - INFO - ğŸ§ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Receiver processing sentence #1: '[N] Hey Kendrick,...'
2025-12-29T21:48:04.368203266Z [err]  2025-12-29 21:48:04,124 - persistent_tts_service - INFO - ğŸ“Š [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] DIAGNOSTIC: queue_latency=2ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-29T21:48:04.368213265Z [err]  2025-12-29 21:48:04,124 - persistent_tts_service - INFO - ğŸ¤ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Streaming sentence #2: it's Jake here from JK....
2025-12-29T21:48:04.368222245Z [err]  2025-12-29 21:48:04,125 - persistent_tts_service - INFO - ğŸš€ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Sent sentence #2 (NON-BLOCKING) in 0ms
2025-12-29T21:48:04.368230460Z [err]  2025-12-29 21:48:04,125 - persistent_tts_service - INFO - ğŸ“Š [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=False, is_last=False
2025-12-29T21:48:04.368237768Z [err]  2025-12-29 21:48:04,125 - server - INFO - ğŸ“¤ Sentence arrived from LLM: You there?...
2025-12-29T21:48:04.368243497Z [err]  2025-12-29 21:48:04,125 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:nR6TC02pcaq5ZFHTp..., session=FOUND
2025-12-29T21:48:04.368250222Z [err]  2025-12-29 21:48:04,125 - server - INFO - ğŸš€ Streaming sentence #3 via persistent WebSocket
2025-12-29T21:48:04.368265755Z [err]  2025-12-29 21:48:04,125 - server - INFO - ğŸµ TTS task #3 started at +418ms
2025-12-29T21:48:04.368272416Z [err]  2025-12-29 21:48:04,125 - core_calling_service - INFO - ğŸ“¤ Streamed final fragment: You there?...
2025-12-29T21:48:04.368278630Z [err]  2025-12-29 21:48:04,125 - core_calling_service - INFO - â±ï¸ [TIMING] LLM_TOTAL: 1284ms for 52 chars (grok grok-4-1-fast-non-reasoning)
2025-12-29T21:48:04.368284084Z [err]  2025-12-29 21:48:04,125 - core_calling_service - INFO - ğŸ”Š Silence tracking reset for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q (user responded)
2025-12-29T21:48:04.368291197Z [err]  2025-12-29 21:48:04,125 - core_calling_service - INFO - âœ… User responded to regular message, resetting counter
2025-12-29T21:48:04.370060072Z [err]  2025-12-29 21:48:04,125 - core_calling_service - INFO - ğŸ’¾ Storing node ID 2 in conversation history
2025-12-29T21:48:04.370070658Z [err]  2025-12-29 21:48:04,125 - core_calling_service - INFO - LLM response (2.34s): [N] Hey Kendrick, it's Jake here from JK. You there?
2025-12-29T21:48:04.370076971Z [err]  2025-12-29 21:48:04,125 - core_calling_service - INFO - Total latency: 2.34s
2025-12-29T21:48:04.370082715Z [err]  2025-12-29 21:48:04,126 - server - INFO - âœ… LLM finished in 2436ms, TTS tasks already running in background
2025-12-29T21:48:04.370088858Z [err]  2025-12-29 21:48:04,126 - server - INFO - ğŸµ Streaming 3 TTS chunks as they complete...
2025-12-29T21:48:04.370095252Z [err]  2025-12-29 21:48:04,126 - server - INFO - ğŸš€ Persistent TTS: Audio already streaming in background!
2025-12-29T21:48:04.370101698Z [err]  2025-12-29 21:48:04,126 - server - INFO -    3 sentences queued and playing seamlessly
2025-12-29T21:48:04.370108395Z [err]  2025-12-29 21:48:04,127 - persistent_tts_service - INFO - ğŸ¤ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Streaming sentence #3: You there?...
2025-12-29T21:48:04.370116000Z [err]  2025-12-29 21:48:04,127 - persistent_tts_service - INFO - ğŸš€ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Sent sentence #3 (NON-BLOCKING) in 0ms
2025-12-29T21:48:04.370125875Z [err]  2025-12-29 21:48:04,127 - persistent_tts_service - INFO - ğŸ“Š [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] DIAGNOSTIC: pending_sentences=2, audio_queue=0, is_first=False, is_last=False
2025-12-29T21:48:04.370152012Z [err]  2025-12-29 21:48:04,127 - server - INFO - âœ… All 3 persistent TTS streams completed
2025-12-29T21:48:04.370157748Z [err]  2025-12-29 21:48:04,127 - server - INFO - âœ… Agent generation complete (persistent TTS) - response window closed
2025-12-29T21:48:04.370164353Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  FIRST AUDIO STARTED: 2437ms from user stop ğŸš€
2025-12-29T21:48:04.372503876Z [err]  2025-12-29 21:48:04,127 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:04.372512335Z [err]  2025-12-29 21:48:04,127 - server - INFO - âœ… Agent generation complete - response window closed
2025-12-29T21:48:04.372518190Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:48:04.372523693Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-29T21:48:04.372529729Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  [TIMING] STT: 4ms (provider: soniox, model: stt-rt-v3)
2025-12-29T21:48:04.372557406Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  [TIMING] LLM_TOTAL: 2436ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-29T21:48:04.372565004Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  [TIMING] TTS_TOTAL: 420ms (provider: elevenlabs, websocket: False)
2025-12-29T21:48:04.372571755Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  [TIMING] E2E_TOTAL: 2437ms (user stopped â†’ play_audio_url called)
2025-12-29T21:48:04.372579198Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  [TIMING] âš ï¸ NOTE: E2E_TOTAL does not include:
2025-12-29T21:48:04.372586404Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-29T21:48:04.372592390Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-29T21:48:04.372601949Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-29T21:48:04.372608285Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-29T21:48:04.375391179Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  [TIMING]   - REAL USER LATENCY: 2737ms estimated
2025-12-29T21:48:04.375471253Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  [TIMING] RESPONSE_TEXT: 52 chars, 3 sentences
2025-12-29T21:48:04.375479277Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  [TIMING] USER_INPUT: 'Hello?...'
2025-12-29T21:48:04.375486389Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  [TIMING] AI_RESPONSE: '[N] Hey Kendrick, it's Jake here from JK. You there?...'
2025-12-29T21:48:04.375492825Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  [TIMING] ==========================
2025-12-29T21:48:04.375498911Z [err]  2025-12-29 21:48:04,127 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:48:04.375505573Z [err]  2025-12-29 21:48:04,311 - server - INFO - ğŸ“ Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 2860ms)
2025-12-29T21:48:04.375511405Z [err]  2025-12-29 21:48:04,311 - server - INFO - ğŸ”Š Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-29T21:48:04.375518575Z [err]  2025-12-29 21:48:04,312 - server - INFO - ğŸ” END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-29T21:48:04.384181101Z [err]  2025-12-29 21:48:04,379 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTFA (Time To First Audio Playback): 257ms
2025-12-29T21:48:04.384190518Z [err]  2025-12-29 21:48:04,380 - persistent_tts_service - INFO - ğŸ“¤ Sending 9643 bytes of audio (61 chunks, 1.2s duration) via WebSocket
2025-12-29T21:48:04.384196453Z [err]  2025-12-29 21:48:04,380 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:48:04.384205484Z [err]  2025-12-29 21:48:04,380 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +1.2s (total: 1.2s from now)
2025-12-29T21:48:04.384211970Z [err]  2025-12-29 21:48:04,381 - persistent_tts_service - INFO - âœ… Sent 61 audio chunks via WebSocket
2025-12-29T21:48:04.575867181Z [err]  2025-12-29 21:48:04,573 - persistent_tts_service - INFO - ğŸ“¤ Sending 13004 bytes of audio (82 chunks, 1.6s duration) via WebSocket
2025-12-29T21:48:04.575873596Z [err]  2025-12-29 21:48:04,573 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:48:04.575878500Z [err]  2025-12-29 21:48:04,573 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +1.6s (total: 2.6s from now)
2025-12-29T21:48:04.578305665Z [err]  2025-12-29 21:48:04,574 - persistent_tts_service - INFO - âœ… Sent 82 audio chunks via WebSocket
2025-12-29T21:48:04.758984865Z [err]  2025-12-29 21:48:04,755 - persistent_tts_service - INFO - ğŸ“¤ Sending 5201 bytes of audio (33 chunks, 0.7s duration) via WebSocket
2025-12-29T21:48:04.758995249Z [err]  2025-12-29 21:48:04,755 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:48:04.759002384Z [err]  2025-12-29 21:48:04,755 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +0.7s (total: 3.1s from now)
2025-12-29T21:48:04.759009747Z [err]  2025-12-29 21:48:04,756 - persistent_tts_service - INFO - âœ… Sent 33 audio chunks via WebSocket
2025-12-29T21:48:05.345368474Z [err]  2025-12-29 21:48:04,944 - server - INFO - ğŸ“¤ Audio flowing: 295 packets sent to Soniox (5s update)
2025-12-29T21:48:05.461986457Z [err]  2025-12-29 21:48:05,459 - dead_air_monitor - INFO - ğŸ”‡ MONITOR: Skipping silence check - audio playing (2.4s left)
2025-12-29T21:48:06.340163144Z [err]  2025-12-29 21:48:05,959 - dead_air_monitor - INFO - ğŸ”‡ MONITOR: Skipping silence check - audio playing (1.9s left)
2025-12-29T21:48:06.758193620Z [err]  2025-12-29 21:48:06,754 - elevenlabs_ws_service - INFO - â±ï¸  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-29T21:48:06.758200385Z [err]  2025-12-29 21:48:06,755 - persistent_tts_service - INFO - âœ… [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Receiver finished sentence #1: 3 chunks in 2632ms
2025-12-29T21:48:06.758204751Z [err]  2025-12-29 21:48:06,755 - persistent_tts_service - INFO - ğŸ§ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Receiver processing sentence #2: 'it's Jake here from JK....'
2025-12-29T21:48:06.758208623Z [err]  2025-12-29 21:48:06,755 - persistent_tts_service - INFO - ğŸ“Š [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] DIAGNOSTIC: queue_latency=2630ms, pending_sentences=1, audio_queue=0, interrupted=False
2025-12-29T21:48:08.337844445Z [err]  2025-12-29 21:48:07,883 - persistent_tts_service - INFO - ğŸ”‡ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] FLOOR RELEASED (is_holding_floor=False)
2025-12-29T21:48:08.337851492Z [err]  2025-12-29 21:48:07,966 - dead_air_monitor - INFO - â±ï¸ Playback expected end time passed (0.1s ago), marking agent as done speaking
2025-12-29T21:48:08.337859213Z [err]  2025-12-29 21:48:07,967 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044887.9670012 for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:08.337868870Z [err]  2025-12-29 21:48:07,967 - core_calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:09.361018393Z [err]  2025-12-29 21:48:09,255 - elevenlabs_ws_service - WARNING - âš ï¸  [TIMING] ElevenLabs timeout waiting for first chunk (2.5s) - No audio received!
2025-12-29T21:48:09.361027389Z [err]  2025-12-29 21:48:09,255 - persistent_tts_service - WARNING - âš ï¸ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Receiver got 0 chunks for sentence #2! interrupted=False
2025-12-29T21:48:09.361035889Z [err]  2025-12-29 21:48:09,255 - persistent_tts_service - INFO - ğŸ§ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Receiver processing sentence #3: 'You there?...'
2025-12-29T21:48:09.361044139Z [err]  2025-12-29 21:48:09,255 - persistent_tts_service - INFO - ğŸ“Š [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] DIAGNOSTIC: queue_latency=5128ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-29T21:48:10.343881838Z [err]  2025-12-29 21:48:09,847 - server - INFO - ğŸ“ Telnyx WebSocket disconnected. Sent 530 total packets
2025-12-29T21:48:10.343887512Z [err]  [2025-12-29 21:48:09 +0000] [4] [INFO] connection closed
2025-12-29T21:48:10.343892517Z [err]  2025-12-29 21:48:10,015 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:48:10.343897316Z [err]  2025-12-29 21:48:10,015 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.hangup', 'id': '3ee496bf-9e35-4382-b236-fc9dfb92a856', 'occurred_at': '2025-12-29T21:48:09.540958Z', 'payload': {'call_control_id': 'v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q', 'call_leg_id': '060aefc8-e500-11f0-a03d-02420aef94a0', 'call_quality_stats': {'inbound': {'jitter_max_variance': '44.50', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '550', 'skip_packet_count': '16'}, 'outbound': {'packet_count': '532', 'skip_packet_count': '0'}}, 'call_session_id': '0608ae52-e500-11f0-bc37-02420aef94a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:48:09.540958Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-29T21:47:51.560952Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:48:10.343902255Z [err]  2025-12-29 21:48:10,015 - server - INFO - ğŸ¯ Event type: call.hangup, Call ID: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:10.343906556Z [err]  2025-12-29 21:48:10,015 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:48:10.343910962Z [err]  2025-12-29 21:48:10,015 - server - INFO - ğŸ“ Call ended: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:10.343915439Z [err]  2025-12-29 21:48:10,016 - server - INFO - ğŸ“ Hangup cause: normal_clearing
2025-12-29T21:48:10.347123274Z [err]  2025-12-29 21:48:10,018 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:48:10.347128689Z [err]  2025-12-29 21:48:10,018 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '2e7c7be6-a348-4eed-92a3-57c916f86ed8', 'occurred_at': '2025-12-29T21:48:09.580964Z', 'payload': {'call_control_id': 'v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q', 'call_leg_id': '060aefc8-e500-11f0-a03d-02420aef94a0', 'call_session_id': '0608ae52-e500-11f0-bc37-02420aef94a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:48:09.580964Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'TSDKW-CTTA', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:48:10.347134008Z [err]  2025-12-29 21:48:10,018 - server - INFO - ğŸ¯ Event type: call.playback.ended, Call ID: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:10.347140333Z [err]  2025-12-29 21:48:10,018 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:48:10.347146310Z [err]  2025-12-29 21:48:10,020 - redis_service - INFO - â– Removed playback TSDKW-CTTA, 0 remaining for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:10.347152274Z [err]  2025-12-29 21:48:10,020 - server - INFO - ğŸ”Š Redis: Removed playback TSDKW-CTTA, 0 remaining
2025-12-29T21:48:10.347160106Z [err]  2025-12-29 21:48:10,020 - server - INFO - ğŸ”Š ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T21:48:10.347166700Z [err]  2025-12-29 21:48:10,021 - server - INFO - âœ… Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T21:48:10.347172568Z [err]  2025-12-29 21:48:10,021 - server - INFO - ğŸ’¡ Session not on this worker - Redis flag set for WebSocket worker to handle
2025-12-29T21:48:10.349005020Z [inf]  100.64.0.18:16552 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:48:10.349012965Z [err]  2025-12-29 21:48:10,184 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:48:10.349018641Z [err]  2025-12-29 21:48:10,184 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'streaming.stopped', 'id': '434b7170-e4ed-43ec-ade3-e348c5dafefd', 'occurred_at': '2025-12-29T21:48:09.718718Z', 'payload': {'call_control_id': 'v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q', 'call_leg_id': '060aefc8-e500-11f0-a03d-02420aef94a0', 'call_session_id': '0608ae52-e500-11f0-bc37-02420aef94a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '9b60952f-f176-4468-9764-d2edae2c31e5', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:48:10.349024333Z [err]  2025-12-29 21:48:10,184 - server - INFO - ğŸ¯ Event type: streaming.stopped, Call ID: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:10.349030851Z [err]  2025-12-29 21:48:10,184 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:48:10.349038605Z [inf]  100.64.0.14:23334 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:48:10.349044329Z [err]  2025-12-29 21:48:10,197 - server - INFO - ğŸ“ Updated call log: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:10.349049736Z [err]  2025-12-29 21:48:10,303 - server - INFO - âœ… Finalized call log: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q (duration=11s, status=completed)
2025-12-29T21:48:10.476993637Z [err]  2025-12-29 21:48:10,472 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=2.5s, checkin_count=0/2
2025-12-29T21:48:11.372837302Z [err]  2025-12-29 21:48:10,898 - server - INFO - ğŸ™ï¸ Recording saved for call: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:11.372845069Z [err]  2025-12-29 21:48:10,899 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:11.372853592Z [err]  2025-12-29 21:48:10,898 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:48:11.372858158Z [err]  2025-12-29 21:48:10,898 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '819096b6-606e-47fe-99c0-ce43bc3e3f6b', 'occurred_at': '2025-12-29T21:48:10.701014Z', 'payload': {'call_control_id': 'v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q', 'call_leg_id': '060aefc8-e500-11f0-a03d-02420aef94a0', 'call_session_id': '0608ae52-e500-11f0-bc37-02420aef94a0', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:48:09.638246Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-29T21:48:09.638246Z', 'recording_id': 'c5a0f1f3-73be-41e4-acef-7666ee974654', 'recording_started_at': '2025-12-29T21:48:00.926675Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/060aefc8-e500-11f0-a03d-02420aef94a0-1767044880037033.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T214810Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=f2e12b688dd70f12e0e412a8a0629f11394336130975b57457ad3b17b737f2c5'}, 'start_time': '2025-12-29T21:48:00.926675Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:48:11.372862797Z [err]  2025-12-29 21:48:10,898 - server - INFO - ğŸ¯ Event type: call.recording.saved, Call ID: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:11.372866826Z [err]  2025-12-29 21:48:10,898 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:48:11.376403579Z [err]  2025-12-29 21:48:10,899 - server - INFO - ğŸ” Recording check: download_url=True, channels=dual, recording_id=c5a0f1f3-73be-41e4-acef-7666ee974654, call_data=True
2025-12-29T21:48:11.376409454Z [err]  2025-12-29 21:48:10,972 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=3.0s, checkin_count=0/2
2025-12-29T21:48:11.376415677Z [err]  2025-12-29 21:48:10,990 - server - INFO - ğŸ“Š Auto-added call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-29T21:48:11.376420945Z [err]  2025-12-29 21:48:10,993 - server - INFO - ğŸ’¾ Saved recording URL and ID to database: c5a0f1f3-73be-41e4-acef-7666ee974654
2025-12-29T21:48:11.376426612Z [err]  2025-12-29 21:48:10,996 - server - INFO - âœ… Entering dual-channel processing
2025-12-29T21:48:11.376431869Z [err]  2025-12-29 21:48:10,996 - server - INFO - ğŸ“¥ Downloading DUAL-CHANNEL recording...
2025-12-29T21:48:11.376451570Z [err]  2025-12-29 21:48:11,174 - server - INFO - ğŸ“¤ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:48:11.376461662Z [err]  2025-12-29 21:48:11,181 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:11.376466219Z [err]  2025-12-29 21:48:11,181 - server - INFO - ğŸ“‡ [HANGUP] Data source: redis=Yes, memory=No
2025-12-29T21:48:11.376470229Z [err]  2025-12-29 21:48:11,181 - server - INFO - ğŸ“‡ [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-29T21:48:11.376474296Z [err]  2025-12-29 21:48:11,273 - server - INFO - ğŸ“‡ [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-29T21:48:11.376478348Z [err]  2025-12-29 21:48:11,345 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:48:11.377319382Z [err]  2025-12-29 21:48:11,346 - server - INFO - âœ… Post-call webhook sent successfully (status=200)
2025-12-29T21:48:11.377329750Z [err]  2025-12-29 21:48:11,359 - server - INFO - ğŸ“‡ [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-29T21:48:11.377336028Z [err]  2025-12-29 21:48:11,359 - server - INFO - ğŸ“‡ [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-29T21:48:11.377341369Z [err]  2025-12-29 21:48:11,359 - server - INFO - ğŸ“‡ [HANGUP] Agent info keys: None
2025-12-29T21:48:11.377347221Z [err]  2025-12-29 21:48:11,359 - server - INFO - ğŸš€ Triggered QC analysis for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:11.377353603Z [err]  2025-12-29 21:48:11,359 - server - INFO - ğŸ“Š Triggered Campaign QC for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:11.377358958Z [err]  2025-12-29 21:48:11,359 - server - INFO - ğŸ“‡ Triggered CRM update for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:11.377364216Z [err]  2025-12-29 21:48:11,359 - server - INFO - âœ… Closed persistent TTS session for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:11.377369309Z [err]  2025-12-29 21:48:11,360 - redis_service - INFO - ğŸ§¹ Deleted call data from Redis: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:11.377374762Z [err]  2025-12-29 21:48:11,361 - server - INFO - ğŸ§¹ Cleaned up call session from Redis and memory: v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:11.377380156Z [inf]  100.64.0.13:58412 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:48:11.377385241Z [err]  2025-12-29 21:48:11,361 - server - INFO - ğŸ” Starting QC analysis for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:11.379458581Z [err]  2025-12-29 21:48:11,361 - server - INFO - ğŸ” [AUTO-QC] Starting campaign QC check for call=v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-29T21:48:11.379467577Z [err]  2025-12-29 21:48:11,363 - server - INFO - ğŸ“‡ CRM update starting for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:48:11.379478572Z [err]  2025-12-29 21:48:11,363 - server - INFO - ğŸ“‡ Normalized phone: +17708336397
2025-12-29T21:48:11.448957816Z [err]  2025-12-29 21:48:11,444 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/060aefc8-e500-11f0-a03d-02420aef94a0-1767044880037033.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T214810Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=f2e12b688dd70f12e0e412a8a0629f11394336130975b57457ad3b17b737f2c5 "HTTP/1.1 200 OK"
2025-12-29T21:48:11.454898168Z [err]  2025-12-29 21:48:11,451 - server - INFO - ğŸ“ Converted transcript from 3 messages to 97 characters
2025-12-29T21:48:11.539991192Z [err]  2025-12-29 21:48:11,537 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:48:11.552335632Z [err]  2025-12-29 21:48:11,544 - server - INFO - âœ… Downloaded 34942 bytes
2025-12-29T21:48:11.630246723Z [err]  2025-12-29 21:48:11,622 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-29T21:48:11.712653008Z [err]  2025-12-29 21:48:11,708 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-29T21:48:11.712660089Z [err]  2025-12-29 21:48:11,708 - qc_agents.orchestrator - INFO - âœ… Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:48:11.712665932Z [err]  2025-12-29 21:48:11,708 - qc_agents.orchestrator - INFO - ğŸ” Running Commitment Detector on call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:11.727354865Z [err]  2025-12-29 21:48:11,720 - server - INFO - âœ… Split into 2 channels
2025-12-29T21:48:11.727363394Z [err]  2025-12-29 21:48:11,720 - server - INFO - ğŸ¤ Using STT provider: soniox for interruption detection
2025-12-29T21:48:11.727370086Z [err]  2025-12-29 21:48:11,720 - server - INFO - ğŸ“Š Channel 0: 188364 bytes
2025-12-29T21:48:11.727375388Z [err]  2025-12-29 21:48:11,720 - server - ERROR - âŒ No Soniox API key available
2025-12-29T21:48:11.727381008Z [err]  2025-12-29 21:48:11,720 - server - INFO - âŒ Channel 0: No speech
2025-12-29T21:48:11.727386415Z [err]  2025-12-29 21:48:11,720 - server - INFO - ğŸ“Š Channel 1: 188364 bytes
2025-12-29T21:48:11.727392714Z [err]  2025-12-29 21:48:11,720 - server - ERROR - âŒ No Soniox API key available
2025-12-29T21:48:11.727398421Z [err]  2025-12-29 21:48:11,720 - server - INFO - âŒ Channel 1: No speech
2025-12-29T21:48:11.727403931Z [err]  2025-12-29 21:48:11,720 - server - WARNING - âš ï¸ No speech in any channel
2025-12-29T21:48:11.727409633Z [inf]  100.64.0.18:16552 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:48:11.757096993Z [err]  2025-12-29 21:48:11,754 - elevenlabs_ws_service - WARNING - âš ï¸  [TIMING] ElevenLabs timeout waiting for first chunk (2.5s) - No audio received!
2025-12-29T21:48:11.757105037Z [err]  2025-12-29 21:48:11,755 - persistent_tts_service - WARNING - âš ï¸ [Call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q] Receiver got 0 chunks for sentence #3! interrupted=False
2025-12-29T21:48:12.359943332Z [err]  2025-12-29 21:48:11,896 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:48:12.359948684Z [err]  2025-12-29 21:48:11,897 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:48:12.359956281Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:48:12.359961546Z [err]  2025-12-29 21:48:11,897 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:48:12.359965853Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:48:12.359972501Z [err]  2025-12-29 21:48:11,898 - qc_agents.orchestrator - INFO - ğŸ—ºï¸  Running Conversion Pathfinder on call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:12.359977564Z [err]  2025-12-29 21:48:11,918 - server - INFO - ğŸ” [AUTO-QC] Call log found: transcript_turns=3, logs_count=4, status=completed
2025-12-29T21:48:12.359996988Z [err]  2025-12-29 21:48:11,983 - server - INFO - ğŸ“‡ CRM: Total variables collected: []
2025-12-29T21:48:12.360004280Z [err]  2025-12-29 21:48:12,090 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:48:12.360009100Z [err]  2025-12-29 21:48:12,090 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:48:12.360014029Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:48:12.360020616Z [err]  2025-12-29 21:48:12,091 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:48:12.362923643Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:48:12.362932033Z [err]  2025-12-29 21:48:12,091 - qc_agents.orchestrator - INFO - â­ Running Excellence Replicator on call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:12.362936933Z [err]  2025-12-29 21:48:12,171 - server - INFO - ğŸ“‡ CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name']
2025-12-29T21:48:12.362941539Z [err]  2025-12-29 21:48:12,309 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:48:12.362946120Z [err]  2025-12-29 21:48:12,310 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:48:12.362950262Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:48:12.362954410Z [err]  2025-12-29 21:48:12,310 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:48:12.362958462Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:48:12.362963039Z [err]  2025-12-29 21:48:12,331 - server - INFO - ğŸ” [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-29T21:48:12.407855430Z [err]  2025-12-29 21:48:12,405 - qc_agents.orchestrator - INFO - âœ… QC analysis stored for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:12.407861573Z [err]  2025-12-29 21:48:12,405 - server - INFO - âœ… QC analysis completed for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:12.407869349Z [err]  2025-12-29 21:48:12,405 - server - INFO - ğŸ“Š Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-29T21:48:12.421043192Z [err]  2025-12-29 21:48:12,417 - server - INFO - ğŸ“Š [AUTO-QC] Running full QC analysis: call=v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q â†’ campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-29T21:48:12.421053464Z [err]  2025-12-29 21:48:12,417 - server - INFO - ğŸ“Š [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-29T21:48:12.421060030Z [err]  2025-12-29 21:48:12,417 - server - ERROR - âŒ [AUTO-QC] Error in campaign QC for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:48:12.421067874Z [err]  2025-12-29 21:48:12,418 - server - ERROR - âŒ [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-29T21:48:12.421074024Z [err]    File "/app/backend/server.py", line 9773, in trigger_campaign_qc_for_call
2025-12-29T21:48:12.421079598Z [err]      await run_full_qc_analysis(
2025-12-29T21:48:12.421084792Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-29T21:48:12.421090048Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:48:12.421095706Z [err]  
2025-12-29T21:48:12.605360270Z [err]  2025-12-29 21:48:12,600 - server - INFO - ğŸ“Š Updated campaign_calls with QC scores for v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:12.792969996Z [err]  2025-12-29 21:48:12,788 - server - INFO - ğŸ“ˆ Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-29T21:48:13.358909746Z [err]  2025-12-29 21:48:12,881 - server - INFO - ğŸ·ï¸ Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-29T21:48:13.358914354Z [err]  2025-12-29 21:48:12,881 - server - ERROR - âŒ Error in auto appointment detection for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q: 'str' object has no attribute 'get'
2025-12-29T21:48:13.503936368Z [err]  2025-12-29 21:48:13,501 - server - INFO - ğŸŒ Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T21:48:13.590525682Z [err]  2025-12-29 21:48:13,586 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:48:13.679597216Z [err]  2025-12-29 21:48:13,672 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:48:13.698668341Z [err]  2025-12-29 21:48:13,694 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:48:13.698677298Z [err]  2025-12-29 21:48:13,694 - telnyx_service - INFO - ğŸ“ Initiating outbound call from +14048000152 to +17708336397
2025-12-29T21:48:13.698684100Z [err]  2025-12-29 21:48:13,694 - telnyx_service - INFO - ğŸ¤– Enabling AMD (premium mode)
2025-12-29T21:48:13.698689729Z [err]  2025-12-29 21:48:13,694 - telnyx_service - INFO - ğŸŒ Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-29T21:48:14.516356512Z [err]  2025-12-29 21:48:14,513 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-29T21:48:14.516364792Z [err]  2025-12-29 21:48:14,513 - telnyx_service - INFO - âœ… Call initiated: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:14.604394450Z [err]  2025-12-29 21:48:14,600 - server - INFO - ğŸ“ Created call log: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:14.604404210Z [err]  2025-12-29 21:48:14,601 - server - INFO - ğŸ” DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:48:14.604410190Z [err]  2025-12-29 21:48:14,601 - server - INFO - ğŸ” DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-29T21:48:14.606977066Z [err]  2025-12-29 21:48:14,601 - server - INFO - ğŸ” DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:48:14.606987284Z [err]  2025-12-29 21:48:14,601 - server - INFO - ğŸ“¤ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:48:14.617967049Z [err]  2025-12-29 21:48:14,614 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA (TTL: 3600s)
2025-12-29T21:48:14.617975049Z [err]  2025-12-29 21:48:14,614 - server - INFO - ğŸ“¦ Call data stored in Redis and memory
2025-12-29T21:48:14.617981697Z [err]  2025-12-29 21:48:14,614 - server - INFO - ğŸ“ Outbound call initiated: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:14.617986972Z [inf]  100.64.0.17:43040 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-29T21:48:15.378586086Z [err]  2025-12-29 21:48:14,854 - server - INFO - ğŸ¯ Event type: call.initiated, Call ID: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:15.378595023Z [err]  2025-12-29 21:48:14,854 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:48:15.378604174Z [err]  2025-12-29 21:48:14,854 - server - INFO - ğŸ“ Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-29T21:48:15.378604455Z [inf]  100.64.0.5:25104 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:48:15.378613144Z [err]  2025-12-29 21:48:14,925 - server - INFO - ğŸ”ŒğŸ”ŒğŸ”Œ WEBSOCKET CONNECTION ATTEMPT
2025-12-29T21:48:15.378619492Z [err]  2025-12-29 21:48:14,925 - server - INFO -    Client: Address(host='100.64.0.13', port=34622)
2025-12-29T21:48:15.378626308Z [err]  2025-12-29 21:48:14,925 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': '9j99nfCrYFnXNwkqDzn9WQ==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'Z7IscJsRSamekoRe2prcFg', 'x-real-ip': '192.76.120.151', 'x-request-start': '1767044894643', 'accept-encoding': 'gzip'}
2025-12-29T21:48:15.378695977Z [err]  2025-12-29 21:48:14,854 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:48:15.378702278Z [err]  2025-12-29 21:48:14,854 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.initiated', 'id': 'f8e2711e-6c28-4da8-8659-04eb90e2426d', 'occurred_at': '2025-12-29T21:48:14.249207Z', 'payload': {'call_control_id': 'v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA', 'call_leg_id': '138ebeae-e500-11f0-b841-02420aef98a0', 'call_session_id': '138c976e-e500-11f0-86e5-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:48:15.381995659Z [err]  2025-12-29 21:48:15,017 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.00s
2025-12-29T21:48:15.382008789Z [err]  2025-12-29 21:48:15,017 - telnyx_service - INFO - âœ… Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:48:15.382017394Z [err]  2025-12-29 21:48:15,018 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:48:15.382039097Z [err]  2025-12-29 21:48:15,077 - server - INFO - ğŸ“¬ Received Telnyx event: connected
2025-12-29T21:48:15.382040112Z [err]  2025-12-29 21:48:15,017 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-29T21:48:15.382043317Z [err]        "title": "Call has already ended",
2025-12-29T21:48:15.382051558Z [err]  2025-12-29 21:48:15,017 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-29T21:48:15.382054522Z [err]  2025-12-29 21:48:15,077 - server - INFO - ğŸ“ Telnyx connected event received, waiting for 'start'...
2025-12-29T21:48:15.382062082Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:48:15.382064060Z [err]  2025-12-29 21:48:15,017 - server - INFO - ğŸ’¾ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-29T21:48:15.382067833Z [err]  2025-12-29 21:48:15,277 - telnyx_service - ERROR - âŒ Telnyx playback failed: 422 - {
2025-12-29T21:48:15.382069187Z [err]  2025-12-29 21:48:15,276 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:48:15.382080341Z [err]    "errors": [
2025-12-29T21:48:15.382080611Z [err]  2025-12-29 21:48:15,277 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.26s
2025-12-29T21:48:15.382087982Z [err]      {
2025-12-29T21:48:15.382099808Z [err]        "code": "90018",
2025-12-29T21:48:15.382256219Z [err]  2025-12-29 21:48:14,925 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-29T21:48:15.382262675Z [err]  2025-12-29 21:48:14,926 - server - INFO - ğŸ”Œ Incoming Telnyx WebSocket connection
2025-12-29T21:48:15.382267413Z [err]  [2025-12-29 21:48:14 +0000] [5] [INFO] ('100.64.0.13', 34622) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-29T21:48:15.382272701Z [err]  2025-12-29 21:48:14,926 - server - INFO - âœ… WebSocket accepted, waiting for Telnyx events
2025-12-29T21:48:15.382277645Z [err]  [2025-12-29 21:48:14 +0000] [5] [INFO] connection open
2025-12-29T21:48:15.382282037Z [err]  2025-12-29 21:48:14,989 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:48:15.382286491Z [err]  2025-12-29 21:48:14,989 - server - INFO - âœ… Call-initiated webhook sent successfully (status=200)
2025-12-29T21:48:15.382291339Z [err]  2025-12-29 21:48:15,016 - core_calling_service - INFO - â° Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-29T21:48:15.382295497Z [err]  2025-12-29 21:48:15,017 - core_calling_service - INFO - ğŸ’¬ Sending check-in #1/2: Are you still there?
2025-12-29T21:48:15.382299792Z [err]  2025-12-29 21:48:15,017 - dead_air_monitor - INFO - ğŸ’¬ Sending check-in after 7.0s silence: Are you still there?
2025-12-29T21:48:15.382304726Z [err]  2025-12-29 21:48:15,017 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:15.382309421Z [err]  2025-12-29 21:48:15,017 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q: Are you still there?...
2025-12-29T21:48:15.382313831Z [err]  2025-12-29 21:48:15,017 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-29T21:48:15.382318613Z [err]  2025-12-29 21:48:15,017 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-29T21:48:15.383691680Z [err]      }
2025-12-29T21:48:15.383700173Z [err]    ]
2025-12-29T21:48:15.383707510Z [err]  }
2025-12-29T21:48:15.383713405Z [err]  2025-12-29 21:48:15,277 - telnyx_service - INFO - ğŸ“¢ Using Telnyx built-in TTS
2025-12-29T21:48:15.467589932Z [err]  2025-12-29 21:48:15,466 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:48:15.470158964Z [err]  2025-12-29 21:48:15,466 - telnyx_service - ERROR - âŒ Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:48:15.470165937Z [err]  2025-12-29 21:48:15,466 - dead_air_monitor - INFO - âœ… Check-in message sent
2025-12-29T21:48:16.324956859Z [err]  2025-12-29 21:48:15,968 - dead_air_monitor - INFO - ğŸš© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-29T21:48:16.324964195Z [err]  2025-12-29 21:48:15,968 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044895.9682038 for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:16.324972036Z [err]  2025-12-29 21:48:15,968 - core_calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:16.694926146Z [err]  2025-12-29 21:48:16,691 - server - INFO - ğŸ“¬ Received Telnyx event: start
2025-12-29T21:48:16.694933848Z [err]  2025-12-29 21:48:16,691 - server - INFO - ğŸ¬ Stream started for call: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:16.700716958Z [err]  2025-12-29 21:48:16,696 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:16.700730879Z [err]  2025-12-29 21:48:16,698 - server - INFO - âœ… Call data found after 0s wait
2025-12-29T21:48:16.700740124Z [err]  2025-12-29 21:48:16,698 - server - INFO - â³ Session not found locally, waiting briefly for webhook...
2025-12-29T21:48:16.714980778Z [err]  2025-12-29 21:48:16,712 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:48:16.714989751Z [err]  2025-12-29 21:48:16,712 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.answered', 'id': '4743954e-2ffa-4fd3-8c5d-8147211acbf8', 'occurred_at': '2025-12-29T21:48:16.389208Z', 'payload': {'call_control_id': 'v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA', 'call_leg_id': '138ebeae-e500-11f0-b841-02420aef98a0', 'call_session_id': '138c976e-e500-11f0-86e5-02420aef98a0', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-29T21:48:14.249207Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:48:16.714995972Z [err]  2025-12-29 21:48:16,712 - server - INFO - ğŸ¯ Event type: call.answered, Call ID: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:16.715000945Z [err]  2025-12-29 21:48:16,712 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:48:16.715005703Z [err]  2025-12-29 21:48:16,712 - server - INFO - âœ… Call answered: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:16.720702928Z [err]  2025-12-29 21:48:16,717 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:16.722559831Z [err]  2025-12-29 21:48:16,718 - server - INFO - âœ… Found call in Redis (multi-worker state sharing working)
2025-12-29T21:48:16.722568820Z [err]  2025-12-29 21:48:16,718 - server - INFO - ğŸ“ Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-29T21:48:16.812983759Z [err]  2025-12-29 21:48:16,810 - server - INFO - âœ… Call log updated
2025-12-29T21:48:16.812989810Z [err]  2025-12-29 21:48:16,810 - server - INFO - ğŸ” DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-29T21:48:16.812994123Z [err]  2025-12-29 21:48:16,810 - server - INFO - ğŸ“¤ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:48:16.812998247Z [err]  2025-12-29 21:48:16,810 - server - INFO - ğŸ”§ Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:48:17.317412059Z [err]  2025-12-29 21:48:16,896 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:48:17.317417496Z [err]  2025-12-29 21:48:16,980 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:48:17.317422502Z [err]  2025-12-29 21:48:16,980 - server - INFO - âœ… Call-started webhook sent successfully (status=200)
2025-12-29T21:48:17.317438973Z [err]  2025-12-29 21:48:16,981 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:48:17.317446008Z [err]  2025-12-29 21:48:16,981 - server - INFO - ğŸ”§ Creating Telnyx service with user's keys...
2025-12-29T21:48:17.317452046Z [err]  2025-12-29 21:48:17,005 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:48:17.317457353Z [err]  2025-12-29 21:48:17,199 - server - INFO - âš ï¸ Session still not found after wait, will create in worker
2025-12-29T21:48:17.317462371Z [err]  2025-12-29 21:48:17,199 - server - WARNING - âš ï¸ Session not found after waiting, creating in WebSocket worker...
2025-12-29T21:48:17.317468141Z [err]  2025-12-29 21:48:17,203 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:17.317473341Z [err]  2025-12-29 21:48:17,205 - server - INFO - ğŸ“ Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:48:17.317478504Z [err]  2025-12-29 21:48:17,205 - core_calling_service - INFO - ğŸ” Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T21:48:17.317485676Z [err]  2025-12-29 21:48:17,274 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-29T21:48:17.317500753Z [err]  2025-12-29 21:48:17,274 - telnyx_service - INFO - âœ… Playing audio from URL, playback_id: GCsBC0R2fw (loop=True, overlay=True)
2025-12-29T21:48:17.317606592Z [err]  2025-12-29 21:48:17,275 - server - WARNING - âš ï¸ Failed to start comfort noise: 'v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA'
2025-12-29T21:48:17.317613772Z [err]  2025-12-29 21:48:17,275 - telnyx_service - INFO - ğŸ™ï¸ Starting recording: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:17.317621778Z [err]  2025-12-29 21:48:17,293 - core_calling_service - INFO - ğŸ” KB count query completed: 4 items
2025-12-29T21:48:17.317627766Z [err]  2025-12-29 21:48:17,293 - core_calling_service - INFO - ğŸ“š Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T21:48:17.317632955Z [err]  2025-12-29 21:48:17,294 - core_calling_service - INFO - ğŸ“‹ Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T21:48:17.317642666Z [err]  2025-12-29 21:48:17,294 - core_calling_service - INFO - ğŸ“š KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T21:48:17.317649486Z [err]  2025-12-29 21:48:17,294 - core_calling_service - INFO - ğŸ”¥ Pre-warming LLM client (grok)...
2025-12-29T21:48:17.317655909Z [err]  2025-12-29 21:48:17,302 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:48:17.317662017Z [err]  2025-12-29 21:48:17,302 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'streaming.started', 'id': 'd0b2b05e-feab-4c75-9b6c-b797bb7431a9', 'occurred_at': '2025-12-29T21:48:16.789212Z', 'payload': {'call_control_id': 'v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA', 'call_leg_id': '138ebeae-e500-11f0-b841-02420aef98a0', 'call_session_id': '138c976e-e500-11f0-86e5-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '8db114b0-f796-49d2-abf2-94362c5612c6', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:48:17.320177556Z [err]  2025-12-29 21:48:17,302 - server - INFO - ğŸ¯ Event type: streaming.started, Call ID: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:17.320184126Z [err]  2025-12-29 21:48:17,302 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:48:17.320188558Z [inf]  100.64.0.14:23350 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:48:17.399580277Z [err]  2025-12-29 21:48:17,395 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:48:17.410058825Z [err]  2025-12-29 21:48:17,404 - core_calling_service - INFO - âœ… LLM client pre-warmed in 110ms
2025-12-29T21:48:17.410067656Z [err]  2025-12-29 21:48:17,404 - server - INFO - âœ… Session created in WebSocket worker
2025-12-29T21:48:17.410072775Z [err]  2025-12-29 21:48:17,404 - server - INFO - â±ï¸ [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-29T21:48:17.410079320Z [err]  2025-12-29 21:48:17,404 - server - INFO - â±ï¸ [WebSocket Worker] Silence timeout task scheduled!
2025-12-29T21:48:17.410086829Z [err]  2025-12-29 21:48:17,404 - server - INFO - ğŸ“ Call data loaded, starting SONIOX connection...
2025-12-29T21:48:17.410091472Z [err]  2025-12-29 21:48:17,404 - server - INFO - âœ… Initialized call_states for v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA with session reference
2025-12-29T21:48:17.410095420Z [err]  2025-12-29 21:48:17,406 - server - INFO - â±ï¸ [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-29T21:48:17.495306167Z [err]  2025-12-29 21:48:17,492 - server - INFO - ğŸ”‘ Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-29T21:48:18.346766917Z [err]  2025-12-29 21:48:17,995 - soniox_service - INFO - âš™ï¸  Endpoint detection: True, Speaker diarization: False
2025-12-29T21:48:18.346779483Z [err]  2025-12-29 21:48:17,995 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring started for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:18.346785986Z [err]  2025-12-29 21:48:17,996 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:wiWoWdu8nZPh-hUfU... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'])
2025-12-29T21:48:18.346791048Z [err]  2025-12-29 21:48:17,996 - server - INFO - âœ… Started forwarding audio (8kHz mulaw â†’ Soniox, NO BUFFERING)
2025-12-29T21:48:18.346827967Z [err]  2025-12-29 21:48:17,995 - soniox_service - INFO - âœ… Connected to Soniox Real-Time STT
2025-12-29T21:48:18.346833705Z [err]  2025-12-29 21:48:17,995 - soniox_service - INFO - âš™ï¸  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-29T21:48:18.388386565Z [inf]  100.64.0.13:34636 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-29T21:48:18.499715795Z [err]  2025-12-29 21:48:18,497 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:wiWoWdu8nZPh-hUfU... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'])
2025-12-29T21:48:18.661269611Z [err]  2025-12-29 21:48:18,658 - server - INFO - ğŸ” Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:48:18.661270122Z [err]  2025-12-29 21:48:18,657 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA/actions/record_start "HTTP/1.1 200 OK"
2025-12-29T21:48:18.661286304Z [err]  2025-12-29 21:48:18,657 - server - INFO - ğŸ™ï¸ Call recording started for v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:18.661290704Z [err]  2025-12-29 21:48:18,658 - server - INFO - ğŸ”§ Calling create_call_session() - START
2025-12-29T21:48:18.661298055Z [err]  2025-12-29 21:48:18,657 - server - INFO - ğŸ”§ Creating call session for v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA...
2025-12-29T21:48:18.661304546Z [err]  2025-12-29 21:48:18,658 - core_calling_service - INFO - ğŸ” Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-29T21:48:18.746748063Z [err]  2025-12-29 21:48:18,743 - core_calling_service - INFO - ğŸ” KB count query completed: 4 items
2025-12-29T21:48:18.746758082Z [err]  2025-12-29 21:48:18,743 - core_calling_service - INFO - ğŸ“š Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-29T21:48:18.746763820Z [err]  2025-12-29 21:48:18,743 - core_calling_service - INFO - ğŸ“‹ Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-29T21:48:18.746769582Z [err]  2025-12-29 21:48:18,743 - core_calling_service - INFO - ğŸ“š KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-29T21:48:18.746775442Z [err]  2025-12-29 21:48:18,743 - core_calling_service - INFO - ğŸ”¥ Pre-warming LLM client (grok)...
2025-12-29T21:48:18.832594899Z [err]  2025-12-29 21:48:18,829 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:48:18.841146851Z [err]  2025-12-29 21:48:18,837 - core_calling_service - INFO - âœ… LLM client pre-warmed in 92ms
2025-12-29T21:48:18.841154662Z [err]  2025-12-29 21:48:18,837 - server - INFO - ğŸ”§ Calling create_call_session() - COMPLETE
2025-12-29T21:48:18.841160342Z [err]  2025-12-29 21:48:18,837 - server - INFO - âœ… Session object created: CallSession
2025-12-29T21:48:18.849963031Z [err]  2025-12-29 21:48:18,842 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA (TTL: 3600s)
2025-12-29T21:48:18.849970381Z [err]  2025-12-29 21:48:18,842 - server - INFO - âœ… Serializable call_data synced to Redis (agent_id, user_id)
2025-12-29T21:48:18.849976719Z [err]  2025-12-29 21:48:18,843 - server - INFO - âœ… Session stored in worker memory (not Redis)
2025-12-29T21:48:18.849980756Z [err]  2025-12-29 21:48:18,843 - redis_service - INFO - âœ… Marked session ready in Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:18.849984751Z [err]  2025-12-29 21:48:18,843 - server - INFO - ğŸ¤– AI session created for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:18.849988668Z [err]  2025-12-29 21:48:18,843 - server - INFO - ğŸ“¦ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-29T21:48:18.849992853Z [err]  2025-12-29 21:48:18,843 - server - INFO - â­ï¸ Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-29T21:48:18.849996545Z [err]  2025-12-29 21:48:18,843 - server - INFO - ğŸ‘¤ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-29T21:48:18.850000452Z [err]  2025-12-29 21:48:18,843 - server - INFO - ğŸ‘‚ User speaks first - waiting for user input...
2025-12-29T21:48:18.850004182Z [err]  2025-12-29 21:48:18,843 - server - INFO - ğŸ›¡ï¸ Voicemail timeout protection started (15000ms)
2025-12-29T21:48:18.850008588Z [err]  2025-12-29 21:48:18,843 - server - INFO - â±ï¸ AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-29T21:48:18.850013070Z [err]  2025-12-29 21:48:18,844 - server - INFO - ğŸ¤ Voice flow - streaming started via dial command
2025-12-29T21:48:19.352404094Z [err]  2025-12-29 21:48:18,847 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:19.352409323Z [err]  2025-12-29 21:48:18,848 - server - INFO - ğŸ¤ No greeting - waiting for user to speak first
2025-12-29T21:48:19.352414516Z [err]  2025-12-29 21:48:18,848 - server - INFO - ğŸ¤ Voice flow - WebSocket streaming already initiated
2025-12-29T21:48:19.352419830Z [inf]  100.64.0.5:25104 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:48:19.352425007Z [err]  2025-12-29 21:48:18,998 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:wiWoWdu8nZPh-hUfU... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'])
2025-12-29T21:48:19.413281753Z [err]  2025-12-29 21:48:19,411 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:19.418739751Z [err]  2025-12-29 21:48:19,416 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:19.430976502Z [err]  2025-12-29 21:48:19,423 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA (TTL: 3600s)
2025-12-29T21:48:19.430982952Z [err]  2025-12-29 21:48:19,423 - server - INFO - â±ï¸ [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-29T21:48:19.430987384Z [err]  2025-12-29 21:48:19,423 - core_calling_service - INFO - â±ï¸ [21:48:19.423] ğŸ“¥ process_user_input() ENTRY - text: '...'
2025-12-29T21:48:19.430991254Z [err]  2025-12-29 21:48:19,427 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:19.430995480Z [err]  2025-12-29 21:48:19,428 - core_calling_service - INFO - â±ï¸ [21:48:19.428] â© About to call _process_call_flow_streaming()
2025-12-29T21:48:19.430999341Z [err]  2025-12-29 21:48:19,428 - core_calling_service - INFO - â±ï¸ [21:48:19.428] ğŸ”€ Agent type: call_flow, calling flow processor...
2025-12-29T21:48:19.431003638Z [err]  2025-12-29 21:48:19,428 - core_calling_service - INFO - â±ï¸ [21:48:19.428] ğŸ”€ _process_call_flow_streaming() ENTRY
2025-12-29T21:48:19.431007586Z [err]  2025-12-29 21:48:19,428 - core_calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-29T21:48:19.431011172Z [err]  2025-12-29 21:48:19,428 - core_calling_service - INFO - â±ï¸ [21:48:19.428] âœ… Node selected, about to process content...
2025-12-29T21:48:19.431014877Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - ğŸ”§ Replaced {{now}} with Monday, December 29, 2025 at 4:48 PM EST in content
2025-12-29T21:48:19.431018685Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - ğŸ”§ Replaced {{customer_name}} with Kendrick in content
2025-12-29T21:48:19.431023925Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - ğŸ”§ Replaced {{callerName}} with  in content
2025-12-29T21:48:19.431028054Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - ğŸ”§ Replaced {{lead_id}} with None in content
2025-12-29T21:48:19.433686541Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - ğŸ”§ Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T21:48:19.433694059Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - ğŸ”§ Replaced {{track_keywords}} with  in content
2025-12-29T21:48:19.433698851Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - ğŸ”§ Replaced {{expected_commitment}} with not_specified in content
2025-12-29T21:48:19.433702816Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - ğŸ”§ Replaced {{to_number}} with +17708336397 in content
2025-12-29T21:48:19.433707251Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - ğŸ”§ Replaced {{phone_number}} with +17708336397 in content
2025-12-29T21:48:19.433711259Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - ğŸ”§ Replaced {{email}} with None in content
2025-12-29T21:48:19.433715166Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - âœ… Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-29T21:48:19.433719716Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-29T21:48:19.433725731Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - ğŸ“š skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-29T21:48:19.433729969Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - â±ï¸ [21:48:19.429] ğŸ“„ About to process content (mode=script, length=9)
2025-12-29T21:48:19.433733944Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - ğŸ”Š Silence tracking reset for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA (user responded)
2025-12-29T21:48:19.433737777Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - âœ… User responded to regular message, resetting counter
2025-12-29T21:48:19.433743158Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - ğŸ’¾ Storing node ID 2 in conversation history
2025-12-29T21:48:19.436334070Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - LLM response (0.01s): Kendrick?
2025-12-29T21:48:19.436342642Z [err]  2025-12-29 21:48:19,429 - core_calling_service - INFO - Total latency: 0.01s
2025-12-29T21:48:19.436349052Z [err]  2025-12-29 21:48:19,429 - server - INFO - ğŸ’¬ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-29T21:48:19.501988604Z [err]  2025-12-29 21:48:19,500 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:wiWoWdu8nZPh-hUfU... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'])
2025-12-29T21:48:19.529759094Z [err]  2025-12-29 21:48:19,527 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:19.532240352Z [err]  2025-12-29 21:48:19,529 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.00s
2025-12-29T21:48:19.532249981Z [err]  2025-12-29 21:48:19,529 - telnyx_service - INFO - âœ… Generated 13419 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-29T21:48:19.532256667Z [err]  2025-12-29 21:48:19,529 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-29T21:48:19.532268466Z [err]  2025-12-29 21:48:19,529 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA: Kendrick?...
2025-12-29T21:48:19.532274469Z [err]  2025-12-29 21:48:19,529 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-29T21:48:19.532280635Z [err]  2025-12-29 21:48:19,529 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-29T21:48:19.532286658Z [err]  2025-12-29 21:48:19,529 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-29T21:48:19.532292418Z [err]  2025-12-29 21:48:19,529 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-29T21:48:19.532298587Z [err]  2025-12-29 21:48:19,529 - server - INFO - ğŸ’¾ TTS CACHE HIT: Returning cached audio (13419 bytes)
2025-12-29T21:48:19.711826584Z [err]  2025-12-29 21:48:19,704 - server - INFO - ğŸ”¤ RAW TOKENS: ["H"?]
2025-12-29T21:48:19.711839019Z [err]  2025-12-29 21:48:19,704 - core_calling_service - INFO - ğŸ”Š Silence timer reset for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA (user started speaking)
2025-12-29T21:48:19.711848506Z [err]  2025-12-29 21:48:19,704 - core_calling_service - INFO - ğŸ‘¤ User started speaking for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:19.711855116Z [err]  2025-12-29 21:48:19,704 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-29T21:48:19.711860330Z [err]  2025-12-29 21:48:19,704 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-29T21:48:19.815228728Z [err]  2025-12-29 21:48:19,812 - server - INFO - ğŸ”¤ RAW TOKENS: ["H"?, "ello"?]
2025-12-29T21:48:19.815236904Z [err]  2025-12-29 21:48:19,813 - server - INFO - ğŸ” PARTIAL TRANSCRIPT: 'Hello' | Generating: False
2025-12-29T21:48:19.819108786Z [err]  2025-12-29 21:48:19,817 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA/actions/playback_start "HTTP/1.1 200 OK"
2025-12-29T21:48:19.821966097Z [err]  2025-12-29 21:48:19,818 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.29s
2025-12-29T21:48:19.821975135Z [err]  2025-12-29 21:48:19,818 - telnyx_service - INFO - â±ï¸  Total TTS latency: 0.29s
2025-12-29T21:48:19.821980985Z [err]  2025-12-29 21:48:19,818 - telnyx_service - INFO - âœ… Playing elevenlabs audio via Telnyx playback
2025-12-29T21:48:19.821987112Z [err]  2025-12-29 21:48:19,818 - telnyx_service - INFO - ğŸ¬ Playback ID: p429YXgfyw
2025-12-29T21:48:19.821993264Z [err]  2025-12-29 21:48:19,818 - server - INFO - ğŸ”Š [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-29T21:48:19.821999421Z [err]  2025-12-29 21:48:19,818 - server - INFO - â±ï¸ [WebSocket Worker] Greeting playback started at 1767044899.8185682
2025-12-29T21:48:19.822005966Z [err]  2025-12-29 21:48:19,818 - server - INFO - â±ï¸ [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-29T21:48:20.348293747Z [err]  2025-12-29 21:48:19,975 - server - INFO - ğŸ”¤ RAW TOKENS: ["H"âœ“, "ello"âœ“, "?"âœ“, "<end>"âœ“]
2025-12-29T21:48:20.348299918Z [err]  2025-12-29 21:48:19,976 - server - INFO - ğŸ¯ Endpoint detected: <end> token received
2025-12-29T21:48:20.348305678Z [err]  2025-12-29 21:48:19,976 - server - INFO - ğŸ§¹ Cleaned transcript: 'H ello ?' -> 'Hello?'
2025-12-29T21:48:20.348310505Z [err]  2025-12-29 21:48:19,976 - server - INFO - ğŸ“¥ FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-29T21:48:20.348315724Z [err]  2025-12-29 21:48:19,976 - server - INFO - ğŸ¤ Soniox final transcript: 'Hello?'
2025-12-29T21:48:20.348320372Z [err]  2025-12-29 21:48:19,976 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:wiWoWdu8nZPh-hUfU... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'])
2025-12-29T21:48:20.348325336Z [err]  2025-12-29 21:48:19,976 - server - INFO - ğŸ” FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-29T21:48:20.348330092Z [err]  2025-12-29 21:48:19,976 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:wiWoWdu8nZPh-hUfU... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'])
2025-12-29T21:48:20.348335349Z [err]  2025-12-29 21:48:19,976 - server - INFO - ğŸš€ Spawned tracked background task for endpoint processing
2025-12-29T21:48:20.348341469Z [err]  2025-12-29 21:48:19,976 - server - INFO - â±ï¸ [21:48:19.976] ğŸ“ FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-29T21:48:20.348346631Z [err]  2025-12-29 21:48:19,976 - server - INFO - â±ï¸ [21:48:19.976] STT endpoint detection latency: 19ms
2025-12-29T21:48:20.348351124Z [err]  2025-12-29 21:48:19,976 - server - INFO - â±ï¸ [21:48:19.976] ğŸ¤ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-29T21:48:20.349765118Z [err]  2025-12-29 21:48:19,976 - server - INFO - â±ï¸ User spoke at 1767044899.976805
2025-12-29T21:48:20.349772007Z [err]  2025-12-29 21:48:19,977 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA (TTL: 3600s)
2025-12-29T21:48:20.349778214Z [err]  2025-12-29 21:48:19,977 - server - INFO - ğŸ‘¤ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-29T21:48:20.349784049Z [err]  2025-12-29 21:48:19,977 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:wiWoWdu8nZPh-hUfU... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'])
2025-12-29T21:48:20.349789567Z [err]  2025-12-29 21:48:19,977 - server - INFO - âœ… Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-29T21:48:20.349795977Z [err]  2025-12-29 21:48:19,987 - server - INFO - ğŸ¤ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-29T21:48:20.349806861Z [err]  2025-12-29 21:48:19,987 - core_calling_service - INFO - ğŸ‘¤ User stopped speaking for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:20.349812775Z [err]  2025-12-29 21:48:19,987 - server - INFO - â±ï¸ [TIMING] STT_START: User last audio packet received
2025-12-29T21:48:20.349818495Z [err]  2025-12-29 21:48:19,987 - server - INFO - â±ï¸ [TIMING] STT_END: Endpoint detected at T+9ms
2025-12-29T21:48:20.349824208Z [err]  2025-12-29 21:48:19,987 - server - INFO - â±ï¸ [TIMING] STT_LATENCY: 9ms (Soniox model: stt-rt-v3)
2025-12-29T21:48:20.349832428Z [err]  2025-12-29 21:48:19,987 - server - INFO - â±ï¸  USER STOPPED SPEAKING at T=0ms
2025-12-29T21:48:20.349838452Z [err]  2025-12-29 21:48:19,987 - server - INFO - ğŸ™ï¸ Agent generating response - interruption detection active
2025-12-29T21:48:20.349851675Z [err]  2025-12-29 21:48:19,987 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:20.350995575Z [err]  2025-12-29 21:48:20,002 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:wiWoWdu8nZPh-hUfU... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'])
2025-12-29T21:48:20.351007789Z [err]  2025-12-29 21:48:20,002 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:wiWoWdu8nZPh-hUfU... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'])
2025-12-29T21:48:20.351017009Z [err]  2025-12-29 21:48:20,002 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-29T21:48:20.351023985Z [err]  2025-12-29 21:48:20,014 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:48:20.351040621Z [err]  2025-12-29 21:48:20,014 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.started', 'id': 'e211fa3d-afe2-4be0-8170-245a20cb863b', 'occurred_at': '2025-12-29T21:48:19.569358Z', 'payload': {'call_control_id': 'v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA', 'call_leg_id': '138ebeae-e500-11f0-b841-02420aef98a0', 'call_session_id': '138c976e-e500-11f0-86e5-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'GCsBC0R2fw', 'start_time': '2025-12-29T21:48:19.569358Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:48:20.351047866Z [err]  2025-12-29 21:48:20,015 - server - INFO - ğŸ¯ Event type: call.playback.started, Call ID: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:20.351053626Z [err]  2025-12-29 21:48:20,015 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:48:20.352679397Z [inf]  100.64.0.8:44434 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:48:20.352688164Z [err]  2025-12-29 21:48:20,082 - server - INFO - ğŸ“ Saved user transcript to database
2025-12-29T21:48:20.352695689Z [err]  2025-12-29 21:48:20,082 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:wiWoWdu8nZPh-hUfU... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'])
2025-12-29T21:48:20.352701896Z [err]  2025-12-29 21:48:20,082 - core_calling_service - INFO - â±ï¸ [21:48:20.082] ğŸ“¥ process_user_input() ENTRY - text: 'Hello?...'
2025-12-29T21:48:20.352707955Z [err]  2025-12-29 21:48:20,084 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:20.352715921Z [err]  2025-12-29 21:48:20,084 - core_calling_service - WARNING - ğŸš¨ BARGE-IN DETECTED for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA: User spoke while Silence Greeting was triggering
2025-12-29T21:48:20.352723867Z [err]  2025-12-29 21:48:20,122 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:48:20.352729433Z [err]  2025-12-29 21:48:20,122 - telnyx_service - INFO - ğŸ›‘ Stopping audio playback on call: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:20.352735824Z [inf]  100.64.0.9:15002 - "GET /api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3 HTTP/1.1" 200
2025-12-29T21:48:20.352741942Z [err]  2025-12-29 21:48:20,161 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=4.2s, checkin_count=1/2
2025-12-29T21:48:20.508950054Z [err]  2025-12-29 21:48:20,505 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:wiWoWdu8nZPh-hUfU... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'])
2025-12-29T21:48:20.508958321Z [err]  2025-12-29 21:48:20,505 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:wiWoWdu8nZPh-hUfU... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'])
2025-12-29T21:48:20.508965096Z [err]  2025-12-29 21:48:20,505 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-29T21:48:20.602334177Z [err]  2025-12-29 21:48:20,599 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA/actions/playback_stop "HTTP/1.1 200 OK"
2025-12-29T21:48:20.602346793Z [err]  2025-12-29 21:48:20,600 - telnyx_service - INFO - âœ… Successfully stopped audio playback
2025-12-29T21:48:20.602358102Z [err]  2025-12-29 21:48:20,600 - core_calling_service - INFO - âœ… BARGE-IN: Audio playback STOPPED
2025-12-29T21:48:20.602364305Z [err]  2025-12-29 21:48:20,600 - core_calling_service - INFO - âœ… BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-29T21:48:20.604364344Z [err]  2025-12-29 21:48:20,601 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:20.604373170Z [err]  2025-12-29 21:48:20,602 - redis_service - INFO - ğŸ“¦ Stored call data in Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA (TTL: 3600s)
2025-12-29T21:48:20.604379319Z [err]  2025-12-29 21:48:20,602 - core_calling_service - INFO - âœ… BARGE-IN: Reset silence_greeting_triggered flag
2025-12-29T21:48:20.604382612Z [err]  2025-12-29 21:48:20,602 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Hello?
2025-12-29T21:48:20.604384892Z [err]  2025-12-29 21:48:20,602 - core_calling_service - INFO - â±ï¸ [21:48:20.602] â© About to call _process_call_flow_streaming()
2025-12-29T21:48:20.604391569Z [err]  2025-12-29 21:48:20,602 - core_calling_service - INFO - â±ï¸ [21:48:20.602] ğŸ”€ Agent type: call_flow, calling flow processor...
2025-12-29T21:48:20.604393495Z [err]  2025-12-29 21:48:20,602 - core_calling_service - INFO - ğŸ” Checking 'Hello=Yes' override [DEPLOYMENT VERIFIED] for msg='hello' on node='Greeting'
2025-12-29T21:48:20.604397684Z [err]  2025-12-29 21:48:20,602 - core_calling_service - INFO - â±ï¸ [21:48:20.602] ğŸ”€ _process_call_flow_streaming() ENTRY
2025-12-29T21:48:20.604403019Z [err]  2025-12-29 21:48:20,602 - core_calling_service - WARNING - âš ï¸ Auto-transition after response target not found: None, falling back to normal evaluation
2025-12-29T21:48:20.604405571Z [err]  2025-12-29 21:48:20,602 - core_calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-29T21:48:20.604411281Z [err]  2025-12-29 21:48:20,602 - core_calling_service - INFO - ğŸ” Using explicitly set current_node_id: 2
2025-12-29T21:48:20.604416070Z [err]  2025-12-29 21:48:20,602 - core_calling_service - INFO - â±ï¸ [21:48:20.602] ğŸ”€ About to call _follow_transition() for: Hello?...
2025-12-29T21:48:20.614632114Z [err]  2025-12-29 21:48:20,610 - core_calling_service - INFO - â±ï¸ [21:48:20.610] ğŸ”€ TRANSITION EVALUATION START - Calling LLM for 2 options
2025-12-29T21:48:20.664121792Z [err]  2025-12-29 21:48:20,662 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=4.7s, checkin_count=1/2
2025-12-29T21:48:20.694139410Z [err]  2025-12-29 21:48:20,689 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:48:20.694150465Z [err]  2025-12-29 21:48:20,690 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': 'aa10ce8a-2353-4c64-b595-5d1416961ff4', 'occurred_at': '2025-12-29T21:48:20.389212Z', 'payload': {'call_control_id': 'v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA', 'call_leg_id': '138ebeae-e500-11f0-b841-02420aef98a0', 'call_session_id': '138c976e-e500-11f0-86e5-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:48:20.694158921Z [err]  2025-12-29 21:48:20,690 - server - INFO - ğŸ¯ Event type: call.machine.premium.detection.ended, Call ID: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:20.694166246Z [err]  2025-12-29 21:48:20,690 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:48:20.694173772Z [inf]  100.64.0.13:34636 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:48:20.729864909Z [err]  2025-12-29 21:48:20,727 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:48:20.729871963Z [err]  2025-12-29 21:48:20,727 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'e6c84a72-a82c-4897-93a2-97099df65809', 'occurred_at': '2025-12-29T21:48:20.415240Z', 'payload': {'call_control_id': 'v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA', 'call_leg_id': '138ebeae-e500-11f0-b841-02420aef98a0', 'call_session_id': '138c976e-e500-11f0-86e5-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'p429YXgfyw', 'status': 'cancelled', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:48:20.729876708Z [err]  2025-12-29 21:48:20,727 - server - INFO - ğŸ¯ Event type: call.playback.ended, Call ID: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:20.729883282Z [err]  2025-12-29 21:48:20,727 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:48:20.732121623Z [err]  2025-12-29 21:48:20,728 - redis_service - INFO - â– Removed playback p429YXgfyw, 0 remaining for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:20.732131490Z [err]  2025-12-29 21:48:20,729 - server - INFO - ğŸ”Š Redis: Removed playback p429YXgfyw, 0 remaining
2025-12-29T21:48:20.732138109Z [err]  2025-12-29 21:48:20,729 - server - INFO - ğŸ”Š ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T21:48:20.732143532Z [err]  2025-12-29 21:48:20,730 - server - INFO - âœ… Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T21:48:20.732148688Z [err]  2025-12-29 21:48:20,730 - server - INFO - âœ… Found session in active_telnyx_calls (local worker)
2025-12-29T21:48:20.732154068Z [err]  2025-12-29 21:48:20,730 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044900.7301695 for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:20.732158180Z [err]  2025-12-29 21:48:20,730 - server - INFO - â±ï¸ Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-29T21:48:20.732162585Z [inf]  100.64.0.16:49790 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:48:21.388855679Z [err]  2025-12-29 21:48:20,991 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-29T21:48:21.388859876Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - â±ï¸ [21:48:20.992] ğŸ”€ TRANSITION EVALUATION COMPLETE - took 381ms
2025-12-29T21:48:21.388864089Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - ğŸ¤– AI transition decision: '-1'
2025-12-29T21:48:21.388868047Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - ğŸ“Š Available transitions: ['Confirms name (Yes|Speaking|This is he/she) OR Ask...', 'Wrong number (No John here|Wrong number|etc) - don...']
2025-12-29T21:48:21.388872414Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - Selected transition index: -1
2025-12-29T21:48:21.388877708Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - No specific condition matched, looking for default transition...
2025-12-29T21:48:21.388881678Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - âš ï¸ No transition matched, but node has GOAL. Staying on current node to continue with goal-based guidance.
2025-12-29T21:48:21.388885509Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - ğŸ¯ Goal: Say the customer's name...
2025-12-29T21:48:21.388889437Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - â±ï¸ [TIMING] TRANSITION_EVAL: 389ms
2025-12-29T21:48:21.388897930Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - â±ï¸ [21:48:20.992] âœ… Node selected, about to process content...
2025-12-29T21:48:21.391669899Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - ğŸ”§ Replaced {{now}} with Monday, December 29, 2025 at 4:48 PM EST in content
2025-12-29T21:48:21.391681404Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - ğŸ”§ Replaced {{customer_name}} with Kendrick in content
2025-12-29T21:48:21.391688929Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - ğŸ”§ Replaced {{callerName}} with  in content
2025-12-29T21:48:21.394213489Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - ğŸ”§ Replaced {{lead_id}} with None in content
2025-12-29T21:48:21.394221123Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - ğŸ”§ Replaced {{qc_tracking_enabled}} with False in content
2025-12-29T21:48:21.394225892Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - ğŸ”§ Replaced {{track_keywords}} with  in content
2025-12-29T21:48:21.394232143Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - ğŸ”§ Replaced {{expected_commitment}} with not_specified in content
2025-12-29T21:48:21.394237220Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - ğŸ”§ Replaced {{to_number}} with +17708336397 in content
2025-12-29T21:48:21.394242353Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - ğŸ”§ Replaced {{phone_number}} with +17708336397 in content
2025-12-29T21:48:21.394246637Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - ğŸ”§ Replaced {{email}} with None in content
2025-12-29T21:48:21.394250756Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - âœ… Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-29T21:48:21.394255045Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-29T21:48:21.394259937Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - ğŸ“š skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-29T21:48:21.394265618Z [err]  2025-12-29 21:48:20,992 - core_calling_service - INFO - â±ï¸ [21:48:20.992] ğŸ“„ About to process content (mode=script, length=9)
2025-12-29T21:48:21.394269960Z [err]  2025-12-29 21:48:20,993 - core_calling_service - INFO - ğŸ›¡ï¸ Preventing Dead Air: User stayed on script node 'Greeting' without transition
2025-12-29T21:48:21.394273728Z [err]  2025-12-29 21:48:20,993 - core_calling_service - INFO - ğŸ¤– Generating sticky-prevention response...
2025-12-29T21:48:21.395831990Z [err]  2025-12-29 21:48:21,000 - core_calling_service - INFO - âš¡ PARALLEL MODE: Running KB + analysis simultaneously
2025-12-29T21:48:21.395840123Z [err]  2025-12-29 21:48:21,000 - kb_router - INFO - ğŸš¦ KB Router: SKIP (simple chat pattern matched)
2025-12-29T21:48:21.395844325Z [err]  2025-12-29 21:48:21,000 - core_calling_service - INFO - âš¡ Skipping KB (reason: simple_chat)
2025-12-29T21:48:21.395848545Z [err]  2025-12-29 21:48:21,001 - core_calling_service - INFO - âš¡ Parallel operations completed in 0ms
2025-12-29T21:48:21.395852665Z [err]  2025-12-29 21:48:21,001 - core_calling_service - INFO - ğŸ” Node 'Greeting': use_parallel_llm=True
2025-12-29T21:48:21.395856884Z [err]  2025-12-29 21:48:21,001 - core_calling_service - INFO - âš¡ Parallel mode: Using condensed history (3/3 messages)
2025-12-29T21:48:21.395861228Z [err]  2025-12-29 21:48:21,001 - core_calling_service - INFO - â±ï¸ [21:48:21.001] ğŸ’¬ LLM REQUEST START: 3 conversation turns, 7881 system chars (KB cached)
2025-12-29T21:48:21.395865895Z [err]  2025-12-29 21:48:21,001 - core_calling_service - INFO - ğŸ“ â•â•â•â•â•â•â•â•â•â•â• LLM PROMPT BREAKDOWN â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:48:21.395874036Z [err]  2025-12-29 21:48:21,001 - core_calling_service - INFO - ğŸ“ [SYSTEM MSG 1 - GLOBAL PROMPT] (6467 chars):
2025-12-29T21:48:21.395880104Z [err]  2025-12-29 21:48:21,001 - core_calling_service - INFO - ğŸ“   Preview: # Global Prompt: Direct Drive Engine (V4.2 - Acknowledging & Fluid)
2025-12-29T21:48:21.395885969Z [err]  
2025-12-29T21:48:21.395893851Z [err]  When user states income, convert/update as [yearly_income] variable for logic splits.
2025-12-29T21:48:21.395899549Z [err]  
2025-12-29T21:48:21.395908519Z [err]  If user says a name, don't assume it's theirsâ€”wait for explicit correction.
2025-12-29T21:48:21.395913649Z [err]  
2025-12-29T21:48:21.395918628Z [err]  If user asks to repeat info, rephrase naturallyâ€”never exact repeat.
2025-12-29T21:48:21.397608448Z [err]  
2025-12-29T21:48:21.397618019Z [err]  If asked your state: "Atlanta, GA. Been in Midtown 10 years."
2025-12-29T21:48:21.397623097Z [err]  CONVERSATION STATUS: Turn 2, objection handling phase
2025-12-29T21:48:21.397625425Z [err]  
2025-12-29T21:48:21.397631712Z [err]  
2025-12-29T21:48:21.397633447Z [err]  If asked about call number: "Company number."
2025-12-29T21:48:21.397639491Z [err]  This context is provided to help you focus. You still need to:
2025-12-29T21:48:21.397640117Z [err]  
2025-12-29T21:48:21.397646666Z [err]  User email: {customer_email} (for them: {{customer_email}}).
2025-12-29T21:48:21.397648223Z [err]  1. Generate a natural, contextual response
2025-12-29T21:48:21.397653093Z [err]  
2025-12-29T21:48:21.397655510Z [err]  2. Evaluate transitions per your node instructions
2025-12-29T21:48:21.397658975Z [err]  If explaining ends in peri...
2025-12-29T21:48:21.397665452Z [err]  2025-12-29 21:48:21,001 - core_calling_service - INFO - ğŸ“ [SYSTEM MSG 2 - DYNAMIC CONTEXT] (1414 chars):
2025-12-29T21:48:21.397671720Z [err]  2025-12-29 21:48:21,001 - core_calling_service - INFO - ğŸ“   Preview: 
2025-12-29T21:48:21.397677472Z [err]  
2025-12-29T21:48:21.397687108Z [err]  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-29T21:48:21.397694180Z [err]  PREPROCESSED CONTEXT (to help you prioritize and focus):
2025-12-29T21:48:21.397700452Z [err]  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-29T21:48:21.397707193Z [err]  
2025-12-29T21:48:21.397713076Z [err]  USER COMMUNICATION STYLE: C type - adjust your response accordingly
2025-12-29T21:48:21.399223346Z [err]  
2025-12-29T21:48:21.399232222Z [err]  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2025-12-29T21:48:21.399238585Z [err]  
2025-12-29T21:48:21.399244759Z [err]  # CURRENT CONTEXT
2025-12-29T21:48:21.399250589Z [err]  Customer: Kendrick
2025-12-29T21:48:21.399255895Z [err]  Variables: {"now": "Monday, December 29, 2025 at 4:48 PM EST", "customer_name": "Kendrick", "callerName": "", "lead_id": null, "qc_tracking_enabled": false, "track_keywords": "", "expected_commitment": ...
2025-12-29T21:48:21.399261418Z [err]  2025-12-29 21:48:21,001 - core_calling_service - INFO - ğŸ“ [CONVERSATION HISTORY] (3 messages)
2025-12-29T21:48:21.399266954Z [err]  2025-12-29 21:48:21,001 - core_calling_service - INFO - ğŸ“   assistant: Kendrick?...
2025-12-29T21:48:21.399272871Z [err]  2025-12-29 21:48:21,001 - core_calling_service - INFO - ğŸ“   user: Hello?...
2025-12-29T21:48:21.399279300Z [err]  2025-12-29 21:48:21,001 - core_calling_service - INFO - ğŸ“ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:48:21.399284947Z [err]  2025-12-29 21:48:21,006 - dead_air_monitor - INFO - ğŸš© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-29T21:48:21.399291098Z [err]  2025-12-29 21:48:21,007 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044901.0070128 for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:21.399296704Z [err]  2025-12-29 21:48:21,007 - core_calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:21.399302508Z [err]  2025-12-29 21:48:21,007 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:wiWoWdu8nZPh-hUfU... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'])
2025-12-29T21:48:21.400322021Z [err]  2025-12-29 21:48:21,186 - httpx - INFO - HTTP Request: POST https://api.x.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-29T21:48:21.511420780Z [err]  2025-12-29 21:48:21,509 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:wiWoWdu8nZPh-hUfU... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'])
2025-12-29T21:48:21.553077638Z [err]  2025-12-29 21:48:21,551 - core_calling_service - INFO - â±ï¸ [21:48:21.550] ğŸ’¬ LLM FIRST TOKEN: 549ms (grok grok-4-1-fast-non-reasoning)
2025-12-29T21:48:21.621670400Z [err]  2025-12-29 21:48:21,619 - server - INFO - ğŸ“¤ Sentence arrived from LLM: [N] Hey Kendrick,...
2025-12-29T21:48:21.621676859Z [err]  2025-12-29 21:48:21,619 - server - INFO - â±ï¸ [TIMING] TTFS (Time To First Sentence): 1631ms
2025-12-29T21:48:21.621681702Z [err]  2025-12-29 21:48:21,619 - server - INFO - âš¡ Starting REAL-TIME TTS for first sentence
2025-12-29T21:48:21.621686450Z [err]  2025-12-29 21:48:21,619 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:wiWoWdu8nZPh-hUfU... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'])
2025-12-29T21:48:21.621691132Z [err]  2025-12-29 21:48:21,619 - server - INFO - âš¡ ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-29T21:48:21.713381742Z [err]  2025-12-29 21:48:21,711 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:48:21.805101049Z [err]  2025-12-29 21:48:21,799 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:48:22.372596460Z [err]  2025-12-29 21:48:21,889 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:48:22.372604144Z [err]  2025-12-29 21:48:21,911 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-29T21:48:22.372611908Z [err]  2025-12-29 21:48:21,911 - server - INFO - âœ… ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-29T21:48:22.372619005Z [err]  2025-12-29 21:48:21,911 - persistent_tts_service - INFO - ğŸ™ï¸ Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:48:22.372627225Z [err]  2025-12-29 21:48:21,911 - persistent_tts_service - INFO - ğŸ”Œ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Establishing persistent TTS WebSocket...
2025-12-29T21:48:22.372635051Z [err]  2025-12-29 21:48:21,911 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-29T21:48:22.376099578Z [err]  2025-12-29 21:48:21,911 - elevenlabs_ws_service - INFO - ğŸ”Œ Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-29T21:48:22.376108600Z [err]  2025-12-29 21:48:21,911 - elevenlabs_ws_service - INFO - ğŸ™ï¸ Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-29T21:48:22.376113483Z [err]  2025-12-29 21:48:22,010 - persistent_tts_service - WARNING - âš ï¸  No persistent TTS session found for call v3:wiWoWdu8nZPh-hUfU... (active sessions: ['v3:tsihRGQZxbPBg2zquJgpUfOKE4CvI7EIawv4LfSdLbjCuye5I3sxmQ', 'v3:QiUB4hXB0fhw8r7ROllaTAJLWo-_6pYdenT8N4CWesZi_0W49-XGZA'])
2025-12-29T21:48:22.376118086Z [err]  2025-12-29 21:48:22,047 - elevenlabs_ws_service - INFO - âœ… Connected to ElevenLabs WebSocket
2025-12-29T21:48:22.376122596Z [err]  2025-12-29 21:48:22,047 - elevenlabs_ws_service - INFO - ğŸ“¤ Sent BOS message with voice settings
2025-12-29T21:48:22.376640255Z [err]  2025-12-29 21:48:22,047 - persistent_tts_service - INFO - ğŸ”Š [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Comfort noise loop started
2025-12-29T21:48:22.376649148Z [err]  2025-12-29 21:48:22,047 - persistent_tts_service - INFO - âœ… Created persistent TTS session for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:22.376657869Z [err]  2025-12-29 21:48:22,047 - server - INFO - âœ… ON-DEMAND: Persistent TTS session created successfully!
2025-12-29T21:48:22.376671251Z [err]  2025-12-29 21:48:22,047 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:wiWoWdu8nZPh-hUfU..., session=FOUND
2025-12-29T21:48:22.376671530Z [err]  2025-12-29 21:48:22,047 - persistent_tts_service - INFO - âœ… [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Persistent TTS WebSocket established
2025-12-29T21:48:22.376679454Z [err]  2025-12-29 21:48:22,047 - persistent_tts_service - INFO - ğŸ§ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Audio receiver loop started
2025-12-29T21:48:22.376690205Z [err]  2025-12-29 21:48:22,047 - core_calling_service - INFO - ğŸ“¤ Streamed sentence: [N] Hey Kendrick,...
2025-12-29T21:48:22.376699696Z [err]  2025-12-29 21:48:22,047 - server - INFO - ğŸš€ Streaming sentence #1 via persistent WebSocket
2025-12-29T21:48:22.376702786Z [err]  2025-12-29 21:48:22,048 - persistent_tts_service - INFO - ğŸµ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Playback consumer started
2025-12-29T21:48:22.376713011Z [err]  2025-12-29 21:48:22,047 - server - INFO - ğŸµ TTS task #1 started at +428ms
2025-12-29T21:48:22.376714317Z [err]  2025-12-29 21:48:22,048 - persistent_tts_service - INFO - ğŸ§ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Audio Receiver Loop STARTED
2025-12-29T21:48:22.376723021Z [err]  2025-12-29 21:48:22,047 - server - INFO - â±ï¸ [TIMING] TTFT_TTS (First TTS Task Started): 2059ms
2025-12-29T21:48:22.379750087Z [err]  2025-12-29 21:48:22,051 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:wiWoWdu8nZPh-hUfU..., session=FOUND
2025-12-29T21:48:22.379765555Z [err]  2025-12-29 21:48:22,051 - server - INFO - ğŸš€ Streaming sentence #3 via persistent WebSocket
2025-12-29T21:48:22.379773106Z [err]  2025-12-29 21:48:22,051 - server - INFO - ğŸµ TTS task #3 started at +432ms
2025-12-29T21:48:22.379780949Z [err]  2025-12-29 21:48:22,051 - core_calling_service - INFO - ğŸ“¤ Streamed final fragment: You there?...
2025-12-29T21:48:22.379800991Z [err]  2025-12-29 21:48:22,051 - core_calling_service - INFO - â±ï¸ [TIMING] LLM_TOTAL: 1050ms for 52 chars (grok grok-4-1-fast-non-reasoning)
2025-12-29T21:48:22.379810456Z [err]  2025-12-29 21:48:22,051 - core_calling_service - INFO - â±ï¸ SILENCE TIMER RESET (user gave meaningful response) for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:22.379823107Z [err]  2025-12-29 21:48:22,051 - core_calling_service - INFO - ğŸ”Š Silence tracking reset for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA (user responded)
2025-12-29T21:48:22.379835284Z [err]  2025-12-29 21:48:22,051 - core_calling_service - INFO - âœ… User responded to regular message, resetting counter
2025-12-29T21:48:22.379901621Z [err]  2025-12-29 21:48:22,051 - persistent_tts_service - INFO - ğŸ¤ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Streaming sentence #2: it's Jake here from JK....
2025-12-29T21:48:22.379908642Z [err]  2025-12-29 21:48:22,051 - persistent_tts_service - INFO - ğŸš€ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Sent sentence #2 (NON-BLOCKING) in 0ms
2025-12-29T21:48:22.379918585Z [err]  2025-12-29 21:48:22,051 - core_calling_service - INFO - LLM response (1.97s): [N] Hey Kendrick, it's Jake here from JK. You there?
2025-12-29T21:48:22.379924331Z [err]  2025-12-29 21:48:22,051 - persistent_tts_service - INFO - ğŸ“Š [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=False, is_last=False
2025-12-29T21:48:22.379931503Z [err]  2025-12-29 21:48:22,051 - core_calling_service - INFO - Total latency: 1.97s
2025-12-29T21:48:22.379935087Z [err]  2025-12-29 21:48:22,051 - server - INFO - ğŸ“¤ Sentence arrived from LLM: You there?...
2025-12-29T21:48:22.379936567Z [err]  2025-12-29 21:48:22,053 - server - INFO - âœ… LLM finished in 2065ms, TTS tasks already running in background
2025-12-29T21:48:22.379957174Z [err]  2025-12-29 21:48:22,053 - server - INFO - ğŸš€ Persistent TTS: Audio already streaming in background!
2025-12-29T21:48:22.379959000Z [err]  2025-12-29 21:48:22,053 - server - INFO - ğŸµ Streaming 3 TTS chunks as they complete...
2025-12-29T21:48:22.379960173Z [err]  2025-12-29 21:48:22,051 - core_calling_service - INFO - ğŸ’¾ Storing node ID 2 in conversation history
2025-12-29T21:48:22.379970243Z [err]  2025-12-29 21:48:22,054 - server - INFO - âœ… All 3 persistent TTS streams completed
2025-12-29T21:48:22.379972322Z [err]  2025-12-29 21:48:22,053 - server - INFO -    3 sentences queued and playing seamlessly
2025-12-29T21:48:22.379981627Z [err]  2025-12-29 21:48:22,054 - server - INFO - âœ… Agent generation complete (persistent TTS) - response window closed
2025-12-29T21:48:22.379988204Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  FIRST AUDIO STARTED: 2066ms from user stop ğŸš€
2025-12-29T21:48:22.379996480Z [err]  2025-12-29 21:48:22,053 - persistent_tts_service - INFO - ğŸ¤ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Streaming sentence #3: You there?...
2025-12-29T21:48:22.380009771Z [err]  2025-12-29 21:48:22,054 - persistent_tts_service - INFO - ğŸš€ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Sent sentence #3 (NON-BLOCKING) in 0ms
2025-12-29T21:48:22.380021083Z [err]  2025-12-29 21:48:22,054 - persistent_tts_service - INFO - ğŸ“Š [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] DIAGNOSTIC: pending_sentences=2, audio_queue=0, is_first=False, is_last=False
2025-12-29T21:48:22.380108533Z [err]  2025-12-29 21:48:22,048 - persistent_tts_service - INFO - ğŸ’“ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Starting TTS keep-alive loop (every 15s)
2025-12-29T21:48:22.380116097Z [err]  2025-12-29 21:48:22,048 - persistent_tts_service - INFO - ğŸ”Š [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Starting comfort noise loop
2025-12-29T21:48:22.380122690Z [err]  2025-12-29 21:48:22,048 - persistent_tts_service - INFO - ğŸ¤ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Streaming sentence #1: [N] Hey Kendrick,...
2025-12-29T21:48:22.380128655Z [err]  2025-12-29 21:48:22,048 - persistent_tts_service - INFO - ğŸš€ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-29T21:48:22.380135974Z [err]  2025-12-29 21:48:22,048 - persistent_tts_service - INFO - ğŸ“Š [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-29T21:48:22.380147161Z [err]  2025-12-29 21:48:22,050 - server - INFO - ğŸ“¤ Sentence arrived from LLM: it's Jake here from JK....
2025-12-29T21:48:22.380156091Z [err]  2025-12-29 21:48:22,050 - server - INFO - ğŸ” Persistent TTS lookup: call_id=v3:wiWoWdu8nZPh-hUfU..., session=FOUND
2025-12-29T21:48:22.380162123Z [err]  2025-12-29 21:48:22,050 - server - INFO - ğŸš€ Streaming sentence #2 via persistent WebSocket
2025-12-29T21:48:22.380170203Z [err]  2025-12-29 21:48:22,050 - server - INFO - ğŸµ TTS task #2 started at +430ms
2025-12-29T21:48:22.380176390Z [err]  2025-12-29 21:48:22,050 - core_calling_service - INFO - ğŸ“¤ Streamed sentence: it's Jake here from JK....
2025-12-29T21:48:22.380182073Z [err]  2025-12-29 21:48:22,051 - persistent_tts_service - INFO - ğŸ§ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Receiver processing sentence #1: '[N] Hey Kendrick,...'
2025-12-29T21:48:22.380187381Z [err]  2025-12-29 21:48:22,051 - persistent_tts_service - INFO - ğŸ“Š [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] DIAGNOSTIC: queue_latency=2ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-29T21:48:22.383166303Z [err]  2025-12-29 21:48:22,054 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:22.383170761Z [err]  2025-12-29 21:48:22,054 - server - INFO - âœ… Agent generation complete - response window closed
2025-12-29T21:48:22.383175417Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:48:22.383179997Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-29T21:48:22.383185347Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  [TIMING] STT: 9ms (provider: soniox, model: stt-rt-v3)
2025-12-29T21:48:22.383190347Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  [TIMING] LLM_TOTAL: 2065ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-29T21:48:22.383196546Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  [TIMING] TTS_TOTAL: 435ms (provider: elevenlabs, websocket: False)
2025-12-29T21:48:22.383201679Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  [TIMING] E2E_TOTAL: 2066ms (user stopped â†’ play_audio_url called)
2025-12-29T21:48:22.383206190Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  [TIMING] âš ï¸ NOTE: E2E_TOTAL does not include:
2025-12-29T21:48:22.383211345Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-29T21:48:22.383215898Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-29T21:48:22.383221359Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-29T21:48:22.383227494Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-29T21:48:22.384247140Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  [TIMING]   - REAL USER LATENCY: 2366ms estimated
2025-12-29T21:48:22.384255892Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  [TIMING] RESPONSE_TEXT: 52 chars, 3 sentences
2025-12-29T21:48:22.384262478Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  [TIMING] USER_INPUT: 'Hello?...'
2025-12-29T21:48:22.384269433Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  [TIMING] AI_RESPONSE: '[N] Hey Kendrick, it's Jake here from JK. You there?...'
2025-12-29T21:48:22.384275803Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  [TIMING] ==========================
2025-12-29T21:48:22.384281814Z [err]  2025-12-29 21:48:22,054 - server - INFO - â±ï¸  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
2025-12-29T21:48:22.384288802Z [err]  2025-12-29 21:48:22,247 - server - INFO - ğŸ“ Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 2509ms)
2025-12-29T21:48:22.384294394Z [err]  2025-12-29 21:48:22,247 - server - INFO - ğŸ”Š Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-29T21:48:22.384299231Z [err]  2025-12-29 21:48:22,247 - server - INFO - ğŸ” END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-29T21:48:22.384303707Z [err]  2025-12-29 21:48:22,300 - persistent_tts_service - INFO - â±ï¸ [TIMING] TTFA (Time To First Audio Playback): 251ms
2025-12-29T21:48:22.384308089Z [err]  2025-12-29 21:48:22,300 - persistent_tts_service - INFO - ğŸ“¤ Sending 9272 bytes of audio (58 chunks, 1.2s duration) via WebSocket
2025-12-29T21:48:22.384313193Z [err]  2025-12-29 21:48:22,300 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:48:22.386054392Z [err]  2025-12-29 21:48:22,300 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +1.2s (total: 1.2s from now)
2025-12-29T21:48:22.386064719Z [err]  2025-12-29 21:48:22,301 - persistent_tts_service - INFO - âœ… Sent 58 audio chunks via WebSocket
2025-12-29T21:48:22.515647873Z [err]  2025-12-29 21:48:22,513 - persistent_tts_service - INFO - ğŸ“¤ Sending 14118 bytes of audio (89 chunks, 1.8s duration) via WebSocket
2025-12-29T21:48:22.515663419Z [err]  2025-12-29 21:48:22,513 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:48:22.515672089Z [err]  2025-12-29 21:48:22,513 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +1.8s (total: 2.7s from now)
2025-12-29T21:48:22.517108186Z [err]  2025-12-29 21:48:22,515 - persistent_tts_service - INFO - âœ… Sent 89 audio chunks via WebSocket
2025-12-29T21:48:22.713248663Z [err]  2025-12-29 21:48:22,711 - persistent_tts_service - INFO - ğŸ“¤ Sending 5944 bytes of audio (38 chunks, 0.7s duration) via WebSocket
2025-12-29T21:48:22.713254769Z [err]  2025-12-29 21:48:22,711 - persistent_tts_service - INFO - ğŸ™ï¸ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-29T21:48:22.713259097Z [err]  2025-12-29 21:48:22,711 - persistent_tts_service - INFO - â±ï¸ EXTEND playback_expected_end_time: +0.7s (total: 3.3s from now)
2025-12-29T21:48:22.715042234Z [err]  2025-12-29 21:48:22,712 - persistent_tts_service - INFO - âœ… Sent 38 audio chunks via WebSocket
2025-12-29T21:48:23.296685089Z [err]  2025-12-29 21:48:23,000 - server - INFO - ğŸ“¤ Audio flowing: 296 packets sent to Soniox (5s update)
2025-12-29T21:48:23.296693356Z [err]  2025-12-29 21:48:23,167 - core_calling_service - INFO - â° Check-in triggered after 7.2s silence (threshold: 7s)
2025-12-29T21:48:23.296699263Z [err]  2025-12-29 21:48:23,168 - core_calling_service - INFO - ğŸ’¬ Sending FINAL check-in #2/2: Are you still there?
2025-12-29T21:48:23.296705133Z [err]  2025-12-29 21:48:23,168 - core_calling_service - INFO - âš ï¸ Will end call if no response after next silence timeout
2025-12-29T21:48:23.296711683Z [err]  2025-12-29 21:48:23,168 - dead_air_monitor - INFO - ğŸ’¬ Sending check-in after 7.2s silence: Are you still there?
2025-12-29T21:48:23.296718159Z [err]  2025-12-29 21:48:23,168 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:23.296724339Z [err]  2025-12-29 21:48:23,168 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q: Are you still there?...
2025-12-29T21:48:23.296730392Z [err]  2025-12-29 21:48:23,168 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-29T21:48:23.296736578Z [err]  2025-12-29 21:48:23,168 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-29T21:48:23.296767729Z [err]  2025-12-29 21:48:23,168 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-29T21:48:23.296775974Z [err]  2025-12-29 21:48:23,168 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-29T21:48:23.296782348Z [err]  2025-12-29 21:48:23,168 - server - INFO - ğŸ’¾ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-29T21:48:23.296788476Z [err]  2025-12-29 21:48:23,168 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.00s
2025-12-29T21:48:23.296793946Z [err]  2025-12-29 21:48:23,168 - telnyx_service - INFO - âœ… Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:48:23.299504987Z [err]  2025-12-29 21:48:23,169 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:48:23.374983578Z [err]  2025-12-29 21:48:23,369 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:48:23.374995622Z [err]  2025-12-29 21:48:23,369 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.20s
2025-12-29T21:48:23.375001851Z [err]  2025-12-29 21:48:23,369 - telnyx_service - ERROR - âŒ Telnyx playback failed: 422 - {
2025-12-29T21:48:23.375029498Z [err]    "errors": [
2025-12-29T21:48:23.375034949Z [err]      {
2025-12-29T21:48:23.375041158Z [err]        "code": "90018",
2025-12-29T21:48:23.375046611Z [err]        "title": "Call has already ended",
2025-12-29T21:48:23.375051676Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:48:23.375071783Z [err]      }
2025-12-29T21:48:23.375079124Z [err]    ]
2025-12-29T21:48:23.375085621Z [err]  }
2025-12-29T21:48:23.375112946Z [err]  2025-12-29 21:48:23,370 - telnyx_service - INFO - ğŸ“¢ Using Telnyx built-in TTS
2025-12-29T21:48:23.615417712Z [err]  2025-12-29 21:48:23,611 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:48:23.615424258Z [err]  2025-12-29 21:48:23,611 - telnyx_service - ERROR - âŒ Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:48:23.615428742Z [err]  2025-12-29 21:48:23,611 - dead_air_monitor - INFO - âœ… Check-in message sent
2025-12-29T21:48:24.718093395Z [err]  2025-12-29 21:48:24,711 - elevenlabs_ws_service - INFO - â±ï¸  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-29T21:48:24.718103559Z [err]  2025-12-29 21:48:24,711 - persistent_tts_service - INFO - âœ… [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Receiver finished sentence #1: 3 chunks in 2662ms
2025-12-29T21:48:24.718111409Z [err]  2025-12-29 21:48:24,711 - persistent_tts_service - INFO - ğŸ§ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Receiver processing sentence #2: 'it's Jake here from JK....'
2025-12-29T21:48:24.718116928Z [err]  2025-12-29 21:48:24,711 - persistent_tts_service - INFO - ğŸ“Š [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] DIAGNOSTIC: queue_latency=2660ms, pending_sentences=1, audio_queue=0, interrupted=False
2025-12-29T21:48:25.336393388Z [err]  2025-12-29 21:48:25,022 - dead_air_monitor - INFO - ğŸ”‡ MONITOR: Skipping silence check - audio playing (0.9s left)
2025-12-29T21:48:26.406188217Z [err]  2025-12-29 21:48:26,025 - dead_air_monitor - INFO - â±ï¸ Playback expected end time passed (0.1s ago), marking agent as done speaking
2025-12-29T21:48:26.406194431Z [err]  2025-12-29 21:48:26,025 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044906.025953 for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:26.406201654Z [err]  2025-12-29 21:48:26,025 - core_calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:26.406207761Z [err]  2025-12-29 21:48:26,267 - persistent_tts_service - INFO - ğŸ”‡ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] FLOOR RELEASED (is_holding_floor=False)
2025-12-29T21:48:27.326330036Z [err]  2025-12-29 21:48:27,005 - server - INFO - ğŸ“ Telnyx WebSocket disconnected. Sent 487 total packets
2025-12-29T21:48:27.326336439Z [err]  [2025-12-29 21:48:27 +0000] [5] [INFO] connection closed
2025-12-29T21:48:27.326342705Z [err]  2025-12-29 21:48:27,152 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:48:27.326348435Z [err]  2025-12-29 21:48:27,152 - server - INFO - ğŸ“ Call ended: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:27.326350212Z [err]  2025-12-29 21:48:27,152 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.hangup', 'id': '1203c457-a04c-4384-ad49-fbadbeac4b72', 'occurred_at': '2025-12-29T21:48:26.689214Z', 'payload': {'call_control_id': 'v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA', 'call_leg_id': '138ebeae-e500-11f0-b841-02420aef98a0', 'call_quality_stats': {'inbound': {'jitter_max_variance': '25.00', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '507', 'skip_packet_count': '15'}, 'outbound': {'packet_count': '490', 'skip_packet_count': '0'}}, 'call_session_id': '138c976e-e500-11f0-86e5-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:48:26.689214Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-29T21:48:14.249207Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:48:27.326359748Z [err]  2025-12-29 21:48:27,152 - server - INFO - ğŸ“ Hangup cause: normal_clearing
2025-12-29T21:48:27.326366172Z [err]  2025-12-29 21:48:27,152 - server - INFO - ğŸ¯ Event type: call.hangup, Call ID: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:27.326374602Z [err]  2025-12-29 21:48:27,152 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:48:27.330244152Z [err]  2025-12-29 21:48:27,314 - server - INFO - âœ… Found session in active_telnyx_calls (local worker)
2025-12-29T21:48:27.330252830Z [err]  2025-12-29 21:48:27,314 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044907.3145533 for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:27.330259861Z [err]  2025-12-29 21:48:27,313 - redis_service - INFO - â– Removed playback GCsBC0R2fw, 0 remaining for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:27.330261354Z [err]  2025-12-29 21:48:27,314 - server - INFO - â±ï¸ Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-29T21:48:27.330269778Z [err]  2025-12-29 21:48:27,313 - server - INFO - ğŸ”Š Redis: Removed playback GCsBC0R2fw, 0 remaining
2025-12-29T21:48:27.330276822Z [err]  2025-12-29 21:48:27,313 - server - INFO - ğŸ”Š ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-29T21:48:27.330286568Z [err]  2025-12-29 21:48:27,314 - server - INFO - âœ… Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-29T21:48:27.330338275Z [inf]  100.64.0.8:44438 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:48:27.330626079Z [err]  2025-12-29 21:48:27,211 - elevenlabs_ws_service - WARNING - âš ï¸  [TIMING] ElevenLabs timeout waiting for first chunk (2.5s) - No audio received!
2025-12-29T21:48:27.330631814Z [err]  2025-12-29 21:48:27,211 - persistent_tts_service - WARNING - âš ï¸ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Receiver got 0 chunks for sentence #2! interrupted=False
2025-12-29T21:48:27.330637481Z [err]  2025-12-29 21:48:27,211 - persistent_tts_service - INFO - ğŸ§ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Receiver processing sentence #3: 'You there?...'
2025-12-29T21:48:27.330643718Z [err]  2025-12-29 21:48:27,211 - persistent_tts_service - INFO - ğŸ“Š [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] DIAGNOSTIC: queue_latency=5157ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-29T21:48:27.330649624Z [err]  2025-12-29 21:48:27,286 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:48:27.330656191Z [err]  2025-12-29 21:48:27,286 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'streaming.stopped', 'id': '9508f571-cfb0-4a61-91c6-7136fefd8173', 'occurred_at': '2025-12-29T21:48:26.873609Z', 'payload': {'call_control_id': 'v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA', 'call_leg_id': '138ebeae-e500-11f0-b841-02420aef98a0', 'call_session_id': '138c976e-e500-11f0-86e5-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '8db114b0-f796-49d2-abf2-94362c5612c6', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:48:27.330663442Z [err]  2025-12-29 21:48:27,287 - server - INFO - ğŸ¯ Event type: streaming.stopped, Call ID: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:27.330671553Z [err]  2025-12-29 21:48:27,287 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:48:27.330862610Z [inf]  100.64.0.15:56946 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:48:27.330870509Z [err]  2025-12-29 21:48:27,311 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:48:27.330877771Z [err]  2025-12-29 21:48:27,311 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '5dabcd89-c97f-44a2-a13a-fc97d438f364', 'occurred_at': '2025-12-29T21:48:26.729210Z', 'payload': {'call_control_id': 'v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA', 'call_leg_id': '138ebeae-e500-11f0-b841-02420aef98a0', 'call_session_id': '138c976e-e500-11f0-86e5-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:48:26.729210Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'GCsBC0R2fw', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:48:27.330884351Z [err]  2025-12-29 21:48:27,311 - server - INFO - ğŸ¯ Event type: call.playback.ended, Call ID: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:27.330891553Z [err]  2025-12-29 21:48:27,311 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:48:27.341659439Z [err]  2025-12-29 21:48:27,337 - server - INFO - ğŸ“ Updated call log: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:27.437739123Z [err]  2025-12-29 21:48:27,430 - server - INFO - âœ… Finalized call log: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA (duration=10s, status=completed)
2025-12-29T21:48:27.528534167Z [err]  2025-12-29 21:48:27,524 - server - INFO - ğŸ“¦ Saved 11 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-29T21:48:28.349524408Z [err]  2025-12-29 21:48:28,226 - server - INFO - ğŸ“Š Auto-added call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-29T21:48:28.416162747Z [err]  2025-12-29 21:48:28,408 - server - INFO - ğŸ“¤ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-29T21:48:28.416171795Z [err]  2025-12-29 21:48:28,410 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:28.416178135Z [err]  2025-12-29 21:48:28,410 - server - INFO - ğŸ“‡ [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-29T21:48:28.416185095Z [err]  2025-12-29 21:48:28,410 - server - INFO - ğŸ“‡ [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-29T21:48:28.438859226Z [err]  2025-12-29 21:48:28,437 - server - INFO - ğŸ“¨ ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-29T21:48:28.438868148Z [err]  2025-12-29 21:48:28,437 - server - INFO - ğŸ“¨ Full payload: {'data': {'event_type': 'call.recording.saved', 'id': 'b9a78881-ffa2-404f-b4ab-88ac51937212', 'occurred_at': '2025-12-29T21:48:28.103786Z', 'payload': {'call_control_id': 'v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA', 'call_leg_id': '138ebeae-e500-11f0-b841-02420aef98a0', 'call_session_id': '138c976e-e500-11f0-86e5-02420aef98a0', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-29T21:48:26.790664Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-29T21:48:26.790664Z', 'recording_id': '698df9a3-844c-4703-9a39-3919b51b2f5d', 'recording_started_at': '2025-12-29T21:48:18.351889Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/138ebeae-e500-11f0-b841-02420aef98a0-1767044897463820.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T214828Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=8e6a37bc92b16bbcba0c9c4ff4578e8514b15b9236591d8c8b5ea3ae14b420bd'}, 'start_time': '2025-12-29T21:48:18.351889Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-29T21:48:28.438874655Z [err]  2025-12-29 21:48:28,437 - server - INFO - ğŸ¯ Event type: call.recording.saved, Call ID: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:28.438879794Z [err]  2025-12-29 21:48:28,437 - server - INFO - ğŸ“¨ ================================================
2025-12-29T21:48:28.438885089Z [err]  2025-12-29 21:48:28,437 - server - INFO - ğŸ™ï¸ Recording saved for call: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:28.440572058Z [err]  2025-12-29 21:48:28,438 - redis_service - INFO - ğŸ“¥ Retrieved call data from Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:28.440581087Z [err]  2025-12-29 21:48:28,438 - server - INFO - ğŸ” Recording check: download_url=True, channels=dual, recording_id=698df9a3-844c-4703-9a39-3919b51b2f5d, call_data=True
2025-12-29T21:48:28.504561003Z [err]  2025-12-29 21:48:28,502 - server - INFO - ğŸ“‡ [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-29T21:48:28.532934925Z [err]  2025-12-29 21:48:28,530 - server - INFO - ğŸ’¾ Saved recording URL and ID to database: 698df9a3-844c-4703-9a39-3919b51b2f5d
2025-12-29T21:48:28.532943694Z [err]  2025-12-29 21:48:28,530 - server - INFO - âœ… Entering dual-channel processing
2025-12-29T21:48:28.532949764Z [err]  2025-12-29 21:48:28,530 - server - INFO - ğŸ“¥ Downloading DUAL-CHANNEL recording...
2025-12-29T21:48:28.596819916Z [err]  2025-12-29 21:48:28,589 - server - INFO - ğŸ“‡ [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-29T21:48:28.596832903Z [err]  2025-12-29 21:48:28,589 - server - INFO - ğŸ“‡ [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-29T21:48:28.596839835Z [err]  2025-12-29 21:48:28,589 - server - INFO - ğŸ“‡ [HANGUP] Agent info keys: None
2025-12-29T21:48:28.596845536Z [err]  2025-12-29 21:48:28,589 - server - INFO - ğŸš€ Triggered QC analysis for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:28.596851958Z [err]  2025-12-29 21:48:28,589 - server - INFO - ğŸ“Š Triggered Campaign QC for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:28.596858239Z [err]  2025-12-29 21:48:28,589 - server - INFO - ğŸ“‡ Triggered CRM update for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:28.596863156Z [err]  2025-12-29 21:48:28,590 - server - INFO - âœ… Closed persistent TTS session for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:28.596870549Z [inf]  100.64.0.18:49826 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:48:28.596882716Z [err]  2025-12-29 21:48:28,592 - redis_service - INFO - ğŸ§¹ Deleted call data from Redis: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:28.596888949Z [err]  2025-12-29 21:48:28,592 - server - INFO - ğŸ§¹ Cleaned up call session from Redis and memory: v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:28.596895307Z [err]  2025-12-29 21:48:28,592 - server - INFO - ğŸ” Starting QC analysis for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:28.596901816Z [err]  2025-12-29 21:48:28,592 - server - INFO - ğŸ” [AUTO-QC] Starting campaign QC check for call=v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-29T21:48:28.601572630Z [err]  2025-12-29 21:48:28,593 - server - INFO - ğŸ“‡ CRM update starting for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:48:28.601581447Z [err]  2025-12-29 21:48:28,593 - server - INFO - ğŸ“‡ Normalized phone: +17708336397
2025-12-29T21:48:28.601586381Z [err]  2025-12-29 21:48:28,593 - server - INFO - ğŸ“‡ CRM: Got 11 variables from active session
2025-12-29T21:48:28.684711501Z [err]  2025-12-29 21:48:28,683 - server - INFO - ğŸ“‡ CRM: Got 11 extracted variables
2025-12-29T21:48:28.684717662Z [err]  2025-12-29 21:48:28,683 - server - INFO - ğŸ“‡ CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-29T21:48:28.687371913Z [err]  2025-12-29 21:48:28,685 - server - INFO - ğŸ” [AUTO-QC] Call log found: transcript_turns=3, logs_count=4, status=completed
2025-12-29T21:48:28.687379880Z [err]  2025-12-29 21:48:28,685 - server - INFO - ğŸ“ Converted transcript from 3 messages to 97 characters
2025-12-29T21:48:28.774215641Z [err]  2025-12-29 21:48:28,770 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-29T21:48:28.782590986Z [err]  2025-12-29 21:48:28,779 - server - INFO - ğŸ” [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-29T21:48:28.827016765Z [err]  2025-12-29 21:48:28,821 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-29T21:48:28.827023465Z [err]  2025-12-29 21:48:28,822 - server - INFO - âœ… Post-call webhook sent successfully (status=200)
2025-12-29T21:48:28.855984414Z [err]  2025-12-29 21:48:28,853 - server - INFO - ğŸ“‡ CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-29T21:48:28.858432550Z [err]  2025-12-29 21:48:28,856 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-29T21:48:29.353735575Z [err]  2025-12-29 21:48:28,866 - server - ERROR - âŒ [AUTO-QC] Error in campaign QC for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:48:29.353748078Z [err]  2025-12-29 21:48:28,867 - server - ERROR - âŒ [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-29T21:48:29.353756710Z [err]    File "/app/backend/server.py", line 9773, in trigger_campaign_qc_for_call
2025-12-29T21:48:29.353763923Z [err]      await run_full_qc_analysis(
2025-12-29T21:48:29.353770432Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-29T21:48:29.353777383Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-29T21:48:29.353785501Z [err]  
2025-12-29T21:48:29.353791237Z [err]  2025-12-29 21:48:28,938 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-29/138ebeae-e500-11f0-b841-02420aef98a0-1767044897463820.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251229%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251229T214828Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=8e6a37bc92b16bbcba0c9c4ff4578e8514b15b9236591d8c8b5ea3ae14b420bd "HTTP/1.1 200 OK"
2025-12-29T21:48:29.353797243Z [err]  2025-12-29 21:48:28,942 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-29T21:48:29.353803296Z [err]  2025-12-29 21:48:28,942 - qc_agents.orchestrator - INFO - âœ… Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-29T21:48:29.353839409Z [err]  2025-12-29 21:48:28,866 - server - INFO - ğŸ“Š [AUTO-QC] Running full QC analysis: call=v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA â†’ campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-29T21:48:29.353844906Z [err]  2025-12-29 21:48:28,866 - server - INFO - ğŸ“Š [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-29T21:48:29.355033269Z [err]  2025-12-29 21:48:28,942 - qc_agents.orchestrator - INFO - ğŸ” Running Commitment Detector on call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:29.355037998Z [err]  2025-12-29 21:48:29,029 - server - INFO - âœ… Downloaded 33897 bytes
2025-12-29T21:48:29.355045530Z [err]  2025-12-29 21:48:29,219 - server - INFO - âœ… Split into 2 channels
2025-12-29T21:48:29.355050260Z [err]  2025-12-29 21:48:29,219 - server - INFO - ğŸ¤ Using STT provider: soniox for interruption detection
2025-12-29T21:48:29.355055711Z [err]  2025-12-29 21:48:29,219 - server - INFO - ğŸ“Š Channel 0: 183084 bytes
2025-12-29T21:48:29.355063002Z [err]  2025-12-29 21:48:29,219 - server - ERROR - âŒ No Soniox API key available
2025-12-29T21:48:29.355069340Z [err]  2025-12-29 21:48:29,219 - server - INFO - âŒ Channel 0: No speech
2025-12-29T21:48:29.355075629Z [err]  2025-12-29 21:48:29,219 - server - INFO - ğŸ“Š Channel 1: 183084 bytes
2025-12-29T21:48:29.355081564Z [err]  2025-12-29 21:48:29,219 - server - ERROR - âŒ No Soniox API key available
2025-12-29T21:48:29.355090205Z [err]  2025-12-29 21:48:29,219 - server - INFO - âŒ Channel 1: No speech
2025-12-29T21:48:29.355096657Z [err]  2025-12-29 21:48:29,219 - server - WARNING - âš ï¸ No speech in any channel
2025-12-29T21:48:29.355104244Z [inf]  100.64.0.8:44438 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-29T21:48:29.355111251Z [err]  2025-12-29 21:48:29,220 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:48:29.355117168Z [err]  2025-12-29 21:48:29,223 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:48:29.355121563Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:48:29.355127987Z [err]  2025-12-29 21:48:29,223 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:48:29.356538097Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:48:29.356543988Z [err]  2025-12-29 21:48:29,224 - qc_agents.orchestrator - INFO - ğŸ—ºï¸  Running Conversion Pathfinder on call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:29.404734121Z [err]  2025-12-29 21:48:29,402 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:48:29.407389701Z [err]  2025-12-29 21:48:29,403 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:48:29.407399537Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:48:29.407405653Z [err]  2025-12-29 21:48:29,403 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:48:29.407413212Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-29T21:48:29.407420316Z [err]  2025-12-29 21:48:29,403 - qc_agents.orchestrator - INFO - â­ Running Excellence Replicator on call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:29.583700143Z [err]  2025-12-29 21:48:29,579 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-29T21:48:29.583720199Z [err]  2025-12-29 21:48:29,579 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:48:29.583738645Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:48:29.583747686Z [err]  2025-12-29 21:48:29,579 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-29T21:48:29.583756509Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-29T21:48:29.673660330Z [err]  2025-12-29 21:48:29,670 - qc_agents.orchestrator - INFO - âœ… QC analysis stored for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:29.673666511Z [err]  2025-12-29 21:48:29,670 - server - INFO - âœ… QC analysis completed for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:29.673671292Z [err]  2025-12-29 21:48:29,670 - server - INFO - ğŸ“Š Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-29T21:48:29.719148669Z [err]  2025-12-29 21:48:29,712 - elevenlabs_ws_service - WARNING - âš ï¸  [TIMING] ElevenLabs timeout waiting for first chunk (2.5s) - No audio received!
2025-12-29T21:48:29.719155282Z [err]  2025-12-29 21:48:29,712 - persistent_tts_service - WARNING - âš ï¸ [Call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA] Receiver got 0 chunks for sentence #3! interrupted=False
2025-12-29T21:48:29.853404601Z [err]  2025-12-29 21:48:29,850 - server - INFO - ğŸ“Š Updated campaign_calls with QC scores for v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:30.463962026Z [err]  2025-12-29 21:48:29,876 - server - INFO - ğŸ¤ Soniox receiver alive - 13 messages received in last 10s
2025-12-29T21:48:30.463967787Z [err]  2025-12-29 21:48:29,876 - server - ERROR - âŒ Soniox error: {'tokens': [], 'final_audio_proc_ms': 4440, 'total_audio_proc_ms': 9960, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-29T21:48:30.463976039Z [err]  2025-12-29 21:48:29,876 - server - INFO - âœ… Soniox receive loop ended normally
2025-12-29T21:48:30.463981871Z [err]  2025-12-29 21:48:29,876 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring cancelled for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:30.463988808Z [err]  2025-12-29 21:48:29,876 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring stopped for call v3:nR6TC02pcaq5ZFHTpwdhq3mSXT0hL5Wg1Ah9QTgVLgQI8zp8nKvR9Q
2025-12-29T21:48:30.463997305Z [err]  2025-12-29 21:48:29,876 - server - INFO - ğŸ”‡ Dead air monitoring task cancelled
2025-12-29T21:48:30.464003559Z [err]  2025-12-29 21:48:30,023 - server - INFO - ğŸ“ˆ Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-29T21:48:30.464009893Z [err]  2025-12-29 21:48:30,035 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=4.0s, checkin_count=0/2
2025-12-29T21:48:30.464016404Z [err]  2025-12-29 21:48:30,109 - server - INFO - ğŸ·ï¸ Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-29T21:48:30.464023981Z [err]  2025-12-29 21:48:30,109 - server - ERROR - âŒ Error in auto appointment detection for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA: 'str' object has no attribute 'get'
2025-12-29T21:48:30.544952209Z [err]  2025-12-29 21:48:30,537 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=4.5s, checkin_count=0/2
2025-12-29T21:48:32.421800452Z [err]  2025-12-29 21:48:31,878 - soniox_service - ERROR - âŒ Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-29T21:48:32.421806219Z [err]  2025-12-29 21:48:31,878 - server - INFO - ğŸ”Œ Telnyx WebSocket disconnected
2025-12-29T21:48:33.439434983Z [err]  2025-12-29 21:48:33,043 - core_calling_service - INFO - â° Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-29T21:48:33.439441675Z [err]  2025-12-29 21:48:33,044 - core_calling_service - INFO - ğŸ’¬ Sending check-in #1/2: Are you still there?
2025-12-29T21:48:33.439448159Z [err]  2025-12-29 21:48:33,044 - dead_air_monitor - INFO - ğŸ’¬ Sending check-in after 7.0s silence: Are you still there?
2025-12-29T21:48:33.439455457Z [err]  2025-12-29 21:48:33,044 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:33.439461443Z [err]  2025-12-29 21:48:33,044 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA: Are you still there?...
2025-12-29T21:48:33.439468568Z [err]  2025-12-29 21:48:33,044 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-29T21:48:33.439479369Z [err]  2025-12-29 21:48:33,044 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-29T21:48:33.439485599Z [err]  2025-12-29 21:48:33,044 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-29T21:48:33.439492505Z [err]  2025-12-29 21:48:33,044 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-29T21:48:33.439502256Z [err]  2025-12-29 21:48:33,044 - server - INFO - ğŸ’¾ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-29T21:48:33.439508578Z [err]  2025-12-29 21:48:33,044 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.00s
2025-12-29T21:48:33.439514462Z [err]  2025-12-29 21:48:33,045 - telnyx_service - INFO - âœ… Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:48:33.439520180Z [err]  2025-12-29 21:48:33,045 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:48:33.439525644Z [err]  2025-12-29 21:48:33,239 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:48:33.444091914Z [err]  2025-12-29 21:48:33,239 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.19s
2025-12-29T21:48:33.444098284Z [err]  2025-12-29 21:48:33,239 - telnyx_service - ERROR - âŒ Telnyx playback failed: 422 - {
2025-12-29T21:48:33.444107516Z [err]    "errors": [
2025-12-29T21:48:33.444116205Z [err]      {
2025-12-29T21:48:33.444122718Z [err]        "code": "90018",
2025-12-29T21:48:33.444129006Z [err]        "title": "Call has already ended",
2025-12-29T21:48:33.444135745Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:48:33.444143006Z [err]      }
2025-12-29T21:48:33.444150153Z [err]    ]
2025-12-29T21:48:33.444156327Z [err]  }
2025-12-29T21:48:33.444162995Z [err]  2025-12-29 21:48:33,240 - telnyx_service - INFO - ğŸ“¢ Using Telnyx built-in TTS
2025-12-29T21:48:33.454252533Z [err]  2025-12-29 21:48:33,449 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:48:33.454259487Z [err]  2025-12-29 21:48:33,450 - telnyx_service - ERROR - âŒ Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:48:33.454263803Z [err]  2025-12-29 21:48:33,450 - dead_air_monitor - INFO - âœ… Check-in message sent
2025-12-29T21:48:34.445459586Z [err]  2025-12-29 21:48:33,952 - core_calling_service - INFO - ğŸ¤– Agent stopped speaking for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:34.445536646Z [err]  2025-12-29 21:48:33,951 - dead_air_monitor - INFO - ğŸš© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-29T21:48:34.445542672Z [err]  2025-12-29 21:48:33,952 - core_calling_service - INFO - â±ï¸ SILENCE TIMER STARTED at 1767044913.952019 for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:40.485051425Z [err]  2025-12-29 21:48:40,469 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=6.5s, checkin_count=1/2
2025-12-29T21:48:41.367906118Z [err]  2025-12-29 21:48:40,972 - telnyx_service - INFO - âœ… Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:48:41.367974875Z [err]  2025-12-29 21:48:40,971 - dead_air_monitor - INFO - ğŸ” MONITOR: agent_speaking=False, user_speaking=False, silence=7.0s, checkin_count=1/2
2025-12-29T21:48:41.367980357Z [err]  2025-12-29 21:48:40,971 - core_calling_service - INFO - â° Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-29T21:48:41.367986642Z [err]  2025-12-29 21:48:40,972 - core_calling_service - INFO - ğŸ’¬ Sending FINAL check-in #2/2: Are you still there?
2025-12-29T21:48:41.367991419Z [err]  2025-12-29 21:48:40,972 - core_calling_service - INFO - âš ï¸ Will end call if no response after next silence timeout
2025-12-29T21:48:41.367996338Z [err]  2025-12-29 21:48:40,972 - dead_air_monitor - INFO - ğŸ’¬ Sending check-in after 7.0s silence: Are you still there?
2025-12-29T21:48:41.368001664Z [err]  2025-12-29 21:48:40,972 - core_calling_service - INFO - ğŸ¤– Agent started speaking for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:41.368006717Z [err]  2025-12-29 21:48:40,972 - telnyx_service - INFO - ğŸ”Š Speaking text on call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA: Are you still there?...
2025-12-29T21:48:41.368011859Z [err]  2025-12-29 21:48:40,972 - telnyx_service - INFO - ğŸ” Agent config provided: True
2025-12-29T21:48:41.368016893Z [err]  2025-12-29 21:48:40,972 - telnyx_service - INFO - ğŸ” TTS provider from settings: elevenlabs
2025-12-29T21:48:41.368022233Z [err]  2025-12-29 21:48:40,972 - telnyx_service - INFO - ğŸ” WebSocket TTS: False
2025-12-29T21:48:41.368026860Z [err]  2025-12-29 21:48:40,972 - telnyx_service - INFO - ğŸ™ï¸ Attempting elevenlabs TTS (REST)
2025-12-29T21:48:41.368033785Z [err]  2025-12-29 21:48:40,972 - server - INFO - ğŸ’¾ TTS CACHE HIT: Returning cached audio (17599 bytes)
2025-12-29T21:48:41.368039293Z [err]  2025-12-29 21:48:40,972 - telnyx_service - INFO - â±ï¸  TTS generation time: 0.00s
2025-12-29T21:48:41.371660746Z [err]  }
2025-12-29T21:48:41.371673364Z [err]  2025-12-29 21:48:41,262 - telnyx_service - INFO - ğŸ“¢ Using Telnyx built-in TTS
2025-12-29T21:48:41.371864435Z [err]  2025-12-29 21:48:40,972 - telnyx_service - INFO - ğŸ”— Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-29T21:48:41.371870450Z [err]  2025-12-29 21:48:41,260 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:48:41.371878179Z [err]  2025-12-29 21:48:41,261 - telnyx_service - INFO - â±ï¸  Playback API call time: 0.29s
2025-12-29T21:48:41.371883359Z [err]  2025-12-29 21:48:41,261 - telnyx_service - ERROR - âŒ Telnyx playback failed: 422 - {
2025-12-29T21:48:41.371888970Z [err]    "errors": [
2025-12-29T21:48:41.371895484Z [err]      {
2025-12-29T21:48:41.371901304Z [err]        "code": "90018",
2025-12-29T21:48:41.371907074Z [err]        "title": "Call has already ended",
2025-12-29T21:48:41.371913115Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-29T21:48:41.371918519Z [err]      }
2025-12-29T21:48:41.371923988Z [err]    ]
2025-12-29T21:48:41.466429613Z [err]  2025-12-29 21:48:41,460 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-29T21:48:41.466440097Z [err]  2025-12-29 21:48:41,461 - telnyx_service - ERROR - âŒ Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-29T21:48:41.466445512Z [err]  2025-12-29 21:48:41,461 - dead_air_monitor - INFO - âœ… Check-in message sent
2025-12-29T21:48:47.406082654Z [err]  2025-12-29 21:48:47,042 - server - INFO - ğŸ¤ Soniox receiver alive - 12 messages received in last 10s
2025-12-29T21:48:47.406088159Z [err]  2025-12-29 21:48:47,042 - server - ERROR - âŒ Soniox error: {'tokens': [], 'final_audio_proc_ms': 4680, 'total_audio_proc_ms': 9120, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-29T21:48:47.406093136Z [err]  2025-12-29 21:48:47,042 - server - INFO - âœ… Soniox receive loop ended normally
2025-12-29T21:48:47.406097782Z [err]  2025-12-29 21:48:47,042 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring cancelled for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:47.406102579Z [err]  2025-12-29 21:48:47,042 - dead_air_monitor - INFO - ğŸ”‡ Dead air monitoring stopped for call v3:wiWoWdu8nZPh-hUfUvNr6hfsZI4e_pxp66nxOpsPNWWGAwM_GhopUA
2025-12-29T21:48:47.406106809Z [err]  2025-12-29 21:48:47,042 - server - INFO - ğŸ”‡ Dead air monitoring task cancelled
2025-12-29T21:48:49.389909286Z [err]  2025-12-29 21:48:49,044 - soniox_service - ERROR - âŒ Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-29T21:48:49.389916622Z [err]  2025-12-29 21:48:49,045 - server - INFO - ğŸ”Œ Telnyx WebSocket disconnected