2025-12-30T04:43:38.000000000Z [inf]  Starting Container
2025-12-30T04:43:39.218250414Z [inf]  =========================================
2025-12-30T04:43:39.218258293Z [inf]  üöÄ START.SH SCRIPT IS EXECUTING
2025-12-30T04:43:39.218263816Z [inf]  =========================================
2025-12-30T04:43:39.218268834Z [inf]  üìç Working directory: /app/backend
2025-12-30T04:43:39.218276548Z [inf]  üîç Python path: /app/backend
2025-12-30T04:43:39.218283535Z [inf]  üåê Starting Gunicorn on 0.0.0.0:8080...
2025-12-30T04:43:39.218290266Z [inf]  =========================================
2025-12-30T04:43:39.480311085Z [err]  [2025-12-30 04:43:39 +0000] [1] [INFO] Starting gunicorn 22.0.0
2025-12-30T04:43:39.480328034Z [err]  [2025-12-30 04:43:39 +0000] [1] [INFO] Listening at: http://0.0.0.0:8080 (1)
2025-12-30T04:43:39.480340470Z [err]  [2025-12-30 04:43:39 +0000] [1] [INFO] Using worker: uvicorn.workers.UvicornWorker
2025-12-30T04:43:39.481049572Z [err]  [2025-12-30 04:43:39 +0000] [3] [INFO] Booting worker with pid: 3
2025-12-30T04:43:39.524182404Z [err]  [2025-12-30 04:43:39 +0000] [4] [INFO] Booting worker with pid: 4
2025-12-30T04:43:39.565696966Z [err]  [2025-12-30 04:43:39 +0000] [5] [INFO] Booting worker with pid: 5
2025-12-30T04:43:39.565702509Z [err]  [2025-12-30 04:43:39 +0000] [6] [INFO] Booting worker with pid: 6
2025-12-30T04:43:59.566004829Z [err]  2025-12-30 04:43:53,019 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-30T04:43:59.566015096Z [err]  2025-12-30 04:43:53,020 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-30T04:43:59.566020739Z [err]  2025-12-30 04:43:53,185 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-30T04:43:59.566025975Z [err]  2025-12-30 04:43:53,199 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-30T04:43:59.566046019Z [err]  2025-12-30 04:43:52,900 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-30T04:43:59.566050282Z [err]  2025-12-30 04:43:52,900 - server - INFO - üî• Pre-warming connection libraries...
2025-12-30T04:43:59.566054035Z [err]  2025-12-30 04:43:52,903 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-30T04:43:59.566057829Z [err]  2025-12-30 04:43:52,903 - server - INFO - üî• Pre-warming connection libraries...
2025-12-30T04:43:59.566061460Z [err]  2025-12-30 04:43:52,908 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-30T04:43:59.566065866Z [err]  2025-12-30 04:43:52,908 - server - INFO - üî• Pre-warming connection libraries...
2025-12-30T04:43:59.566070869Z [err]  2025-12-30 04:43:52,932 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-30T04:43:59.566076731Z [err]  2025-12-30 04:43:52,953 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-30T04:43:59.566082528Z [err]  2025-12-30 04:43:52,953 - server - INFO - üî• Pre-warming connection libraries...
2025-12-30T04:43:59.566088338Z [err]  2025-12-30 04:43:52,975 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-30T04:43:59.566891289Z [err]  2025-12-30 04:43:53,339 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-30T04:43:59.566895449Z [err]  2025-12-30 04:43:53,612 - server - INFO - ‚úÖ QC test router loaded
2025-12-30T04:43:59.566898093Z [err]  2025-12-30 04:43:53,368 - server - INFO - ‚úÖ QC agent router loaded
2025-12-30T04:43:59.566903373Z [err]  2025-12-30 04:43:53,368 - server - INFO - ‚úÖ QC agent router loaded
2025-12-30T04:43:59.566908265Z [err]  2025-12-30 04:43:53,368 - server - INFO - ‚úÖ QC agent router loaded
2025-12-30T04:43:59.566908989Z [err]  2025-12-30 04:43:53,403 - server - INFO - ‚úÖ QC learning router loaded
2025-12-30T04:43:59.566913131Z [err]  2025-12-30 04:43:53,373 - server - INFO - ‚úÖ QC agent router loaded
2025-12-30T04:43:59.566918369Z [err]  2025-12-30 04:43:53,398 - server - INFO - ‚úÖ QC learning router loaded
2025-12-30T04:43:59.566919529Z [err]  2025-12-30 04:43:53,413 - server - INFO - ‚úÖ QC learning router loaded
2025-12-30T04:43:59.566927689Z [err]  2025-12-30 04:43:53,425 - server - INFO - ‚úÖ QC learning router loaded
2025-12-30T04:43:59.566931383Z [err]  2025-12-30 04:43:53,203 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-30T04:43:59.566936156Z [err]  2025-12-30 04:43:53,591 - server - INFO - ‚úÖ CRM router loaded
2025-12-30T04:43:59.566939488Z [err]  2025-12-30 04:43:53,225 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-30T04:43:59.566943188Z [err]  2025-12-30 04:43:53,595 - server - INFO - ‚úÖ CRM router loaded
2025-12-30T04:43:59.566947040Z [err]  2025-12-30 04:43:53,282 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-30T04:43:59.566950431Z [err]  2025-12-30 04:43:53,595 - server - INFO - ‚úÖ CRM router loaded
2025-12-30T04:43:59.566953479Z [err]  2025-12-30 04:43:53,291 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-30T04:43:59.566959685Z [err]  2025-12-30 04:43:53,330 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-30T04:43:59.567836247Z [err]  [2025-12-30 04:43:53 +0000] [6] [INFO] Started server process [6]
2025-12-30T04:43:59.567842453Z [err]  [2025-12-30 04:43:53 +0000] [6] [INFO] Waiting for application startup.
2025-12-30T04:43:59.567843521Z [err]  2025-12-30 04:43:53,706 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-30T04:43:59.567843713Z [err]  2025-12-30 04:43:53,637 - server - INFO - ‚úÖ CRM router loaded
2025-12-30T04:43:59.567853686Z [err]  2025-12-30 04:43:53,706 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-30T04:43:59.567853821Z [err]  2025-12-30 04:43:53,697 - server - INFO - ‚úÖ Agent test router loaded
2025-12-30T04:43:59.567860559Z [err]  2025-12-30 04:43:53,698 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-30T04:43:59.567863281Z [err]  [2025-12-30 04:43:53 +0000] [5] [INFO] Started server process [5]
2025-12-30T04:43:59.567867229Z [err]  2025-12-30 04:43:53,698 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-30T04:43:59.567872681Z [err]  [2025-12-30 04:43:53 +0000] [5] [INFO] Waiting for application startup.
2025-12-30T04:43:59.567873475Z [err]  2025-12-30 04:43:53,706 - server - INFO - ‚úÖ Agent test router loaded
2025-12-30T04:43:59.567906011Z [err]  2025-12-30 04:43:53,640 - server - INFO - ‚úÖ QC test router loaded
2025-12-30T04:43:59.567914925Z [err]  2025-12-30 04:43:53,644 - server - INFO - ‚úÖ QC test router loaded
2025-12-30T04:43:59.567922003Z [err]  2025-12-30 04:43:53,645 - server - INFO - ‚úÖ QC test router loaded
2025-12-30T04:43:59.567928604Z [err]  2025-12-30 04:43:53,659 - server - INFO - ‚úÖ Agent test router loaded
2025-12-30T04:43:59.567935674Z [err]  2025-12-30 04:43:53,692 - server - INFO - ‚úÖ Agent test router loaded
2025-12-30T04:43:59.567943821Z [err]  2025-12-30 04:43:53,696 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-30T04:43:59.567950426Z [err]  2025-12-30 04:43:53,696 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-30T04:43:59.568685989Z [err]  2025-12-30 04:43:53,715 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-30T04:43:59.568692621Z [err]  2025-12-30 04:43:53,715 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-30T04:43:59.568696828Z [err]  2025-12-30 04:43:53,722 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-30T04:43:59.568700758Z [err]  2025-12-30 04:43:53,723 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-30T04:43:59.568704913Z [err]  [2025-12-30 04:43:53 +0000] [3] [INFO] Started server process [3]
2025-12-30T04:43:59.568708807Z [err]  [2025-12-30 04:43:53 +0000] [3] [INFO] Waiting for application startup.
2025-12-30T04:43:59.568712386Z [err]  2025-12-30 04:43:53,733 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-30T04:43:59.568716232Z [err]  [2025-12-30 04:43:53 +0000] [4] [INFO] Started server process [4]
2025-12-30T04:43:59.568720071Z [err]  [2025-12-30 04:43:53 +0000] [4] [INFO] Waiting for application startup.
2025-12-30T04:43:59.568723793Z [err]  2025-12-30 04:43:53,737 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-30T04:44:01.065350204Z [err]  2025-12-30 04:44:01,048 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-30T04:44:01.065357318Z [err]  2025-12-30 04:44:01,051 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-30T04:44:01.065365237Z [err]  2025-12-30 04:44:01,051 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-30T04:44:01.065371983Z [err]  2025-12-30 04:44:01,051 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-30T04:44:01.141143834Z [err]  2025-12-30 04:44:01,135 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-30T04:44:01.141151189Z [err]  2025-12-30 04:44:01,139 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-30T04:44:01.141158545Z [err]  2025-12-30 04:44:01,139 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-30T04:44:01.141164989Z [err]  2025-12-30 04:44:01,139 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-30T04:44:01.168716444Z [err]  2025-12-30 04:44:01,165 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-30T04:44:01.169772854Z [err]  2025-12-30 04:44:01,168 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-30T04:44:01.169783159Z [err]  2025-12-30 04:44:01,168 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-30T04:44:01.169792296Z [err]  2025-12-30 04:44:01,168 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-30T04:44:01.190923365Z [err]  2025-12-30 04:44:01,185 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-30T04:44:01.190930342Z [err]  2025-12-30 04:44:01,188 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-30T04:44:01.190935214Z [err]  2025-12-30 04:44:01,188 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-30T04:44:01.190939219Z [err]  2025-12-30 04:44:01,188 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-30T04:44:01.756039547Z [err]  2025-12-30 04:44:01,729 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-30T04:44:01.843443987Z [err]  2025-12-30 04:44:01,816 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-30T04:44:01.843454854Z [err]  2025-12-30 04:44:01,816 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-30T04:44:01.843466721Z [err]  [2025-12-30 04:44:01 +0000] [4] [INFO] Application startup complete.
2025-12-30T04:44:01.861059250Z [err]  2025-12-30 04:44:01,856 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-30T04:44:01.883020659Z [err]  2025-12-30 04:44:01,872 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-30T04:44:01.915514370Z [err]  2025-12-30 04:44:01,909 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-30T04:44:01.937235011Z [err]  2025-12-30 04:44:01,932 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-30T04:44:01.937242113Z [err]  2025-12-30 04:44:01,933 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-30T04:44:01.937249706Z [err]  [2025-12-30 04:44:01 +0000] [5] [INFO] Application startup complete.
2025-12-30T04:44:01.951384766Z [err]  2025-12-30 04:44:01,950 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-30T04:44:01.951393145Z [err]  2025-12-30 04:44:01,950 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-30T04:44:01.951399672Z [err]  [2025-12-30 04:44:01 +0000] [3] [INFO] Application startup complete.
2025-12-30T04:44:01.997021903Z [err]  2025-12-30 04:44:01,992 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-30T04:44:01.997027291Z [err]  2025-12-30 04:44:01,992 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-30T04:44:01.997032272Z [err]  [2025-12-30 04:44:01 +0000] [6] [INFO] Application startup complete.
2025-12-30T06:01:37.772190736Z [inf]  100.64.0.2:13174 - "POST /api/auth/logout HTTP/1.1" 401
2025-12-30T06:01:37.772198192Z [inf]  100.64.0.3:17170 - "OPTIONS /api/auth/login HTTP/1.1" 200
2025-12-30T06:01:38.757183624Z [inf]  100.64.0.2:13174 - "POST /api/auth/login HTTP/1.1" 200
2025-12-30T06:01:39.581442914Z [inf]  100.64.0.2:13174 - "GET /api/agents HTTP/1.1" 200
2025-12-30T06:01:42.584593070Z [inf]  100.64.0.2:13174 - "GET /api/agents HTTP/1.1" 200
2025-12-30T06:02:02.578128970Z [inf]  100.64.0.3:17170 - "OPTIONS /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-30T06:02:02.578134539Z [err]  2025-12-30 06:01:59,151 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-30T06:02:02.578138983Z [err]  2025-12-30 06:01:59,241 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:02:02.578143579Z [err]  2025-12-30 06:01:59,327 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:02:02.578148408Z [err]  2025-12-30 06:01:59,351 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:02:02.578152833Z [err]  2025-12-30 06:01:59,351 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-30T06:02:02.578158933Z [err]  2025-12-30 06:01:59,351 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-30T06:02:02.578163047Z [err]  2025-12-30 06:01:59,351 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-30T06:02:02.578167318Z [err]  2025-12-30 06:02:00,341 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-30T06:02:02.578171028Z [err]  2025-12-30 06:02:00,344 - telnyx_service - INFO - ‚úÖ Call initiated: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:02.578175097Z [err]  2025-12-30 06:02:00,447 - server - INFO - üìù Created call log: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:02.578179858Z [err]  2025-12-30 06:02:00,447 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T06:02:02.578183963Z [err]  2025-12-30 06:02:00,447 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-30T06:02:02.578957647Z [err]  2025-12-30 06:02:00,678 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'PJ50dIN+oOyFxZCJPc9z0w==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'avmJGcoUQgGjIH4UxtoGcA', 'x-real-ip': '192.76.120.151', 'x-request-start': '1767074520448', 'accept-encoding': 'gzip'}
2025-12-30T06:02:02.578960480Z [err]  2025-12-30 06:02:00,447 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T06:02:02.578964437Z [err]  2025-12-30 06:02:00,678 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-30T06:02:02.578968307Z [err]  2025-12-30 06:02:00,447 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T06:02:02.578970246Z [err]  2025-12-30 06:02:00,678 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-30T06:02:02.578973714Z [err]  2025-12-30 06:02:00,487 - redis_service - INFO - üì¶ Stored call data in Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg (TTL: 3600s)
2025-12-30T06:02:02.578977920Z [err]  2025-12-30 06:02:00,487 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-30T06:02:02.578982187Z [err]  2025-12-30 06:02:00,487 - server - INFO - üìû Outbound call initiated: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:02.578986960Z [inf]  100.64.0.3:17170 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-30T06:02:02.578991489Z [err]  2025-12-30 06:02:00,678 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-30T06:02:02.578995444Z [err]  2025-12-30 06:02:00,678 - server - INFO -    Client: Address(host='100.64.0.4', port=52954)
2025-12-30T06:02:02.580047662Z [err]  [2025-12-30 06:02:00 +0000] [6] [INFO] ('100.64.0.4', 52954) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-30T06:02:02.580058225Z [err]  2025-12-30 06:02:00,679 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-30T06:02:02.580064239Z [err]  [2025-12-30 06:02:00 +0000] [6] [INFO] connection open
2025-12-30T06:02:02.580068986Z [err]  2025-12-30 06:02:00,724 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:02:02.580073406Z [err]  2025-12-30 06:02:00,724 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': '43f8f8ac-dae7-4585-ba54-c330343532fb', 'occurred_at': '2025-12-30T06:02:00.151047Z', 'payload': {'call_control_id': 'v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg', 'call_leg_id': '0e01872e-e545-11f0-90d3-02420aef93a0', 'call_session_id': '0dfe1760-e545-11f0-b8d6-02420aef93a0', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:02:02.580078508Z [err]  2025-12-30 06:02:00,724 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:02.580082860Z [err]  2025-12-30 06:02:00,724 - server - INFO - üì® ================================================
2025-12-30T06:02:02.580087090Z [err]  2025-12-30 06:02:00,725 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-30T06:02:02.580090848Z [inf]  100.64.0.5:34526 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:02:02.580094864Z [err]  2025-12-30 06:02:00,835 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-30T06:02:02.580100854Z [err]  2025-12-30 06:02:00,836 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-30T06:02:02.580702172Z [err]  2025-12-30 06:02:01,051 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T06:02:02.580709674Z [err]  2025-12-30 06:02:01,051 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-30T06:02:07.240950229Z [err]  2025-12-30 06:02:07,233 - server - INFO - üì¨ Received Telnyx event: start
2025-12-30T06:02:07.240954179Z [err]  2025-12-30 06:02:07,233 - server - INFO - üé¨ Stream started for call: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:07.269017748Z [err]  2025-12-30 06:02:07,265 - redis_service - INFO - üì• Retrieved call data from Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:07.269024206Z [err]  2025-12-30 06:02:07,267 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-30T06:02:07.269028258Z [err]  2025-12-30 06:02:07,267 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-30T06:02:07.565581544Z [err]  2025-12-30 06:02:07,559 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:02:07.565587995Z [err]  2025-12-30 06:02:07,559 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': '23e47960-1087-403a-b548-639bb119737f', 'occurred_at': '2025-12-30T06:02:06.991051Z', 'payload': {'call_control_id': 'v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg', 'call_leg_id': '0e01872e-e545-11f0-90d3-02420aef93a0', 'call_session_id': '0dfe1760-e545-11f0-b8d6-02420aef93a0', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-30T06:02:00.151047Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:02:07.565594638Z [err]  2025-12-30 06:02:07,559 - server - INFO - üéØ Event type: call.answered, Call ID: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:07.565601120Z [err]  2025-12-30 06:02:07,560 - server - INFO - üì® ================================================
2025-12-30T06:02:07.565607720Z [err]  2025-12-30 06:02:07,560 - server - INFO - ‚úÖ Call answered: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:07.600294141Z [err]  2025-12-30 06:02:07,597 - redis_service - INFO - üì• Retrieved call data from Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:07.600299995Z [err]  2025-12-30 06:02:07,598 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-30T06:02:07.600304362Z [err]  2025-12-30 06:02:07,598 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-30T06:02:07.866123656Z [err]  2025-12-30 06:02:07,828 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:02:07.866129675Z [err]  2025-12-30 06:02:07,829 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': '472598cd-0c23-434d-bfd2-a60d46434d54', 'occurred_at': '2025-12-30T06:02:07.471051Z', 'payload': {'call_control_id': 'v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg', 'call_leg_id': '0e01872e-e545-11f0-90d3-02420aef93a0', 'call_session_id': '0dfe1760-e545-11f0-b8d6-02420aef93a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': 'ce61796a-7fb6-417a-9ad0-aa891cc5ac47', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:02:07.866154537Z [err]  2025-12-30 06:02:07,768 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-30T06:02:07.866159327Z [err]  2025-12-30 06:02:07,706 - server - INFO - ‚úÖ Call log updated
2025-12-30T06:02:07.866160220Z [err]  2025-12-30 06:02:07,788 - redis_service - INFO - üì• Retrieved call data from Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:07.866166408Z [err]  2025-12-30 06:02:07,707 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-30T06:02:07.866166519Z [err]  2025-12-30 06:02:07,789 - server - INFO - üìù Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:02:07.866172874Z [err]  2025-12-30 06:02:07,789 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-30T06:02:07.866174452Z [err]  2025-12-30 06:02:07,707 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T06:02:07.866179352Z [err]  2025-12-30 06:02:07,797 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:02:07.866183114Z [err]  2025-12-30 06:02:07,707 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:02:07.866188993Z [err]  2025-12-30 06:02:07,768 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-30T06:02:07.866979669Z [err]  2025-12-30 06:02:07,829 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:07.866987252Z [err]  2025-12-30 06:02:07,829 - server - INFO - üì® ================================================
2025-12-30T06:02:07.866996242Z [inf]  100.64.0.5:34530 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:02:07.889901870Z [err]  2025-12-30 06:02:07,886 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:02:07.889907548Z [err]  2025-12-30 06:02:07,886 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-30T06:02:07.889912570Z [err]  2025-12-30 06:02:07,889 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-30T06:02:07.889916720Z [err]  2025-12-30 06:02:07,889 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-30T06:02:07.907779155Z [err]  2025-12-30 06:02:07,906 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-30T06:02:07.907783741Z [err]  2025-12-30 06:02:07,906 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-30T06:02:07.908514587Z [err]  2025-12-30 06:02:07,907 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-30T06:02:07.913965872Z [err]  2025-12-30 06:02:07,911 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:02:07.995015099Z [err]  2025-12-30 06:02:07,993 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:02:08.006075738Z [err]  2025-12-30 06:02:08,005 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 97ms
2025-12-30T06:02:08.006082258Z [err]  2025-12-30 06:02:08,005 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-30T06:02:08.006087421Z [err]  2025-12-30 06:02:08,005 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-30T06:02:08.006966542Z [err]  2025-12-30 06:02:08,005 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-30T06:02:08.006974717Z [err]  2025-12-30 06:02:08,005 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-30T06:02:08.007871670Z [err]  2025-12-30 06:02:08,007 - server - INFO - ‚úÖ Initialized call_states for v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg with session reference
2025-12-30T06:02:08.007878808Z [err]  2025-12-30 06:02:08,007 - server - INFO - ‚úÖ Stored Telnyx WebSocket in call_data for audio streaming
2025-12-30T06:02:08.008630146Z [err]  2025-12-30 06:02:08,007 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found to update for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:08.013941302Z [err]  2025-12-30 06:02:08,008 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-30T06:02:08.107269036Z [err]  2025-12-30 06:02:08,098 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-30T06:02:08.107273614Z [err]  2025-12-30 06:02:08,104 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T06:02:08.107277718Z [err]  2025-12-30 06:02:08,104 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-30T06:02:08.202419345Z [err]  2025-12-30 06:02:08,200 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg/actions/playback_start "HTTP/1.1 200 OK"
2025-12-30T06:02:08.202425191Z [err]  2025-12-30 06:02:08,201 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: RY71G7UPiQ (loop=True, overlay=True)
2025-12-30T06:02:08.202430866Z [err]  2025-12-30 06:02:08,201 - server - WARNING - ‚ö†Ô∏è Failed to start comfort noise: 'v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg'
2025-12-30T06:02:08.202434621Z [err]  2025-12-30 06:02:08,201 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:08.600298452Z [err]  2025-12-30 06:02:08,597 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-30T06:02:08.600302456Z [err]  2025-12-30 06:02:08,598 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-30T06:02:08.600306276Z [err]  2025-12-30 06:02:08,598 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-30T06:02:08.639631350Z [err]  2025-12-30 06:02:08,632 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:02:08.639692856Z [err]  2025-12-30 06:02:08,633 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:08.641318843Z [err]  2025-12-30 06:02:08,639 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:08.641325789Z [err]  2025-12-30 06:02:08,640 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-30T06:02:09.150621676Z [err]  2025-12-30 06:02:09,147 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:09.497618884Z [inf]  100.64.0.7:49402 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-30T06:02:09.658031212Z [err]  2025-12-30 06:02:09,653 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:09.664165098Z [err]  2025-12-30 06:02:09,661 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg/actions/record_start "HTTP/1.1 200 OK"
2025-12-30T06:02:09.664173569Z [err]  2025-12-30 06:02:09,663 - server - INFO - üéôÔ∏è Call recording started for v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:09.664180884Z [err]  2025-12-30 06:02:09,663 - server - INFO - üîß Creating call session for v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg...
2025-12-30T06:02:09.664187595Z [err]  2025-12-30 06:02:09,663 - server - INFO - üîç Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:02:09.664193753Z [err]  2025-12-30 06:02:09,663 - server - INFO - üîß Calling create_call_session() - START
2025-12-30T06:02:09.664200533Z [err]  2025-12-30 06:02:09,663 - core_calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-30T06:02:09.852084166Z [err]  2025-12-30 06:02:09,752 - core_calling_service - INFO - üîç KB count query completed: 4 items
2025-12-30T06:02:09.852091967Z [err]  2025-12-30 06:02:09,753 - core_calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-30T06:02:09.852105102Z [err]  2025-12-30 06:02:09,763 - core_calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-30T06:02:09.852115027Z [err]  2025-12-30 06:02:09,763 - core_calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-30T06:02:09.852121495Z [err]  2025-12-30 06:02:09,763 - core_calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-30T06:02:09.857293395Z [err]  2025-12-30 06:02:09,852 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:02:09.863386860Z [err]  2025-12-30 06:02:09,861 - core_calling_service - INFO - ‚úÖ LLM client pre-warmed in 96ms
2025-12-30T06:02:09.863392522Z [err]  2025-12-30 06:02:09,861 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-30T06:02:09.863397815Z [err]  2025-12-30 06:02:09,861 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-30T06:02:09.898660170Z [err]  2025-12-30 06:02:09,893 - redis_service - INFO - üì¶ Stored call data in Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg (TTL: 3600s)
2025-12-30T06:02:09.898670930Z [err]  2025-12-30 06:02:09,893 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-30T06:02:09.898678239Z [err]  2025-12-30 06:02:09,893 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-30T06:02:09.904320740Z [err]  2025-12-30 06:02:09,899 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:09.904331704Z [err]  2025-12-30 06:02:09,899 - server - INFO - ü§ñ AI session created for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:09.904341358Z [err]  2025-12-30 06:02:09,900 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-30T06:02:09.904348290Z [err]  2025-12-30 06:02:09,900 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-30T06:02:09.904354351Z [err]  2025-12-30 06:02:09,900 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-30T06:02:09.904360708Z [err]  2025-12-30 06:02:09,900 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-30T06:02:09.904366773Z [err]  2025-12-30 06:02:09,900 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-30T06:02:09.904373523Z [err]  2025-12-30 06:02:09,900 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-30T06:02:09.904379312Z [err]  2025-12-30 06:02:09,900 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-30T06:02:09.942629897Z [err]  2025-12-30 06:02:09,935 - redis_service - INFO - üì• Retrieved call data from Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:09.942638205Z [err]  2025-12-30 06:02:09,938 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-30T06:02:09.942647586Z [err]  2025-12-30 06:02:09,938 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-30T06:02:09.942655003Z [inf]  100.64.0.6:16714 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:02:10.050032188Z [err]  2025-12-30 06:02:10,048 - redis_service - INFO - üì• Retrieved call data from Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:10.063280146Z [err]  2025-12-30 06:02:10,059 - redis_service - INFO - üì• Retrieved call data from Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:10.100934707Z [err]  2025-12-30 06:02:10,096 - redis_service - INFO - üì¶ Stored call data in Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg (TTL: 3600s)
2025-12-30T06:02:10.100941195Z [err]  2025-12-30 06:02:10,096 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-30T06:02:10.100948043Z [err]  2025-12-30 06:02:10,096 - core_calling_service - INFO - ‚è±Ô∏è [06:02:10.096] üì• process_user_input() ENTRY - text: '...'
2025-12-30T06:02:10.107140651Z [err]  2025-12-30 06:02:10,106 - redis_service - INFO - üì• Retrieved call data from Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:10.108318873Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - ‚è±Ô∏è [06:02:10.107] ‚è© About to call _process_call_flow_streaming()
2025-12-30T06:02:10.108327096Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - ‚è±Ô∏è [06:02:10.107] üîÄ Agent type: call_flow, calling flow processor...
2025-12-30T06:02:10.108334048Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - ‚è±Ô∏è [06:02:10.107] üîÄ _process_call_flow_streaming() ENTRY
2025-12-30T06:02:10.108341202Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-30T06:02:10.108347025Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - ‚è±Ô∏è [06:02:10.107] ‚úÖ Node selected, about to process content...
2025-12-30T06:02:10.108353198Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - üîß Replaced {{now}} with Tuesday, December 30, 2025 at 1:02 AM EST in content
2025-12-30T06:02:10.108358833Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-30T06:02:10.108364755Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-30T06:02:10.108370400Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-30T06:02:10.108376021Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-30T06:02:10.108382371Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-30T06:02:10.108387739Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-30T06:02:10.108393371Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-30T06:02:10.109462357Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-30T06:02:10.109469473Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-30T06:02:10.109488261Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-30T06:02:10.109493108Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-30T06:02:10.109497475Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-30T06:02:10.109504943Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - ‚è±Ô∏è [06:02:10.107] üìÑ About to process content (mode=script, length=9)
2025-12-30T06:02:10.109509443Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - üîä Silence tracking reset for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg (user responded)
2025-12-30T06:02:10.109514057Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-30T06:02:10.109518248Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-30T06:02:10.109522446Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - LLM response (0.01s): Kendrick?
2025-12-30T06:02:10.109526901Z [err]  2025-12-30 06:02:10,107 - core_calling_service - INFO - Total latency: 0.01s
2025-12-30T06:02:10.109531257Z [err]  2025-12-30 06:02:10,108 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-30T06:02:10.165652544Z [err]  2025-12-30 06:02:10,160 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:10.165659599Z [err]  2025-12-30 06:02:10,161 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-30T06:02:10.212421446Z [err]  2025-12-30 06:02:10,209 - redis_service - INFO - üì• Retrieved call data from Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:10.212432082Z [err]  2025-12-30 06:02:10,210 - telnyx_service - INFO - üîä Speaking text on call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg: Kendrick?...
2025-12-30T06:02:10.212440020Z [err]  2025-12-30 06:02:10,210 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T06:02:10.212447556Z [err]  2025-12-30 06:02:10,210 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T06:02:10.212455857Z [err]  2025-12-30 06:02:10,210 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T06:02:10.212462333Z [err]  2025-12-30 06:02:10,210 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T06:02:10.212468010Z [err]  2025-12-30 06:02:10,210 - server - INFO - ‚è±Ô∏è [06:02:10.210] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-30T06:02:10.212472424Z [err]  2025-12-30 06:02:10,210 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-30T06:02:10.212476780Z [err]  2025-12-30 06:02:10,210 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-30T06:02:10.284236087Z [err]  2025-12-30 06:02:10,281 - server - INFO - üî§ RAW TOKENS: ["H"?]
2025-12-30T06:02:10.289512599Z [err]  2025-12-30 06:02:10,284 - core_calling_service - INFO - üîä Silence timer reset for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg (user started speaking)
2025-12-30T06:02:10.289516385Z [err]  2025-12-30 06:02:10,285 - core_calling_service - INFO - üë§ User started speaking for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:10.289520807Z [err]  2025-12-30 06:02:10,285 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-30T06:02:10.289524697Z [err]  2025-12-30 06:02:10,285 - server - INFO - üîç PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-30T06:02:10.301234417Z [err]  2025-12-30 06:02:10,297 - server - INFO -    Timeout: 10.0s
2025-12-30T06:02:10.301259260Z [err]  2025-12-30 06:02:10,297 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:02:10.301265507Z [err]  2025-12-30 06:02:10,297 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-30T06:02:10.301273126Z [err]  2025-12-30 06:02:10,297 - server - INFO -    Text length: 9 chars
2025-12-30T06:02:10.301281523Z [err]  2025-12-30 06:02:10,297 - server - INFO -    Text content: 'Kendrick?'
2025-12-30T06:02:10.301288037Z [err]  2025-12-30 06:02:10,297 - server - INFO -    Text bytes: b'Kendrick?'
2025-12-30T06:02:10.301296684Z [err]  2025-12-30 06:02:10,297 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-30T06:02:10.301301308Z [err]  2025-12-30 06:02:10,297 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-30T06:02:10.301305073Z [err]  2025-12-30 06:02:10,297 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-30T06:02:10.301310688Z [err]  2025-12-30 06:02:10,297 - server - INFO -    Full data: {'text': 'Kendrick?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-30T06:02:10.301315319Z [err]  2025-12-30 06:02:10,297 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-30T06:02:10.306452454Z [err]  2025-12-30 06:02:10,304 - server - INFO -    ‚úì HTTP client created (0.007s)
2025-12-30T06:02:10.306462680Z [err]  2025-12-30 06:02:10,304 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-30T06:02:10.339769402Z [err]  2025-12-30 06:02:10,333 - server - INFO - üî§ RAW TOKENS: ["H"?, "ello"?]
2025-12-30T06:02:10.339774727Z [err]  2025-12-30 06:02:10,333 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Hello' | Generating: False
2025-12-30T06:02:10.436626638Z [err]  2025-12-30 06:02:10,432 - server - INFO - üî§ RAW TOKENS: ["H"‚úì, "ello"‚úì, "?"‚úì, "<end>"‚úì]
2025-12-30T06:02:10.436630472Z [err]  2025-12-30 06:02:10,434 - server - INFO - ‚è±Ô∏è [06:02:10.433] STT endpoint detection latency: 21ms
2025-12-30T06:02:10.436635175Z [err]  2025-12-30 06:02:10,432 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-30T06:02:10.436639953Z [err]  2025-12-30 06:02:10,434 - server - INFO - ‚è±Ô∏è [06:02:10.433] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-30T06:02:10.436640672Z [err]  2025-12-30 06:02:10,433 - server - INFO - üßπ Cleaned transcript: 'H ello ?' -> 'Hello?'
2025-12-30T06:02:10.436646543Z [err]  2025-12-30 06:02:10,434 - server - INFO - ‚è±Ô∏è User spoke at 1767074530.4340703
2025-12-30T06:02:10.436647177Z [err]  2025-12-30 06:02:10,433 - server - INFO - üì• FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-30T06:02:10.436652198Z [err]  2025-12-30 06:02:10,433 - server - INFO - üé§ Soniox final transcript: 'Hello?'
2025-12-30T06:02:10.436656088Z [err]  2025-12-30 06:02:10,433 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:10.436660306Z [err]  2025-12-30 06:02:10,433 - server - INFO - üîç FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-30T06:02:10.436664203Z [err]  2025-12-30 06:02:10,433 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:10.436669507Z [err]  2025-12-30 06:02:10,433 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-30T06:02:10.436673517Z [err]  2025-12-30 06:02:10,434 - server - INFO - ‚è±Ô∏è [06:02:10.433] üìù FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-30T06:02:10.442641827Z [err]  2025-12-30 06:02:10,440 - redis_service - INFO - üì¶ Stored call data in Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg (TTL: 3600s)
2025-12-30T06:02:10.442648512Z [err]  2025-12-30 06:02:10,441 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-30T06:02:10.442656740Z [err]  2025-12-30 06:02:10,441 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:10.442664047Z [err]  2025-12-30 06:02:10,441 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-30T06:02:10.454457548Z [err]  2025-12-30 06:02:10,451 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-30T06:02:10.454463155Z [err]  2025-12-30 06:02:10,451 - core_calling_service - INFO - üë§ User stopped speaking for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:10.454467196Z [err]  2025-12-30 06:02:10,451 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-30T06:02:10.454470842Z [err]  2025-12-30 06:02:10,451 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+10ms
2025-12-30T06:02:10.454474395Z [err]  2025-12-30 06:02:10,451 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 10ms (Soniox model: stt-rt-v3)
2025-12-30T06:02:10.454478484Z [err]  2025-12-30 06:02:10,451 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-30T06:02:10.454483953Z [err]  2025-12-30 06:02:10,451 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-30T06:02:10.454488547Z [err]  2025-12-30 06:02:10,451 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:10.549062034Z [err]  2025-12-30 06:02:10,544 - server - INFO - üìù Saved user transcript to database
2025-12-30T06:02:10.549069013Z [err]  2025-12-30 06:02:10,544 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:10.549073714Z [err]  2025-12-30 06:02:10,544 - core_calling_service - INFO - ‚è±Ô∏è [06:02:10.544] üì• process_user_input() ENTRY - text: 'Hello?...'
2025-12-30T06:02:10.554301417Z [err]  2025-12-30 06:02:10,550 - redis_service - INFO - üì• Retrieved call data from Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:10.554305588Z [err]  2025-12-30 06:02:10,550 - core_calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg: User spoke while Silence Greeting was triggering
2025-12-30T06:02:10.571765237Z [err]  2025-12-30 06:02:10,570 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:02:10.571773885Z [err]  2025-12-30 06:02:10,570 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:10.682839106Z [err]  2025-12-30 06:02:10,677 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:10.682843784Z [err]  2025-12-30 06:02:10,678 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:10.682848406Z [err]  2025-12-30 06:02:10,678 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=True, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-30T06:02:10.852002941Z [err]  2025-12-30 06:02:10,697 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-30T06:02:10.852011011Z [err]  2025-12-30 06:02:10,697 - server - INFO -    ‚úì Connection established (0.400s) [TARGET: <200ms]
2025-12-30T06:02:10.852045044Z [err]  2025-12-30 06:02:10,707 - server - INFO -       - First chunk: 408ms
2025-12-30T06:02:10.852054694Z [err]  2025-12-30 06:02:10,705 - server - INFO -    ‚úì FIRST CHUNK received (0.408s, 1059 bytes) [TARGET: <300ms]
2025-12-30T06:02:10.852055295Z [err]  2025-12-30 06:02:10,707 - server - INFO -       - All chunks: 410ms
2025-12-30T06:02:10.852065820Z [err]  2025-12-30 06:02:10,707 - server - INFO -       - Audio generation only: 8ms
2025-12-30T06:02:10.852066058Z [err]  2025-12-30 06:02:10,707 - server - INFO -    ‚úì ALL CHUNKS received: 38 chunks (0.410s)
2025-12-30T06:02:10.852074385Z [err]  2025-12-30 06:02:10,708 - server - INFO - üíæ TTS CACHED: elevenlabs:Kendrick?... (13419 bytes)
2025-12-30T06:02:10.852082628Z [err]  2025-12-30 06:02:10,707 - server - INFO -    ‚úì Total audio size: 13419 bytes
2025-12-30T06:02:10.852082870Z [err]  2025-12-30 06:02:10,697 - server - INFO -    ‚úì Response status: 200
2025-12-30T06:02:10.852086475Z [err]  2025-12-30 06:02:10,708 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.50s
2025-12-30T06:02:10.852095544Z [err]  2025-12-30 06:02:10,708 - server - INFO - ‚è±Ô∏è [06:02:10.707] üîä TTS COMPLETE: 497ms, audio_size=13419 bytes
2025-12-30T06:02:10.852095989Z [err]  2025-12-30 06:02:10,697 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-30T06:02:10.852097155Z [err]  2025-12-30 06:02:10,707 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-30T06:02:10.852100676Z [err]  2025-12-30 06:02:10,708 - telnyx_service - INFO - ‚úÖ Generated 13419 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-30T06:02:10.852107063Z [err]  2025-12-30 06:02:10,707 - server - INFO -       - Connection: 400ms
2025-12-30T06:02:10.852110090Z [err]  2025-12-30 06:02:10,708 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-30T06:02:10.996453856Z [err]  2025-12-30 06:02:10,992 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg/actions/playback_start "HTTP/1.1 200 OK"
2025-12-30T06:02:10.996461857Z [err]  2025-12-30 06:02:10,993 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.29s
2025-12-30T06:02:10.996469751Z [err]  2025-12-30 06:02:10,993 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 0.78s
2025-12-30T06:02:10.996477337Z [err]  2025-12-30 06:02:10,993 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-30T06:02:10.996485483Z [err]  2025-12-30 06:02:10,993 - telnyx_service - INFO - üé¨ Playback ID: pGAhbeFfvA
2025-12-30T06:02:10.996492679Z [err]  2025-12-30 06:02:10,994 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-30T06:02:10.996500222Z [err]  2025-12-30 06:02:10,994 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Greeting playback started at 1767074530.9941165
2025-12-30T06:02:10.996513503Z [err]  2025-12-30 06:02:10,994 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-30T06:02:11.002827820Z [err]  2025-12-30 06:02:10,999 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg/actions/playback_stop "HTTP/1.1 200 OK"
2025-12-30T06:02:11.002836725Z [err]  2025-12-30 06:02:10,999 - telnyx_service - INFO - ‚úÖ Successfully stopped audio playback
2025-12-30T06:02:11.002843855Z [err]  2025-12-30 06:02:11,000 - core_calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-30T06:02:11.002851526Z [err]  2025-12-30 06:02:11,000 - core_calling_service - INFO - ‚úÖ BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-30T06:02:11.007937601Z [err]  2025-12-30 06:02:11,006 - redis_service - INFO - üì• Retrieved call data from Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:11.018767785Z [err]  2025-12-30 06:02:11,013 - redis_service - INFO - üì¶ Stored call data in Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg (TTL: 3600s)
2025-12-30T06:02:11.018773887Z [err]  2025-12-30 06:02:11,013 - core_calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-30T06:02:11.018781538Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - ‚è±Ô∏è [06:02:11.014] ‚è© About to call _process_call_flow_streaming()
2025-12-30T06:02:11.018787357Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - ‚è±Ô∏è [06:02:11.014] üîÄ Agent type: call_flow, calling flow processor...
2025-12-30T06:02:11.018792645Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - ‚è±Ô∏è [06:02:11.014] üîÄ _process_call_flow_streaming() ENTRY
2025-12-30T06:02:11.018797995Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - Flow processing - History length: 3, Is first: False
2025-12-30T06:02:11.018804912Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-30T06:02:11.018811680Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - ‚è±Ô∏è [06:02:11.014] üîÄ About to call _follow_transition() for: Hello?...
2025-12-30T06:02:11.018817687Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Hello?
2025-12-30T06:02:11.018823165Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - ‚è∏Ô∏è User spoke (1767074530.4340703) BEFORE greeting could be heard (1767074532.9941165)
2025-12-30T06:02:11.018828411Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - ‚è∏Ô∏è Playback API called at 1767074530.9941165, buffer window: 2.0s
2025-12-30T06:02:11.018833750Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - ‚è∏Ô∏è Skipping transition eval - user hasn't heard greeting yet, will deliver it as response
2025-12-30T06:02:11.018839090Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 0ms
2025-12-30T06:02:11.019488582Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - ‚è±Ô∏è [06:02:11.014] ‚úÖ Node selected, about to process content...
2025-12-30T06:02:11.019494107Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - üîß Replaced {{now}} with Tuesday, December 30, 2025 at 1:02 AM EST in content
2025-12-30T06:02:11.019498493Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-30T06:02:11.019503238Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-30T06:02:11.019507219Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-30T06:02:11.019510944Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-30T06:02:11.019515452Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-30T06:02:11.019519199Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-30T06:02:11.019523220Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-30T06:02:11.019527101Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-30T06:02:11.019530997Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-30T06:02:11.019534972Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-30T06:02:11.019538787Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-30T06:02:11.020223304Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-30T06:02:11.020230969Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - ‚è±Ô∏è [06:02:11.014] üìÑ About to process content (mode=script, length=9)
2025-12-30T06:02:11.020236295Z [err]  2025-12-30 06:02:11,014 - core_calling_service - INFO - ‚è∏Ô∏è Skip sticky-prevention - delivering script as response to user's opener
2025-12-30T06:02:11.020241377Z [err]  2025-12-30 06:02:11,014 - server - INFO - üì§ Sentence arrived from LLM: Kendrick?...
2025-12-30T06:02:11.020246478Z [err]  2025-12-30 06:02:11,014 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 563ms
2025-12-30T06:02:11.020251521Z [err]  2025-12-30 06:02:11,014 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-30T06:02:11.020256100Z [err]  2025-12-30 06:02:11,014 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:11.020260530Z [err]  2025-12-30 06:02:11,015 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-30T06:02:11.105658707Z [err]  2025-12-30 06:02:11,101 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:02:11.192374455Z [err]  2025-12-30 06:02:11,191 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:11.192380304Z [err]  2025-12-30 06:02:11,191 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:11.192384309Z [err]  2025-12-30 06:02:11,191 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:02:11.283008297Z [err]  2025-12-30 06:02:11,277 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:02:11.294778274Z [err]  2025-12-30 06:02:11,293 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:02:11.294784185Z [err]  2025-12-30 06:02:11,293 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': 'a21450d7-bcfa-4dde-9ea1-2b4436571778', 'occurred_at': '2025-12-30T06:02:10.931048Z', 'payload': {'call_control_id': 'v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg', 'call_leg_id': '0e01872e-e545-11f0-90d3-02420aef93a0', 'call_session_id': '0dfe1760-e545-11f0-b8d6-02420aef93a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'RY71G7UPiQ', 'start_time': '2025-12-30T06:02:10.931048Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:02:11.294788397Z [err]  2025-12-30 06:02:11,293 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:11.294792491Z [err]  2025-12-30 06:02:11,293 - server - INFO - üì® ================================================
2025-12-30T06:02:11.294796288Z [inf]  100.64.0.5:34530 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:02:11.306411826Z [err]  2025-12-30 06:02:11,299 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:02:11.306422191Z [err]  2025-12-30 06:02:11,299 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-30T06:02:11.306429300Z [err]  2025-12-30 06:02:11,299 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-30T06:02:11.306435076Z [err]  2025-12-30 06:02:11,299 - persistent_tts_service - INFO - üîå [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Establishing persistent TTS WebSocket...
2025-12-30T06:02:11.306441063Z [err]  2025-12-30 06:02:11,299 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-30T06:02:11.306447959Z [err]  2025-12-30 06:02:11,299 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-30T06:02:11.306453724Z [err]  2025-12-30 06:02:11,299 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-30T06:02:11.333185756Z [inf]  100.64.0.4:51708 - "GET /api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3 HTTP/1.1" 200
2025-12-30T06:02:11.427108680Z [err]  2025-12-30 06:02:11,423 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-30T06:02:11.427115874Z [err]  2025-12-30 06:02:11,423 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-30T06:02:11.427120786Z [err]  2025-12-30 06:02:11,423 - persistent_tts_service - INFO - ‚úÖ [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Persistent TTS WebSocket established
2025-12-30T06:02:11.427125688Z [err]  2025-12-30 06:02:11,423 - persistent_tts_service - INFO - üéß [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Audio receiver loop started
2025-12-30T06:02:11.427129757Z [err]  2025-12-30 06:02:11,423 - persistent_tts_service - INFO - üîä [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Comfort noise loop started
2025-12-30T06:02:11.427133608Z [err]  2025-12-30 06:02:11,423 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:11.427137417Z [err]  2025-12-30 06:02:11,423 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-30T06:02:11.427141948Z [err]  2025-12-30 06:02:11,423 - server - INFO - üîç Persistent TTS lookup: call_id=v3:hTSglL84EMXJKPqJp..., session=FOUND
2025-12-30T06:02:11.427145853Z [err]  2025-12-30 06:02:11,423 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-30T06:02:11.427149731Z [err]  2025-12-30 06:02:11,424 - server - INFO - üéµ TTS task #1 started at +409ms
2025-12-30T06:02:11.427154673Z [err]  2025-12-30 06:02:11,424 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 972ms
2025-12-30T06:02:11.427158447Z [err]  2025-12-30 06:02:11,424 - core_calling_service - INFO - üîä Silence tracking reset for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg (user responded)
2025-12-30T06:02:11.427163427Z [err]  2025-12-30 06:02:11,424 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-30T06:02:11.428030518Z [err]  2025-12-30 06:02:11,425 - persistent_tts_service - INFO - üéß [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Audio Receiver Loop STARTED
2025-12-30T06:02:11.428036359Z [err]  2025-12-30 06:02:11,424 - core_calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-30T06:02:11.428041353Z [err]  2025-12-30 06:02:11,425 - persistent_tts_service - INFO - üíì [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Starting TTS keep-alive loop (every 15s)
2025-12-30T06:02:11.428041391Z [err]  2025-12-30 06:02:11,424 - core_calling_service - INFO - LLM response (0.88s): Kendrick?
2025-12-30T06:02:11.428048936Z [err]  2025-12-30 06:02:11,425 - persistent_tts_service - INFO - üîä [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Starting comfort noise loop
2025-12-30T06:02:11.428055039Z [err]  2025-12-30 06:02:11,425 - persistent_tts_service - INFO - üé§ [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Streaming sentence #1: Kendrick?...
2025-12-30T06:02:11.428062828Z [err]  2025-12-30 06:02:11,425 - persistent_tts_service - INFO - üöÄ [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-30T06:02:11.428067917Z [err]  2025-12-30 06:02:11,424 - core_calling_service - INFO - Total latency: 0.88s
2025-12-30T06:02:11.428079378Z [err]  2025-12-30 06:02:11,424 - server - INFO - ‚úÖ LLM finished in 972ms, TTS tasks already running in background
2025-12-30T06:02:11.428087923Z [err]  2025-12-30 06:02:11,425 - server - INFO - üéµ Streaming 1 TTS chunks as they complete...
2025-12-30T06:02:11.428097030Z [err]  2025-12-30 06:02:11,425 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-30T06:02:11.428104378Z [err]  2025-12-30 06:02:11,425 - server - INFO -    1 sentences queued and playing seamlessly
2025-12-30T06:02:11.428112259Z [err]  2025-12-30 06:02:11,425 - persistent_tts_service - INFO - üéµ [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Playback consumer started
2025-12-30T06:02:11.428775922Z [err]  2025-12-30 06:02:11,425 - persistent_tts_service - INFO - üìä [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-30T06:02:11.428780000Z [err]  2025-12-30 06:02:11,425 - persistent_tts_service - INFO - üéß [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Receiver processing sentence #1: 'Kendrick?...'
2025-12-30T06:02:11.428784000Z [err]  2025-12-30 06:02:11,425 - persistent_tts_service - INFO - üìä [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] DIAGNOSTIC: queue_latency=0ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-30T06:02:11.428787594Z [err]  2025-12-30 06:02:11,425 - server - INFO - ‚úÖ All 1 persistent TTS streams completed
2025-12-30T06:02:11.428791495Z [err]  2025-12-30 06:02:11,425 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-30T06:02:11.428795283Z [err]  2025-12-30 06:02:11,425 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 974ms from user stop üöÄ
2025-12-30T06:02:11.428798903Z [err]  2025-12-30 06:02:11,425 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:11.428802461Z [err]  2025-12-30 06:02:11,425 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-30T06:02:11.428806222Z [err]  2025-12-30 06:02:11,425 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T06:02:11.428810143Z [err]  2025-12-30 06:02:11,425 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-30T06:02:11.428813736Z [err]  2025-12-30 06:02:11,426 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 10ms (provider: soniox, model: stt-rt-v3)
2025-12-30T06:02:11.428817628Z [err]  2025-12-30 06:02:11,426 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 972ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-30T06:02:11.429723587Z [err]  2025-12-30 06:02:11,426 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 411ms (provider: elevenlabs, websocket: False)
2025-12-30T06:02:11.429732560Z [err]  2025-12-30 06:02:11,426 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 974ms (user stopped ‚Üí play_audio_url called)
2025-12-30T06:02:11.429739399Z [err]  2025-12-30 06:02:11,426 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-30T06:02:11.429745567Z [err]  2025-12-30 06:02:11,426 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-30T06:02:11.429749382Z [err]  2025-12-30 06:02:11,426 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-30T06:02:11.429753496Z [err]  2025-12-30 06:02:11,426 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-30T06:02:11.429757416Z [err]  2025-12-30 06:02:11,426 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-30T06:02:11.429761209Z [err]  2025-12-30 06:02:11,426 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 1274ms estimated
2025-12-30T06:02:11.429765321Z [err]  2025-12-30 06:02:11,426 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 9 chars, 1 sentences
2025-12-30T06:02:11.429769325Z [err]  2025-12-30 06:02:11,426 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Hello?...'
2025-12-30T06:02:11.429773005Z [err]  2025-12-30 06:02:11,426 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: 'Kendrick?...'
2025-12-30T06:02:11.429776835Z [err]  2025-12-30 06:02:11,426 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-30T06:02:11.429780720Z [err]  2025-12-30 06:02:11,426 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T06:02:11.452747743Z [err]  2025-12-30 06:02:11,447 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:02:11.452752804Z [err]  2025-12-30 06:02:11,447 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': '0960ddcc-ed81-4e02-a0ff-a243032946f1', 'occurred_at': '2025-12-30T06:02:10.851048Z', 'payload': {'call_control_id': 'v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg', 'call_leg_id': '0e01872e-e545-11f0-90d3-02420aef93a0', 'call_session_id': '0dfe1760-e545-11f0-b8d6-02420aef93a0', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:02:11.452757386Z [err]  2025-12-30 06:02:11,447 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:11.452761549Z [err]  2025-12-30 06:02:11,447 - server - INFO - üì® ================================================
2025-12-30T06:02:11.452766167Z [inf]  100.64.0.5:34530 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:02:11.618097371Z [err]  2025-12-30 06:02:11,611 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Greeting, Dead Air: 1393ms)
2025-12-30T06:02:11.618114033Z [err]  2025-12-30 06:02:11,611 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-30T06:02:11.618118354Z [err]  2025-12-30 06:02:11,611 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-30T06:02:11.840100551Z [err]  2025-12-30 06:02:11,737 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 311ms
2025-12-30T06:02:11.840114546Z [err]  2025-12-30 06:02:11,737 - persistent_tts_service - INFO - üì§ Sending 7043 bytes of audio (45 chunks, 0.9s duration) via WebSocket
2025-12-30T06:02:11.840125263Z [err]  2025-12-30 06:02:11,737 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-30T06:02:11.840167589Z [err]  2025-12-30 06:02:11,737 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +0.9s (total: 0.9s from now)
2025-12-30T06:02:11.840174229Z [err]  2025-12-30 06:02:11,737 - persistent_tts_service - INFO - ‚úÖ Sent 45 audio chunks via WebSocket
2025-12-30T06:02:12.178745702Z [err]  2025-12-30 06:02:12,164 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:12.178752883Z [err]  2025-12-30 06:02:12,164 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:02:12.178758063Z [err]  2025-12-30 06:02:12,164 - server - INFO - üì® ================================================
2025-12-30T06:02:12.178759705Z [err]  2025-12-30 06:02:12,164 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '18b2412a-6e88-4666-b0ff-965daf4e62a9', 'occurred_at': '2025-12-30T06:02:11.811047Z', 'payload': {'call_control_id': 'v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg', 'call_leg_id': '0e01872e-e545-11f0-90d3-02420aef93a0', 'call_session_id': '0dfe1760-e545-11f0-b8d6-02420aef93a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'pGAhbeFfvA'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:02:12.178764353Z [inf]  100.64.0.6:16714 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:02:12.853119515Z [err]  2025-12-30 06:02:12,736 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (0.1s ago), marking agent as done speaking
2025-12-30T06:02:12.853126731Z [err]  2025-12-30 06:02:12,736 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767074532.7360966 for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:12.853135375Z [err]  2025-12-30 06:02:12,736 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:12.853142497Z [err]  2025-12-30 06:02:12,738 - persistent_tts_service - INFO - üîá [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] FLOOR RELEASED (is_holding_floor=False)
2025-12-30T06:02:12.864777407Z [err]  2025-12-30 06:02:12,860 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:02:12.864784170Z [err]  2025-12-30 06:02:12,860 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '703d2fdc-6407-4af2-9e9d-4d11372aefa0', 'occurred_at': '2025-12-30T06:02:12.651047Z', 'payload': {'call_control_id': 'v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg', 'call_leg_id': '0e01872e-e545-11f0-90d3-02420aef93a0', 'call_session_id': '0dfe1760-e545-11f0-b8d6-02420aef93a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': 'pGAhbeFfvA', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:02:12.864790073Z [err]  2025-12-30 06:02:12,860 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:12.864795576Z [err]  2025-12-30 06:02:12,860 - server - INFO - üì® ================================================
2025-12-30T06:02:12.875748283Z [err]  2025-12-30 06:02:12,873 - redis_service - INFO - ‚ûñ Removed playback pGAhbeFfvA, 0 remaining for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:12.875755820Z [err]  2025-12-30 06:02:12,873 - server - INFO - üîä Redis: Removed playback pGAhbeFfvA, 0 remaining
2025-12-30T06:02:12.875762534Z [err]  2025-12-30 06:02:12,873 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-30T06:02:12.887708528Z [err]  2025-12-30 06:02:12,882 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-30T06:02:12.887712997Z [err]  2025-12-30 06:02:12,882 - server - INFO - ‚úÖ Found session in active_telnyx_calls (local worker)
2025-12-30T06:02:12.887717478Z [err]  2025-12-30 06:02:12,882 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767074532.8823278 for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:12.887721961Z [err]  2025-12-30 06:02:12,882 - server - INFO - ‚è±Ô∏è Silence timer STARTED (fallback, agent wasn't marked as speaking)
2025-12-30T06:02:12.887726594Z [inf]  100.64.0.5:34530 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:02:13.662058804Z [err]  2025-12-30 06:02:13,652 - server - INFO - üì§ Audio flowing: 296 packets sent to Soniox (5s update)
2025-12-30T06:02:13.863648483Z [err]  2025-12-30 06:02:13,737 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-30T06:02:13.863654685Z [err]  2025-12-30 06:02:13,738 - persistent_tts_service - INFO - ‚úÖ [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Receiver finished sentence #1: 1 chunks in 2312ms
2025-12-30T06:02:16.578487974Z [err]  2025-12-30 06:02:16,577 - server - INFO - üî§ RAW TOKENS: [" Ye"?]
2025-12-30T06:02:16.578493505Z [err]  2025-12-30 06:02:16,577 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user started speaking) for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:16.578497599Z [err]  2025-12-30 06:02:16,577 - core_calling_service - INFO - üîä Silence timer reset for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg (user started speaking)
2025-12-30T06:02:16.578501497Z [err]  2025-12-30 06:02:16,577 - core_calling_service - INFO - üë§ User started speaking for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:16.578505529Z [err]  2025-12-30 06:02:16,577 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-30T06:02:16.578510247Z [err]  2025-12-30 06:02:16,577 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Ye' | Generating: False
2025-12-30T06:02:16.855355167Z [err]  2025-12-30 06:02:16,740 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Yeah.
2025-12-30T06:02:16.855362779Z [err]  2025-12-30 06:02:16,740 - core_calling_service - INFO - üë§ User stopped speaking for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:16.855369685Z [err]  2025-12-30 06:02:16,742 - server - INFO - ‚úÖ User starting new turn - resetting agent speaking flag
2025-12-30T06:02:16.855377160Z [err]  2025-12-30 06:02:16,742 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-30T06:02:16.855383983Z [err]  2025-12-30 06:02:16,742 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+6ms
2025-12-30T06:02:16.855392442Z [err]  2025-12-30 06:02:16,742 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 6ms (Soniox model: stt-rt-v3)
2025-12-30T06:02:16.855392673Z [err]  2025-12-30 06:02:16,722 - server - INFO - üî§ RAW TOKENS: [" Ye"‚úì, "ah."‚úì, "<end>"‚úì]
2025-12-30T06:02:16.855401313Z [err]  2025-12-30 06:02:16,743 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-30T06:02:16.855401679Z [err]  2025-12-30 06:02:16,722 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-30T06:02:16.855409945Z [err]  2025-12-30 06:02:16,722 - server - INFO - üßπ Cleaned transcript: ' Ye ah.' -> 'Yeah.'
2025-12-30T06:02:16.855411698Z [err]  2025-12-30 06:02:16,743 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-30T06:02:16.855420105Z [err]  2025-12-30 06:02:16,722 - server - INFO - üì• FINAL TOKENS: 'Yeah.' (2 tokens)
2025-12-30T06:02:16.855422779Z [err]  2025-12-30 06:02:16,743 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:16.855428394Z [err]  2025-12-30 06:02:16,722 - server - INFO - üé§ Soniox final transcript: 'Yeah.'
2025-12-30T06:02:16.855431575Z [err]  2025-12-30 06:02:16,796 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-30T06:02:16.855436973Z [err]  2025-12-30 06:02:16,722 - server - INFO - üîç FILTER CHECK: words=1, is_filler=True, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-30T06:02:16.855440262Z [err]  2025-12-30 06:02:16,796 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767074536.7963922 for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:16.855445068Z [err]  2025-12-30 06:02:16,722 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-30T06:02:16.855447567Z [err]  2025-12-30 06:02:16,796 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:16.855452844Z [err]  2025-12-30 06:02:16,835 - server - INFO - üìù Saved user transcript to database
2025-12-30T06:02:16.855454366Z [err]  2025-12-30 06:02:16,722 - server - INFO - ‚è±Ô∏è [06:02:16.722] üìù FINAL TRANSCRIPT RECEIVED: 'Yeah.'
2025-12-30T06:02:16.855460557Z [err]  2025-12-30 06:02:16,722 - server - INFO - ‚è±Ô∏è [06:02:16.722] STT endpoint detection latency: 10ms
2025-12-30T06:02:16.855466721Z [err]  2025-12-30 06:02:16,723 - server - INFO - ‚è±Ô∏è [06:02:16.722] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-30T06:02:16.855473624Z [err]  2025-12-30 06:02:16,723 - server - INFO - ‚è±Ô∏è User spoke at 1767074536.7230206
2025-12-30T06:02:16.855479998Z [err]  2025-12-30 06:02:16,729 - redis_service - INFO - üì¶ Stored call data in Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg (TTL: 3600s)
2025-12-30T06:02:16.855485903Z [err]  2025-12-30 06:02:16,729 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-30T06:02:16.855492209Z [err]  2025-12-30 06:02:16,729 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Yeah.' - Processing...
2025-12-30T06:02:16.856332353Z [err]  2025-12-30 06:02:16,835 - core_calling_service - INFO - ‚è±Ô∏è [06:02:16.835] üì• process_user_input() ENTRY - text: 'Yeah....'
2025-12-30T06:02:16.856339940Z [err]  2025-12-30 06:02:16,842 - redis_service - INFO - üì• Retrieved call data from Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:16.856346679Z [err]  2025-12-30 06:02:16,842 - core_calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg: User spoke while Silence Greeting was triggering
2025-12-30T06:02:16.868090820Z [err]  2025-12-30 06:02:16,864 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-30T06:02:16.868098926Z [err]  2025-12-30 06:02:16,864 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:17.366647299Z [err]  2025-12-30 06:02:17,362 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg/actions/playback_stop "HTTP/1.1 200 OK"
2025-12-30T06:02:17.366653538Z [err]  2025-12-30 06:02:17,363 - telnyx_service - INFO - ‚úÖ Successfully stopped audio playback
2025-12-30T06:02:17.366657868Z [err]  2025-12-30 06:02:17,363 - core_calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-30T06:02:17.366662325Z [err]  2025-12-30 06:02:17,363 - core_calling_service - INFO - ‚úÖ BARGE-IN: Preserving silence greeting in history to maintain context
2025-12-30T06:02:17.372620593Z [err]  2025-12-30 06:02:17,369 - redis_service - INFO - üì• Retrieved call data from Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:17.379003262Z [err]  2025-12-30 06:02:17,376 - redis_service - INFO - üì¶ Stored call data in Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg (TTL: 3600s)
2025-12-30T06:02:17.379007798Z [err]  2025-12-30 06:02:17,376 - core_calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-30T06:02:17.379012389Z [err]  2025-12-30 06:02:17,376 - core_calling_service - INFO - ‚è±Ô∏è [06:02:17.376] ‚è© About to call _process_call_flow_streaming()
2025-12-30T06:02:17.379016529Z [err]  2025-12-30 06:02:17,376 - core_calling_service - INFO - ‚è±Ô∏è [06:02:17.376] üîÄ Agent type: call_flow, calling flow processor...
2025-12-30T06:02:17.379020368Z [err]  2025-12-30 06:02:17,376 - core_calling_service - INFO - ‚è±Ô∏è [06:02:17.376] üîÄ _process_call_flow_streaming() ENTRY
2025-12-30T06:02:17.379024662Z [err]  2025-12-30 06:02:17,376 - core_calling_service - INFO - Flow processing - History length: 5, Is first: False
2025-12-30T06:02:17.379028738Z [err]  2025-12-30 06:02:17,376 - core_calling_service - INFO - üîç Using explicitly set current_node_id: 2
2025-12-30T06:02:17.379032588Z [err]  2025-12-30 06:02:17,376 - core_calling_service - INFO - ‚è±Ô∏è [06:02:17.376] üîÄ About to call _follow_transition() for: Yeah....
2025-12-30T06:02:17.379036207Z [err]  2025-12-30 06:02:17,376 - core_calling_service - INFO - Evaluating transitions from Greeting for message: Yeah.
2025-12-30T06:02:17.379039769Z [err]  2025-12-30 06:02:17,376 - core_calling_service - INFO - üîç Checking 'Hello=Yes' override [DEPLOYMENT VERIFIED] for msg='yeah' on node='Greeting'
2025-12-30T06:02:17.379043823Z [err]  2025-12-30 06:02:17,376 - core_calling_service - INFO - ‚ö° OVERRIDE TRIGGERED: 'Yeah.' on Greeting node -> Forcing Transition 0 (Index 0)
2025-12-30T06:02:17.379050245Z [err]  2025-12-30 06:02:17,376 - core_calling_service - INFO - ‚è±Ô∏è [TIMING] TRANSITION_EVAL: 0ms
2025-12-30T06:02:17.379055246Z [err]  2025-12-30 06:02:17,376 - core_calling_service - INFO - ‚è±Ô∏è [06:02:17.376] ‚úÖ Node selected, about to process content...
2025-12-30T06:02:17.379853892Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - üîß Replaced {{now}} with Tuesday, December 30, 2025 at 1:02 AM EST in content
2025-12-30T06:02:17.379862021Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-30T06:02:17.379868708Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-30T06:02:17.379875112Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-30T06:02:17.379881749Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-30T06:02:17.379888025Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-30T06:02:17.379892930Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-30T06:02:17.379896901Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-30T06:02:17.379900601Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-30T06:02:17.379908045Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-30T06:02:17.379911555Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 89 chars) - will return text instantly
2025-12-30T06:02:17.379915206Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - Using flow node: Node Prompt: N001B_IntroAndHelpRequest_Only (V3 - Follows Name Confirmation) (type: conversation, mode: script)
2025-12-30T06:02:17.379919466Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - ‚è±Ô∏è [06:02:17.377] üìÑ About to process content (mode=script, length=89)
2025-12-30T06:02:17.381005342Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - üì§ Streaming script as 2 sentence(s)
2025-12-30T06:02:17.381019733Z [err]  2025-12-30 06:02:17,377 - server - INFO - üì§ Sentence arrived from LLM: This is Jake......
2025-12-30T06:02:17.381029424Z [err]  2025-12-30 06:02:17,377 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 634ms
2025-12-30T06:02:17.381038904Z [err]  2025-12-30 06:02:17,377 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-30T06:02:17.381047285Z [err]  2025-12-30 06:02:17,377 - server - INFO - üîç Persistent TTS lookup: call_id=v3:hTSglL84EMXJKPqJp..., session=FOUND
2025-12-30T06:02:17.381056389Z [err]  2025-12-30 06:02:17,377 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-30T06:02:17.381062662Z [err]  2025-12-30 06:02:17,377 - server - INFO - üéµ TTS task #1 started at +0ms
2025-12-30T06:02:17.381068350Z [err]  2025-12-30 06:02:17,377 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 634ms
2025-12-30T06:02:17.381074035Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - üì§ Streamed script sentence 1/2: This is Jake......
2025-12-30T06:02:17.381080186Z [err]  2025-12-30 06:02:17,377 - server - INFO - üì§ Sentence arrived from LLM: I was just, um, wondering if you could possibly he...
2025-12-30T06:02:17.381086315Z [err]  2025-12-30 06:02:17,377 - server - INFO - üîç Persistent TTS lookup: call_id=v3:hTSglL84EMXJKPqJp..., session=FOUND
2025-12-30T06:02:17.381153077Z [err]  2025-12-30 06:02:17,377 - server - INFO - üöÄ Streaming sentence #2 via persistent WebSocket
2025-12-30T06:02:17.381158994Z [err]  2025-12-30 06:02:17,377 - server - INFO - üéµ TTS task #2 started at +0ms
2025-12-30T06:02:17.381164203Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - üì§ Streamed script sentence 2/2: I was just, um, wondering if you could possibly he...
2025-12-30T06:02:17.381169896Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER RESET (user gave meaningful response) for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:17.382147755Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - üîä Silence tracking reset for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg (user responded)
2025-12-30T06:02:17.382154796Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-30T06:02:17.382161239Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - üíæ Storing node ID 1763159750250 in conversation history
2025-12-30T06:02:17.382165435Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - LLM response (0.54s): This is Jake... I was just, um, wondering if you could possibly help me out for a moment?
2025-12-30T06:02:17.382169327Z [err]  2025-12-30 06:02:17,377 - core_calling_service - INFO - Total latency: 0.54s
2025-12-30T06:02:17.382173378Z [err]  2025-12-30 06:02:17,378 - server - INFO - ‚úÖ LLM finished in 635ms, TTS tasks already running in background
2025-12-30T06:02:17.382177561Z [err]  2025-12-30 06:02:17,378 - server - INFO - üéµ Streaming 2 TTS chunks as they complete...
2025-12-30T06:02:17.382182935Z [err]  2025-12-30 06:02:17,378 - server - INFO - üöÄ Persistent TTS: Audio already streaming in background!
2025-12-30T06:02:17.382191310Z [err]  2025-12-30 06:02:17,378 - server - INFO -    2 sentences queued and playing seamlessly
2025-12-30T06:02:17.382195217Z [err]  2025-12-30 06:02:17,378 - persistent_tts_service - INFO - üé§ [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Streaming sentence #2: This is Jake......
2025-12-30T06:02:17.382199042Z [err]  2025-12-30 06:02:17,379 - persistent_tts_service - INFO - üöÄ [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Sent sentence #2 (NON-BLOCKING) in 0ms
2025-12-30T06:02:17.382203057Z [err]  2025-12-30 06:02:17,379 - persistent_tts_service - INFO - üìä [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-30T06:02:17.383341071Z [err]  2025-12-30 06:02:17,379 - persistent_tts_service - INFO - üé§ [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Streaming sentence #3: I was just, um, wondering if you could possibly he...
2025-12-30T06:02:17.383348491Z [err]  2025-12-30 06:02:17,379 - persistent_tts_service - INFO - üöÄ [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Sent sentence #3 (NON-BLOCKING) in 0ms
2025-12-30T06:02:17.383355196Z [err]  2025-12-30 06:02:17,379 - persistent_tts_service - INFO - üìä [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] DIAGNOSTIC: pending_sentences=2, audio_queue=0, is_first=False, is_last=False
2025-12-30T06:02:17.383361841Z [err]  2025-12-30 06:02:17,379 - persistent_tts_service - INFO - üéß [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Receiver processing sentence #2: 'This is Jake......'
2025-12-30T06:02:17.383368583Z [err]  2025-12-30 06:02:17,379 - persistent_tts_service - INFO - üìä [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] DIAGNOSTIC: queue_latency=0ms, pending_sentences=1, audio_queue=0, interrupted=False
2025-12-30T06:02:17.383374933Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚úÖ All 2 persistent TTS streams completed
2025-12-30T06:02:17.383381333Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚úÖ Agent generation complete (persistent TTS) - response window closed
2025-12-30T06:02:17.383386710Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚è±Ô∏è  FIRST AUDIO STARTED: 636ms from user stop üöÄ
2025-12-30T06:02:17.383391109Z [err]  2025-12-30 06:02:17,379 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:17.383395217Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚úÖ Agent generation complete - response window closed
2025-12-30T06:02:17.383398840Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T06:02:17.384472948Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚è±Ô∏è  [TIMING] ==== E2E LATENCY SUMMARY ====
2025-12-30T06:02:17.384476779Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚è±Ô∏è  [TIMING]   - TOTAL MISSING: ~150-550ms typically
2025-12-30T06:02:17.384482860Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚è±Ô∏è  [TIMING] STT: 6ms (provider: soniox, model: stt-rt-v3)
2025-12-30T06:02:17.384485649Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚è±Ô∏è  [TIMING]   - REAL USER LATENCY: 936ms estimated
2025-12-30T06:02:17.384491903Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚è±Ô∏è  [TIMING] LLM_TOTAL: 635ms (provider: grok, model: grok-4-1-fast-non-reasoning)
2025-12-30T06:02:17.384491912Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚è±Ô∏è  [TIMING] RESPONSE_TEXT: 89 chars, 2 sentences
2025-12-30T06:02:17.384496779Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚è±Ô∏è  [TIMING] USER_INPUT: 'Yeah....'
2025-12-30T06:02:17.384501178Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚è±Ô∏è  [TIMING] TTS_TOTAL: 2ms (provider: elevenlabs, websocket: False)
2025-12-30T06:02:17.384502315Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚è±Ô∏è  [TIMING] AI_RESPONSE: 'This is Jake... I was just, um, wondering if you could possi...'
2025-12-30T06:02:17.384509685Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚è±Ô∏è  [TIMING] E2E_TOTAL: 636ms (user stopped ‚Üí play_audio_url called)
2025-12-30T06:02:17.384517116Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚è±Ô∏è  [TIMING] ‚ö†Ô∏è NOTE: E2E_TOTAL does not include:
2025-12-30T06:02:17.384524098Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚è±Ô∏è  [TIMING]   - Telnyx processing time (~50-200ms)
2025-12-30T06:02:17.384539412Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚è±Ô∏è  [TIMING]   - Network latency to user's phone (~50-150ms)
2025-12-30T06:02:17.384543995Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚è±Ô∏è  [TIMING]   - Phone audio buffering (~50-200ms)
2025-12-30T06:02:17.385479005Z [err]  2025-12-30 06:02:17,379 - server - INFO - ‚è±Ô∏è  [TIMING] ==========================
2025-12-30T06:02:17.385483307Z [err]  2025-12-30 06:02:17,380 - server - INFO - ‚è±Ô∏è  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
2025-12-30T06:02:17.568763924Z [err]  2025-12-30 06:02:17,565 - server - INFO - üìù Saved assistant transcript and latency to database (Node: Node Prompt: N001B_IntroAndHelpRequest_Only (V3 - Follows Name Confirmation), Dead Air: 643ms)
2025-12-30T06:02:17.568770738Z [err]  2025-12-30 06:02:17,565 - server - INFO - üîä Agent finished generating, 0 playbacks active - waiting for webhooks to close window and start silence tracking
2025-12-30T06:02:17.568775524Z [err]  2025-12-30 06:02:17,565 - server - INFO - üîç END CALL CHECK: should_end_call=False, max_checkins=False, max_duration=False
2025-12-30T06:02:17.641554259Z [err]  2025-12-30 06:02:17,638 - persistent_tts_service - INFO - üì§ Sending 8545 bytes of audio (54 chunks, 1.1s duration) via WebSocket
2025-12-30T06:02:17.641558407Z [err]  2025-12-30 06:02:17,639 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-30T06:02:17.641562783Z [err]  2025-12-30 06:02:17,639 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.1s (total: 1.1s from now)
2025-12-30T06:02:17.641566627Z [err]  2025-12-30 06:02:17,639 - persistent_tts_service - INFO - ‚úÖ Sent 54 audio chunks via WebSocket
2025-12-30T06:02:17.875789011Z [err]  2025-12-30 06:02:17,869 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-30T06:02:17.875797825Z [err]  2025-12-30 06:02:17,869 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +0.4s (total: 2.9s from now)
2025-12-30T06:02:17.875804797Z [err]  2025-12-30 06:02:17,869 - persistent_tts_service - INFO - ‚úÖ Sent 19 audio chunks via WebSocket
2025-12-30T06:02:17.875858352Z [err]  2025-12-30 06:02:17,866 - persistent_tts_service - INFO - üì§ Sending 13792 bytes of audio (87 chunks, 1.7s duration) via WebSocket
2025-12-30T06:02:17.875865469Z [err]  2025-12-30 06:02:17,867 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-30T06:02:17.875872253Z [err]  2025-12-30 06:02:17,867 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +1.7s (total: 2.6s from now)
2025-12-30T06:02:17.875878996Z [err]  2025-12-30 06:02:17,868 - persistent_tts_service - INFO - ‚úÖ Sent 87 audio chunks via WebSocket
2025-12-30T06:02:17.875885618Z [err]  2025-12-30 06:02:17,869 - persistent_tts_service - INFO - üì§ Sending 2926 bytes of audio (19 chunks, 0.4s duration) via WebSocket
2025-12-30T06:02:18.115387530Z [err]  2025-12-30 06:02:18,113 - persistent_tts_service - INFO - üì§ Sending 18948 bytes of audio (119 chunks, 2.4s duration) via WebSocket
2025-12-30T06:02:18.115393222Z [err]  2025-12-30 06:02:18,113 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-30T06:02:18.115398294Z [err]  2025-12-30 06:02:18,113 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +2.4s (total: 5.1s from now)
2025-12-30T06:02:18.116719829Z [err]  2025-12-30 06:02:18,114 - persistent_tts_service - INFO - ‚úÖ Sent 119 audio chunks via WebSocket
2025-12-30T06:02:18.673385689Z [err]  2025-12-30 06:02:18,672 - server - INFO - üì§ Audio flowing: 547 packets sent to Soniox (5s update)
2025-12-30T06:02:18.856802845Z [err]  2025-12-30 06:02:18,815 - server - INFO - üé§ Soniox receiver alive - 14 messages received in last 10s
2025-12-30T06:02:20.117079274Z [err]  2025-12-30 06:02:20,113 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-30T06:02:20.117088655Z [err]  2025-12-30 06:02:20,113 - persistent_tts_service - INFO - ‚úÖ [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Receiver finished sentence #2: 4 chunks in 2734ms
2025-12-30T06:02:20.117098710Z [err]  2025-12-30 06:02:20,113 - persistent_tts_service - INFO - üéß [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Receiver processing sentence #3: 'I was just, um, wondering if y...'
2025-12-30T06:02:20.117105972Z [err]  2025-12-30 06:02:20,113 - persistent_tts_service - INFO - üìä [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] DIAGNOSTIC: queue_latency=2734ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-30T06:02:20.389795719Z [err]  2025-12-30 06:02:20,388 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (2.8s left)
2025-12-30T06:02:20.903461232Z [err]  2025-12-30 06:02:20,901 - dead_air_monitor - INFO - üîá MONITOR: Skipping silence check - audio playing (2.3s left)
2025-12-30T06:02:22.618226101Z [err]  2025-12-30 06:02:22,613 - elevenlabs_ws_service - WARNING - ‚ö†Ô∏è  [TIMING] ElevenLabs timeout waiting for first chunk (2.5s) - No audio received!
2025-12-30T06:02:22.618231843Z [err]  2025-12-30 06:02:22,613 - persistent_tts_service - WARNING - ‚ö†Ô∏è [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Receiver got 0 chunks for sentence #3! interrupted=False
2025-12-30T06:02:23.470788751Z [err]  2025-12-30 06:02:23,468 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (0.3s ago), marking agent as done speaking
2025-12-30T06:02:23.470797008Z [err]  2025-12-30 06:02:23,468 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767074543.4682024 for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:23.470804714Z [err]  2025-12-30 06:02:23,468 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:23.470812091Z [err]  2025-12-30 06:02:23,468 - persistent_tts_service - INFO - üîá [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] FLOOR RELEASED (is_holding_floor=False)
2025-12-30T06:02:23.673662846Z [err]  2025-12-30 06:02:23,672 - server - INFO - üì§ Audio flowing: 796 packets sent to Soniox (5s update)
2025-12-30T06:02:25.320886183Z [err]  2025-12-30 06:02:25,318 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 867 total packets
2025-12-30T06:02:25.320890939Z [err]  [2025-12-30 06:02:25 +0000] [6] [INFO] connection closed
2025-12-30T06:02:25.482633451Z [err]  2025-12-30 06:02:25,473 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:02:25.482641973Z [err]  2025-12-30 06:02:25,473 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': 'ea36bacc-7f78-4900-908f-2ec99499fa51', 'occurred_at': '2025-12-30T06:02:25.071048Z', 'payload': {'call_control_id': 'v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg', 'call_leg_id': '0e01872e-e545-11f0-90d3-02420aef93a0', 'call_quality_stats': {'inbound': {'jitter_max_variance': '8.06', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '890', 'skip_packet_count': '22'}, 'outbound': {'packet_count': '870', 'skip_packet_count': '0'}}, 'call_session_id': '0dfe1760-e545-11f0-b8d6-02420aef93a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T06:02:25.071048Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-30T06:02:00.151047Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:02:25.482652280Z [err]  2025-12-30 06:02:25,473 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:25.482660039Z [err]  2025-12-30 06:02:25,473 - server - INFO - üì® ================================================
2025-12-30T06:02:25.482669449Z [err]  2025-12-30 06:02:25,473 - server - INFO - üìû Call ended: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:25.482678898Z [err]  2025-12-30 06:02:25,473 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-30T06:02:25.482687800Z [err]  2025-12-30 06:02:25,474 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:02:25.482696399Z [err]  2025-12-30 06:02:25,474 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'fb14cd99-0c39-47f8-8366-d28131eefd09', 'occurred_at': '2025-12-30T06:02:25.111049Z', 'payload': {'call_control_id': 'v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg', 'call_leg_id': '0e01872e-e545-11f0-90d3-02420aef93a0', 'call_session_id': '0dfe1760-e545-11f0-b8d6-02420aef93a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T06:02:25.111049Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'RY71G7UPiQ', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:02:25.483576871Z [err]  2025-12-30 06:02:25,474 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:25.483582243Z [err]  2025-12-30 06:02:25,474 - server - INFO - üì® ================================================
2025-12-30T06:02:25.494696856Z [err]  2025-12-30 06:02:25,493 - redis_service - INFO - ‚ûñ Removed playback RY71G7UPiQ, 0 remaining for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:25.494703318Z [err]  2025-12-30 06:02:25,493 - server - INFO - üîä Redis: Removed playback RY71G7UPiQ, 0 remaining
2025-12-30T06:02:25.494708348Z [err]  2025-12-30 06:02:25,493 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-30T06:02:25.500939769Z [err]  2025-12-30 06:02:25,499 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-30T06:02:25.500952511Z [err]  2025-12-30 06:02:25,500 - server - INFO - üí° Session not on this worker - Redis flag set for WebSocket worker to handle
2025-12-30T06:02:25.500994432Z [inf]  100.64.0.5:30842 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:02:25.512888607Z [err]  2025-12-30 06:02:25,507 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:02:25.512896621Z [err]  2025-12-30 06:02:25,508 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': '93ccd458-26a1-4c6b-af01-ddeff5df8610', 'occurred_at': '2025-12-30T06:02:25.246457Z', 'payload': {'call_control_id': 'v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg', 'call_leg_id': '0e01872e-e545-11f0-90d3-02420aef93a0', 'call_session_id': '0dfe1760-e545-11f0-b8d6-02420aef93a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': 'ce61796a-7fb6-417a-9ad0-aa891cc5ac47', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:02:25.512902201Z [err]  2025-12-30 06:02:25,508 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:25.512907557Z [err]  2025-12-30 06:02:25,508 - server - INFO - üì® ================================================
2025-12-30T06:02:25.512915134Z [inf]  100.64.0.6:10116 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:02:25.658353446Z [err]  2025-12-30 06:02:25,657 - server - INFO - üìù Updated call log: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:25.889511891Z [err]  2025-12-30 06:02:25,750 - server - INFO - ‚úÖ Finalized call log: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg (duration=17s, status=completed)
2025-12-30T06:02:25.889517767Z [err]  2025-12-30 06:02:25,842 - server - INFO - üì¶ Saved 10 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email']
2025-12-30T06:02:26.546940827Z [err]  2025-12-30 06:02:26,541 - server - INFO - üìä Auto-added call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-30T06:02:26.722737894Z [err]  2025-12-30 06:02:26,721 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-30T06:02:26.890387456Z [err]  2025-12-30 06:02:26,760 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=a7fe51b2-c944-4fa9-951b-20cd0e404aba, call_data=True
2025-12-30T06:02:26.890397359Z [err]  2025-12-30 06:02:26,819 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-30T06:02:26.890486318Z [err]  2025-12-30 06:02:26,728 - redis_service - INFO - üì• Retrieved call data from Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:26.890489903Z [err]  2025-12-30 06:02:26,728 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-30T06:02:26.890493418Z [err]  2025-12-30 06:02:26,728 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-30T06:02:26.890496903Z [err]  2025-12-30 06:02:26,746 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-30T06:02:26.890500474Z [err]  2025-12-30 06:02:26,746 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': '6fb38411-ed29-4237-9b6b-397afe4bea1b', 'occurred_at': '2025-12-30T06:02:26.550063Z', 'payload': {'call_control_id': 'v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg', 'call_leg_id': '0e01872e-e545-11f0-90d3-02420aef93a0', 'call_session_id': '0dfe1760-e545-11f0-b8d6-02420aef93a0', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-30T06:02:25.165876Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-30T06:02:25.165876Z', 'recording_id': 'a7fe51b2-c944-4fa9-951b-20cd0e404aba', 'recording_started_at': '2025-12-30T06:02:09.421298Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-30/0e01872e-e545-11f0-90d3-02420aef93a0-1767074528531053.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251230%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251230T060226Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=8a2280e0cf8e92bdc1cd8ba35163f5ecced654e12e37561653e96ceed5532c1e'}, 'start_time': '2025-12-30T06:02:09.421298Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-30T06:02:26.890504741Z [err]  2025-12-30 06:02:26,746 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:26.890677835Z [err]  2025-12-30 06:02:26,747 - server - INFO - üì® ================================================
2025-12-30T06:02:26.890681802Z [err]  2025-12-30 06:02:26,747 - server - INFO - üéôÔ∏è Recording saved for call: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:26.890686976Z [err]  2025-12-30 06:02:26,760 - redis_service - INFO - üì• Retrieved call data from Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:26.909125251Z [err]  2025-12-30 06:02:26,906 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-30T06:02:26.909131852Z [err]  2025-12-30 06:02:26,906 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-30T06:02:26.909136807Z [err]  2025-12-30 06:02:26,906 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-30T06:02:26.909141222Z [err]  2025-12-30 06:02:26,906 - server - INFO - üöÄ Triggered QC analysis for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:26.909146645Z [err]  2025-12-30 06:02:26,906 - server - INFO - üìä Triggered Campaign QC for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:26.909151694Z [err]  2025-12-30 06:02:26,906 - server - INFO - üìá Triggered CRM update for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:26.909151863Z [err]  2025-12-30 06:02:26,906 - persistent_tts_service - INFO - üîå [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Closing persistent TTS WebSocket...
2025-12-30T06:02:26.909161750Z [err]  2025-12-30 06:02:26,906 - server - INFO - üîç Starting QC analysis for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:26.909169315Z [err]  2025-12-30 06:02:26,906 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-30T06:02:26.909176755Z [err]  2025-12-30 06:02:26,907 - server - INFO - üìá CRM update starting for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:02:26.909841494Z [err]  2025-12-30 06:02:26,907 - server - INFO - üìá Normalized phone: +17708336397
2025-12-30T06:02:26.909848348Z [err]  2025-12-30 06:02:26,907 - server - INFO - üìá CRM: Got 10 variables from active session
2025-12-30T06:02:26.909854595Z [err]  2025-12-30 06:02:26,908 - persistent_tts_service - INFO - üõë [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Audio Receiver Loop CANCELLED
2025-12-30T06:02:26.909860270Z [err]  2025-12-30 06:02:26,908 - persistent_tts_service - INFO - üëã [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Audio Receiver Loop STOPPED
2025-12-30T06:02:26.909866388Z [err]  2025-12-30 06:02:26,908 - persistent_tts_service - INFO - üõë [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Playback consumer shutting down
2025-12-30T06:02:27.000402901Z [err]  2025-12-30 06:02:26,997 - server - INFO - üìù Converted transcript from 5 messages to 167 characters
2025-12-30T06:02:27.084557666Z [err]  2025-12-30 06:02:27,083 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:02:27.172078698Z [err]  2025-12-30 06:02:27,170 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-30T06:02:27.258153153Z [err]  2025-12-30 06:02:27,256 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-30T06:02:27.258162265Z [err]  2025-12-30 06:02:27,257 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-30T06:02:27.258169493Z [err]  2025-12-30 06:02:27,257 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:27.321909430Z [err]  2025-12-30 06:02:27,320 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-30T06:02:27.321914365Z [err]  2025-12-30 06:02:27,320 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-30T06:02:27.470838898Z [err]  2025-12-30 06:02:27,468 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=5, logs_count=6, status=completed
2025-12-30T06:02:27.472048223Z [err]  2025-12-30 06:02:27,471 - server - INFO - üìá CRM: Got 10 extracted variables
2025-12-30T06:02:27.472054511Z [err]  2025-12-30 06:02:27,471 - server - INFO - üìá CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email']
2025-12-30T06:02:27.640323954Z [err]  2025-12-30 06:02:27,637 - server - INFO - üíæ Saved recording URL and ID to database: a7fe51b2-c944-4fa9-951b-20cd0e404aba
2025-12-30T06:02:27.640331458Z [err]  2025-12-30 06:02:27,637 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-30T06:02:27.640336233Z [err]  2025-12-30 06:02:27,637 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-30T06:02:27.652683854Z [err]  2025-12-30 06:02:27,650 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-30T06:02:27.909897715Z [err]  2025-12-30 06:02:27,903 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-30T06:02:27.952499059Z [err]  2025-12-30 06:02:27,948 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-30/0e01872e-e545-11f0-90d3-02420aef93a0-1767074528531053.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251230%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251230T060226Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=8a2280e0cf8e92bdc1cd8ba35163f5ecced654e12e37561653e96ceed5532c1e "HTTP/1.1 200 OK"
2025-12-30T06:02:27.995944231Z [err]  2025-12-30 06:02:27,991 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-30T06:02:27.995948346Z [err]  2025-12-30 06:02:27,991 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-30T06:02:27.995952844Z [err]  2025-12-30 06:02:27,991 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-30T06:02:27.995956518Z [err]  2025-12-30 06:02:27,991 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-30T06:02:27.995960044Z [err]    File "/app/backend/server.py", line 9773, in trigger_campaign_qc_for_call
2025-12-30T06:02:27.995963647Z [err]      await run_full_qc_analysis(
2025-12-30T06:02:27.995968871Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-30T06:02:27.995972475Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-30T06:02:27.995976630Z [err]  
2025-12-30T06:02:28.023202241Z [err]  2025-12-30 06:02:28,021 - elevenlabs_ws_service - INFO - üîå Closed ElevenLabs WebSocket connection
2025-12-30T06:02:28.023205930Z [err]  2025-12-30 06:02:28,021 - persistent_tts_service - INFO - ‚úÖ [Call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg] Persistent TTS WebSocket closed
2025-12-30T06:02:28.023209842Z [err]  2025-12-30 06:02:28,021 - persistent_tts_service - INFO - ‚úÖ Closed persistent TTS session for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:28.023213858Z [err]  2025-12-30 06:02:28,021 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:28.035014698Z [err]  2025-12-30 06:02:28,030 - redis_service - INFO - üßπ Deleted call data from Redis: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:28.035020133Z [err]  2025-12-30 06:02:28,030 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:28.035024282Z [inf]  100.64.0.6:10102 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:02:28.040158722Z [err]  2025-12-30 06:02:28,036 - server - INFO - ‚úÖ Downloaded 63154 bytes
2025-12-30T06:02:28.045331821Z [err]  2025-12-30 06:02:28,041 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:28.194648383Z [err]  2025-12-30 06:02:28,191 - server - INFO - ‚úÖ Split into 2 channels
2025-12-30T06:02:28.194650040Z [inf]  100.64.0.6:10116 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-30T06:02:28.194655090Z [err]  2025-12-30 06:02:28,191 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-30T06:02:28.194659701Z [err]  2025-12-30 06:02:28,192 - server - INFO - üìä Channel 0: 344124 bytes
2025-12-30T06:02:28.194664969Z [err]  2025-12-30 06:02:28,192 - server - ERROR - ‚ùå No Soniox API key available
2025-12-30T06:02:28.194669296Z [err]  2025-12-30 06:02:28,192 - server - INFO - ‚ùå Channel 0: No speech
2025-12-30T06:02:28.194673279Z [err]  2025-12-30 06:02:28,192 - server - INFO - üìä Channel 1: 344124 bytes
2025-12-30T06:02:28.194677248Z [err]  2025-12-30 06:02:28,192 - server - ERROR - ‚ùå No Soniox API key available
2025-12-30T06:02:28.194680866Z [err]  2025-12-30 06:02:28,192 - server - INFO - ‚ùå Channel 1: No speech
2025-12-30T06:02:28.194684846Z [err]  2025-12-30 06:02:28,192 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-30T06:02:28.472665397Z [err]  2025-12-30 06:02:28,471 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T06:02:28.473710044Z [err]  2025-12-30 06:02:28,472 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:02:28.473716038Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T06:02:28.473720287Z [err]  2025-12-30 06:02:28,472 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:02:28.473724850Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-30T06:02:28.474591106Z [err]  2025-12-30 06:02:28,473 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:28.550387364Z [err]  2025-12-30 06:02:28,548 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:29.059193243Z [err]  2025-12-30 06:02:29,055 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:29.386905193Z [err]  2025-12-30 06:02:29,384 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T06:02:29.386912544Z [err]  2025-12-30 06:02:29,384 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:02:29.386918508Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T06:02:29.386924530Z [err]  2025-12-30 06:02:29,384 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:02:29.386930781Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429, falling back to patterns
2025-12-30T06:02:29.386937006Z [err]  2025-12-30 06:02:29,385 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:29.563298065Z [err]  2025-12-30 06:02:29,562 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:29.568830347Z [err]  2025-12-30 06:02:29,565 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 429 Too Many Requests"
2025-12-30T06:02:29.568834601Z [err]  2025-12-30 06:02:29,565 - qc_agents.base_agent - ERROR - Error calling LLM (openai): Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:02:29.568839140Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T06:02:29.568843172Z [err]  2025-12-30 06:02:29,565 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Client error '429 Too Many Requests' for url 'https://api.openai.com/v1/chat/completions'
2025-12-30T06:02:29.568846783Z [err]  For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429
2025-12-30T06:02:29.661033445Z [err]  2025-12-30 06:02:29,660 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:29.661040585Z [err]  2025-12-30 06:02:29,660 - server - INFO - ‚úÖ QC analysis completed for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:29.661049494Z [err]  2025-12-30 06:02:29,660 - server - INFO - üìä Scores: Commitment=50, Conversion=20, Excellence=50
2025-12-30T06:02:29.899293735Z [err]  2025-12-30 06:02:29,847 - server - INFO - üìä Updated campaign_calls with QC scores for v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:30.029602002Z [err]  2025-12-30 06:02:30,024 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-30T06:02:30.071918540Z [err]  2025-12-30 06:02:30,069 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:30.071922740Z [err]  2025-12-30 06:02:30,069 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=6.6s, checkin_count=0/2
2025-12-30T06:02:30.113547838Z [err]  2025-12-30 06:02:30,111 - server - INFO - üè∑Ô∏è Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-30T06:02:30.113555443Z [err]  2025-12-30 06:02:30,112 - server - ERROR - ‚ùå Error in auto appointment detection for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg: 'str' object has no attribute 'get'
2025-12-30T06:02:30.578625354Z [err]  2025-12-30 06:02:30,577 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:30.578631669Z [err]  2025-12-30 06:02:30,577 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=7.1s, checkin_count=0/2
2025-12-30T06:02:30.578638647Z [err]  2025-12-30 06:02:30,577 - core_calling_service - INFO - ‚è∞ Check-in triggered after 7.1s silence (threshold: 7s)
2025-12-30T06:02:30.591046428Z [err]  2025-12-30 06:02:30,584 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-30T06:02:30.591050610Z [err]  2025-12-30 06:02:30,584 - core_calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-30T06:02:30.591061449Z [err]  2025-12-30 06:02:30,584 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.1s silence: Are you still there?
2025-12-30T06:02:30.591069746Z [err]  2025-12-30 06:02:30,584 - core_calling_service - INFO - ü§ñ Agent started speaking for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:30.591078369Z [err]  2025-12-30 06:02:30,584 - telnyx_service - INFO - üîä Speaking text on call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg: Are you still there?...
2025-12-30T06:02:30.591086402Z [err]  2025-12-30 06:02:30,584 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-30T06:02:30.591096187Z [err]  2025-12-30 06:02:30,584 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-30T06:02:30.591103811Z [err]  2025-12-30 06:02:30,584 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-30T06:02:30.591110965Z [err]  2025-12-30 06:02:30,584 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-30T06:02:30.591118704Z [err]  2025-12-30 06:02:30,584 - server - INFO - ‚è±Ô∏è [06:02:30.584] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-30T06:02:30.591126262Z [err]  2025-12-30 06:02:30,584 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-30T06:02:30.676153886Z [err]  2025-12-30 06:02:30,672 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-30T06:02:30.676160198Z [err]  2025-12-30 06:02:30,672 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-30T06:02:30.676165624Z [err]  2025-12-30 06:02:30,672 - server - INFO -    Text length: 20 chars
2025-12-30T06:02:30.676170206Z [err]  2025-12-30 06:02:30,672 - server - INFO -    Text content: 'Are you still there?'
2025-12-30T06:02:30.676174693Z [err]  2025-12-30 06:02:30,672 - server - INFO -    Text bytes: b'Are you still there?'
2025-12-30T06:02:30.676178395Z [err]  2025-12-30 06:02:30,672 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-30T06:02:30.676182004Z [err]  2025-12-30 06:02:30,672 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-30T06:02:30.676186945Z [err]  2025-12-30 06:02:30,672 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-30T06:02:30.676193534Z [err]  2025-12-30 06:02:30,672 - server - INFO -    Full data: {'text': 'Are you still there?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-30T06:02:30.676201065Z [err]  2025-12-30 06:02:30,672 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-30T06:02:30.676207849Z [err]  2025-12-30 06:02:30,672 - server - INFO -    Timeout: 10.0s
2025-12-30T06:02:30.682878170Z [err]  2025-12-30 06:02:30,679 - server - INFO -    ‚úì HTTP client created (0.008s)
2025-12-30T06:02:30.682886705Z [err]  2025-12-30 06:02:30,680 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-30T06:02:30.997886693Z [err]  2025-12-30 06:02:30,995 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-30T06:02:30.997892957Z [err]  2025-12-30 06:02:30,995 - server - INFO -    ‚úì Connection established (0.323s) [TARGET: <200ms]
2025-12-30T06:02:30.997897407Z [err]  2025-12-30 06:02:30,995 - server - INFO -    ‚úì Response status: 200
2025-12-30T06:02:30.997901658Z [err]  2025-12-30 06:02:30,995 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-30T06:02:31.006636938Z [err]  2025-12-30 06:02:31,005 - server - INFO -    ‚úì FIRST CHUNK received (0.333s, 1007 bytes) [TARGET: <300ms]
2025-12-30T06:02:31.019391540Z [err]  2025-12-30 06:02:31,014 - server - INFO -    ‚úì ALL CHUNKS received: 61 chunks (0.343s)
2025-12-30T06:02:31.019400396Z [err]  2025-12-30 06:02:31,015 - server - INFO -    ‚úì Total audio size: 17599 bytes
2025-12-30T06:02:31.019405683Z [err]  2025-12-30 06:02:31,015 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-30T06:02:31.019411813Z [err]  2025-12-30 06:02:31,015 - server - INFO -       - Connection: 323ms
2025-12-30T06:02:31.019416711Z [err]  2025-12-30 06:02:31,015 - server - INFO -       - First chunk: 333ms
2025-12-30T06:02:31.019421463Z [err]  2025-12-30 06:02:31,015 - server - INFO -       - All chunks: 343ms
2025-12-30T06:02:31.019425594Z [err]  2025-12-30 06:02:31,015 - server - INFO -       - Audio generation only: 10ms
2025-12-30T06:02:31.019430319Z [err]  2025-12-30 06:02:31,015 - server - INFO - ‚è±Ô∏è [06:02:31.015] üîä TTS COMPLETE: 430ms, audio_size=17599 bytes
2025-12-30T06:02:31.019434797Z [err]  2025-12-30 06:02:31,015 - server - INFO - üíæ TTS CACHED: elevenlabs:Are you still there?... (17599 bytes)
2025-12-30T06:02:31.019440880Z [err]  2025-12-30 06:02:31,015 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.43s
2025-12-30T06:02:31.019445133Z [err]  2025-12-30 06:02:31,015 - telnyx_service - INFO - ‚úÖ Generated 17599 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T06:02:31.019449233Z [err]  2025-12-30 06:02:31,015 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-30T06:02:31.306592409Z [err]      {
2025-12-30T06:02:31.306604894Z [err]        "code": "90018",
2025-12-30T06:02:31.306611813Z [err]        "title": "Call has already ended",
2025-12-30T06:02:31.306616037Z [err]  2025-12-30 06:02:31,304 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T06:02:31.306618894Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-30T06:02:31.306626765Z [err]  2025-12-30 06:02:31,305 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.29s
2025-12-30T06:02:31.306664337Z [err]  }
2025-12-30T06:02:31.306665663Z [err]  2025-12-30 06:02:31,305 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-30T06:02:31.306668605Z [err]      }
2025-12-30T06:02:31.306674265Z [err]  2025-12-30 06:02:31,305 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-30T06:02:31.306675479Z [err]    "errors": [
2025-12-30T06:02:31.306679656Z [err]    ]
2025-12-30T06:02:31.578234822Z [err]  2025-12-30 06:02:31,576 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-30T06:02:31.578241762Z [err]  2025-12-30 06:02:31,577 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-30T06:02:31.578245634Z [err]  2025-12-30 06:02:31,577 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-30T06:02:32.087553963Z [err]  2025-12-30 06:02:32,084 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-30T06:02:32.087563716Z [err]  2025-12-30 06:02:32,084 - core_calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1767074552.084503 for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:32.087572327Z [err]  2025-12-30 06:02:32,084 - core_calling_service - INFO - ü§ñ Agent stopped speaking for call v3:hTSglL84EMXJKPqJp6-dNnjCqZWUhfv7GPcpugtSM39r_gg015M3Eg
2025-12-30T06:02:32.093089778Z [err]  2025-12-30 06:02:32,090 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:32.601475895Z [err]  2025-12-30 06:02:32,598 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:33.107363931Z [err]  2025-12-30 06:02:33,104 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:33.618159252Z [err]  2025-12-30 06:02:33,611 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:34.122533800Z [err]  2025-12-30 06:02:34,118 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:34.630041094Z [err]  2025-12-30 06:02:34,625 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:35.135311143Z [err]  2025-12-30 06:02:35,132 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:35.640050686Z [err]  2025-12-30 06:02:35,639 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:36.147418675Z [err]  2025-12-30 06:02:36,145 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:36.663611017Z [err]  2025-12-30 06:02:36,652 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:37.164169709Z [err]  2025-12-30 06:02:37,158 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:37.671203092Z [err]  2025-12-30 06:02:37,668 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:38.182316197Z [err]  2025-12-30 06:02:38,177 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])
2025-12-30T06:02:38.686045487Z [err]  2025-12-30 06:02:38,683 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:hTSglL84EMXJKPqJp... (active sessions: [])