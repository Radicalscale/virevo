2025-12-26T15:22:13.000000000Z [inf]  Starting Container
2025-12-26T15:22:14.513385658Z [err]  [2025-12-26 15:22:14 +0000] [3] [INFO] Booting worker with pid: 3
2025-12-26T15:22:14.513443327Z [inf]  =========================================
2025-12-26T15:22:14.513447700Z [inf]  üöÄ START.SH SCRIPT IS EXECUTING
2025-12-26T15:22:14.513452784Z [inf]  =========================================
2025-12-26T15:22:14.513457081Z [inf]  üìç Working directory: /app/backend
2025-12-26T15:22:14.513464359Z [inf]  üîç Python path: /app/backend
2025-12-26T15:22:14.513470990Z [inf]  üåê Starting Gunicorn on 0.0.0.0:8080...
2025-12-26T15:22:14.513477103Z [inf]  =========================================
2025-12-26T15:22:14.513482336Z [err]  [2025-12-26 15:22:14 +0000] [1] [INFO] Starting gunicorn 22.0.0
2025-12-26T15:22:14.513487962Z [err]  [2025-12-26 15:22:14 +0000] [1] [INFO] Listening at: http://0.0.0.0:8080 (1)
2025-12-26T15:22:14.513493919Z [err]  [2025-12-26 15:22:14 +0000] [1] [INFO] Using worker: uvicorn.workers.UvicornWorker
2025-12-26T15:22:14.526516895Z [err]  [2025-12-26 15:22:14 +0000] [4] [INFO] Booting worker with pid: 4
2025-12-26T15:22:14.626113001Z [err]  [2025-12-26 15:22:14 +0000] [5] [INFO] Booting worker with pid: 5
2025-12-26T15:22:14.634771840Z [err]  [2025-12-26 15:22:14 +0000] [6] [INFO] Booting worker with pid: 6
2025-12-26T15:22:34.713055439Z [err]  2025-12-26 15:22:28,048 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-26T15:22:34.713063386Z [err]  2025-12-26 15:22:28,048 - server - INFO - üî• Pre-warming connection libraries...
2025-12-26T15:22:34.713068261Z [err]  2025-12-26 15:22:28,079 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-26T15:22:34.713130052Z [err]  2025-12-26 15:22:27,920 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-26T15:22:34.713146543Z [err]  2025-12-26 15:22:27,921 - server - INFO - üî• Pre-warming connection libraries...
2025-12-26T15:22:34.713157023Z [err]  2025-12-26 15:22:27,921 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-26T15:22:34.713166055Z [err]  2025-12-26 15:22:27,921 - server - INFO - üî• Pre-warming connection libraries...
2025-12-26T15:22:34.713174804Z [err]  2025-12-26 15:22:27,953 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-26T15:22:34.713182249Z [err]  2025-12-26 15:22:27,955 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-26T15:22:34.713488202Z [err]  2025-12-26 15:22:28,091 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-26T15:22:34.713523470Z [err]  2025-12-26 15:22:28,099 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-26T15:22:34.713530875Z [err]  2025-12-26 15:22:28,180 - server - INFO - ‚ÑπÔ∏è  RAG service disabled (set ENABLE_RAG=true to enable semantic search)
2025-12-26T15:22:34.713537242Z [err]  2025-12-26 15:22:28,180 - server - INFO - üî• Pre-warming connection libraries...
2025-12-26T15:22:34.713555797Z [err]  2025-12-26 15:22:28,201 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-26T15:22:34.715085700Z [err]  2025-12-26 15:22:28,256 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-26T15:22:34.715098741Z [err]  2025-12-26 15:22:28,267 - server - INFO - ‚úÖ QC agent router loaded
2025-12-26T15:22:34.715112380Z [err]  2025-12-26 15:22:28,271 - server - INFO - ‚úÖ QC agent router loaded
2025-12-26T15:22:34.715120248Z [err]  2025-12-26 15:22:28,291 - server - INFO - ‚úÖ QC learning router loaded
2025-12-26T15:22:34.715127118Z [err]  2025-12-26 15:22:28,292 - server - INFO - ‚úÖ QC agent router loaded
2025-12-26T15:22:34.715135025Z [err]  2025-12-26 15:22:28,297 - server - INFO - ‚úÖ QC learning router loaded
2025-12-26T15:22:34.715147895Z [err]  2025-12-26 15:22:28,311 - server - INFO - ‚úÖ QC learning router loaded
2025-12-26T15:22:34.715154582Z [err]  2025-12-26 15:22:28,372 - server - INFO - ‚úÖ CORS configured for origins: ['https://app.li-ai.org', 'https://li-ai.org']
2025-12-26T15:22:34.715162813Z [err]  2025-12-26 15:22:28,407 - server - INFO - ‚úÖ CRM router loaded
2025-12-26T15:22:34.715170114Z [err]  2025-12-26 15:22:28,410 - server - INFO - ‚úÖ CRM router loaded
2025-12-26T15:22:34.715177554Z [err]  2025-12-26 15:22:28,422 - server - INFO - ‚úÖ QC test router loaded
2025-12-26T15:22:34.715184386Z [err]  2025-12-26 15:22:28,423 - server - INFO - ‚úÖ CRM router loaded
2025-12-26T15:22:34.715190906Z [err]  2025-12-26 15:22:28,424 - server - INFO - ‚úÖ QC test router loaded
2025-12-26T15:22:34.715201207Z [err]  2025-12-26 15:22:28,427 - server - INFO - ‚úÖ QC test router loaded
2025-12-26T15:22:34.715202747Z [err]  2025-12-26 15:22:28,214 - server - INFO - ‚úÖ Connection libraries pre-warmed (websockets, httpx, ElevenLabs, Soniox)
2025-12-26T15:22:34.715215274Z [err]  2025-12-26 15:22:28,444 - server - INFO - ‚úÖ Agent test router loaded
2025-12-26T15:22:34.715215705Z [err]  2025-12-26 15:22:28,215 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-26T15:22:34.715225120Z [err]  2025-12-26 15:22:28,230 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-26T15:22:34.718601063Z [err]  [2025-12-26 15:22:28 +0000] [4] [INFO] Started server process [4]
2025-12-26T15:22:34.718615138Z [err]  [2025-12-26 15:22:28 +0000] [4] [INFO] Waiting for application startup.
2025-12-26T15:22:34.718625518Z [err]  2025-12-26 15:22:28,447 - server - INFO - ‚úÖ Agent test router loaded
2025-12-26T15:22:34.718627322Z [err]  2025-12-26 15:22:28,489 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-26T15:22:34.718638826Z [err]  2025-12-26 15:22:28,449 - server - INFO - ‚úÖ Agent test router loaded
2025-12-26T15:22:34.718641826Z [err]  2025-12-26 15:22:28,489 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-26T15:22:34.718650135Z [err]  2025-12-26 15:22:28,450 - server - INFO - ‚úÖ QC enhanced router loaded
2025-12-26T15:22:34.718658281Z [err]  2025-12-26 15:22:28,457 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-26T15:22:34.718667990Z [err]  2025-12-26 15:22:28,457 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-26T15:22:34.718678350Z [err]  2025-12-26 15:22:28,458 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-26T15:22:34.718686881Z [err]  2025-12-26 15:22:28,459 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-26T15:22:34.718695351Z [err]  2025-12-26 15:22:28,461 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-26T15:22:34.718704077Z [err]  2025-12-26 15:22:28,461 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-26T15:22:34.718715741Z [err]  [2025-12-26 15:22:28 +0000] [6] [INFO] Started server process [6]
2025-12-26T15:22:34.718722761Z [err]  [2025-12-26 15:22:28 +0000] [6] [INFO] Waiting for application startup.
2025-12-26T15:22:34.718729776Z [err]  [2025-12-26 15:22:28 +0000] [5] [INFO] Started server process [5]
2025-12-26T15:22:34.718735817Z [err]  [2025-12-26 15:22:28 +0000] [5] [INFO] Waiting for application startup.
2025-12-26T15:22:34.720700677Z [err]  2025-12-26 15:22:28,762 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-26T15:22:34.720706814Z [err]  2025-12-26 15:22:28,491 - server - INFO - üéµ Pre-generating comfort noise file on startup (5 minutes for seamless loops)...
2025-12-26T15:22:34.720720340Z [err]  2025-12-26 15:22:28,504 - server - INFO - ‚úÖ QC agent router loaded
2025-12-26T15:22:34.720734077Z [err]  2025-12-26 15:22:28,730 - server - INFO - ‚úÖ Director Studio router loaded
2025-12-26T15:22:34.720734579Z [err]  2025-12-26 15:22:28,533 - server - INFO - ‚úÖ QC learning router loaded
2025-12-26T15:22:34.720747636Z [err]  2025-12-26 15:22:28,692 - server - INFO - ‚úÖ CRM router loaded
2025-12-26T15:22:34.720750659Z [err]  2025-12-26 15:22:28,730 - server - INFO - ‚úÖ QC agents orchestrator loaded
2025-12-26T15:22:34.720762761Z [err]  2025-12-26 15:22:28,697 - server - INFO - ‚úÖ QC test router loaded
2025-12-26T15:22:34.720764649Z [err]  [2025-12-26 15:22:28 +0000] [3] [INFO] Started server process [3]
2025-12-26T15:22:34.720776911Z [err]  2025-12-26 15:22:28,719 - server - INFO - ‚úÖ Agent test router loaded
2025-12-26T15:22:34.720781373Z [err]  [2025-12-26 15:22:28 +0000] [3] [INFO] Waiting for application startup.
2025-12-26T15:22:35.682644154Z [err]  2025-12-26 15:22:35,635 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-26T15:22:35.682650508Z [err]  2025-12-26 15:22:35,639 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-26T15:22:35.682657144Z [err]  2025-12-26 15:22:35,639 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-26T15:22:35.682665329Z [err]  2025-12-26 15:22:35,639 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-26T15:22:35.715638166Z [err]  2025-12-26 15:22:35,714 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-26T15:22:35.722596116Z [err]  2025-12-26 15:22:35,719 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-26T15:22:35.722602896Z [err]  2025-12-26 15:22:35,720 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-26T15:22:35.722607686Z [err]  2025-12-26 15:22:35,720 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-26T15:22:36.194155711Z [err]  2025-12-26 15:22:36,186 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-26T15:22:36.194163782Z [err]  2025-12-26 15:22:36,192 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-26T15:22:36.194169686Z [err]  2025-12-26 15:22:36,192 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-26T15:22:36.194174041Z [err]  2025-12-26 15:22:36,192 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-26T15:22:36.537964936Z [err]  2025-12-26 15:22:36,423 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-26T15:22:36.537981725Z [err]  2025-12-26 15:22:36,510 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-26T15:22:36.537992997Z [err]  2025-12-26 15:22:36,511 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-26T15:22:36.538000878Z [err]  [2025-12-26 15:22:36 +0000] [5] [INFO] Application startup complete.
2025-12-26T15:22:36.767075688Z [err]  2025-12-26 15:22:36,765 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-26T15:22:36.827869926Z [err]  2025-12-26 15:22:36,824 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-26T15:22:36.876897181Z [err]  2025-12-26 15:22:36,875 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-26T15:22:36.876905028Z [err]  2025-12-26 15:22:36,875 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-26T15:22:36.876910149Z [err]  [2025-12-26 15:22:36 +0000] [6] [INFO] Application startup complete.
2025-12-26T15:22:36.950021359Z [err]  2025-12-26 15:22:36,948 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-26T15:22:36.950027013Z [err]  2025-12-26 15:22:36,949 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-26T15:22:36.952321082Z [err]  [2025-12-26 15:22:36 +0000] [4] [INFO] Application startup complete.
2025-12-26T15:22:37.052281619Z [err]  2025-12-26 15:22:37,048 - comfort_noise - INFO - Generated continuous comfort noise: /tmp/comfort_noise_continuous.mp3 (300s, white=-83dB, hum=-93dB)
2025-12-26T15:22:37.052289561Z [err]  2025-12-26 15:22:37,050 - server - INFO - ‚úÖ Comfort noise MP3 ready for immediate use
2025-12-26T15:22:37.052296789Z [err]  2025-12-26 15:22:37,050 - server - INFO - üéµ Pre-warming mulaw comfort noise for WebSocket streaming...
2025-12-26T15:22:37.052302174Z [err]  2025-12-26 15:22:37,050 - comfort_noise - INFO - üéµ Loading mulaw comfort noise for WebSocket mixing...
2025-12-26T15:22:38.045214310Z [err]  2025-12-26 15:22:38,041 - comfort_noise - INFO - ‚úÖ Generated comfort noise sample: 30s (white=-83dB, hum=-93dB)
2025-12-26T15:22:38.130525245Z [err]  2025-12-26 15:22:38,128 - comfort_noise - INFO - ‚úÖ Generated mulaw comfort noise: 240000 bytes
2025-12-26T15:22:38.130534188Z [err]  2025-12-26 15:22:38,129 - server - INFO - ‚úÖ Mulaw comfort noise ready (240000 bytes)
2025-12-26T15:22:38.130540176Z [err]  [2025-12-26 15:22:38 +0000] [3] [INFO] Application startup complete.
2025-12-26T19:08:03.811110301Z [inf]  100.64.0.2:42490 - "GET /.env HTTP/1.1" 404
2025-12-26T20:58:11.157129311Z [inf]  100.64.0.3:28348 - "GET /robots.txt HTTP/1.1" 404
2025-12-26T20:58:11.157142833Z [inf]  100.64.0.4:37354 - "GET / HTTP/1.1" 404
2025-12-26T21:11:43.360880891Z [inf]  100.64.0.5:40124 - "GET /robots.txt HTTP/1.1" 404
2025-12-26T23:57:51.960260481Z [inf]  100.64.0.6:43992 - "GET /robots.txt HTTP/1.1" 404
2025-12-27T01:06:13.246705832Z [inf]  100.64.0.7:35556 - "POST / HTTP/1.1" 404
2025-12-27T04:27:40.437854257Z [inf]  100.64.0.4:21404 - "GET /api/auth/me HTTP/1.1" 401
2025-12-27T04:27:40.437866703Z [inf]  100.64.0.6:61160 - "OPTIONS /api/auth/login HTTP/1.1" 200
2025-12-27T04:27:40.889930926Z [inf]  100.64.0.8:59224 - "POST /api/auth/login HTTP/1.1" 200
2025-12-27T04:27:41.767603923Z [inf]  100.64.0.8:59224 - "GET /api/agents HTTP/1.1" 200
2025-12-27T04:27:51.428102386Z [inf]  100.64.0.6:61160 - "GET /api/agents HTTP/1.1" 200
2025-12-27T04:28:11.147853009Z [err]  2025-12-27 04:28:09,687 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-27T04:28:11.147859220Z [err]  2025-12-27 04:28:09,687 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-27T04:28:11.147862882Z [inf]  100.64.0.3:53004 - "OPTIONS /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-27T04:28:11.147863890Z [err]  2025-12-27 04:28:08,862 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-27T04:28:11.147872824Z [err]  2025-12-27 04:28:08,652 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-27T04:28:11.147874034Z [err]  2025-12-27 04:28:09,580 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-27T04:28:11.147882637Z [err]  2025-12-27 04:28:08,750 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:11.147882685Z [err]  2025-12-27 04:28:09,583 - telnyx_service - INFO - ‚úÖ Call initiated: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:11.147888640Z [err]  2025-12-27 04:28:09,687 - server - INFO - üìù Created call log: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:11.147890937Z [err]  2025-12-27 04:28:08,840 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:11.147896842Z [err]  2025-12-27 04:28:08,862 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-27T04:28:11.147901915Z [err]  2025-12-27 04:28:08,862 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-27T04:28:11.147908463Z [err]  2025-12-27 04:28:08,862 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-27T04:28:11.149656213Z [err]  2025-12-27 04:28:09,687 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-27T04:28:11.149665692Z [err]  2025-12-27 04:28:09,687 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-27T04:28:11.149672504Z [err]  2025-12-27 04:28:09,693 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q (TTL: 3600s)
2025-12-27T04:28:11.149679986Z [err]  2025-12-27 04:28:09,693 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-27T04:28:11.149686110Z [err]  2025-12-27 04:28:09,693 - server - INFO - üìû Outbound call initiated: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:11.149692615Z [inf]  100.64.0.6:61160 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-27T04:28:11.149701149Z [err]  2025-12-27 04:28:09,955 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-27T04:28:11.149707412Z [err]  2025-12-27 04:28:09,955 - server - INFO -    Client: Address(host='100.64.0.9', port=45470)
2025-12-27T04:28:11.149713644Z [err]  2025-12-27 04:28:09,955 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'QT9gE2FSUUxMqZZn74e9eA==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'up8Q1xF8ToCichV3-_9nXA', 'x-real-ip': '192.76.120.151', 'x-request-start': '1766809689733', 'accept-encoding': 'gzip'}
2025-12-27T04:28:11.149721935Z [err]  2025-12-27 04:28:09,956 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-27T04:28:11.149728505Z [err]  2025-12-27 04:28:09,956 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-27T04:28:11.152096262Z [err]  [2025-12-27 04:28:09 +0000] [3] [INFO] ('100.64.0.9', 45470) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-27T04:28:11.152104274Z [err]  2025-12-27 04:28:09,956 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-27T04:28:11.152114007Z [err]  [2025-12-27 04:28:09 +0000] [3] [INFO] connection open
2025-12-27T04:28:11.152119676Z [err]  2025-12-27 04:28:10,115 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-27T04:28:11.152125855Z [err]  2025-12-27 04:28:10,115 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-27T04:28:11.152131868Z [err]  2025-12-27 04:28:10,120 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:11.152137963Z [err]  2025-12-27 04:28:10,120 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': 'd78cc170-1b1b-4718-9326-4642e10dee3a', 'occurred_at': '2025-12-27T04:28:09.463969Z', 'payload': {'call_control_id': 'v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q', 'call_leg_id': '72a61372-e2dc-11f0-849d-02420aef98a0', 'call_session_id': '72a2da22-e2dc-11f0-b9d6-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:11.152143909Z [err]  2025-12-27 04:28:10,120 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:11.152150473Z [err]  2025-12-27 04:28:10,120 - server - INFO - üì® ================================================
2025-12-27T04:28:11.152157350Z [err]  2025-12-27 04:28:10,120 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-27T04:28:11.152164895Z [inf]  100.64.0.10:17976 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:11.154265423Z [err]  2025-12-27 04:28:10,462 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-27T04:28:11.154269618Z [err]  2025-12-27 04:28:10,463 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-27T04:28:12.858808689Z [err]  2025-12-27 04:28:12,857 - server - INFO - üì¨ Received Telnyx event: start
2025-12-27T04:28:12.858814794Z [err]  2025-12-27 04:28:12,857 - server - INFO - üé¨ Stream started for call: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:12.867800964Z [err]  2025-12-27 04:28:12,862 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:12.867810000Z [err]  2025-12-27 04:28:12,863 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-27T04:28:12.867816340Z [err]  2025-12-27 04:28:12,863 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-27T04:28:13.168364960Z [err]  2025-12-27 04:28:13,161 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:13.168374125Z [err]  2025-12-27 04:28:13,161 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': '4571beea-c835-489f-a147-a0c89fbc0998', 'occurred_at': '2025-12-27T04:28:12.743967Z', 'payload': {'call_control_id': 'v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q', 'call_leg_id': '72a61372-e2dc-11f0-849d-02420aef98a0', 'call_session_id': '72a2da22-e2dc-11f0-b9d6-02420aef98a0', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-27T04:28:09.463969Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:13.168380502Z [err]  2025-12-27 04:28:13,161 - server - INFO - üéØ Event type: call.answered, Call ID: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:13.168386532Z [err]  2025-12-27 04:28:13,161 - server - INFO - üì® ================================================
2025-12-27T04:28:13.168392479Z [err]  2025-12-27 04:28:13,162 - server - INFO - ‚úÖ Call answered: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:13.171181617Z [err]  2025-12-27 04:28:13,167 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:13.171190257Z [err]  2025-12-27 04:28:13,167 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-27T04:28:13.171196090Z [err]  2025-12-27 04:28:13,168 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-27T04:28:13.566716630Z [err]  2025-12-27 04:28:13,274 - server - INFO - ‚úÖ Call log updated
2025-12-27T04:28:13.566721729Z [err]  2025-12-27 04:28:13,274 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-27T04:28:13.566725103Z [err]  2025-12-27 04:28:13,364 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-27T04:28:13.566727970Z [err]  2025-12-27 04:28:13,274 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-27T04:28:13.566732849Z [err]  2025-12-27 04:28:13,369 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:13.566735700Z [err]  2025-12-27 04:28:13,275 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-27T04:28:13.566740409Z [err]  2025-12-27 04:28:13,372 - server - INFO - üìù Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-27T04:28:13.566743420Z [err]  2025-12-27 04:28:13,364 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-27T04:28:13.566746549Z [err]  2025-12-27 04:28:13,372 - calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-27T04:28:13.566751014Z [err]  2025-12-27 04:28:13,373 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:13.566755275Z [err]  2025-12-27 04:28:13,463 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:13.566760583Z [err]  2025-12-27 04:28:13,464 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': '0d4e09e9-ae63-4124-9bb5-6f9241807c8b', 'occurred_at': '2025-12-27T04:28:13.023966Z', 'payload': {'call_control_id': 'v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q', 'call_leg_id': '72a61372-e2dc-11f0-849d-02420aef98a0', 'call_session_id': '72a2da22-e2dc-11f0-b9d6-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '078c730e-96af-4f7d-b5e0-a9eaf69c6110', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:13.568112105Z [err]  2025-12-27 04:28:13,464 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:13.568117971Z [err]  2025-12-27 04:28:13,464 - server - INFO - üì® ================================================
2025-12-27T04:28:13.568122351Z [inf]  100.64.0.11:17078 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:13.568127083Z [err]  2025-12-27 04:28:13,475 - calling_service - INFO - üîç KB count query completed: 4 items
2025-12-27T04:28:13.568131101Z [err]  2025-12-27 04:28:13,475 - calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-27T04:28:13.568135726Z [err]  2025-12-27 04:28:13,497 - calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-27T04:28:13.568139489Z [err]  2025-12-27 04:28:13,497 - calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-27T04:28:13.568144262Z [err]  2025-12-27 04:28:13,498 - calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-27T04:28:13.601584272Z [err]  2025-12-27 04:28:13,589 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:13.601586189Z [err]  2025-12-27 04:28:13,598 - server - INFO - ‚úÖ Stored Telnyx WebSocket in call_data for audio streaming
2025-12-27T04:28:13.601594475Z [err]  2025-12-27 04:28:13,596 - calling_service - INFO - ‚úÖ LLM client pre-warmed in 97ms
2025-12-27T04:28:13.601599318Z [err]  2025-12-27 04:28:13,598 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found to update for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:13.601602709Z [err]  2025-12-27 04:28:13,596 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-27T04:28:13.601609867Z [err]  2025-12-27 04:28:13,596 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-27T04:28:13.601615997Z [err]  2025-12-27 04:28:13,596 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-27T04:28:13.601622051Z [err]  2025-12-27 04:28:13,596 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-27T04:28:13.601628490Z [err]  2025-12-27 04:28:13,598 - server - INFO - ‚úÖ Initialized call_states for v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q with session reference
2025-12-27T04:28:13.603603231Z [err]  2025-12-27 04:28:13,600 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-27T04:28:13.701408590Z [err]  2025-12-27 04:28:13,697 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-27T04:28:13.770879919Z [err]  2025-12-27 04:28:13,765 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-27T04:28:13.770887518Z [err]  2025-12-27 04:28:13,765 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-27T04:28:13.918129102Z [err]  2025-12-27 04:28:13,913 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:13.918136759Z [err]  2025-12-27 04:28:13,913 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-27T04:28:13.938949536Z [err]  2025-12-27 04:28:13,934 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-27T04:28:14.163647743Z [err]  2025-12-27 04:28:14,159 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q/actions/playback_start "HTTP/1.1 200 OK"
2025-12-27T04:28:14.163653750Z [err]  2025-12-27 04:28:14,159 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: xV0J99FEFQ (loop=True, overlay=True)
2025-12-27T04:28:14.163658194Z [err]  2025-12-27 04:28:14,159 - server - INFO - üéµ Comfort noise started as continuous background overlay (playback_id: xV0J99FEFQ)
2025-12-27T04:28:14.163662811Z [err]  2025-12-27 04:28:14,159 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:14.531149634Z [err]  2025-12-27 04:28:14,494 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q/actions/record_start "HTTP/1.1 200 OK"
2025-12-27T04:28:14.531156677Z [err]  2025-12-27 04:28:14,496 - server - INFO - üéôÔ∏è Call recording started for v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:14.531163459Z [err]  2025-12-27 04:28:14,496 - server - INFO - üîß Creating call session for v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q...
2025-12-27T04:28:14.531180083Z [err]  2025-12-27 04:28:14,496 - server - INFO - üîç Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-27T04:28:14.531187215Z [err]  2025-12-27 04:28:14,496 - server - INFO - üîß Calling create_call_session() - START
2025-12-27T04:28:14.531193896Z [err]  2025-12-27 04:28:14,496 - calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-27T04:28:14.531200945Z [err]  2025-12-27 04:28:14,497 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-27T04:28:14.531206986Z [err]  2025-12-27 04:28:14,498 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-27T04:28:14.531213549Z [err]  2025-12-27 04:28:14,498 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-27T04:28:14.531220022Z [inf]  100.64.0.9:45482 - "GET /api/tts-audio/comfort_noise_continuous.mp3 HTTP/1.1" 200
2025-12-27T04:28:14.531227048Z [err]  2025-12-27 04:28:14,524 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-27T04:28:14.531234187Z [err]  2025-12-27 04:28:14,525 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:14.531241115Z [err]  2025-12-27 04:28:14,526 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:14.532269319Z [err]  2025-12-27 04:28:14,526 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-27T04:28:14.585120130Z [err]  2025-12-27 04:28:14,582 - calling_service - INFO - üîç KB count query completed: 4 items
2025-12-27T04:28:14.585124011Z [err]  2025-12-27 04:28:14,582 - calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-27T04:28:14.585127996Z [err]  2025-12-27 04:28:14,582 - calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-27T04:28:14.585131898Z [err]  2025-12-27 04:28:14,582 - calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-27T04:28:14.585136753Z [err]  2025-12-27 04:28:14,582 - calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-27T04:28:14.670553484Z [err]  2025-12-27 04:28:14,667 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:14.687233814Z [err]  2025-12-27 04:28:14,680 - calling_service - INFO - ‚úÖ LLM client pre-warmed in 98ms
2025-12-27T04:28:14.687243167Z [err]  2025-12-27 04:28:14,680 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-27T04:28:14.687248410Z [err]  2025-12-27 04:28:14,680 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-27T04:28:14.689072841Z [err]  2025-12-27 04:28:14,686 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q (TTL: 3600s)
2025-12-27T04:28:14.689082201Z [err]  2025-12-27 04:28:14,686 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-27T04:28:14.689087530Z [err]  2025-12-27 04:28:14,687 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-27T04:28:14.689093390Z [err]  2025-12-27 04:28:14,687 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:14.689100307Z [err]  2025-12-27 04:28:14,687 - server - INFO - ü§ñ AI session created for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:14.689105129Z [err]  2025-12-27 04:28:14,687 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-27T04:28:14.689109660Z [err]  2025-12-27 04:28:14,688 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-27T04:28:14.689114016Z [err]  2025-12-27 04:28:14,688 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-27T04:28:14.689118511Z [err]  2025-12-27 04:28:14,688 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-27T04:28:14.691139417Z [err]  2025-12-27 04:28:14,688 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-27T04:28:14.691145412Z [err]  2025-12-27 04:28:14,688 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-27T04:28:14.691150713Z [err]  2025-12-27 04:28:14,688 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-27T04:28:14.698947515Z [err]  2025-12-27 04:28:14,693 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:14.698959546Z [err]  2025-12-27 04:28:14,695 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-27T04:28:14.698978806Z [err]  2025-12-27 04:28:14,695 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-27T04:28:14.698986373Z [inf]  100.64.0.9:45476 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:15.029663792Z [err]  2025-12-27 04:28:15,027 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:15.536884036Z [err]  2025-12-27 04:28:15,528 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:15.606989006Z [err]  2025-12-27 04:28:15,605 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:15.613898343Z [err]  2025-12-27 04:28:15,610 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:15.618587807Z [err]  2025-12-27 04:28:15,617 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q (TTL: 3600s)
2025-12-27T04:28:15.618596678Z [err]  2025-12-27 04:28:15,617 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-27T04:28:15.618604827Z [err]  2025-12-27 04:28:15,617 - calling_service - INFO - ‚è±Ô∏è [04:28:15.617] üì• process_user_input() ENTRY - text: '...'
2025-12-27T04:28:15.626786470Z [err]  2025-12-27 04:28:15,621 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:15.626794799Z [err]  2025-12-27 04:28:15,622 - calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q: User spoke while Silence Greeting was triggering
2025-12-27T04:28:15.644600092Z [err]  2025-12-27 04:28:15,642 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-27T04:28:15.644607765Z [err]  2025-12-27 04:28:15,643 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:15.644625622Z [err]  2025-12-27 04:28:15,643 - telnyx_service - ERROR - ‚ùå Error stopping audio playback: 'ActionsResource' object has no attribute 'playback_stop'
2025-12-27T04:28:15.644632674Z [err]  2025-12-27 04:28:15,643 - calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-27T04:28:15.648620164Z [err]  2025-12-27 04:28:15,646 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:15.656630328Z [err]  2025-12-27 04:28:15,653 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q (TTL: 3600s)
2025-12-27T04:28:15.656640495Z [err]  2025-12-27 04:28:15,653 - calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-27T04:28:15.656647138Z [err]  2025-12-27 04:28:15,653 - calling_service - INFO - ‚è±Ô∏è [04:28:15.653] ‚è© About to call _process_call_flow_streaming()
2025-12-27T04:28:15.656653294Z [err]  2025-12-27 04:28:15,653 - calling_service - INFO - ‚è±Ô∏è [04:28:15.653] üîÄ Agent type: call_flow, calling flow processor...
2025-12-27T04:28:15.656659097Z [err]  2025-12-27 04:28:15,653 - calling_service - INFO - ‚è±Ô∏è [04:28:15.653] üîÄ _process_call_flow_streaming() ENTRY
2025-12-27T04:28:15.656665088Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-27T04:28:15.656673050Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - ‚è±Ô∏è [04:28:15.654] ‚úÖ Node selected, about to process content...
2025-12-27T04:28:15.656674596Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-27T04:28:15.656680163Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - üîß Replaced {{now}} with Friday, December 26, 2025 at 11:28 PM EST in content
2025-12-27T04:28:15.656685473Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-27T04:28:15.656688031Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-27T04:28:15.656693173Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-27T04:28:15.656696335Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-27T04:28:15.658398657Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-27T04:28:15.658406735Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-27T04:28:15.658413081Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-27T04:28:15.658419352Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-27T04:28:15.658428071Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-27T04:28:15.658435051Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-27T04:28:15.658441582Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-27T04:28:15.658447660Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - ‚è±Ô∏è [04:28:15.654] üìÑ About to process content (mode=script, length=9)
2025-12-27T04:28:15.658454680Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - üîä Silence tracking reset for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q (user responded)
2025-12-27T04:28:15.658463163Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-27T04:28:15.658473049Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-27T04:28:15.658480415Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - LLM response (0.04s): Kendrick?
2025-12-27T04:28:15.658488750Z [err]  2025-12-27 04:28:15,654 - calling_service - INFO - Total latency: 0.04s
2025-12-27T04:28:15.659851161Z [err]  2025-12-27 04:28:15,655 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-27T04:28:15.696868661Z [err]  2025-12-27 04:28:15,694 - server - INFO - üî§ RAW TOKENS: ["H"?]
2025-12-27T04:28:15.701294675Z [err]  2025-12-27 04:28:15,698 - calling_service - INFO - üîä Silence timer reset for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q (user started speaking)
2025-12-27T04:28:15.701301514Z [err]  2025-12-27 04:28:15,698 - calling_service - INFO - üë§ User started speaking for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:15.701307688Z [err]  2025-12-27 04:28:15,698 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-27T04:28:15.701313627Z [err]  2025-12-27 04:28:15,698 - server - INFO - üîç PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-27T04:28:15.752072015Z [err]  2025-12-27 04:28:15,750 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:15.754193289Z [err]  2025-12-27 04:28:15,751 - server - INFO - ‚è≠Ô∏è [WebSocket Worker] User spoke during greeting generation - CANCELLING silence greeting
2025-12-27T04:28:15.850389418Z [err]  2025-12-27 04:28:15,845 - server - INFO - üî§ RAW TOKENS: ["H"?, "ello"?]
2025-12-27T04:28:15.850398307Z [err]  2025-12-27 04:28:15,845 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Hello' | Generating: False
2025-12-27T04:28:15.983684655Z [err]  2025-12-27 04:28:15,975 - server - INFO - üî§ RAW TOKENS: ["H"‚úì, "ello"‚úì, "?"‚úì, "<end>"‚úì]
2025-12-27T04:28:15.983695445Z [err]  2025-12-27 04:28:15,975 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-27T04:28:15.983701708Z [err]  2025-12-27 04:28:15,975 - server - INFO - üßπ Cleaned transcript: 'H ello ?' -> 'Hello?'
2025-12-27T04:28:15.983707148Z [err]  2025-12-27 04:28:15,975 - server - INFO - üì• FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-27T04:28:15.983713798Z [err]  2025-12-27 04:28:15,975 - server - INFO - üé§ Soniox final transcript: 'Hello?'
2025-12-27T04:28:15.983719890Z [err]  2025-12-27 04:28:15,976 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:15.983725122Z [err]  2025-12-27 04:28:15,976 - server - INFO - üîç FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-27T04:28:15.983730541Z [err]  2025-12-27 04:28:15,976 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:15.983739143Z [err]  2025-12-27 04:28:15,976 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-27T04:28:15.983746335Z [err]  2025-12-27 04:28:15,976 - server - INFO - ‚è±Ô∏è [04:28:15.976] üìù FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-27T04:28:15.983751778Z [err]  2025-12-27 04:28:15,976 - server - INFO - ‚è±Ô∏è [04:28:15.976] STT endpoint detection latency: 11ms
2025-12-27T04:28:15.983757299Z [err]  2025-12-27 04:28:15,976 - server - INFO - ‚è±Ô∏è [04:28:15.976] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-27T04:28:15.983763042Z [err]  2025-12-27 04:28:15,977 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q (TTL: 3600s)
2025-12-27T04:28:15.984970246Z [err]  2025-12-27 04:28:15,977 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-27T04:28:15.984978458Z [err]  2025-12-27 04:28:15,977 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:15.984984269Z [err]  2025-12-27 04:28:15,977 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-27T04:28:15.990436080Z [err]  2025-12-27 04:28:15,987 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-27T04:28:15.990444501Z [err]  2025-12-27 04:28:15,987 - calling_service - INFO - üë§ User stopped speaking for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:15.990449593Z [err]  2025-12-27 04:28:15,987 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-27T04:28:15.990454093Z [err]  2025-12-27 04:28:15,988 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+4ms
2025-12-27T04:28:15.990458464Z [err]  2025-12-27 04:28:15,988 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 4ms (Soniox model: stt-rt-v3)
2025-12-27T04:28:15.990463059Z [err]  2025-12-27 04:28:15,988 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-27T04:28:15.990467668Z [err]  2025-12-27 04:28:15,988 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-27T04:28:15.990472228Z [err]  2025-12-27 04:28:15,988 - calling_service - INFO - ü§ñ Agent started speaking for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:15.992195558Z [err]  2025-12-27 04:28:15,990 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:15.992203914Z [err]  2025-12-27 04:28:15,990 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '39a65d9b-481b-4028-a616-20bfdf527018', 'occurred_at': '2025-12-27T04:28:15.543960Z', 'payload': {'call_control_id': 'v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q', 'call_leg_id': '72a61372-e2dc-11f0-849d-02420aef98a0', 'call_session_id': '72a2da22-e2dc-11f0-b9d6-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'xV0J99FEFQ', 'start_time': '2025-12-27T04:28:15.543960Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:15.992209902Z [err]  2025-12-27 04:28:15,990 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:15.992215377Z [err]  2025-12-27 04:28:15,990 - server - INFO - üì® ================================================
2025-12-27T04:28:15.992220739Z [inf]  100.64.0.12:16478 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:16.031047607Z [err]  2025-12-27 04:28:16,029 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:16.031054555Z [err]  2025-12-27 04:28:16,029 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:16.081933951Z [err]  2025-12-27 04:28:16,080 - server - INFO - üìù Saved user transcript to database
2025-12-27T04:28:16.081939779Z [err]  2025-12-27 04:28:16,080 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:16.081943902Z [err]  2025-12-27 04:28:16,080 - calling_service - INFO - ‚è±Ô∏è [04:28:16.080] üì• process_user_input() ENTRY - text: 'Hello?...'
2025-12-27T04:28:16.083999396Z [err]  2025-12-27 04:28:16,082 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:16.084006162Z [err]  2025-12-27 04:28:16,082 - calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q: User spoke while Silence Greeting was triggering
2025-12-27T04:28:16.107293228Z [err]  2025-12-27 04:28:16,101 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-27T04:28:16.107294776Z [err]  2025-12-27 04:28:16,102 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:16.107301730Z [err]  2025-12-27 04:28:16,101 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:16.107306859Z [err]  2025-12-27 04:28:16,101 - telnyx_service - ERROR - ‚ùå Error stopping audio playback: 'ActionsResource' object has no attribute 'playback_stop'
2025-12-27T04:28:16.107311493Z [err]  2025-12-27 04:28:16,101 - calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-27T04:28:16.107315677Z [err]  2025-12-27 04:28:16,101 - calling_service - INFO - ‚úÖ BARGE-IN: Removed silence greeting from history: 'Kendrick?'
2025-12-27T04:28:16.107319974Z [err]  2025-12-27 04:28:16,102 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:16.107324166Z [err]  2025-12-27 04:28:16,102 - redis_service - INFO - üì¶ Stored call data in Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q (TTL: 3600s)
2025-12-27T04:28:16.107328114Z [err]  2025-12-27 04:28:16,102 - calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-27T04:28:16.107332508Z [err]  2025-12-27 04:28:16,102 - calling_service - INFO - ‚úÖ BARGE-IN: Returning greeting script: 'Kendrick?'
2025-12-27T04:28:16.107336474Z [err]  2025-12-27 04:28:16,102 - server - INFO - üì§ Sentence arrived from LLM: Kendrick?...
2025-12-27T04:28:16.107340662Z [err]  2025-12-27 04:28:16,102 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 114ms
2025-12-27T04:28:16.107344545Z [err]  2025-12-27 04:28:16,102 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-27T04:28:16.108949095Z [err]  2025-12-27 04:28:16,102 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-27T04:28:16.192835188Z [err]  2025-12-27 04:28:16,188 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:16.472320637Z [err]  2025-12-27 04:28:16,273 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:16.472332090Z [err]  2025-12-27 04:28:16,358 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:16.472339660Z [err]  2025-12-27 04:28:16,382 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-27T04:28:16.472344646Z [err]  2025-12-27 04:28:16,382 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-27T04:28:16.472349110Z [err]  2025-12-27 04:28:16,382 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-27T04:28:16.472353030Z [err]  2025-12-27 04:28:16,383 - persistent_tts_service - INFO - üîå [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Establishing persistent TTS WebSocket...
2025-12-27T04:28:16.472357455Z [err]  2025-12-27 04:28:16,383 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-27T04:28:16.472362482Z [err]  2025-12-27 04:28:16,383 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-27T04:28:16.472367010Z [err]  2025-12-27 04:28:16,383 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-27T04:28:16.527803324Z [err]  2025-12-27 04:28:16,524 - server - ERROR - ‚ùå Error processing transcript: 'str' object has no attribute 'get'
2025-12-27T04:28:16.527809369Z [err]  2025-12-27 04:28:16,523 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-27T04:28:16.527813598Z [err]  2025-12-27 04:28:16,525 - persistent_tts_service - INFO - üéµ [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Playback consumer started
2025-12-27T04:28:16.527818250Z [err]  2025-12-27 04:28:16,523 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-27T04:28:16.527823638Z [err]  2025-12-27 04:28:16,523 - persistent_tts_service - INFO - ‚úÖ [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Persistent TTS WebSocket established
2025-12-27T04:28:16.527828210Z [err]  2025-12-27 04:28:16,523 - persistent_tts_service - INFO - üéß [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Audio receiver loop started
2025-12-27T04:28:16.527833063Z [err]  2025-12-27 04:28:16,523 - persistent_tts_service - INFO - üîä [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Comfort noise loop started
2025-12-27T04:28:16.527837184Z [err]  2025-12-27 04:28:16,523 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:16.527841606Z [err]  2025-12-27 04:28:16,523 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-27T04:28:16.527845798Z [err]  2025-12-27 04:28:16,523 - server - INFO - üîç Persistent TTS lookup: call_id=v3:Vl2GoNug0sdcDXEeX..., session=FOUND
2025-12-27T04:28:16.527851083Z [err]  2025-12-27 04:28:16,523 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-27T04:28:16.527855092Z [err]  2025-12-27 04:28:16,523 - server - INFO - üéµ TTS task #1 started at +420ms
2025-12-27T04:28:16.527860555Z [err]  2025-12-27 04:28:16,523 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 535ms
2025-12-27T04:28:16.529760616Z [err]  2025-12-27 04:28:16,525 - persistent_tts_service - INFO - üìä [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] DIAGNOSTIC: queue_latency=0ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-27T04:28:16.529773775Z [err]  2025-12-27 04:28:16,525 - persistent_tts_service - INFO - üéß [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Audio Receiver Loop STARTED
2025-12-27T04:28:16.529780056Z [err]  2025-12-27 04:28:16,525 - persistent_tts_service - INFO - üíì [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Starting TTS keep-alive loop (every 15s)
2025-12-27T04:28:16.529785637Z [err]  2025-12-27 04:28:16,525 - persistent_tts_service - INFO - üîä [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Starting comfort noise loop
2025-12-27T04:28:16.529790175Z [err]  2025-12-27 04:28:16,525 - persistent_tts_service - INFO - üé§ [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Streaming sentence #1: Kendrick?...
2025-12-27T04:28:16.529795293Z [err]  2025-12-27 04:28:16,525 - persistent_tts_service - INFO - üöÄ [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-27T04:28:16.529800343Z [err]  2025-12-27 04:28:16,525 - persistent_tts_service - INFO - üìä [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-27T04:28:16.529804893Z [err]  2025-12-27 04:28:16,525 - persistent_tts_service - INFO - üéß [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Receiver processing sentence #1: 'Kendrick?...'
2025-12-27T04:28:16.691027001Z [err]  2025-12-27 04:28:16,686 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:16.691035112Z [err]  2025-12-27 04:28:16,686 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': 'a40e0142-c4ba-4fb3-9922-06dac2df7710', 'occurred_at': '2025-12-27T04:28:16.403968Z', 'payload': {'call_control_id': 'v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q', 'call_leg_id': '72a61372-e2dc-11f0-849d-02420aef98a0', 'call_session_id': '72a2da22-e2dc-11f0-b9d6-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:16.691041151Z [err]  2025-12-27 04:28:16,686 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:16.691047151Z [err]  2025-12-27 04:28:16,686 - server - INFO - üì® ================================================
2025-12-27T04:28:16.691052380Z [inf]  100.64.0.10:45560 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:16.770046432Z [err]  2025-12-27 04:28:16,764 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 239ms
2025-12-27T04:28:16.770052782Z [err]  2025-12-27 04:28:16,764 - persistent_tts_service - INFO - üì§ Sending 7043 bytes of audio (45 chunks, 0.9s duration) via WebSocket
2025-12-27T04:28:16.770092592Z [err]  2025-12-27 04:28:16,764 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-27T04:28:16.770097130Z [err]  2025-12-27 04:28:16,764 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +0.9s (total: 0.9s from now)
2025-12-27T04:28:16.770102217Z [err]  2025-12-27 04:28:16,765 - persistent_tts_service - INFO - ‚úÖ Sent 45 audio chunks via WebSocket
2025-12-27T04:28:17.768523417Z [err]  2025-12-27 04:28:17,766 - persistent_tts_service - INFO - üîá [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] FLOOR RELEASED (is_holding_floor=False)
2025-12-27T04:28:18.043194461Z [err]  2025-12-27 04:28:18,038 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (0.4s ago), marking agent as done speaking
2025-12-27T04:28:18.043204350Z [err]  2025-12-27 04:28:18,038 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766809698.0384839 for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:18.043210088Z [err]  2025-12-27 04:28:18,038 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:18.765774612Z [err]  2025-12-27 04:28:18,764 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-27T04:28:18.765782164Z [err]  2025-12-27 04:28:18,764 - persistent_tts_service - INFO - ‚úÖ [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Receiver finished sentence #1: 1 chunks in 2238ms
2025-12-27T04:28:19.141386178Z [err]  2025-12-27 04:28:19,136 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 291 total packets
2025-12-27T04:28:19.141394998Z [err]  [2025-12-27 04:28:19 +0000] [3] [INFO] connection closed
2025-12-27T04:28:19.162542533Z [err]  2025-12-27 04:28:19,157 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:19.162550806Z [err]  2025-12-27 04:28:19,157 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': 'd8937e01-0044-4401-987a-3ceed07d018d', 'occurred_at': '2025-12-27T04:28:19.067902Z', 'payload': {'call_control_id': 'v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q', 'call_leg_id': '72a61372-e2dc-11f0-849d-02420aef98a0', 'call_session_id': '72a2da22-e2dc-11f0-b9d6-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '078c730e-96af-4f7d-b5e0-a9eaf69c6110', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:19.162556699Z [err]  2025-12-27 04:28:19,157 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:19.162561500Z [err]  2025-12-27 04:28:19,157 - server - INFO - üì® ================================================
2025-12-27T04:28:19.162566904Z [inf]  100.64.0.10:45560 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:19.503970242Z [err]  2025-12-27 04:28:19,246 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:19.503975636Z [err]  2025-12-27 04:28:19,246 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '333a5278-70cc-4503-ad2f-fa6cac06e084', 'occurred_at': '2025-12-27T04:28:19.023973Z', 'payload': {'call_control_id': 'v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q', 'call_leg_id': '72a61372-e2dc-11f0-849d-02420aef98a0', 'call_session_id': '72a2da22-e2dc-11f0-b9d6-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-27T04:28:19.023973Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'xV0J99FEFQ', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:19.503981914Z [err]  2025-12-27 04:28:19,246 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:19.503987405Z [err]  2025-12-27 04:28:19,246 - server - INFO - üì® ================================================
2025-12-27T04:28:19.503993079Z [err]  2025-12-27 04:28:19,248 - redis_service - INFO - ‚ûñ Removed playback xV0J99FEFQ, 0 remaining for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:19.504000873Z [err]  2025-12-27 04:28:19,249 - server - INFO - üîä Redis: Removed playback xV0J99FEFQ, 0 remaining
2025-12-27T04:28:19.504008398Z [err]  2025-12-27 04:28:19,249 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-27T04:28:19.504013742Z [err]  2025-12-27 04:28:19,249 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-27T04:28:19.504018967Z [err]  2025-12-27 04:28:19,250 - server - INFO - üí° Session not on this worker - Redis flag set for WebSocket worker to handle
2025-12-27T04:28:19.505094374Z [inf]  100.64.0.12:16478 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:19.505100665Z [err]  2025-12-27 04:28:19,300 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:19.505107585Z [err]  2025-12-27 04:28:19,300 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': 'bd5810c1-2982-49c0-a9a8-5b23986d6036', 'occurred_at': '2025-12-27T04:28:18.943970Z', 'payload': {'call_control_id': 'v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q', 'call_leg_id': '72a61372-e2dc-11f0-849d-02420aef98a0', 'call_quality_stats': {'inbound': {'jitter_max_variance': '0.04', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '312', 'skip_packet_count': '11'}, 'outbound': {'packet_count': '292', 'skip_packet_count': '0'}}, 'call_session_id': '72a2da22-e2dc-11f0-b9d6-02420aef98a0', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-27T04:28:18.943970Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-27T04:28:09.463969Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:19.505114423Z [err]  2025-12-27 04:28:19,300 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:19.505121411Z [err]  2025-12-27 04:28:19,300 - server - INFO - üì® ================================================
2025-12-27T04:28:19.505127507Z [err]  2025-12-27 04:28:19,300 - server - INFO - üìû Call ended: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:19.505132667Z [err]  2025-12-27 04:28:19,300 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-27T04:28:19.505138331Z [err]  2025-12-27 04:28:19,479 - server - INFO - üìù Updated call log: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:19.574994017Z [err]  2025-12-27 04:28:19,570 - server - INFO - ‚úÖ Finalized call log: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q (duration=6s, status=completed)
2025-12-27T04:28:19.669313873Z [err]  2025-12-27 04:28:19,660 - server - INFO - üì¶ Saved 11 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-27T04:28:20.044154101Z [err]  2025-12-27 04:28:20,042 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=2.0s, checkin_count=0/2
2025-12-27T04:28:20.471580139Z [err]  2025-12-27 04:28:20,349 - server - INFO - üìä Auto-added call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-27T04:28:20.552574318Z [err]  2025-12-27 04:28:20,543 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=2.5s, checkin_count=0/2
2025-12-27T04:28:20.613365705Z [err]  2025-12-27 04:28:20,608 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-27T04:28:20.613372333Z [err]  2025-12-27 04:28:20,609 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:20.613377100Z [err]  2025-12-27 04:28:20,609 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-27T04:28:20.613381708Z [err]  2025-12-27 04:28:20,609 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-27T04:28:20.701512506Z [err]  2025-12-27 04:28:20,699 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-27T04:28:20.744169208Z [err]  2025-12-27 04:28:20,737 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:20.744174601Z [err]  2025-12-27 04:28:20,737 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': 'bb97debb-c2aa-424c-9def-c6c2d3a51359', 'occurred_at': '2025-12-27T04:28:20.647763Z', 'payload': {'call_control_id': 'v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q', 'call_leg_id': '72a61372-e2dc-11f0-849d-02420aef98a0', 'call_session_id': '72a2da22-e2dc-11f0-b9d6-02420aef98a0', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-27T04:28:19.024960Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-27T04:28:19.024960Z', 'recording_id': '831c4a91-825b-478c-a0c2-32e1c5677ae1', 'recording_started_at': '2025-12-27T04:28:14.401207Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-27/72a61372-e2dc-11f0-849d-02420aef98a0-1766809694376115.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251227%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251227T042820Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=ffab417bf06d16cdd26efeb655dc3c11e466d1e00427424fd5fef0125240ef7e'}, 'start_time': '2025-12-27T04:28:14.401207Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:20.744180076Z [err]  2025-12-27 04:28:20,737 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:20.744184824Z [err]  2025-12-27 04:28:20,737 - server - INFO - üì® ================================================
2025-12-27T04:28:20.744189569Z [err]  2025-12-27 04:28:20,737 - server - INFO - üéôÔ∏è Recording saved for call: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:20.744195338Z [err]  2025-12-27 04:28:20,738 - redis_service - INFO - üì• Retrieved call data from Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:20.746419304Z [err]  2025-12-27 04:28:20,738 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=831c4a91-825b-478c-a0c2-32e1c5677ae1, call_data=True
2025-12-27T04:28:20.787336962Z [err]  2025-12-27 04:28:20,784 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-27T04:28:20.787349020Z [err]  2025-12-27 04:28:20,784 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-27T04:28:20.787354786Z [err]  2025-12-27 04:28:20,784 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-27T04:28:20.787359810Z [err]  2025-12-27 04:28:20,784 - server - INFO - üöÄ Triggered QC analysis for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:20.787365360Z [err]  2025-12-27 04:28:20,784 - server - INFO - üìä Triggered Campaign QC for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:20.787370811Z [err]  2025-12-27 04:28:20,784 - server - INFO - üìá Triggered CRM update for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:20.787375951Z [err]  2025-12-27 04:28:20,784 - persistent_tts_service - INFO - üîå [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Closing persistent TTS WebSocket...
2025-12-27T04:28:20.787380645Z [err]  2025-12-27 04:28:20,784 - server - INFO - üîç Starting QC analysis for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:20.787385302Z [err]  2025-12-27 04:28:20,784 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-27T04:28:20.787390417Z [err]  2025-12-27 04:28:20,785 - server - INFO - üìá CRM update starting for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-27T04:28:20.789047449Z [err]  2025-12-27 04:28:20,785 - server - INFO - üìá Normalized phone: +17708336397
2025-12-27T04:28:20.789055523Z [err]  2025-12-27 04:28:20,785 - server - INFO - üìá CRM: Got 11 variables from active session
2025-12-27T04:28:20.789059873Z [err]  2025-12-27 04:28:20,786 - persistent_tts_service - INFO - üõë [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Audio Receiver Loop CANCELLED
2025-12-27T04:28:20.789064163Z [err]  2025-12-27 04:28:20,786 - persistent_tts_service - INFO - üëã [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Audio Receiver Loop STOPPED
2025-12-27T04:28:20.789068929Z [err]  2025-12-27 04:28:20,786 - persistent_tts_service - INFO - üõë [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Playback consumer shutting down
2025-12-27T04:28:20.879589345Z [err]  2025-12-27 04:28:20,873 - server - INFO - üìù Converted transcript from 2 messages to 33 characters
2025-12-27T04:28:20.965199661Z [err]  2025-12-27 04:28:20,958 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:20.987281088Z [err]  2025-12-27 04:28:20,985 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-27T04:28:20.987287225Z [err]  2025-12-27 04:28:20,985 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-27T04:28:21.046562490Z [err]  2025-12-27 04:28:21,044 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-27T04:28:21.124720132Z [err]  2025-12-27 04:28:21,115 - server - INFO - üåê Created WebSocket stream URL: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-27T04:28:21.137760491Z [err]  2025-12-27 04:28:21,129 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-27T04:28:21.137767764Z [err]  2025-12-27 04:28:21,129 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-27T04:28:21.137772170Z [err]  2025-12-27 04:28:21,129 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:21.208962080Z [err]  2025-12-27 04:28:21,205 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:21.495220316Z [err]  2025-12-27 04:28:21,296 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:21.495226769Z [err]  2025-12-27 04:28:21,321 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-27T04:28:21.495233308Z [err]  2025-12-27 04:28:21,321 - telnyx_service - INFO - üìû Initiating outbound call from +14048000152 to +17708336397
2025-12-27T04:28:21.495239572Z [err]  2025-12-27 04:28:21,321 - telnyx_service - INFO - ü§ñ Enabling AMD (premium mode)
2025-12-27T04:28:21.495245604Z [err]  2025-12-27 04:28:21,321 - telnyx_service - INFO - üåê Adding streaming parameters: wss://api.li-ai.org/api/telnyx/audio-stream
2025-12-27T04:28:21.621387421Z [err]  2025-12-27 04:28:21,617 - server - INFO - üíæ Saved recording URL and ID to database: 831c4a91-825b-478c-a0c2-32e1c5677ae1
2025-12-27T04:28:21.621397073Z [err]  2025-12-27 04:28:21,617 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-27T04:28:21.621404156Z [err]  2025-12-27 04:28:21,617 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-27T04:28:21.903977018Z [err]  2025-12-27 04:28:21,902 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls "HTTP/1.1 200 OK"
2025-12-27T04:28:21.903983528Z [err]  2025-12-27 04:28:21,903 - telnyx_service - INFO - ‚úÖ Call initiated: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:21.906441538Z [err]  2025-12-27 04:28:21,904 - server - INFO - üìá CRM: Got 11 extracted variables
2025-12-27T04:28:21.906448665Z [err]  2025-12-27 04:28:21,904 - server - INFO - üìá CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-27T04:28:21.906455192Z [err]  2025-12-27 04:28:21,904 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=2, logs_count=2, status=completed
2025-12-27T04:28:21.906459656Z [err]  2025-12-27 04:28:21,904 - elevenlabs_ws_service - INFO - üîå Closed ElevenLabs WebSocket connection
2025-12-27T04:28:21.906463978Z [err]  2025-12-27 04:28:21,905 - persistent_tts_service - INFO - ‚úÖ [Call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q] Persistent TTS WebSocket closed
2025-12-27T04:28:21.906468602Z [err]  2025-12-27 04:28:21,905 - persistent_tts_service - INFO - ‚úÖ Closed persistent TTS session for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:21.906472947Z [err]  2025-12-27 04:28:21,905 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:21.907740857Z [err]  2025-12-27 04:28:21,905 - redis_service - INFO - üßπ Deleted call data from Redis: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:21.907749441Z [err]  2025-12-27 04:28:21,905 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:21.907755879Z [inf]  100.64.0.11:43280 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:21.922878198Z [err]  2025-12-27 04:28:21,919 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-27/72a61372-e2dc-11f0-849d-02420aef98a0-1766809694376115.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251227%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251227T042820Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=ffab417bf06d16cdd26efeb655dc3c11e466d1e00427424fd5fef0125240ef7e "HTTP/1.1 200 OK"
2025-12-27T04:28:21.922905906Z [err]  2025-12-27 04:28:21,920 - server - INFO - ‚úÖ Downloaded 18851 bytes
2025-12-27T04:28:22.000799214Z [err]  2025-12-27 04:28:21,998 - server - INFO - üìù Created call log: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:22.000807189Z [err]  2025-12-27 04:28:21,998 - server - INFO - üîç DEBUG Call Initiated Webhook (UI Trigger): url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-27T04:28:22.000812929Z [err]  2025-12-27 04:28:21,998 - server - INFO - üîç DEBUG Agent Settings Webhook Context: {'temperature': 0.2, 'max_tokens': 500, 'tts_speed': 1, 'llm_provider': 'grok', 'tts_provider': 'elevenlabs', 'stt_provider': 'soniox', 'enable_comfort_noise': True, 'dead_air_settings': {'silence_timeout_normal': 7, 'silence_timeout_hold_on': 25, 'max_checkins_before_disconnect': 2, 'max_call_duration': 1500, 'checkin_message': 'Are you still there?'}, 'voicemail_detection': {'enabled': True, 'use_telnyx_amd': True, 'telnyx_amd_mode': 'premium', 'use_llm_detection': True, 'disconnect_on_detection': True}, 'deepgram_settings': {'endpointing': 500, 'vad_turnoff': 250, 'utterance_end_ms': 1000, 'interim_results': True, 'smart_format': True}, 'elevenlabs_settings': {'voice_id': 'J5iaaqzR5zn6HFG4jV3b', 'model': 'eleven_turbo_v2_5', 'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'speed': 1.1, 'use_speaker_boost': True, 'enable_normalization': True, 'enable_ssml_parsing': True}, 'hume_settings': {'voice_name': 'e7af7ed6-3381-48aa-ab97-49485007470b', 'description': 'warm and friendly', 'speed': 1}, 'sesame_settings': {'speaker_id': 0, 'output_format': 'wav'}, 'melo_settings': {'voice': 'EN-US', 'speed': 1.2, 'clone_wav': None}, 'dia_settings': {'voice': 'S1', 'speed': 1, 'response_format': 'wav'}, 'kokoro_settings': {'voice': 'af_bella', 'speed': 1, 'response_format': 'mp3'}, 'chattts_settings': {'voice': 'female_1', 'speed': 1, 'temperature': 0.3, 'response_format': 'wav'}, 'assemblyai_settings': {'sample_rate': 8000, 'word_boost': [], 'enable_extra_session_information': True, 'disable_partial_transcripts': False, 'threshold': 0, 'end_of_turn_confidence_threshold': 0.8, 'min_end_of_turn_silence_when_confident': 500, 'max_turn_silence': 2000}, 'soniox_settings': {'model': 'stt-rt-v3', 'sample_rate': 8000, 'audio_format': 'mulaw', 'num_channels': 1, 'enable_endpoint_detection': True, 'enable_speaker_diarization': False, 'language_hints': ['en'], 'context': ''}, 'post_call_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'post_call_webhook_active': True, 'call_started_webhook_url': 'https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', 'call_started_webhook_active': True}
2025-12-27T04:28:22.002115445Z [err]  2025-12-27 04:28:21,998 - server - INFO - üîç DEBUG Call Initiated Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-27T04:28:22.002122015Z [err]  2025-12-27 04:28:21,998 - server - INFO - üì§ Sending call-initiated webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-27T04:28:22.010323726Z [err]  2025-12-27 04:28:22,004 - redis_service - INFO - üì¶ Stored call data in Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw (TTL: 3600s)
2025-12-27T04:28:22.010331618Z [err]  2025-12-27 04:28:22,004 - server - INFO - üì¶ Call data stored in Redis and memory
2025-12-27T04:28:22.010337499Z [err]  2025-12-27 04:28:22,004 - server - INFO - üìû Outbound call initiated: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:22.010343067Z [inf]  100.64.0.13:51516 - "POST /api/telnyx/call/outbound HTTP/1.1" 200
2025-12-27T04:28:22.039891549Z [err]  2025-12-27 04:28:22,036 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:22.039900604Z [err]  2025-12-27 04:28:22,036 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.initiated', 'id': 'fc2e4c8d-e4c6-4a35-935f-6a1b48b86681', 'occurred_at': '2025-12-27T04:28:21.783976Z', 'payload': {'call_control_id': 'v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw', 'call_leg_id': '7a123f5a-e2dc-11f0-b6df-02420aef981f', 'call_session_id': '7a0efcbe-e2dc-11f0-9af1-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'direction': 'outgoing', 'from': '+14048000152', 'state': 'bridging', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:22.039906591Z [err]  2025-12-27 04:28:22,036 - server - INFO - üéØ Event type: call.initiated, Call ID: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:22.039910876Z [err]  2025-12-27 04:28:22,036 - server - INFO - üì® ================================================
2025-12-27T04:28:22.039915291Z [err]  2025-12-27 04:28:22,036 - server - INFO - üìû Call initiated - Direction: outgoing, From: +14048000152, To: +17708336397
2025-12-27T04:28:22.039919344Z [inf]  100.64.0.10:45560 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:22.088048201Z [err]  2025-12-27 04:28:22,085 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-27T04:28:22.133687083Z [err]  2025-12-27 04:28:22,130 - server - INFO - üîåüîåüîå WEBSOCKET CONNECTION ATTEMPT
2025-12-27T04:28:22.133696933Z [err]  2025-12-27 04:28:22,130 - server - INFO -    Client: Address(host='100.64.0.14', port=10042)
2025-12-27T04:28:22.133703662Z [err]  2025-12-27 04:28:22,130 - server - INFO -    Headers: {'host': 'api.li-ai.org', 'user-agent': 'telnyx-websocket', 'connection': 'Upgrade', 'sec-websocket-key': 'iy0tMbQFrUuMTwq4ejjArA==', 'sec-websocket-version': '13', 'upgrade': 'websocket', 'x-forwarded-for': '192.76.120.151', 'x-forwarded-host': 'api.li-ai.org', 'x-forwarded-proto': 'https', 'x-railway-edge': 'railway/us-west2', 'x-railway-request-id': 'v9qqQFOESmSd_tMwLPU1MQ', 'x-real-ip': '192.76.120.151', 'x-request-start': '1766809701907', 'accept-encoding': 'gzip'}
2025-12-27T04:28:22.133709946Z [err]  2025-12-27 04:28:22,130 - server - INFO -    Path: /api/telnyx/audio-stream
2025-12-27T04:28:22.133716646Z [err]  2025-12-27 04:28:22,130 - server - INFO - üîå Incoming Telnyx WebSocket connection
2025-12-27T04:28:22.133723028Z [err]  [2025-12-27 04:28:22 +0000] [3] [INFO] ('100.64.0.14', 10042) - "WebSocket /api/telnyx/audio-stream" [accepted]
2025-12-27T04:28:22.133728213Z [err]  2025-12-27 04:28:22,130 - server - INFO - ‚úÖ WebSocket accepted, waiting for Telnyx events
2025-12-27T04:28:22.133733120Z [err]  [2025-12-27 04:28:22 +0000] [3] [INFO] connection open
2025-12-27T04:28:22.179459870Z [err]  2025-12-27 04:28:22,173 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-27T04:28:22.531762198Z [err]  2025-12-27 04:28:22,263 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-27T04:28:22.531769592Z [err]  2025-12-27 04:28:22,263 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-27T04:28:22.531775192Z [err]  2025-12-27 04:28:22,263 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-27T04:28:22.531781862Z [err]  2025-12-27 04:28:22,264 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-27T04:28:22.531787332Z [err]    File "/app/backend/server.py", line 9746, in trigger_campaign_qc_for_call
2025-12-27T04:28:22.531793621Z [err]      await run_full_qc_analysis(
2025-12-27T04:28:22.531799063Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-27T04:28:22.531804653Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-27T04:28:22.531811748Z [err]  
2025-12-27T04:28:22.531817680Z [err]  2025-12-27 04:28:22,285 - server - INFO - üì¨ Received Telnyx event: connected
2025-12-27T04:28:22.531823872Z [err]  2025-12-27 04:28:22,285 - server - INFO - üìû Telnyx connected event received, waiting for 'start'...
2025-12-27T04:28:22.531829823Z [err]  2025-12-27 04:28:22,375 - server - INFO - ‚úÖ Split into 2 channels
2025-12-27T04:28:22.531836637Z [err]  2025-12-27 04:28:22,375 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-27T04:28:22.531843295Z [err]  2025-12-27 04:28:22,375 - server - INFO - üìä Channel 0: 99484 bytes
2025-12-27T04:28:22.531848584Z [err]  2025-12-27 04:28:22,375 - server - ERROR - ‚ùå No Soniox API key available
2025-12-27T04:28:22.531853805Z [err]  2025-12-27 04:28:22,375 - server - INFO - ‚ùå Channel 0: No speech
2025-12-27T04:28:22.532206600Z [err]  2025-12-27 04:28:22,375 - server - INFO - üìä Channel 1: 99484 bytes
2025-12-27T04:28:22.532212314Z [err]  2025-12-27 04:28:22,375 - server - ERROR - ‚ùå No Soniox API key available
2025-12-27T04:28:22.532217743Z [err]  2025-12-27 04:28:22,376 - server - INFO - ‚ùå Channel 1: No speech
2025-12-27T04:28:22.532223822Z [err]  2025-12-27 04:28:22,376 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-27T04:28:22.532229601Z [inf]  100.64.0.12:16478 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:22.532235179Z [err]  2025-12-27 04:28:22,404 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:22.532240771Z [err]  2025-12-27 04:28:22,436 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-27T04:28:22.532246386Z [err]  2025-12-27 04:28:22,437 - server - INFO - ‚úÖ Call-initiated webhook sent successfully (status=200)
2025-12-27T04:28:22.908215413Z [err]  2025-12-27 04:28:22,907 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:23.450892504Z [err]  2025-12-27 04:28:23,319 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-27T04:28:23.450898254Z [err]  2025-12-27 04:28:23,323 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-27T04:28:23.450903202Z [err]  2025-12-27 04:28:23,325 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:23.450909610Z [err]  2025-12-27 04:28:23,408 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:23.910649752Z [err]  2025-12-27 04:28:23,908 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:24.525768386Z [err]  2025-12-27 04:28:24,297 - server - INFO - üì¨ Received Telnyx event: start
2025-12-27T04:28:24.525774747Z [err]  2025-12-27 04:28:24,298 - server - INFO - üé¨ Stream started for call: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:24.525783066Z [err]  2025-12-27 04:28:24,303 - redis_service - INFO - üì• Retrieved call data from Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:24.525789058Z [err]  2025-12-27 04:28:24,303 - server - INFO - ‚úÖ Call data found after 0s wait
2025-12-27T04:28:24.525794107Z [err]  2025-12-27 04:28:24,304 - server - INFO - ‚è≥ Session not found locally, waiting briefly for webhook...
2025-12-27T04:28:24.525799473Z [err]  2025-12-27 04:28:24,304 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:24.525805559Z [err]  2025-12-27 04:28:24,304 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.answered', 'id': 'aaab13dc-4241-4a9e-af64-aa0758109131', 'occurred_at': '2025-12-27T04:28:24.083965Z', 'payload': {'call_control_id': 'v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw', 'call_leg_id': '7a123f5a-e2dc-11f0-b6df-02420aef981f', 'call_session_id': '7a0efcbe-e2dc-11f0-9af1-02420aef981f', 'client_state': None, 'codec': 'PCMU', 'connection_id': '2777245537294877821', 'from': '+14048000152', 'sampling_rate': 8000, 'start_time': '2025-12-27T04:28:21.783976Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:24.525810514Z [err]  2025-12-27 04:28:24,417 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:24.525810664Z [err]  2025-12-27 04:28:24,304 - server - INFO - üéØ Event type: call.answered, Call ID: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:24.525815144Z [err]  2025-12-27 04:28:24,304 - server - INFO - üì® ================================================
2025-12-27T04:28:24.525823115Z [err]  2025-12-27 04:28:24,304 - server - INFO - ‚úÖ Call answered: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:24.525840658Z [err]  2025-12-27 04:28:24,497 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:24.526420808Z [err]  2025-12-27 04:28:24,307 - redis_service - INFO - üì• Retrieved call data from Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:24.526427658Z [err]  2025-12-27 04:28:24,311 - server - INFO - ‚úÖ Found call in Redis (multi-worker state sharing working)
2025-12-27T04:28:24.526433606Z [err]  2025-12-27 04:28:24,311 - server - INFO - üìû Phone numbers added to session: from=+14048000152, to=+17708336397
2025-12-27T04:28:24.526439208Z [err]  2025-12-27 04:28:24,407 - server - INFO - ‚úÖ Call log updated
2025-12-27T04:28:24.526444586Z [err]  2025-12-27 04:28:24,407 - server - INFO - üîç DEBUG Webhook: url='https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b', active=True, should_fire=True
2025-12-27T04:28:24.526450060Z [err]  2025-12-27 04:28:24,407 - server - INFO - üì§ Sending call-started webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-27T04:28:24.526455664Z [err]  2025-12-27 04:28:24,407 - server - INFO - üîß Getting Telnyx API keys for user: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-27T04:28:24.588969869Z [err]  2025-12-27 04:28:24,582 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:24.588978279Z [err]  2025-12-27 04:28:24,582 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.started', 'id': 'f7542133-7fb2-45bd-b14d-338d06e82cf1', 'occurred_at': '2025-12-27T04:28:24.463966Z', 'payload': {'call_control_id': 'v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw', 'call_leg_id': '7a123f5a-e2dc-11f0-b6df-02420aef981f', 'call_session_id': '7a0efcbe-e2dc-11f0-9af1-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '8fafb788-3ae2-4013-8095-e084b781317a', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:24.588983231Z [err]  2025-12-27 04:28:24,582 - server - INFO - üéØ Event type: streaming.started, Call ID: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:24.588987848Z [err]  2025-12-27 04:28:24,582 - server - INFO - üì® ================================================
2025-12-27T04:28:24.588991944Z [inf]  100.64.0.10:45560 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:24.590453022Z [err]  2025-12-27 04:28:24,588 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:24.590459305Z [err]  2025-12-27 04:28:24,588 - server - INFO - üîß Creating Telnyx service with user's keys...
2025-12-27T04:28:24.613015053Z [err]  2025-12-27 04:28:24,609 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-27T04:28:24.780165040Z [err]  2025-12-27 04:28:24,779 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-27T04:28:24.781463343Z [err]  2025-12-27 04:28:24,779 - server - INFO - ‚úÖ Call-started webhook sent successfully (status=200)
2025-12-27T04:28:24.809014096Z [err]  2025-12-27 04:28:24,804 - server - INFO - ‚ö†Ô∏è Session still not found after wait, will create in worker
2025-12-27T04:28:24.809018721Z [err]  2025-12-27 04:28:24,804 - server - WARNING - ‚ö†Ô∏è Session not found after waiting, creating in WebSocket worker...
2025-12-27T04:28:24.810798124Z [err]  2025-12-27 04:28:24,808 - redis_service - INFO - üì• Retrieved call data from Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:24.812870843Z [err]  2025-12-27 04:28:24,810 - server - INFO - üìù Creating session with agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-27T04:28:24.812876924Z [err]  2025-12-27 04:28:24,810 - calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-27T04:28:24.814343597Z [err]  2025-12-27 04:28:24,812 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw/actions/playback_start "HTTP/1.1 200 OK"
2025-12-27T04:28:24.816228192Z [err]  2025-12-27 04:28:24,813 - telnyx_service - INFO - ‚úÖ Playing audio from URL, playback_id: yfw-2AeZHg (loop=True, overlay=True)
2025-12-27T04:28:24.816234187Z [err]  2025-12-27 04:28:24,814 - server - WARNING - ‚ö†Ô∏è Failed to start comfort noise: 'v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'
2025-12-27T04:28:24.816238383Z [err]  2025-12-27 04:28:24,814 - telnyx_service - INFO - üéôÔ∏è Starting recording: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:24.937535495Z [err]  2025-12-27 04:28:24,927 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:24.937547180Z [err]  2025-12-27 04:28:24,927 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': '9219b401-3a75-4d1f-817b-78c7c0a59f56', 'occurred_at': '2025-12-27T04:28:24.803975Z', 'payload': {'call_control_id': 'v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw', 'call_leg_id': '7a123f5a-e2dc-11f0-b6df-02420aef981f', 'call_session_id': '7a0efcbe-e2dc-11f0-9af1-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'yfw-2AeZHg', 'start_time': '2025-12-27T04:28:24.803975Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:24.937554296Z [err]  2025-12-27 04:28:24,927 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:24.937560361Z [err]  2025-12-27 04:28:24,927 - server - INFO - üì® ================================================
2025-12-27T04:28:24.937566350Z [inf]  100.64.0.12:16478 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:25.171448580Z [err]  2025-12-27 04:28:25,166 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw/actions/record_start "HTTP/1.1 200 OK"
2025-12-27T04:28:25.171457560Z [err]  2025-12-27 04:28:25,169 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.1s silence: Are you still there?
2025-12-27T04:28:25.171458102Z [err]  2025-12-27 04:28:25,166 - server - INFO - üéôÔ∏è Call recording started for v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:25.171465077Z [err]  2025-12-27 04:28:25,167 - server - INFO - üîß Creating call session for v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw...
2025-12-27T04:28:25.171469578Z [err]  2025-12-27 04:28:25,169 - calling_service - INFO - ü§ñ Agent started speaking for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:25.171472619Z [err]  2025-12-27 04:28:25,167 - server - INFO - üîç Agent ID: bbeda238-e8d9-4d8c-b93b-1b7694581adb, User ID: dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-27T04:28:25.171479809Z [err]  2025-12-27 04:28:25,169 - telnyx_service - INFO - üîä Speaking text on call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q: Are you still there?...
2025-12-27T04:28:25.171481798Z [err]  2025-12-27 04:28:25,167 - server - INFO - üîß Calling create_call_session() - START
2025-12-27T04:28:25.171487679Z [err]  2025-12-27 04:28:25,167 - calling_service - INFO - üîç Checking KB for agent bbeda238-e8d9-4d8c-b93b-1b7694581adb...
2025-12-27T04:28:25.171493506Z [err]  2025-12-27 04:28:25,168 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:25.171498965Z [err]  2025-12-27 04:28:25,168 - calling_service - INFO - ‚è∞ Check-in triggered after 7.1s silence (threshold: 7s)
2025-12-27T04:28:25.171504316Z [err]  2025-12-27 04:28:25,169 - calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-27T04:28:25.173011927Z [err]  2025-12-27 04:28:25,169 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-27T04:28:25.173026150Z [err]  2025-12-27 04:28:25,169 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-27T04:28:25.173031687Z [err]  2025-12-27 04:28:25,169 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-27T04:28:25.173036637Z [err]  2025-12-27 04:28:25,169 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-27T04:28:25.173041003Z [err]  2025-12-27 04:28:25,169 - server - INFO - ‚è±Ô∏è [04:28:25.169] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-27T04:28:25.173046467Z [err]  2025-12-27 04:28:25,169 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-27T04:28:25.173050990Z [err]  2025-12-27 04:28:25,169 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-27T04:28:25.174390713Z [err]  2025-12-27 04:28:25,172 - calling_service - INFO - üîç KB count query completed: 4 items
2025-12-27T04:28:25.174396183Z [err]  2025-12-27 04:28:25,173 - calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-27T04:28:25.174400557Z [err]  2025-12-27 04:28:25,173 - calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-27T04:28:25.174404828Z [err]  2025-12-27 04:28:25,173 - calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-27T04:28:25.174408705Z [err]  2025-12-27 04:28:25,173 - calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-27T04:28:25.450324601Z [err]  2025-12-27 04:28:25,257 - calling_service - INFO - üîç KB count query completed: 4 items
2025-12-27T04:28:25.450334907Z [err]  2025-12-27 04:28:25,257 - calling_service - INFO - üìö Agent bbeda238-e8d9-4d8c-b93b-1b7694581adb has 4 KB items - Smart routing enabled (RAG on demand)
2025-12-27T04:28:25.450341725Z [err]  2025-12-27 04:28:25,260 - server - INFO -    Full data: {'text': 'Are you still there?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-27T04:28:25.450346706Z [err]  2025-12-27 04:28:25,257 - calling_service - INFO - üìã Built cached system prompt: 5065 chars (global) + 1402 chars (technical)
2025-12-27T04:28:25.450347076Z [err]  2025-12-27 04:28:25,257 - calling_service - INFO - üî• Pre-warming LLM client (grok)...
2025-12-27T04:28:25.450355383Z [err]  2025-12-27 04:28:25,257 - calling_service - INFO - üìö KB available - will use smart routing (simple chat: NO KB, factual: WITH KB)
2025-12-27T04:28:25.450366345Z [err]  2025-12-27 04:28:25,259 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:25.450372960Z [err]  2025-12-27 04:28:25,260 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-27T04:28:25.450378283Z [err]  2025-12-27 04:28:25,260 - server - INFO -    Text length: 20 chars
2025-12-27T04:28:25.450384053Z [err]  2025-12-27 04:28:25,260 - server - INFO -    Text content: 'Are you still there?'
2025-12-27T04:28:25.450391716Z [err]  2025-12-27 04:28:25,260 - server - INFO -    Text bytes: b'Are you still there?'
2025-12-27T04:28:25.450397313Z [err]  2025-12-27 04:28:25,260 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-27T04:28:25.450403226Z [err]  2025-12-27 04:28:25,260 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-27T04:28:25.450408515Z [err]  2025-12-27 04:28:25,260 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-27T04:28:25.451170825Z [err]  2025-12-27 04:28:25,260 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-27T04:28:25.451176598Z [err]  2025-12-27 04:28:25,260 - server - INFO -    Timeout: 10.0s
2025-12-27T04:28:25.451181266Z [err]  2025-12-27 04:28:25,268 - server - INFO -    ‚úì HTTP client created (0.008s)
2025-12-27T04:28:25.451185317Z [err]  2025-12-27 04:28:25,268 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-27T04:28:25.451189607Z [err]  2025-12-27 04:28:25,268 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:25.451194301Z [err]  2025-12-27 04:28:25,275 - calling_service - INFO - ‚úÖ LLM client pre-warmed in 102ms
2025-12-27T04:28:25.451200399Z [err]  2025-12-27 04:28:25,275 - server - INFO - ‚úÖ Session created in WebSocket worker
2025-12-27T04:28:25.451204689Z [err]  2025-12-27 04:28:25,275 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Scheduling silence timeout: 2000ms
2025-12-27T04:28:25.451209206Z [err]  2025-12-27 04:28:25,275 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task scheduled!
2025-12-27T04:28:25.451213515Z [err]  2025-12-27 04:28:25,275 - server - INFO - üìû Call data loaded, starting SONIOX connection...
2025-12-27T04:28:25.451217902Z [err]  2025-12-27 04:28:25,275 - server - INFO - ‚úÖ Initialized call_states for v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw with session reference
2025-12-27T04:28:25.451222405Z [err]  2025-12-27 04:28:25,275 - server - INFO - ‚úÖ Stored Telnyx WebSocket in call_data for audio streaming
2025-12-27T04:28:25.451226498Z [err]  2025-12-27 04:28:25,275 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found to update for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:25.451230724Z [err]  2025-12-27 04:28:25,277 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout task started, waiting 2000ms...
2025-12-27T04:28:25.451277912Z [err]  2025-12-27 04:28:25,346 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:25.451282410Z [err]  2025-12-27 04:28:25,355 - calling_service - INFO - ‚úÖ LLM client pre-warmed in 98ms
2025-12-27T04:28:25.451286858Z [err]  2025-12-27 04:28:25,355 - server - INFO - üîß Calling create_call_session() - COMPLETE
2025-12-27T04:28:25.451293352Z [err]  2025-12-27 04:28:25,355 - server - INFO - ‚úÖ Session object created: CallSession
2025-12-27T04:28:25.451298239Z [err]  2025-12-27 04:28:25,363 - redis_service - INFO - üì¶ Stored call data in Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw (TTL: 3600s)
2025-12-27T04:28:25.451303551Z [err]  2025-12-27 04:28:25,363 - server - INFO - ‚úÖ Serializable call_data synced to Redis (agent_id, user_id)
2025-12-27T04:28:25.451308420Z [err]  2025-12-27 04:28:25,363 - server - INFO - ‚úÖ Session stored in worker memory (not Redis)
2025-12-27T04:28:25.451313327Z [err]  2025-12-27 04:28:25,363 - redis_service - INFO - ‚úÖ Marked session ready in Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:25.451318695Z [err]  2025-12-27 04:28:25,363 - server - INFO - ü§ñ AI session created for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:25.451323116Z [err]  2025-12-27 04:28:25,364 - server - INFO - üì¶ Custom variables injected: {'lead_id': None, 'qc_tracking_enabled': False, 'track_keywords': '', 'expected_commitment': 'not_specified', 'customer_name': 'Kendrick', 'to_number': '+17708336397', 'phone_number': '+17708336397', 'email': None, 'from_number': '+14048000152'}
2025-12-27T04:28:25.451331652Z [err]  2025-12-27 04:28:25,364 - server - INFO - ‚è≠Ô∏è Skipping persistent TTS creation in webhook - will create on-demand with telnyx_ws
2025-12-27T04:28:25.451336455Z [err]  2025-12-27 04:28:25,364 - server - INFO - üë§ Who speaks first: user, aiSpeaksAfterSilence: True, timeout: 2000ms
2025-12-27T04:28:25.453577308Z [err]  2025-12-27 04:28:25,371 - server - INFO - üîë Using user's Soniox API key (first 10 chars): b999f22d7b...
2025-12-27T04:28:25.453589477Z [err]  2025-12-27 04:28:25,364 - server - INFO - üëÇ User speaks first - waiting for user input...
2025-12-27T04:28:25.453594198Z [err]  2025-12-27 04:28:25,364 - server - INFO - üõ°Ô∏è Voicemail timeout protection started (15000ms)
2025-12-27T04:28:25.453620858Z [err]  2025-12-27 04:28:25,364 - server - INFO - ‚è±Ô∏è AI will speak after 2000ms of silence (scheduled in WebSocket worker)
2025-12-27T04:28:25.453625611Z [err]  2025-12-27 04:28:25,364 - server - INFO - üé§ Voice flow - streaming started via dial command
2025-12-27T04:28:25.453644210Z [err]  2025-12-27 04:28:25,367 - redis_service - INFO - üì• Retrieved call data from Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:25.453651102Z [err]  2025-12-27 04:28:25,368 - server - INFO - ü§ê No greeting - waiting for user to speak first
2025-12-27T04:28:25.453662096Z [err]  2025-12-27 04:28:25,368 - server - INFO - üé§ Voice flow - WebSocket streaming already initiated
2025-12-27T04:28:25.453666515Z [inf]  100.64.0.11:43280 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:25.618168973Z [err]  2025-12-27 04:28:25,615 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-27T04:28:25.618178532Z [err]  2025-12-27 04:28:25,615 - server - INFO -    ‚úì Connection established (0.355s) [TARGET: <200ms]
2025-12-27T04:28:25.618185881Z [err]  2025-12-27 04:28:25,615 - server - INFO -    ‚úì Response status: 200
2025-12-27T04:28:25.618192013Z [err]  2025-12-27 04:28:25,615 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-27T04:28:25.633193274Z [err]  2025-12-27 04:28:25,625 - server - INFO -    ‚úì FIRST CHUNK received (0.366s, 1108 bytes) [TARGET: <300ms]
2025-12-27T04:28:25.633199736Z [err]  2025-12-27 04:28:25,629 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-27T04:28:25.633204125Z [err]  2025-12-27 04:28:25,628 - server - INFO -    ‚úì ALL CHUNKS received: 61 chunks (0.369s)
2025-12-27T04:28:25.633211192Z [err]  2025-12-27 04:28:25,628 - server - INFO -    ‚úì Total audio size: 18435 bytes
2025-12-27T04:28:25.633217606Z [err]  2025-12-27 04:28:25,629 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-27T04:28:25.633224129Z [err]  2025-12-27 04:28:25,629 - server - INFO -       - Connection: 355ms
2025-12-27T04:28:25.633230450Z [err]  2025-12-27 04:28:25,629 - server - INFO -       - First chunk: 366ms
2025-12-27T04:28:25.633237108Z [err]  2025-12-27 04:28:25,629 - server - INFO -       - All chunks: 369ms
2025-12-27T04:28:25.633243522Z [err]  2025-12-27 04:28:25,629 - server - INFO -       - Audio generation only: 10ms
2025-12-27T04:28:25.633252595Z [err]  2025-12-27 04:28:25,629 - server - INFO - ‚è±Ô∏è [04:28:25.629] üîä TTS COMPLETE: 459ms, audio_size=18435 bytes
2025-12-27T04:28:25.633259271Z [err]  2025-12-27 04:28:25,629 - server - INFO - üíæ TTS CACHED: elevenlabs:Are you still there?... (18435 bytes)
2025-12-27T04:28:25.633283308Z [err]  2025-12-27 04:28:25,629 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.46s
2025-12-27T04:28:25.633290308Z [err]  2025-12-27 04:28:25,629 - telnyx_service - INFO - ‚úÖ Generated 18435 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-27T04:28:25.874807318Z [err]  2025-12-27 04:28:25,859 - soniox_service - INFO - ‚úÖ Connected to Soniox Real-Time STT
2025-12-27T04:28:25.874816228Z [err]  2025-12-27 04:28:25,859 - soniox_service - INFO - ‚öôÔ∏è  Config: model=stt-rt-v3, format=mulaw, rate=8000Hz, channels=1
2025-12-27T04:28:25.874822787Z [err]  2025-12-27 04:28:25,859 - soniox_service - INFO - ‚öôÔ∏è  Endpoint detection: True, Speaker diarization: False
2025-12-27T04:28:25.874828872Z [err]  2025-12-27 04:28:25,859 - dead_air_monitor - INFO - üîá Dead air monitoring started for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:25.874834488Z [err]  2025-12-27 04:28:25,860 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:25.874839837Z [err]  2025-12-27 04:28:25,860 - server - INFO - ‚úÖ Started forwarding audio (8kHz mulaw ‚Üí Soniox, NO BUFFERING)
2025-12-27T04:28:25.914447621Z [err]  2025-12-27 04:28:25,912 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-27T04:28:25.916425202Z [err]  2025-12-27 04:28:25,913 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.28s
2025-12-27T04:28:25.916433743Z [err]  2025-12-27 04:28:25,913 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-27T04:28:25.916536197Z [err]    "errors": [
2025-12-27T04:28:25.916554938Z [err]      {
2025-12-27T04:28:25.916560713Z [err]        "code": "90018",
2025-12-27T04:28:25.916650132Z [err]        "title": "Call has already ended",
2025-12-27T04:28:25.916656903Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-27T04:28:25.916663262Z [err]      }
2025-12-27T04:28:25.916679344Z [err]    ]
2025-12-27T04:28:25.916747810Z [err]  }
2025-12-27T04:28:25.916755612Z [err]  2025-12-27 04:28:25,913 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-27T04:28:26.178589358Z [err]  2025-12-27 04:28:26,176 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-27T04:28:26.178597534Z [err]  2025-12-27 04:28:26,176 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-27T04:28:26.178609438Z [err]  2025-12-27 04:28:26,176 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-27T04:28:26.531029903Z [err]  2025-12-27 04:28:26,361 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:26.633727780Z [err]  2025-12-27 04:28:26,631 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-27T04:28:26.640145459Z [err]  2025-12-27 04:28:26,635 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-27T04:28:26.640151599Z [err]  2025-12-27 04:28:26,635 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:26.680183159Z [err]  2025-12-27 04:28:26,678 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-27T04:28:26.680189441Z [err]  2025-12-27 04:28:26,678 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766809706.678411 for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:26.680193635Z [err]  2025-12-27 04:28:26,678 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:26.682249439Z [err]  2025-12-27 04:28:26,679 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:26.864751508Z [err]  2025-12-27 04:28:26,862 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:27.185710930Z [err]  2025-12-27 04:28:27,180 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:27.544827470Z [err]  2025-12-27 04:28:27,281 - redis_service - INFO - üì• Retrieved call data from Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:27.544834140Z [err]  2025-12-27 04:28:27,286 - redis_service - INFO - üì• Retrieved call data from Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:27.641567065Z [err]  2025-12-27 04:28:27,639 - redis_service - INFO - üì¶ Stored call data in Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw (TTL: 3600s)
2025-12-27T04:28:27.641573084Z [err]  2025-12-27 04:28:27,639 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence timeout reached - generating greeting!
2025-12-27T04:28:27.641577694Z [err]  2025-12-27 04:28:27,639 - calling_service - INFO - ‚è±Ô∏è [04:28:27.639] üì• process_user_input() ENTRY - text: '...'
2025-12-27T04:28:27.648590287Z [err]  2025-12-27 04:28:27,644 - redis_service - INFO - üì• Retrieved call data from Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:27.648610009Z [err]  2025-12-27 04:28:27,645 - calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw: User spoke while Silence Greeting was triggering
2025-12-27T04:28:27.677693893Z [err]  2025-12-27 04:28:27,675 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-27T04:28:27.677700003Z [err]  2025-12-27 04:28:27,676 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:27.677704122Z [err]  2025-12-27 04:28:27,676 - telnyx_service - ERROR - ‚ùå Error stopping audio playback: 'ActionsResource' object has no attribute 'playback_stop'
2025-12-27T04:28:27.677708220Z [err]  2025-12-27 04:28:27,676 - calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-27T04:28:27.683946356Z [err]  2025-12-27 04:28:27,679 - redis_service - INFO - üì• Retrieved call data from Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:27.690269447Z [err]  2025-12-27 04:28:27,687 - calling_service - INFO - üîß Replaced {{callerName}} with  in content
2025-12-27T04:28:27.690271846Z [err]  2025-12-27 04:28:27,686 - redis_service - INFO - üì¶ Stored call data in Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw (TTL: 3600s)
2025-12-27T04:28:27.690279144Z [err]  2025-12-27 04:28:27,687 - calling_service - INFO - üîß Replaced {{lead_id}} with None in content
2025-12-27T04:28:27.690285662Z [err]  2025-12-27 04:28:27,687 - calling_service - INFO - üîß Replaced {{qc_tracking_enabled}} with False in content
2025-12-27T04:28:27.690286279Z [err]  2025-12-27 04:28:27,686 - calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-27T04:28:27.690291456Z [err]  2025-12-27 04:28:27,687 - calling_service - INFO - üîß Replaced {{track_keywords}} with  in content
2025-12-27T04:28:27.690294578Z [err]  2025-12-27 04:28:27,686 - calling_service - INFO - ‚è±Ô∏è [04:28:27.686] ‚è© About to call _process_call_flow_streaming()
2025-12-27T04:28:27.690308198Z [err]  2025-12-27 04:28:27,686 - calling_service - INFO - ‚è±Ô∏è [04:28:27.686] üîÄ Agent type: call_flow, calling flow processor...
2025-12-27T04:28:27.690315717Z [err]  2025-12-27 04:28:27,686 - calling_service - INFO - ‚è±Ô∏è [04:28:27.686] üîÄ _process_call_flow_streaming() ENTRY
2025-12-27T04:28:27.690324280Z [err]  2025-12-27 04:28:27,686 - calling_service - INFO - Flow processing - History length: 1, Is first: True
2025-12-27T04:28:27.690330449Z [err]  2025-12-27 04:28:27,686 - calling_service - INFO - ‚è±Ô∏è [04:28:27.686] ‚úÖ Node selected, about to process content...
2025-12-27T04:28:27.690336025Z [err]  2025-12-27 04:28:27,686 - calling_service - INFO - üîß Replaced {{now}} with Friday, December 26, 2025 at 11:28 PM EST in content
2025-12-27T04:28:27.690341787Z [err]  2025-12-27 04:28:27,686 - calling_service - INFO - üîß Replaced {{customer_name}} with Kendrick in content
2025-12-27T04:28:27.692751337Z [err]  2025-12-27 04:28:27,687 - calling_service - INFO - üîß Replaced {{expected_commitment}} with not_specified in content
2025-12-27T04:28:27.692759768Z [err]  2025-12-27 04:28:27,687 - calling_service - INFO - üîß Replaced {{to_number}} with +17708336397 in content
2025-12-27T04:28:27.692765638Z [err]  2025-12-27 04:28:27,687 - calling_service - INFO - üîß Replaced {{phone_number}} with +17708336397 in content
2025-12-27T04:28:27.692770818Z [err]  2025-12-27 04:28:27,687 - calling_service - INFO - üîß Replaced {{email}} with None in content
2025-12-27T04:28:27.692778226Z [err]  2025-12-27 04:28:27,687 - calling_service - INFO - ‚úÖ Using explicit SCRIPT mode (length: 9 chars) - will return text instantly
2025-12-27T04:28:27.692783454Z [err]  2025-12-27 04:28:27,687 - calling_service - INFO - Using flow node: Greeting (type: conversation, mode: script)
2025-12-27T04:28:27.692792315Z [err]  2025-12-27 04:28:27,687 - calling_service - INFO - üìö skip_mandatory_precheck=true - skipping pre-response mandatory check, will check on transition
2025-12-27T04:28:27.692798155Z [err]  2025-12-27 04:28:27,687 - calling_service - INFO - ‚è±Ô∏è [04:28:27.687] üìÑ About to process content (mode=script, length=9)
2025-12-27T04:28:27.692804798Z [err]  2025-12-27 04:28:27,687 - calling_service - INFO - üîä Silence tracking reset for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw (user responded)
2025-12-27T04:28:27.692810688Z [err]  2025-12-27 04:28:27,687 - calling_service - INFO - ‚úÖ User responded to regular message, resetting counter
2025-12-27T04:28:27.692816775Z [err]  2025-12-27 04:28:27,687 - calling_service - INFO - üíæ Storing node ID 2 in conversation history
2025-12-27T04:28:27.692822111Z [err]  2025-12-27 04:28:27,687 - calling_service - INFO - LLM response (0.05s): Kendrick?
2025-12-27T04:28:27.692829469Z [err]  2025-12-27 04:28:27,687 - calling_service - INFO - Total latency: 0.05s
2025-12-27T04:28:27.692844267Z [err]  2025-12-27 04:28:27,688 - server - INFO - üí¨ [WebSocket Worker] AI speaks after silence: Kendrick?
2025-12-27T04:28:27.692850615Z [err]  2025-12-27 04:28:27,691 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:27.694036965Z [err]  2025-12-27 04:28:27,691 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:27.811195778Z [err]  2025-12-27 04:28:27,790 - redis_service - INFO - üì• Retrieved call data from Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:27.811205439Z [err]  2025-12-27 04:28:27,792 - telnyx_service - INFO - üîä Speaking text on call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw: Kendrick?...
2025-12-27T04:28:27.811210588Z [err]  2025-12-27 04:28:27,792 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-27T04:28:27.811217080Z [err]  2025-12-27 04:28:27,792 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-27T04:28:27.811221718Z [err]  2025-12-27 04:28:27,792 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-27T04:28:27.811226273Z [err]  2025-12-27 04:28:27,792 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-27T04:28:27.811230974Z [err]  2025-12-27 04:28:27,792 - server - INFO - ‚è±Ô∏è [04:28:27.792] üîä TTS REQUEST START: provider=elevenlabs, user=dcafa642, comfort_noise=True
2025-12-27T04:28:27.811235630Z [err]  2025-12-27 04:28:27,792 - server - INFO - ‚ö° Using Turbo v2.5 (high quality)
2025-12-27T04:28:27.811241028Z [err]  2025-12-27 04:28:27,793 - server - INFO - üéôÔ∏è ElevenLabs streaming TTS: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5, speed=1.1, normalization=on, ssml=True
2025-12-27T04:28:27.888088951Z [err]  2025-12-27 04:28:27,885 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:27.888099421Z [err]  2025-12-27 04:28:27,885 - server - INFO - üì¶ ElevenLabs Request Payload:
2025-12-27T04:28:27.888105994Z [err]  2025-12-27 04:28:27,885 - server - INFO -    Text length: 9 chars
2025-12-27T04:28:27.888112699Z [err]  2025-12-27 04:28:27,885 - server - INFO -    Text content: 'Kendrick?'
2025-12-27T04:28:27.888118311Z [err]  2025-12-27 04:28:27,885 - server - INFO -    Text bytes: b'Kendrick?'
2025-12-27T04:28:27.888125444Z [err]  2025-12-27 04:28:27,885 - server - INFO -    Model: eleven_turbo_v2_5
2025-12-27T04:28:27.888131137Z [err]  2025-12-27 04:28:27,885 - server - INFO -    Voice ID: J5iaaqzR5zn6HFG4jV3b
2025-12-27T04:28:27.888137167Z [err]  2025-12-27 04:28:27,886 - server - INFO -    URL: https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream
2025-12-27T04:28:27.888142613Z [err]  2025-12-27 04:28:27,886 - server - INFO -    Full data: {'text': 'Kendrick?', 'model_id': 'eleven_turbo_v2_5', 'voice_settings': {'stability': 0.6, 'similarity_boost': 0.65, 'use_speaker_boost': True, 'speed': 1.1, 'style': 0.2}, 'apply_text_normalization': 'on', 'enable_ssml_parsing': True, 'optimize_streaming_latency': 4}
2025-12-27T04:28:27.888148154Z [err]  2025-12-27 04:28:27,886 - server - INFO - üîå Attempting ElevenLabs connection (attempt 1/2)
2025-12-27T04:28:27.888154021Z [err]  2025-12-27 04:28:27,886 - server - INFO -    Timeout: 10.0s
2025-12-27T04:28:27.905354758Z [err]  2025-12-27 04:28:27,897 - server - INFO -    ‚úì HTTP client created (0.012s)
2025-12-27T04:28:27.905363130Z [err]  2025-12-27 04:28:27,897 - server - INFO -    ‚Üí Sending POST request to ElevenLabs (optimize_latency=0)...
2025-12-27T04:28:28.009610580Z [err]  2025-12-27 04:28:28,003 - server - INFO - üî§ RAW TOKENS: ["H"?]
2025-12-27T04:28:28.009623112Z [err]  2025-12-27 04:28:28,003 - calling_service - INFO - üîä Silence timer reset for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw (user started speaking)
2025-12-27T04:28:28.009631273Z [err]  2025-12-27 04:28:28,003 - calling_service - INFO - üë§ User started speaking for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:28.009639992Z [err]  2025-12-27 04:28:28,003 - server - WARNING - Failed to update user_has_spoken in Redis: cannot access local variable 'redis_svc' where it is not associated with a value
2025-12-27T04:28:28.009646777Z [err]  2025-12-27 04:28:28,003 - server - INFO - üîç PARTIAL TRANSCRIPT: 'H' | Generating: False
2025-12-27T04:28:28.070308540Z [err]  2025-12-27 04:28:28,067 - server - INFO - üî§ RAW TOKENS: ["H"?, "ello"?]
2025-12-27T04:28:28.070321436Z [err]  2025-12-27 04:28:28,067 - server - INFO - üîç PARTIAL TRANSCRIPT: 'Hello' | Generating: False
2025-12-27T04:28:28.143709063Z [err]  2025-12-27 04:28:28,137 - server - INFO - üî§ RAW TOKENS: ["H"‚úì, "ello"‚úì, "?"‚úì, "<end>"‚úì]
2025-12-27T04:28:28.143723737Z [err]  2025-12-27 04:28:28,137 - server - INFO - üéØ Endpoint detected: <end> token received
2025-12-27T04:28:28.143730651Z [err]  2025-12-27 04:28:28,137 - server - INFO - üßπ Cleaned transcript: 'H ello ?' -> 'Hello?'
2025-12-27T04:28:28.143735463Z [err]  2025-12-27 04:28:28,137 - server - INFO - üì• FINAL TOKENS: 'Hello?' (3 tokens)
2025-12-27T04:28:28.143740076Z [err]  2025-12-27 04:28:28,137 - server - INFO - üé§ Soniox final transcript: 'Hello?'
2025-12-27T04:28:28.143752025Z [err]  2025-12-27 04:28:28,137 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:28.143756395Z [err]  2025-12-27 04:28:28,137 - server - INFO - üîç FILTER CHECK: words=1, is_filler=False, is_garbled=False, tts_speaking=False, time_until_done=0.0s, generating=False, playbacks=0, is_active=False
2025-12-27T04:28:28.143760712Z [err]  2025-12-27 04:28:28,137 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:28.143765455Z [err]  2025-12-27 04:28:28,137 - server - INFO - üöÄ Spawned tracked background task for endpoint processing
2025-12-27T04:28:28.143769427Z [err]  2025-12-27 04:28:28,137 - server - INFO - ‚è±Ô∏è [04:28:28.137] üìù FINAL TRANSCRIPT RECEIVED: 'Hello?'
2025-12-27T04:28:28.143773600Z [err]  2025-12-27 04:28:28,137 - server - INFO - ‚è±Ô∏è [04:28:28.137] STT endpoint detection latency: 6ms
2025-12-27T04:28:28.143778038Z [err]  2025-12-27 04:28:28,137 - server - INFO - ‚è±Ô∏è [04:28:28.137] üé§ USER STOPPED SPEAKING - Beginning processing pipeline
2025-12-27T04:28:28.143781951Z [err]  2025-12-27 04:28:28,138 - redis_service - INFO - üì¶ Stored call data in Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw (TTL: 3600s)
2025-12-27T04:28:28.145089078Z [err]  2025-12-27 04:28:28,138 - server - INFO - üë§ User has spoken - aiSpeaksAfterSilence timer cancelled if pending
2025-12-27T04:28:28.145102593Z [err]  2025-12-27 04:28:28,138 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:28.145108033Z [err]  2025-12-27 04:28:28,138 - server - INFO - ‚úÖ Agent SILENT - User said 1 word(s): 'Hello?' - Processing...
2025-12-27T04:28:28.151444524Z [err]  2025-12-27 04:28:28,149 - server - INFO - üé§ Endpoint detected by Soniox - processing transcript: Hello?
2025-12-27T04:28:28.151453624Z [err]  2025-12-27 04:28:28,149 - calling_service - INFO - üë§ User stopped speaking for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:28.151460156Z [err]  2025-12-27 04:28:28,149 - server - INFO - ‚è±Ô∏è [TIMING] STT_START: User last audio packet received
2025-12-27T04:28:28.151465224Z [err]  2025-12-27 04:28:28,149 - server - INFO - ‚è±Ô∏è [TIMING] STT_END: Endpoint detected at T+17ms
2025-12-27T04:28:28.151470089Z [err]  2025-12-27 04:28:28,149 - server - INFO - ‚è±Ô∏è [TIMING] STT_LATENCY: 17ms (Soniox model: stt-rt-v3)
2025-12-27T04:28:28.151475382Z [err]  2025-12-27 04:28:28,149 - server - INFO - ‚è±Ô∏è  USER STOPPED SPEAKING at T=0ms
2025-12-27T04:28:28.151480734Z [err]  2025-12-27 04:28:28,149 - server - INFO - üéôÔ∏è Agent generating response - interruption detection active
2025-12-27T04:28:28.151487140Z [err]  2025-12-27 04:28:28,149 - calling_service - INFO - ü§ñ Agent started speaking for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:28.195280093Z [err]  2025-12-27 04:28:28,192 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:28.195289898Z [err]  2025-12-27 04:28:28,193 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:28.195295801Z [err]  2025-12-27 04:28:28,193 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:28.230594755Z [err]  2025-12-27 04:28:28,226 - httpx - INFO - HTTP Request: POST https://api.elevenlabs.io/v1/text-to-speech/J5iaaqzR5zn6HFG4jV3b/stream "HTTP/1.1 200 OK"
2025-12-27T04:28:28.230603139Z [err]  2025-12-27 04:28:28,226 - server - INFO -    ‚úì Connection established (0.340s) [TARGET: <200ms]
2025-12-27T04:28:28.230609038Z [err]  2025-12-27 04:28:28,226 - server - INFO -    ‚úì Response status: 200
2025-12-27T04:28:28.230614430Z [err]  2025-12-27 04:28:28,226 - server - INFO -    ‚Üí Streaming audio chunks...
2025-12-27T04:28:28.584140963Z [err]  2025-12-27 04:28:28,237 - server - INFO -    ‚úì FIRST CHUNK received (0.351s, 403 bytes) [TARGET: <300ms]
2025-12-27T04:28:28.584145262Z [err]  2025-12-27 04:28:28,239 - server - INFO -    ‚úì ALL CHUNKS received: 29 chunks (0.353s)
2025-12-27T04:28:28.584150493Z [err]  2025-12-27 04:28:28,239 - server - INFO -    ‚úì Total audio size: 14673 bytes
2025-12-27T04:28:28.584155211Z [err]  2025-12-27 04:28:28,239 - server - INFO -    üìä TTS API TIMING BREAKDOWN:
2025-12-27T04:28:28.584160906Z [err]  2025-12-27 04:28:28,239 - server - INFO -       - Connection: 340ms
2025-12-27T04:28:28.584167163Z [err]  2025-12-27 04:28:28,239 - server - INFO -       - First chunk: 351ms
2025-12-27T04:28:28.584173465Z [err]  2025-12-27 04:28:28,239 - server - INFO -       - All chunks: 353ms
2025-12-27T04:28:28.584179448Z [err]  2025-12-27 04:28:28,239 - server - INFO -       - Audio generation only: 10ms
2025-12-27T04:28:28.584184580Z [err]  2025-12-27 04:28:28,239 - server - INFO - ‚è±Ô∏è [04:28:28.239] üîä TTS COMPLETE: 446ms, audio_size=14673 bytes
2025-12-27T04:28:28.584190314Z [err]  2025-12-27 04:28:28,239 - server - INFO - üíæ TTS CACHED: elevenlabs:Kendrick?... (14673 bytes)
2025-12-27T04:28:28.584195324Z [err]  2025-12-27 04:28:28,239 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.45s
2025-12-27T04:28:28.584200957Z [err]  2025-12-27 04:28:28,239 - telnyx_service - INFO - ‚úÖ Generated 14673 bytes, saved to /tmp/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-27T04:28:28.584206831Z [err]  2025-12-27 04:28:28,239 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3
2025-12-27T04:28:28.584212910Z [err]  2025-12-27 04:28:28,248 - server - INFO - üìù Saved user transcript to database
2025-12-27T04:28:28.584216960Z [err]  2025-12-27 04:28:28,248 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:28.585268982Z [err]  2025-12-27 04:28:28,248 - calling_service - INFO - ‚è±Ô∏è [04:28:28.248] üì• process_user_input() ENTRY - text: 'Hello?...'
2025-12-27T04:28:28.585278703Z [err]  2025-12-27 04:28:28,249 - redis_service - INFO - üì• Retrieved call data from Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:28.585285680Z [err]  2025-12-27 04:28:28,249 - calling_service - WARNING - üö® BARGE-IN DETECTED for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw: User spoke while Silence Greeting was triggering
2025-12-27T04:28:28.585292978Z [err]  2025-12-27 04:28:28,272 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-27T04:28:28.585301932Z [err]  2025-12-27 04:28:28,272 - telnyx_service - INFO - üõë Stopping audio playback on call: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:28.585308450Z [err]  2025-12-27 04:28:28,272 - telnyx_service - ERROR - ‚ùå Error stopping audio playback: 'ActionsResource' object has no attribute 'playback_stop'
2025-12-27T04:28:28.585314450Z [err]  2025-12-27 04:28:28,272 - calling_service - INFO - ‚úÖ BARGE-IN: Audio playback STOPPED
2025-12-27T04:28:28.585320708Z [err]  2025-12-27 04:28:28,272 - calling_service - INFO - ‚úÖ BARGE-IN: Removed silence greeting from history: 'Kendrick?'
2025-12-27T04:28:28.585327122Z [err]  2025-12-27 04:28:28,273 - redis_service - INFO - üì• Retrieved call data from Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:28.585333264Z [err]  2025-12-27 04:28:28,274 - redis_service - INFO - üì¶ Stored call data in Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw (TTL: 3600s)
2025-12-27T04:28:28.585339785Z [err]  2025-12-27 04:28:28,274 - calling_service - INFO - ‚úÖ BARGE-IN: Reset silence_greeting_triggered flag
2025-12-27T04:28:28.585346783Z [err]  2025-12-27 04:28:28,274 - calling_service - INFO - ‚úÖ BARGE-IN: Returning greeting script: 'Kendrick?'
2025-12-27T04:28:28.587239348Z [err]  2025-12-27 04:28:28,274 - server - INFO - üì§ Sentence arrived from LLM: Kendrick?...
2025-12-27T04:28:28.587248941Z [err]  2025-12-27 04:28:28,274 - server - INFO - ‚è±Ô∏è [TIMING] TTFS (Time To First Sentence): 125ms
2025-12-27T04:28:28.587257120Z [err]  2025-12-27 04:28:28,274 - server - INFO - ‚ö° Starting REAL-TIME TTS for first sentence
2025-12-27T04:28:28.587264651Z [err]  2025-12-27 04:28:28,274 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:28.587271699Z [err]  2025-12-27 04:28:28,274 - server - INFO - ‚ö° ON-DEMAND: Creating persistent TTS session (multi-worker mode)
2025-12-27T04:28:28.587278405Z [err]  2025-12-27 04:28:28,367 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:28.587283165Z [err]  2025-12-27 04:28:28,459 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:28.587288258Z [err]  2025-12-27 04:28:28,538 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw/actions/playback_start "HTTP/1.1 200 OK"
2025-12-27T04:28:28.587295169Z [err]  2025-12-27 04:28:28,538 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.30s
2025-12-27T04:28:28.587300346Z [err]  2025-12-27 04:28:28,538 - telnyx_service - INFO - ‚è±Ô∏è  Total TTS latency: 0.75s
2025-12-27T04:28:28.587305384Z [err]  2025-12-27 04:28:28,538 - telnyx_service - INFO - ‚úÖ Playing elevenlabs audio via Telnyx playback
2025-12-27T04:28:28.587311518Z [err]  2025-12-27 04:28:28,538 - telnyx_service - INFO - üé¨ Playback ID: 3thSn1LGHQ
2025-12-27T04:28:28.587316048Z [err]  2025-12-27 04:28:28,539 - server - INFO - üîä [WebSocket Worker] Silence greeting spoken via Telnyx TTS
2025-12-27T04:28:28.587320585Z [err]  2025-12-27 04:28:28,539 - server - INFO - ‚è±Ô∏è [WebSocket Worker] Silence tracking started for dead air monitoring
2025-12-27T04:28:28.588869694Z [err]  2025-12-27 04:28:28,552 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:28.588880446Z [err]  2025-12-27 04:28:28,574 - telnyx_service - INFO - Telnyx service initialized with connection: 2777245537294877821
2025-12-27T04:28:28.588888845Z [err]  2025-12-27 04:28:28,574 - server - INFO - ‚úÖ ON-DEMAND: Using Telnyx WebSocket from closure for streaming audio
2025-12-27T04:28:28.588915152Z [err]  2025-12-27 04:28:28,574 - persistent_tts_service - INFO - üéôÔ∏è Extracted voice_settings from agent config: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-27T04:28:28.588922014Z [err]  2025-12-27 04:28:28,574 - persistent_tts_service - INFO - üîå [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Establishing persistent TTS WebSocket...
2025-12-27T04:28:28.588928944Z [err]  2025-12-27 04:28:28,574 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Voice settings: {'stability': 0.6, 'similarity_boost': 0.65, 'style': 0.2, 'use_speaker_boost': True}
2025-12-27T04:28:28.588935813Z [err]  2025-12-27 04:28:28,574 - elevenlabs_ws_service - INFO - üîå Connecting to ElevenLabs WebSocket: voice=J5iaaqzR5zn6HFG4jV3b, model=eleven_turbo_v2_5
2025-12-27T04:28:28.588943981Z [err]  2025-12-27 04:28:28,574 - elevenlabs_ws_service - INFO - üéôÔ∏è Voice settings: stability=0.6, similarity=0.65, style=0.2
2025-12-27T04:28:28.698134387Z [err]  2025-12-27 04:28:28,692 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:28.698147310Z [err]  2025-12-27 04:28:28,692 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.machine.premium.detection.ended', 'id': '0e6ee92a-259b-4fea-95c2-e9d58a2832fa', 'occurred_at': '2025-12-27T04:28:28.563961Z', 'payload': {'call_control_id': 'v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw', 'call_leg_id': '7a123f5a-e2dc-11f0-b6df-02420aef981f', 'call_session_id': '7a0efcbe-e2dc-11f0-9af1-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'from': '+14048000152', 'result': 'human_residence', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:28.698153260Z [err]  2025-12-27 04:28:28,692 - server - INFO - üéØ Event type: call.machine.premium.detection.ended, Call ID: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:28.698158571Z [err]  2025-12-27 04:28:28,692 - server - INFO - üì® ================================================
2025-12-27T04:28:28.698163433Z [inf]  100.64.0.12:16478 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:28.698169869Z [err]  2025-12-27 04:28:28,694 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:28.698175182Z [err]  2025-12-27 04:28:28,695 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:28.704375543Z [err]  2025-12-27 04:28:28,698 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:28.714116141Z [err]  2025-12-27 04:28:28,707 - persistent_tts_service - INFO - üéµ [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Playback consumer started
2025-12-27T04:28:28.714141051Z [err]  2025-12-27 04:28:28,705 - elevenlabs_ws_service - INFO - ‚úÖ Connected to ElevenLabs WebSocket
2025-12-27T04:28:28.714148338Z [err]  2025-12-27 04:28:28,705 - elevenlabs_ws_service - INFO - üì§ Sent BOS message with voice settings
2025-12-27T04:28:28.714156105Z [err]  2025-12-27 04:28:28,705 - persistent_tts_service - INFO - ‚úÖ [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Persistent TTS WebSocket established
2025-12-27T04:28:28.714162099Z [err]  2025-12-27 04:28:28,705 - persistent_tts_service - INFO - üéß [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Audio receiver loop started
2025-12-27T04:28:28.714170074Z [err]  2025-12-27 04:28:28,705 - persistent_tts_service - INFO - üîä [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Comfort noise loop started
2025-12-27T04:28:28.714176196Z [err]  2025-12-27 04:28:28,705 - persistent_tts_service - INFO - ‚úÖ Created persistent TTS session for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:28.714181112Z [err]  2025-12-27 04:28:28,705 - server - INFO - ‚úÖ ON-DEMAND: Persistent TTS session created successfully!
2025-12-27T04:28:28.714186113Z [err]  2025-12-27 04:28:28,705 - server - INFO - üîç Persistent TTS lookup: call_id=v3:80AGoJbA7H-Axl0z5..., session=FOUND
2025-12-27T04:28:28.714191321Z [err]  2025-12-27 04:28:28,705 - server - INFO - üöÄ Streaming sentence #1 via persistent WebSocket
2025-12-27T04:28:28.714197264Z [err]  2025-12-27 04:28:28,705 - server - INFO - üéµ TTS task #1 started at +431ms
2025-12-27T04:28:28.714203204Z [err]  2025-12-27 04:28:28,705 - server - INFO - ‚è±Ô∏è [TIMING] TTFT_TTS (First TTS Task Started): 556ms
2025-12-27T04:28:28.714208783Z [err]  2025-12-27 04:28:28,706 - server - ERROR - ‚ùå Error processing transcript: 'str' object has no attribute 'get'
2025-12-27T04:28:28.715221677Z [err]  2025-12-27 04:28:28,707 - persistent_tts_service - INFO - üéß [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Audio Receiver Loop STARTED
2025-12-27T04:28:28.715230596Z [err]  2025-12-27 04:28:28,707 - persistent_tts_service - INFO - üíì [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Starting TTS keep-alive loop (every 15s)
2025-12-27T04:28:28.715236860Z [err]  2025-12-27 04:28:28,707 - persistent_tts_service - INFO - üîä [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Starting comfort noise loop
2025-12-27T04:28:28.715244049Z [err]  2025-12-27 04:28:28,707 - persistent_tts_service - INFO - üé§ [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Streaming sentence #1: Kendrick?...
2025-12-27T04:28:28.715250152Z [err]  2025-12-27 04:28:28,707 - persistent_tts_service - INFO - üöÄ [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Sent sentence #1 (NON-BLOCKING) in 0ms
2025-12-27T04:28:28.715257678Z [err]  2025-12-27 04:28:28,707 - persistent_tts_service - INFO - üìä [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] DIAGNOSTIC: pending_sentences=1, audio_queue=0, is_first=True, is_last=False
2025-12-27T04:28:28.715263443Z [err]  2025-12-27 04:28:28,707 - persistent_tts_service - INFO - üéß [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Receiver processing sentence #1: 'Kendrick?...'
2025-12-27T04:28:28.715269536Z [err]  2025-12-27 04:28:28,707 - persistent_tts_service - INFO - üìä [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] DIAGNOSTIC: queue_latency=0ms, pending_sentences=0, audio_queue=0, interrupted=False
2025-12-27T04:28:28.873529576Z [inf]  100.64.0.9:36032 - "GET /api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3 HTTP/1.1" 200
2025-12-27T04:28:28.959179376Z [err]  2025-12-27 04:28:28,954 - persistent_tts_service - INFO - ‚è±Ô∏è [TIMING] TTFA (Time To First Audio Playback): 247ms
2025-12-27T04:28:28.959184087Z [err]  2025-12-27 04:28:28,954 - persistent_tts_service - INFO - üì§ Sending 7043 bytes of audio (45 chunks, 0.9s duration) via WebSocket
2025-12-27T04:28:28.959188617Z [err]  2025-12-27 04:28:28,954 - persistent_tts_service - INFO - üéôÔ∏è [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] AGENT IS NOW SPEAKING (is_speaking=True)
2025-12-27T04:28:28.959192703Z [err]  2025-12-27 04:28:28,955 - persistent_tts_service - INFO - ‚è±Ô∏è EXTEND playback_expected_end_time: +0.9s (total: 0.9s from now)
2025-12-27T04:28:28.959197069Z [err]  2025-12-27 04:28:28,955 - persistent_tts_service - INFO - ‚úÖ Sent 45 audio chunks via WebSocket
2025-12-27T04:28:29.206151747Z [err]  2025-12-27 04:28:29,199 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:29.545554103Z [err]  2025-12-27 04:28:29,391 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:29.545561395Z [err]  2025-12-27 04:28:29,392 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.started', 'id': 'f6977bb9-78bf-494e-9d00-3638afb67d95', 'occurred_at': '2025-12-27T04:28:29.263961Z', 'payload': {'call_control_id': 'v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw', 'call_leg_id': '7a123f5a-e2dc-11f0-b6df-02420aef981f', 'call_session_id': '7a0efcbe-e2dc-11f0-9af1-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': '3thSn1LGHQ'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:29.545567904Z [err]  2025-12-27 04:28:29,392 - server - INFO - üéØ Event type: call.playback.started, Call ID: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:29.545574960Z [err]  2025-12-27 04:28:29,392 - server - INFO - üì® ================================================
2025-12-27T04:28:29.545581006Z [inf]  100.64.0.9:36032 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:29.545587206Z [err]  2025-12-27 04:28:29,444 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-27T04:28:29.545593528Z [err]  2025-12-27 04:28:29,448 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Expecting value: line 1 column 1 (char 0)
2025-12-27T04:28:29.550492985Z [err]  2025-12-27 04:28:29,548 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:29.550496893Z [err]  2025-12-27 04:28:29,548 - server - INFO - ‚úÖ QC analysis completed for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:29.550502039Z [err]  2025-12-27 04:28:29,548 - server - INFO - üìä Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-27T04:28:29.701470507Z [err]  2025-12-27 04:28:29,699 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:29.748597442Z [err]  2025-12-27 04:28:29,744 - server - INFO - üìä Updated campaign_calls with QC scores for v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:29.937081814Z [err]  2025-12-27 04:28:29,931 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match
2025-12-27T04:28:29.961265030Z [err]  2025-12-27 04:28:29,955 - persistent_tts_service - INFO - üîá [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] FLOOR RELEASED (is_holding_floor=False)
2025-12-27T04:28:30.026676730Z [err]  2025-12-27 04:28:30,024 - server - INFO - üè∑Ô∏è Updated lead status to 'needs_followup' based on risk level 'high'
2025-12-27T04:28:30.026694485Z [err]  2025-12-27 04:28:30,024 - server - ERROR - ‚ùå Error in auto appointment detection for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q: 'str' object has no attribute 'get'
2025-12-27T04:28:30.203097612Z [err]  2025-12-27 04:28:30,201 - dead_air_monitor - INFO - ‚è±Ô∏è Playback expected end time passed (0.4s ago), marking agent as done speaking
2025-12-27T04:28:30.203106210Z [err]  2025-12-27 04:28:30,201 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766809710.2011657 for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:30.203113612Z [err]  2025-12-27 04:28:30,201 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:30.203118903Z [err]  2025-12-27 04:28:30,201 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.0s, checkin_count=0/2
2025-12-27T04:28:30.203125734Z [err]  2025-12-27 04:28:30,201 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:30.203131756Z [err]  2025-12-27 04:28:30,201 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=3.5s, checkin_count=1/2
2025-12-27T04:28:30.473686758Z [err]  2025-12-27 04:28:30,305 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:30.473695460Z [err]  2025-12-27 04:28:30,305 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': 'c75b2f9b-cde0-4f47-9127-8d56f1020181', 'occurred_at': '2025-12-27T04:28:30.183964Z', 'payload': {'call_control_id': 'v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw', 'call_leg_id': '7a123f5a-e2dc-11f0-b6df-02420aef981f', 'call_session_id': '7a0efcbe-e2dc-11f0-9af1-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/tts_4837cb141ab1223ca76c9b05a8448cb6.mp3', 'overlay': False, 'playback_id': '3thSn1LGHQ', 'status': 'completed', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:30.473705439Z [err]  2025-12-27 04:28:30,305 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:30.473712476Z [err]  2025-12-27 04:28:30,305 - server - INFO - üì® ================================================
2025-12-27T04:28:30.473719747Z [err]  2025-12-27 04:28:30,306 - redis_service - INFO - ‚ûñ Removed playback 3thSn1LGHQ, 0 remaining for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:30.473726653Z [err]  2025-12-27 04:28:30,307 - server - INFO - üîä Redis: Removed playback 3thSn1LGHQ, 0 remaining
2025-12-27T04:28:30.473733195Z [err]  2025-12-27 04:28:30,307 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-27T04:28:30.473739973Z [err]  2025-12-27 04:28:30,307 - server - INFO - ‚è±Ô∏è CLEARED playback_expected_end_time - agent is definitely done speaking
2025-12-27T04:28:30.473746636Z [err]  2025-12-27 04:28:30,307 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-27T04:28:30.474185526Z [err]  2025-12-27 04:28:30,307 - server - INFO - ‚úÖ Found session locally: agent_speaking=False, user_speaking=False
2025-12-27T04:28:30.474191897Z [err]  2025-12-27 04:28:30,307 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766809710.3078644 for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:30.474197771Z [err]  2025-12-27 04:28:30,307 - server - INFO - ‚è±Ô∏è Silence timer STARTED (local, agent wasn't marked as speaking)
2025-12-27T04:28:30.474203505Z [inf]  100.64.0.9:36032 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:30.702790097Z [err]  2025-12-27 04:28:30,701 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=0.4s, checkin_count=0/2
2025-12-27T04:28:30.703662692Z [err]  2025-12-27 04:28:30,702 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:30.703669079Z [err]  2025-12-27 04:28:30,702 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=4.0s, checkin_count=1/2
2025-12-27T04:28:30.874125303Z [err]  2025-12-27 04:28:30,870 - server - INFO - üì§ Audio flowing: 307 packets sent to Soniox (5s update)
2025-12-27T04:28:30.958714054Z [err]  2025-12-27 04:28:30,955 - elevenlabs_ws_service - INFO - ‚è±Ô∏è  [TIMING] ElevenLabs audio stream complete (0.5s timeout reached) - End of Sentence
2025-12-27T04:28:30.958725186Z [err]  2025-12-27 04:28:30,955 - persistent_tts_service - INFO - ‚úÖ [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Receiver finished sentence #1: 1 chunks in 2248ms
2025-12-27T04:28:31.208072044Z [err]  2025-12-27 04:28:31,203 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:31.708827339Z [err]  2025-12-27 04:28:31,705 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:32.212458992Z [err]  2025-12-27 04:28:32,206 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:32.720404148Z [err]  2025-12-27 04:28:32,707 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:33.216133016Z [err]  2025-12-27 04:28:33,208 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:33.710356640Z [err]  2025-12-27 04:28:33,709 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:33.710365243Z [err]  2025-12-27 04:28:33,709 - calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-27T04:28:33.712032973Z [err]  2025-12-27 04:28:33,709 - calling_service - INFO - üí¨ Sending FINAL check-in #2/2: Are you still there?
2025-12-27T04:28:33.712041561Z [err]  2025-12-27 04:28:33,709 - calling_service - INFO - ‚ö†Ô∏è Will end call if no response after next silence timeout
2025-12-27T04:28:33.712047488Z [err]  2025-12-27 04:28:33,709 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-27T04:28:33.712052621Z [err]  2025-12-27 04:28:33,709 - calling_service - INFO - ü§ñ Agent started speaking for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:33.712057367Z [err]  2025-12-27 04:28:33,709 - telnyx_service - INFO - üîä Speaking text on call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q: Are you still there?...
2025-12-27T04:28:33.712064166Z [err]  2025-12-27 04:28:33,710 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-27T04:28:33.712069528Z [err]  2025-12-27 04:28:33,710 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-27T04:28:33.712074495Z [err]  2025-12-27 04:28:33,710 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-27T04:28:33.712080135Z [err]  2025-12-27 04:28:33,710 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-27T04:28:33.712107541Z [err]  2025-12-27 04:28:33,710 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (18435 bytes)
2025-12-27T04:28:33.712112593Z [err]  2025-12-27 04:28:33,710 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-27T04:28:33.712117863Z [err]  2025-12-27 04:28:33,710 - telnyx_service - INFO - ‚úÖ Generated 18435 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-27T04:28:33.712123529Z [err]  2025-12-27 04:28:33,710 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-27T04:28:33.978315645Z [err]        "title": "Call has already ended",
2025-12-27T04:28:33.978318670Z [err]  2025-12-27 04:28:33,971 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-27T04:28:33.978328630Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-27T04:28:33.978336423Z [err]      }
2025-12-27T04:28:33.978340115Z [err]  2025-12-27 04:28:33,971 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.26s
2025-12-27T04:28:33.978344313Z [err]    ]
2025-12-27T04:28:33.978348434Z [err]  2025-12-27 04:28:33,972 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-27T04:28:33.978352077Z [err]  }
2025-12-27T04:28:33.978356067Z [err]    "errors": [
2025-12-27T04:28:33.978360286Z [err]  2025-12-27 04:28:33,972 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-27T04:28:33.978363595Z [err]      {
2025-12-27T04:28:33.978369647Z [err]        "code": "90018",
2025-12-27T04:28:34.542669425Z [err]  2025-12-27 04:28:34,248 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-27T04:28:34.542676301Z [err]  2025-12-27 04:28:34,248 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-27T04:28:34.542682164Z [err]  2025-12-27 04:28:34,248 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-27T04:28:34.760800633Z [err]  2025-12-27 04:28:34,751 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:34.760808136Z [err]  2025-12-27 04:28:34,751 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:34.794045235Z [err]  2025-12-27 04:28:34,791 - server - INFO - üìû Telnyx WebSocket disconnected. Sent 495 total packets
2025-12-27T04:28:34.794050894Z [err]  [2025-12-27 04:28:34 +0000] [3] [INFO] connection closed
2025-12-27T04:28:34.946195304Z [err]  2025-12-27 04:28:34,941 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:34.946204528Z [err]  2025-12-27 04:28:34,941 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.hangup', 'id': '171ea92c-8df1-45ed-b9e7-c2e45480b43e', 'occurred_at': '2025-12-27T04:28:34.583966Z', 'payload': {'call_control_id': 'v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw', 'call_leg_id': '7a123f5a-e2dc-11f0-b6df-02420aef981f', 'call_quality_stats': {'inbound': {'jitter_max_variance': '1.73', 'jitter_packet_count': '0', 'mos': '4.50', 'packet_count': '519', 'skip_packet_count': '18'}, 'outbound': {'packet_count': '497', 'skip_packet_count': '0'}}, 'call_session_id': '7a0efcbe-e2dc-11f0-9af1-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-27T04:28:34.583966Z', 'from': '+14048000152', 'hangup_cause': 'normal_clearing', 'hangup_source': 'callee', 'sip_hangup_cause': '200', 'start_time': '2025-12-27T04:28:21.783976Z', 'to': '+17708336397'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:34.946222852Z [err]  2025-12-27 04:28:34,941 - server - INFO - üéØ Event type: call.hangup, Call ID: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:34.946228255Z [err]  2025-12-27 04:28:34,941 - server - INFO - üì® ================================================
2025-12-27T04:28:34.946233435Z [err]  2025-12-27 04:28:34,941 - server - INFO - üìû Call ended: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:34.946238839Z [err]  2025-12-27 04:28:34,941 - server - INFO - üìû Hangup cause: normal_clearing
2025-12-27T04:28:34.970822302Z [err]  2025-12-27 04:28:34,962 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:34.970827796Z [err]  2025-12-27 04:28:34,962 - server - INFO - üì® Full payload: {'data': {'event_type': 'streaming.stopped', 'id': '4b86b45c-ed45-4f12-8bbc-1fde0d21b375', 'occurred_at': '2025-12-27T04:28:34.726323Z', 'payload': {'call_control_id': 'v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw', 'call_leg_id': '7a123f5a-e2dc-11f0-b6df-02420aef981f', 'call_session_id': '7a0efcbe-e2dc-11f0-9af1-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'stream_id': '8fafb788-3ae2-4013-8095-e084b781317a', 'stream_params': {'stream_track': 'inbound', 'stream_url': 'wss://api.li-ai.org/api/telnyx/audio-stream'}, 'stream_type': 'websocket'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:34.970832439Z [err]  2025-12-27 04:28:34,962 - server - INFO - üéØ Event type: streaming.stopped, Call ID: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:34.970837629Z [err]  2025-12-27 04:28:34,962 - server - INFO - üì® ================================================
2025-12-27T04:28:34.970842457Z [inf]  100.64.0.12:14642 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:35.087983381Z [err]  2025-12-27 04:28:35,085 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:35.087993932Z [err]  2025-12-27 04:28:35,085 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.playback.ended', 'id': '3f5773fc-467e-4a56-a90c-4c6a050f229a', 'occurred_at': '2025-12-27T04:28:34.663969Z', 'payload': {'call_control_id': 'v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw', 'call_leg_id': '7a123f5a-e2dc-11f0-b6df-02420aef981f', 'call_session_id': '7a0efcbe-e2dc-11f0-9af1-02420aef981f', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-27T04:28:34.663969Z', 'media_name': None, 'media_url': 'api.li-ai.org/api/tts-audio/comfort_noise_continuous.mp3', 'overlay': True, 'playback_id': 'yfw-2AeZHg', 'status': 'call_hangup', 'status_detail': ''}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:35.088002944Z [err]  2025-12-27 04:28:35,085 - server - INFO - üéØ Event type: call.playback.ended, Call ID: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:35.088009530Z [err]  2025-12-27 04:28:35,085 - server - INFO - üì® ================================================
2025-12-27T04:28:35.089857085Z [err]  2025-12-27 04:28:35,087 - redis_service - INFO - ‚ûñ Removed playback yfw-2AeZHg, 0 remaining for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:35.089867489Z [err]  2025-12-27 04:28:35,087 - server - INFO - üîä Redis: Removed playback yfw-2AeZHg, 0 remaining
2025-12-27T04:28:35.089876266Z [err]  2025-12-27 04:28:35,087 - server - INFO - üîä ALL PLAYBACKS FINISHED (via Redis) - attempting to start silence timer
2025-12-27T04:28:35.089884354Z [err]  2025-12-27 04:28:35,087 - server - INFO - ‚úÖ Set 'agent_done_speaking' flag in Redis for worker with session to detect
2025-12-27T04:28:35.089890689Z [err]  2025-12-27 04:28:35,088 - server - INFO - üí° Session not on this worker - Redis flag set for WebSocket worker to handle
2025-12-27T04:28:35.089896744Z [inf]  100.64.0.11:17256 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:35.139405427Z [err]  2025-12-27 04:28:35,135 - server - INFO - üìù Updated call log: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:35.239729540Z [err]  2025-12-27 04:28:35,233 - server - INFO - ‚úÖ Finalized call log: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw (duration=10s, status=completed)
2025-12-27T04:28:35.547327436Z [err]  2025-12-27 04:28:35,252 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:35.547333565Z [err]  2025-12-27 04:28:35,252 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:35.547339429Z [err]  2025-12-27 04:28:35,332 - server - INFO - üì¶ Saved 11 session variables to call_log: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-27T04:28:35.762231193Z [err]  2025-12-27 04:28:35,754 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:35.762241797Z [err]  2025-12-27 04:28:35,754 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:36.097906831Z [err]  2025-12-27 04:28:36,088 - server - INFO - üìä Auto-added call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw to campaign b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8
2025-12-27T04:28:36.258686192Z [err]  2025-12-27 04:28:36,256 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:36.258696512Z [err]  2025-12-27 04:28:36,257 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:36.592433383Z [err]  2025-12-27 04:28:36,372 - server - INFO - üì§ Sending post-call webhook to: https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b
2025-12-27T04:28:36.592439646Z [err]  2025-12-27 04:28:36,373 - redis_service - INFO - üì• Retrieved call data from Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:36.592444197Z [err]  2025-12-27 04:28:36,373 - server - INFO - üìá [HANGUP] Data source: redis=Yes, memory=Yes
2025-12-27T04:28:36.592448897Z [err]  2025-12-27 04:28:36,373 - server - INFO - üìá [HANGUP] Missing data from cache, checking MongoDB call_logs...
2025-12-27T04:28:36.592455256Z [err]  2025-12-27 04:28:36,470 - server - INFO - üìá [HANGUP] Found call_log in MongoDB, extracting missing data...
2025-12-27T04:28:36.592459728Z [err]  2025-12-27 04:28:36,563 - server - INFO - üìá [HANGUP] After MongoDB fallback: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397
2025-12-27T04:28:36.592464314Z [err]  2025-12-27 04:28:36,563 - server - INFO - üìá [HANGUP] Final extracted data: user_id=dcafa642-6136-4096-b77d-a4cb99a62651, agent_id=bbeda238-e8d9-4d8c-b93b-1b7694581adb, to_number=+17708336397, lead_id=None, agent_name=JK First Caller-optimizer3
2025-12-27T04:28:36.592468944Z [err]  2025-12-27 04:28:36,563 - server - INFO - üìá [HANGUP] Agent info keys: None
2025-12-27T04:28:36.592475246Z [err]  2025-12-27 04:28:36,563 - server - INFO - üöÄ Triggered QC analysis for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:36.592479800Z [err]  2025-12-27 04:28:36,563 - server - INFO - üìä Triggered Campaign QC for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:36.592484419Z [err]  2025-12-27 04:28:36,563 - server - INFO - üìá Triggered CRM update for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:36.592489911Z [err]  2025-12-27 04:28:36,564 - persistent_tts_service - INFO - üîå [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Closing persistent TTS WebSocket...
2025-12-27T04:28:36.594403157Z [err]  2025-12-27 04:28:36,564 - server - INFO - üîç Starting QC analysis for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:36.594410980Z [err]  2025-12-27 04:28:36,564 - server - INFO - üîç [AUTO-QC] Starting campaign QC check for call=v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw, user=dcafa642-6136-4096-b77d-a4cb99a62651, agent=bbeda238-e8d9-4d8c-b93b-1b7694581adb
2025-12-27T04:28:36.594416985Z [err]  2025-12-27 04:28:36,564 - server - INFO - üìá CRM update starting for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw: to_number=+17708336397, user_id=dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-27T04:28:36.594422586Z [err]  2025-12-27 04:28:36,564 - server - INFO - üìá Normalized phone: +17708336397
2025-12-27T04:28:36.594428381Z [err]  2025-12-27 04:28:36,564 - server - INFO - üìá CRM: Got 11 variables from active session
2025-12-27T04:28:36.594436265Z [err]  2025-12-27 04:28:36,564 - persistent_tts_service - INFO - üõë [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Audio Receiver Loop CANCELLED
2025-12-27T04:28:36.594442180Z [err]  2025-12-27 04:28:36,564 - persistent_tts_service - INFO - üëã [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Audio Receiver Loop STOPPED
2025-12-27T04:28:36.594447012Z [err]  2025-12-27 04:28:36,565 - persistent_tts_service - INFO - üõë [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Playback consumer shutting down
2025-12-27T04:28:36.657129625Z [err]  2025-12-27 04:28:36,650 - server - INFO - üì® ========== TELNYX WEBHOOK RECEIVED ==========
2025-12-27T04:28:36.657145998Z [err]  2025-12-27 04:28:36,650 - server - INFO - üì® Full payload: {'data': {'event_type': 'call.recording.saved', 'id': 'ff7a583f-2fdf-4939-9e6c-be6c68a0ad58', 'occurred_at': '2025-12-27T04:28:36.559858Z', 'payload': {'call_control_id': 'v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw', 'call_leg_id': '7a123f5a-e2dc-11f0-b6df-02420aef981f', 'call_session_id': '7a0efcbe-e2dc-11f0-9af1-02420aef981f', 'channels': 'dual', 'client_state': None, 'connection_id': '2777245537294877821', 'end_time': '2025-12-27T04:28:34.671364Z', 'format': 'mp3', 'public_recording_urls': {}, 'recording_ended_at': '2025-12-27T04:28:34.671364Z', 'recording_id': '05655059-202d-4896-958d-3738fa5e98e7', 'recording_started_at': '2025-12-27T04:28:25.063070Z', 'recording_urls': {'mp3': 'https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-27/7a123f5a-e2dc-11f0-b6df-02420aef981f-1766809705036808.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251227%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251227T042836Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=a85a05b62d283c2ea1bd5f7cbc6967a38ea9eab8dc7fea41d6c6db185acac055'}, 'start_time': '2025-12-27T04:28:25.063070Z'}, 'record_type': 'event'}, 'meta': {'attempt': 1, 'delivered_to': 'https://api.li-ai.org/api/telnyx/webhook'}}
2025-12-27T04:28:36.657154620Z [err]  2025-12-27 04:28:36,650 - server - INFO - üéØ Event type: call.recording.saved, Call ID: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:36.657162441Z [err]  2025-12-27 04:28:36,650 - server - INFO - üì® ================================================
2025-12-27T04:28:36.657169985Z [err]  2025-12-27 04:28:36,650 - server - INFO - üéôÔ∏è Recording saved for call: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:36.657176116Z [err]  2025-12-27 04:28:36,651 - redis_service - INFO - üì• Retrieved call data from Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:36.658414430Z [err]  2025-12-27 04:28:36,651 - server - INFO - üîç Recording check: download_url=True, channels=dual, recording_id=05655059-202d-4896-958d-3738fa5e98e7, call_data=True
2025-12-27T04:28:36.660070972Z [err]  2025-12-27 04:28:36,657 - server - INFO - üìá CRM: Got 11 extracted variables
2025-12-27T04:28:36.660077324Z [err]  2025-12-27 04:28:36,657 - server - INFO - üìá CRM: Total variables collected: ['now', 'customer_name', 'callerName', 'lead_id', 'qc_tracking_enabled', 'track_keywords', 'expected_commitment', 'to_number', 'phone_number', 'email', 'from_number']
2025-12-27T04:28:36.660082157Z [err]  2025-12-27 04:28:36,658 - server - INFO - üîç [AUTO-QC] Call log found: transcript_turns=2, logs_count=2, status=completed
2025-12-27T04:28:36.661202005Z [err]  2025-12-27 04:28:36,660 - server - INFO - üìù Converted transcript from 2 messages to 33 characters
2025-12-27T04:28:36.756154614Z [err]  2025-12-27 04:28:36,753 - httpx - INFO - HTTP Request: POST https://n8n.outlier-agency.com/webhook/2adb150a-9e08-4053-9fa4-e47df18bf39b "HTTP/1.1 200 OK"
2025-12-27T04:28:36.756161204Z [err]  2025-12-27 04:28:36,754 - server - INFO - ‚úÖ Post-call webhook sent successfully (status=200)
2025-12-27T04:28:36.756165619Z [err]  2025-12-27 04:28:36,754 - key_encryption - WARNING - Failed to decrypt key, assuming unencrypted: 
2025-12-27T04:28:36.763316669Z [err]  2025-12-27 04:28:36,758 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:36.763328512Z [err]  2025-12-27 04:28:36,758 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:36.843254175Z [err]  2025-12-27 04:28:36,841 - server - INFO - üìá CRM: Updated lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e (+17708336397) - fields: ['updated_at', 'last_contact', 'last_agent_id', 'last_agent_name', 'custom_fields']
2025-12-27T04:28:36.850453291Z [err]  2025-12-27 04:28:36,847 - qc_agents.orchestrator - INFO - No QC agent configs found, using defaults with API key
2025-12-27T04:28:36.942811350Z [err]  2025-12-27 04:28:36,940 - qc_agents.orchestrator - INFO - Using QC model: gpt-4o
2025-12-27T04:28:36.942824138Z [err]  2025-12-27 04:28:36,940 - qc_agents.orchestrator - INFO - ‚úÖ Initialized 3 QC agents for user dcafa642-6136-4096-b77d-a4cb99a62651
2025-12-27T04:28:36.942831905Z [err]  2025-12-27 04:28:36,940 - qc_agents.orchestrator - INFO - üîç Running Commitment Detector on call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:37.107065856Z [err]  2025-12-27 04:28:37,102 - server - INFO - üîç [AUTO-QC] Agent found: name=JK First Caller-optimizer3, has_auto_qc_settings=True
2025-12-27T04:28:37.200499812Z [err]  2025-12-27 04:28:37,192 - server - INFO - üìä [AUTO-QC] Running full QC analysis: call=v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw ‚Üí campaign=b7bd9ce7-2722-4c61-a2fc-ca1fb127d7b8 (tech=True, script=True, tonality=True)
2025-12-27T04:28:37.200506728Z [err]  2025-12-27 04:28:37,192 - server - INFO - üìä [AUTO-QC] LLM settings: provider=grok, model=grok-3
2025-12-27T04:28:37.200515883Z [err]  2025-12-27 04:28:37,192 - server - ERROR - ‚ùå [AUTO-QC] Error in campaign QC for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-27T04:28:37.200520057Z [err]  2025-12-27 04:28:37,192 - server - ERROR - ‚ùå [AUTO-QC] Traceback: Traceback (most recent call last):
2025-12-27T04:28:37.200524163Z [err]    File "/app/backend/server.py", line 9746, in trigger_campaign_qc_for_call
2025-12-27T04:28:37.200528294Z [err]      await run_full_qc_analysis(
2025-12-27T04:28:37.200532345Z [err]            ^^^^^^^^^^^^^^^^^^^^^
2025-12-27T04:28:37.200552107Z [err]  TypeError: run_full_qc_analysis() got an unexpected keyword argument 'llm_provider'
2025-12-27T04:28:37.200557480Z [err]  
2025-12-27T04:28:37.480287201Z [err]  2025-12-27 04:28:37,261 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:37.480292821Z [err]  2025-12-27 04:28:37,262 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: ['v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw'])
2025-12-27T04:28:37.520765459Z [err]  2025-12-27 04:28:37,514 - server - INFO - üíæ Saved recording URL and ID to database: 05655059-202d-4896-958d-3738fa5e98e7
2025-12-27T04:28:37.520773405Z [err]  2025-12-27 04:28:37,514 - server - INFO - ‚úÖ Entering dual-channel processing
2025-12-27T04:28:37.520778235Z [err]  2025-12-27 04:28:37,514 - server - INFO - üì• Downloading DUAL-CHANNEL recording...
2025-12-27T04:28:37.674878970Z [err]  2025-12-27 04:28:37,672 - elevenlabs_ws_service - INFO - üîå Closed ElevenLabs WebSocket connection
2025-12-27T04:28:37.674885286Z [err]  2025-12-27 04:28:37,672 - persistent_tts_service - INFO - ‚úÖ [Call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw] Persistent TTS WebSocket closed
2025-12-27T04:28:37.674889553Z [err]  2025-12-27 04:28:37,672 - persistent_tts_service - INFO - ‚úÖ Closed persistent TTS session for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:37.674893825Z [err]  2025-12-27 04:28:37,672 - server - INFO - ‚úÖ Closed persistent TTS session for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:37.674898154Z [err]  2025-12-27 04:28:37,673 - redis_service - INFO - üßπ Deleted call data from Redis: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:37.674902217Z [err]  2025-12-27 04:28:37,673 - server - INFO - üßπ Cleaned up call session from Redis and memory: v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:37.674906198Z [inf]  100.64.0.10:41910 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:37.775410332Z [err]  2025-12-27 04:28:37,762 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:37.775415564Z [err]  2025-12-27 04:28:37,763 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:37.775421022Z [err]  2025-12-27 04:28:37,763 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:37.775426782Z [err]  2025-12-27 04:28:37,764 - calling_service - INFO - ‚è∞ Check-in triggered after 7.5s silence (threshold: 7s)
2025-12-27T04:28:37.775432118Z [err]  2025-12-27 04:28:37,765 - calling_service - INFO - üí¨ Sending check-in #1/2: Are you still there?
2025-12-27T04:28:37.775438099Z [err]  2025-12-27 04:28:37,765 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.5s silence: Are you still there?
2025-12-27T04:28:37.775443315Z [err]  2025-12-27 04:28:37,765 - calling_service - INFO - ü§ñ Agent started speaking for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:37.775448294Z [err]  2025-12-27 04:28:37,765 - telnyx_service - INFO - üîä Speaking text on call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw: Are you still there?...
2025-12-27T04:28:37.775453913Z [err]  2025-12-27 04:28:37,765 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-27T04:28:37.775459149Z [err]  2025-12-27 04:28:37,765 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-27T04:28:37.775465067Z [err]  2025-12-27 04:28:37,765 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-27T04:28:37.775470204Z [err]  2025-12-27 04:28:37,765 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-27T04:28:37.775475520Z [err]  2025-12-27 04:28:37,765 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (18435 bytes)
2025-12-27T04:28:37.777464148Z [err]  2025-12-27 04:28:37,765 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-27T04:28:37.777471467Z [err]  2025-12-27 04:28:37,765 - telnyx_service - INFO - ‚úÖ Generated 18435 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-27T04:28:37.777477436Z [err]  2025-12-27 04:28:37,765 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-27T04:28:37.826665264Z [err]  2025-12-27 04:28:37,818 - httpx - INFO - HTTP Request: GET https://s3.amazonaws.com/telephony-recorder-prod/227803fb-1717-407d-9bd5-fd04aa27c656/2025-12-27/7a123f5a-e2dc-11f0-b6df-02420aef981f-1766809705036808.mp3?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIASDC5E2MJDPKMH7UW%2F20251227%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20251227T042836Z&X-Amz-Expires=600&X-Amz-SignedHeaders=host&X-Amz-Signature=a85a05b62d283c2ea1bd5f7cbc6967a38ea9eab8dc7fea41d6c6db185acac055 "HTTP/1.1 200 OK"
2025-12-27T04:28:37.911895750Z [err]  2025-12-27 04:28:37,906 - server - INFO - ‚úÖ Downloaded 38704 bytes
2025-12-27T04:28:38.038892099Z [err]  2025-12-27 04:28:38,034 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-27T04:28:38.038911675Z [err]  2025-12-27 04:28:38,035 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.27s
2025-12-27T04:28:38.038921280Z [err]  2025-12-27 04:28:38,035 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-27T04:28:38.038929568Z [err]    "errors": [
2025-12-27T04:28:38.038938061Z [err]      {
2025-12-27T04:28:38.038947719Z [err]        "code": "90018",
2025-12-27T04:28:38.038955527Z [err]        "title": "Call has already ended",
2025-12-27T04:28:38.038964061Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-27T04:28:38.038972774Z [err]      }
2025-12-27T04:28:38.038982198Z [err]    ]
2025-12-27T04:28:38.038990234Z [err]  }
2025-12-27T04:28:38.038998200Z [err]  2025-12-27 04:28:38,035 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-27T04:28:38.085922572Z [err]  2025-12-27 04:28:38,081 - server - INFO - ‚úÖ Split into 2 channels
2025-12-27T04:28:38.085931981Z [err]  2025-12-27 04:28:38,081 - server - INFO - üé§ Using STT provider: soniox for interruption detection
2025-12-27T04:28:38.085937930Z [err]  2025-12-27 04:28:38,081 - server - INFO - üìä Channel 0: 209484 bytes
2025-12-27T04:28:38.085942605Z [err]  2025-12-27 04:28:38,081 - server - ERROR - ‚ùå No Soniox API key available
2025-12-27T04:28:38.085947388Z [err]  2025-12-27 04:28:38,082 - server - INFO - ‚ùå Channel 0: No speech
2025-12-27T04:28:38.085952551Z [err]  2025-12-27 04:28:38,082 - server - INFO - üìä Channel 1: 209484 bytes
2025-12-27T04:28:38.085956999Z [err]  2025-12-27 04:28:38,082 - server - ERROR - ‚ùå No Soniox API key available
2025-12-27T04:28:38.085961227Z [err]  2025-12-27 04:28:38,082 - server - INFO - ‚ùå Channel 1: No speech
2025-12-27T04:28:38.085965599Z [err]  2025-12-27 04:28:38,082 - server - WARNING - ‚ö†Ô∏è No speech in any channel
2025-12-27T04:28:38.085970979Z [inf]  100.64.0.11:17256 - "POST /api/telnyx/webhook HTTP/1.1" 200
2025-12-27T04:28:38.218597540Z [err]  2025-12-27 04:28:38,216 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-27T04:28:38.222139173Z [err]  2025-12-27 04:28:38,217 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-27T04:28:38.222150661Z [err]  2025-12-27 04:28:38,217 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-27T04:28:38.555780969Z [err]  2025-12-27 04:28:38,265 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:38.555785259Z [err]  2025-12-27 04:28:38,265 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:38.724979274Z [err]  2025-12-27 04:28:38,718 - dead_air_monitor - INFO - üö© Detected 'agent_done_speaking' flag from webhook - marking agent as done
2025-12-27T04:28:38.724986219Z [err]  2025-12-27 04:28:38,718 - calling_service - INFO - ‚è±Ô∏è SILENCE TIMER STARTED at 1766809718.7188249 for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:38.724991163Z [err]  2025-12-27 04:28:38,718 - calling_service - INFO - ü§ñ Agent stopped speaking for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:38.724995676Z [err]  2025-12-27 04:28:38,719 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:38.768835838Z [err]  2025-12-27 04:28:38,766 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:38.768843087Z [err]  2025-12-27 04:28:38,766 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:Vl2GoNug0sdcDXEeX... (active sessions: [])
2025-12-27T04:28:39.224142932Z [err]  2025-12-27 04:28:39,220 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:39.230175082Z [err]  2025-12-27 04:28:39,225 - server - INFO - üé§ Soniox receiver alive - 7 messages received in last 10s
2025-12-27T04:28:39.230181030Z [err]  2025-12-27 04:28:39,226 - server - ERROR - ‚ùå Soniox error: {'tokens': [], 'final_audio_proc_ms': 2520, 'total_audio_proc_ms': 4680, 'error_code': 408, 'error_message': 'Request timeout.'}
2025-12-27T04:28:39.230185086Z [err]  2025-12-27 04:28:39,226 - server - INFO - ‚úÖ Soniox receive loop ended normally
2025-12-27T04:28:39.230189134Z [err]  2025-12-27 04:28:39,226 - dead_air_monitor - INFO - üîá Dead air monitoring cancelled for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:39.230193150Z [err]  2025-12-27 04:28:39,226 - dead_air_monitor - INFO - üîá Dead air monitoring stopped for call v3:Vl2GoNug0sdcDXEeXtlZ_L9GRZEwZYN_SVDcWzQ50MYnes7ueRra7Q
2025-12-27T04:28:39.230197327Z [err]  2025-12-27 04:28:39,226 - server - INFO - üîá Dead air monitoring task cancelled
2025-12-27T04:28:39.724027713Z [err]  2025-12-27 04:28:39,722 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:40.227488538Z [err]  2025-12-27 04:28:40,223 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:40.227497495Z [err]  2025-12-27 04:28:40,223 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=1.5s, checkin_count=1/2
2025-12-27T04:28:40.755212226Z [err]  2025-12-27 04:28:40,724 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:40.755216646Z [err]  2025-12-27 04:28:40,724 - dead_air_monitor - INFO - üîç MONITOR: agent_speaking=False, user_speaking=False, silence=2.0s, checkin_count=1/2
2025-12-27T04:28:41.240640860Z [err]  2025-12-27 04:28:41,225 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:41.240645447Z [err]  2025-12-27 04:28:41,227 - soniox_service - ERROR - ‚ùå Error closing Soniox session: received 1000 (OK); then sent 1000 (OK)
2025-12-27T04:28:41.240649944Z [err]  2025-12-27 04:28:41,227 - server - INFO - üîå Telnyx WebSocket disconnected
2025-12-27T04:28:41.733493616Z [err]  2025-12-27 04:28:41,727 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:42.233591237Z [err]  2025-12-27 04:28:42,228 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:42.606630548Z [err]  2025-12-27 04:28:42,601 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-27T04:28:42.606644451Z [err]  2025-12-27 04:28:42,602 - qc_agents.commitment_detector - ERROR - Error in CommitmentDetector LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-27T04:28:42.606653215Z [err]  2025-12-27 04:28:42,602 - qc_agents.orchestrator - INFO - üó∫Ô∏è  Running Conversion Pathfinder on call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:42.739464886Z [err]  2025-12-27 04:28:42,730 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:43.235769253Z [err]  2025-12-27 04:28:43,231 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:43.740474298Z [err]  2025-12-27 04:28:43,733 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:44.235392538Z [err]  2025-12-27 04:28:44,234 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:44.705761522Z [err]  2025-12-27 04:28:44,695 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-27T04:28:44.705768419Z [err]  2025-12-27 04:28:44,698 - qc_agents.conversion_pathfinder - ERROR - Error in ConversionPathfinder LLM analysis: Expecting value: line 1 column 1 (char 0), falling back to patterns
2025-12-27T04:28:44.705773100Z [err]  2025-12-27 04:28:44,698 - qc_agents.orchestrator - INFO - ‚≠ê Running Excellence Replicator on call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:44.739163043Z [err]  2025-12-27 04:28:44,734 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:45.238634440Z [err]  2025-12-27 04:28:45,236 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:45.740948443Z [err]  2025-12-27 04:28:45,737 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:45.740966916Z [err]  2025-12-27 04:28:45,737 - calling_service - INFO - ‚è∞ Check-in triggered after 7.0s silence (threshold: 7s)
2025-12-27T04:28:45.740976700Z [err]  2025-12-27 04:28:45,737 - calling_service - INFO - üí¨ Sending FINAL check-in #2/2: Are you still there?
2025-12-27T04:28:45.740984295Z [err]  2025-12-27 04:28:45,737 - calling_service - INFO - ‚ö†Ô∏è Will end call if no response after next silence timeout
2025-12-27T04:28:45.740992862Z [err]  2025-12-27 04:28:45,737 - dead_air_monitor - INFO - üí¨ Sending check-in after 7.0s silence: Are you still there?
2025-12-27T04:28:45.741001171Z [err]  2025-12-27 04:28:45,737 - calling_service - INFO - ü§ñ Agent started speaking for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:45.741008189Z [err]  2025-12-27 04:28:45,737 - telnyx_service - INFO - üîä Speaking text on call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw: Are you still there?...
2025-12-27T04:28:45.741018558Z [err]  2025-12-27 04:28:45,737 - telnyx_service - INFO - üîç Agent config provided: True
2025-12-27T04:28:45.741026226Z [err]  2025-12-27 04:28:45,737 - telnyx_service - INFO - üîç TTS provider from settings: elevenlabs
2025-12-27T04:28:45.741034178Z [err]  2025-12-27 04:28:45,737 - telnyx_service - INFO - üîç WebSocket TTS: False
2025-12-27T04:28:45.741041954Z [err]  2025-12-27 04:28:45,737 - telnyx_service - INFO - üéôÔ∏è Attempting elevenlabs TTS (REST)
2025-12-27T04:28:45.741049268Z [err]  2025-12-27 04:28:45,737 - server - INFO - üíæ TTS CACHE HIT: Returning cached audio (18435 bytes)
2025-12-27T04:28:45.741056216Z [err]  2025-12-27 04:28:45,737 - telnyx_service - INFO - ‚è±Ô∏è  TTS generation time: 0.00s
2025-12-27T04:28:45.741063256Z [err]  2025-12-27 04:28:45,738 - telnyx_service - INFO - ‚úÖ Generated 18435 bytes, saved to /tmp/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-27T04:28:45.741853305Z [err]  2025-12-27 04:28:45,738 - telnyx_service - INFO - üîó Using audio URL: api.li-ai.org/api/tts-audio/tts_59aded63200fa5fb87dd5793c8f91482.mp3
2025-12-27T04:28:46.009558768Z [err]  2025-12-27 04:28:46,001 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw/actions/playback_start "HTTP/1.1 422 Unprocessable Entity"
2025-12-27T04:28:46.009572309Z [err]  2025-12-27 04:28:46,001 - telnyx_service - INFO - ‚è±Ô∏è  Playback API call time: 0.26s
2025-12-27T04:28:46.009579883Z [err]  2025-12-27 04:28:46,002 - telnyx_service - ERROR - ‚ùå Telnyx playback failed: 422 - {
2025-12-27T04:28:46.009587345Z [err]    "errors": [
2025-12-27T04:28:46.009594501Z [err]      {
2025-12-27T04:28:46.009612322Z [err]        "code": "90018",
2025-12-27T04:28:46.009621232Z [err]        "title": "Call has already ended",
2025-12-27T04:28:46.009630458Z [err]        "detail": "This call is no longer active and can't receive commands."
2025-12-27T04:28:46.009637734Z [err]      }
2025-12-27T04:28:46.009648133Z [err]    ]
2025-12-27T04:28:46.009659278Z [err]  }
2025-12-27T04:28:46.009665507Z [err]  2025-12-27 04:28:46,002 - telnyx_service - INFO - üì¢ Using Telnyx built-in TTS
2025-12-27T04:28:46.265595458Z [err]  2025-12-27 04:28:46,261 - httpx - INFO - HTTP Request: POST https://api.telnyx.com/v2/calls/v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw/actions/speak "HTTP/1.1 422 Unprocessable Entity"
2025-12-27T04:28:46.265603507Z [err]  2025-12-27 04:28:46,261 - telnyx_service - ERROR - ‚ùå Error speaking text: Error code: 422 - {'errors': [{'code': '90018', 'title': 'Call has already ended', 'detail': "This call is no longer active and can't receive commands."}]}
2025-12-27T04:28:46.265609592Z [err]  2025-12-27 04:28:46,261 - dead_air_monitor - INFO - ‚úÖ Check-in message sent
2025-12-27T04:28:46.765307382Z [err]  2025-12-27 04:28:46,763 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:46.765313826Z [err]  2025-12-27 04:28:46,763 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:47.270447307Z [err]  2025-12-27 04:28:47,265 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:47.270453700Z [err]  2025-12-27 04:28:47,265 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:47.593642226Z [err]  2025-12-27 04:28:47,321 - httpx - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-27T04:28:47.593647798Z [err]  2025-12-27 04:28:47,325 - qc_agents.excellence_replicator - ERROR - Error in ExcellenceReplicator analysis: Expecting value: line 1 column 1 (char 0)
2025-12-27T04:28:47.593653474Z [err]  2025-12-27 04:28:47,418 - qc_agents.orchestrator - INFO - ‚úÖ QC analysis stored for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:47.593659048Z [err]  2025-12-27 04:28:47,418 - server - INFO - ‚úÖ QC analysis completed for call v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:47.593664241Z [err]  2025-12-27 04:28:47,418 - server - INFO - üìä Scores: Commitment=50, Conversion=0, Excellence=50
2025-12-27T04:28:47.610610658Z [err]  2025-12-27 04:28:47,605 - server - INFO - üìä Updated campaign_calls with QC scores for v3:80AGoJbA7H-Axl0z5a08stE7FqSVXeHNDaSOkyuoPbmO5W3LKP-8aw
2025-12-27T04:28:47.774168692Z [err]  2025-12-27 04:28:47,767 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:47.774175152Z [err]  2025-12-27 04:28:47,767 - persistent_tts_service - WARNING - ‚ö†Ô∏è  No persistent TTS session found for call v3:80AGoJbA7H-Axl0z5... (active sessions: [])
2025-12-27T04:28:47.788250407Z [err]  2025-12-27 04:28:47,786 - server - INFO - üìà Synced QC scores to lead 288a0e8e-ff8b-4249-b2ea-b84e5cb9929e via phone match